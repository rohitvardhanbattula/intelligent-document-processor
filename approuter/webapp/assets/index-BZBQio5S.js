import{s as sharp,O as ONNX_NODE}from"./__vite-browser-external-DTHgcB49.js";function _mergeNamespaces(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const o in s)if(o!=="default"&&!(o in n)){const u=Object.getOwnPropertyDescriptor(s,o);u&&Object.defineProperty(n,o,u.get?u:{enumerable:!0,get:()=>s[o]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const l of u.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(o){if(o.ep)return;o.ep=!0;const u=t(o);fetch(o.href,u)}})();function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function getAugmentedNamespace(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var o=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,o.get?o:{enumerable:!0,get:function(){return n[s]}})}),t}var jsxRuntime={exports:{}},reactJsxRuntime_production={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,o,u){var l=null;if(u!==void 0&&(l=""+u),o.key!==void 0&&(l=""+o.key),"key"in o){u={};for(var m in o)m!=="key"&&(u[m]=o[m])}else u=o;return o=u.ref,{$$typeof:n,type:s,key:l,ref:o!==void 0?o:null,props:u}}return reactJsxRuntime_production.Fragment=e,reactJsxRuntime_production.jsx=t,reactJsxRuntime_production.jsxs=t,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),react={exports:{}},react_production={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),l=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),i=Symbol.for("react.activity"),r=Symbol.iterator;function d(q){return q===null||typeof q!="object"?null:(q=r&&q[r]||q["@@iterator"],typeof q=="function"?q:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,y={};function v(q,le,be){this.props=q,this.context=le,this.refs=y,this.updater=be||p}v.prototype.isReactComponent={},v.prototype.setState=function(q,le){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,le,"setState")},v.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function T(){}T.prototype=v.prototype;function w(q,le,be){this.props=q,this.context=le,this.refs=y,this.updater=be||p}var E=w.prototype=new T;E.constructor=w,_(E,v.prototype),E.isPureReactComponent=!0;var P=Array.isArray;function R(){}var I={H:null,A:null,T:null,S:null},N=Object.prototype.hasOwnProperty;function B(q,le,be){var xe=be.ref;return{$$typeof:n,type:q,key:le,ref:xe!==void 0?xe:null,props:be}}function D(q,le){return B(q.type,le,q.props)}function Y(q){return typeof q=="object"&&q!==null&&q.$$typeof===n}function se(q){var le={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(be){return le[be]})}var re=/\/+/g;function W(q,le){return typeof q=="object"&&q!==null&&q.key!=null?se(""+q.key):le.toString(36)}function $(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(R,R):(q.status="pending",q.then(function(le){q.status==="pending"&&(q.status="fulfilled",q.value=le)},function(le){q.status==="pending"&&(q.status="rejected",q.reason=le)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function k(q,le,be,xe,Ee){var we=typeof q;(we==="undefined"||we==="boolean")&&(q=null);var U=!1;if(q===null)U=!0;else switch(we){case"bigint":case"string":case"number":U=!0;break;case"object":switch(q.$$typeof){case n:case e:U=!0;break;case f:return U=q._init,k(U(q._payload),le,be,xe,Ee)}}if(U)return Ee=Ee(q),U=xe===""?"."+W(q,0):xe,P(Ee)?(be="",U!=null&&(be=U.replace(re,"$&/")+"/"),k(Ee,le,be,"",function(C){return C})):Ee!=null&&(Y(Ee)&&(Ee=D(Ee,be+(Ee.key==null||q&&q.key===Ee.key?"":(""+Ee.key).replace(re,"$&/")+"/")+U)),le.push(Ee)),1;U=0;var L=xe===""?".":xe+":";if(P(q))for(var M=0;M<q.length;M++)xe=q[M],we=L+W(xe,M),U+=k(xe,le,be,we,Ee);else if(M=d(q),typeof M=="function")for(q=M.call(q),M=0;!(xe=q.next()).done;)xe=xe.value,we=L+W(xe,M++),U+=k(xe,le,be,we,Ee);else if(we==="object"){if(typeof q.then=="function")return k($(q),le,be,xe,Ee);throw le=String(q),Error("Objects are not valid as a React child (found: "+(le==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":le)+"). If you meant to render a collection of children, use an array instead.")}return U}function H(q,le,be){if(q==null)return q;var xe=[],Ee=0;return k(q,xe,"","",function(we){return le.call(be,we,Ee++)}),xe}function de(q){if(q._status===-1){var le=q._result;le=le(),le.then(function(be){(q._status===0||q._status===-1)&&(q._status=1,q._result=be)},function(be){(q._status===0||q._status===-1)&&(q._status=2,q._result=be)}),q._status===-1&&(q._status=0,q._result=le)}if(q._status===1)return q._result.default;throw q._result}var ee=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var le=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(le))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)},ce={map:H,forEach:function(q,le,be){H(q,function(){le.apply(this,arguments)},be)},count:function(q){var le=0;return H(q,function(){le++}),le},toArray:function(q){return H(q,function(le){return le})||[]},only:function(q){if(!Y(q))throw Error("React.Children.only expected to receive a single React element child.");return q}};return react_production.Activity=i,react_production.Children=ce,react_production.Component=v,react_production.Fragment=t,react_production.Profiler=o,react_production.PureComponent=w,react_production.StrictMode=s,react_production.Suspense=g,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,react_production.__COMPILER_RUNTIME={__proto__:null,c:function(q){return I.H.useMemoCache(q)}},react_production.cache=function(q){return function(){return q.apply(null,arguments)}},react_production.cacheSignal=function(){return null},react_production.cloneElement=function(q,le,be){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var xe=_({},q.props),Ee=q.key;if(le!=null)for(we in le.key!==void 0&&(Ee=""+le.key),le)!N.call(le,we)||we==="key"||we==="__self"||we==="__source"||we==="ref"&&le.ref===void 0||(xe[we]=le[we]);var we=arguments.length-2;if(we===1)xe.children=be;else if(1<we){for(var U=Array(we),L=0;L<we;L++)U[L]=arguments[L+2];xe.children=U}return B(q.type,Ee,xe)},react_production.createContext=function(q){return q={$$typeof:l,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:u,_context:q},q},react_production.createElement=function(q,le,be){var xe,Ee={},we=null;if(le!=null)for(xe in le.key!==void 0&&(we=""+le.key),le)N.call(le,xe)&&xe!=="key"&&xe!=="__self"&&xe!=="__source"&&(Ee[xe]=le[xe]);var U=arguments.length-2;if(U===1)Ee.children=be;else if(1<U){for(var L=Array(U),M=0;M<U;M++)L[M]=arguments[M+2];Ee.children=L}if(q&&q.defaultProps)for(xe in U=q.defaultProps,U)Ee[xe]===void 0&&(Ee[xe]=U[xe]);return B(q,we,Ee)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(q){return{$$typeof:m,render:q}},react_production.isValidElement=Y,react_production.lazy=function(q){return{$$typeof:f,_payload:{_status:-1,_result:q},_init:de}},react_production.memo=function(q,le){return{$$typeof:h,type:q,compare:le===void 0?null:le}},react_production.startTransition=function(q){var le=I.T,be={};I.T=be;try{var xe=q(),Ee=I.S;Ee!==null&&Ee(be,xe),typeof xe=="object"&&xe!==null&&typeof xe.then=="function"&&xe.then(R,ee)}catch(we){ee(we)}finally{le!==null&&be.types!==null&&(le.types=be.types),I.T=le}},react_production.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},react_production.use=function(q){return I.H.use(q)},react_production.useActionState=function(q,le,be){return I.H.useActionState(q,le,be)},react_production.useCallback=function(q,le){return I.H.useCallback(q,le)},react_production.useContext=function(q){return I.H.useContext(q)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(q,le){return I.H.useDeferredValue(q,le)},react_production.useEffect=function(q,le){return I.H.useEffect(q,le)},react_production.useEffectEvent=function(q){return I.H.useEffectEvent(q)},react_production.useId=function(){return I.H.useId()},react_production.useImperativeHandle=function(q,le,be){return I.H.useImperativeHandle(q,le,be)},react_production.useInsertionEffect=function(q,le){return I.H.useInsertionEffect(q,le)},react_production.useLayoutEffect=function(q,le){return I.H.useLayoutEffect(q,le)},react_production.useMemo=function(q,le){return I.H.useMemo(q,le)},react_production.useOptimistic=function(q,le){return I.H.useOptimistic(q,le)},react_production.useReducer=function(q,le,be){return I.H.useReducer(q,le,be)},react_production.useRef=function(q){return I.H.useRef(q)},react_production.useState=function(q){return I.H.useState(q)},react_production.useSyncExternalStore=function(q,le,be){return I.H.useSyncExternalStore(q,le,be)},react_production.useTransition=function(){return I.H.useTransition()},react_production.version="19.2.1",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactExports=requireReact();const React=getDefaultExportFromCjs(reactExports);var client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,(function(n){function e(k,H){var de=k.length;k.push(H);e:for(;0<de;){var ee=de-1>>>1,ce=k[ee];if(0<o(ce,H))k[ee]=H,k[de]=ce,de=ee;else break e}}function t(k){return k.length===0?null:k[0]}function s(k){if(k.length===0)return null;var H=k[0],de=k.pop();if(de!==H){k[0]=de;e:for(var ee=0,ce=k.length,q=ce>>>1;ee<q;){var le=2*(ee+1)-1,be=k[le],xe=le+1,Ee=k[xe];if(0>o(be,de))xe<ce&&0>o(Ee,be)?(k[ee]=Ee,k[xe]=de,ee=xe):(k[ee]=be,k[le]=de,ee=le);else if(xe<ce&&0>o(Ee,de))k[ee]=Ee,k[xe]=de,ee=xe;else break e}}return H}function o(k,H){var de=k.sortIndex-H.sortIndex;return de!==0?de:k.id-H.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var l=Date,m=l.now();n.unstable_now=function(){return l.now()-m}}var g=[],h=[],f=1,i=null,r=3,d=!1,p=!1,_=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;function E(k){for(var H=t(h);H!==null;){if(H.callback===null)s(h);else if(H.startTime<=k)s(h),H.sortIndex=H.expirationTime,e(g,H);else break;H=t(h)}}function P(k){if(_=!1,E(k),!p)if(t(g)!==null)p=!0,R||(R=!0,se());else{var H=t(h);H!==null&&$(P,H.startTime-k)}}var R=!1,I=-1,N=5,B=-1;function D(){return y?!0:!(n.unstable_now()-B<N)}function Y(){if(y=!1,R){var k=n.unstable_now();B=k;var H=!0;try{e:{p=!1,_&&(_=!1,T(I),I=-1),d=!0;var de=r;try{t:{for(E(k),i=t(g);i!==null&&!(i.expirationTime>k&&D());){var ee=i.callback;if(typeof ee=="function"){i.callback=null,r=i.priorityLevel;var ce=ee(i.expirationTime<=k);if(k=n.unstable_now(),typeof ce=="function"){i.callback=ce,E(k),H=!0;break t}i===t(g)&&s(g),E(k)}else s(g);i=t(g)}if(i!==null)H=!0;else{var q=t(h);q!==null&&$(P,q.startTime-k),H=!1}}break e}finally{i=null,r=de,d=!1}H=void 0}}finally{H?se():R=!1}}}var se;if(typeof w=="function")se=function(){w(Y)};else if(typeof MessageChannel<"u"){var re=new MessageChannel,W=re.port2;re.port1.onmessage=Y,se=function(){W.postMessage(null)}}else se=function(){v(Y,0)};function $(k,H){I=v(function(){k(n.unstable_now())},H)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<k?Math.floor(1e3/k):5},n.unstable_getCurrentPriorityLevel=function(){return r},n.unstable_next=function(k){switch(r){case 1:case 2:case 3:var H=3;break;default:H=r}var de=r;r=H;try{return k()}finally{r=de}},n.unstable_requestPaint=function(){y=!0},n.unstable_runWithPriority=function(k,H){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var de=r;r=k;try{return H()}finally{r=de}},n.unstable_scheduleCallback=function(k,H,de){var ee=n.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?ee+de:ee):de=ee,k){case 1:var ce=-1;break;case 2:ce=250;break;case 5:ce=1073741823;break;case 4:ce=1e4;break;default:ce=5e3}return ce=de+ce,k={id:f++,callback:H,priorityLevel:k,startTime:de,expirationTime:ce,sortIndex:-1},de>ee?(k.sortIndex=de,e(h,k),t(g)===null&&k===t(h)&&(_?(T(I),I=-1):_=!0,$(P,de-ee))):(k.sortIndex=ce,e(g,k),p||d||(p=!0,R||(R=!0,se()))),k},n.unstable_shouldYield=D,n.unstable_wrapCallback=function(k){var H=r;return function(){var de=r;r=H;try{return k.apply(this,arguments)}finally{r=de}}}})(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var reactDom={exports:{}},reactDom_production={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var n=requireReact();function e(g){var h="https://react.dev/errors/"+g;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)h+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+g+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},o=Symbol.for("react.portal");function u(g,h,f){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:i==null?null:""+i,children:g,containerInfo:h,implementation:f}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function m(g,h){if(g==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,reactDom_production.createPortal=function(g,h){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return u(g,h,null,f)},reactDom_production.flushSync=function(g){var h=l.T,f=s.p;try{if(l.T=null,s.p=2,g)return g()}finally{l.T=h,s.p=f,s.d.f()}},reactDom_production.preconnect=function(g,h){typeof g=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,s.d.C(g,h))},reactDom_production.prefetchDNS=function(g){typeof g=="string"&&s.d.D(g)},reactDom_production.preinit=function(g,h){if(typeof g=="string"&&h&&typeof h.as=="string"){var f=h.as,i=m(f,h.crossOrigin),r=typeof h.integrity=="string"?h.integrity:void 0,d=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;f==="style"?s.d.S(g,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:i,integrity:r,fetchPriority:d}):f==="script"&&s.d.X(g,{crossOrigin:i,integrity:r,fetchPriority:d,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},reactDom_production.preinitModule=function(g,h){if(typeof g=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var f=m(h.as,h.crossOrigin);s.d.M(g,{crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&s.d.M(g)},reactDom_production.preload=function(g,h){if(typeof g=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var f=h.as,i=m(f,h.crossOrigin);s.d.L(g,f,{crossOrigin:i,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},reactDom_production.preloadModule=function(g,h){if(typeof g=="string")if(h){var f=m(h.as,h.crossOrigin);s.d.m(g,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else s.d.m(g)},reactDom_production.requestFormReset=function(g){s.d.r(g)},reactDom_production.unstable_batchedUpdates=function(g,h){return g(h)},reactDom_production.useFormState=function(g,h,f){return l.H.useFormState(g,h,f)},reactDom_production.useFormStatus=function(){return l.H.useHostTransitionStatus()},reactDom_production.version="19.2.1",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),reactDom.exports=requireReactDom_production(),reactDom.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var n=requireScheduler(),e=requireReact(),t=requireReactDom();function s(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)c+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function u(a){var c=a,b=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(b=c.return),a=c.return;while(a)}return c.tag===3?b:null}function l(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function m(a){if(a.tag===31){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function g(a){if(u(a)!==a)throw Error(s(188))}function h(a){var c=a.alternate;if(!c){if(c=u(a),c===null)throw Error(s(188));return c!==a?null:a}for(var b=a,x=c;;){var S=b.return;if(S===null)break;var A=S.alternate;if(A===null){if(x=S.return,x!==null){b=x;continue}break}if(S.child===A.child){for(A=S.child;A;){if(A===b)return g(S),a;if(A===x)return g(S),c;A=A.sibling}throw Error(s(188))}if(b.return!==x.return)b=S,x=A;else{for(var F=!1,Q=S.child;Q;){if(Q===b){F=!0,b=S,x=A;break}if(Q===x){F=!0,x=S,b=A;break}Q=Q.sibling}if(!F){for(Q=A.child;Q;){if(Q===b){F=!0,b=A,x=S;break}if(Q===x){F=!0,x=A,b=S;break}Q=Q.sibling}if(!F)throw Error(s(189))}}if(b.alternate!==x)throw Error(s(190))}if(b.tag!==3)throw Error(s(188));return b.stateNode.current===b?a:c}function f(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=f(a),c!==null)return c;a=a.sibling}return null}var i=Object.assign,r=Symbol.for("react.element"),d=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),w=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),Y=Symbol.iterator;function se(a){return a===null||typeof a!="object"?null:(a=Y&&a[Y]||a["@@iterator"],typeof a=="function"?a:null)}var re=Symbol.for("react.client.reference");function W(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===re?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case _:return"Fragment";case v:return"Profiler";case y:return"StrictMode";case P:return"Suspense";case R:return"SuspenseList";case B:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case p:return"Portal";case w:return a.displayName||"Context";case T:return(a._context.displayName||"Context")+".Consumer";case E:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case I:return c=a.displayName||null,c!==null?c:W(a.type)||"Memo";case N:c=a._payload,a=a._init;try{return W(a(c))}catch{}}return null}var $=Array.isArray,k=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,H=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,de={pending:!1,data:null,method:null,action:null},ee=[],ce=-1;function q(a){return{current:a}}function le(a){0>ce||(a.current=ee[ce],ee[ce]=null,ce--)}function be(a,c){ce++,ee[ce]=a.current,a.current=c}var xe=q(null),Ee=q(null),we=q(null),U=q(null);function L(a,c){switch(be(we,c),be(Ee,a),be(xe,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?Yd(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=Yd(c),a=Wd(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}le(xe),be(xe,a)}function M(){le(xe),le(Ee),le(we)}function C(a){a.memoizedState!==null&&be(U,a);var c=xe.current,b=Wd(c,a.type);c!==b&&(be(Ee,a),be(xe,b))}function V(a){Ee.current===a&&(le(xe),le(Ee)),U.current===a&&(le(U),$i._currentValue=de)}var O,z;function j(a){if(O===void 0)try{throw Error()}catch(b){var c=b.stack.trim().match(/\n( *(at )?)/);O=c&&c[1]||"",z=-1<b.stack.indexOf(`
    at`)?" (<anonymous>)":-1<b.stack.indexOf("@")?"@unknown:0:0":""}return`
`+O+a+z}var J=!1;function X(a,c){if(!a||J)return"";J=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(c){var Ue=function(){throw Error()};if(Object.defineProperty(Ue.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ue,[])}catch(Ve){var Me=Ve}Reflect.construct(a,[],Ue)}else{try{Ue.call()}catch(Ve){Me=Ve}a.call(Ue.prototype)}}else{try{throw Error()}catch(Ve){Me=Ve}(Ue=a())&&typeof Ue.catch=="function"&&Ue.catch(function(){})}}catch(Ve){if(Ve&&Me&&typeof Ve.stack=="string")return[Ve.stack,Me.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var S=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");S&&S.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var A=x.DetermineComponentFrameRoot(),F=A[0],Q=A[1];if(F&&Q){var me=F.split(`
`),Ce=Q.split(`
`);for(S=x=0;x<me.length&&!me[x].includes("DetermineComponentFrameRoot");)x++;for(;S<Ce.length&&!Ce[S].includes("DetermineComponentFrameRoot");)S++;if(x===me.length||S===Ce.length)for(x=me.length-1,S=Ce.length-1;1<=x&&0<=S&&me[x]!==Ce[S];)S--;for(;1<=x&&0<=S;x--,S--)if(me[x]!==Ce[S]){if(x!==1||S!==1)do if(x--,S--,0>S||me[x]!==Ce[S]){var Le=`
`+me[x].replace(" at new "," at ");return a.displayName&&Le.includes("<anonymous>")&&(Le=Le.replace("<anonymous>",a.displayName)),Le}while(1<=x&&0<=S);break}}}finally{J=!1,Error.prepareStackTrace=b}return(b=a?a.displayName||a.name:"")?j(b):""}function ne(a,c){switch(a.tag){case 26:case 27:case 5:return j(a.type);case 16:return j("Lazy");case 13:return a.child!==c&&c!==null?j("Suspense Fallback"):j("Suspense");case 19:return j("SuspenseList");case 0:case 15:return X(a.type,!1);case 11:return X(a.type.render,!1);case 1:return X(a.type,!0);case 31:return j("Activity");default:return""}}function ie(a){try{var c="",b=null;do c+=ne(a,b),b=a,a=a.return;while(a);return c}catch(x){return`
Error generating stack: `+x.message+`
`+x.stack}}var fe=Object.prototype.hasOwnProperty,ye=n.unstable_scheduleCallback,pe=n.unstable_cancelCallback,te=n.unstable_shouldYield,ue=n.unstable_requestPaint,Ie=n.unstable_now,ae=n.unstable_getCurrentPriorityLevel,De=n.unstable_ImmediatePriority,ze=n.unstable_UserBlockingPriority,Ge=n.unstable_NormalPriority,He=n.unstable_LowPriority,Ye=n.unstable_IdlePriority,Xe=n.log,it=n.unstable_setDisableYieldValue,ut=null,qe=null;function Je(a){if(typeof Xe=="function"&&it(a),qe&&typeof qe.setStrictMode=="function")try{qe.setStrictMode(ut,a)}catch{}}var Pt=Math.clz32?Math.clz32:nt,zt=Math.log,Gt=Math.LN2;function nt(a){return a>>>=0,a===0?32:31-(zt(a)/Gt|0)|0}var At=256,Mt=262144,$t=4194304;function et(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function rt(a,c,b){var x=a.pendingLanes;if(x===0)return 0;var S=0,A=a.suspendedLanes,F=a.pingedLanes;a=a.warmLanes;var Q=x&134217727;return Q!==0?(x=Q&~A,x!==0?S=et(x):(F&=Q,F!==0?S=et(F):b||(b=Q&~a,b!==0&&(S=et(b))))):(Q=x&~A,Q!==0?S=et(Q):F!==0?S=et(F):b||(b=x&~a,b!==0&&(S=et(b)))),S===0?0:c!==0&&c!==S&&(c&A)===0&&(A=S&-S,b=c&-c,A>=b||A===32&&(b&4194048)!==0)?c:S}function st(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function Jt(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Dt(){var a=$t;return $t<<=1,($t&62914560)===0&&($t=4194304),a}function xn(a){for(var c=[],b=0;31>b;b++)c.push(a);return c}function on(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Tn(a,c,b,x,S,A){var F=a.pendingLanes;a.pendingLanes=b,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=b,a.entangledLanes&=b,a.errorRecoveryDisabledLanes&=b,a.shellSuspendCounter=0;var Q=a.entanglements,me=a.expirationTimes,Ce=a.hiddenUpdates;for(b=F&~b;0<b;){var Le=31-Pt(b),Ue=1<<Le;Q[Le]=0,me[Le]=-1;var Me=Ce[Le];if(Me!==null)for(Ce[Le]=null,Le=0;Le<Me.length;Le++){var Ve=Me[Le];Ve!==null&&(Ve.lane&=-536870913)}b&=~Ue}x!==0&&Vt(a,x,0),A!==0&&S===0&&a.tag!==0&&(a.suspendedLanes|=A&~(F&~c))}function Vt(a,c,b){a.pendingLanes|=c,a.suspendedLanes&=~c;var x=31-Pt(c);a.entangledLanes|=c,a.entanglements[x]=a.entanglements[x]|1073741824|b&261930}function wn(a,c){var b=a.entangledLanes|=c;for(a=a.entanglements;b;){var x=31-Pt(b),S=1<<x;S&c|a[x]&c&&(a[x]|=c),b&=~S}}function Fn(a,c){var b=c&-c;return b=(b&42)!==0?1:gn(b),(b&(a.suspendedLanes|c))!==0?0:b}function gn(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function ir(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Ar(){var a=H.p;return a!==0?a:(a=window.event,a===void 0?32:yh(a.type))}function Cr(a,c){var b=H.p;try{return H.p=a,c()}finally{H.p=b}}var En=Math.random().toString(36).slice(2),Kt="__reactFiber$"+En,Z="__reactProps$"+En,he="__reactContainer$"+En,ve="__reactEvents$"+En,Se="__reactListeners$"+En,Re="__reactHandles$"+En,Oe="__reactResources$"+En,$e="__reactMarker$"+En;function Qe(a){delete a[Kt],delete a[Z],delete a[ve],delete a[Se],delete a[Re]}function We(a){var c=a[Kt];if(c)return c;for(var b=a.parentNode;b;){if(c=b[he]||b[Kt]){if(b=c.alternate,c.child!==null||b!==null&&b.child!==null)for(a=th(a);a!==null;){if(b=a[Kt])return b;a=th(a)}return c}a=b,b=a.parentNode}return null}function ct(a){if(a=a[Kt]||a[he]){var c=a.tag;if(c===5||c===6||c===13||c===31||c===26||c===27||c===3)return a}return null}function Et(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(s(33))}function qt(a){var c=a[Oe];return c||(c=a[Oe]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function _t(a){a[$e]=!0}var ke=new Set,yt={};function Ct(a,c){ln(a,c),ln(a+"Capture",c)}function ln(a,c){for(yt[a]=c,a=0;a<c.length;a++)ke.add(c[a])}var Kn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),bs={},_s={};function Yi(a){return fe.call(_s,a)?!0:fe.call(bs,a)?!1:Kn.test(a)?_s[a]=!0:(bs[a]=!0,!1)}function un(a,c,b){if(Yi(c))if(b===null)a.removeAttribute(c);else{switch(typeof b){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var x=c.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+b)}}function ar(a,c,b){if(b===null)a.removeAttribute(c);else{switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+b)}}function Un(a,c,b,x){if(x===null)a.removeAttribute(b);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(b);return}a.setAttributeNS(c,b,""+x)}}function bn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function ni(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Za(a,c,b){var x=Object.getOwnPropertyDescriptor(a.constructor.prototype,c);if(!a.hasOwnProperty(c)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var S=x.get,A=x.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return S.call(this)},set:function(F){b=""+F,A.call(this,F)}}),Object.defineProperty(a,c,{enumerable:x.enumerable}),{getValue:function(){return b},setValue:function(F){b=""+F},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function ri(a){if(!a._valueTracker){var c=ni(a)?"checked":"value";a._valueTracker=Za(a,c,""+a[c])}}function es(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var b=c.getValue(),x="";return a&&(x=ni(a)?a.checked?"true":"false":a.value),a=x,a!==b?(c.setValue(a),!0):!1}function Mr(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Wi=/[\n"\\]/g;function _n(a){return a.replace(Wi,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function vs(a,c,b,x,S,A,F,Q){a.name="",F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?a.type=F:a.removeAttribute("type"),c!=null?F==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+bn(c)):a.value!==""+bn(c)&&(a.value=""+bn(c)):F!=="submit"&&F!=="reset"||a.removeAttribute("value"),c!=null?Rr(a,F,bn(c)):b!=null?Rr(a,F,bn(b)):x!=null&&a.removeAttribute("value"),S==null&&A!=null&&(a.defaultChecked=!!A),S!=null&&(a.checked=S&&typeof S!="function"&&typeof S!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?a.name=""+bn(Q):a.removeAttribute("name")}function si(a,c,b,x,S,A,F,Q){if(A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(a.type=A),c!=null||b!=null){if(!(A!=="submit"&&A!=="reset"||c!=null)){ri(a);return}b=b!=null?""+bn(b):"",c=c!=null?""+bn(c):b,Q||c===a.value||(a.value=c),a.defaultValue=c}x=x??S,x=typeof x!="function"&&typeof x!="symbol"&&!!x,a.checked=Q?a.checked:!!x,a.defaultChecked=!!x,F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"&&(a.name=F),ri(a)}function Rr(a,c,b){c==="number"&&Mr(a.ownerDocument)===a||a.defaultValue===""+b||(a.defaultValue=""+b)}function or(a,c,b,x){if(a=a.options,c){c={};for(var S=0;S<b.length;S++)c["$"+b[S]]=!0;for(b=0;b<a.length;b++)S=c.hasOwnProperty("$"+a[b].value),a[b].selected!==S&&(a[b].selected=S),S&&x&&(a[b].defaultSelected=!0)}else{for(b=""+bn(b),c=null,S=0;S<a.length;S++){if(a[S].value===b){a[S].selected=!0,x&&(a[S].defaultSelected=!0);return}c!==null||a[S].disabled||(c=a[S])}c!==null&&(c.selected=!0)}}function ii(a,c,b){if(c!=null&&(c=""+bn(c),c!==a.value&&(a.value=c),b==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=b!=null?""+bn(b):""}function xs(a,c,b,x){if(c==null){if(x!=null){if(b!=null)throw Error(s(92));if($(x)){if(1<x.length)throw Error(s(93));x=x[0]}b=x}b==null&&(b=""),c=b}b=bn(c),a.defaultValue=b,x=a.textContent,x===b&&x!==""&&x!==null&&(a.value=x),ri(a)}function lr(a,c){if(c){var b=a.firstChild;if(b&&b===a.lastChild&&b.nodeType===3){b.nodeValue=c;return}}a.textContent=c}var gt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ai(a,c,b){var x=c.indexOf("--")===0;b==null||typeof b=="boolean"||b===""?x?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":x?a.setProperty(c,b):typeof b!="number"||b===0||gt.has(c)?c==="float"?a.cssFloat=b:a[c]=(""+b).trim():a[c]=b+"px"}function ft(a,c,b){if(c!=null&&typeof c!="object")throw Error(s(62));if(a=a.style,b!=null){for(var x in b)!b.hasOwnProperty(x)||c!=null&&c.hasOwnProperty(x)||(x.indexOf("--")===0?a.setProperty(x,""):x==="float"?a.cssFloat="":a[x]="");for(var S in c)x=c[S],c.hasOwnProperty(S)&&b[S]!==x&&ai(a,S,x)}else for(var A in c)c.hasOwnProperty(A)&&ai(a,A,c[A])}function ht(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oi=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ts=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ts(a){return Ts.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function zn(){}var ws=null;function Es(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var ur=null,cr=null;function li(a){var c=ct(a);if(c&&(a=c.stateNode)){var b=a[Z]||null;e:switch(a=c.stateNode,c.type){case"input":if(vs(a,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name),c=b.name,b.type==="radio"&&c!=null){for(b=a;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll('input[name="'+_n(""+c)+'"][type="radio"]'),c=0;c<b.length;c++){var x=b[c];if(x!==a&&x.form===a.form){var S=x[Z]||null;if(!S)throw Error(s(90));vs(x,S.value,S.defaultValue,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name)}}for(c=0;c<b.length;c++)x=b[c],x.form===a.form&&es(x)}break e;case"textarea":ii(a,b.value,b.defaultValue);break e;case"select":c=b.value,c!=null&&or(a,!!b.multiple,c,!1)}}}var Ss=!1;function ui(a,c,b){if(Ss)return a(c,b);Ss=!0;try{var x=a(c);return x}finally{if(Ss=!1,(ur!==null||cr!==null)&&(Ia(),ur&&(c=ur,a=cr,cr=ur=null,li(c),a)))for(c=0;c<a.length;c++)li(a[c])}}function Ir(a,c){var b=a.stateNode;if(b===null)return null;var x=b[Z]||null;if(x===null)return null;b=x[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(a=a.type,x=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!x;break e;default:a=!1}if(a)return null;if(b&&typeof b!="function")throw Error(s(231,c,typeof b));return b}var Gn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ps=!1;if(Gn)try{var G={};Object.defineProperty(G,"passive",{get:function(){Ps=!0}}),window.addEventListener("test",G,G),window.removeEventListener("test",G,G)}catch{Ps=!1}var K=null,oe=null,ge=null;function Pe(){if(ge)return ge;var a,c=oe,b=c.length,x,S="value"in K?K.value:K.textContent,A=S.length;for(a=0;a<b&&c[a]===S[a];a++);var F=b-a;for(x=1;x<=F&&c[b-x]===S[A-x];x++);return ge=S.slice(a,1<x?1-x:void 0)}function Be(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function je(){return!0}function tt(){return!1}function ot(a){function c(b,x,S,A,F){this._reactName=b,this._targetInst=S,this.type=x,this.nativeEvent=A,this.target=F,this.currentTarget=null;for(var Q in a)a.hasOwnProperty(Q)&&(b=a[Q],this[Q]=b?b(A):A[Q]);return this.isDefaultPrevented=(A.defaultPrevented!=null?A.defaultPrevented:A.returnValue===!1)?je:tt,this.isPropagationStopped=tt,this}return i(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=je)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=je)},persist:function(){},isPersistent:je}),c}var dt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jt=ot(dt),yn=i({},dt,{view:0,detail:0}),Sn=ot(yn),Ne,bt,kt,Pn=i({},yn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:to,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==kt&&(kt&&a.type==="mousemove"?(Ne=a.screenX-kt.screenX,bt=a.screenY-kt.screenY):bt=Ne=0,kt=a),Ne)},movementY:function(a){return"movementY"in a?a.movementY:bt}}),dr=ot(Pn),Sh=i({},Pn,{dataTransfer:0}),Ph=ot(Sh),Ah=i({},yn,{relatedTarget:0}),eo=ot(Ah),Ch=i({},dt,{animationName:0,elapsedTime:0,pseudoElement:0}),Mh=ot(Ch),Rh=i({},dt,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Ih=ot(Rh),Bh=i({},dt,{data:0}),Kl=ot(Bh),Vh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Nh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Oh(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=Nh[a])?!!c[a]:!1}function to(){return Oh}var Dh=i({},yn,{key:function(a){if(a.key){var c=Vh[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Be(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?kh[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:to,charCode:function(a){return a.type==="keypress"?Be(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Be(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Lh=ot(Dh),Fh=i({},Pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ql=ot(Fh),Uh=i({},yn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:to}),zh=ot(Uh),Gh=i({},dt,{propertyName:0,elapsedTime:0,pseudoElement:0}),$h=ot(Gh),jh=i({},Pn,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Hh=ot(jh),qh=i({},dt,{newState:0,oldState:0}),Yh=ot(qh),Wh=[9,13,27,32],no=Gn&&"CompositionEvent"in window,ci=null;Gn&&"documentMode"in document&&(ci=document.documentMode);var Xh=Gn&&"TextEvent"in window&&!ci,Zl=Gn&&(!no||ci&&8<ci&&11>=ci),eu=" ",tu=!1;function nu(a,c){switch(a){case"keyup":return Wh.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ru(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var As=!1;function Jh(a,c){switch(a){case"compositionend":return ru(c);case"keypress":return c.which!==32?null:(tu=!0,eu);case"textInput":return a=c.data,a===eu&&tu?null:a;default:return null}}function Kh(a,c){if(As)return a==="compositionend"||!no&&nu(a,c)?(a=Pe(),ge=oe=K=null,As=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Zl&&c.locale!=="ko"?null:c.data;default:return null}}var Qh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function su(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!Qh[a.type]:c==="textarea"}function iu(a,c,b,x){ur?cr?cr.push(x):cr=[x]:ur=x,c=La(c,"onChange"),0<c.length&&(b=new jt("onChange","change",null,b,x),a.push({event:b,listeners:c}))}var di=null,hi=null;function Zh(a){zd(a,0)}function Xi(a){var c=Et(a);if(es(c))return a}function au(a,c){if(a==="change")return c}var ou=!1;if(Gn){var ro;if(Gn){var so="oninput"in document;if(!so){var lu=document.createElement("div");lu.setAttribute("oninput","return;"),so=typeof lu.oninput=="function"}ro=so}else ro=!1;ou=ro&&(!document.documentMode||9<document.documentMode)}function uu(){di&&(di.detachEvent("onpropertychange",cu),hi=di=null)}function cu(a){if(a.propertyName==="value"&&Xi(hi)){var c=[];iu(c,hi,a,Es(a)),ui(Zh,c)}}function ef(a,c,b){a==="focusin"?(uu(),di=c,hi=b,di.attachEvent("onpropertychange",cu)):a==="focusout"&&uu()}function tf(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Xi(hi)}function nf(a,c){if(a==="click")return Xi(c)}function rf(a,c){if(a==="input"||a==="change")return Xi(c)}function sf(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var Bn=typeof Object.is=="function"?Object.is:sf;function fi(a,c){if(Bn(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var b=Object.keys(a),x=Object.keys(c);if(b.length!==x.length)return!1;for(x=0;x<b.length;x++){var S=b[x];if(!fe.call(c,S)||!Bn(a[S],c[S]))return!1}return!0}function du(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function hu(a,c){var b=du(a);a=0;for(var x;b;){if(b.nodeType===3){if(x=a+b.textContent.length,a<=c&&x>=c)return{node:b,offset:c-a};a=x}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=du(b)}}function fu(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?fu(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function pu(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=Mr(a.document);c instanceof a.HTMLIFrameElement;){try{var b=typeof c.contentWindow.location.href=="string"}catch{b=!1}if(b)a=c.contentWindow;else break;c=Mr(a.document)}return c}function io(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var af=Gn&&"documentMode"in document&&11>=document.documentMode,Cs=null,ao=null,pi=null,oo=!1;function mu(a,c,b){var x=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;oo||Cs==null||Cs!==Mr(x)||(x=Cs,"selectionStart"in x&&io(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),pi&&fi(pi,x)||(pi=x,x=La(ao,"onSelect"),0<x.length&&(c=new jt("onSelect","select",null,c,b),a.push({event:c,listeners:x}),c.target=Cs)))}function ns(a,c){var b={};return b[a.toLowerCase()]=c.toLowerCase(),b["Webkit"+a]="webkit"+c,b["Moz"+a]="moz"+c,b}var Ms={animationend:ns("Animation","AnimationEnd"),animationiteration:ns("Animation","AnimationIteration"),animationstart:ns("Animation","AnimationStart"),transitionrun:ns("Transition","TransitionRun"),transitionstart:ns("Transition","TransitionStart"),transitioncancel:ns("Transition","TransitionCancel"),transitionend:ns("Transition","TransitionEnd")},lo={},gu={};Gn&&(gu=document.createElement("div").style,"AnimationEvent"in window||(delete Ms.animationend.animation,delete Ms.animationiteration.animation,delete Ms.animationstart.animation),"TransitionEvent"in window||delete Ms.transitionend.transition);function rs(a){if(lo[a])return lo[a];if(!Ms[a])return a;var c=Ms[a],b;for(b in c)if(c.hasOwnProperty(b)&&b in gu)return lo[a]=c[b];return a}var yu=rs("animationend"),bu=rs("animationiteration"),_u=rs("animationstart"),of=rs("transitionrun"),lf=rs("transitionstart"),uf=rs("transitioncancel"),vu=rs("transitionend"),xu=new Map,uo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");uo.push("scrollEnd");function Qn(a,c){xu.set(a,c),Ct(c,[a])}var Ji=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},$n=[],Rs=0,co=0;function Ki(){for(var a=Rs,c=co=Rs=0;c<a;){var b=$n[c];$n[c++]=null;var x=$n[c];$n[c++]=null;var S=$n[c];$n[c++]=null;var A=$n[c];if($n[c++]=null,x!==null&&S!==null){var F=x.pending;F===null?S.next=S:(S.next=F.next,F.next=S),x.pending=S}A!==0&&Tu(b,S,A)}}function Qi(a,c,b,x){$n[Rs++]=a,$n[Rs++]=c,$n[Rs++]=b,$n[Rs++]=x,co|=x,a.lanes|=x,a=a.alternate,a!==null&&(a.lanes|=x)}function ho(a,c,b,x){return Qi(a,c,b,x),Zi(a)}function ss(a,c){return Qi(a,null,null,c),Zi(a)}function Tu(a,c,b){a.lanes|=b;var x=a.alternate;x!==null&&(x.lanes|=b);for(var S=!1,A=a.return;A!==null;)A.childLanes|=b,x=A.alternate,x!==null&&(x.childLanes|=b),A.tag===22&&(a=A.stateNode,a===null||a._visibility&1||(S=!0)),a=A,A=A.return;return a.tag===3?(A=a.stateNode,S&&c!==null&&(S=31-Pt(b),a=A.hiddenUpdates,x=a[S],x===null?a[S]=[c]:x.push(c),c.lane=b|536870912),A):null}function Zi(a){if(50<Oi)throw Oi=0,xl=null,Error(s(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var Is={};function cf(a,c,b,x){this.tag=a,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vn(a,c,b,x){return new cf(a,c,b,x)}function fo(a){return a=a.prototype,!(!a||!a.isReactComponent)}function hr(a,c){var b=a.alternate;return b===null?(b=Vn(a.tag,c,a.key,a.mode),b.elementType=a.elementType,b.type=a.type,b.stateNode=a.stateNode,b.alternate=a,a.alternate=b):(b.pendingProps=c,b.type=a.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=a.flags&65011712,b.childLanes=a.childLanes,b.lanes=a.lanes,b.child=a.child,b.memoizedProps=a.memoizedProps,b.memoizedState=a.memoizedState,b.updateQueue=a.updateQueue,c=a.dependencies,b.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},b.sibling=a.sibling,b.index=a.index,b.ref=a.ref,b.refCleanup=a.refCleanup,b}function wu(a,c){a.flags&=65011714;var b=a.alternate;return b===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=b.childLanes,a.lanes=b.lanes,a.child=b.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=b.memoizedProps,a.memoizedState=b.memoizedState,a.updateQueue=b.updateQueue,a.type=b.type,c=b.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function ea(a,c,b,x,S,A){var F=0;if(x=a,typeof a=="function")fo(a)&&(F=1);else if(typeof a=="string")F=gp(a,b,xe.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case B:return a=Vn(31,b,c,S),a.elementType=B,a.lanes=A,a;case _:return is(b.children,S,A,c);case y:F=8,S|=24;break;case v:return a=Vn(12,b,c,S|2),a.elementType=v,a.lanes=A,a;case P:return a=Vn(13,b,c,S),a.elementType=P,a.lanes=A,a;case R:return a=Vn(19,b,c,S),a.elementType=R,a.lanes=A,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case w:F=10;break e;case T:F=9;break e;case E:F=11;break e;case I:F=14;break e;case N:F=16,x=null;break e}F=29,b=Error(s(130,a===null?"null":typeof a,"")),x=null}return c=Vn(F,b,c,S),c.elementType=a,c.type=x,c.lanes=A,c}function is(a,c,b,x){return a=Vn(7,a,x,c),a.lanes=b,a}function po(a,c,b){return a=Vn(6,a,null,c),a.lanes=b,a}function Eu(a){var c=Vn(18,null,null,0);return c.stateNode=a,c}function mo(a,c,b){return c=Vn(4,a.children!==null?a.children:[],a.key,c),c.lanes=b,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var Su=new WeakMap;function jn(a,c){if(typeof a=="object"&&a!==null){var b=Su.get(a);return b!==void 0?b:(c={value:a,source:c,stack:ie(c)},Su.set(a,c),c)}return{value:a,source:c,stack:ie(c)}}var Bs=[],Vs=0,ta=null,mi=0,Hn=[],qn=0,Br=null,tr=1,nr="";function fr(a,c){Bs[Vs++]=mi,Bs[Vs++]=ta,ta=a,mi=c}function Pu(a,c,b){Hn[qn++]=tr,Hn[qn++]=nr,Hn[qn++]=Br,Br=a;var x=tr;a=nr;var S=32-Pt(x)-1;x&=~(1<<S),b+=1;var A=32-Pt(c)+S;if(30<A){var F=S-S%5;A=(x&(1<<F)-1).toString(32),x>>=F,S-=F,tr=1<<32-Pt(c)+S|b<<S|x,nr=A+a}else tr=1<<A|b<<S|x,nr=a}function go(a){a.return!==null&&(fr(a,1),Pu(a,1,0))}function yo(a){for(;a===ta;)ta=Bs[--Vs],Bs[Vs]=null,mi=Bs[--Vs],Bs[Vs]=null;for(;a===Br;)Br=Hn[--qn],Hn[qn]=null,nr=Hn[--qn],Hn[qn]=null,tr=Hn[--qn],Hn[qn]=null}function Au(a,c){Hn[qn++]=tr,Hn[qn++]=nr,Hn[qn++]=Br,tr=c.id,nr=c.overflow,Br=a}var hn=null,Yt=null,St=!1,Vr=null,Yn=!1,bo=Error(s(519));function kr(a){var c=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw gi(jn(c,a)),bo}function Cu(a){var c=a.stateNode,b=a.type,x=a.memoizedProps;switch(c[Kt]=a,c[Z]=x,b){case"dialog":xt("cancel",c),xt("close",c);break;case"iframe":case"object":case"embed":xt("load",c);break;case"video":case"audio":for(b=0;b<Li.length;b++)xt(Li[b],c);break;case"source":xt("error",c);break;case"img":case"image":case"link":xt("error",c),xt("load",c);break;case"details":xt("toggle",c);break;case"input":xt("invalid",c),si(c,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0);break;case"select":xt("invalid",c);break;case"textarea":xt("invalid",c),xs(c,x.value,x.defaultValue,x.children)}b=x.children,typeof b!="string"&&typeof b!="number"&&typeof b!="bigint"||c.textContent===""+b||x.suppressHydrationWarning===!0||Hd(c.textContent,b)?(x.popover!=null&&(xt("beforetoggle",c),xt("toggle",c)),x.onScroll!=null&&xt("scroll",c),x.onScrollEnd!=null&&xt("scrollend",c),x.onClick!=null&&(c.onclick=zn),c=!0):c=!1,c||kr(a,!0)}function Mu(a){for(hn=a.return;hn;)switch(hn.tag){case 5:case 31:case 13:Yn=!1;return;case 27:case 3:Yn=!0;return;default:hn=hn.return}}function ks(a){if(a!==hn)return!1;if(!St)return Mu(a),St=!0,!1;var c=a.tag,b;if((b=c!==3&&c!==27)&&((b=c===5)&&(b=a.type,b=!(b!=="form"&&b!=="button")||Ol(a.type,a.memoizedProps)),b=!b),b&&Yt&&kr(a),Mu(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));Yt=eh(a)}else if(c===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));Yt=eh(a)}else c===27?(c=Yt,Wr(a.type)?(a=zl,zl=null,Yt=a):Yt=c):Yt=hn?Xn(a.stateNode.nextSibling):null;return!0}function as(){Yt=hn=null,St=!1}function _o(){var a=Vr;return a!==null&&(Rn===null?Rn=a:Rn.push.apply(Rn,a),Vr=null),a}function gi(a){Vr===null?Vr=[a]:Vr.push(a)}var vo=q(null),os=null,pr=null;function Nr(a,c,b){be(vo,c._currentValue),c._currentValue=b}function mr(a){a._currentValue=vo.current,le(vo)}function xo(a,c,b){for(;a!==null;){var x=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,x!==null&&(x.childLanes|=c)):x!==null&&(x.childLanes&c)!==c&&(x.childLanes|=c),a===b)break;a=a.return}}function To(a,c,b,x){var S=a.child;for(S!==null&&(S.return=a);S!==null;){var A=S.dependencies;if(A!==null){var F=S.child;A=A.firstContext;e:for(;A!==null;){var Q=A;A=S;for(var me=0;me<c.length;me++)if(Q.context===c[me]){A.lanes|=b,Q=A.alternate,Q!==null&&(Q.lanes|=b),xo(A.return,b,a),x||(F=null);break e}A=Q.next}}else if(S.tag===18){if(F=S.return,F===null)throw Error(s(341));F.lanes|=b,A=F.alternate,A!==null&&(A.lanes|=b),xo(F,b,a),F=null}else F=S.child;if(F!==null)F.return=S;else for(F=S;F!==null;){if(F===a){F=null;break}if(S=F.sibling,S!==null){S.return=F.return,F=S;break}F=F.return}S=F}}function Ns(a,c,b,x){a=null;for(var S=c,A=!1;S!==null;){if(!A){if((S.flags&524288)!==0)A=!0;else if((S.flags&262144)!==0)break}if(S.tag===10){var F=S.alternate;if(F===null)throw Error(s(387));if(F=F.memoizedProps,F!==null){var Q=S.type;Bn(S.pendingProps.value,F.value)||(a!==null?a.push(Q):a=[Q])}}else if(S===U.current){if(F=S.alternate,F===null)throw Error(s(387));F.memoizedState.memoizedState!==S.memoizedState.memoizedState&&(a!==null?a.push($i):a=[$i])}S=S.return}a!==null&&To(c,a,b,x),c.flags|=262144}function na(a){for(a=a.firstContext;a!==null;){if(!Bn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function ls(a){os=a,pr=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function fn(a){return Ru(os,a)}function ra(a,c){return os===null&&ls(a),Ru(a,c)}function Ru(a,c){var b=c._currentValue;if(c={context:c,memoizedValue:b,next:null},pr===null){if(a===null)throw Error(s(308));pr=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else pr=pr.next=c;return b}var df=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(b,x){a.push(x)}};this.abort=function(){c.aborted=!0,a.forEach(function(b){return b()})}},hf=n.unstable_scheduleCallback,ff=n.unstable_NormalPriority,nn={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function wo(){return{controller:new df,data:new Map,refCount:0}}function yi(a){a.refCount--,a.refCount===0&&hf(ff,function(){a.controller.abort()})}var bi=null,Eo=0,Os=0,Ds=null;function pf(a,c){if(bi===null){var b=bi=[];Eo=0,Os=Al(),Ds={status:"pending",value:void 0,then:function(x){b.push(x)}}}return Eo++,c.then(Iu,Iu),c}function Iu(){if(--Eo===0&&bi!==null){Ds!==null&&(Ds.status="fulfilled");var a=bi;bi=null,Os=0,Ds=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function mf(a,c){var b=[],x={status:"pending",value:null,reason:null,then:function(S){b.push(S)}};return a.then(function(){x.status="fulfilled",x.value=c;for(var S=0;S<b.length;S++)(0,b[S])(c)},function(S){for(x.status="rejected",x.reason=S,S=0;S<b.length;S++)(0,b[S])(void 0)}),x}var Bu=k.S;k.S=function(a,c){md=Ie(),typeof c=="object"&&c!==null&&typeof c.then=="function"&&pf(a,c),Bu!==null&&Bu(a,c)};var us=q(null);function So(){var a=us.current;return a!==null?a:Ht.pooledCache}function sa(a,c){c===null?be(us,us.current):be(us,c.pool)}function Vu(){var a=So();return a===null?null:{parent:nn._currentValue,pool:a}}var Ls=Error(s(460)),Po=Error(s(474)),ia=Error(s(542)),aa={then:function(){}};function ku(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Nu(a,c,b){switch(b=a[b],b===void 0?a.push(c):b!==c&&(c.then(zn,zn),c=b),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,Du(a),a;default:if(typeof c.status=="string")c.then(zn,zn);else{if(a=Ht,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=c,a.status="pending",a.then(function(x){if(c.status==="pending"){var S=c;S.status="fulfilled",S.value=x}},function(x){if(c.status==="pending"){var S=c;S.status="rejected",S.reason=x}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,Du(a),a}throw ds=c,Ls}}function cs(a){try{var c=a._init;return c(a._payload)}catch(b){throw b!==null&&typeof b=="object"&&typeof b.then=="function"?(ds=b,Ls):b}}var ds=null;function Ou(){if(ds===null)throw Error(s(459));var a=ds;return ds=null,a}function Du(a){if(a===Ls||a===ia)throw Error(s(483))}var Fs=null,_i=0;function oa(a){var c=_i;return _i+=1,Fs===null&&(Fs=[]),Nu(Fs,a,c)}function vi(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function la(a,c){throw c.$$typeof===r?Error(s(525)):(a=Object.prototype.toString.call(c),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function Lu(a){function c(Te,_e){if(a){var Ae=Te.deletions;Ae===null?(Te.deletions=[_e],Te.flags|=16):Ae.push(_e)}}function b(Te,_e){if(!a)return null;for(;_e!==null;)c(Te,_e),_e=_e.sibling;return null}function x(Te){for(var _e=new Map;Te!==null;)Te.key!==null?_e.set(Te.key,Te):_e.set(Te.index,Te),Te=Te.sibling;return _e}function S(Te,_e){return Te=hr(Te,_e),Te.index=0,Te.sibling=null,Te}function A(Te,_e,Ae){return Te.index=Ae,a?(Ae=Te.alternate,Ae!==null?(Ae=Ae.index,Ae<_e?(Te.flags|=67108866,_e):Ae):(Te.flags|=67108866,_e)):(Te.flags|=1048576,_e)}function F(Te){return a&&Te.alternate===null&&(Te.flags|=67108866),Te}function Q(Te,_e,Ae,Fe){return _e===null||_e.tag!==6?(_e=po(Ae,Te.mode,Fe),_e.return=Te,_e):(_e=S(_e,Ae),_e.return=Te,_e)}function me(Te,_e,Ae,Fe){var at=Ae.type;return at===_?Le(Te,_e,Ae.props.children,Fe,Ae.key):_e!==null&&(_e.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===N&&cs(at)===_e.type)?(_e=S(_e,Ae.props),vi(_e,Ae),_e.return=Te,_e):(_e=ea(Ae.type,Ae.key,Ae.props,null,Te.mode,Fe),vi(_e,Ae),_e.return=Te,_e)}function Ce(Te,_e,Ae,Fe){return _e===null||_e.tag!==4||_e.stateNode.containerInfo!==Ae.containerInfo||_e.stateNode.implementation!==Ae.implementation?(_e=mo(Ae,Te.mode,Fe),_e.return=Te,_e):(_e=S(_e,Ae.children||[]),_e.return=Te,_e)}function Le(Te,_e,Ae,Fe,at){return _e===null||_e.tag!==7?(_e=is(Ae,Te.mode,Fe,at),_e.return=Te,_e):(_e=S(_e,Ae),_e.return=Te,_e)}function Ue(Te,_e,Ae){if(typeof _e=="string"&&_e!==""||typeof _e=="number"||typeof _e=="bigint")return _e=po(""+_e,Te.mode,Ae),_e.return=Te,_e;if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case d:return Ae=ea(_e.type,_e.key,_e.props,null,Te.mode,Ae),vi(Ae,_e),Ae.return=Te,Ae;case p:return _e=mo(_e,Te.mode,Ae),_e.return=Te,_e;case N:return _e=cs(_e),Ue(Te,_e,Ae)}if($(_e)||se(_e))return _e=is(_e,Te.mode,Ae,null),_e.return=Te,_e;if(typeof _e.then=="function")return Ue(Te,oa(_e),Ae);if(_e.$$typeof===w)return Ue(Te,ra(Te,_e),Ae);la(Te,_e)}return null}function Me(Te,_e,Ae,Fe){var at=_e!==null?_e.key:null;if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return at!==null?null:Q(Te,_e,""+Ae,Fe);if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case d:return Ae.key===at?me(Te,_e,Ae,Fe):null;case p:return Ae.key===at?Ce(Te,_e,Ae,Fe):null;case N:return Ae=cs(Ae),Me(Te,_e,Ae,Fe)}if($(Ae)||se(Ae))return at!==null?null:Le(Te,_e,Ae,Fe,null);if(typeof Ae.then=="function")return Me(Te,_e,oa(Ae),Fe);if(Ae.$$typeof===w)return Me(Te,_e,ra(Te,Ae),Fe);la(Te,Ae)}return null}function Ve(Te,_e,Ae,Fe,at){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number"||typeof Fe=="bigint")return Te=Te.get(Ae)||null,Q(_e,Te,""+Fe,at);if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case d:return Te=Te.get(Fe.key===null?Ae:Fe.key)||null,me(_e,Te,Fe,at);case p:return Te=Te.get(Fe.key===null?Ae:Fe.key)||null,Ce(_e,Te,Fe,at);case N:return Fe=cs(Fe),Ve(Te,_e,Ae,Fe,at)}if($(Fe)||se(Fe))return Te=Te.get(Ae)||null,Le(_e,Te,Fe,at,null);if(typeof Fe.then=="function")return Ve(Te,_e,Ae,oa(Fe),at);if(Fe.$$typeof===w)return Ve(Te,_e,Ae,ra(_e,Fe),at);la(_e,Fe)}return null}function Ke(Te,_e,Ae,Fe){for(var at=null,Rt=null,Ze=_e,mt=_e=0,wt=null;Ze!==null&&mt<Ae.length;mt++){Ze.index>mt?(wt=Ze,Ze=null):wt=Ze.sibling;var It=Me(Te,Ze,Ae[mt],Fe);if(It===null){Ze===null&&(Ze=wt);break}a&&Ze&&It.alternate===null&&c(Te,Ze),_e=A(It,_e,mt),Rt===null?at=It:Rt.sibling=It,Rt=It,Ze=wt}if(mt===Ae.length)return b(Te,Ze),St&&fr(Te,mt),at;if(Ze===null){for(;mt<Ae.length;mt++)Ze=Ue(Te,Ae[mt],Fe),Ze!==null&&(_e=A(Ze,_e,mt),Rt===null?at=Ze:Rt.sibling=Ze,Rt=Ze);return St&&fr(Te,mt),at}for(Ze=x(Ze);mt<Ae.length;mt++)wt=Ve(Ze,Te,mt,Ae[mt],Fe),wt!==null&&(a&&wt.alternate!==null&&Ze.delete(wt.key===null?mt:wt.key),_e=A(wt,_e,mt),Rt===null?at=wt:Rt.sibling=wt,Rt=wt);return a&&Ze.forEach(function(Zr){return c(Te,Zr)}),St&&fr(Te,mt),at}function lt(Te,_e,Ae,Fe){if(Ae==null)throw Error(s(151));for(var at=null,Rt=null,Ze=_e,mt=_e=0,wt=null,It=Ae.next();Ze!==null&&!It.done;mt++,It=Ae.next()){Ze.index>mt?(wt=Ze,Ze=null):wt=Ze.sibling;var Zr=Me(Te,Ze,It.value,Fe);if(Zr===null){Ze===null&&(Ze=wt);break}a&&Ze&&Zr.alternate===null&&c(Te,Ze),_e=A(Zr,_e,mt),Rt===null?at=Zr:Rt.sibling=Zr,Rt=Zr,Ze=wt}if(It.done)return b(Te,Ze),St&&fr(Te,mt),at;if(Ze===null){for(;!It.done;mt++,It=Ae.next())It=Ue(Te,It.value,Fe),It!==null&&(_e=A(It,_e,mt),Rt===null?at=It:Rt.sibling=It,Rt=It);return St&&fr(Te,mt),at}for(Ze=x(Ze);!It.done;mt++,It=Ae.next())It=Ve(Ze,Te,mt,It.value,Fe),It!==null&&(a&&It.alternate!==null&&Ze.delete(It.key===null?mt:It.key),_e=A(It,_e,mt),Rt===null?at=It:Rt.sibling=It,Rt=It);return a&&Ze.forEach(function(Ap){return c(Te,Ap)}),St&&fr(Te,mt),at}function Ut(Te,_e,Ae,Fe){if(typeof Ae=="object"&&Ae!==null&&Ae.type===_&&Ae.key===null&&(Ae=Ae.props.children),typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case d:e:{for(var at=Ae.key;_e!==null;){if(_e.key===at){if(at=Ae.type,at===_){if(_e.tag===7){b(Te,_e.sibling),Fe=S(_e,Ae.props.children),Fe.return=Te,Te=Fe;break e}}else if(_e.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===N&&cs(at)===_e.type){b(Te,_e.sibling),Fe=S(_e,Ae.props),vi(Fe,Ae),Fe.return=Te,Te=Fe;break e}b(Te,_e);break}else c(Te,_e);_e=_e.sibling}Ae.type===_?(Fe=is(Ae.props.children,Te.mode,Fe,Ae.key),Fe.return=Te,Te=Fe):(Fe=ea(Ae.type,Ae.key,Ae.props,null,Te.mode,Fe),vi(Fe,Ae),Fe.return=Te,Te=Fe)}return F(Te);case p:e:{for(at=Ae.key;_e!==null;){if(_e.key===at)if(_e.tag===4&&_e.stateNode.containerInfo===Ae.containerInfo&&_e.stateNode.implementation===Ae.implementation){b(Te,_e.sibling),Fe=S(_e,Ae.children||[]),Fe.return=Te,Te=Fe;break e}else{b(Te,_e);break}else c(Te,_e);_e=_e.sibling}Fe=mo(Ae,Te.mode,Fe),Fe.return=Te,Te=Fe}return F(Te);case N:return Ae=cs(Ae),Ut(Te,_e,Ae,Fe)}if($(Ae))return Ke(Te,_e,Ae,Fe);if(se(Ae)){if(at=se(Ae),typeof at!="function")throw Error(s(150));return Ae=at.call(Ae),lt(Te,_e,Ae,Fe)}if(typeof Ae.then=="function")return Ut(Te,_e,oa(Ae),Fe);if(Ae.$$typeof===w)return Ut(Te,_e,ra(Te,Ae),Fe);la(Te,Ae)}return typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint"?(Ae=""+Ae,_e!==null&&_e.tag===6?(b(Te,_e.sibling),Fe=S(_e,Ae),Fe.return=Te,Te=Fe):(b(Te,_e),Fe=po(Ae,Te.mode,Fe),Fe.return=Te,Te=Fe),F(Te)):b(Te,_e)}return function(Te,_e,Ae,Fe){try{_i=0;var at=Ut(Te,_e,Ae,Fe);return Fs=null,at}catch(Ze){if(Ze===Ls||Ze===ia)throw Ze;var Rt=Vn(29,Ze,null,Te.mode);return Rt.lanes=Fe,Rt.return=Te,Rt}finally{}}}var hs=Lu(!0),Fu=Lu(!1),Or=!1;function Ao(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Co(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Dr(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Lr(a,c,b){var x=a.updateQueue;if(x===null)return null;if(x=x.shared,(Bt&2)!==0){var S=x.pending;return S===null?c.next=c:(c.next=S.next,S.next=c),x.pending=c,c=Zi(a),Tu(a,null,b),c}return Qi(a,x,c,b),Zi(a)}function xi(a,c,b){if(c=c.updateQueue,c!==null&&(c=c.shared,(b&4194048)!==0)){var x=c.lanes;x&=a.pendingLanes,b|=x,c.lanes=b,wn(a,b)}}function Mo(a,c){var b=a.updateQueue,x=a.alternate;if(x!==null&&(x=x.updateQueue,b===x)){var S=null,A=null;if(b=b.firstBaseUpdate,b!==null){do{var F={lane:b.lane,tag:b.tag,payload:b.payload,callback:null,next:null};A===null?S=A=F:A=A.next=F,b=b.next}while(b!==null);A===null?S=A=c:A=A.next=c}else S=A=c;b={baseState:x.baseState,firstBaseUpdate:S,lastBaseUpdate:A,shared:x.shared,callbacks:x.callbacks},a.updateQueue=b;return}a=b.lastBaseUpdate,a===null?b.firstBaseUpdate=c:a.next=c,b.lastBaseUpdate=c}var Ro=!1;function Ti(){if(Ro){var a=Ds;if(a!==null)throw a}}function wi(a,c,b,x){Ro=!1;var S=a.updateQueue;Or=!1;var A=S.firstBaseUpdate,F=S.lastBaseUpdate,Q=S.shared.pending;if(Q!==null){S.shared.pending=null;var me=Q,Ce=me.next;me.next=null,F===null?A=Ce:F.next=Ce,F=me;var Le=a.alternate;Le!==null&&(Le=Le.updateQueue,Q=Le.lastBaseUpdate,Q!==F&&(Q===null?Le.firstBaseUpdate=Ce:Q.next=Ce,Le.lastBaseUpdate=me))}if(A!==null){var Ue=S.baseState;F=0,Le=Ce=me=null,Q=A;do{var Me=Q.lane&-536870913,Ve=Me!==Q.lane;if(Ve?(Tt&Me)===Me:(x&Me)===Me){Me!==0&&Me===Os&&(Ro=!0),Le!==null&&(Le=Le.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var Ke=a,lt=Q;Me=c;var Ut=b;switch(lt.tag){case 1:if(Ke=lt.payload,typeof Ke=="function"){Ue=Ke.call(Ut,Ue,Me);break e}Ue=Ke;break e;case 3:Ke.flags=Ke.flags&-65537|128;case 0:if(Ke=lt.payload,Me=typeof Ke=="function"?Ke.call(Ut,Ue,Me):Ke,Me==null)break e;Ue=i({},Ue,Me);break e;case 2:Or=!0}}Me=Q.callback,Me!==null&&(a.flags|=64,Ve&&(a.flags|=8192),Ve=S.callbacks,Ve===null?S.callbacks=[Me]:Ve.push(Me))}else Ve={lane:Me,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Le===null?(Ce=Le=Ve,me=Ue):Le=Le.next=Ve,F|=Me;if(Q=Q.next,Q===null){if(Q=S.shared.pending,Q===null)break;Ve=Q,Q=Ve.next,Ve.next=null,S.lastBaseUpdate=Ve,S.shared.pending=null}}while(!0);Le===null&&(me=Ue),S.baseState=me,S.firstBaseUpdate=Ce,S.lastBaseUpdate=Le,A===null&&(S.shared.lanes=0),$r|=F,a.lanes=F,a.memoizedState=Ue}}function Uu(a,c){if(typeof a!="function")throw Error(s(191,a));a.call(c)}function zu(a,c){var b=a.callbacks;if(b!==null)for(a.callbacks=null,a=0;a<b.length;a++)Uu(b[a],c)}var Us=q(null),ua=q(0);function Gu(a,c){a=Er,be(ua,a),be(Us,c),Er=a|c.baseLanes}function Io(){be(ua,Er),be(Us,Us.current)}function Bo(){Er=ua.current,le(Us),le(ua)}var kn=q(null),Wn=null;function Fr(a){var c=a.alternate;be(en,en.current&1),be(kn,a),Wn===null&&(c===null||Us.current!==null||c.memoizedState!==null)&&(Wn=a)}function Vo(a){be(en,en.current),be(kn,a),Wn===null&&(Wn=a)}function $u(a){a.tag===22?(be(en,en.current),be(kn,a),Wn===null&&(Wn=a)):Ur()}function Ur(){be(en,en.current),be(kn,kn.current)}function Nn(a){le(kn),Wn===a&&(Wn=null),le(en)}var en=q(0);function ca(a){for(var c=a;c!==null;){if(c.tag===13){var b=c.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||Fl(b)||Ul(b)))return c}else if(c.tag===19&&(c.memoizedProps.revealOrder==="forwards"||c.memoizedProps.revealOrder==="backwards"||c.memoizedProps.revealOrder==="unstable_legacy-backwards"||c.memoizedProps.revealOrder==="together")){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var gr=0,pt=null,Lt=null,rn=null,da=!1,zs=!1,fs=!1,ha=0,Ei=0,Gs=null,gf=0;function Qt(){throw Error(s(321))}function ko(a,c){if(c===null)return!1;for(var b=0;b<c.length&&b<a.length;b++)if(!Bn(a[b],c[b]))return!1;return!0}function No(a,c,b,x,S,A){return gr=A,pt=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,k.H=a===null||a.memoizedState===null?Pc:Jo,fs=!1,A=b(x,S),fs=!1,zs&&(A=Hu(c,b,x,S)),ju(a),A}function ju(a){k.H=Ai;var c=Lt!==null&&Lt.next!==null;if(gr=0,rn=Lt=pt=null,da=!1,Ei=0,Gs=null,c)throw Error(s(300));a===null||sn||(a=a.dependencies,a!==null&&na(a)&&(sn=!0))}function Hu(a,c,b,x){pt=a;var S=0;do{if(zs&&(Gs=null),Ei=0,zs=!1,25<=S)throw Error(s(301));if(S+=1,rn=Lt=null,a.updateQueue!=null){var A=a.updateQueue;A.lastEffect=null,A.events=null,A.stores=null,A.memoCache!=null&&(A.memoCache.index=0)}k.H=Ac,A=c(b,x)}while(zs);return A}function yf(){var a=k.H,c=a.useState()[0];return c=typeof c.then=="function"?Si(c):c,a=a.useState()[0],(Lt!==null?Lt.memoizedState:null)!==a&&(pt.flags|=1024),c}function Oo(){var a=ha!==0;return ha=0,a}function Do(a,c,b){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~b}function Lo(a){if(da){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}da=!1}gr=0,rn=Lt=pt=null,zs=!1,Ei=ha=0,Gs=null}function vn(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rn===null?pt.memoizedState=rn=a:rn=rn.next=a,rn}function tn(){if(Lt===null){var a=pt.alternate;a=a!==null?a.memoizedState:null}else a=Lt.next;var c=rn===null?pt.memoizedState:rn.next;if(c!==null)rn=c,Lt=a;else{if(a===null)throw pt.alternate===null?Error(s(467)):Error(s(310));Lt=a,a={memoizedState:Lt.memoizedState,baseState:Lt.baseState,baseQueue:Lt.baseQueue,queue:Lt.queue,next:null},rn===null?pt.memoizedState=rn=a:rn=rn.next=a}return rn}function fa(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Si(a){var c=Ei;return Ei+=1,Gs===null&&(Gs=[]),a=Nu(Gs,a,c),c=pt,(rn===null?c.memoizedState:rn.next)===null&&(c=c.alternate,k.H=c===null||c.memoizedState===null?Pc:Jo),a}function pa(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Si(a);if(a.$$typeof===w)return fn(a)}throw Error(s(438,String(a)))}function Fo(a){var c=null,b=pt.updateQueue;if(b!==null&&(c=b.memoCache),c==null){var x=pt.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(c={data:x.data.map(function(S){return S.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),b===null&&(b=fa(),pt.updateQueue=b),b.memoCache=c,b=c.data[c.index],b===void 0)for(b=c.data[c.index]=Array(a),x=0;x<a;x++)b[x]=D;return c.index++,b}function yr(a,c){return typeof c=="function"?c(a):c}function ma(a){var c=tn();return Uo(c,Lt,a)}function Uo(a,c,b){var x=a.queue;if(x===null)throw Error(s(311));x.lastRenderedReducer=b;var S=a.baseQueue,A=x.pending;if(A!==null){if(S!==null){var F=S.next;S.next=A.next,A.next=F}c.baseQueue=S=A,x.pending=null}if(A=a.baseState,S===null)a.memoizedState=A;else{c=S.next;var Q=F=null,me=null,Ce=c,Le=!1;do{var Ue=Ce.lane&-536870913;if(Ue!==Ce.lane?(Tt&Ue)===Ue:(gr&Ue)===Ue){var Me=Ce.revertLane;if(Me===0)me!==null&&(me=me.next={lane:0,revertLane:0,gesture:null,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null}),Ue===Os&&(Le=!0);else if((gr&Me)===Me){Ce=Ce.next,Me===Os&&(Le=!0);continue}else Ue={lane:0,revertLane:Ce.revertLane,gesture:null,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null},me===null?(Q=me=Ue,F=A):me=me.next=Ue,pt.lanes|=Me,$r|=Me;Ue=Ce.action,fs&&b(A,Ue),A=Ce.hasEagerState?Ce.eagerState:b(A,Ue)}else Me={lane:Ue,revertLane:Ce.revertLane,gesture:Ce.gesture,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null},me===null?(Q=me=Me,F=A):me=me.next=Me,pt.lanes|=Ue,$r|=Ue;Ce=Ce.next}while(Ce!==null&&Ce!==c);if(me===null?F=A:me.next=Q,!Bn(A,a.memoizedState)&&(sn=!0,Le&&(b=Ds,b!==null)))throw b;a.memoizedState=A,a.baseState=F,a.baseQueue=me,x.lastRenderedState=A}return S===null&&(x.lanes=0),[a.memoizedState,x.dispatch]}function zo(a){var c=tn(),b=c.queue;if(b===null)throw Error(s(311));b.lastRenderedReducer=a;var x=b.dispatch,S=b.pending,A=c.memoizedState;if(S!==null){b.pending=null;var F=S=S.next;do A=a(A,F.action),F=F.next;while(F!==S);Bn(A,c.memoizedState)||(sn=!0),c.memoizedState=A,c.baseQueue===null&&(c.baseState=A),b.lastRenderedState=A}return[A,x]}function qu(a,c,b){var x=pt,S=tn(),A=St;if(A){if(b===void 0)throw Error(s(407));b=b()}else b=c();var F=!Bn((Lt||S).memoizedState,b);if(F&&(S.memoizedState=b,sn=!0),S=S.queue,jo(Xu.bind(null,x,S,a),[a]),S.getSnapshot!==c||F||rn!==null&&rn.memoizedState.tag&1){if(x.flags|=2048,$s(9,{destroy:void 0},Wu.bind(null,x,S,b,c),null),Ht===null)throw Error(s(349));A||(gr&127)!==0||Yu(x,c,b)}return b}function Yu(a,c,b){a.flags|=16384,a={getSnapshot:c,value:b},c=pt.updateQueue,c===null?(c=fa(),pt.updateQueue=c,c.stores=[a]):(b=c.stores,b===null?c.stores=[a]:b.push(a))}function Wu(a,c,b,x){c.value=b,c.getSnapshot=x,Ju(c)&&Ku(a)}function Xu(a,c,b){return b(function(){Ju(c)&&Ku(a)})}function Ju(a){var c=a.getSnapshot;a=a.value;try{var b=c();return!Bn(a,b)}catch{return!0}}function Ku(a){var c=ss(a,2);c!==null&&In(c,a,2)}function Go(a){var c=vn();if(typeof a=="function"){var b=a;if(a=b(),fs){Je(!0);try{b()}finally{Je(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:yr,lastRenderedState:a},c}function Qu(a,c,b,x){return a.baseState=b,Uo(a,Lt,typeof x=="function"?x:yr)}function bf(a,c,b,x,S){if(ba(a))throw Error(s(485));if(a=c.action,a!==null){var A={payload:S,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(F){A.listeners.push(F)}};k.T!==null?b(!0):A.isTransition=!1,x(A),b=c.pending,b===null?(A.next=c.pending=A,Zu(c,A)):(A.next=b.next,c.pending=b.next=A)}}function Zu(a,c){var b=c.action,x=c.payload,S=a.state;if(c.isTransition){var A=k.T,F={};k.T=F;try{var Q=b(S,x),me=k.S;me!==null&&me(F,Q),ec(a,c,Q)}catch(Ce){$o(a,c,Ce)}finally{A!==null&&F.types!==null&&(A.types=F.types),k.T=A}}else try{A=b(S,x),ec(a,c,A)}catch(Ce){$o(a,c,Ce)}}function ec(a,c,b){b!==null&&typeof b=="object"&&typeof b.then=="function"?b.then(function(x){tc(a,c,x)},function(x){return $o(a,c,x)}):tc(a,c,b)}function tc(a,c,b){c.status="fulfilled",c.value=b,nc(c),a.state=b,c=a.pending,c!==null&&(b=c.next,b===c?a.pending=null:(b=b.next,c.next=b,Zu(a,b)))}function $o(a,c,b){var x=a.pending;if(a.pending=null,x!==null){x=x.next;do c.status="rejected",c.reason=b,nc(c),c=c.next;while(c!==x)}a.action=null}function nc(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function rc(a,c){return c}function sc(a,c){if(St){var b=Ht.formState;if(b!==null){e:{var x=pt;if(St){if(Yt){t:{for(var S=Yt,A=Yn;S.nodeType!==8;){if(!A){S=null;break t}if(S=Xn(S.nextSibling),S===null){S=null;break t}}A=S.data,S=A==="F!"||A==="F"?S:null}if(S){Yt=Xn(S.nextSibling),x=S.data==="F!";break e}}kr(x)}x=!1}x&&(c=b[0])}}return b=vn(),b.memoizedState=b.baseState=c,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:rc,lastRenderedState:c},b.queue=x,b=wc.bind(null,pt,x),x.dispatch=b,x=Go(!1),A=Xo.bind(null,pt,!1,x.queue),x=vn(),S={state:c,dispatch:null,action:a,pending:null},x.queue=S,b=bf.bind(null,pt,S,A,b),S.dispatch=b,x.memoizedState=a,[c,b,!1]}function ic(a){var c=tn();return ac(c,Lt,a)}function ac(a,c,b){if(c=Uo(a,c,rc)[0],a=ma(yr)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var x=Si(c)}catch(F){throw F===Ls?ia:F}else x=c;c=tn();var S=c.queue,A=S.dispatch;return b!==c.memoizedState&&(pt.flags|=2048,$s(9,{destroy:void 0},_f.bind(null,S,b),null)),[x,A,a]}function _f(a,c){a.action=c}function oc(a){var c=tn(),b=Lt;if(b!==null)return ac(c,b,a);tn(),c=c.memoizedState,b=tn();var x=b.queue.dispatch;return b.memoizedState=a,[c,x,!1]}function $s(a,c,b,x){return a={tag:a,create:b,deps:x,inst:c,next:null},c=pt.updateQueue,c===null&&(c=fa(),pt.updateQueue=c),b=c.lastEffect,b===null?c.lastEffect=a.next=a:(x=b.next,b.next=a,a.next=x,c.lastEffect=a),a}function lc(){return tn().memoizedState}function ga(a,c,b,x){var S=vn();pt.flags|=a,S.memoizedState=$s(1|c,{destroy:void 0},b,x===void 0?null:x)}function ya(a,c,b,x){var S=tn();x=x===void 0?null:x;var A=S.memoizedState.inst;Lt!==null&&x!==null&&ko(x,Lt.memoizedState.deps)?S.memoizedState=$s(c,A,b,x):(pt.flags|=a,S.memoizedState=$s(1|c,A,b,x))}function uc(a,c){ga(8390656,8,a,c)}function jo(a,c){ya(2048,8,a,c)}function vf(a){pt.flags|=4;var c=pt.updateQueue;if(c===null)c=fa(),pt.updateQueue=c,c.events=[a];else{var b=c.events;b===null?c.events=[a]:b.push(a)}}function cc(a){var c=tn().memoizedState;return vf({ref:c,nextImpl:a}),function(){if((Bt&2)!==0)throw Error(s(440));return c.impl.apply(void 0,arguments)}}function dc(a,c){return ya(4,2,a,c)}function hc(a,c){return ya(4,4,a,c)}function fc(a,c){if(typeof c=="function"){a=a();var b=c(a);return function(){typeof b=="function"?b():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function pc(a,c,b){b=b!=null?b.concat([a]):null,ya(4,4,fc.bind(null,c,a),b)}function Ho(){}function mc(a,c){var b=tn();c=c===void 0?null:c;var x=b.memoizedState;return c!==null&&ko(c,x[1])?x[0]:(b.memoizedState=[a,c],a)}function gc(a,c){var b=tn();c=c===void 0?null:c;var x=b.memoizedState;if(c!==null&&ko(c,x[1]))return x[0];if(x=a(),fs){Je(!0);try{a()}finally{Je(!1)}}return b.memoizedState=[x,c],x}function qo(a,c,b){return b===void 0||(gr&1073741824)!==0&&(Tt&261930)===0?a.memoizedState=c:(a.memoizedState=b,a=yd(),pt.lanes|=a,$r|=a,b)}function yc(a,c,b,x){return Bn(b,c)?b:Us.current!==null?(a=qo(a,b,x),Bn(a,c)||(sn=!0),a):(gr&42)===0||(gr&1073741824)!==0&&(Tt&261930)===0?(sn=!0,a.memoizedState=b):(a=yd(),pt.lanes|=a,$r|=a,c)}function bc(a,c,b,x,S){var A=H.p;H.p=A!==0&&8>A?A:8;var F=k.T,Q={};k.T=Q,Xo(a,!1,c,b);try{var me=S(),Ce=k.S;if(Ce!==null&&Ce(Q,me),me!==null&&typeof me=="object"&&typeof me.then=="function"){var Le=mf(me,x);Pi(a,c,Le,Ln(a))}else Pi(a,c,x,Ln(a))}catch(Ue){Pi(a,c,{then:function(){},status:"rejected",reason:Ue},Ln())}finally{H.p=A,F!==null&&Q.types!==null&&(F.types=Q.types),k.T=F}}function xf(){}function Yo(a,c,b,x){if(a.tag!==5)throw Error(s(476));var S=_c(a).queue;bc(a,S,c,de,b===null?xf:function(){return vc(a),b(x)})}function _c(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:de,baseState:de,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yr,lastRenderedState:de},next:null};var b={};return c.next={memoizedState:b,baseState:b,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yr,lastRenderedState:b},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function vc(a){var c=_c(a);c.next===null&&(c=a.alternate.memoizedState),Pi(a,c.next.queue,{},Ln())}function Wo(){return fn($i)}function xc(){return tn().memoizedState}function Tc(){return tn().memoizedState}function Tf(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var b=Ln();a=Dr(b);var x=Lr(c,a,b);x!==null&&(In(x,c,b),xi(x,c,b)),c={cache:wo()},a.payload=c;return}c=c.return}}function wf(a,c,b){var x=Ln();b={lane:x,revertLane:0,gesture:null,action:b,hasEagerState:!1,eagerState:null,next:null},ba(a)?Ec(c,b):(b=ho(a,c,b,x),b!==null&&(In(b,a,x),Sc(b,c,x)))}function wc(a,c,b){var x=Ln();Pi(a,c,b,x)}function Pi(a,c,b,x){var S={lane:x,revertLane:0,gesture:null,action:b,hasEagerState:!1,eagerState:null,next:null};if(ba(a))Ec(c,S);else{var A=a.alternate;if(a.lanes===0&&(A===null||A.lanes===0)&&(A=c.lastRenderedReducer,A!==null))try{var F=c.lastRenderedState,Q=A(F,b);if(S.hasEagerState=!0,S.eagerState=Q,Bn(Q,F))return Qi(a,c,S,0),Ht===null&&Ki(),!1}catch{}finally{}if(b=ho(a,c,S,x),b!==null)return In(b,a,x),Sc(b,c,x),!0}return!1}function Xo(a,c,b,x){if(x={lane:2,revertLane:Al(),gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null},ba(a)){if(c)throw Error(s(479))}else c=ho(a,b,x,2),c!==null&&In(c,a,2)}function ba(a){var c=a.alternate;return a===pt||c!==null&&c===pt}function Ec(a,c){zs=da=!0;var b=a.pending;b===null?c.next=c:(c.next=b.next,b.next=c),a.pending=c}function Sc(a,c,b){if((b&4194048)!==0){var x=c.lanes;x&=a.pendingLanes,b|=x,c.lanes=b,wn(a,b)}}var Ai={readContext:fn,use:pa,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useLayoutEffect:Qt,useInsertionEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useSyncExternalStore:Qt,useId:Qt,useHostTransitionStatus:Qt,useFormState:Qt,useActionState:Qt,useOptimistic:Qt,useMemoCache:Qt,useCacheRefresh:Qt};Ai.useEffectEvent=Qt;var Pc={readContext:fn,use:pa,useCallback:function(a,c){return vn().memoizedState=[a,c===void 0?null:c],a},useContext:fn,useEffect:uc,useImperativeHandle:function(a,c,b){b=b!=null?b.concat([a]):null,ga(4194308,4,fc.bind(null,c,a),b)},useLayoutEffect:function(a,c){return ga(4194308,4,a,c)},useInsertionEffect:function(a,c){ga(4,2,a,c)},useMemo:function(a,c){var b=vn();c=c===void 0?null:c;var x=a();if(fs){Je(!0);try{a()}finally{Je(!1)}}return b.memoizedState=[x,c],x},useReducer:function(a,c,b){var x=vn();if(b!==void 0){var S=b(c);if(fs){Je(!0);try{b(c)}finally{Je(!1)}}}else S=c;return x.memoizedState=x.baseState=S,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:S},x.queue=a,a=a.dispatch=wf.bind(null,pt,a),[x.memoizedState,a]},useRef:function(a){var c=vn();return a={current:a},c.memoizedState=a},useState:function(a){a=Go(a);var c=a.queue,b=wc.bind(null,pt,c);return c.dispatch=b,[a.memoizedState,b]},useDebugValue:Ho,useDeferredValue:function(a,c){var b=vn();return qo(b,a,c)},useTransition:function(){var a=Go(!1);return a=bc.bind(null,pt,a.queue,!0,!1),vn().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,b){var x=pt,S=vn();if(St){if(b===void 0)throw Error(s(407));b=b()}else{if(b=c(),Ht===null)throw Error(s(349));(Tt&127)!==0||Yu(x,c,b)}S.memoizedState=b;var A={value:b,getSnapshot:c};return S.queue=A,uc(Xu.bind(null,x,A,a),[a]),x.flags|=2048,$s(9,{destroy:void 0},Wu.bind(null,x,A,b,c),null),b},useId:function(){var a=vn(),c=Ht.identifierPrefix;if(St){var b=nr,x=tr;b=(x&~(1<<32-Pt(x)-1)).toString(32)+b,c="_"+c+"R_"+b,b=ha++,0<b&&(c+="H"+b.toString(32)),c+="_"}else b=gf++,c="_"+c+"r_"+b.toString(32)+"_";return a.memoizedState=c},useHostTransitionStatus:Wo,useFormState:sc,useActionState:sc,useOptimistic:function(a){var c=vn();c.memoizedState=c.baseState=a;var b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=b,c=Xo.bind(null,pt,!0,b),b.dispatch=c,[a,c]},useMemoCache:Fo,useCacheRefresh:function(){return vn().memoizedState=Tf.bind(null,pt)},useEffectEvent:function(a){var c=vn(),b={impl:a};return c.memoizedState=b,function(){if((Bt&2)!==0)throw Error(s(440));return b.impl.apply(void 0,arguments)}}},Jo={readContext:fn,use:pa,useCallback:mc,useContext:fn,useEffect:jo,useImperativeHandle:pc,useInsertionEffect:dc,useLayoutEffect:hc,useMemo:gc,useReducer:ma,useRef:lc,useState:function(){return ma(yr)},useDebugValue:Ho,useDeferredValue:function(a,c){var b=tn();return yc(b,Lt.memoizedState,a,c)},useTransition:function(){var a=ma(yr)[0],c=tn().memoizedState;return[typeof a=="boolean"?a:Si(a),c]},useSyncExternalStore:qu,useId:xc,useHostTransitionStatus:Wo,useFormState:ic,useActionState:ic,useOptimistic:function(a,c){var b=tn();return Qu(b,Lt,a,c)},useMemoCache:Fo,useCacheRefresh:Tc};Jo.useEffectEvent=cc;var Ac={readContext:fn,use:pa,useCallback:mc,useContext:fn,useEffect:jo,useImperativeHandle:pc,useInsertionEffect:dc,useLayoutEffect:hc,useMemo:gc,useReducer:zo,useRef:lc,useState:function(){return zo(yr)},useDebugValue:Ho,useDeferredValue:function(a,c){var b=tn();return Lt===null?qo(b,a,c):yc(b,Lt.memoizedState,a,c)},useTransition:function(){var a=zo(yr)[0],c=tn().memoizedState;return[typeof a=="boolean"?a:Si(a),c]},useSyncExternalStore:qu,useId:xc,useHostTransitionStatus:Wo,useFormState:oc,useActionState:oc,useOptimistic:function(a,c){var b=tn();return Lt!==null?Qu(b,Lt,a,c):(b.baseState=a,[a,b.queue.dispatch])},useMemoCache:Fo,useCacheRefresh:Tc};Ac.useEffectEvent=cc;function Ko(a,c,b,x){c=a.memoizedState,b=b(x,c),b=b==null?c:i({},c,b),a.memoizedState=b,a.lanes===0&&(a.updateQueue.baseState=b)}var Qo={enqueueSetState:function(a,c,b){a=a._reactInternals;var x=Ln(),S=Dr(x);S.payload=c,b!=null&&(S.callback=b),c=Lr(a,S,x),c!==null&&(In(c,a,x),xi(c,a,x))},enqueueReplaceState:function(a,c,b){a=a._reactInternals;var x=Ln(),S=Dr(x);S.tag=1,S.payload=c,b!=null&&(S.callback=b),c=Lr(a,S,x),c!==null&&(In(c,a,x),xi(c,a,x))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var b=Ln(),x=Dr(b);x.tag=2,c!=null&&(x.callback=c),c=Lr(a,x,b),c!==null&&(In(c,a,b),xi(c,a,b))}};function Cc(a,c,b,x,S,A,F){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(x,A,F):c.prototype&&c.prototype.isPureReactComponent?!fi(b,x)||!fi(S,A):!0}function Mc(a,c,b,x){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(b,x),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(b,x),c.state!==a&&Qo.enqueueReplaceState(c,c.state,null)}function ps(a,c){var b=c;if("ref"in c){b={};for(var x in c)x!=="ref"&&(b[x]=c[x])}if(a=a.defaultProps){b===c&&(b=i({},b));for(var S in a)b[S]===void 0&&(b[S]=a[S])}return b}function Rc(a){Ji(a)}function Ic(a){console.error(a)}function Bc(a){Ji(a)}function va(a,c){try{var b=a.onUncaughtError;b(c.value,{componentStack:c.stack})}catch(x){setTimeout(function(){throw x})}}function Vc(a,c,b){try{var x=a.onCaughtError;x(b.value,{componentStack:b.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(S){setTimeout(function(){throw S})}}function Zo(a,c,b){return b=Dr(b),b.tag=3,b.payload={element:null},b.callback=function(){va(a,c)},b}function kc(a){return a=Dr(a),a.tag=3,a}function Nc(a,c,b,x){var S=b.type.getDerivedStateFromError;if(typeof S=="function"){var A=x.value;a.payload=function(){return S(A)},a.callback=function(){Vc(c,b,x)}}var F=b.stateNode;F!==null&&typeof F.componentDidCatch=="function"&&(a.callback=function(){Vc(c,b,x),typeof S!="function"&&(jr===null?jr=new Set([this]):jr.add(this));var Q=x.stack;this.componentDidCatch(x.value,{componentStack:Q!==null?Q:""})})}function Ef(a,c,b,x,S){if(b.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(c=b.alternate,c!==null&&Ns(c,b,S,!0),b=kn.current,b!==null){switch(b.tag){case 31:case 13:return Wn===null?Ba():b.alternate===null&&Zt===0&&(Zt=3),b.flags&=-257,b.flags|=65536,b.lanes=S,x===aa?b.flags|=16384:(c=b.updateQueue,c===null?b.updateQueue=new Set([x]):c.add(x),El(a,x,S)),!1;case 22:return b.flags|=65536,x===aa?b.flags|=16384:(c=b.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([x])},b.updateQueue=c):(b=c.retryQueue,b===null?c.retryQueue=new Set([x]):b.add(x)),El(a,x,S)),!1}throw Error(s(435,b.tag))}return El(a,x,S),Ba(),!1}if(St)return c=kn.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=S,x!==bo&&(a=Error(s(422),{cause:x}),gi(jn(a,b)))):(x!==bo&&(c=Error(s(423),{cause:x}),gi(jn(c,b))),a=a.current.alternate,a.flags|=65536,S&=-S,a.lanes|=S,x=jn(x,b),S=Zo(a.stateNode,x,S),Mo(a,S),Zt!==4&&(Zt=2)),!1;var A=Error(s(520),{cause:x});if(A=jn(A,b),Ni===null?Ni=[A]:Ni.push(A),Zt!==4&&(Zt=2),c===null)return!0;x=jn(x,b),b=c;do{switch(b.tag){case 3:return b.flags|=65536,a=S&-S,b.lanes|=a,a=Zo(b.stateNode,x,a),Mo(b,a),!1;case 1:if(c=b.type,A=b.stateNode,(b.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(jr===null||!jr.has(A))))return b.flags|=65536,S&=-S,b.lanes|=S,S=kc(S),Nc(S,a,b,x),Mo(b,S),!1}b=b.return}while(b!==null);return!1}var el=Error(s(461)),sn=!1;function pn(a,c,b,x){c.child=a===null?Fu(c,null,b,x):hs(c,a.child,b,x)}function Oc(a,c,b,x,S){b=b.render;var A=c.ref;if("ref"in x){var F={};for(var Q in x)Q!=="ref"&&(F[Q]=x[Q])}else F=x;return ls(c),x=No(a,c,b,F,A,S),Q=Oo(),a!==null&&!sn?(Do(a,c,S),br(a,c,S)):(St&&Q&&go(c),c.flags|=1,pn(a,c,x,S),c.child)}function Dc(a,c,b,x,S){if(a===null){var A=b.type;return typeof A=="function"&&!fo(A)&&A.defaultProps===void 0&&b.compare===null?(c.tag=15,c.type=A,Lc(a,c,A,x,S)):(a=ea(b.type,null,x,c,c.mode,S),a.ref=c.ref,a.return=c,c.child=a)}if(A=a.child,!ll(a,S)){var F=A.memoizedProps;if(b=b.compare,b=b!==null?b:fi,b(F,x)&&a.ref===c.ref)return br(a,c,S)}return c.flags|=1,a=hr(A,x),a.ref=c.ref,a.return=c,c.child=a}function Lc(a,c,b,x,S){if(a!==null){var A=a.memoizedProps;if(fi(A,x)&&a.ref===c.ref)if(sn=!1,c.pendingProps=x=A,ll(a,S))(a.flags&131072)!==0&&(sn=!0);else return c.lanes=a.lanes,br(a,c,S)}return tl(a,c,b,x,S)}function Fc(a,c,b,x){var S=x.children,A=a!==null?a.memoizedState:null;if(a===null&&c.stateNode===null&&(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),x.mode==="hidden"){if((c.flags&128)!==0){if(A=A!==null?A.baseLanes|b:b,a!==null){for(x=c.child=a.child,S=0;x!==null;)S=S|x.lanes|x.childLanes,x=x.sibling;x=S&~A}else x=0,c.child=null;return Uc(a,c,A,b,x)}if((b&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&sa(c,A!==null?A.cachePool:null),A!==null?Gu(c,A):Io(),$u(c);else return x=c.lanes=536870912,Uc(a,c,A!==null?A.baseLanes|b:b,b,x)}else A!==null?(sa(c,A.cachePool),Gu(c,A),Ur(),c.memoizedState=null):(a!==null&&sa(c,null),Io(),Ur());return pn(a,c,S,b),c.child}function Ci(a,c){return a!==null&&a.tag===22||c.stateNode!==null||(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.sibling}function Uc(a,c,b,x,S){var A=So();return A=A===null?null:{parent:nn._currentValue,pool:A},c.memoizedState={baseLanes:b,cachePool:A},a!==null&&sa(c,null),Io(),$u(c),a!==null&&Ns(a,c,x,!0),c.childLanes=S,null}function xa(a,c){return c=wa({mode:c.mode,children:c.children},a.mode),c.ref=a.ref,a.child=c,c.return=a,c}function zc(a,c,b){return hs(c,a.child,null,b),a=xa(c,c.pendingProps),a.flags|=2,Nn(c),c.memoizedState=null,a}function Sf(a,c,b){var x=c.pendingProps,S=(c.flags&128)!==0;if(c.flags&=-129,a===null){if(St){if(x.mode==="hidden")return a=xa(c,x),c.lanes=536870912,Ci(null,a);if(Vo(c),(a=Yt)?(a=Zd(a,Yn),a=a!==null&&a.data==="&"?a:null,a!==null&&(c.memoizedState={dehydrated:a,treeContext:Br!==null?{id:tr,overflow:nr}:null,retryLane:536870912,hydrationErrors:null},b=Eu(a),b.return=c,c.child=b,hn=c,Yt=null)):a=null,a===null)throw kr(c);return c.lanes=536870912,null}return xa(c,x)}var A=a.memoizedState;if(A!==null){var F=A.dehydrated;if(Vo(c),S)if(c.flags&256)c.flags&=-257,c=zc(a,c,b);else if(c.memoizedState!==null)c.child=a.child,c.flags|=128,c=null;else throw Error(s(558));else if(sn||Ns(a,c,b,!1),S=(b&a.childLanes)!==0,sn||S){if(x=Ht,x!==null&&(F=Fn(x,b),F!==0&&F!==A.retryLane))throw A.retryLane=F,ss(a,F),In(x,a,F),el;Ba(),c=zc(a,c,b)}else a=A.treeContext,Yt=Xn(F.nextSibling),hn=c,St=!0,Vr=null,Yn=!1,a!==null&&Au(c,a),c=xa(c,x),c.flags|=4096;return c}return a=hr(a.child,{mode:x.mode,children:x.children}),a.ref=c.ref,c.child=a,a.return=c,a}function Ta(a,c){var b=c.ref;if(b===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof b!="function"&&typeof b!="object")throw Error(s(284));(a===null||a.ref!==b)&&(c.flags|=4194816)}}function tl(a,c,b,x,S){return ls(c),b=No(a,c,b,x,void 0,S),x=Oo(),a!==null&&!sn?(Do(a,c,S),br(a,c,S)):(St&&x&&go(c),c.flags|=1,pn(a,c,b,S),c.child)}function Gc(a,c,b,x,S,A){return ls(c),c.updateQueue=null,b=Hu(c,x,b,S),ju(a),x=Oo(),a!==null&&!sn?(Do(a,c,A),br(a,c,A)):(St&&x&&go(c),c.flags|=1,pn(a,c,b,A),c.child)}function $c(a,c,b,x,S){if(ls(c),c.stateNode===null){var A=Is,F=b.contextType;typeof F=="object"&&F!==null&&(A=fn(F)),A=new b(x,A),c.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,A.updater=Qo,c.stateNode=A,A._reactInternals=c,A=c.stateNode,A.props=x,A.state=c.memoizedState,A.refs={},Ao(c),F=b.contextType,A.context=typeof F=="object"&&F!==null?fn(F):Is,A.state=c.memoizedState,F=b.getDerivedStateFromProps,typeof F=="function"&&(Ko(c,b,F,x),A.state=c.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof A.getSnapshotBeforeUpdate=="function"||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(F=A.state,typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount(),F!==A.state&&Qo.enqueueReplaceState(A,A.state,null),wi(c,x,A,S),Ti(),A.state=c.memoizedState),typeof A.componentDidMount=="function"&&(c.flags|=4194308),x=!0}else if(a===null){A=c.stateNode;var Q=c.memoizedProps,me=ps(b,Q);A.props=me;var Ce=A.context,Le=b.contextType;F=Is,typeof Le=="object"&&Le!==null&&(F=fn(Le));var Ue=b.getDerivedStateFromProps;Le=typeof Ue=="function"||typeof A.getSnapshotBeforeUpdate=="function",Q=c.pendingProps!==Q,Le||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(Q||Ce!==F)&&Mc(c,A,x,F),Or=!1;var Me=c.memoizedState;A.state=Me,wi(c,x,A,S),Ti(),Ce=c.memoizedState,Q||Me!==Ce||Or?(typeof Ue=="function"&&(Ko(c,b,Ue,x),Ce=c.memoizedState),(me=Or||Cc(c,b,me,x,Me,Ce,F))?(Le||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount()),typeof A.componentDidMount=="function"&&(c.flags|=4194308)):(typeof A.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=x,c.memoizedState=Ce),A.props=x,A.state=Ce,A.context=F,x=me):(typeof A.componentDidMount=="function"&&(c.flags|=4194308),x=!1)}else{A=c.stateNode,Co(a,c),F=c.memoizedProps,Le=ps(b,F),A.props=Le,Ue=c.pendingProps,Me=A.context,Ce=b.contextType,me=Is,typeof Ce=="object"&&Ce!==null&&(me=fn(Ce)),Q=b.getDerivedStateFromProps,(Ce=typeof Q=="function"||typeof A.getSnapshotBeforeUpdate=="function")||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(F!==Ue||Me!==me)&&Mc(c,A,x,me),Or=!1,Me=c.memoizedState,A.state=Me,wi(c,x,A,S),Ti();var Ve=c.memoizedState;F!==Ue||Me!==Ve||Or||a!==null&&a.dependencies!==null&&na(a.dependencies)?(typeof Q=="function"&&(Ko(c,b,Q,x),Ve=c.memoizedState),(Le=Or||Cc(c,b,Le,x,Me,Ve,me)||a!==null&&a.dependencies!==null&&na(a.dependencies))?(Ce||typeof A.UNSAFE_componentWillUpdate!="function"&&typeof A.componentWillUpdate!="function"||(typeof A.componentWillUpdate=="function"&&A.componentWillUpdate(x,Ve,me),typeof A.UNSAFE_componentWillUpdate=="function"&&A.UNSAFE_componentWillUpdate(x,Ve,me)),typeof A.componentDidUpdate=="function"&&(c.flags|=4),typeof A.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof A.componentDidUpdate!="function"||F===a.memoizedProps&&Me===a.memoizedState||(c.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||F===a.memoizedProps&&Me===a.memoizedState||(c.flags|=1024),c.memoizedProps=x,c.memoizedState=Ve),A.props=x,A.state=Ve,A.context=me,x=Le):(typeof A.componentDidUpdate!="function"||F===a.memoizedProps&&Me===a.memoizedState||(c.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||F===a.memoizedProps&&Me===a.memoizedState||(c.flags|=1024),x=!1)}return A=x,Ta(a,c),x=(c.flags&128)!==0,A||x?(A=c.stateNode,b=x&&typeof b.getDerivedStateFromError!="function"?null:A.render(),c.flags|=1,a!==null&&x?(c.child=hs(c,a.child,null,S),c.child=hs(c,null,b,S)):pn(a,c,b,S),c.memoizedState=A.state,a=c.child):a=br(a,c,S),a}function jc(a,c,b,x){return as(),c.flags|=256,pn(a,c,b,x),c.child}var nl={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function rl(a){return{baseLanes:a,cachePool:Vu()}}function sl(a,c,b){return a=a!==null?a.childLanes&~b:0,c&&(a|=Dn),a}function Hc(a,c,b){var x=c.pendingProps,S=!1,A=(c.flags&128)!==0,F;if((F=A)||(F=a!==null&&a.memoizedState===null?!1:(en.current&2)!==0),F&&(S=!0,c.flags&=-129),F=(c.flags&32)!==0,c.flags&=-33,a===null){if(St){if(S?Fr(c):Ur(),(a=Yt)?(a=Zd(a,Yn),a=a!==null&&a.data!=="&"?a:null,a!==null&&(c.memoizedState={dehydrated:a,treeContext:Br!==null?{id:tr,overflow:nr}:null,retryLane:536870912,hydrationErrors:null},b=Eu(a),b.return=c,c.child=b,hn=c,Yt=null)):a=null,a===null)throw kr(c);return Ul(a)?c.lanes=32:c.lanes=536870912,null}var Q=x.children;return x=x.fallback,S?(Ur(),S=c.mode,Q=wa({mode:"hidden",children:Q},S),x=is(x,S,b,null),Q.return=c,x.return=c,Q.sibling=x,c.child=Q,x=c.child,x.memoizedState=rl(b),x.childLanes=sl(a,F,b),c.memoizedState=nl,Ci(null,x)):(Fr(c),il(c,Q))}var me=a.memoizedState;if(me!==null&&(Q=me.dehydrated,Q!==null)){if(A)c.flags&256?(Fr(c),c.flags&=-257,c=al(a,c,b)):c.memoizedState!==null?(Ur(),c.child=a.child,c.flags|=128,c=null):(Ur(),Q=x.fallback,S=c.mode,x=wa({mode:"visible",children:x.children},S),Q=is(Q,S,b,null),Q.flags|=2,x.return=c,Q.return=c,x.sibling=Q,c.child=x,hs(c,a.child,null,b),x=c.child,x.memoizedState=rl(b),x.childLanes=sl(a,F,b),c.memoizedState=nl,c=Ci(null,x));else if(Fr(c),Ul(Q)){if(F=Q.nextSibling&&Q.nextSibling.dataset,F)var Ce=F.dgst;F=Ce,x=Error(s(419)),x.stack="",x.digest=F,gi({value:x,source:null,stack:null}),c=al(a,c,b)}else if(sn||Ns(a,c,b,!1),F=(b&a.childLanes)!==0,sn||F){if(F=Ht,F!==null&&(x=Fn(F,b),x!==0&&x!==me.retryLane))throw me.retryLane=x,ss(a,x),In(F,a,x),el;Fl(Q)||Ba(),c=al(a,c,b)}else Fl(Q)?(c.flags|=192,c.child=a.child,c=null):(a=me.treeContext,Yt=Xn(Q.nextSibling),hn=c,St=!0,Vr=null,Yn=!1,a!==null&&Au(c,a),c=il(c,x.children),c.flags|=4096);return c}return S?(Ur(),Q=x.fallback,S=c.mode,me=a.child,Ce=me.sibling,x=hr(me,{mode:"hidden",children:x.children}),x.subtreeFlags=me.subtreeFlags&65011712,Ce!==null?Q=hr(Ce,Q):(Q=is(Q,S,b,null),Q.flags|=2),Q.return=c,x.return=c,x.sibling=Q,c.child=x,Ci(null,x),x=c.child,Q=a.child.memoizedState,Q===null?Q=rl(b):(S=Q.cachePool,S!==null?(me=nn._currentValue,S=S.parent!==me?{parent:me,pool:me}:S):S=Vu(),Q={baseLanes:Q.baseLanes|b,cachePool:S}),x.memoizedState=Q,x.childLanes=sl(a,F,b),c.memoizedState=nl,Ci(a.child,x)):(Fr(c),b=a.child,a=b.sibling,b=hr(b,{mode:"visible",children:x.children}),b.return=c,b.sibling=null,a!==null&&(F=c.deletions,F===null?(c.deletions=[a],c.flags|=16):F.push(a)),c.child=b,c.memoizedState=null,b)}function il(a,c){return c=wa({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function wa(a,c){return a=Vn(22,a,null,c),a.lanes=0,a}function al(a,c,b){return hs(c,a.child,null,b),a=il(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function qc(a,c,b){a.lanes|=c;var x=a.alternate;x!==null&&(x.lanes|=c),xo(a.return,c,b)}function ol(a,c,b,x,S,A){var F=a.memoizedState;F===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:x,tail:b,tailMode:S,treeForkCount:A}:(F.isBackwards=c,F.rendering=null,F.renderingStartTime=0,F.last=x,F.tail=b,F.tailMode=S,F.treeForkCount=A)}function Yc(a,c,b){var x=c.pendingProps,S=x.revealOrder,A=x.tail;x=x.children;var F=en.current,Q=(F&2)!==0;if(Q?(F=F&1|2,c.flags|=128):F&=1,be(en,F),pn(a,c,x,b),x=St?mi:0,!Q&&a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&qc(a,b,c);else if(a.tag===19)qc(a,b,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(S){case"forwards":for(b=c.child,S=null;b!==null;)a=b.alternate,a!==null&&ca(a)===null&&(S=b),b=b.sibling;b=S,b===null?(S=c.child,c.child=null):(S=b.sibling,b.sibling=null),ol(c,!1,S,b,A,x);break;case"backwards":case"unstable_legacy-backwards":for(b=null,S=c.child,c.child=null;S!==null;){if(a=S.alternate,a!==null&&ca(a)===null){c.child=S;break}a=S.sibling,S.sibling=b,b=S,S=a}ol(c,!0,b,null,A,x);break;case"together":ol(c,!1,null,null,void 0,x);break;default:c.memoizedState=null}return c.child}function br(a,c,b){if(a!==null&&(c.dependencies=a.dependencies),$r|=c.lanes,(b&c.childLanes)===0)if(a!==null){if(Ns(a,c,b,!1),(b&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(s(153));if(c.child!==null){for(a=c.child,b=hr(a,a.pendingProps),c.child=b,b.return=c;a.sibling!==null;)a=a.sibling,b=b.sibling=hr(a,a.pendingProps),b.return=c;b.sibling=null}return c.child}function ll(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&na(a)))}function Pf(a,c,b){switch(c.tag){case 3:L(c,c.stateNode.containerInfo),Nr(c,nn,a.memoizedState.cache),as();break;case 27:case 5:C(c);break;case 4:L(c,c.stateNode.containerInfo);break;case 10:Nr(c,c.type,c.memoizedProps.value);break;case 31:if(c.memoizedState!==null)return c.flags|=128,Vo(c),null;break;case 13:var x=c.memoizedState;if(x!==null)return x.dehydrated!==null?(Fr(c),c.flags|=128,null):(b&c.child.childLanes)!==0?Hc(a,c,b):(Fr(c),a=br(a,c,b),a!==null?a.sibling:null);Fr(c);break;case 19:var S=(a.flags&128)!==0;if(x=(b&c.childLanes)!==0,x||(Ns(a,c,b,!1),x=(b&c.childLanes)!==0),S){if(x)return Yc(a,c,b);c.flags|=128}if(S=c.memoizedState,S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),be(en,en.current),x)break;return null;case 22:return c.lanes=0,Fc(a,c,b,c.pendingProps);case 24:Nr(c,nn,a.memoizedState.cache)}return br(a,c,b)}function Wc(a,c,b){if(a!==null)if(a.memoizedProps!==c.pendingProps)sn=!0;else{if(!ll(a,b)&&(c.flags&128)===0)return sn=!1,Pf(a,c,b);sn=(a.flags&131072)!==0}else sn=!1,St&&(c.flags&1048576)!==0&&Pu(c,mi,c.index);switch(c.lanes=0,c.tag){case 16:e:{var x=c.pendingProps;if(a=cs(c.elementType),c.type=a,typeof a=="function")fo(a)?(x=ps(a,x),c.tag=1,c=$c(null,c,a,x,b)):(c.tag=0,c=tl(null,c,a,x,b));else{if(a!=null){var S=a.$$typeof;if(S===E){c.tag=11,c=Oc(null,c,a,x,b);break e}else if(S===I){c.tag=14,c=Dc(null,c,a,x,b);break e}}throw c=W(a)||a,Error(s(306,c,""))}}return c;case 0:return tl(a,c,c.type,c.pendingProps,b);case 1:return x=c.type,S=ps(x,c.pendingProps),$c(a,c,x,S,b);case 3:e:{if(L(c,c.stateNode.containerInfo),a===null)throw Error(s(387));x=c.pendingProps;var A=c.memoizedState;S=A.element,Co(a,c),wi(c,x,null,b);var F=c.memoizedState;if(x=F.cache,Nr(c,nn,x),x!==A.cache&&To(c,[nn],b,!0),Ti(),x=F.element,A.isDehydrated)if(A={element:x,isDehydrated:!1,cache:F.cache},c.updateQueue.baseState=A,c.memoizedState=A,c.flags&256){c=jc(a,c,x,b);break e}else if(x!==S){S=jn(Error(s(424)),c),gi(S),c=jc(a,c,x,b);break e}else{switch(a=c.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Yt=Xn(a.firstChild),hn=c,St=!0,Vr=null,Yn=!0,b=Fu(c,null,x,b),c.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling}else{if(as(),x===S){c=br(a,c,b);break e}pn(a,c,x,b)}c=c.child}return c;case 26:return Ta(a,c),a===null?(b=ih(c.type,null,c.pendingProps,null))?c.memoizedState=b:St||(b=c.type,a=c.pendingProps,x=Fa(we.current).createElement(b),x[Kt]=c,x[Z]=a,mn(x,b,a),_t(x),c.stateNode=x):c.memoizedState=ih(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return C(c),a===null&&St&&(x=c.stateNode=nh(c.type,c.pendingProps,we.current),hn=c,Yn=!0,S=Yt,Wr(c.type)?(zl=S,Yt=Xn(x.firstChild)):Yt=S),pn(a,c,c.pendingProps.children,b),Ta(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&St&&((S=x=Yt)&&(x=rp(x,c.type,c.pendingProps,Yn),x!==null?(c.stateNode=x,hn=c,Yt=Xn(x.firstChild),Yn=!1,S=!0):S=!1),S||kr(c)),C(c),S=c.type,A=c.pendingProps,F=a!==null?a.memoizedProps:null,x=A.children,Ol(S,A)?x=null:F!==null&&Ol(S,F)&&(c.flags|=32),c.memoizedState!==null&&(S=No(a,c,yf,null,null,b),$i._currentValue=S),Ta(a,c),pn(a,c,x,b),c.child;case 6:return a===null&&St&&((a=b=Yt)&&(b=sp(b,c.pendingProps,Yn),b!==null?(c.stateNode=b,hn=c,Yt=null,a=!0):a=!1),a||kr(c)),null;case 13:return Hc(a,c,b);case 4:return L(c,c.stateNode.containerInfo),x=c.pendingProps,a===null?c.child=hs(c,null,x,b):pn(a,c,x,b),c.child;case 11:return Oc(a,c,c.type,c.pendingProps,b);case 7:return pn(a,c,c.pendingProps,b),c.child;case 8:return pn(a,c,c.pendingProps.children,b),c.child;case 12:return pn(a,c,c.pendingProps.children,b),c.child;case 10:return x=c.pendingProps,Nr(c,c.type,x.value),pn(a,c,x.children,b),c.child;case 9:return S=c.type._context,x=c.pendingProps.children,ls(c),S=fn(S),x=x(S),c.flags|=1,pn(a,c,x,b),c.child;case 14:return Dc(a,c,c.type,c.pendingProps,b);case 15:return Lc(a,c,c.type,c.pendingProps,b);case 19:return Yc(a,c,b);case 31:return Sf(a,c,b);case 22:return Fc(a,c,b,c.pendingProps);case 24:return ls(c),x=fn(nn),a===null?(S=So(),S===null&&(S=Ht,A=wo(),S.pooledCache=A,A.refCount++,A!==null&&(S.pooledCacheLanes|=b),S=A),c.memoizedState={parent:x,cache:S},Ao(c),Nr(c,nn,S)):((a.lanes&b)!==0&&(Co(a,c),wi(c,null,null,b),Ti()),S=a.memoizedState,A=c.memoizedState,S.parent!==x?(S={parent:x,cache:x},c.memoizedState=S,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=S),Nr(c,nn,x)):(x=A.cache,Nr(c,nn,x),x!==S.cache&&To(c,[nn],b,!0))),pn(a,c,c.pendingProps.children,b),c.child;case 29:throw c.pendingProps}throw Error(s(156,c.tag))}function _r(a){a.flags|=4}function ul(a,c,b,x,S){if((c=(a.mode&32)!==0)&&(c=!1),c){if(a.flags|=16777216,(S&335544128)===S)if(a.stateNode.complete)a.flags|=8192;else if(xd())a.flags|=8192;else throw ds=aa,Po}else a.flags&=-16777217}function Xc(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!ch(c))if(xd())a.flags|=8192;else throw ds=aa,Po}function Ea(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?Dt():536870912,a.lanes|=c,Ys|=c)}function Mi(a,c){if(!St)switch(a.tailMode){case"hidden":c=a.tail;for(var b=null;c!==null;)c.alternate!==null&&(b=c),c=c.sibling;b===null?a.tail=null:b.sibling=null;break;case"collapsed":b=a.tail;for(var x=null;b!==null;)b.alternate!==null&&(x=b),b=b.sibling;x===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:x.sibling=null}}function Wt(a){var c=a.alternate!==null&&a.alternate.child===a.child,b=0,x=0;if(c)for(var S=a.child;S!==null;)b|=S.lanes|S.childLanes,x|=S.subtreeFlags&65011712,x|=S.flags&65011712,S.return=a,S=S.sibling;else for(S=a.child;S!==null;)b|=S.lanes|S.childLanes,x|=S.subtreeFlags,x|=S.flags,S.return=a,S=S.sibling;return a.subtreeFlags|=x,a.childLanes=b,c}function Af(a,c,b){var x=c.pendingProps;switch(yo(c),c.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(c),null;case 1:return Wt(c),null;case 3:return b=c.stateNode,x=null,a!==null&&(x=a.memoizedState.cache),c.memoizedState.cache!==x&&(c.flags|=2048),mr(nn),M(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(a===null||a.child===null)&&(ks(c)?_r(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,_o())),Wt(c),null;case 26:var S=c.type,A=c.memoizedState;return a===null?(_r(c),A!==null?(Wt(c),Xc(c,A)):(Wt(c),ul(c,S,null,x,b))):A?A!==a.memoizedState?(_r(c),Wt(c),Xc(c,A)):(Wt(c),c.flags&=-16777217):(a=a.memoizedProps,a!==x&&_r(c),Wt(c),ul(c,S,a,x,b)),null;case 27:if(V(c),b=we.current,S=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==x&&_r(c);else{if(!x){if(c.stateNode===null)throw Error(s(166));return Wt(c),null}a=xe.current,ks(c)?Cu(c):(a=nh(S,x,b),c.stateNode=a,_r(c))}return Wt(c),null;case 5:if(V(c),S=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==x&&_r(c);else{if(!x){if(c.stateNode===null)throw Error(s(166));return Wt(c),null}if(A=xe.current,ks(c))Cu(c);else{var F=Fa(we.current);switch(A){case 1:A=F.createElementNS("http://www.w3.org/2000/svg",S);break;case 2:A=F.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;default:switch(S){case"svg":A=F.createElementNS("http://www.w3.org/2000/svg",S);break;case"math":A=F.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;case"script":A=F.createElement("div"),A.innerHTML="<script><\/script>",A=A.removeChild(A.firstChild);break;case"select":A=typeof x.is=="string"?F.createElement("select",{is:x.is}):F.createElement("select"),x.multiple?A.multiple=!0:x.size&&(A.size=x.size);break;default:A=typeof x.is=="string"?F.createElement(S,{is:x.is}):F.createElement(S)}}A[Kt]=c,A[Z]=x;e:for(F=c.child;F!==null;){if(F.tag===5||F.tag===6)A.appendChild(F.stateNode);else if(F.tag!==4&&F.tag!==27&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===c)break e;for(;F.sibling===null;){if(F.return===null||F.return===c)break e;F=F.return}F.sibling.return=F.return,F=F.sibling}c.stateNode=A;e:switch(mn(A,S,x),S){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}x&&_r(c)}}return Wt(c),ul(c,c.type,a===null?null:a.memoizedProps,c.pendingProps,b),null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==x&&_r(c);else{if(typeof x!="string"&&c.stateNode===null)throw Error(s(166));if(a=we.current,ks(c)){if(a=c.stateNode,b=c.memoizedProps,x=null,S=hn,S!==null)switch(S.tag){case 27:case 5:x=S.memoizedProps}a[Kt]=c,a=!!(a.nodeValue===b||x!==null&&x.suppressHydrationWarning===!0||Hd(a.nodeValue,b)),a||kr(c,!0)}else a=Fa(a).createTextNode(x),a[Kt]=c,c.stateNode=a}return Wt(c),null;case 31:if(b=c.memoizedState,a===null||a.memoizedState!==null){if(x=ks(c),b!==null){if(a===null){if(!x)throw Error(s(318));if(a=c.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(557));a[Kt]=c}else as(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Wt(c),a=!1}else b=_o(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=b),a=!0;if(!a)return c.flags&256?(Nn(c),c):(Nn(c),null);if((c.flags&128)!==0)throw Error(s(558))}return Wt(c),null;case 13:if(x=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(S=ks(c),x!==null&&x.dehydrated!==null){if(a===null){if(!S)throw Error(s(318));if(S=c.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(s(317));S[Kt]=c}else as(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Wt(c),S=!1}else S=_o(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=S),S=!0;if(!S)return c.flags&256?(Nn(c),c):(Nn(c),null)}return Nn(c),(c.flags&128)!==0?(c.lanes=b,c):(b=x!==null,a=a!==null&&a.memoizedState!==null,b&&(x=c.child,S=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(S=x.alternate.memoizedState.cachePool.pool),A=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(A=x.memoizedState.cachePool.pool),A!==S&&(x.flags|=2048)),b!==a&&b&&(c.child.flags|=8192),Ea(c,c.updateQueue),Wt(c),null);case 4:return M(),a===null&&Il(c.stateNode.containerInfo),Wt(c),null;case 10:return mr(c.type),Wt(c),null;case 19:if(le(en),x=c.memoizedState,x===null)return Wt(c),null;if(S=(c.flags&128)!==0,A=x.rendering,A===null)if(S)Mi(x,!1);else{if(Zt!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(A=ca(a),A!==null){for(c.flags|=128,Mi(x,!1),a=A.updateQueue,c.updateQueue=a,Ea(c,a),c.subtreeFlags=0,a=b,b=c.child;b!==null;)wu(b,a),b=b.sibling;return be(en,en.current&1|2),St&&fr(c,x.treeForkCount),c.child}a=a.sibling}x.tail!==null&&Ie()>Ma&&(c.flags|=128,S=!0,Mi(x,!1),c.lanes=4194304)}else{if(!S)if(a=ca(A),a!==null){if(c.flags|=128,S=!0,a=a.updateQueue,c.updateQueue=a,Ea(c,a),Mi(x,!0),x.tail===null&&x.tailMode==="hidden"&&!A.alternate&&!St)return Wt(c),null}else 2*Ie()-x.renderingStartTime>Ma&&b!==536870912&&(c.flags|=128,S=!0,Mi(x,!1),c.lanes=4194304);x.isBackwards?(A.sibling=c.child,c.child=A):(a=x.last,a!==null?a.sibling=A:c.child=A,x.last=A)}return x.tail!==null?(a=x.tail,x.rendering=a,x.tail=a.sibling,x.renderingStartTime=Ie(),a.sibling=null,b=en.current,be(en,S?b&1|2:b&1),St&&fr(c,x.treeForkCount),a):(Wt(c),null);case 22:case 23:return Nn(c),Bo(),x=c.memoizedState!==null,a!==null?a.memoizedState!==null!==x&&(c.flags|=8192):x&&(c.flags|=8192),x?(b&536870912)!==0&&(c.flags&128)===0&&(Wt(c),c.subtreeFlags&6&&(c.flags|=8192)):Wt(c),b=c.updateQueue,b!==null&&Ea(c,b.retryQueue),b=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(b=a.memoizedState.cachePool.pool),x=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(x=c.memoizedState.cachePool.pool),x!==b&&(c.flags|=2048),a!==null&&le(us),null;case 24:return b=null,a!==null&&(b=a.memoizedState.cache),c.memoizedState.cache!==b&&(c.flags|=2048),mr(nn),Wt(c),null;case 25:return null;case 30:return null}throw Error(s(156,c.tag))}function Cf(a,c){switch(yo(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return mr(nn),M(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return V(c),null;case 31:if(c.memoizedState!==null){if(Nn(c),c.alternate===null)throw Error(s(340));as()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 13:if(Nn(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(s(340));as()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return le(en),null;case 4:return M(),null;case 10:return mr(c.type),null;case 22:case 23:return Nn(c),Bo(),a!==null&&le(us),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return mr(nn),null;case 25:return null;default:return null}}function Jc(a,c){switch(yo(c),c.tag){case 3:mr(nn),M();break;case 26:case 27:case 5:V(c);break;case 4:M();break;case 31:c.memoizedState!==null&&Nn(c);break;case 13:Nn(c);break;case 19:le(en);break;case 10:mr(c.type);break;case 22:case 23:Nn(c),Bo(),a!==null&&le(us);break;case 24:mr(nn)}}function Ri(a,c){try{var b=c.updateQueue,x=b!==null?b.lastEffect:null;if(x!==null){var S=x.next;b=S;do{if((b.tag&a)===a){x=void 0;var A=b.create,F=b.inst;x=A(),F.destroy=x}b=b.next}while(b!==S)}}catch(Q){Ot(c,c.return,Q)}}function zr(a,c,b){try{var x=c.updateQueue,S=x!==null?x.lastEffect:null;if(S!==null){var A=S.next;x=A;do{if((x.tag&a)===a){var F=x.inst,Q=F.destroy;if(Q!==void 0){F.destroy=void 0,S=c;var me=b,Ce=Q;try{Ce()}catch(Le){Ot(S,me,Le)}}}x=x.next}while(x!==A)}}catch(Le){Ot(c,c.return,Le)}}function Kc(a){var c=a.updateQueue;if(c!==null){var b=a.stateNode;try{zu(c,b)}catch(x){Ot(a,a.return,x)}}}function Qc(a,c,b){b.props=ps(a.type,a.memoizedProps),b.state=a.memoizedState;try{b.componentWillUnmount()}catch(x){Ot(a,c,x)}}function Ii(a,c){try{var b=a.ref;if(b!==null){switch(a.tag){case 26:case 27:case 5:var x=a.stateNode;break;case 30:x=a.stateNode;break;default:x=a.stateNode}typeof b=="function"?a.refCleanup=b(x):b.current=x}}catch(S){Ot(a,c,S)}}function rr(a,c){var b=a.ref,x=a.refCleanup;if(b!==null)if(typeof x=="function")try{x()}catch(S){Ot(a,c,S)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof b=="function")try{b(null)}catch(S){Ot(a,c,S)}else b.current=null}function Zc(a){var c=a.type,b=a.memoizedProps,x=a.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":b.autoFocus&&x.focus();break e;case"img":b.src?x.src=b.src:b.srcSet&&(x.srcset=b.srcSet)}}catch(S){Ot(a,a.return,S)}}function cl(a,c,b){try{var x=a.stateNode;Kf(x,a.type,b,c),x[Z]=c}catch(S){Ot(a,a.return,S)}}function ed(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Wr(a.type)||a.tag===4}function dl(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||ed(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Wr(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function hl(a,c,b){var x=a.tag;if(x===5||x===6)a=a.stateNode,c?(b.nodeType===9?b.body:b.nodeName==="HTML"?b.ownerDocument.body:b).insertBefore(a,c):(c=b.nodeType===9?b.body:b.nodeName==="HTML"?b.ownerDocument.body:b,c.appendChild(a),b=b._reactRootContainer,b!=null||c.onclick!==null||(c.onclick=zn));else if(x!==4&&(x===27&&Wr(a.type)&&(b=a.stateNode,c=null),a=a.child,a!==null))for(hl(a,c,b),a=a.sibling;a!==null;)hl(a,c,b),a=a.sibling}function Sa(a,c,b){var x=a.tag;if(x===5||x===6)a=a.stateNode,c?b.insertBefore(a,c):b.appendChild(a);else if(x!==4&&(x===27&&Wr(a.type)&&(b=a.stateNode),a=a.child,a!==null))for(Sa(a,c,b),a=a.sibling;a!==null;)Sa(a,c,b),a=a.sibling}function td(a){var c=a.stateNode,b=a.memoizedProps;try{for(var x=a.type,S=c.attributes;S.length;)c.removeAttributeNode(S[0]);mn(c,x,b),c[Kt]=a,c[Z]=b}catch(A){Ot(a,a.return,A)}}var vr=!1,an=!1,fl=!1,nd=typeof WeakSet=="function"?WeakSet:Set,dn=null;function Mf(a,c){if(a=a.containerInfo,kl=qa,a=pu(a),io(a)){if("selectionStart"in a)var b={start:a.selectionStart,end:a.selectionEnd};else e:{b=(b=a.ownerDocument)&&b.defaultView||window;var x=b.getSelection&&b.getSelection();if(x&&x.rangeCount!==0){b=x.anchorNode;var S=x.anchorOffset,A=x.focusNode;x=x.focusOffset;try{b.nodeType,A.nodeType}catch{b=null;break e}var F=0,Q=-1,me=-1,Ce=0,Le=0,Ue=a,Me=null;t:for(;;){for(var Ve;Ue!==b||S!==0&&Ue.nodeType!==3||(Q=F+S),Ue!==A||x!==0&&Ue.nodeType!==3||(me=F+x),Ue.nodeType===3&&(F+=Ue.nodeValue.length),(Ve=Ue.firstChild)!==null;)Me=Ue,Ue=Ve;for(;;){if(Ue===a)break t;if(Me===b&&++Ce===S&&(Q=F),Me===A&&++Le===x&&(me=F),(Ve=Ue.nextSibling)!==null)break;Ue=Me,Me=Ue.parentNode}Ue=Ve}b=Q===-1||me===-1?null:{start:Q,end:me}}else b=null}b=b||{start:0,end:0}}else b=null;for(Nl={focusedElem:a,selectionRange:b},qa=!1,dn=c;dn!==null;)if(c=dn,a=c.child,(c.subtreeFlags&1028)!==0&&a!==null)a.return=c,dn=a;else for(;dn!==null;){switch(c=dn,A=c.alternate,a=c.flags,c.tag){case 0:if((a&4)!==0&&(a=c.updateQueue,a=a!==null?a.events:null,a!==null))for(b=0;b<a.length;b++)S=a[b],S.ref.impl=S.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&A!==null){a=void 0,b=c,S=A.memoizedProps,A=A.memoizedState,x=b.stateNode;try{var Ke=ps(b.type,S);a=x.getSnapshotBeforeUpdate(Ke,A),x.__reactInternalSnapshotBeforeUpdate=a}catch(lt){Ot(b,b.return,lt)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,b=a.nodeType,b===9)Ll(a);else if(b===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Ll(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=c.sibling,a!==null){a.return=c.return,dn=a;break}dn=c.return}}function rd(a,c,b){var x=b.flags;switch(b.tag){case 0:case 11:case 15:Tr(a,b),x&4&&Ri(5,b);break;case 1:if(Tr(a,b),x&4)if(a=b.stateNode,c===null)try{a.componentDidMount()}catch(F){Ot(b,b.return,F)}else{var S=ps(b.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(S,c,a.__reactInternalSnapshotBeforeUpdate)}catch(F){Ot(b,b.return,F)}}x&64&&Kc(b),x&512&&Ii(b,b.return);break;case 3:if(Tr(a,b),x&64&&(a=b.updateQueue,a!==null)){if(c=null,b.child!==null)switch(b.child.tag){case 27:case 5:c=b.child.stateNode;break;case 1:c=b.child.stateNode}try{zu(a,c)}catch(F){Ot(b,b.return,F)}}break;case 27:c===null&&x&4&&td(b);case 26:case 5:Tr(a,b),c===null&&x&4&&Zc(b),x&512&&Ii(b,b.return);break;case 12:Tr(a,b);break;case 31:Tr(a,b),x&4&&ad(a,b);break;case 13:Tr(a,b),x&4&&od(a,b),x&64&&(a=b.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(b=Ff.bind(null,b),ip(a,b))));break;case 22:if(x=b.memoizedState!==null||vr,!x){c=c!==null&&c.memoizedState!==null||an,S=vr;var A=an;vr=x,(an=c)&&!A?wr(a,b,(b.subtreeFlags&8772)!==0):Tr(a,b),vr=S,an=A}break;case 30:break;default:Tr(a,b)}}function sd(a){var c=a.alternate;c!==null&&(a.alternate=null,sd(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&Qe(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Xt=null,An=!1;function xr(a,c,b){for(b=b.child;b!==null;)id(a,c,b),b=b.sibling}function id(a,c,b){if(qe&&typeof qe.onCommitFiberUnmount=="function")try{qe.onCommitFiberUnmount(ut,b)}catch{}switch(b.tag){case 26:an||rr(b,c),xr(a,c,b),b.memoizedState?b.memoizedState.count--:b.stateNode&&(b=b.stateNode,b.parentNode.removeChild(b));break;case 27:an||rr(b,c);var x=Xt,S=An;Wr(b.type)&&(Xt=b.stateNode,An=!1),xr(a,c,b),Ui(b.stateNode),Xt=x,An=S;break;case 5:an||rr(b,c);case 6:if(x=Xt,S=An,Xt=null,xr(a,c,b),Xt=x,An=S,Xt!==null)if(An)try{(Xt.nodeType===9?Xt.body:Xt.nodeName==="HTML"?Xt.ownerDocument.body:Xt).removeChild(b.stateNode)}catch(A){Ot(b,c,A)}else try{Xt.removeChild(b.stateNode)}catch(A){Ot(b,c,A)}break;case 18:Xt!==null&&(An?(a=Xt,Kd(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,b.stateNode),ti(a)):Kd(Xt,b.stateNode));break;case 4:x=Xt,S=An,Xt=b.stateNode.containerInfo,An=!0,xr(a,c,b),Xt=x,An=S;break;case 0:case 11:case 14:case 15:zr(2,b,c),an||zr(4,b,c),xr(a,c,b);break;case 1:an||(rr(b,c),x=b.stateNode,typeof x.componentWillUnmount=="function"&&Qc(b,c,x)),xr(a,c,b);break;case 21:xr(a,c,b);break;case 22:an=(x=an)||b.memoizedState!==null,xr(a,c,b),an=x;break;default:xr(a,c,b)}}function ad(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{ti(a)}catch(b){Ot(c,c.return,b)}}}function od(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{ti(a)}catch(b){Ot(c,c.return,b)}}function Rf(a){switch(a.tag){case 31:case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new nd),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new nd),c;default:throw Error(s(435,a.tag))}}function Pa(a,c){var b=Rf(a);c.forEach(function(x){if(!b.has(x)){b.add(x);var S=Uf.bind(null,a,x);x.then(S,S)}})}function Cn(a,c){var b=c.deletions;if(b!==null)for(var x=0;x<b.length;x++){var S=b[x],A=a,F=c,Q=F;e:for(;Q!==null;){switch(Q.tag){case 27:if(Wr(Q.type)){Xt=Q.stateNode,An=!1;break e}break;case 5:Xt=Q.stateNode,An=!1;break e;case 3:case 4:Xt=Q.stateNode.containerInfo,An=!0;break e}Q=Q.return}if(Xt===null)throw Error(s(160));id(A,F,S),Xt=null,An=!1,A=S.alternate,A!==null&&(A.return=null),S.return=null}if(c.subtreeFlags&13886)for(c=c.child;c!==null;)ld(c,a),c=c.sibling}var Zn=null;function ld(a,c){var b=a.alternate,x=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Cn(c,a),Mn(a),x&4&&(zr(3,a,a.return),Ri(3,a),zr(5,a,a.return));break;case 1:Cn(c,a),Mn(a),x&512&&(an||b===null||rr(b,b.return)),x&64&&vr&&(a=a.updateQueue,a!==null&&(x=a.callbacks,x!==null&&(b=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=b===null?x:b.concat(x))));break;case 26:var S=Zn;if(Cn(c,a),Mn(a),x&512&&(an||b===null||rr(b,b.return)),x&4){var A=b!==null?b.memoizedState:null;if(x=a.memoizedState,b===null)if(x===null)if(a.stateNode===null){e:{x=a.type,b=a.memoizedProps,S=S.ownerDocument||S;t:switch(x){case"title":A=S.getElementsByTagName("title")[0],(!A||A[$e]||A[Kt]||A.namespaceURI==="http://www.w3.org/2000/svg"||A.hasAttribute("itemprop"))&&(A=S.createElement(x),S.head.insertBefore(A,S.querySelector("head > title"))),mn(A,x,b),A[Kt]=a,_t(A),x=A;break e;case"link":var F=lh("link","href",S).get(x+(b.href||""));if(F){for(var Q=0;Q<F.length;Q++)if(A=F[Q],A.getAttribute("href")===(b.href==null||b.href===""?null:b.href)&&A.getAttribute("rel")===(b.rel==null?null:b.rel)&&A.getAttribute("title")===(b.title==null?null:b.title)&&A.getAttribute("crossorigin")===(b.crossOrigin==null?null:b.crossOrigin)){F.splice(Q,1);break t}}A=S.createElement(x),mn(A,x,b),S.head.appendChild(A);break;case"meta":if(F=lh("meta","content",S).get(x+(b.content||""))){for(Q=0;Q<F.length;Q++)if(A=F[Q],A.getAttribute("content")===(b.content==null?null:""+b.content)&&A.getAttribute("name")===(b.name==null?null:b.name)&&A.getAttribute("property")===(b.property==null?null:b.property)&&A.getAttribute("http-equiv")===(b.httpEquiv==null?null:b.httpEquiv)&&A.getAttribute("charset")===(b.charSet==null?null:b.charSet)){F.splice(Q,1);break t}}A=S.createElement(x),mn(A,x,b),S.head.appendChild(A);break;default:throw Error(s(468,x))}A[Kt]=a,_t(A),x=A}a.stateNode=x}else uh(S,a.type,a.stateNode);else a.stateNode=oh(S,x,a.memoizedProps);else A!==x?(A===null?b.stateNode!==null&&(b=b.stateNode,b.parentNode.removeChild(b)):A.count--,x===null?uh(S,a.type,a.stateNode):oh(S,x,a.memoizedProps)):x===null&&a.stateNode!==null&&cl(a,a.memoizedProps,b.memoizedProps)}break;case 27:Cn(c,a),Mn(a),x&512&&(an||b===null||rr(b,b.return)),b!==null&&x&4&&cl(a,a.memoizedProps,b.memoizedProps);break;case 5:if(Cn(c,a),Mn(a),x&512&&(an||b===null||rr(b,b.return)),a.flags&32){S=a.stateNode;try{lr(S,"")}catch(Ke){Ot(a,a.return,Ke)}}x&4&&a.stateNode!=null&&(S=a.memoizedProps,cl(a,S,b!==null?b.memoizedProps:S)),x&1024&&(fl=!0);break;case 6:if(Cn(c,a),Mn(a),x&4){if(a.stateNode===null)throw Error(s(162));x=a.memoizedProps,b=a.stateNode;try{b.nodeValue=x}catch(Ke){Ot(a,a.return,Ke)}}break;case 3:if(Ga=null,S=Zn,Zn=Ua(c.containerInfo),Cn(c,a),Zn=S,Mn(a),x&4&&b!==null&&b.memoizedState.isDehydrated)try{ti(c.containerInfo)}catch(Ke){Ot(a,a.return,Ke)}fl&&(fl=!1,ud(a));break;case 4:x=Zn,Zn=Ua(a.stateNode.containerInfo),Cn(c,a),Mn(a),Zn=x;break;case 12:Cn(c,a),Mn(a);break;case 31:Cn(c,a),Mn(a),x&4&&(x=a.updateQueue,x!==null&&(a.updateQueue=null,Pa(a,x)));break;case 13:Cn(c,a),Mn(a),a.child.flags&8192&&a.memoizedState!==null!=(b!==null&&b.memoizedState!==null)&&(Ca=Ie()),x&4&&(x=a.updateQueue,x!==null&&(a.updateQueue=null,Pa(a,x)));break;case 22:S=a.memoizedState!==null;var me=b!==null&&b.memoizedState!==null,Ce=vr,Le=an;if(vr=Ce||S,an=Le||me,Cn(c,a),an=Le,vr=Ce,Mn(a),x&8192)e:for(c=a.stateNode,c._visibility=S?c._visibility&-2:c._visibility|1,S&&(b===null||me||vr||an||ms(a)),b=null,c=a;;){if(c.tag===5||c.tag===26){if(b===null){me=b=c;try{if(A=me.stateNode,S)F=A.style,typeof F.setProperty=="function"?F.setProperty("display","none","important"):F.display="none";else{Q=me.stateNode;var Ue=me.memoizedProps.style,Me=Ue!=null&&Ue.hasOwnProperty("display")?Ue.display:null;Q.style.display=Me==null||typeof Me=="boolean"?"":(""+Me).trim()}}catch(Ke){Ot(me,me.return,Ke)}}}else if(c.tag===6){if(b===null){me=c;try{me.stateNode.nodeValue=S?"":me.memoizedProps}catch(Ke){Ot(me,me.return,Ke)}}}else if(c.tag===18){if(b===null){me=c;try{var Ve=me.stateNode;S?Qd(Ve,!0):Qd(me.stateNode,!1)}catch(Ke){Ot(me,me.return,Ke)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;b===c&&(b=null),c=c.return}b===c&&(b=null),c.sibling.return=c.return,c=c.sibling}x&4&&(x=a.updateQueue,x!==null&&(b=x.retryQueue,b!==null&&(x.retryQueue=null,Pa(a,b))));break;case 19:Cn(c,a),Mn(a),x&4&&(x=a.updateQueue,x!==null&&(a.updateQueue=null,Pa(a,x)));break;case 30:break;case 21:break;default:Cn(c,a),Mn(a)}}function Mn(a){var c=a.flags;if(c&2){try{for(var b,x=a.return;x!==null;){if(ed(x)){b=x;break}x=x.return}if(b==null)throw Error(s(160));switch(b.tag){case 27:var S=b.stateNode,A=dl(a);Sa(a,A,S);break;case 5:var F=b.stateNode;b.flags&32&&(lr(F,""),b.flags&=-33);var Q=dl(a);Sa(a,Q,F);break;case 3:case 4:var me=b.stateNode.containerInfo,Ce=dl(a);hl(a,Ce,me);break;default:throw Error(s(161))}}catch(Le){Ot(a,a.return,Le)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function ud(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;ud(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function Tr(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)rd(a,c.alternate,c),c=c.sibling}function ms(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:zr(4,c,c.return),ms(c);break;case 1:rr(c,c.return);var b=c.stateNode;typeof b.componentWillUnmount=="function"&&Qc(c,c.return,b),ms(c);break;case 27:Ui(c.stateNode);case 26:case 5:rr(c,c.return),ms(c);break;case 22:c.memoizedState===null&&ms(c);break;case 30:ms(c);break;default:ms(c)}a=a.sibling}}function wr(a,c,b){for(b=b&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var x=c.alternate,S=a,A=c,F=A.flags;switch(A.tag){case 0:case 11:case 15:wr(S,A,b),Ri(4,A);break;case 1:if(wr(S,A,b),x=A,S=x.stateNode,typeof S.componentDidMount=="function")try{S.componentDidMount()}catch(Ce){Ot(x,x.return,Ce)}if(x=A,S=x.updateQueue,S!==null){var Q=x.stateNode;try{var me=S.shared.hiddenCallbacks;if(me!==null)for(S.shared.hiddenCallbacks=null,S=0;S<me.length;S++)Uu(me[S],Q)}catch(Ce){Ot(x,x.return,Ce)}}b&&F&64&&Kc(A),Ii(A,A.return);break;case 27:td(A);case 26:case 5:wr(S,A,b),b&&x===null&&F&4&&Zc(A),Ii(A,A.return);break;case 12:wr(S,A,b);break;case 31:wr(S,A,b),b&&F&4&&ad(S,A);break;case 13:wr(S,A,b),b&&F&4&&od(S,A);break;case 22:A.memoizedState===null&&wr(S,A,b),Ii(A,A.return);break;case 30:break;default:wr(S,A,b)}c=c.sibling}}function pl(a,c){var b=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(b=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==b&&(a!=null&&a.refCount++,b!=null&&yi(b))}function ml(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&yi(a))}function er(a,c,b,x){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)cd(a,c,b,x),c=c.sibling}function cd(a,c,b,x){var S=c.flags;switch(c.tag){case 0:case 11:case 15:er(a,c,b,x),S&2048&&Ri(9,c);break;case 1:er(a,c,b,x);break;case 3:er(a,c,b,x),S&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&yi(a)));break;case 12:if(S&2048){er(a,c,b,x),a=c.stateNode;try{var A=c.memoizedProps,F=A.id,Q=A.onPostCommit;typeof Q=="function"&&Q(F,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(me){Ot(c,c.return,me)}}else er(a,c,b,x);break;case 31:er(a,c,b,x);break;case 13:er(a,c,b,x);break;case 23:break;case 22:A=c.stateNode,F=c.alternate,c.memoizedState!==null?A._visibility&2?er(a,c,b,x):Bi(a,c):A._visibility&2?er(a,c,b,x):(A._visibility|=2,js(a,c,b,x,(c.subtreeFlags&10256)!==0||!1)),S&2048&&pl(F,c);break;case 24:er(a,c,b,x),S&2048&&ml(c.alternate,c);break;default:er(a,c,b,x)}}function js(a,c,b,x,S){for(S=S&&((c.subtreeFlags&10256)!==0||!1),c=c.child;c!==null;){var A=a,F=c,Q=b,me=x,Ce=F.flags;switch(F.tag){case 0:case 11:case 15:js(A,F,Q,me,S),Ri(8,F);break;case 23:break;case 22:var Le=F.stateNode;F.memoizedState!==null?Le._visibility&2?js(A,F,Q,me,S):Bi(A,F):(Le._visibility|=2,js(A,F,Q,me,S)),S&&Ce&2048&&pl(F.alternate,F);break;case 24:js(A,F,Q,me,S),S&&Ce&2048&&ml(F.alternate,F);break;default:js(A,F,Q,me,S)}c=c.sibling}}function Bi(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var b=a,x=c,S=x.flags;switch(x.tag){case 22:Bi(b,x),S&2048&&pl(x.alternate,x);break;case 24:Bi(b,x),S&2048&&ml(x.alternate,x);break;default:Bi(b,x)}c=c.sibling}}var Vi=8192;function Hs(a,c,b){if(a.subtreeFlags&Vi)for(a=a.child;a!==null;)dd(a,c,b),a=a.sibling}function dd(a,c,b){switch(a.tag){case 26:Hs(a,c,b),a.flags&Vi&&a.memoizedState!==null&&yp(b,Zn,a.memoizedState,a.memoizedProps);break;case 5:Hs(a,c,b);break;case 3:case 4:var x=Zn;Zn=Ua(a.stateNode.containerInfo),Hs(a,c,b),Zn=x;break;case 22:a.memoizedState===null&&(x=a.alternate,x!==null&&x.memoizedState!==null?(x=Vi,Vi=16777216,Hs(a,c,b),Vi=x):Hs(a,c,b));break;default:Hs(a,c,b)}}function hd(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function ki(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var b=0;b<c.length;b++){var x=c[b];dn=x,pd(x,a)}hd(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)fd(a),a=a.sibling}function fd(a){switch(a.tag){case 0:case 11:case 15:ki(a),a.flags&2048&&zr(9,a,a.return);break;case 3:ki(a);break;case 12:ki(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,Aa(a)):ki(a);break;default:ki(a)}}function Aa(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var b=0;b<c.length;b++){var x=c[b];dn=x,pd(x,a)}hd(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:zr(8,c,c.return),Aa(c);break;case 22:b=c.stateNode,b._visibility&2&&(b._visibility&=-3,Aa(c));break;default:Aa(c)}a=a.sibling}}function pd(a,c){for(;dn!==null;){var b=dn;switch(b.tag){case 0:case 11:case 15:zr(8,b,c);break;case 23:case 22:if(b.memoizedState!==null&&b.memoizedState.cachePool!==null){var x=b.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:yi(b.memoizedState.cache)}if(x=b.child,x!==null)x.return=b,dn=x;else e:for(b=a;dn!==null;){x=dn;var S=x.sibling,A=x.return;if(sd(x),x===b){dn=null;break e}if(S!==null){S.return=A,dn=S;break e}dn=A}}}var Bf={getCacheForType:function(a){var c=fn(nn),b=c.data.get(a);return b===void 0&&(b=a(),c.data.set(a,b)),b},cacheSignal:function(){return fn(nn).controller.signal}},Vf=typeof WeakMap=="function"?WeakMap:Map,Bt=0,Ht=null,vt=null,Tt=0,Nt=0,On=null,Gr=!1,qs=!1,gl=!1,Er=0,Zt=0,$r=0,gs=0,yl=0,Dn=0,Ys=0,Ni=null,Rn=null,bl=!1,Ca=0,md=0,Ma=1/0,Ra=null,jr=null,cn=0,Hr=null,Ws=null,Sr=0,_l=0,vl=null,gd=null,Oi=0,xl=null;function Ln(){return(Bt&2)!==0&&Tt!==0?Tt&-Tt:k.T!==null?Al():Ar()}function yd(){if(Dn===0)if((Tt&536870912)===0||St){var a=Mt;Mt<<=1,(Mt&3932160)===0&&(Mt=262144),Dn=a}else Dn=536870912;return a=kn.current,a!==null&&(a.flags|=32),Dn}function In(a,c,b){(a===Ht&&(Nt===2||Nt===9)||a.cancelPendingCommit!==null)&&(Xs(a,0),qr(a,Tt,Dn,!1)),on(a,b),((Bt&2)===0||a!==Ht)&&(a===Ht&&((Bt&2)===0&&(gs|=b),Zt===4&&qr(a,Tt,Dn,!1)),sr(a))}function bd(a,c,b){if((Bt&6)!==0)throw Error(s(327));var x=!b&&(c&127)===0&&(c&a.expiredLanes)===0||st(a,c),S=x?Of(a,c):wl(a,c,!0),A=x;do{if(S===0){qs&&!x&&qr(a,c,0,!1);break}else{if(b=a.current.alternate,A&&!kf(b)){S=wl(a,c,!1),A=!1;continue}if(S===2){if(A=c,a.errorRecoveryDisabledLanes&A)var F=0;else F=a.pendingLanes&-536870913,F=F!==0?F:F&536870912?536870912:0;if(F!==0){c=F;e:{var Q=a;S=Ni;var me=Q.current.memoizedState.isDehydrated;if(me&&(Xs(Q,F).flags|=256),F=wl(Q,F,!1),F!==2){if(gl&&!me){Q.errorRecoveryDisabledLanes|=A,gs|=A,S=4;break e}A=Rn,Rn=S,A!==null&&(Rn===null?Rn=A:Rn.push.apply(Rn,A))}S=F}if(A=!1,S!==2)continue}}if(S===1){Xs(a,0),qr(a,c,0,!0);break}e:{switch(x=a,A=S,A){case 0:case 1:throw Error(s(345));case 4:if((c&4194048)!==c)break;case 6:qr(x,c,Dn,!Gr);break e;case 2:Rn=null;break;case 3:case 5:break;default:throw Error(s(329))}if((c&62914560)===c&&(S=Ca+300-Ie(),10<S)){if(qr(x,c,Dn,!Gr),rt(x,0,!0)!==0)break e;Sr=c,x.timeoutHandle=Xd(_d.bind(null,x,b,Rn,Ra,bl,c,Dn,gs,Ys,Gr,A,"Throttled",-0,0),S);break e}_d(x,b,Rn,Ra,bl,c,Dn,gs,Ys,Gr,A,null,-0,0)}}break}while(!0);sr(a)}function _d(a,c,b,x,S,A,F,Q,me,Ce,Le,Ue,Me,Ve){if(a.timeoutHandle=-1,Ue=c.subtreeFlags,Ue&8192||(Ue&16785408)===16785408){Ue={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:zn},dd(c,A,Ue);var Ke=(A&62914560)===A?Ca-Ie():(A&4194048)===A?md-Ie():0;if(Ke=bp(Ue,Ke),Ke!==null){Sr=A,a.cancelPendingCommit=Ke(Ad.bind(null,a,c,A,b,x,S,F,Q,me,Le,Ue,null,Me,Ve)),qr(a,A,F,!Ce);return}}Ad(a,c,A,b,x,S,F,Q,me)}function kf(a){for(var c=a;;){var b=c.tag;if((b===0||b===11||b===15)&&c.flags&16384&&(b=c.updateQueue,b!==null&&(b=b.stores,b!==null)))for(var x=0;x<b.length;x++){var S=b[x],A=S.getSnapshot;S=S.value;try{if(!Bn(A(),S))return!1}catch{return!1}}if(b=c.child,c.subtreeFlags&16384&&b!==null)b.return=c,c=b;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function qr(a,c,b,x){c&=~yl,c&=~gs,a.suspendedLanes|=c,a.pingedLanes&=~c,x&&(a.warmLanes|=c),x=a.expirationTimes;for(var S=c;0<S;){var A=31-Pt(S),F=1<<A;x[A]=-1,S&=~F}b!==0&&Vt(a,b,c)}function Ia(){return(Bt&6)===0?(Di(0),!1):!0}function Tl(){if(vt!==null){if(Nt===0)var a=vt.return;else a=vt,pr=os=null,Lo(a),Fs=null,_i=0,a=vt;for(;a!==null;)Jc(a.alternate,a),a=a.return;vt=null}}function Xs(a,c){var b=a.timeoutHandle;b!==-1&&(a.timeoutHandle=-1,ep(b)),b=a.cancelPendingCommit,b!==null&&(a.cancelPendingCommit=null,b()),Sr=0,Tl(),Ht=a,vt=b=hr(a.current,null),Tt=c,Nt=0,On=null,Gr=!1,qs=st(a,c),gl=!1,Ys=Dn=yl=gs=$r=Zt=0,Rn=Ni=null,bl=!1,(c&8)!==0&&(c|=c&32);var x=a.entangledLanes;if(x!==0)for(a=a.entanglements,x&=c;0<x;){var S=31-Pt(x),A=1<<S;c|=a[S],x&=~A}return Er=c,Ki(),b}function vd(a,c){pt=null,k.H=Ai,c===Ls||c===ia?(c=Ou(),Nt=3):c===Po?(c=Ou(),Nt=4):Nt=c===el?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,On=c,vt===null&&(Zt=1,va(a,jn(c,a.current)))}function xd(){var a=kn.current;return a===null?!0:(Tt&4194048)===Tt?Wn===null:(Tt&62914560)===Tt||(Tt&536870912)!==0?a===Wn:!1}function Td(){var a=k.H;return k.H=Ai,a===null?Ai:a}function wd(){var a=k.A;return k.A=Bf,a}function Ba(){Zt=4,Gr||(Tt&4194048)!==Tt&&kn.current!==null||(qs=!0),($r&134217727)===0&&(gs&134217727)===0||Ht===null||qr(Ht,Tt,Dn,!1)}function wl(a,c,b){var x=Bt;Bt|=2;var S=Td(),A=wd();(Ht!==a||Tt!==c)&&(Ra=null,Xs(a,c)),c=!1;var F=Zt;e:do try{if(Nt!==0&&vt!==null){var Q=vt,me=On;switch(Nt){case 8:Tl(),F=6;break e;case 3:case 2:case 9:case 6:kn.current===null&&(c=!0);var Ce=Nt;if(Nt=0,On=null,Js(a,Q,me,Ce),b&&qs){F=0;break e}break;default:Ce=Nt,Nt=0,On=null,Js(a,Q,me,Ce)}}Nf(),F=Zt;break}catch(Le){vd(a,Le)}while(!0);return c&&a.shellSuspendCounter++,pr=os=null,Bt=x,k.H=S,k.A=A,vt===null&&(Ht=null,Tt=0,Ki()),F}function Nf(){for(;vt!==null;)Ed(vt)}function Of(a,c){var b=Bt;Bt|=2;var x=Td(),S=wd();Ht!==a||Tt!==c?(Ra=null,Ma=Ie()+500,Xs(a,c)):qs=st(a,c);e:do try{if(Nt!==0&&vt!==null){c=vt;var A=On;t:switch(Nt){case 1:Nt=0,On=null,Js(a,c,A,1);break;case 2:case 9:if(ku(A)){Nt=0,On=null,Sd(c);break}c=function(){Nt!==2&&Nt!==9||Ht!==a||(Nt=7),sr(a)},A.then(c,c);break e;case 3:Nt=7;break e;case 4:Nt=5;break e;case 7:ku(A)?(Nt=0,On=null,Sd(c)):(Nt=0,On=null,Js(a,c,A,7));break;case 5:var F=null;switch(vt.tag){case 26:F=vt.memoizedState;case 5:case 27:var Q=vt;if(F?ch(F):Q.stateNode.complete){Nt=0,On=null;var me=Q.sibling;if(me!==null)vt=me;else{var Ce=Q.return;Ce!==null?(vt=Ce,Va(Ce)):vt=null}break t}}Nt=0,On=null,Js(a,c,A,5);break;case 6:Nt=0,On=null,Js(a,c,A,6);break;case 8:Tl(),Zt=6;break e;default:throw Error(s(462))}}Df();break}catch(Le){vd(a,Le)}while(!0);return pr=os=null,k.H=x,k.A=S,Bt=b,vt!==null?0:(Ht=null,Tt=0,Ki(),Zt)}function Df(){for(;vt!==null&&!te();)Ed(vt)}function Ed(a){var c=Wc(a.alternate,a,Er);a.memoizedProps=a.pendingProps,c===null?Va(a):vt=c}function Sd(a){var c=a,b=c.alternate;switch(c.tag){case 15:case 0:c=Gc(b,c,c.pendingProps,c.type,void 0,Tt);break;case 11:c=Gc(b,c,c.pendingProps,c.type.render,c.ref,Tt);break;case 5:Lo(c);default:Jc(b,c),c=vt=wu(c,Er),c=Wc(b,c,Er)}a.memoizedProps=a.pendingProps,c===null?Va(a):vt=c}function Js(a,c,b,x){pr=os=null,Lo(c),Fs=null,_i=0;var S=c.return;try{if(Ef(a,S,c,b,Tt)){Zt=1,va(a,jn(b,a.current)),vt=null;return}}catch(A){if(S!==null)throw vt=S,A;Zt=1,va(a,jn(b,a.current)),vt=null;return}c.flags&32768?(St||x===1?a=!0:qs||(Tt&536870912)!==0?a=!1:(Gr=a=!0,(x===2||x===9||x===3||x===6)&&(x=kn.current,x!==null&&x.tag===13&&(x.flags|=16384))),Pd(c,a)):Va(c)}function Va(a){var c=a;do{if((c.flags&32768)!==0){Pd(c,Gr);return}a=c.return;var b=Af(c.alternate,c,Er);if(b!==null){vt=b;return}if(c=c.sibling,c!==null){vt=c;return}vt=c=a}while(c!==null);Zt===0&&(Zt=5)}function Pd(a,c){do{var b=Cf(a.alternate,a);if(b!==null){b.flags&=32767,vt=b;return}if(b=a.return,b!==null&&(b.flags|=32768,b.subtreeFlags=0,b.deletions=null),!c&&(a=a.sibling,a!==null)){vt=a;return}vt=a=b}while(a!==null);Zt=6,vt=null}function Ad(a,c,b,x,S,A,F,Q,me){a.cancelPendingCommit=null;do ka();while(cn!==0);if((Bt&6)!==0)throw Error(s(327));if(c!==null){if(c===a.current)throw Error(s(177));if(A=c.lanes|c.childLanes,A|=co,Tn(a,b,A,F,Q,me),a===Ht&&(vt=Ht=null,Tt=0),Ws=c,Hr=a,Sr=b,_l=A,vl=S,gd=x,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,zf(Ge,function(){return Bd(),null})):(a.callbackNode=null,a.callbackPriority=0),x=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||x){x=k.T,k.T=null,S=H.p,H.p=2,F=Bt,Bt|=4;try{Mf(a,c,b)}finally{Bt=F,H.p=S,k.T=x}}cn=1,Cd(),Md(),Rd()}}function Cd(){if(cn===1){cn=0;var a=Hr,c=Ws,b=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||b){b=k.T,k.T=null;var x=H.p;H.p=2;var S=Bt;Bt|=4;try{ld(c,a);var A=Nl,F=pu(a.containerInfo),Q=A.focusedElem,me=A.selectionRange;if(F!==Q&&Q&&Q.ownerDocument&&fu(Q.ownerDocument.documentElement,Q)){if(me!==null&&io(Q)){var Ce=me.start,Le=me.end;if(Le===void 0&&(Le=Ce),"selectionStart"in Q)Q.selectionStart=Ce,Q.selectionEnd=Math.min(Le,Q.value.length);else{var Ue=Q.ownerDocument||document,Me=Ue&&Ue.defaultView||window;if(Me.getSelection){var Ve=Me.getSelection(),Ke=Q.textContent.length,lt=Math.min(me.start,Ke),Ut=me.end===void 0?lt:Math.min(me.end,Ke);!Ve.extend&&lt>Ut&&(F=Ut,Ut=lt,lt=F);var Te=hu(Q,lt),_e=hu(Q,Ut);if(Te&&_e&&(Ve.rangeCount!==1||Ve.anchorNode!==Te.node||Ve.anchorOffset!==Te.offset||Ve.focusNode!==_e.node||Ve.focusOffset!==_e.offset)){var Ae=Ue.createRange();Ae.setStart(Te.node,Te.offset),Ve.removeAllRanges(),lt>Ut?(Ve.addRange(Ae),Ve.extend(_e.node,_e.offset)):(Ae.setEnd(_e.node,_e.offset),Ve.addRange(Ae))}}}}for(Ue=[],Ve=Q;Ve=Ve.parentNode;)Ve.nodeType===1&&Ue.push({element:Ve,left:Ve.scrollLeft,top:Ve.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<Ue.length;Q++){var Fe=Ue[Q];Fe.element.scrollLeft=Fe.left,Fe.element.scrollTop=Fe.top}}qa=!!kl,Nl=kl=null}finally{Bt=S,H.p=x,k.T=b}}a.current=c,cn=2}}function Md(){if(cn===2){cn=0;var a=Hr,c=Ws,b=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||b){b=k.T,k.T=null;var x=H.p;H.p=2;var S=Bt;Bt|=4;try{rd(a,c.alternate,c)}finally{Bt=S,H.p=x,k.T=b}}cn=3}}function Rd(){if(cn===4||cn===3){cn=0,ue();var a=Hr,c=Ws,b=Sr,x=gd;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?cn=5:(cn=0,Ws=Hr=null,Id(a,a.pendingLanes));var S=a.pendingLanes;if(S===0&&(jr=null),ir(b),c=c.stateNode,qe&&typeof qe.onCommitFiberRoot=="function")try{qe.onCommitFiberRoot(ut,c,void 0,(c.current.flags&128)===128)}catch{}if(x!==null){c=k.T,S=H.p,H.p=2,k.T=null;try{for(var A=a.onRecoverableError,F=0;F<x.length;F++){var Q=x[F];A(Q.value,{componentStack:Q.stack})}}finally{k.T=c,H.p=S}}(Sr&3)!==0&&ka(),sr(a),S=a.pendingLanes,(b&261930)!==0&&(S&42)!==0?a===xl?Oi++:(Oi=0,xl=a):Oi=0,Di(0)}}function Id(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,yi(c)))}function ka(){return Cd(),Md(),Rd(),Bd()}function Bd(){if(cn!==5)return!1;var a=Hr,c=_l;_l=0;var b=ir(Sr),x=k.T,S=H.p;try{H.p=32>b?32:b,k.T=null,b=vl,vl=null;var A=Hr,F=Sr;if(cn=0,Ws=Hr=null,Sr=0,(Bt&6)!==0)throw Error(s(331));var Q=Bt;if(Bt|=4,fd(A.current),cd(A,A.current,F,b),Bt=Q,Di(0,!1),qe&&typeof qe.onPostCommitFiberRoot=="function")try{qe.onPostCommitFiberRoot(ut,A)}catch{}return!0}finally{H.p=S,k.T=x,Id(a,c)}}function Vd(a,c,b){c=jn(b,c),c=Zo(a.stateNode,c,2),a=Lr(a,c,2),a!==null&&(on(a,2),sr(a))}function Ot(a,c,b){if(a.tag===3)Vd(a,a,b);else for(;c!==null;){if(c.tag===3){Vd(c,a,b);break}else if(c.tag===1){var x=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(jr===null||!jr.has(x))){a=jn(b,a),b=kc(2),x=Lr(c,b,2),x!==null&&(Nc(b,x,c,a),on(x,2),sr(x));break}}c=c.return}}function El(a,c,b){var x=a.pingCache;if(x===null){x=a.pingCache=new Vf;var S=new Set;x.set(c,S)}else S=x.get(c),S===void 0&&(S=new Set,x.set(c,S));S.has(b)||(gl=!0,S.add(b),a=Lf.bind(null,a,c,b),c.then(a,a))}function Lf(a,c,b){var x=a.pingCache;x!==null&&x.delete(c),a.pingedLanes|=a.suspendedLanes&b,a.warmLanes&=~b,Ht===a&&(Tt&b)===b&&(Zt===4||Zt===3&&(Tt&62914560)===Tt&&300>Ie()-Ca?(Bt&2)===0&&Xs(a,0):yl|=b,Ys===Tt&&(Ys=0)),sr(a)}function kd(a,c){c===0&&(c=Dt()),a=ss(a,c),a!==null&&(on(a,c),sr(a))}function Ff(a){var c=a.memoizedState,b=0;c!==null&&(b=c.retryLane),kd(a,b)}function Uf(a,c){var b=0;switch(a.tag){case 31:case 13:var x=a.stateNode,S=a.memoizedState;S!==null&&(b=S.retryLane);break;case 19:x=a.stateNode;break;case 22:x=a.stateNode._retryCache;break;default:throw Error(s(314))}x!==null&&x.delete(c),kd(a,b)}function zf(a,c){return ye(a,c)}var Na=null,Ks=null,Sl=!1,Oa=!1,Pl=!1,Yr=0;function sr(a){a!==Ks&&a.next===null&&(Ks===null?Na=Ks=a:Ks=Ks.next=a),Oa=!0,Sl||(Sl=!0,$f())}function Di(a,c){if(!Pl&&Oa){Pl=!0;do for(var b=!1,x=Na;x!==null;){if(a!==0){var S=x.pendingLanes;if(S===0)var A=0;else{var F=x.suspendedLanes,Q=x.pingedLanes;A=(1<<31-Pt(42|a)+1)-1,A&=S&~(F&~Q),A=A&201326741?A&201326741|1:A?A|2:0}A!==0&&(b=!0,Ld(x,A))}else A=Tt,A=rt(x,x===Ht?A:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),(A&3)===0||st(x,A)||(b=!0,Ld(x,A));x=x.next}while(b);Pl=!1}}function Gf(){Nd()}function Nd(){Oa=Sl=!1;var a=0;Yr!==0&&Zf()&&(a=Yr);for(var c=Ie(),b=null,x=Na;x!==null;){var S=x.next,A=Od(x,c);A===0?(x.next=null,b===null?Na=S:b.next=S,S===null&&(Ks=b)):(b=x,(a!==0||(A&3)!==0)&&(Oa=!0)),x=S}cn!==0&&cn!==5||Di(a),Yr!==0&&(Yr=0)}function Od(a,c){for(var b=a.suspendedLanes,x=a.pingedLanes,S=a.expirationTimes,A=a.pendingLanes&-62914561;0<A;){var F=31-Pt(A),Q=1<<F,me=S[F];me===-1?((Q&b)===0||(Q&x)!==0)&&(S[F]=Jt(Q,c)):me<=c&&(a.expiredLanes|=Q),A&=~Q}if(c=Ht,b=Tt,b=rt(a,a===c?b:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),x=a.callbackNode,b===0||a===c&&(Nt===2||Nt===9)||a.cancelPendingCommit!==null)return x!==null&&x!==null&&pe(x),a.callbackNode=null,a.callbackPriority=0;if((b&3)===0||st(a,b)){if(c=b&-b,c===a.callbackPriority)return c;switch(x!==null&&pe(x),ir(b)){case 2:case 8:b=ze;break;case 32:b=Ge;break;case 268435456:b=Ye;break;default:b=Ge}return x=Dd.bind(null,a),b=ye(b,x),a.callbackPriority=c,a.callbackNode=b,c}return x!==null&&x!==null&&pe(x),a.callbackPriority=2,a.callbackNode=null,2}function Dd(a,c){if(cn!==0&&cn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var b=a.callbackNode;if(ka()&&a.callbackNode!==b)return null;var x=Tt;return x=rt(a,a===Ht?x:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),x===0?null:(bd(a,x,c),Od(a,Ie()),a.callbackNode!=null&&a.callbackNode===b?Dd.bind(null,a):null)}function Ld(a,c){if(ka())return null;bd(a,c,!0)}function $f(){tp(function(){(Bt&6)!==0?ye(De,Gf):Nd()})}function Al(){if(Yr===0){var a=Os;a===0&&(a=At,At<<=1,(At&261888)===0&&(At=256)),Yr=a}return Yr}function Fd(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:ts(""+a)}function Ud(a,c){var b=c.ownerDocument.createElement("input");return b.name=c.name,b.value=c.value,a.id&&b.setAttribute("form",a.id),c.parentNode.insertBefore(b,c),a=new FormData(a),b.parentNode.removeChild(b),a}function jf(a,c,b,x,S){if(c==="submit"&&b&&b.stateNode===S){var A=Fd((S[Z]||null).action),F=x.submitter;F&&(c=(c=F[Z]||null)?Fd(c.formAction):F.getAttribute("formAction"),c!==null&&(A=c,F=null));var Q=new jt("action","action",null,x,S);a.push({event:Q,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(Yr!==0){var me=F?Ud(S,F):new FormData(S);Yo(b,{pending:!0,data:me,method:S.method,action:A},null,me)}}else typeof A=="function"&&(Q.preventDefault(),me=F?Ud(S,F):new FormData(S),Yo(b,{pending:!0,data:me,method:S.method,action:A},A,me))},currentTarget:S}]})}}for(var Cl=0;Cl<uo.length;Cl++){var Ml=uo[Cl],Hf=Ml.toLowerCase(),qf=Ml[0].toUpperCase()+Ml.slice(1);Qn(Hf,"on"+qf)}Qn(yu,"onAnimationEnd"),Qn(bu,"onAnimationIteration"),Qn(_u,"onAnimationStart"),Qn("dblclick","onDoubleClick"),Qn("focusin","onFocus"),Qn("focusout","onBlur"),Qn(of,"onTransitionRun"),Qn(lf,"onTransitionStart"),Qn(uf,"onTransitionCancel"),Qn(vu,"onTransitionEnd"),ln("onMouseEnter",["mouseout","mouseover"]),ln("onMouseLeave",["mouseout","mouseover"]),ln("onPointerEnter",["pointerout","pointerover"]),ln("onPointerLeave",["pointerout","pointerover"]),Ct("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ct("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ct("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ct("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ct("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ct("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Li="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yf=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Li));function zd(a,c){c=(c&4)!==0;for(var b=0;b<a.length;b++){var x=a[b],S=x.event;x=x.listeners;e:{var A=void 0;if(c)for(var F=x.length-1;0<=F;F--){var Q=x[F],me=Q.instance,Ce=Q.currentTarget;if(Q=Q.listener,me!==A&&S.isPropagationStopped())break e;A=Q,S.currentTarget=Ce;try{A(S)}catch(Le){Ji(Le)}S.currentTarget=null,A=me}else for(F=0;F<x.length;F++){if(Q=x[F],me=Q.instance,Ce=Q.currentTarget,Q=Q.listener,me!==A&&S.isPropagationStopped())break e;A=Q,S.currentTarget=Ce;try{A(S)}catch(Le){Ji(Le)}S.currentTarget=null,A=me}}}}function xt(a,c){var b=c[ve];b===void 0&&(b=c[ve]=new Set);var x=a+"__bubble";b.has(x)||(Gd(c,a,2,!1),b.add(x))}function Rl(a,c,b){var x=0;c&&(x|=4),Gd(b,a,x,c)}var Da="_reactListening"+Math.random().toString(36).slice(2);function Il(a){if(!a[Da]){a[Da]=!0,ke.forEach(function(b){b!=="selectionchange"&&(Yf.has(b)||Rl(b,!1,a),Rl(b,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[Da]||(c[Da]=!0,Rl("selectionchange",!1,c))}}function Gd(a,c,b,x){switch(yh(c)){case 2:var S=xp;break;case 8:S=Tp;break;default:S=ql}b=S.bind(null,c,b,a),S=void 0,!Ps||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(S=!0),x?S!==void 0?a.addEventListener(c,b,{capture:!0,passive:S}):a.addEventListener(c,b,!0):S!==void 0?a.addEventListener(c,b,{passive:S}):a.addEventListener(c,b,!1)}function Bl(a,c,b,x,S){var A=x;if((c&1)===0&&(c&2)===0&&x!==null)e:for(;;){if(x===null)return;var F=x.tag;if(F===3||F===4){var Q=x.stateNode.containerInfo;if(Q===S)break;if(F===4)for(F=x.return;F!==null;){var me=F.tag;if((me===3||me===4)&&F.stateNode.containerInfo===S)return;F=F.return}for(;Q!==null;){if(F=We(Q),F===null)return;if(me=F.tag,me===5||me===6||me===26||me===27){x=A=F;continue e}Q=Q.parentNode}}x=x.return}ui(function(){var Ce=A,Le=Es(b),Ue=[];e:{var Me=xu.get(a);if(Me!==void 0){var Ve=jt,Ke=a;switch(a){case"keypress":if(Be(b)===0)break e;case"keydown":case"keyup":Ve=Lh;break;case"focusin":Ke="focus",Ve=eo;break;case"focusout":Ke="blur",Ve=eo;break;case"beforeblur":case"afterblur":Ve=eo;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ve=dr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ve=Ph;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ve=zh;break;case yu:case bu:case _u:Ve=Mh;break;case vu:Ve=$h;break;case"scroll":case"scrollend":Ve=Sn;break;case"wheel":Ve=Hh;break;case"copy":case"cut":case"paste":Ve=Ih;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ve=Ql;break;case"toggle":case"beforetoggle":Ve=Yh}var lt=(c&4)!==0,Ut=!lt&&(a==="scroll"||a==="scrollend"),Te=lt?Me!==null?Me+"Capture":null:Me;lt=[];for(var _e=Ce,Ae;_e!==null;){var Fe=_e;if(Ae=Fe.stateNode,Fe=Fe.tag,Fe!==5&&Fe!==26&&Fe!==27||Ae===null||Te===null||(Fe=Ir(_e,Te),Fe!=null&&lt.push(Fi(_e,Fe,Ae))),Ut)break;_e=_e.return}0<lt.length&&(Me=new Ve(Me,Ke,null,b,Le),Ue.push({event:Me,listeners:lt}))}}if((c&7)===0){e:{if(Me=a==="mouseover"||a==="pointerover",Ve=a==="mouseout"||a==="pointerout",Me&&b!==ws&&(Ke=b.relatedTarget||b.fromElement)&&(We(Ke)||Ke[he]))break e;if((Ve||Me)&&(Me=Le.window===Le?Le:(Me=Le.ownerDocument)?Me.defaultView||Me.parentWindow:window,Ve?(Ke=b.relatedTarget||b.toElement,Ve=Ce,Ke=Ke?We(Ke):null,Ke!==null&&(Ut=u(Ke),lt=Ke.tag,Ke!==Ut||lt!==5&&lt!==27&&lt!==6)&&(Ke=null)):(Ve=null,Ke=Ce),Ve!==Ke)){if(lt=dr,Fe="onMouseLeave",Te="onMouseEnter",_e="mouse",(a==="pointerout"||a==="pointerover")&&(lt=Ql,Fe="onPointerLeave",Te="onPointerEnter",_e="pointer"),Ut=Ve==null?Me:Et(Ve),Ae=Ke==null?Me:Et(Ke),Me=new lt(Fe,_e+"leave",Ve,b,Le),Me.target=Ut,Me.relatedTarget=Ae,Fe=null,We(Le)===Ce&&(lt=new lt(Te,_e+"enter",Ke,b,Le),lt.target=Ae,lt.relatedTarget=Ut,Fe=lt),Ut=Fe,Ve&&Ke)t:{for(lt=Wf,Te=Ve,_e=Ke,Ae=0,Fe=Te;Fe;Fe=lt(Fe))Ae++;Fe=0;for(var at=_e;at;at=lt(at))Fe++;for(;0<Ae-Fe;)Te=lt(Te),Ae--;for(;0<Fe-Ae;)_e=lt(_e),Fe--;for(;Ae--;){if(Te===_e||_e!==null&&Te===_e.alternate){lt=Te;break t}Te=lt(Te),_e=lt(_e)}lt=null}else lt=null;Ve!==null&&$d(Ue,Me,Ve,lt,!1),Ke!==null&&Ut!==null&&$d(Ue,Ut,Ke,lt,!0)}}e:{if(Me=Ce?Et(Ce):window,Ve=Me.nodeName&&Me.nodeName.toLowerCase(),Ve==="select"||Ve==="input"&&Me.type==="file")var Rt=au;else if(su(Me))if(ou)Rt=rf;else{Rt=tf;var Ze=ef}else Ve=Me.nodeName,!Ve||Ve.toLowerCase()!=="input"||Me.type!=="checkbox"&&Me.type!=="radio"?Ce&&ht(Ce.elementType)&&(Rt=au):Rt=nf;if(Rt&&(Rt=Rt(a,Ce))){iu(Ue,Rt,b,Le);break e}Ze&&Ze(a,Me,Ce),a==="focusout"&&Ce&&Me.type==="number"&&Ce.memoizedProps.value!=null&&Rr(Me,"number",Me.value)}switch(Ze=Ce?Et(Ce):window,a){case"focusin":(su(Ze)||Ze.contentEditable==="true")&&(Cs=Ze,ao=Ce,pi=null);break;case"focusout":pi=ao=Cs=null;break;case"mousedown":oo=!0;break;case"contextmenu":case"mouseup":case"dragend":oo=!1,mu(Ue,b,Le);break;case"selectionchange":if(af)break;case"keydown":case"keyup":mu(Ue,b,Le)}var mt;if(no)e:{switch(a){case"compositionstart":var wt="onCompositionStart";break e;case"compositionend":wt="onCompositionEnd";break e;case"compositionupdate":wt="onCompositionUpdate";break e}wt=void 0}else As?nu(a,b)&&(wt="onCompositionEnd"):a==="keydown"&&b.keyCode===229&&(wt="onCompositionStart");wt&&(Zl&&b.locale!=="ko"&&(As||wt!=="onCompositionStart"?wt==="onCompositionEnd"&&As&&(mt=Pe()):(K=Le,oe="value"in K?K.value:K.textContent,As=!0)),Ze=La(Ce,wt),0<Ze.length&&(wt=new Kl(wt,a,null,b,Le),Ue.push({event:wt,listeners:Ze}),mt?wt.data=mt:(mt=ru(b),mt!==null&&(wt.data=mt)))),(mt=Xh?Jh(a,b):Kh(a,b))&&(wt=La(Ce,"onBeforeInput"),0<wt.length&&(Ze=new Kl("onBeforeInput","beforeinput",null,b,Le),Ue.push({event:Ze,listeners:wt}),Ze.data=mt)),jf(Ue,a,Ce,b,Le)}zd(Ue,c)})}function Fi(a,c,b){return{instance:a,listener:c,currentTarget:b}}function La(a,c){for(var b=c+"Capture",x=[];a!==null;){var S=a,A=S.stateNode;if(S=S.tag,S!==5&&S!==26&&S!==27||A===null||(S=Ir(a,b),S!=null&&x.unshift(Fi(a,S,A)),S=Ir(a,c),S!=null&&x.push(Fi(a,S,A))),a.tag===3)return x;a=a.return}return[]}function Wf(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function $d(a,c,b,x,S){for(var A=c._reactName,F=[];b!==null&&b!==x;){var Q=b,me=Q.alternate,Ce=Q.stateNode;if(Q=Q.tag,me!==null&&me===x)break;Q!==5&&Q!==26&&Q!==27||Ce===null||(me=Ce,S?(Ce=Ir(b,A),Ce!=null&&F.unshift(Fi(b,Ce,me))):S||(Ce=Ir(b,A),Ce!=null&&F.push(Fi(b,Ce,me)))),b=b.return}F.length!==0&&a.push({event:c,listeners:F})}var Xf=/\r\n?/g,Jf=/\u0000|\uFFFD/g;function jd(a){return(typeof a=="string"?a:""+a).replace(Xf,`
`).replace(Jf,"")}function Hd(a,c){return c=jd(c),jd(a)===c}function Ft(a,c,b,x,S,A){switch(b){case"children":typeof x=="string"?c==="body"||c==="textarea"&&x===""||lr(a,x):(typeof x=="number"||typeof x=="bigint")&&c!=="body"&&lr(a,""+x);break;case"className":ar(a,"class",x);break;case"tabIndex":ar(a,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":ar(a,b,x);break;case"style":ft(a,x,A);break;case"data":if(c!=="object"){ar(a,"data",x);break}case"src":case"href":if(x===""&&(c!=="a"||b!=="href")){a.removeAttribute(b);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){a.removeAttribute(b);break}x=ts(""+x),a.setAttribute(b,x);break;case"action":case"formAction":if(typeof x=="function"){a.setAttribute(b,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof A=="function"&&(b==="formAction"?(c!=="input"&&Ft(a,c,"name",S.name,S,null),Ft(a,c,"formEncType",S.formEncType,S,null),Ft(a,c,"formMethod",S.formMethod,S,null),Ft(a,c,"formTarget",S.formTarget,S,null)):(Ft(a,c,"encType",S.encType,S,null),Ft(a,c,"method",S.method,S,null),Ft(a,c,"target",S.target,S,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){a.removeAttribute(b);break}x=ts(""+x),a.setAttribute(b,x);break;case"onClick":x!=null&&(a.onclick=zn);break;case"onScroll":x!=null&&xt("scroll",a);break;case"onScrollEnd":x!=null&&xt("scrollend",a);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(s(61));if(b=x.__html,b!=null){if(S.children!=null)throw Error(s(60));a.innerHTML=b}}break;case"multiple":a.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":a.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){a.removeAttribute("xlink:href");break}b=ts(""+x),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",b);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?a.setAttribute(b,""+x):a.removeAttribute(b);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?a.setAttribute(b,""):a.removeAttribute(b);break;case"capture":case"download":x===!0?a.setAttribute(b,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?a.setAttribute(b,x):a.removeAttribute(b);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?a.setAttribute(b,x):a.removeAttribute(b);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?a.removeAttribute(b):a.setAttribute(b,x);break;case"popover":xt("beforetoggle",a),xt("toggle",a),un(a,"popover",x);break;case"xlinkActuate":Un(a,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":Un(a,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":Un(a,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":Un(a,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":Un(a,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":Un(a,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":Un(a,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":Un(a,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":Un(a,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":un(a,"is",x);break;case"innerText":case"textContent":break;default:(!(2<b.length)||b[0]!=="o"&&b[0]!=="O"||b[1]!=="n"&&b[1]!=="N")&&(b=oi.get(b)||b,un(a,b,x))}}function Vl(a,c,b,x,S,A){switch(b){case"style":ft(a,x,A);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(s(61));if(b=x.__html,b!=null){if(S.children!=null)throw Error(s(60));a.innerHTML=b}}break;case"children":typeof x=="string"?lr(a,x):(typeof x=="number"||typeof x=="bigint")&&lr(a,""+x);break;case"onScroll":x!=null&&xt("scroll",a);break;case"onScrollEnd":x!=null&&xt("scrollend",a);break;case"onClick":x!=null&&(a.onclick=zn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!yt.hasOwnProperty(b))e:{if(b[0]==="o"&&b[1]==="n"&&(S=b.endsWith("Capture"),c=b.slice(2,S?b.length-7:void 0),A=a[Z]||null,A=A!=null?A[b]:null,typeof A=="function"&&a.removeEventListener(c,A,S),typeof x=="function")){typeof A!="function"&&A!==null&&(b in a?a[b]=null:a.hasAttribute(b)&&a.removeAttribute(b)),a.addEventListener(c,x,S);break e}b in a?a[b]=x:x===!0?a.setAttribute(b,""):un(a,b,x)}}}function mn(a,c,b){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":xt("error",a),xt("load",a);var x=!1,S=!1,A;for(A in b)if(b.hasOwnProperty(A)){var F=b[A];if(F!=null)switch(A){case"src":x=!0;break;case"srcSet":S=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,c));default:Ft(a,c,A,F,b,null)}}S&&Ft(a,c,"srcSet",b.srcSet,b,null),x&&Ft(a,c,"src",b.src,b,null);return;case"input":xt("invalid",a);var Q=A=F=S=null,me=null,Ce=null;for(x in b)if(b.hasOwnProperty(x)){var Le=b[x];if(Le!=null)switch(x){case"name":S=Le;break;case"type":F=Le;break;case"checked":me=Le;break;case"defaultChecked":Ce=Le;break;case"value":A=Le;break;case"defaultValue":Q=Le;break;case"children":case"dangerouslySetInnerHTML":if(Le!=null)throw Error(s(137,c));break;default:Ft(a,c,x,Le,b,null)}}si(a,A,Q,me,Ce,F,S,!1);return;case"select":xt("invalid",a),x=F=A=null;for(S in b)if(b.hasOwnProperty(S)&&(Q=b[S],Q!=null))switch(S){case"value":A=Q;break;case"defaultValue":F=Q;break;case"multiple":x=Q;default:Ft(a,c,S,Q,b,null)}c=A,b=F,a.multiple=!!x,c!=null?or(a,!!x,c,!1):b!=null&&or(a,!!x,b,!0);return;case"textarea":xt("invalid",a),A=S=x=null;for(F in b)if(b.hasOwnProperty(F)&&(Q=b[F],Q!=null))switch(F){case"value":x=Q;break;case"defaultValue":S=Q;break;case"children":A=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(s(91));break;default:Ft(a,c,F,Q,b,null)}xs(a,x,S,A);return;case"option":for(me in b)if(b.hasOwnProperty(me)&&(x=b[me],x!=null))switch(me){case"selected":a.selected=x&&typeof x!="function"&&typeof x!="symbol";break;default:Ft(a,c,me,x,b,null)}return;case"dialog":xt("beforetoggle",a),xt("toggle",a),xt("cancel",a),xt("close",a);break;case"iframe":case"object":xt("load",a);break;case"video":case"audio":for(x=0;x<Li.length;x++)xt(Li[x],a);break;case"image":xt("error",a),xt("load",a);break;case"details":xt("toggle",a);break;case"embed":case"source":case"link":xt("error",a),xt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ce in b)if(b.hasOwnProperty(Ce)&&(x=b[Ce],x!=null))switch(Ce){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,c));default:Ft(a,c,Ce,x,b,null)}return;default:if(ht(c)){for(Le in b)b.hasOwnProperty(Le)&&(x=b[Le],x!==void 0&&Vl(a,c,Le,x,b,void 0));return}}for(Q in b)b.hasOwnProperty(Q)&&(x=b[Q],x!=null&&Ft(a,c,Q,x,b,null))}function Kf(a,c,b,x){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var S=null,A=null,F=null,Q=null,me=null,Ce=null,Le=null;for(Ve in b){var Ue=b[Ve];if(b.hasOwnProperty(Ve)&&Ue!=null)switch(Ve){case"checked":break;case"value":break;case"defaultValue":me=Ue;default:x.hasOwnProperty(Ve)||Ft(a,c,Ve,null,x,Ue)}}for(var Me in x){var Ve=x[Me];if(Ue=b[Me],x.hasOwnProperty(Me)&&(Ve!=null||Ue!=null))switch(Me){case"type":A=Ve;break;case"name":S=Ve;break;case"checked":Ce=Ve;break;case"defaultChecked":Le=Ve;break;case"value":F=Ve;break;case"defaultValue":Q=Ve;break;case"children":case"dangerouslySetInnerHTML":if(Ve!=null)throw Error(s(137,c));break;default:Ve!==Ue&&Ft(a,c,Me,Ve,x,Ue)}}vs(a,F,Q,me,Ce,Le,A,S);return;case"select":Ve=F=Q=Me=null;for(A in b)if(me=b[A],b.hasOwnProperty(A)&&me!=null)switch(A){case"value":break;case"multiple":Ve=me;default:x.hasOwnProperty(A)||Ft(a,c,A,null,x,me)}for(S in x)if(A=x[S],me=b[S],x.hasOwnProperty(S)&&(A!=null||me!=null))switch(S){case"value":Me=A;break;case"defaultValue":Q=A;break;case"multiple":F=A;default:A!==me&&Ft(a,c,S,A,x,me)}c=Q,b=F,x=Ve,Me!=null?or(a,!!b,Me,!1):!!x!=!!b&&(c!=null?or(a,!!b,c,!0):or(a,!!b,b?[]:"",!1));return;case"textarea":Ve=Me=null;for(Q in b)if(S=b[Q],b.hasOwnProperty(Q)&&S!=null&&!x.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:Ft(a,c,Q,null,x,S)}for(F in x)if(S=x[F],A=b[F],x.hasOwnProperty(F)&&(S!=null||A!=null))switch(F){case"value":Me=S;break;case"defaultValue":Ve=S;break;case"children":break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(s(91));break;default:S!==A&&Ft(a,c,F,S,x,A)}ii(a,Me,Ve);return;case"option":for(var Ke in b)if(Me=b[Ke],b.hasOwnProperty(Ke)&&Me!=null&&!x.hasOwnProperty(Ke))switch(Ke){case"selected":a.selected=!1;break;default:Ft(a,c,Ke,null,x,Me)}for(me in x)if(Me=x[me],Ve=b[me],x.hasOwnProperty(me)&&Me!==Ve&&(Me!=null||Ve!=null))switch(me){case"selected":a.selected=Me&&typeof Me!="function"&&typeof Me!="symbol";break;default:Ft(a,c,me,Me,x,Ve)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var lt in b)Me=b[lt],b.hasOwnProperty(lt)&&Me!=null&&!x.hasOwnProperty(lt)&&Ft(a,c,lt,null,x,Me);for(Ce in x)if(Me=x[Ce],Ve=b[Ce],x.hasOwnProperty(Ce)&&Me!==Ve&&(Me!=null||Ve!=null))switch(Ce){case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(s(137,c));break;default:Ft(a,c,Ce,Me,x,Ve)}return;default:if(ht(c)){for(var Ut in b)Me=b[Ut],b.hasOwnProperty(Ut)&&Me!==void 0&&!x.hasOwnProperty(Ut)&&Vl(a,c,Ut,void 0,x,Me);for(Le in x)Me=x[Le],Ve=b[Le],!x.hasOwnProperty(Le)||Me===Ve||Me===void 0&&Ve===void 0||Vl(a,c,Le,Me,x,Ve);return}}for(var Te in b)Me=b[Te],b.hasOwnProperty(Te)&&Me!=null&&!x.hasOwnProperty(Te)&&Ft(a,c,Te,null,x,Me);for(Ue in x)Me=x[Ue],Ve=b[Ue],!x.hasOwnProperty(Ue)||Me===Ve||Me==null&&Ve==null||Ft(a,c,Ue,Me,x,Ve)}function qd(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Qf(){if(typeof performance.getEntriesByType=="function"){for(var a=0,c=0,b=performance.getEntriesByType("resource"),x=0;x<b.length;x++){var S=b[x],A=S.transferSize,F=S.initiatorType,Q=S.duration;if(A&&Q&&qd(F)){for(F=0,Q=S.responseEnd,x+=1;x<b.length;x++){var me=b[x],Ce=me.startTime;if(Ce>Q)break;var Le=me.transferSize,Ue=me.initiatorType;Le&&qd(Ue)&&(me=me.responseEnd,F+=Le*(me<Q?1:(Q-Ce)/(me-Ce)))}if(--x,c+=8*(A+F)/(S.duration/1e3),a++,10<a)break}}if(0<a)return c/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var kl=null,Nl=null;function Fa(a){return a.nodeType===9?a:a.ownerDocument}function Yd(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Wd(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function Ol(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Dl=null;function Zf(){var a=window.event;return a&&a.type==="popstate"?a===Dl?!1:(Dl=a,!0):(Dl=null,!1)}var Xd=typeof setTimeout=="function"?setTimeout:void 0,ep=typeof clearTimeout=="function"?clearTimeout:void 0,Jd=typeof Promise=="function"?Promise:void 0,tp=typeof queueMicrotask=="function"?queueMicrotask:typeof Jd<"u"?function(a){return Jd.resolve(null).then(a).catch(np)}:Xd;function np(a){setTimeout(function(){throw a})}function Wr(a){return a==="head"}function Kd(a,c){var b=c,x=0;do{var S=b.nextSibling;if(a.removeChild(b),S&&S.nodeType===8)if(b=S.data,b==="/$"||b==="/&"){if(x===0){a.removeChild(S),ti(c);return}x--}else if(b==="$"||b==="$?"||b==="$~"||b==="$!"||b==="&")x++;else if(b==="html")Ui(a.ownerDocument.documentElement);else if(b==="head"){b=a.ownerDocument.head,Ui(b);for(var A=b.firstChild;A;){var F=A.nextSibling,Q=A.nodeName;A[$e]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&A.rel.toLowerCase()==="stylesheet"||b.removeChild(A),A=F}}else b==="body"&&Ui(a.ownerDocument.body);b=S}while(b);ti(c)}function Qd(a,c){var b=a;a=0;do{var x=b.nextSibling;if(b.nodeType===1?c?(b._stashedDisplay=b.style.display,b.style.display="none"):(b.style.display=b._stashedDisplay||"",b.getAttribute("style")===""&&b.removeAttribute("style")):b.nodeType===3&&(c?(b._stashedText=b.nodeValue,b.nodeValue=""):b.nodeValue=b._stashedText||""),x&&x.nodeType===8)if(b=x.data,b==="/$"){if(a===0)break;a--}else b!=="$"&&b!=="$?"&&b!=="$~"&&b!=="$!"||a++;b=x}while(b)}function Ll(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var b=c;switch(c=c.nextSibling,b.nodeName){case"HTML":case"HEAD":case"BODY":Ll(b),Qe(b);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(b.rel.toLowerCase()==="stylesheet")continue}a.removeChild(b)}}function rp(a,c,b,x){for(;a.nodeType===1;){var S=b;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!x&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(x){if(!a[$e])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(A=a.getAttribute("rel"),A==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(A!==S.rel||a.getAttribute("href")!==(S.href==null||S.href===""?null:S.href)||a.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin)||a.getAttribute("title")!==(S.title==null?null:S.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(A=a.getAttribute("src"),(A!==(S.src==null?null:S.src)||a.getAttribute("type")!==(S.type==null?null:S.type)||a.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin))&&A&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var A=S.name==null?null:""+S.name;if(S.type==="hidden"&&a.getAttribute("name")===A)return a}else return a;if(a=Xn(a.nextSibling),a===null)break}return null}function sp(a,c,b){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!b||(a=Xn(a.nextSibling),a===null))return null;return a}function Zd(a,c){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!c||(a=Xn(a.nextSibling),a===null))return null;return a}function Fl(a){return a.data==="$?"||a.data==="$~"}function Ul(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function ip(a,c){var b=a.ownerDocument;if(a.data==="$~")a._reactRetry=c;else if(a.data!=="$?"||b.readyState!=="loading")c();else{var x=function(){c(),b.removeEventListener("DOMContentLoaded",x)};b.addEventListener("DOMContentLoaded",x),a._reactRetry=x}}function Xn(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"||c==="F!"||c==="F")break;if(c==="/$"||c==="/&")return null}}return a}var zl=null;function eh(a){a=a.nextSibling;for(var c=0;a;){if(a.nodeType===8){var b=a.data;if(b==="/$"||b==="/&"){if(c===0)return Xn(a.nextSibling);c--}else b!=="$"&&b!=="$!"&&b!=="$?"&&b!=="$~"&&b!=="&"||c++}a=a.nextSibling}return null}function th(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var b=a.data;if(b==="$"||b==="$!"||b==="$?"||b==="$~"||b==="&"){if(c===0)return a;c--}else b!=="/$"&&b!=="/&"||c++}a=a.previousSibling}return null}function nh(a,c,b){switch(c=Fa(b),a){case"html":if(a=c.documentElement,!a)throw Error(s(452));return a;case"head":if(a=c.head,!a)throw Error(s(453));return a;case"body":if(a=c.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function Ui(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);Qe(a)}var Jn=new Map,rh=new Set;function Ua(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Pr=H.d;H.d={f:ap,r:op,D:lp,C:up,L:cp,m:dp,X:fp,S:hp,M:pp};function ap(){var a=Pr.f(),c=Ia();return a||c}function op(a){var c=ct(a);c!==null&&c.tag===5&&c.type==="form"?vc(c):Pr.r(a)}var Qs=typeof document>"u"?null:document;function sh(a,c,b){var x=Qs;if(x&&typeof c=="string"&&c){var S=_n(c);S='link[rel="'+a+'"][href="'+S+'"]',typeof b=="string"&&(S+='[crossorigin="'+b+'"]'),rh.has(S)||(rh.add(S),a={rel:a,crossOrigin:b,href:c},x.querySelector(S)===null&&(c=x.createElement("link"),mn(c,"link",a),_t(c),x.head.appendChild(c)))}}function lp(a){Pr.D(a),sh("dns-prefetch",a,null)}function up(a,c){Pr.C(a,c),sh("preconnect",a,c)}function cp(a,c,b){Pr.L(a,c,b);var x=Qs;if(x&&a&&c){var S='link[rel="preload"][as="'+_n(c)+'"]';c==="image"&&b&&b.imageSrcSet?(S+='[imagesrcset="'+_n(b.imageSrcSet)+'"]',typeof b.imageSizes=="string"&&(S+='[imagesizes="'+_n(b.imageSizes)+'"]')):S+='[href="'+_n(a)+'"]';var A=S;switch(c){case"style":A=Zs(a);break;case"script":A=ei(a)}Jn.has(A)||(a=i({rel:"preload",href:c==="image"&&b&&b.imageSrcSet?void 0:a,as:c},b),Jn.set(A,a),x.querySelector(S)!==null||c==="style"&&x.querySelector(zi(A))||c==="script"&&x.querySelector(Gi(A))||(c=x.createElement("link"),mn(c,"link",a),_t(c),x.head.appendChild(c)))}}function dp(a,c){Pr.m(a,c);var b=Qs;if(b&&a){var x=c&&typeof c.as=="string"?c.as:"script",S='link[rel="modulepreload"][as="'+_n(x)+'"][href="'+_n(a)+'"]',A=S;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":A=ei(a)}if(!Jn.has(A)&&(a=i({rel:"modulepreload",href:a},c),Jn.set(A,a),b.querySelector(S)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(b.querySelector(Gi(A)))return}x=b.createElement("link"),mn(x,"link",a),_t(x),b.head.appendChild(x)}}}function hp(a,c,b){Pr.S(a,c,b);var x=Qs;if(x&&a){var S=qt(x).hoistableStyles,A=Zs(a);c=c||"default";var F=S.get(A);if(!F){var Q={loading:0,preload:null};if(F=x.querySelector(zi(A)))Q.loading=5;else{a=i({rel:"stylesheet",href:a,"data-precedence":c},b),(b=Jn.get(A))&&Gl(a,b);var me=F=x.createElement("link");_t(me),mn(me,"link",a),me._p=new Promise(function(Ce,Le){me.onload=Ce,me.onerror=Le}),me.addEventListener("load",function(){Q.loading|=1}),me.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,za(F,c,x)}F={type:"stylesheet",instance:F,count:1,state:Q},S.set(A,F)}}}function fp(a,c){Pr.X(a,c);var b=Qs;if(b&&a){var x=qt(b).hoistableScripts,S=ei(a),A=x.get(S);A||(A=b.querySelector(Gi(S)),A||(a=i({src:a,async:!0},c),(c=Jn.get(S))&&$l(a,c),A=b.createElement("script"),_t(A),mn(A,"link",a),b.head.appendChild(A)),A={type:"script",instance:A,count:1,state:null},x.set(S,A))}}function pp(a,c){Pr.M(a,c);var b=Qs;if(b&&a){var x=qt(b).hoistableScripts,S=ei(a),A=x.get(S);A||(A=b.querySelector(Gi(S)),A||(a=i({src:a,async:!0,type:"module"},c),(c=Jn.get(S))&&$l(a,c),A=b.createElement("script"),_t(A),mn(A,"link",a),b.head.appendChild(A)),A={type:"script",instance:A,count:1,state:null},x.set(S,A))}}function ih(a,c,b,x){var S=(S=we.current)?Ua(S):null;if(!S)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof b.precedence=="string"&&typeof b.href=="string"?(c=Zs(b.href),b=qt(S).hoistableStyles,x=b.get(c),x||(x={type:"style",instance:null,count:0,state:null},b.set(c,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(b.rel==="stylesheet"&&typeof b.href=="string"&&typeof b.precedence=="string"){a=Zs(b.href);var A=qt(S).hoistableStyles,F=A.get(a);if(F||(S=S.ownerDocument||S,F={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},A.set(a,F),(A=S.querySelector(zi(a)))&&!A._p&&(F.instance=A,F.state.loading=5),Jn.has(a)||(b={rel:"preload",as:"style",href:b.href,crossOrigin:b.crossOrigin,integrity:b.integrity,media:b.media,hrefLang:b.hrefLang,referrerPolicy:b.referrerPolicy},Jn.set(a,b),A||mp(S,a,b,F.state))),c&&x===null)throw Error(s(528,""));return F}if(c&&x!==null)throw Error(s(529,""));return null;case"script":return c=b.async,b=b.src,typeof b=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=ei(b),b=qt(S).hoistableScripts,x=b.get(c),x||(x={type:"script",instance:null,count:0,state:null},b.set(c,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function Zs(a){return'href="'+_n(a)+'"'}function zi(a){return'link[rel="stylesheet"]['+a+"]"}function ah(a){return i({},a,{"data-precedence":a.precedence,precedence:null})}function mp(a,c,b,x){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?x.loading=1:(c=a.createElement("link"),x.preload=c,c.addEventListener("load",function(){return x.loading|=1}),c.addEventListener("error",function(){return x.loading|=2}),mn(c,"link",b),_t(c),a.head.appendChild(c))}function ei(a){return'[src="'+_n(a)+'"]'}function Gi(a){return"script[async]"+a}function oh(a,c,b){if(c.count++,c.instance===null)switch(c.type){case"style":var x=a.querySelector('style[data-href~="'+_n(b.href)+'"]');if(x)return c.instance=x,_t(x),x;var S=i({},b,{"data-href":b.href,"data-precedence":b.precedence,href:null,precedence:null});return x=(a.ownerDocument||a).createElement("style"),_t(x),mn(x,"style",S),za(x,b.precedence,a),c.instance=x;case"stylesheet":S=Zs(b.href);var A=a.querySelector(zi(S));if(A)return c.state.loading|=4,c.instance=A,_t(A),A;x=ah(b),(S=Jn.get(S))&&Gl(x,S),A=(a.ownerDocument||a).createElement("link"),_t(A);var F=A;return F._p=new Promise(function(Q,me){F.onload=Q,F.onerror=me}),mn(A,"link",x),c.state.loading|=4,za(A,b.precedence,a),c.instance=A;case"script":return A=ei(b.src),(S=a.querySelector(Gi(A)))?(c.instance=S,_t(S),S):(x=b,(S=Jn.get(A))&&(x=i({},b),$l(x,S)),a=a.ownerDocument||a,S=a.createElement("script"),_t(S),mn(S,"link",x),a.head.appendChild(S),c.instance=S);case"void":return null;default:throw Error(s(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(x=c.instance,c.state.loading|=4,za(x,b.precedence,a));return c.instance}function za(a,c,b){for(var x=b.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),S=x.length?x[x.length-1]:null,A=S,F=0;F<x.length;F++){var Q=x[F];if(Q.dataset.precedence===c)A=Q;else if(A!==S)break}A?A.parentNode.insertBefore(a,A.nextSibling):(c=b.nodeType===9?b.head:b,c.insertBefore(a,c.firstChild))}function Gl(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function $l(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var Ga=null;function lh(a,c,b){if(Ga===null){var x=new Map,S=Ga=new Map;S.set(b,x)}else S=Ga,x=S.get(b),x||(x=new Map,S.set(b,x));if(x.has(a))return x;for(x.set(a,null),b=b.getElementsByTagName(a),S=0;S<b.length;S++){var A=b[S];if(!(A[$e]||A[Kt]||a==="link"&&A.getAttribute("rel")==="stylesheet")&&A.namespaceURI!=="http://www.w3.org/2000/svg"){var F=A.getAttribute(c)||"";F=a+F;var Q=x.get(F);Q?Q.push(A):x.set(F,[A])}}return x}function uh(a,c,b){a=a.ownerDocument||a,a.head.insertBefore(b,c==="title"?a.querySelector("head > title"):null)}function gp(a,c,b){if(b===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return a=c.disabled,typeof c.precedence=="string"&&a==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function ch(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function yp(a,c,b,x){if(b.type==="stylesheet"&&(typeof x.media!="string"||matchMedia(x.media).matches!==!1)&&(b.state.loading&4)===0){if(b.instance===null){var S=Zs(x.href),A=c.querySelector(zi(S));if(A){c=A._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(a.count++,a=$a.bind(a),c.then(a,a)),b.state.loading|=4,b.instance=A,_t(A);return}A=c.ownerDocument||c,x=ah(x),(S=Jn.get(S))&&Gl(x,S),A=A.createElement("link"),_t(A);var F=A;F._p=new Promise(function(Q,me){F.onload=Q,F.onerror=me}),mn(A,"link",x),b.instance=A}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(b,c),(c=b.state.preload)&&(b.state.loading&3)===0&&(a.count++,b=$a.bind(a),c.addEventListener("load",b),c.addEventListener("error",b))}}var jl=0;function bp(a,c){return a.stylesheets&&a.count===0&&Ha(a,a.stylesheets),0<a.count||0<a.imgCount?function(b){var x=setTimeout(function(){if(a.stylesheets&&Ha(a,a.stylesheets),a.unsuspend){var A=a.unsuspend;a.unsuspend=null,A()}},6e4+c);0<a.imgBytes&&jl===0&&(jl=62500*Qf());var S=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&Ha(a,a.stylesheets),a.unsuspend)){var A=a.unsuspend;a.unsuspend=null,A()}},(a.imgBytes>jl?50:800)+c);return a.unsuspend=b,function(){a.unsuspend=null,clearTimeout(x),clearTimeout(S)}}:null}function $a(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ha(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var ja=null;function Ha(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,ja=new Map,c.forEach(_p,a),ja=null,$a.call(a))}function _p(a,c){if(!(c.state.loading&4)){var b=ja.get(a);if(b)var x=b.get(null);else{b=new Map,ja.set(a,b);for(var S=a.querySelectorAll("link[data-precedence],style[data-precedence]"),A=0;A<S.length;A++){var F=S[A];(F.nodeName==="LINK"||F.getAttribute("media")!=="not all")&&(b.set(F.dataset.precedence,F),x=F)}x&&b.set(null,x)}S=c.instance,F=S.getAttribute("data-precedence"),A=b.get(F)||x,A===x&&b.set(null,S),b.set(F,S),this.count++,x=$a.bind(this),S.addEventListener("load",x),S.addEventListener("error",x),A?A.parentNode.insertBefore(S,A.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(S,a.firstChild)),c.state.loading|=4}}var $i={$$typeof:w,Provider:null,Consumer:null,_currentValue:de,_currentValue2:de,_threadCount:0};function vp(a,c,b,x,S,A,F,Q,me){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=xn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xn(0),this.hiddenUpdates=xn(null),this.identifierPrefix=x,this.onUncaughtError=S,this.onCaughtError=A,this.onRecoverableError=F,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=me,this.incompleteTransitions=new Map}function dh(a,c,b,x,S,A,F,Q,me,Ce,Le,Ue){return a=new vp(a,c,b,F,me,Ce,Le,Ue,Q),c=1,A===!0&&(c|=24),A=Vn(3,null,null,c),a.current=A,A.stateNode=a,c=wo(),c.refCount++,a.pooledCache=c,c.refCount++,A.memoizedState={element:x,isDehydrated:b,cache:c},Ao(A),a}function hh(a){return a?(a=Is,a):Is}function fh(a,c,b,x,S,A){S=hh(S),x.context===null?x.context=S:x.pendingContext=S,x=Dr(c),x.payload={element:b},A=A===void 0?null:A,A!==null&&(x.callback=A),b=Lr(a,x,c),b!==null&&(In(b,a,c),xi(b,a,c))}function ph(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var b=a.retryLane;a.retryLane=b!==0&&b<c?b:c}}function Hl(a,c){ph(a,c),(a=a.alternate)&&ph(a,c)}function mh(a){if(a.tag===13||a.tag===31){var c=ss(a,67108864);c!==null&&In(c,a,67108864),Hl(a,67108864)}}function gh(a){if(a.tag===13||a.tag===31){var c=Ln();c=gn(c);var b=ss(a,c);b!==null&&In(b,a,c),Hl(a,c)}}var qa=!0;function xp(a,c,b,x){var S=k.T;k.T=null;var A=H.p;try{H.p=2,ql(a,c,b,x)}finally{H.p=A,k.T=S}}function Tp(a,c,b,x){var S=k.T;k.T=null;var A=H.p;try{H.p=8,ql(a,c,b,x)}finally{H.p=A,k.T=S}}function ql(a,c,b,x){if(qa){var S=Yl(x);if(S===null)Bl(a,c,x,Ya,b),bh(a,x);else if(Ep(S,a,c,b,x))x.stopPropagation();else if(bh(a,x),c&4&&-1<wp.indexOf(a)){for(;S!==null;){var A=ct(S);if(A!==null)switch(A.tag){case 3:if(A=A.stateNode,A.current.memoizedState.isDehydrated){var F=et(A.pendingLanes);if(F!==0){var Q=A;for(Q.pendingLanes|=2,Q.entangledLanes|=2;F;){var me=1<<31-Pt(F);Q.entanglements[1]|=me,F&=~me}sr(A),(Bt&6)===0&&(Ma=Ie()+500,Di(0))}}break;case 31:case 13:Q=ss(A,2),Q!==null&&In(Q,A,2),Ia(),Hl(A,2)}if(A=Yl(x),A===null&&Bl(a,c,x,Ya,b),A===S)break;S=A}S!==null&&x.stopPropagation()}else Bl(a,c,x,null,b)}}function Yl(a){return a=Es(a),Wl(a)}var Ya=null;function Wl(a){if(Ya=null,a=We(a),a!==null){var c=u(a);if(c===null)a=null;else{var b=c.tag;if(b===13){if(a=l(c),a!==null)return a;a=null}else if(b===31){if(a=m(c),a!==null)return a;a=null}else if(b===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return Ya=a,null}function yh(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ae()){case De:return 2;case ze:return 8;case Ge:case He:return 32;case Ye:return 268435456;default:return 32}default:return 32}}var Xl=!1,Xr=null,Jr=null,Kr=null,ji=new Map,Hi=new Map,Qr=[],wp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bh(a,c){switch(a){case"focusin":case"focusout":Xr=null;break;case"dragenter":case"dragleave":Jr=null;break;case"mouseover":case"mouseout":Kr=null;break;case"pointerover":case"pointerout":ji.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hi.delete(c.pointerId)}}function qi(a,c,b,x,S,A){return a===null||a.nativeEvent!==A?(a={blockedOn:c,domEventName:b,eventSystemFlags:x,nativeEvent:A,targetContainers:[S]},c!==null&&(c=ct(c),c!==null&&mh(c)),a):(a.eventSystemFlags|=x,c=a.targetContainers,S!==null&&c.indexOf(S)===-1&&c.push(S),a)}function Ep(a,c,b,x,S){switch(c){case"focusin":return Xr=qi(Xr,a,c,b,x,S),!0;case"dragenter":return Jr=qi(Jr,a,c,b,x,S),!0;case"mouseover":return Kr=qi(Kr,a,c,b,x,S),!0;case"pointerover":var A=S.pointerId;return ji.set(A,qi(ji.get(A)||null,a,c,b,x,S)),!0;case"gotpointercapture":return A=S.pointerId,Hi.set(A,qi(Hi.get(A)||null,a,c,b,x,S)),!0}return!1}function _h(a){var c=We(a.target);if(c!==null){var b=u(c);if(b!==null){if(c=b.tag,c===13){if(c=l(b),c!==null){a.blockedOn=c,Cr(a.priority,function(){gh(b)});return}}else if(c===31){if(c=m(b),c!==null){a.blockedOn=c,Cr(a.priority,function(){gh(b)});return}}else if(c===3&&b.stateNode.current.memoizedState.isDehydrated){a.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Wa(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var b=Yl(a.nativeEvent);if(b===null){b=a.nativeEvent;var x=new b.constructor(b.type,b);ws=x,b.target.dispatchEvent(x),ws=null}else return c=ct(b),c!==null&&mh(c),a.blockedOn=b,!1;c.shift()}return!0}function vh(a,c,b){Wa(a)&&b.delete(c)}function Sp(){Xl=!1,Xr!==null&&Wa(Xr)&&(Xr=null),Jr!==null&&Wa(Jr)&&(Jr=null),Kr!==null&&Wa(Kr)&&(Kr=null),ji.forEach(vh),Hi.forEach(vh)}function Xa(a,c){a.blockedOn===c&&(a.blockedOn=null,Xl||(Xl=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Sp)))}var Ja=null;function xh(a){Ja!==a&&(Ja=a,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Ja===a&&(Ja=null);for(var c=0;c<a.length;c+=3){var b=a[c],x=a[c+1],S=a[c+2];if(typeof x!="function"){if(Wl(x||b)===null)continue;break}var A=ct(b);A!==null&&(a.splice(c,3),c-=3,Yo(A,{pending:!0,data:S,method:b.method,action:x},x,S))}}))}function ti(a){function c(me){return Xa(me,a)}Xr!==null&&Xa(Xr,a),Jr!==null&&Xa(Jr,a),Kr!==null&&Xa(Kr,a),ji.forEach(c),Hi.forEach(c);for(var b=0;b<Qr.length;b++){var x=Qr[b];x.blockedOn===a&&(x.blockedOn=null)}for(;0<Qr.length&&(b=Qr[0],b.blockedOn===null);)_h(b),b.blockedOn===null&&Qr.shift();if(b=(a.ownerDocument||a).$$reactFormReplay,b!=null)for(x=0;x<b.length;x+=3){var S=b[x],A=b[x+1],F=S[Z]||null;if(typeof A=="function")F||xh(b);else if(F){var Q=null;if(A&&A.hasAttribute("formAction")){if(S=A,F=A[Z]||null)Q=F.formAction;else if(Wl(S)!==null)continue}else Q=F.action;typeof Q=="function"?b[x+1]=Q:(b.splice(x,3),x-=3),xh(b)}}}function Th(){function a(A){A.canIntercept&&A.info==="react-transition"&&A.intercept({handler:function(){return new Promise(function(F){return S=F})},focusReset:"manual",scroll:"manual"})}function c(){S!==null&&(S(),S=null),x||setTimeout(b,20)}function b(){if(!x&&!navigation.transition){var A=navigation.currentEntry;A&&A.url!=null&&navigation.navigate(A.url,{state:A.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var x=!1,S=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",c),navigation.addEventListener("navigateerror",c),setTimeout(b,100),function(){x=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",c),navigation.removeEventListener("navigateerror",c),S!==null&&(S(),S=null)}}}function Jl(a){this._internalRoot=a}Ka.prototype.render=Jl.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(s(409));var b=c.current,x=Ln();fh(b,x,a,c,null,null)},Ka.prototype.unmount=Jl.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;fh(a.current,2,null,a,null,null),Ia(),c[he]=null}};function Ka(a){this._internalRoot=a}Ka.prototype.unstable_scheduleHydration=function(a){if(a){var c=Ar();a={blockedOn:null,target:a,priority:c};for(var b=0;b<Qr.length&&c!==0&&c<Qr[b].priority;b++);Qr.splice(b,0,a),b===0&&_h(a)}};var wh=e.version;if(wh!=="19.2.1")throw Error(s(527,wh,"19.2.1"));H.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=h(c),a=a!==null?f(a):null,a=a===null?null:a.stateNode,a};var Pp={bundleType:0,version:"19.2.1",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.2.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qa=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qa.isDisabled&&Qa.supportsFiber)try{ut=Qa.inject(Pp),qe=Qa}catch{}}return reactDomClient_production.createRoot=function(a,c){if(!o(a))throw Error(s(299));var b=!1,x="",S=Rc,A=Ic,F=Bc;return c!=null&&(c.unstable_strictMode===!0&&(b=!0),c.identifierPrefix!==void 0&&(x=c.identifierPrefix),c.onUncaughtError!==void 0&&(S=c.onUncaughtError),c.onCaughtError!==void 0&&(A=c.onCaughtError),c.onRecoverableError!==void 0&&(F=c.onRecoverableError)),c=dh(a,1,!1,null,null,b,x,null,S,A,F,Th),a[he]=c.current,Il(a),new Jl(c)},reactDomClient_production.hydrateRoot=function(a,c,b){if(!o(a))throw Error(s(299));var x=!1,S="",A=Rc,F=Ic,Q=Bc,me=null;return b!=null&&(b.unstable_strictMode===!0&&(x=!0),b.identifierPrefix!==void 0&&(S=b.identifierPrefix),b.onUncaughtError!==void 0&&(A=b.onUncaughtError),b.onCaughtError!==void 0&&(F=b.onCaughtError),b.onRecoverableError!==void 0&&(Q=b.onRecoverableError),b.formState!==void 0&&(me=b.formState)),c=dh(a,1,!0,c,b??null,x,S,me,A,F,Q,Th),c.context=hh(null),b=c.current,x=Ln(),x=gn(x),S=Dr(x),S.callback=null,Lr(b,S,x),b=x,c.current.lanes=b,on(c,b),sr(c),a[he]=c.current,Il(a),new Ka(c)},reactDomClient_production.version="19.2.1",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient();const ReactDOM=getDefaultExportFromCjs(clientExports);var UserRole=(n=>(n.EndUser="End User",n.Analyst="Analyst / Trainer",n.Admin="Admin (Both)",n))(UserRole||{}),DocumentStatus=(n=>(n.Uploaded="Uploaded",n.Parsing="Parsing",n.Mapping="Mapping",n.Review="Review",n.Posting="Posting",n.Done="Done",n))(DocumentStatus||{});const DOCUMENT_STATUSES=[DocumentStatus.Uploaded,DocumentStatus.Parsing,DocumentStatus.Mapping,DocumentStatus.Review,DocumentStatus.Posting,DocumentStatus.Done],DEFAULT_SAP_PATHS={CUSTOMER_SERVICE:"/sap/opu/odata/sap/API_BUSINESS_PARTNER_SRV",ORDER_SERVICE:"/sap/opu/odata/sap/API_SALES_ORDER_SRV"},ICONS={upload:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),jsxRuntimeExports.jsx("polyline",{points:"17 8 12 3 7 8"}),jsxRuntimeExports.jsx("line",{x1:"12",x2:"12",y1:"3",y2:"15"})]}),document:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),jsxRuntimeExports.jsx("polyline",{points:"14 2 14 8 20 8"})]}),brain:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v1.2a1 1 0 0 0 1 1h.3a1 1 0 0 0 .8-.4l.2-.3a2.5 2.5 0 0 1 4.2-2"}),jsxRuntimeExports.jsx("path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v1.2a1 1 0 0 1-1 1h-.3a1 1 0 0 1-.8-.4l-.2-.3a2.5 2.5 0 0 0-4.2-2"}),jsxRuntimeExports.jsx("path",{d:"M4.2 11.8A2.5 2.5 0 0 0 2 14.2a2.5 2.5 0 0 0 2.5 2.5c.9 0 1.7-.5 2.2-1.2"}),jsxRuntimeExports.jsx("path",{d:"M19.8 11.8a2.5 2.5 0 0 1 2.2 2.4 2.5 2.5 0 0 1-2.5 2.5c-.9 0-1.7-.5-2.2-1.2"}),jsxRuntimeExports.jsx("path",{d:"M12 6.5A2.5 2.5 0 0 1 9.5 9c0 .2 0 .3.1.5a2.5 2.5 0 0 0 4.8 0c.1-.2.1-.3.1-.5A2.5 2.5 0 0 1 12 6.5Z"}),jsxRuntimeExports.jsx("path",{d:"M12 14.5a2.5 2.5 0 0 1 2.5 2.5v.3a1 1 0 0 0 1 1h.3a1 1 0 0 0 .8-.4l.2-.3a2.5 2.5 0 0 1 4.2-2"}),jsxRuntimeExports.jsx("path",{d:"M12 14.5A2.5 2.5 0 0 0 9.5 17v.3a1 1 0 0 1-1 1h-.3a1 1 0 0 1-.8-.4l-.2-.3a2.5 2.5 0 0 0-4.2-2"})]}),trash:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M3 6h18"}),jsxRuntimeExports.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),jsxRuntimeExports.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]}),plus:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M5 12h14"}),jsxRuntimeExports.jsx("path",{d:"M12 5v14"})]}),settings:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"3"})]})},getTagColor=n=>{const e=["bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800","bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/30 dark:text-orange-300 dark:border-orange-800","bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-900/30 dark:text-amber-300 dark:border-amber-800","bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-800","bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-300 dark:border-emerald-800","bg-teal-100 text-teal-800 border-teal-200 dark:bg-teal-900/30 dark:text-teal-300 dark:border-teal-800","bg-cyan-100 text-cyan-800 border-cyan-200 dark:bg-cyan-900/30 dark:text-cyan-300 dark:border-cyan-800","bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800","bg-indigo-100 text-indigo-800 border-indigo-200 dark:bg-indigo-900/30 dark:text-indigo-300 dark:border-indigo-800","bg-violet-100 text-violet-800 border-violet-200 dark:bg-violet-900/30 dark:text-violet-300 dark:border-violet-800","bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-300 dark:border-purple-800","bg-fuchsia-100 text-fuchsia-800 border-fuchsia-200 dark:bg-fuchsia-900/30 dark:text-fuchsia-300 dark:border-fuchsia-800","bg-pink-100 text-pink-800 border-pink-200 dark:bg-pink-900/30 dark:text-pink-300 dark:border-pink-800","bg-rose-100 text-rose-800 border-rose-200 dark:bg-rose-900/30 dark:text-rose-300 dark:border-rose-800"];let t=0;for(let s=0;s<n.length;s++)t=n.charCodeAt(s)+((t<<5)-t);return e[Math.abs(t)%e.length]},AUTH_KEY="idp_auth_session",MOCK_USERS=[{id:"u1",email:"user@answerthink.com",name:"John Doe",role:UserRole.EndUser,avatar:"https://ui-avatars.com/api/?name=John+Doe&background=0D8ABC&color=fff"},{id:"u2",email:"analyst@answerthink.com",name:"Sarah Smith",role:UserRole.Analyst,avatar:"https://ui-avatars.com/api/?name=Sarah+Smith&background=6d28d9&color=fff"},{id:"u3",email:"admin@answerthink.com",name:"Admin User",role:UserRole.Admin,avatar:"https://ui-avatars.com/api/?name=Admin&background=10b981&color=fff"}],login=async n=>{await new Promise(t=>setTimeout(t,800));const e=MOCK_USERS.find(t=>t.email.toLowerCase()===n.toLowerCase());if(e)return localStorage.setItem(AUTH_KEY,JSON.stringify(e)),e;throw new Error("Invalid credentials. Try 'user@answerthink.com' or 'analyst@answerthink.com'")},logout=()=>{localStorage.removeItem(AUTH_KEY),window.location.reload()},getCurrentUser=()=>{try{const n=localStorage.getItem(AUTH_KEY);return n?JSON.parse(n):null}catch{return null}},hasPermission=(n,e)=>n.role===UserRole.Admin?!0:e==="training"||e==="test-bench"||e==="settings"?n.role===UserRole.Analyst:!0,Header=({user:n,navigateTo:e})=>{if(!n)return null;const t=hasPermission(n,"settings");return jsxRuntimeExports.jsxs("header",{className:"bg-blue-900 shadow-md p-4 flex justify-between items-center sticky top-0 z-20 border-b border-blue-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer",onClick:()=>e("dashboard"),children:[jsxRuntimeExports.jsx("div",{className:"text-white opacity-90",children:ICONS.brain}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-white tracking-tight",children:"Answerthink"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] text-blue-200 uppercase tracking-wider font-semibold",children:"Intelligent Document Processor"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-6",children:[jsxRuntimeExports.jsx("button",{onClick:()=>e("dashboard"),className:"text-sm font-medium text-blue-100 hover:text-white transition-colors",children:"Dashboard"}),t&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>e("training"),className:"text-sm font-medium text-blue-100 hover:text-white transition-colors",children:"Training Center"}),jsxRuntimeExports.jsxs("button",{onClick:()=>e("test-bench"),className:"text-sm font-medium text-blue-100 hover:text-white transition-colors flex items-center gap-1",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),"Dev Tools"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4 border-l border-blue-700 pl-4",children:[t&&jsxRuntimeExports.jsx("button",{onClick:()=>e("settings"),className:"text-blue-300 hover:text-white transition-colors p-1",title:"System Settings",children:ICONS.settings}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3 group relative cursor-pointer py-2",children:[jsxRuntimeExports.jsxs("div",{className:"text-right hidden md:block",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-bold text-white leading-none",children:n.name}),jsxRuntimeExports.jsx("p",{className:"text-[10px] text-blue-300 uppercase font-semibold mt-1",children:n.role})]}),jsxRuntimeExports.jsx("img",{src:n.avatar,alt:"User",className:"w-8 h-8 rounded-full border border-blue-400"}),jsxRuntimeExports.jsx("div",{className:"absolute right-0 top-full pt-4 w-40 hidden group-hover:block z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded shadow-lg overflow-hidden border border-slate-200 dark:border-slate-700",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-slate-100 dark:border-slate-700 md:hidden",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white",children:n.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500",children:n.role})]}),jsxRuntimeExports.jsxs("button",{onClick:logout,className:"w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-slate-50 dark:hover:bg-slate-700 font-medium transition-colors flex items-center",children:[jsxRuntimeExports.jsx("span",{className:"mr-2",children:"Log Out"}),jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),jsxRuntimeExports.jsx("polyline",{points:"16 17 21 12 16 7"}),jsxRuntimeExports.jsx("line",{x1:"21",x2:"9",y1:"12",y2:"12"})]})]})]})})]})]})]})]})},KanbanColumn=({status:n,documents:e,onReview:t,onDelete:s,onUpdateTags:o})=>{const[u,l]=reactExports.useState(20),m={[DocumentStatus.Uploaded]:"bg-slate-400",[DocumentStatus.Parsing]:"bg-blue-500",[DocumentStatus.Mapping]:"bg-indigo-600",[DocumentStatus.Review]:"bg-amber-500",[DocumentStatus.Posting]:"bg-purple-600",[DocumentStatus.Done]:"bg-emerald-600"},g=reactExports.useMemo(()=>e.slice(0,u),[e,u]),h=e.length>u,f=()=>{l(i=>i+20)};return jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-lg w-64 md:w-72 lg:w-80 flex-shrink-0 h-full flex flex-col border border-slate-200 dark:border-slate-700",children:[jsxRuntimeExports.jsxs("div",{className:"p-3 border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 rounded-t-lg flex items-center justify-between shadow-sm z-10",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-slate-700 dark:text-slate-200 text-sm uppercase tracking-wide",children:n}),jsxRuntimeExports.jsx("span",{className:"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-[10px] font-bold px-2 py-0.5 rounded-full border border-slate-200 dark:border-slate-600",children:e.length})]}),jsxRuntimeExports.jsx("span",{className:`w-2.5 h-2.5 rounded-full ${m[n]}`})]}),jsxRuntimeExports.jsxs("div",{className:"p-3 space-y-3 flex-1 overflow-y-auto min-h-0 custom-scrollbar",children:[g.map(i=>jsxRuntimeExports.jsx(DocumentCard,{doc:i,onReview:t,onDelete:s,onUpdateTags:o},i.id)),e.length===0&&jsxRuntimeExports.jsx("div",{className:"text-center text-xs text-slate-400 dark:text-slate-500 pt-10 italic",children:"No items"}),h&&jsxRuntimeExports.jsxs("button",{onClick:f,className:"w-full py-2 text-xs font-semibold text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded border border-transparent hover:border-blue-100 transition-all",children:["Load ",Math.min(20,e.length-u)," more..."]})]})]})},Spinner$1=()=>jsxRuntimeExports.jsxs("svg",{className:"animate-spin h-4 w-4 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),DocumentCard=({doc:n,onReview:e,onDelete:t,onUpdateTags:s})=>{const o=[DocumentStatus.Parsing,DocumentStatus.Mapping,DocumentStatus.Posting].includes(n.status),[u,l]=reactExports.useState(!1),[m,g]=reactExports.useState(""),h=()=>{const f=m.trim();if(f){const i=n.tags||[];i.includes(f)||s(n.id,[...i,f])}g(""),l(!1)};return jsxRuntimeExports.jsxs("div",{className:`bg-white dark:bg-slate-700 p-4 rounded border-l-4 shadow-sm border-t border-r border-b border-slate-200 dark:border-slate-600 hover:shadow-md transition-all relative group ${o?"border-l-blue-500 ring-1 ring-blue-100":"border-l-slate-300"}`,children:[jsxRuntimeExports.jsx("button",{onClick:f=>{f.stopPropagation(),t(n.id)},className:"absolute top-2 right-2 text-slate-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1 z-10",title:"Delete Document",children:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M3 6h18"}),jsxRuntimeExports.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),jsxRuntimeExports.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3 pr-4",children:[jsxRuntimeExports.jsx("div",{className:`mt-1 ${o?"text-blue-600 animate-pulse":"text-slate-500"}`,children:ICONS.document}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-sm text-slate-800 dark:text-slate-100 truncate",title:n.file.name,children:n.file.name}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mt-0.5",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:[(n.file.size/1024).toFixed(2)," KB"]}),n.emailContext&&jsxRuntimeExports.jsxs("span",{className:"text-[9px] bg-indigo-50 text-indigo-700 px-1 rounded border border-indigo-100 flex items-center gap-1",title:"Processed with Email Context",children:[jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("rect",{width:"20",height:"16",x:"2",y:"4",rx:"2"}),jsxRuntimeExports.jsx("path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"})]}),jsxRuntimeExports.jsx("span",{children:"Email"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[n.tags?.map(f=>jsxRuntimeExports.jsx("span",{className:`text-[9px] font-semibold px-1.5 py-0.5 rounded border ${getTagColor(f)}`,children:f},f)),jsxRuntimeExports.jsx("button",{onClick:f=>{f.stopPropagation(),l(!0)},className:`text-[9px] px-1.5 py-0.5 rounded border border-slate-200 dark:border-slate-600 text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-600 hover:text-slate-600 transition-colors ${u?"hidden":""}`,title:"Add Tag",children:"+"})]}),u&&jsxRuntimeExports.jsx("div",{className:"mt-1 flex gap-1",children:jsxRuntimeExports.jsx("input",{type:"text",value:m,onChange:f=>g(f.target.value),onKeyDown:f=>{f.key==="Enter"&&h(),f.key==="Escape"&&l(!1)},onBlur:()=>l(!1),autoFocus:!0,placeholder:"Tag...",className:"w-full text-xs p-1 border border-blue-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 bg-slate-50 dark:bg-slate-800 dark:border-slate-600 dark:text-white"})}),o&&jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 mt-3 bg-blue-50 dark:bg-blue-900/30 p-1.5 rounded border border-blue-100 dark:border-blue-800",children:[jsxRuntimeExports.jsx(Spinner$1,{}),jsxRuntimeExports.jsx("span",{className:"text-xs text-blue-800 dark:text-blue-300 font-medium",children:n.status===DocumentStatus.Mapping?"AI Analyzing...":`${n.status}...`})]})]})]}),n.status===DocumentStatus.Review&&jsxRuntimeExports.jsx("button",{onClick:()=>e(n.id),className:"mt-3 w-full text-center bg-white border border-blue-600 text-blue-700 hover:bg-blue-50 text-xs font-bold py-1.5 px-3 rounded transition-colors uppercase tracking-wide",children:"Review Required"})]})},UploadModal=({onClose:n,onUpload:e})=>{const[t,s]=reactExports.useState(null),[o,u]=reactExports.useState(null),[l,m]=reactExports.useState(""),[g,h]=reactExports.useState("text"),[f,i]=reactExports.useState(!1),r=_=>{_.target.files&&_.target.files.length>0&&s(_.target.files[0])},d=async _=>{if(_.target.files&&_.target.files.length>0){const y=_.target.files[0];if(u(y),y.type==="text/plain"||y.name.endsWith(".eml")||y.name.endsWith(".txt")){i(!0);try{const v=await y.text();m(v),h("text")}catch(v){console.error("Failed to read email file",v)}finally{i(!1)}}}},p=()=>{t&&(e([t],l),n())};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-lg w-full border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col max-h-[90vh]",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 flex justify-between items-center",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"Upload with Context"}),jsxRuntimeExports.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-600",children:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M18 6 6 18"}),jsxRuntimeExports.jsx("path",{d:"m6 6 12 12"})]})})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 overflow-y-auto",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:["1. Invoice / Order Document ",jsxRuntimeExports.jsx("span",{className:"text-red-500",children:"*"})]}),jsxRuntimeExports.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-6 text-center hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors relative",children:[jsxRuntimeExports.jsx("input",{type:"file",onChange:r,className:"absolute inset-0 opacity-0 cursor-pointer",accept:".pdf,.png,.jpg,.jpeg,.tiff"}),t?jsxRuntimeExports.jsxs("div",{className:"text-blue-600 font-medium flex items-center justify-center gap-2",children:[ICONS.document,t.name]}):jsxRuntimeExports.jsxs("div",{className:"text-slate-500 dark:text-slate-400 text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-blue-600 font-bold",children:"Click to browse"})," or drag PDF/Image here"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-2",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2 flex justify-between",children:jsxRuntimeExports.jsx("span",{children:"2. Email / Supplementary Text (Optional)"})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mb-3",children:'Include email body or specific instructions (e.g. "Ignore the header date"). This helps the AI refine extraction.'}),jsxRuntimeExports.jsxs("div",{className:"flex border-b border-slate-200 dark:border-slate-700 mb-0",children:[jsxRuntimeExports.jsx("button",{onClick:()=>h("text"),className:`px-4 py-2 text-xs font-bold ${g==="text"?"border-b-2 border-blue-600 text-blue-600":"text-slate-500"}`,children:"Paste Text"}),jsxRuntimeExports.jsx("button",{onClick:()=>h("file"),className:`px-4 py-2 text-xs font-bold ${g==="file"?"border-b-2 border-blue-600 text-blue-600":"text-slate-500"}`,children:"Upload .EML / .TXT"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 border-t-0 rounded-b-lg p-3",children:[g==="text"&&jsxRuntimeExports.jsx("textarea",{value:l,onChange:_=>m(_.target.value),placeholder:"Paste email content here...",className:"w-full h-32 p-2 text-sm border border-slate-300 dark:border-slate-600 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none dark:bg-slate-800 dark:text-white resize-none"}),g==="file"&&jsxRuntimeExports.jsxs("div",{className:"text-center py-6",children:[jsxRuntimeExports.jsx("input",{type:"file",onChange:d,accept:".eml,.txt",className:"hidden",id:"email-upload"}),jsxRuntimeExports.jsx("label",{htmlFor:"email-upload",className:"cursor-pointer bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 hover:bg-slate-50 px-4 py-2 rounded text-sm font-bold text-slate-700 dark:text-slate-200 shadow-sm",children:"Choose File"}),o&&jsxRuntimeExports.jsxs("div",{className:"mt-3 text-xs text-slate-600 dark:text-slate-400",children:[o.name," ",f?"(Reading...)":"(Loaded)"]})]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 flex justify-end gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:n,className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-800 rounded font-medium text-sm transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:p,disabled:!t,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded shadow-sm hover:shadow transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"Process Document"})]})]})})},DashboardView=({documents:n,handleFileUpload:e,navigateToReview:t,onDelete:s,onUpdateTags:o})=>{const[u,l]=reactExports.useState(!1),m=reactExports.useMemo(()=>{const g={};return DOCUMENT_STATUSES.forEach(h=>g[h]=[]),n.forEach(h=>{g[h.status]&&g[h.status].push(h)}),g},[n]);return jsxRuntimeExports.jsxs("div",{className:"p-6 h-[calc(100vh-64px)] flex flex-col bg-slate-100 dark:bg-slate-900",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-6 flex-shrink-0",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Document Pipeline"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Manage and track your SAP document processing workflows."})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>l(!0),className:"flex items-center space-x-2 bg-blue-700 hover:bg-blue-800 text-white font-semibold py-2 px-5 rounded shadow-sm hover:shadow transition-all",children:[ICONS.upload,jsxRuntimeExports.jsx("span",{children:"Upload Document"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex space-x-4 overflow-x-auto pb-4 flex-1",children:DOCUMENT_STATUSES.map(g=>jsxRuntimeExports.jsx(KanbanColumn,{status:g,documents:m[g]||[],onReview:t,onDelete:s,onUpdateTags:o},g))}),u&&jsxRuntimeExports.jsx(UploadModal,{onClose:()=>l(!1),onUpload:e})]})};var define_globalThis_process_env_default={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let _defaultBaseGeminiUrl,_defaultBaseVertexUrl;function getDefaultBaseUrls(){return{geminiUrl:_defaultBaseGeminiUrl,vertexUrl:_defaultBaseVertexUrl}}function getBaseUrl(n,e,t,s){var o,u;if(!n?.baseUrl){const l=getDefaultBaseUrls();return e?(o=l.vertexUrl)!==null&&o!==void 0?o:t:(u=l.geminiUrl)!==null&&u!==void 0?u:s}return n.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class BaseModule{}function formatMap(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(s,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){const u=e[o];return u!=null?String(u):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function setValueByPath(n,e,t){for(let u=0;u<e.length-1;u++){const l=e[u];if(l.endsWith("[]")){const m=l.slice(0,-2);if(!(m in n))if(Array.isArray(t))n[m]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(n[m])){const g=n[m];if(Array.isArray(t))for(let h=0;h<g.length;h++){const f=g[h];setValueByPath(f,e.slice(u+1),t[h])}else for(const h of g)setValueByPath(h,e.slice(u+1),t)}return}else if(l.endsWith("[0]")){const m=l.slice(0,-3);m in n||(n[m]=[{}]);const g=n[m];setValueByPath(g[0],e.slice(u+1),t);return}(!n[l]||typeof n[l]!="object")&&(n[l]={}),n=n[l]}const s=e[e.length-1],o=n[s];if(o!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===o)return;if(typeof o=="object"&&typeof t=="object"&&o!==null&&t!==null)Object.assign(o,t);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else s==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[s]=t}function getValueByPath(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let s=0;s<e.length;s++){if(typeof n!="object"||n===null)return t;const o=e[s];if(o.endsWith("[]")){const u=o.slice(0,-2);if(u in n){const l=n[u];return Array.isArray(l)?l.map(m=>getValueByPath(m,e.slice(s+1),t)):t}else return t}else n=n[o]}return n}catch(s){if(s instanceof TypeError)return t;throw s}}function moveValueByPath(n,e){for(const[t,s]of Object.entries(e)){const o=t.split("."),u=s.split("."),l=new Set;let m=-1;for(let g=0;g<o.length;g++)if(o[g]==="*"){m=g;break}if(m!==-1&&u.length>m)for(let g=m;g<u.length;g++){const h=u[g];h!=="*"&&!h.endsWith("[]")&&!h.endsWith("[0]")&&l.add(h)}_moveValueRecursive(n,o,u,0,l)}}function _moveValueRecursive(n,e,t,s,o){if(s>=e.length||typeof n!="object"||n===null)return;const u=e[s];if(u.endsWith("[]")){const l=u.slice(0,-2),m=n;if(l in m&&Array.isArray(m[l]))for(const g of m[l])_moveValueRecursive(g,e,t,s+1,o)}else if(u==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){const l=n,m=Object.keys(l).filter(h=>!h.startsWith("_")&&!o.has(h)),g={};for(const h of m)g[h]=l[h];for(const[h,f]of Object.entries(g)){const i=[];for(const r of t.slice(s))r==="*"?i.push(h):i.push(r);setValueByPath(l,i,f)}for(const h of m)delete l[h]}}else{const l=n;u in l&&_moveValueRecursive(l[u],e,t,s+1,o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tBytes$1(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fetchPredictOperationParametersToVertex(n){const e={},t=getValueByPath(n,["operationName"]);t!=null&&setValueByPath(e,["operationName"],t);const s=getValueByPath(n,["resourceName"]);return s!=null&&setValueByPath(e,["_url","resourceName"],s),e}function generateVideosOperationFromMldev$1(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["metadata"]);s!=null&&setValueByPath(e,["metadata"],s);const o=getValueByPath(n,["done"]);o!=null&&setValueByPath(e,["done"],o);const u=getValueByPath(n,["error"]);u!=null&&setValueByPath(e,["error"],u);const l=getValueByPath(n,["response","generateVideoResponse"]);return l!=null&&setValueByPath(e,["response"],generateVideosResponseFromMldev$1(l)),e}function generateVideosOperationFromVertex$1(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["metadata"]);s!=null&&setValueByPath(e,["metadata"],s);const o=getValueByPath(n,["done"]);o!=null&&setValueByPath(e,["done"],o);const u=getValueByPath(n,["error"]);u!=null&&setValueByPath(e,["error"],u);const l=getValueByPath(n,["response"]);return l!=null&&setValueByPath(e,["response"],generateVideosResponseFromVertex$1(l)),e}function generateVideosResponseFromMldev$1(n){const e={},t=getValueByPath(n,["generatedSamples"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(l=>generatedVideoFromMldev$1(l))),setValueByPath(e,["generatedVideos"],u)}const s=getValueByPath(n,["raiMediaFilteredCount"]);s!=null&&setValueByPath(e,["raiMediaFilteredCount"],s);const o=getValueByPath(n,["raiMediaFilteredReasons"]);return o!=null&&setValueByPath(e,["raiMediaFilteredReasons"],o),e}function generateVideosResponseFromVertex$1(n){const e={},t=getValueByPath(n,["videos"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(l=>generatedVideoFromVertex$1(l))),setValueByPath(e,["generatedVideos"],u)}const s=getValueByPath(n,["raiMediaFilteredCount"]);s!=null&&setValueByPath(e,["raiMediaFilteredCount"],s);const o=getValueByPath(n,["raiMediaFilteredReasons"]);return o!=null&&setValueByPath(e,["raiMediaFilteredReasons"],o),e}function generatedVideoFromMldev$1(n){const e={},t=getValueByPath(n,["video"]);return t!=null&&setValueByPath(e,["video"],videoFromMldev$1(t)),e}function generatedVideoFromVertex$1(n){const e={},t=getValueByPath(n,["_self"]);return t!=null&&setValueByPath(e,["video"],videoFromVertex$1(t)),e}function getOperationParametersToMldev(n){const e={},t=getValueByPath(n,["operationName"]);return t!=null&&setValueByPath(e,["_url","operationName"],t),e}function getOperationParametersToVertex(n){const e={},t=getValueByPath(n,["operationName"]);return t!=null&&setValueByPath(e,["_url","operationName"],t),e}function importFileOperationFromMldev$1(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["metadata"]);s!=null&&setValueByPath(e,["metadata"],s);const o=getValueByPath(n,["done"]);o!=null&&setValueByPath(e,["done"],o);const u=getValueByPath(n,["error"]);u!=null&&setValueByPath(e,["error"],u);const l=getValueByPath(n,["response"]);return l!=null&&setValueByPath(e,["response"],importFileResponseFromMldev$1(l)),e}function importFileResponseFromMldev$1(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["parent"]);s!=null&&setValueByPath(e,["parent"],s);const o=getValueByPath(n,["documentName"]);return o!=null&&setValueByPath(e,["documentName"],o),e}function uploadToFileSearchStoreOperationFromMldev(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["metadata"]);s!=null&&setValueByPath(e,["metadata"],s);const o=getValueByPath(n,["done"]);o!=null&&setValueByPath(e,["done"],o);const u=getValueByPath(n,["error"]);u!=null&&setValueByPath(e,["error"],u);const l=getValueByPath(n,["response"]);return l!=null&&setValueByPath(e,["response"],uploadToFileSearchStoreResponseFromMldev(l)),e}function uploadToFileSearchStoreResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["parent"]);s!=null&&setValueByPath(e,["parent"],s);const o=getValueByPath(n,["documentName"]);return o!=null&&setValueByPath(e,["documentName"],o),e}function videoFromMldev$1(n){const e={},t=getValueByPath(n,["uri"]);t!=null&&setValueByPath(e,["uri"],t);const s=getValueByPath(n,["encodedVideo"]);s!=null&&setValueByPath(e,["videoBytes"],tBytes$1(s));const o=getValueByPath(n,["encoding"]);return o!=null&&setValueByPath(e,["mimeType"],o),e}function videoFromVertex$1(n){const e={},t=getValueByPath(n,["gcsUri"]);t!=null&&setValueByPath(e,["uri"],t);const s=getValueByPath(n,["bytesBase64Encoded"]);s!=null&&setValueByPath(e,["videoBytes"],tBytes$1(s));const o=getValueByPath(n,["mimeType"]);return o!=null&&setValueByPath(e,["mimeType"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Outcome;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Outcome||(Outcome={}));var Language;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(Language||(Language={}));var FunctionResponseScheduling;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(FunctionResponseScheduling||(FunctionResponseScheduling={}));var Type;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(Type||(Type={}));var Mode;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Mode||(Mode={}));var ApiSpec;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(ApiSpec||(ApiSpec={}));var AuthType;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(AuthType||(AuthType={}));var HttpElementLocation;(function(n){n.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",n.HTTP_IN_QUERY="HTTP_IN_QUERY",n.HTTP_IN_HEADER="HTTP_IN_HEADER",n.HTTP_IN_PATH="HTTP_IN_PATH",n.HTTP_IN_BODY="HTTP_IN_BODY",n.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(HttpElementLocation||(HttpElementLocation={}));var PhishBlockThreshold;(function(n){n.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",n.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",n.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",n.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(PhishBlockThreshold||(PhishBlockThreshold={}));var ThinkingLevel;(function(n){n.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",n.LOW="LOW",n.HIGH="HIGH"})(ThinkingLevel||(ThinkingLevel={}));var HarmCategory;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(HarmCategory||(HarmCategory={}));var HarmBlockMethod;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(HarmBlockMethod||(HarmBlockMethod={}));var HarmBlockThreshold;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(HarmBlockThreshold||(HarmBlockThreshold={}));var FinishReason;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",n.NO_IMAGE="NO_IMAGE",n.IMAGE_RECITATION="IMAGE_RECITATION",n.IMAGE_OTHER="IMAGE_OTHER"})(FinishReason||(FinishReason={}));var HarmProbability;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(HarmProbability||(HarmProbability={}));var HarmSeverity;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(HarmSeverity||(HarmSeverity={}));var UrlRetrievalStatus;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(UrlRetrievalStatus||(UrlRetrievalStatus={}));var BlockedReason;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY",n.MODEL_ARMOR="MODEL_ARMOR",n.JAILBREAK="JAILBREAK"})(BlockedReason||(BlockedReason={}));var TrafficType;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(TrafficType||(TrafficType={}));var Modality;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(Modality||(Modality={}));var MediaResolution;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(MediaResolution||(MediaResolution={}));var TuningMode;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(TuningMode||(TuningMode={}));var AdapterSize;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(AdapterSize||(AdapterSize={}));var JobState;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(JobState||(JobState={}));var TuningTask;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V",n.TUNING_TASK_R2V="TUNING_TASK_R2V"})(TuningTask||(TuningTask={}));var PartMediaResolutionLevel;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(PartMediaResolutionLevel||(PartMediaResolutionLevel={}));var FeatureSelectionPreference;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(FeatureSelectionPreference||(FeatureSelectionPreference={}));var Behavior;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(Behavior||(Behavior={}));var DynamicRetrievalConfigMode;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(DynamicRetrievalConfigMode||(DynamicRetrievalConfigMode={}));var Environment$1;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Environment$1||(Environment$1={}));var FunctionCallingConfigMode;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(FunctionCallingConfigMode||(FunctionCallingConfigMode={}));var SafetyFilterLevel;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(SafetyFilterLevel||(SafetyFilterLevel={}));var PersonGeneration;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(PersonGeneration||(PersonGeneration={}));var ImagePromptLanguage;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(ImagePromptLanguage||(ImagePromptLanguage={}));var MaskReferenceMode;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(MaskReferenceMode||(MaskReferenceMode={}));var ControlReferenceType;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(ControlReferenceType||(ControlReferenceType={}));var SubjectReferenceType;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(SubjectReferenceType||(SubjectReferenceType={}));var EditMode;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(EditMode||(EditMode={}));var SegmentMode;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(SegmentMode||(SegmentMode={}));var VideoGenerationReferenceType;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(VideoGenerationReferenceType||(VideoGenerationReferenceType={}));var VideoGenerationMaskMode;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(VideoGenerationMaskMode||(VideoGenerationMaskMode={}));var VideoCompressionQuality;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(VideoCompressionQuality||(VideoCompressionQuality={}));var TuningMethod;(function(n){n.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",n.PREFERENCE_TUNING="PREFERENCE_TUNING"})(TuningMethod||(TuningMethod={}));var DocumentState;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.STATE_PENDING="STATE_PENDING",n.STATE_ACTIVE="STATE_ACTIVE",n.STATE_FAILED="STATE_FAILED"})(DocumentState||(DocumentState={}));var FileState;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(FileState||(FileState={}));var FileSource;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(FileSource||(FileSource={}));var TurnCompleteReason;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(TurnCompleteReason||(TurnCompleteReason={}));var MediaModality;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(MediaModality||(MediaModality={}));var VadSignalType;(function(n){n.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",n.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",n.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(VadSignalType||(VadSignalType={}));var StartSensitivity;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(StartSensitivity||(StartSensitivity={}));var EndSensitivity;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(EndSensitivity||(EndSensitivity={}));var ActivityHandling;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(ActivityHandling||(ActivityHandling={}));var TurnCoverage;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(TurnCoverage||(TurnCoverage={}));var Scale;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Scale||(Scale={}));var MusicGenerationMode;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(MusicGenerationMode||(MusicGenerationMode={}));var LiveMusicPlaybackControl;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(LiveMusicPlaybackControl||(LiveMusicPlaybackControl={}));class HttpResponse{constructor(e){const t={};for(const s of e.headers.entries())t[s[0]]=s[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class GenerateContentResponse{get text(){var e,t,s,o,u,l,m,g;if(((o=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let h="",f=!1;const i=[];for(const r of(g=(m=(l=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||l===void 0?void 0:l.content)===null||m===void 0?void 0:m.parts)!==null&&g!==void 0?g:[]){for(const[d,p]of Object.entries(r))d!=="text"&&d!=="thought"&&d!=="thoughtSignature"&&(p!==null||p!==void 0)&&i.push(d);if(typeof r.text=="string"){if(typeof r.thought=="boolean"&&r.thought)continue;f=!0,h+=r.text}}return i.length>0&&console.warn(`there are non-text parts ${i} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?h:void 0}get data(){var e,t,s,o,u,l,m,g;if(((o=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let h="";const f=[];for(const i of(g=(m=(l=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||l===void 0?void 0:l.content)===null||m===void 0?void 0:m.parts)!==null&&g!==void 0?g:[]){for(const[r,d]of Object.entries(i))r!=="inlineData"&&(d!==null||d!==void 0)&&f.push(r);i.inlineData&&typeof i.inlineData.data=="string"&&(h+=atob(i.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),h.length>0?btoa(h):void 0}get functionCalls(){var e,t,s,o,u,l,m,g;if(((o=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const h=(g=(m=(l=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||l===void 0?void 0:l.content)===null||m===void 0?void 0:m.parts)===null||g===void 0?void 0:g.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if(h?.length!==0)return h}get executableCode(){var e,t,s,o,u,l,m,g,h;if(((o=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(g=(m=(l=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||l===void 0?void 0:l.content)===null||m===void 0?void 0:m.parts)===null||g===void 0?void 0:g.filter(i=>i.executableCode).map(i=>i.executableCode).filter(i=>i!==void 0);if(f?.length!==0)return(h=f?.[0])===null||h===void 0?void 0:h.code}get codeExecutionResult(){var e,t,s,o,u,l,m,g,h;if(((o=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(g=(m=(l=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||l===void 0?void 0:l.content)===null||m===void 0?void 0:m.parts)===null||g===void 0?void 0:g.filter(i=>i.codeExecutionResult).map(i=>i.codeExecutionResult).filter(i=>i!==void 0);if(f?.length!==0)return(h=f?.[0])===null||h===void 0?void 0:h.output}}class EmbedContentResponse{}class GenerateImagesResponse{}class EditImageResponse{}class UpscaleImageResponse{}class RecontextImageResponse{}class SegmentImageResponse{}class ListModelsResponse{}class DeleteModelResponse{}class CountTokensResponse{}class ComputeTokensResponse{}class GenerateVideosOperation{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new GenerateVideosOperation;let o;const u=e;return t?o=generateVideosOperationFromVertex$1(u):o=generateVideosOperationFromMldev$1(u),Object.assign(s,o),s}}class ListTuningJobsResponse{}class CancelTuningJobResponse{}class DeleteCachedContentResponse{}class ListCachedContentsResponse{}class ListDocumentsResponse{}class ListFileSearchStoresResponse{}class UploadToFileSearchStoreResumableResponse{}class ImportFileOperation{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new ImportFileOperation,u=importFileOperationFromMldev$1(e);return Object.assign(s,u),s}}class ListFilesResponse{}class CreateFileResponse{}class DeleteFileResponse{}class ListBatchJobsResponse{}class LiveServerMessage{get text(){var e,t,s;let o="",u=!1;const l=[];for(const m of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[g,h]of Object.entries(m))g!=="text"&&g!=="thought"&&h!==null&&l.push(g);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;u=!0,o+=m.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?o:void 0}get data(){var e,t,s;let o="";const u=[];for(const l of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[m,g]of Object.entries(l))m!=="inlineData"&&g!==null&&u.push(m);l.inlineData&&typeof l.inlineData.data=="string"&&(o+=atob(l.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}}class LiveMusicServerMessage{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class UploadToFileSearchStoreOperation{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new UploadToFileSearchStoreOperation,u=uploadToFileSearchStoreOperationFromMldev(e);return Object.assign(s,u),s}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tModel(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function tCachesModel(n,e){const t=tModel(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function tBlobs(n){return Array.isArray(n)?n.map(e=>tBlob(e)):[tBlob(n)]}function tBlob(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function tImageBlob(n){const e=tBlob(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function tAudioBlob(n){const e=tBlob(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function tPart(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function tParts(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>tPart(e)):[tPart(n)]}function _isContent(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function _isFunctionCallPart(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function _isFunctionResponsePart(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function tContent(n){if(n==null)throw new Error("ContentUnion is required");return _isContent(n)?n:{role:"user",parts:tParts(n)}}function tContentsForEmbed(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const s=tContent(t);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(n.isVertexAI()){const t=tContent(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>tContent(t)):[tContent(e)]}function tContents(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(_isFunctionCallPart(n)||_isFunctionResponsePart(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[tContent(n)]}const e=[],t=[],s=_isContent(n[0]);for(const o of n){const u=_isContent(o);if(u!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(u)e.push(o);else{if(_isFunctionCallPart(o)||_isFunctionResponsePart(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(o)}}return s||e.push({role:"user",parts:tParts(t)}),e}function flattenTypeArrayToAnyOf(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(s=>s!=="null");if(t.length===1)e.type=Object.values(Type).includes(t[0].toUpperCase())?t[0].toUpperCase():Type.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of t)e.anyOf.push({type:Object.values(Type).includes(s.toUpperCase())?s.toUpperCase():Type.TYPE_UNSPECIFIED})}}function processJsonSchema(n){const e={},t=["items"],s=["anyOf"],o=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const u=n.anyOf;u!=null&&u.length==2&&(u[0].type==="null"?(e.nullable=!0,n=u[1]):u[1].type==="null"&&(e.nullable=!0,n=u[0])),n.type instanceof Array&&flattenTypeArrayToAnyOf(n.type,e);for(const[l,m]of Object.entries(n))if(m!=null)if(l=="type"){if(m==="null")throw new Error("type: null can not be the only possible type for the field.");if(m instanceof Array)continue;e.type=Object.values(Type).includes(m.toUpperCase())?m.toUpperCase():Type.TYPE_UNSPECIFIED}else if(t.includes(l))e[l]=processJsonSchema(m);else if(s.includes(l)){const g=[];for(const h of m){if(h.type=="null"){e.nullable=!0;continue}g.push(processJsonSchema(h))}e[l]=g}else if(o.includes(l)){const g={};for(const[h,f]of Object.entries(m))g[h]=processJsonSchema(f);e[l]=g}else{if(l==="additionalProperties")continue;e[l]=m}return e}function tSchema(n){return processJsonSchema(n)}function tSpeechConfig(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function tLiveSpeechConfig(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function tTool(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=processJsonSchema(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=processJsonSchema(e.response));return n}function tTools(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function resourceName(n,e,t,s=1){const o=!e.startsWith(`${t}/`)&&e.split("/").length===s;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:o?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:o?`${t}/${e}`:e}function tCachedContentName(n,e){if(typeof e!="string")throw new Error("name must be a string");return resourceName(n,e,"cachedContents")}function tTuningJobStatus(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function tBytes(n){return tBytes$1(n)}function _isFile(n){return n!=null&&typeof n=="object"&&"name"in n}function isGeneratedVideo(n){return n!=null&&typeof n=="object"&&"video"in n}function isVideo(n){return n!=null&&typeof n=="object"&&"uri"in n}function tFileName(n){var e;let t;if(_isFile(n)&&(t=n.name),!(isVideo(n)&&(t=n.uri,t===void 0))&&!(isGeneratedVideo(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const o=t.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${t}`);t=o[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function tModelsUrl(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function tExtractModels(n){for(const e of["models","tunedModels","publisherModels"])if(hasField(n,e))return n[e];return[]}function hasField(n,e){return n!==null&&typeof n=="object"&&e in n}function mcpToGeminiTool(n,e={}){const t=n,s={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(s.responseJsonSchema=t.outputSchema),e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function mcpToolsToGeminiTool(n,e={}){const t=[],s=new Set;for(const o of n){const u=o.name;if(s.has(u))throw new Error(`Duplicate function name ${u} found in MCP tools. Please ensure function names are unique.`);s.add(u);const l=mcpToGeminiTool(o,e);l.functionDeclarations&&t.push(...l.functionDeclarations)}return{functionDeclarations:t}}function tBatchJobSource(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const s=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,o=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(o>0||s!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function tBatchJobDestination(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function tRecvBatchJobDestination(n){if(typeof n!="object"||n===null)return{};const e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;const o=t.inlinedResponses;if(!Array.isArray(o)||o.length===0)return n;let u=!1;for(const l of o){if(typeof l!="object"||l===null)continue;const g=l.response;if(typeof g!="object"||g===null)continue;if(g.embedding!==void 0){u=!0;break}}return u&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function tBatchJobName(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function tJobState(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function batchJobDestinationFromMldev(n){const e={},t=getValueByPath(n,["responsesFile"]);t!=null&&setValueByPath(e,["fileName"],t);const s=getValueByPath(n,["inlinedResponses","inlinedResponses"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(l=>inlinedResponseFromMldev(l))),setValueByPath(e,["inlinedResponses"],u)}const o=getValueByPath(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(l=>l)),setValueByPath(e,["inlinedEmbedContentResponses"],u)}return e}function batchJobDestinationFromVertex(n){const e={},t=getValueByPath(n,["predictionsFormat"]);t!=null&&setValueByPath(e,["format"],t);const s=getValueByPath(n,["gcsDestination","outputUriPrefix"]);s!=null&&setValueByPath(e,["gcsUri"],s);const o=getValueByPath(n,["bigqueryDestination","outputUri"]);return o!=null&&setValueByPath(e,["bigqueryUri"],o),e}function batchJobDestinationToVertex(n){const e={},t=getValueByPath(n,["format"]);t!=null&&setValueByPath(e,["predictionsFormat"],t);const s=getValueByPath(n,["gcsUri"]);s!=null&&setValueByPath(e,["gcsDestination","outputUriPrefix"],s);const o=getValueByPath(n,["bigqueryUri"]);if(o!=null&&setValueByPath(e,["bigqueryDestination","outputUri"],o),getValueByPath(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(getValueByPath(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(getValueByPath(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function batchJobFromMldev(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["metadata","displayName"]);s!=null&&setValueByPath(e,["displayName"],s);const o=getValueByPath(n,["metadata","state"]);o!=null&&setValueByPath(e,["state"],tJobState(o));const u=getValueByPath(n,["metadata","createTime"]);u!=null&&setValueByPath(e,["createTime"],u);const l=getValueByPath(n,["metadata","endTime"]);l!=null&&setValueByPath(e,["endTime"],l);const m=getValueByPath(n,["metadata","updateTime"]);m!=null&&setValueByPath(e,["updateTime"],m);const g=getValueByPath(n,["metadata","model"]);g!=null&&setValueByPath(e,["model"],g);const h=getValueByPath(n,["metadata","output"]);return h!=null&&setValueByPath(e,["dest"],batchJobDestinationFromMldev(tRecvBatchJobDestination(h))),e}function batchJobFromVertex(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["displayName"]);s!=null&&setValueByPath(e,["displayName"],s);const o=getValueByPath(n,["state"]);o!=null&&setValueByPath(e,["state"],tJobState(o));const u=getValueByPath(n,["error"]);u!=null&&setValueByPath(e,["error"],u);const l=getValueByPath(n,["createTime"]);l!=null&&setValueByPath(e,["createTime"],l);const m=getValueByPath(n,["startTime"]);m!=null&&setValueByPath(e,["startTime"],m);const g=getValueByPath(n,["endTime"]);g!=null&&setValueByPath(e,["endTime"],g);const h=getValueByPath(n,["updateTime"]);h!=null&&setValueByPath(e,["updateTime"],h);const f=getValueByPath(n,["model"]);f!=null&&setValueByPath(e,["model"],f);const i=getValueByPath(n,["inputConfig"]);i!=null&&setValueByPath(e,["src"],batchJobSourceFromVertex(i));const r=getValueByPath(n,["outputConfig"]);r!=null&&setValueByPath(e,["dest"],batchJobDestinationFromVertex(tRecvBatchJobDestination(r)));const d=getValueByPath(n,["completionStats"]);return d!=null&&setValueByPath(e,["completionStats"],d),e}function batchJobSourceFromVertex(n){const e={},t=getValueByPath(n,["instancesFormat"]);t!=null&&setValueByPath(e,["format"],t);const s=getValueByPath(n,["gcsSource","uris"]);s!=null&&setValueByPath(e,["gcsUri"],s);const o=getValueByPath(n,["bigquerySource","inputUri"]);return o!=null&&setValueByPath(e,["bigqueryUri"],o),e}function batchJobSourceToMldev(n,e){const t={};if(getValueByPath(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(getValueByPath(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(getValueByPath(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=getValueByPath(e,["fileName"]);s!=null&&setValueByPath(t,["fileName"],s);const o=getValueByPath(e,["inlinedRequests"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(l=>inlinedRequestToMldev(n,l))),setValueByPath(t,["requests","requests"],u)}return t}function batchJobSourceToVertex(n){const e={},t=getValueByPath(n,["format"]);t!=null&&setValueByPath(e,["instancesFormat"],t);const s=getValueByPath(n,["gcsUri"]);s!=null&&setValueByPath(e,["gcsSource","uris"],s);const o=getValueByPath(n,["bigqueryUri"]);if(o!=null&&setValueByPath(e,["bigquerySource","inputUri"],o),getValueByPath(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(getValueByPath(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function blobToMldev$4(n){const e={},t=getValueByPath(n,["data"]);if(t!=null&&setValueByPath(e,["data"],t),getValueByPath(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function cancelBatchJobParametersToMldev(n,e){const t={},s=getValueByPath(e,["name"]);return s!=null&&setValueByPath(t,["_url","name"],tBatchJobName(n,s)),t}function cancelBatchJobParametersToVertex(n,e){const t={},s=getValueByPath(e,["name"]);return s!=null&&setValueByPath(t,["_url","name"],tBatchJobName(n,s)),t}function candidateFromMldev$1(n){const e={},t=getValueByPath(n,["content"]);t!=null&&setValueByPath(e,["content"],t);const s=getValueByPath(n,["citationMetadata"]);s!=null&&setValueByPath(e,["citationMetadata"],citationMetadataFromMldev$1(s));const o=getValueByPath(n,["tokenCount"]);o!=null&&setValueByPath(e,["tokenCount"],o);const u=getValueByPath(n,["finishReason"]);u!=null&&setValueByPath(e,["finishReason"],u);const l=getValueByPath(n,["avgLogprobs"]);l!=null&&setValueByPath(e,["avgLogprobs"],l);const m=getValueByPath(n,["groundingMetadata"]);m!=null&&setValueByPath(e,["groundingMetadata"],m);const g=getValueByPath(n,["index"]);g!=null&&setValueByPath(e,["index"],g);const h=getValueByPath(n,["logprobsResult"]);h!=null&&setValueByPath(e,["logprobsResult"],h);const f=getValueByPath(n,["safetyRatings"]);if(f!=null){let r=f;Array.isArray(r)&&(r=r.map(d=>d)),setValueByPath(e,["safetyRatings"],r)}const i=getValueByPath(n,["urlContextMetadata"]);return i!=null&&setValueByPath(e,["urlContextMetadata"],i),e}function citationMetadataFromMldev$1(n){const e={},t=getValueByPath(n,["citationSources"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>o)),setValueByPath(e,["citations"],s)}return e}function contentToMldev$4(n){const e={},t=getValueByPath(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>partToMldev$4(u))),setValueByPath(e,["parts"],o)}const s=getValueByPath(n,["role"]);return s!=null&&setValueByPath(e,["role"],s),e}function createBatchJobConfigToMldev(n,e){const t={},s=getValueByPath(n,["displayName"]);if(e!==void 0&&s!=null&&setValueByPath(e,["batch","displayName"],s),getValueByPath(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function createBatchJobConfigToVertex(n,e){const t={},s=getValueByPath(n,["displayName"]);e!==void 0&&s!=null&&setValueByPath(e,["displayName"],s);const o=getValueByPath(n,["dest"]);return e!==void 0&&o!=null&&setValueByPath(e,["outputConfig"],batchJobDestinationToVertex(tBatchJobDestination(o))),t}function createBatchJobParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["src"]);o!=null&&setValueByPath(t,["batch","inputConfig"],batchJobSourceToMldev(n,tBatchJobSource(n,o)));const u=getValueByPath(e,["config"]);return u!=null&&createBatchJobConfigToMldev(u,t),t}function createBatchJobParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["model"],tModel(n,s));const o=getValueByPath(e,["src"]);o!=null&&setValueByPath(t,["inputConfig"],batchJobSourceToVertex(tBatchJobSource(n,o)));const u=getValueByPath(e,["config"]);return u!=null&&createBatchJobConfigToVertex(u,t),t}function createEmbeddingsBatchJobConfigToMldev(n,e){const t={},s=getValueByPath(n,["displayName"]);return e!==void 0&&s!=null&&setValueByPath(e,["batch","displayName"],s),t}function createEmbeddingsBatchJobParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["src"]);o!=null&&setValueByPath(t,["batch","inputConfig"],embeddingsBatchJobSourceToMldev(n,o));const u=getValueByPath(e,["config"]);return u!=null&&createEmbeddingsBatchJobConfigToMldev(u,t),t}function deleteBatchJobParametersToMldev(n,e){const t={},s=getValueByPath(e,["name"]);return s!=null&&setValueByPath(t,["_url","name"],tBatchJobName(n,s)),t}function deleteBatchJobParametersToVertex(n,e){const t={},s=getValueByPath(e,["name"]);return s!=null&&setValueByPath(t,["_url","name"],tBatchJobName(n,s)),t}function deleteResourceJobFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["name"]);s!=null&&setValueByPath(e,["name"],s);const o=getValueByPath(n,["done"]);o!=null&&setValueByPath(e,["done"],o);const u=getValueByPath(n,["error"]);return u!=null&&setValueByPath(e,["error"],u),e}function deleteResourceJobFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["name"]);s!=null&&setValueByPath(e,["name"],s);const o=getValueByPath(n,["done"]);o!=null&&setValueByPath(e,["done"],o);const u=getValueByPath(n,["error"]);return u!=null&&setValueByPath(e,["error"],u),e}function embedContentBatchToMldev(n,e){const t={},s=getValueByPath(e,["contents"]);if(s!=null){let u=tContentsForEmbed(n,s);Array.isArray(u)&&(u=u.map(l=>l)),setValueByPath(t,["requests[]","request","content"],u)}const o=getValueByPath(e,["config"]);return o!=null&&(setValueByPath(t,["_self"],embedContentConfigToMldev$1(o,t)),moveValueByPath(t,{"requests[].*":"requests[].request.*"})),t}function embedContentConfigToMldev$1(n,e){const t={},s=getValueByPath(n,["taskType"]);e!==void 0&&s!=null&&setValueByPath(e,["requests[]","taskType"],s);const o=getValueByPath(n,["title"]);e!==void 0&&o!=null&&setValueByPath(e,["requests[]","title"],o);const u=getValueByPath(n,["outputDimensionality"]);if(e!==void 0&&u!=null&&setValueByPath(e,["requests[]","outputDimensionality"],u),getValueByPath(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(getValueByPath(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function embeddingsBatchJobSourceToMldev(n,e){const t={},s=getValueByPath(e,["fileName"]);s!=null&&setValueByPath(t,["file_name"],s);const o=getValueByPath(e,["inlinedRequests"]);return o!=null&&setValueByPath(t,["requests"],embedContentBatchToMldev(n,o)),t}function fileDataToMldev$4(n){const e={};if(getValueByPath(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=getValueByPath(n,["fileUri"]);t!=null&&setValueByPath(e,["fileUri"],t);const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function functionCallToMldev$4(n){const e={},t=getValueByPath(n,["id"]);t!=null&&setValueByPath(e,["id"],t);const s=getValueByPath(n,["args"]);s!=null&&setValueByPath(e,["args"],s);const o=getValueByPath(n,["name"]);if(o!=null&&setValueByPath(e,["name"],o),getValueByPath(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(getValueByPath(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function functionCallingConfigToMldev$2(n){const e={},t=getValueByPath(n,["mode"]);t!=null&&setValueByPath(e,["mode"],t);const s=getValueByPath(n,["allowedFunctionNames"]);if(s!=null&&setValueByPath(e,["allowedFunctionNames"],s),getValueByPath(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function generateContentConfigToMldev$1(n,e,t){const s={},o=getValueByPath(e,["systemInstruction"]);t!==void 0&&o!=null&&setValueByPath(t,["systemInstruction"],contentToMldev$4(tContent(o)));const u=getValueByPath(e,["temperature"]);u!=null&&setValueByPath(s,["temperature"],u);const l=getValueByPath(e,["topP"]);l!=null&&setValueByPath(s,["topP"],l);const m=getValueByPath(e,["topK"]);m!=null&&setValueByPath(s,["topK"],m);const g=getValueByPath(e,["candidateCount"]);g!=null&&setValueByPath(s,["candidateCount"],g);const h=getValueByPath(e,["maxOutputTokens"]);h!=null&&setValueByPath(s,["maxOutputTokens"],h);const f=getValueByPath(e,["stopSequences"]);f!=null&&setValueByPath(s,["stopSequences"],f);const i=getValueByPath(e,["responseLogprobs"]);i!=null&&setValueByPath(s,["responseLogprobs"],i);const r=getValueByPath(e,["logprobs"]);r!=null&&setValueByPath(s,["logprobs"],r);const d=getValueByPath(e,["presencePenalty"]);d!=null&&setValueByPath(s,["presencePenalty"],d);const p=getValueByPath(e,["frequencyPenalty"]);p!=null&&setValueByPath(s,["frequencyPenalty"],p);const _=getValueByPath(e,["seed"]);_!=null&&setValueByPath(s,["seed"],_);const y=getValueByPath(e,["responseMimeType"]);y!=null&&setValueByPath(s,["responseMimeType"],y);const v=getValueByPath(e,["responseSchema"]);v!=null&&setValueByPath(s,["responseSchema"],tSchema(v));const T=getValueByPath(e,["responseJsonSchema"]);if(T!=null&&setValueByPath(s,["responseJsonSchema"],T),getValueByPath(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(getValueByPath(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const w=getValueByPath(e,["safetySettings"]);if(t!==void 0&&w!=null){let re=w;Array.isArray(re)&&(re=re.map(W=>safetySettingToMldev$1(W))),setValueByPath(t,["safetySettings"],re)}const E=getValueByPath(e,["tools"]);if(t!==void 0&&E!=null){let re=tTools(E);Array.isArray(re)&&(re=re.map(W=>toolToMldev$4(tTool(W)))),setValueByPath(t,["tools"],re)}const P=getValueByPath(e,["toolConfig"]);if(t!==void 0&&P!=null&&setValueByPath(t,["toolConfig"],toolConfigToMldev$2(P)),getValueByPath(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const R=getValueByPath(e,["cachedContent"]);t!==void 0&&R!=null&&setValueByPath(t,["cachedContent"],tCachedContentName(n,R));const I=getValueByPath(e,["responseModalities"]);I!=null&&setValueByPath(s,["responseModalities"],I);const N=getValueByPath(e,["mediaResolution"]);N!=null&&setValueByPath(s,["mediaResolution"],N);const B=getValueByPath(e,["speechConfig"]);if(B!=null&&setValueByPath(s,["speechConfig"],tSpeechConfig(B)),getValueByPath(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const D=getValueByPath(e,["thinkingConfig"]);D!=null&&setValueByPath(s,["thinkingConfig"],D);const Y=getValueByPath(e,["imageConfig"]);Y!=null&&setValueByPath(s,["imageConfig"],imageConfigToMldev$1(Y));const se=getValueByPath(e,["enableEnhancedCivicAnswers"]);return se!=null&&setValueByPath(s,["enableEnhancedCivicAnswers"],se),s}function generateContentResponseFromMldev$1(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["candidates"]);if(s!=null){let g=s;Array.isArray(g)&&(g=g.map(h=>candidateFromMldev$1(h))),setValueByPath(e,["candidates"],g)}const o=getValueByPath(n,["modelVersion"]);o!=null&&setValueByPath(e,["modelVersion"],o);const u=getValueByPath(n,["promptFeedback"]);u!=null&&setValueByPath(e,["promptFeedback"],u);const l=getValueByPath(n,["responseId"]);l!=null&&setValueByPath(e,["responseId"],l);const m=getValueByPath(n,["usageMetadata"]);return m!=null&&setValueByPath(e,["usageMetadata"],m),e}function getBatchJobParametersToMldev(n,e){const t={},s=getValueByPath(e,["name"]);return s!=null&&setValueByPath(t,["_url","name"],tBatchJobName(n,s)),t}function getBatchJobParametersToVertex(n,e){const t={},s=getValueByPath(e,["name"]);return s!=null&&setValueByPath(t,["_url","name"],tBatchJobName(n,s)),t}function googleMapsToMldev$4(n){const e={};if(getValueByPath(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=getValueByPath(n,["enableWidget"]);return t!=null&&setValueByPath(e,["enableWidget"],t),e}function googleSearchToMldev$4(n){const e={};if(getValueByPath(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(getValueByPath(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=getValueByPath(n,["timeRangeFilter"]);return t!=null&&setValueByPath(e,["timeRangeFilter"],t),e}function imageConfigToMldev$1(n){const e={},t=getValueByPath(n,["aspectRatio"]);t!=null&&setValueByPath(e,["aspectRatio"],t);const s=getValueByPath(n,["imageSize"]);if(s!=null&&setValueByPath(e,["imageSize"],s),getValueByPath(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(getValueByPath(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function inlinedRequestToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["request","model"],tModel(n,s));const o=getValueByPath(e,["contents"]);if(o!=null){let m=tContents(o);Array.isArray(m)&&(m=m.map(g=>contentToMldev$4(g))),setValueByPath(t,["request","contents"],m)}const u=getValueByPath(e,["metadata"]);u!=null&&setValueByPath(t,["metadata"],u);const l=getValueByPath(e,["config"]);return l!=null&&setValueByPath(t,["request","generationConfig"],generateContentConfigToMldev$1(n,l,getValueByPath(t,["request"],{}))),t}function inlinedResponseFromMldev(n){const e={},t=getValueByPath(n,["response"]);t!=null&&setValueByPath(e,["response"],generateContentResponseFromMldev$1(t));const s=getValueByPath(n,["error"]);return s!=null&&setValueByPath(e,["error"],s),e}function listBatchJobsConfigToMldev(n,e){const t={},s=getValueByPath(n,["pageSize"]);e!==void 0&&s!=null&&setValueByPath(e,["_query","pageSize"],s);const o=getValueByPath(n,["pageToken"]);if(e!==void 0&&o!=null&&setValueByPath(e,["_query","pageToken"],o),getValueByPath(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function listBatchJobsConfigToVertex(n,e){const t={},s=getValueByPath(n,["pageSize"]);e!==void 0&&s!=null&&setValueByPath(e,["_query","pageSize"],s);const o=getValueByPath(n,["pageToken"]);e!==void 0&&o!=null&&setValueByPath(e,["_query","pageToken"],o);const u=getValueByPath(n,["filter"]);return e!==void 0&&u!=null&&setValueByPath(e,["_query","filter"],u),t}function listBatchJobsParametersToMldev(n){const e={},t=getValueByPath(n,["config"]);return t!=null&&listBatchJobsConfigToMldev(t,e),e}function listBatchJobsParametersToVertex(n){const e={},t=getValueByPath(n,["config"]);return t!=null&&listBatchJobsConfigToVertex(t,e),e}function listBatchJobsResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["nextPageToken"]);s!=null&&setValueByPath(e,["nextPageToken"],s);const o=getValueByPath(n,["operations"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(l=>batchJobFromMldev(l))),setValueByPath(e,["batchJobs"],u)}return e}function listBatchJobsResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["nextPageToken"]);s!=null&&setValueByPath(e,["nextPageToken"],s);const o=getValueByPath(n,["batchPredictionJobs"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(l=>batchJobFromVertex(l))),setValueByPath(e,["batchJobs"],u)}return e}function partToMldev$4(n){const e={},t=getValueByPath(n,["mediaResolution"]);t!=null&&setValueByPath(e,["mediaResolution"],t);const s=getValueByPath(n,["codeExecutionResult"]);s!=null&&setValueByPath(e,["codeExecutionResult"],s);const o=getValueByPath(n,["executableCode"]);o!=null&&setValueByPath(e,["executableCode"],o);const u=getValueByPath(n,["fileData"]);u!=null&&setValueByPath(e,["fileData"],fileDataToMldev$4(u));const l=getValueByPath(n,["functionCall"]);l!=null&&setValueByPath(e,["functionCall"],functionCallToMldev$4(l));const m=getValueByPath(n,["functionResponse"]);m!=null&&setValueByPath(e,["functionResponse"],m);const g=getValueByPath(n,["inlineData"]);g!=null&&setValueByPath(e,["inlineData"],blobToMldev$4(g));const h=getValueByPath(n,["text"]);h!=null&&setValueByPath(e,["text"],h);const f=getValueByPath(n,["thought"]);f!=null&&setValueByPath(e,["thought"],f);const i=getValueByPath(n,["thoughtSignature"]);i!=null&&setValueByPath(e,["thoughtSignature"],i);const r=getValueByPath(n,["videoMetadata"]);return r!=null&&setValueByPath(e,["videoMetadata"],r),e}function safetySettingToMldev$1(n){const e={},t=getValueByPath(n,["category"]);if(t!=null&&setValueByPath(e,["category"],t),getValueByPath(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=getValueByPath(n,["threshold"]);return s!=null&&setValueByPath(e,["threshold"],s),e}function toolConfigToMldev$2(n){const e={},t=getValueByPath(n,["functionCallingConfig"]);t!=null&&setValueByPath(e,["functionCallingConfig"],functionCallingConfigToMldev$2(t));const s=getValueByPath(n,["retrievalConfig"]);return s!=null&&setValueByPath(e,["retrievalConfig"],s),e}function toolToMldev$4(n){const e={},t=getValueByPath(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(i=>i)),setValueByPath(e,["functionDeclarations"],f)}if(getValueByPath(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=getValueByPath(n,["googleSearchRetrieval"]);s!=null&&setValueByPath(e,["googleSearchRetrieval"],s);const o=getValueByPath(n,["computerUse"]);o!=null&&setValueByPath(e,["computerUse"],o);const u=getValueByPath(n,["fileSearch"]);u!=null&&setValueByPath(e,["fileSearch"],u);const l=getValueByPath(n,["codeExecution"]);if(l!=null&&setValueByPath(e,["codeExecution"],l),getValueByPath(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const m=getValueByPath(n,["googleMaps"]);m!=null&&setValueByPath(e,["googleMaps"],googleMapsToMldev$4(m));const g=getValueByPath(n,["googleSearch"]);g!=null&&setValueByPath(e,["googleSearch"],googleSearchToMldev$4(g));const h=getValueByPath(n,["urlContext"]);return h!=null&&setValueByPath(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var PagedItem;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents"})(PagedItem||(PagedItem={}));class Pager{constructor(e,t,s,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,s,o)}init(e,t,s){var o,u;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let l={config:{}};!s||Object.keys(s).length===0?l={config:{}}:typeof s=="object"?l=Object.assign({},s):l=s,l.config&&(l.config.pageToken=t.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(u=(o=l.config)===null||o===void 0?void 0:o.pageSize)!==null&&u!==void 0?u:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Batches extends BaseModule{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Pager(PagedItem.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){const t=createBatchJobParametersToMldev(this.apiClient,e),s=t._url,o=formatMap("{model}:batchGenerateContent",s),m=t.batch.inputConfig.requests,g=m.requests,h=[];for(const f of g){const i=Object.assign({},f);if(i.systemInstruction){const r=i.systemInstruction;delete i.systemInstruction;const d=i.request;d.systemInstruction=r,i.request=d}h.push(i)}return m.requests=h,delete t.config,delete t._url,delete t._query,{path:o,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const s=t?Object.assign({},t):{},o=Date.now().toString();if(s.displayName||(s.displayName=`genaiBatchJob_${o}`),s.dest===void 0){const u=this.getGcsUri(e),l=this.getBigqueryUri(e);if(u)u.endsWith(".jsonl")?s.dest=`${u.slice(0,-6)}/dest`:s.dest=`${u}_dest_${o}`;else if(l)s.dest=`${l}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return s}async createInternal(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=createBatchJobParametersToVertex(this.apiClient,e);return m=formatMap("batchPredictionJobs",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>batchJobFromVertex(f))}else{const h=createBatchJobParametersToMldev(this.apiClient,e);return m=formatMap("{model}:batchGenerateContent",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json()),l.then(f=>batchJobFromMldev(f))}}async createEmbeddingsInternal(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=createEmbeddingsBatchJobParametersToMldev(this.apiClient,e);return u=formatMap("{model}:asyncBatchEmbedContent",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>batchJobFromMldev(g))}}async get(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=getBatchJobParametersToVertex(this.apiClient,e);return m=formatMap("batchPredictionJobs/{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>batchJobFromVertex(f))}else{const h=getBatchJobParametersToMldev(this.apiClient,e);return m=formatMap("batches/{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json()),l.then(f=>batchJobFromMldev(f))}}async cancel(e){var t,s,o,u;let l="",m={};if(this.apiClient.isVertexAI()){const g=cancelBatchJobParametersToVertex(this.apiClient,e);l=formatMap("batchPredictionJobs/{name}:cancel",g._url),m=g._query,delete g._url,delete g._query,await this.apiClient.request({path:l,queryParams:m,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const g=cancelBatchJobParametersToMldev(this.apiClient,e);l=formatMap("batches/{name}:cancel",g._url),m=g._query,delete g._url,delete g._query,await this.apiClient.request({path:l,queryParams:m,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal})}}async listInternal(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=listBatchJobsParametersToVertex(e);return m=formatMap("batchPredictionJobs",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=listBatchJobsResponseFromVertex(f),r=new ListBatchJobsResponse;return Object.assign(r,i),r})}else{const h=listBatchJobsParametersToMldev(e);return m=formatMap("batches",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=listBatchJobsResponseFromMldev(f),r=new ListBatchJobsResponse;return Object.assign(r,i),r})}}async delete(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=deleteBatchJobParametersToVertex(this.apiClient,e);return m=formatMap("batchPredictionJobs/{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>deleteResourceJobFromVertex(f))}else{const h=deleteBatchJobParametersToMldev(this.apiClient,e);return m=formatMap("batches/{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>deleteResourceJobFromMldev(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function blobToMldev$3(n){const e={},t=getValueByPath(n,["data"]);if(t!=null&&setValueByPath(e,["data"],t),getValueByPath(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function contentToMldev$3(n){const e={},t=getValueByPath(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>partToMldev$3(u))),setValueByPath(e,["parts"],o)}const s=getValueByPath(n,["role"]);return s!=null&&setValueByPath(e,["role"],s),e}function createCachedContentConfigToMldev(n,e){const t={},s=getValueByPath(n,["ttl"]);e!==void 0&&s!=null&&setValueByPath(e,["ttl"],s);const o=getValueByPath(n,["expireTime"]);e!==void 0&&o!=null&&setValueByPath(e,["expireTime"],o);const u=getValueByPath(n,["displayName"]);e!==void 0&&u!=null&&setValueByPath(e,["displayName"],u);const l=getValueByPath(n,["contents"]);if(e!==void 0&&l!=null){let f=tContents(l);Array.isArray(f)&&(f=f.map(i=>contentToMldev$3(i))),setValueByPath(e,["contents"],f)}const m=getValueByPath(n,["systemInstruction"]);e!==void 0&&m!=null&&setValueByPath(e,["systemInstruction"],contentToMldev$3(tContent(m)));const g=getValueByPath(n,["tools"]);if(e!==void 0&&g!=null){let f=g;Array.isArray(f)&&(f=f.map(i=>toolToMldev$3(i))),setValueByPath(e,["tools"],f)}const h=getValueByPath(n,["toolConfig"]);if(e!==void 0&&h!=null&&setValueByPath(e,["toolConfig"],toolConfigToMldev$1(h)),getValueByPath(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function createCachedContentConfigToVertex(n,e){const t={},s=getValueByPath(n,["ttl"]);e!==void 0&&s!=null&&setValueByPath(e,["ttl"],s);const o=getValueByPath(n,["expireTime"]);e!==void 0&&o!=null&&setValueByPath(e,["expireTime"],o);const u=getValueByPath(n,["displayName"]);e!==void 0&&u!=null&&setValueByPath(e,["displayName"],u);const l=getValueByPath(n,["contents"]);if(e!==void 0&&l!=null){let i=tContents(l);Array.isArray(i)&&(i=i.map(r=>r)),setValueByPath(e,["contents"],i)}const m=getValueByPath(n,["systemInstruction"]);e!==void 0&&m!=null&&setValueByPath(e,["systemInstruction"],tContent(m));const g=getValueByPath(n,["tools"]);if(e!==void 0&&g!=null){let i=g;Array.isArray(i)&&(i=i.map(r=>toolToVertex$2(r))),setValueByPath(e,["tools"],i)}const h=getValueByPath(n,["toolConfig"]);e!==void 0&&h!=null&&setValueByPath(e,["toolConfig"],h);const f=getValueByPath(n,["kmsKeyName"]);return e!==void 0&&f!=null&&setValueByPath(e,["encryption_spec","kmsKeyName"],f),t}function createCachedContentParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["model"],tCachesModel(n,s));const o=getValueByPath(e,["config"]);return o!=null&&createCachedContentConfigToMldev(o,t),t}function createCachedContentParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["model"],tCachesModel(n,s));const o=getValueByPath(e,["config"]);return o!=null&&createCachedContentConfigToVertex(o,t),t}function deleteCachedContentParametersToMldev(n,e){const t={},s=getValueByPath(e,["name"]);return s!=null&&setValueByPath(t,["_url","name"],tCachedContentName(n,s)),t}function deleteCachedContentParametersToVertex(n,e){const t={},s=getValueByPath(e,["name"]);return s!=null&&setValueByPath(t,["_url","name"],tCachedContentName(n,s)),t}function deleteCachedContentResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);return t!=null&&setValueByPath(e,["sdkHttpResponse"],t),e}function deleteCachedContentResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);return t!=null&&setValueByPath(e,["sdkHttpResponse"],t),e}function fileDataToMldev$3(n){const e={};if(getValueByPath(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=getValueByPath(n,["fileUri"]);t!=null&&setValueByPath(e,["fileUri"],t);const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function functionCallToMldev$3(n){const e={},t=getValueByPath(n,["id"]);t!=null&&setValueByPath(e,["id"],t);const s=getValueByPath(n,["args"]);s!=null&&setValueByPath(e,["args"],s);const o=getValueByPath(n,["name"]);if(o!=null&&setValueByPath(e,["name"],o),getValueByPath(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(getValueByPath(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function functionCallingConfigToMldev$1(n){const e={},t=getValueByPath(n,["mode"]);t!=null&&setValueByPath(e,["mode"],t);const s=getValueByPath(n,["allowedFunctionNames"]);if(s!=null&&setValueByPath(e,["allowedFunctionNames"],s),getValueByPath(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function functionDeclarationToVertex$2(n){const e={};if(getValueByPath(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=getValueByPath(n,["description"]);t!=null&&setValueByPath(e,["description"],t);const s=getValueByPath(n,["name"]);s!=null&&setValueByPath(e,["name"],s);const o=getValueByPath(n,["parameters"]);o!=null&&setValueByPath(e,["parameters"],o);const u=getValueByPath(n,["parametersJsonSchema"]);u!=null&&setValueByPath(e,["parametersJsonSchema"],u);const l=getValueByPath(n,["response"]);l!=null&&setValueByPath(e,["response"],l);const m=getValueByPath(n,["responseJsonSchema"]);return m!=null&&setValueByPath(e,["responseJsonSchema"],m),e}function getCachedContentParametersToMldev(n,e){const t={},s=getValueByPath(e,["name"]);return s!=null&&setValueByPath(t,["_url","name"],tCachedContentName(n,s)),t}function getCachedContentParametersToVertex(n,e){const t={},s=getValueByPath(e,["name"]);return s!=null&&setValueByPath(t,["_url","name"],tCachedContentName(n,s)),t}function googleMapsToMldev$3(n){const e={};if(getValueByPath(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=getValueByPath(n,["enableWidget"]);return t!=null&&setValueByPath(e,["enableWidget"],t),e}function googleSearchToMldev$3(n){const e={};if(getValueByPath(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(getValueByPath(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=getValueByPath(n,["timeRangeFilter"]);return t!=null&&setValueByPath(e,["timeRangeFilter"],t),e}function listCachedContentsConfigToMldev(n,e){const t={},s=getValueByPath(n,["pageSize"]);e!==void 0&&s!=null&&setValueByPath(e,["_query","pageSize"],s);const o=getValueByPath(n,["pageToken"]);return e!==void 0&&o!=null&&setValueByPath(e,["_query","pageToken"],o),t}function listCachedContentsConfigToVertex(n,e){const t={},s=getValueByPath(n,["pageSize"]);e!==void 0&&s!=null&&setValueByPath(e,["_query","pageSize"],s);const o=getValueByPath(n,["pageToken"]);return e!==void 0&&o!=null&&setValueByPath(e,["_query","pageToken"],o),t}function listCachedContentsParametersToMldev(n){const e={},t=getValueByPath(n,["config"]);return t!=null&&listCachedContentsConfigToMldev(t,e),e}function listCachedContentsParametersToVertex(n){const e={},t=getValueByPath(n,["config"]);return t!=null&&listCachedContentsConfigToVertex(t,e),e}function listCachedContentsResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["nextPageToken"]);s!=null&&setValueByPath(e,["nextPageToken"],s);const o=getValueByPath(n,["cachedContents"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(l=>l)),setValueByPath(e,["cachedContents"],u)}return e}function listCachedContentsResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["nextPageToken"]);s!=null&&setValueByPath(e,["nextPageToken"],s);const o=getValueByPath(n,["cachedContents"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(l=>l)),setValueByPath(e,["cachedContents"],u)}return e}function partToMldev$3(n){const e={},t=getValueByPath(n,["mediaResolution"]);t!=null&&setValueByPath(e,["mediaResolution"],t);const s=getValueByPath(n,["codeExecutionResult"]);s!=null&&setValueByPath(e,["codeExecutionResult"],s);const o=getValueByPath(n,["executableCode"]);o!=null&&setValueByPath(e,["executableCode"],o);const u=getValueByPath(n,["fileData"]);u!=null&&setValueByPath(e,["fileData"],fileDataToMldev$3(u));const l=getValueByPath(n,["functionCall"]);l!=null&&setValueByPath(e,["functionCall"],functionCallToMldev$3(l));const m=getValueByPath(n,["functionResponse"]);m!=null&&setValueByPath(e,["functionResponse"],m);const g=getValueByPath(n,["inlineData"]);g!=null&&setValueByPath(e,["inlineData"],blobToMldev$3(g));const h=getValueByPath(n,["text"]);h!=null&&setValueByPath(e,["text"],h);const f=getValueByPath(n,["thought"]);f!=null&&setValueByPath(e,["thought"],f);const i=getValueByPath(n,["thoughtSignature"]);i!=null&&setValueByPath(e,["thoughtSignature"],i);const r=getValueByPath(n,["videoMetadata"]);return r!=null&&setValueByPath(e,["videoMetadata"],r),e}function toolConfigToMldev$1(n){const e={},t=getValueByPath(n,["functionCallingConfig"]);t!=null&&setValueByPath(e,["functionCallingConfig"],functionCallingConfigToMldev$1(t));const s=getValueByPath(n,["retrievalConfig"]);return s!=null&&setValueByPath(e,["retrievalConfig"],s),e}function toolToMldev$3(n){const e={},t=getValueByPath(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(i=>i)),setValueByPath(e,["functionDeclarations"],f)}if(getValueByPath(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=getValueByPath(n,["googleSearchRetrieval"]);s!=null&&setValueByPath(e,["googleSearchRetrieval"],s);const o=getValueByPath(n,["computerUse"]);o!=null&&setValueByPath(e,["computerUse"],o);const u=getValueByPath(n,["fileSearch"]);u!=null&&setValueByPath(e,["fileSearch"],u);const l=getValueByPath(n,["codeExecution"]);if(l!=null&&setValueByPath(e,["codeExecution"],l),getValueByPath(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const m=getValueByPath(n,["googleMaps"]);m!=null&&setValueByPath(e,["googleMaps"],googleMapsToMldev$3(m));const g=getValueByPath(n,["googleSearch"]);g!=null&&setValueByPath(e,["googleSearch"],googleSearchToMldev$3(g));const h=getValueByPath(n,["urlContext"]);return h!=null&&setValueByPath(e,["urlContext"],h),e}function toolToVertex$2(n){const e={},t=getValueByPath(n,["functionDeclarations"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>functionDeclarationToVertex$2(r))),setValueByPath(e,["functionDeclarations"],i)}const s=getValueByPath(n,["retrieval"]);s!=null&&setValueByPath(e,["retrieval"],s);const o=getValueByPath(n,["googleSearchRetrieval"]);o!=null&&setValueByPath(e,["googleSearchRetrieval"],o);const u=getValueByPath(n,["computerUse"]);if(u!=null&&setValueByPath(e,["computerUse"],u),getValueByPath(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=getValueByPath(n,["codeExecution"]);l!=null&&setValueByPath(e,["codeExecution"],l);const m=getValueByPath(n,["enterpriseWebSearch"]);m!=null&&setValueByPath(e,["enterpriseWebSearch"],m);const g=getValueByPath(n,["googleMaps"]);g!=null&&setValueByPath(e,["googleMaps"],g);const h=getValueByPath(n,["googleSearch"]);h!=null&&setValueByPath(e,["googleSearch"],h);const f=getValueByPath(n,["urlContext"]);return f!=null&&setValueByPath(e,["urlContext"],f),e}function updateCachedContentConfigToMldev(n,e){const t={},s=getValueByPath(n,["ttl"]);e!==void 0&&s!=null&&setValueByPath(e,["ttl"],s);const o=getValueByPath(n,["expireTime"]);return e!==void 0&&o!=null&&setValueByPath(e,["expireTime"],o),t}function updateCachedContentConfigToVertex(n,e){const t={},s=getValueByPath(n,["ttl"]);e!==void 0&&s!=null&&setValueByPath(e,["ttl"],s);const o=getValueByPath(n,["expireTime"]);return e!==void 0&&o!=null&&setValueByPath(e,["expireTime"],o),t}function updateCachedContentParametersToMldev(n,e){const t={},s=getValueByPath(e,["name"]);s!=null&&setValueByPath(t,["_url","name"],tCachedContentName(n,s));const o=getValueByPath(e,["config"]);return o!=null&&updateCachedContentConfigToMldev(o,t),t}function updateCachedContentParametersToVertex(n,e){const t={},s=getValueByPath(e,["name"]);s!=null&&setValueByPath(t,["_url","name"],tCachedContentName(n,s));const o=getValueByPath(e,["config"]);return o!=null&&updateCachedContentConfigToVertex(o,t),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Caches extends BaseModule{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Pager(PagedItem.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(t),t)}async create(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=createCachedContentParametersToVertex(this.apiClient,e);return m=formatMap("cachedContents",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>f)}else{const h=createCachedContentParametersToMldev(this.apiClient,e);return m=formatMap("cachedContents",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json()),l.then(f=>f)}}async get(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=getCachedContentParametersToVertex(this.apiClient,e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>f)}else{const h=getCachedContentParametersToMldev(this.apiClient,e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json()),l.then(f=>f)}}async delete(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=deleteCachedContentParametersToVertex(this.apiClient,e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=deleteCachedContentResponseFromVertex(f),r=new DeleteCachedContentResponse;return Object.assign(r,i),r})}else{const h=deleteCachedContentParametersToMldev(this.apiClient,e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=deleteCachedContentResponseFromMldev(f),r=new DeleteCachedContentResponse;return Object.assign(r,i),r})}}async update(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=updateCachedContentParametersToVertex(this.apiClient,e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>f)}else{const h=updateCachedContentParametersToMldev(this.apiClient,e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json()),l.then(f=>f)}}async listInternal(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=listCachedContentsParametersToVertex(e);return m=formatMap("cachedContents",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=listCachedContentsResponseFromVertex(f),r=new ListCachedContentsResponse;return Object.assign(r,i),r})}else{const h=listCachedContentsParametersToMldev(e);return m=formatMap("cachedContents",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=listCachedContentsResponseFromMldev(f),r=new ListCachedContentsResponse;return Object.assign(r,i),r})}}}function __rest(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(n);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(n,s[o])&&(t[s[o]]=n[s[o]]);return t}function __values(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],s=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function __await(n){return this instanceof __await?(this.v=n,this):new __await(n)}function __asyncGenerator(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(n,e||[]),o,u=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),m("next"),m("throw"),m("return",l),o[Symbol.asyncIterator]=function(){return this},o;function l(d){return function(p){return Promise.resolve(p).then(d,i)}}function m(d,p){s[d]&&(o[d]=function(_){return new Promise(function(y,v){u.push([d,_,y,v])>1||g(d,_)})},p&&(o[d]=p(o[d])))}function g(d,p){try{h(s[d](p))}catch(_){r(u[0][3],_)}}function h(d){d.value instanceof __await?Promise.resolve(d.value.v).then(f,i):r(u[0][2],d)}function f(d){g("next",d)}function i(d){g("throw",d)}function r(d,p){d(p),u.shift(),u.length&&g(u[0][0],u[0][1])}}function __asyncValues(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(u){t[u]=n[u]&&function(l){return new Promise(function(m,g){l=n[u](l),o(m,g,l.done,l.value)})}}function o(u,l,m,g){Promise.resolve(g).then(function(h){u({value:h,done:m})},l)}}typeof SuppressedError=="function"&&SuppressedError;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function isValidResponse(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:isValidContent(t)}function isValidContent(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function validateHistory(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function extractCuratedHistory(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let s=0;for(;s<t;)if(n[s].role==="user")e.push(n[s]),s++;else{const o=[];let u=!0;for(;s<t&&n[s].role==="model";)o.push(n[s]),u&&!isValidContent(n[s])&&(u=!1),s++;u?e.push(...o):e.pop()}return e}class Chats{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Chat(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Chat{constructor(e,t,s,o={},u=[]){this.apiClient=e,this.modelsModule=t,this.model=s,this.config=o,this.history=u,this.sendPromise=Promise.resolve(),validateHistory(u)}async sendMessage(e){var t;await this.sendPromise;const s=tContent(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var u,l,m;const g=await o,h=(l=(u=g.candidates)===null||u===void 0?void 0:u[0])===null||l===void 0?void 0:l.content,f=g.automaticFunctionCallingHistory,i=this.getHistory(!0).length;let r=[];f!=null&&(r=(m=f.slice(i))!==null&&m!==void 0?m:[]);const d=h?[h]:[];this.recordHistory(s,d,r)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var t;await this.sendPromise;const s=tContent(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});const u=await o;return this.processStreamResponse(u,s)}getHistory(e=!1){const t=e?extractCuratedHistory(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return __asyncGenerator(this,arguments,function*(){var o,u,l,m,g,h;const f=[];try{for(var i=!0,r=__asyncValues(e),d;d=yield __await(r.next()),o=d.done,!o;i=!0){m=d.value,i=!1;const p=m;if(isValidResponse(p)){const _=(h=(g=p.candidates)===null||g===void 0?void 0:g[0])===null||h===void 0?void 0:h.content;_!==void 0&&f.push(_)}yield yield __await(p)}}catch(p){u={error:p}}finally{try{!i&&!o&&(l=r.return)&&(yield __await(l.call(r)))}finally{if(u)throw u.error}}this.recordHistory(t,f)})}recordHistory(e,t,s){let o=[];t.length>0&&t.every(u=>u.role!==void 0)?o=t:o.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...extractCuratedHistory(s)):this.history.push(e),this.history.push(...o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ApiError extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,ApiError.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function createFileParametersToMldev(n){const e={},t=getValueByPath(n,["file"]);return t!=null&&setValueByPath(e,["file"],t),e}function createFileResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);return t!=null&&setValueByPath(e,["sdkHttpResponse"],t),e}function deleteFileParametersToMldev(n){const e={},t=getValueByPath(n,["name"]);return t!=null&&setValueByPath(e,["_url","file"],tFileName(t)),e}function deleteFileResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);return t!=null&&setValueByPath(e,["sdkHttpResponse"],t),e}function getFileParametersToMldev(n){const e={},t=getValueByPath(n,["name"]);return t!=null&&setValueByPath(e,["_url","file"],tFileName(t)),e}function listFilesConfigToMldev(n,e){const t={},s=getValueByPath(n,["pageSize"]);e!==void 0&&s!=null&&setValueByPath(e,["_query","pageSize"],s);const o=getValueByPath(n,["pageToken"]);return e!==void 0&&o!=null&&setValueByPath(e,["_query","pageToken"],o),t}function listFilesParametersToMldev(n){const e={},t=getValueByPath(n,["config"]);return t!=null&&listFilesConfigToMldev(t,e),e}function listFilesResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["nextPageToken"]);s!=null&&setValueByPath(e,["nextPageToken"],s);const o=getValueByPath(n,["files"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(l=>l)),setValueByPath(e,["files"],u)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Files extends BaseModule{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Pager(PagedItem.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=listFilesParametersToMldev(e);return u=formatMap("files",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:g.headers},f})),o.then(g=>{const h=listFilesResponseFromMldev(g),f=new ListFilesResponse;return Object.assign(f,h),f})}}async createInternal(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=createFileParametersToMldev(e);return u=formatMap("upload/v1beta/files",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>{const h=createFileResponseFromMldev(g),f=new CreateFileResponse;return Object.assign(f,h),f})}}async get(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=getFileParametersToMldev(e);return u=formatMap("files/{file}",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>g)}}async delete(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=deleteFileParametersToMldev(e);return u=formatMap("files/{file}",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:g.headers},f})),o.then(g=>{const h=deleteFileResponseFromMldev(g),f=new DeleteFileResponse;return Object.assign(f,h),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function blobToMldev$2(n){const e={},t=getValueByPath(n,["data"]);if(t!=null&&setValueByPath(e,["data"],t),getValueByPath(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function contentToMldev$2(n){const e={},t=getValueByPath(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>partToMldev$2(u))),setValueByPath(e,["parts"],o)}const s=getValueByPath(n,["role"]);return s!=null&&setValueByPath(e,["role"],s),e}function fileDataToMldev$2(n){const e={};if(getValueByPath(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=getValueByPath(n,["fileUri"]);t!=null&&setValueByPath(e,["fileUri"],t);const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function functionCallToMldev$2(n){const e={},t=getValueByPath(n,["id"]);t!=null&&setValueByPath(e,["id"],t);const s=getValueByPath(n,["args"]);s!=null&&setValueByPath(e,["args"],s);const o=getValueByPath(n,["name"]);if(o!=null&&setValueByPath(e,["name"],o),getValueByPath(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(getValueByPath(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function functionDeclarationToVertex$1(n){const e={};if(getValueByPath(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=getValueByPath(n,["description"]);t!=null&&setValueByPath(e,["description"],t);const s=getValueByPath(n,["name"]);s!=null&&setValueByPath(e,["name"],s);const o=getValueByPath(n,["parameters"]);o!=null&&setValueByPath(e,["parameters"],o);const u=getValueByPath(n,["parametersJsonSchema"]);u!=null&&setValueByPath(e,["parametersJsonSchema"],u);const l=getValueByPath(n,["response"]);l!=null&&setValueByPath(e,["response"],l);const m=getValueByPath(n,["responseJsonSchema"]);return m!=null&&setValueByPath(e,["responseJsonSchema"],m),e}function generationConfigToVertex$1(n){const e={},t=getValueByPath(n,["modelSelectionConfig"]);t!=null&&setValueByPath(e,["modelConfig"],t);const s=getValueByPath(n,["responseJsonSchema"]);s!=null&&setValueByPath(e,["responseJsonSchema"],s);const o=getValueByPath(n,["audioTimestamp"]);o!=null&&setValueByPath(e,["audioTimestamp"],o);const u=getValueByPath(n,["candidateCount"]);u!=null&&setValueByPath(e,["candidateCount"],u);const l=getValueByPath(n,["enableAffectiveDialog"]);l!=null&&setValueByPath(e,["enableAffectiveDialog"],l);const m=getValueByPath(n,["frequencyPenalty"]);m!=null&&setValueByPath(e,["frequencyPenalty"],m);const g=getValueByPath(n,["logprobs"]);g!=null&&setValueByPath(e,["logprobs"],g);const h=getValueByPath(n,["maxOutputTokens"]);h!=null&&setValueByPath(e,["maxOutputTokens"],h);const f=getValueByPath(n,["mediaResolution"]);f!=null&&setValueByPath(e,["mediaResolution"],f);const i=getValueByPath(n,["presencePenalty"]);i!=null&&setValueByPath(e,["presencePenalty"],i);const r=getValueByPath(n,["responseLogprobs"]);r!=null&&setValueByPath(e,["responseLogprobs"],r);const d=getValueByPath(n,["responseMimeType"]);d!=null&&setValueByPath(e,["responseMimeType"],d);const p=getValueByPath(n,["responseModalities"]);p!=null&&setValueByPath(e,["responseModalities"],p);const _=getValueByPath(n,["responseSchema"]);_!=null&&setValueByPath(e,["responseSchema"],_);const y=getValueByPath(n,["routingConfig"]);y!=null&&setValueByPath(e,["routingConfig"],y);const v=getValueByPath(n,["seed"]);v!=null&&setValueByPath(e,["seed"],v);const T=getValueByPath(n,["speechConfig"]);T!=null&&setValueByPath(e,["speechConfig"],speechConfigToVertex$1(T));const w=getValueByPath(n,["stopSequences"]);w!=null&&setValueByPath(e,["stopSequences"],w);const E=getValueByPath(n,["temperature"]);E!=null&&setValueByPath(e,["temperature"],E);const P=getValueByPath(n,["thinkingConfig"]);P!=null&&setValueByPath(e,["thinkingConfig"],P);const R=getValueByPath(n,["topK"]);R!=null&&setValueByPath(e,["topK"],R);const I=getValueByPath(n,["topP"]);if(I!=null&&setValueByPath(e,["topP"],I),getValueByPath(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function googleMapsToMldev$2(n){const e={};if(getValueByPath(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=getValueByPath(n,["enableWidget"]);return t!=null&&setValueByPath(e,["enableWidget"],t),e}function googleSearchToMldev$2(n){const e={};if(getValueByPath(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(getValueByPath(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=getValueByPath(n,["timeRangeFilter"]);return t!=null&&setValueByPath(e,["timeRangeFilter"],t),e}function liveConnectConfigToMldev$1(n,e){const t={},s=getValueByPath(n,["generationConfig"]);e!==void 0&&s!=null&&setValueByPath(e,["setup","generationConfig"],s);const o=getValueByPath(n,["responseModalities"]);e!==void 0&&o!=null&&setValueByPath(e,["setup","generationConfig","responseModalities"],o);const u=getValueByPath(n,["temperature"]);e!==void 0&&u!=null&&setValueByPath(e,["setup","generationConfig","temperature"],u);const l=getValueByPath(n,["topP"]);e!==void 0&&l!=null&&setValueByPath(e,["setup","generationConfig","topP"],l);const m=getValueByPath(n,["topK"]);e!==void 0&&m!=null&&setValueByPath(e,["setup","generationConfig","topK"],m);const g=getValueByPath(n,["maxOutputTokens"]);e!==void 0&&g!=null&&setValueByPath(e,["setup","generationConfig","maxOutputTokens"],g);const h=getValueByPath(n,["mediaResolution"]);e!==void 0&&h!=null&&setValueByPath(e,["setup","generationConfig","mediaResolution"],h);const f=getValueByPath(n,["seed"]);e!==void 0&&f!=null&&setValueByPath(e,["setup","generationConfig","seed"],f);const i=getValueByPath(n,["speechConfig"]);e!==void 0&&i!=null&&setValueByPath(e,["setup","generationConfig","speechConfig"],tLiveSpeechConfig(i));const r=getValueByPath(n,["thinkingConfig"]);e!==void 0&&r!=null&&setValueByPath(e,["setup","generationConfig","thinkingConfig"],r);const d=getValueByPath(n,["enableAffectiveDialog"]);e!==void 0&&d!=null&&setValueByPath(e,["setup","generationConfig","enableAffectiveDialog"],d);const p=getValueByPath(n,["systemInstruction"]);e!==void 0&&p!=null&&setValueByPath(e,["setup","systemInstruction"],contentToMldev$2(tContent(p)));const _=getValueByPath(n,["tools"]);if(e!==void 0&&_!=null){let R=tTools(_);Array.isArray(R)&&(R=R.map(I=>toolToMldev$2(tTool(I)))),setValueByPath(e,["setup","tools"],R)}const y=getValueByPath(n,["sessionResumption"]);e!==void 0&&y!=null&&setValueByPath(e,["setup","sessionResumption"],sessionResumptionConfigToMldev$1(y));const v=getValueByPath(n,["inputAudioTranscription"]);e!==void 0&&v!=null&&setValueByPath(e,["setup","inputAudioTranscription"],v);const T=getValueByPath(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&setValueByPath(e,["setup","outputAudioTranscription"],T);const w=getValueByPath(n,["realtimeInputConfig"]);e!==void 0&&w!=null&&setValueByPath(e,["setup","realtimeInputConfig"],w);const E=getValueByPath(n,["contextWindowCompression"]);e!==void 0&&E!=null&&setValueByPath(e,["setup","contextWindowCompression"],E);const P=getValueByPath(n,["proactivity"]);if(e!==void 0&&P!=null&&setValueByPath(e,["setup","proactivity"],P),getValueByPath(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function liveConnectConfigToVertex(n,e){const t={},s=getValueByPath(n,["generationConfig"]);e!==void 0&&s!=null&&setValueByPath(e,["setup","generationConfig"],generationConfigToVertex$1(s));const o=getValueByPath(n,["responseModalities"]);e!==void 0&&o!=null&&setValueByPath(e,["setup","generationConfig","responseModalities"],o);const u=getValueByPath(n,["temperature"]);e!==void 0&&u!=null&&setValueByPath(e,["setup","generationConfig","temperature"],u);const l=getValueByPath(n,["topP"]);e!==void 0&&l!=null&&setValueByPath(e,["setup","generationConfig","topP"],l);const m=getValueByPath(n,["topK"]);e!==void 0&&m!=null&&setValueByPath(e,["setup","generationConfig","topK"],m);const g=getValueByPath(n,["maxOutputTokens"]);e!==void 0&&g!=null&&setValueByPath(e,["setup","generationConfig","maxOutputTokens"],g);const h=getValueByPath(n,["mediaResolution"]);e!==void 0&&h!=null&&setValueByPath(e,["setup","generationConfig","mediaResolution"],h);const f=getValueByPath(n,["seed"]);e!==void 0&&f!=null&&setValueByPath(e,["setup","generationConfig","seed"],f);const i=getValueByPath(n,["speechConfig"]);e!==void 0&&i!=null&&setValueByPath(e,["setup","generationConfig","speechConfig"],speechConfigToVertex$1(tLiveSpeechConfig(i)));const r=getValueByPath(n,["thinkingConfig"]);e!==void 0&&r!=null&&setValueByPath(e,["setup","generationConfig","thinkingConfig"],r);const d=getValueByPath(n,["enableAffectiveDialog"]);e!==void 0&&d!=null&&setValueByPath(e,["setup","generationConfig","enableAffectiveDialog"],d);const p=getValueByPath(n,["systemInstruction"]);e!==void 0&&p!=null&&setValueByPath(e,["setup","systemInstruction"],tContent(p));const _=getValueByPath(n,["tools"]);if(e!==void 0&&_!=null){let I=tTools(_);Array.isArray(I)&&(I=I.map(N=>toolToVertex$1(tTool(N)))),setValueByPath(e,["setup","tools"],I)}const y=getValueByPath(n,["sessionResumption"]);e!==void 0&&y!=null&&setValueByPath(e,["setup","sessionResumption"],y);const v=getValueByPath(n,["inputAudioTranscription"]);e!==void 0&&v!=null&&setValueByPath(e,["setup","inputAudioTranscription"],v);const T=getValueByPath(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&setValueByPath(e,["setup","outputAudioTranscription"],T);const w=getValueByPath(n,["realtimeInputConfig"]);e!==void 0&&w!=null&&setValueByPath(e,["setup","realtimeInputConfig"],w);const E=getValueByPath(n,["contextWindowCompression"]);e!==void 0&&E!=null&&setValueByPath(e,["setup","contextWindowCompression"],E);const P=getValueByPath(n,["proactivity"]);e!==void 0&&P!=null&&setValueByPath(e,["setup","proactivity"],P);const R=getValueByPath(n,["explicitVadSignal"]);return e!==void 0&&R!=null&&setValueByPath(e,["setup","explicitVadSignal"],R),t}function liveConnectParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["setup","model"],tModel(n,s));const o=getValueByPath(e,["config"]);return o!=null&&setValueByPath(t,["config"],liveConnectConfigToMldev$1(o,t)),t}function liveConnectParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["setup","model"],tModel(n,s));const o=getValueByPath(e,["config"]);return o!=null&&setValueByPath(t,["config"],liveConnectConfigToVertex(o,t)),t}function liveMusicSetConfigParametersToMldev(n){const e={},t=getValueByPath(n,["musicGenerationConfig"]);return t!=null&&setValueByPath(e,["musicGenerationConfig"],t),e}function liveMusicSetWeightedPromptsParametersToMldev(n){const e={},t=getValueByPath(n,["weightedPrompts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>o)),setValueByPath(e,["weightedPrompts"],s)}return e}function liveSendRealtimeInputParametersToMldev(n){const e={},t=getValueByPath(n,["media"]);if(t!=null){let h=tBlobs(t);Array.isArray(h)&&(h=h.map(f=>blobToMldev$2(f))),setValueByPath(e,["mediaChunks"],h)}const s=getValueByPath(n,["audio"]);s!=null&&setValueByPath(e,["audio"],blobToMldev$2(tAudioBlob(s)));const o=getValueByPath(n,["audioStreamEnd"]);o!=null&&setValueByPath(e,["audioStreamEnd"],o);const u=getValueByPath(n,["video"]);u!=null&&setValueByPath(e,["video"],blobToMldev$2(tImageBlob(u)));const l=getValueByPath(n,["text"]);l!=null&&setValueByPath(e,["text"],l);const m=getValueByPath(n,["activityStart"]);m!=null&&setValueByPath(e,["activityStart"],m);const g=getValueByPath(n,["activityEnd"]);return g!=null&&setValueByPath(e,["activityEnd"],g),e}function liveSendRealtimeInputParametersToVertex(n){const e={},t=getValueByPath(n,["media"]);if(t!=null){let h=tBlobs(t);Array.isArray(h)&&(h=h.map(f=>f)),setValueByPath(e,["mediaChunks"],h)}const s=getValueByPath(n,["audio"]);s!=null&&setValueByPath(e,["audio"],tAudioBlob(s));const o=getValueByPath(n,["audioStreamEnd"]);o!=null&&setValueByPath(e,["audioStreamEnd"],o);const u=getValueByPath(n,["video"]);u!=null&&setValueByPath(e,["video"],tImageBlob(u));const l=getValueByPath(n,["text"]);l!=null&&setValueByPath(e,["text"],l);const m=getValueByPath(n,["activityStart"]);m!=null&&setValueByPath(e,["activityStart"],m);const g=getValueByPath(n,["activityEnd"]);return g!=null&&setValueByPath(e,["activityEnd"],g),e}function liveServerMessageFromVertex(n){const e={},t=getValueByPath(n,["setupComplete"]);t!=null&&setValueByPath(e,["setupComplete"],t);const s=getValueByPath(n,["serverContent"]);s!=null&&setValueByPath(e,["serverContent"],s);const o=getValueByPath(n,["toolCall"]);o!=null&&setValueByPath(e,["toolCall"],o);const u=getValueByPath(n,["toolCallCancellation"]);u!=null&&setValueByPath(e,["toolCallCancellation"],u);const l=getValueByPath(n,["usageMetadata"]);l!=null&&setValueByPath(e,["usageMetadata"],usageMetadataFromVertex(l));const m=getValueByPath(n,["goAway"]);m!=null&&setValueByPath(e,["goAway"],m);const g=getValueByPath(n,["sessionResumptionUpdate"]);g!=null&&setValueByPath(e,["sessionResumptionUpdate"],g);const h=getValueByPath(n,["voiceActivityDetectionSignal"]);return h!=null&&setValueByPath(e,["voiceActivityDetectionSignal"],h),e}function partToMldev$2(n){const e={},t=getValueByPath(n,["mediaResolution"]);t!=null&&setValueByPath(e,["mediaResolution"],t);const s=getValueByPath(n,["codeExecutionResult"]);s!=null&&setValueByPath(e,["codeExecutionResult"],s);const o=getValueByPath(n,["executableCode"]);o!=null&&setValueByPath(e,["executableCode"],o);const u=getValueByPath(n,["fileData"]);u!=null&&setValueByPath(e,["fileData"],fileDataToMldev$2(u));const l=getValueByPath(n,["functionCall"]);l!=null&&setValueByPath(e,["functionCall"],functionCallToMldev$2(l));const m=getValueByPath(n,["functionResponse"]);m!=null&&setValueByPath(e,["functionResponse"],m);const g=getValueByPath(n,["inlineData"]);g!=null&&setValueByPath(e,["inlineData"],blobToMldev$2(g));const h=getValueByPath(n,["text"]);h!=null&&setValueByPath(e,["text"],h);const f=getValueByPath(n,["thought"]);f!=null&&setValueByPath(e,["thought"],f);const i=getValueByPath(n,["thoughtSignature"]);i!=null&&setValueByPath(e,["thoughtSignature"],i);const r=getValueByPath(n,["videoMetadata"]);return r!=null&&setValueByPath(e,["videoMetadata"],r),e}function sessionResumptionConfigToMldev$1(n){const e={},t=getValueByPath(n,["handle"]);if(t!=null&&setValueByPath(e,["handle"],t),getValueByPath(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function speechConfigToVertex$1(n){const e={},t=getValueByPath(n,["voiceConfig"]);t!=null&&setValueByPath(e,["voiceConfig"],t);const s=getValueByPath(n,["languageCode"]);if(s!=null&&setValueByPath(e,["languageCode"],s),getValueByPath(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function toolToMldev$2(n){const e={},t=getValueByPath(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(i=>i)),setValueByPath(e,["functionDeclarations"],f)}if(getValueByPath(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=getValueByPath(n,["googleSearchRetrieval"]);s!=null&&setValueByPath(e,["googleSearchRetrieval"],s);const o=getValueByPath(n,["computerUse"]);o!=null&&setValueByPath(e,["computerUse"],o);const u=getValueByPath(n,["fileSearch"]);u!=null&&setValueByPath(e,["fileSearch"],u);const l=getValueByPath(n,["codeExecution"]);if(l!=null&&setValueByPath(e,["codeExecution"],l),getValueByPath(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const m=getValueByPath(n,["googleMaps"]);m!=null&&setValueByPath(e,["googleMaps"],googleMapsToMldev$2(m));const g=getValueByPath(n,["googleSearch"]);g!=null&&setValueByPath(e,["googleSearch"],googleSearchToMldev$2(g));const h=getValueByPath(n,["urlContext"]);return h!=null&&setValueByPath(e,["urlContext"],h),e}function toolToVertex$1(n){const e={},t=getValueByPath(n,["functionDeclarations"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>functionDeclarationToVertex$1(r))),setValueByPath(e,["functionDeclarations"],i)}const s=getValueByPath(n,["retrieval"]);s!=null&&setValueByPath(e,["retrieval"],s);const o=getValueByPath(n,["googleSearchRetrieval"]);o!=null&&setValueByPath(e,["googleSearchRetrieval"],o);const u=getValueByPath(n,["computerUse"]);if(u!=null&&setValueByPath(e,["computerUse"],u),getValueByPath(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=getValueByPath(n,["codeExecution"]);l!=null&&setValueByPath(e,["codeExecution"],l);const m=getValueByPath(n,["enterpriseWebSearch"]);m!=null&&setValueByPath(e,["enterpriseWebSearch"],m);const g=getValueByPath(n,["googleMaps"]);g!=null&&setValueByPath(e,["googleMaps"],g);const h=getValueByPath(n,["googleSearch"]);h!=null&&setValueByPath(e,["googleSearch"],h);const f=getValueByPath(n,["urlContext"]);return f!=null&&setValueByPath(e,["urlContext"],f),e}function usageMetadataFromVertex(n){const e={},t=getValueByPath(n,["promptTokenCount"]);t!=null&&setValueByPath(e,["promptTokenCount"],t);const s=getValueByPath(n,["cachedContentTokenCount"]);s!=null&&setValueByPath(e,["cachedContentTokenCount"],s);const o=getValueByPath(n,["candidatesTokenCount"]);o!=null&&setValueByPath(e,["responseTokenCount"],o);const u=getValueByPath(n,["toolUsePromptTokenCount"]);u!=null&&setValueByPath(e,["toolUsePromptTokenCount"],u);const l=getValueByPath(n,["thoughtsTokenCount"]);l!=null&&setValueByPath(e,["thoughtsTokenCount"],l);const m=getValueByPath(n,["totalTokenCount"]);m!=null&&setValueByPath(e,["totalTokenCount"],m);const g=getValueByPath(n,["promptTokensDetails"]);if(g!=null){let d=g;Array.isArray(d)&&(d=d.map(p=>p)),setValueByPath(e,["promptTokensDetails"],d)}const h=getValueByPath(n,["cacheTokensDetails"]);if(h!=null){let d=h;Array.isArray(d)&&(d=d.map(p=>p)),setValueByPath(e,["cacheTokensDetails"],d)}const f=getValueByPath(n,["candidatesTokensDetails"]);if(f!=null){let d=f;Array.isArray(d)&&(d=d.map(p=>p)),setValueByPath(e,["responseTokensDetails"],d)}const i=getValueByPath(n,["toolUsePromptTokensDetails"]);if(i!=null){let d=i;Array.isArray(d)&&(d=d.map(p=>p)),setValueByPath(e,["toolUsePromptTokensDetails"],d)}const r=getValueByPath(n,["trafficType"]);return r!=null&&setValueByPath(e,["trafficType"],r),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function blobToMldev$1(n){const e={},t=getValueByPath(n,["data"]);if(t!=null&&setValueByPath(e,["data"],t),getValueByPath(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function candidateFromMldev(n){const e={},t=getValueByPath(n,["content"]);t!=null&&setValueByPath(e,["content"],t);const s=getValueByPath(n,["citationMetadata"]);s!=null&&setValueByPath(e,["citationMetadata"],citationMetadataFromMldev(s));const o=getValueByPath(n,["tokenCount"]);o!=null&&setValueByPath(e,["tokenCount"],o);const u=getValueByPath(n,["finishReason"]);u!=null&&setValueByPath(e,["finishReason"],u);const l=getValueByPath(n,["avgLogprobs"]);l!=null&&setValueByPath(e,["avgLogprobs"],l);const m=getValueByPath(n,["groundingMetadata"]);m!=null&&setValueByPath(e,["groundingMetadata"],m);const g=getValueByPath(n,["index"]);g!=null&&setValueByPath(e,["index"],g);const h=getValueByPath(n,["logprobsResult"]);h!=null&&setValueByPath(e,["logprobsResult"],h);const f=getValueByPath(n,["safetyRatings"]);if(f!=null){let r=f;Array.isArray(r)&&(r=r.map(d=>d)),setValueByPath(e,["safetyRatings"],r)}const i=getValueByPath(n,["urlContextMetadata"]);return i!=null&&setValueByPath(e,["urlContextMetadata"],i),e}function citationMetadataFromMldev(n){const e={},t=getValueByPath(n,["citationSources"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>o)),setValueByPath(e,["citations"],s)}return e}function computeTokensParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["contents"]);if(o!=null){let u=tContents(o);Array.isArray(u)&&(u=u.map(l=>l)),setValueByPath(t,["contents"],u)}return t}function computeTokensResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["tokensInfo"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),setValueByPath(e,["tokensInfo"],o)}return e}function contentEmbeddingFromVertex(n){const e={},t=getValueByPath(n,["values"]);t!=null&&setValueByPath(e,["values"],t);const s=getValueByPath(n,["statistics"]);return s!=null&&setValueByPath(e,["statistics"],contentEmbeddingStatisticsFromVertex(s)),e}function contentEmbeddingStatisticsFromVertex(n){const e={},t=getValueByPath(n,["truncated"]);t!=null&&setValueByPath(e,["truncated"],t);const s=getValueByPath(n,["token_count"]);return s!=null&&setValueByPath(e,["tokenCount"],s),e}function contentToMldev$1(n){const e={},t=getValueByPath(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>partToMldev$1(u))),setValueByPath(e,["parts"],o)}const s=getValueByPath(n,["role"]);return s!=null&&setValueByPath(e,["role"],s),e}function controlReferenceConfigToVertex(n){const e={},t=getValueByPath(n,["controlType"]);t!=null&&setValueByPath(e,["controlType"],t);const s=getValueByPath(n,["enableControlImageComputation"]);return s!=null&&setValueByPath(e,["computeControl"],s),e}function countTokensConfigToMldev(n){const e={};if(getValueByPath(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(getValueByPath(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(getValueByPath(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function countTokensConfigToVertex(n,e){const t={},s=getValueByPath(n,["systemInstruction"]);e!==void 0&&s!=null&&setValueByPath(e,["systemInstruction"],tContent(s));const o=getValueByPath(n,["tools"]);if(e!==void 0&&o!=null){let l=o;Array.isArray(l)&&(l=l.map(m=>toolToVertex(m))),setValueByPath(e,["tools"],l)}const u=getValueByPath(n,["generationConfig"]);return e!==void 0&&u!=null&&setValueByPath(e,["generationConfig"],generationConfigToVertex(u)),t}function countTokensParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["contents"]);if(o!=null){let l=tContents(o);Array.isArray(l)&&(l=l.map(m=>contentToMldev$1(m))),setValueByPath(t,["contents"],l)}const u=getValueByPath(e,["config"]);return u!=null&&countTokensConfigToMldev(u),t}function countTokensParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["contents"]);if(o!=null){let l=tContents(o);Array.isArray(l)&&(l=l.map(m=>m)),setValueByPath(t,["contents"],l)}const u=getValueByPath(e,["config"]);return u!=null&&countTokensConfigToVertex(u,t),t}function countTokensResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["totalTokens"]);s!=null&&setValueByPath(e,["totalTokens"],s);const o=getValueByPath(n,["cachedContentTokenCount"]);return o!=null&&setValueByPath(e,["cachedContentTokenCount"],o),e}function countTokensResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["totalTokens"]);return s!=null&&setValueByPath(e,["totalTokens"],s),e}function deleteModelParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);return s!=null&&setValueByPath(t,["_url","name"],tModel(n,s)),t}function deleteModelParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);return s!=null&&setValueByPath(t,["_url","name"],tModel(n,s)),t}function deleteModelResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);return t!=null&&setValueByPath(e,["sdkHttpResponse"],t),e}function deleteModelResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);return t!=null&&setValueByPath(e,["sdkHttpResponse"],t),e}function editImageConfigToVertex(n,e){const t={},s=getValueByPath(n,["outputGcsUri"]);e!==void 0&&s!=null&&setValueByPath(e,["parameters","storageUri"],s);const o=getValueByPath(n,["negativePrompt"]);e!==void 0&&o!=null&&setValueByPath(e,["parameters","negativePrompt"],o);const u=getValueByPath(n,["numberOfImages"]);e!==void 0&&u!=null&&setValueByPath(e,["parameters","sampleCount"],u);const l=getValueByPath(n,["aspectRatio"]);e!==void 0&&l!=null&&setValueByPath(e,["parameters","aspectRatio"],l);const m=getValueByPath(n,["guidanceScale"]);e!==void 0&&m!=null&&setValueByPath(e,["parameters","guidanceScale"],m);const g=getValueByPath(n,["seed"]);e!==void 0&&g!=null&&setValueByPath(e,["parameters","seed"],g);const h=getValueByPath(n,["safetyFilterLevel"]);e!==void 0&&h!=null&&setValueByPath(e,["parameters","safetySetting"],h);const f=getValueByPath(n,["personGeneration"]);e!==void 0&&f!=null&&setValueByPath(e,["parameters","personGeneration"],f);const i=getValueByPath(n,["includeSafetyAttributes"]);e!==void 0&&i!=null&&setValueByPath(e,["parameters","includeSafetyAttributes"],i);const r=getValueByPath(n,["includeRaiReason"]);e!==void 0&&r!=null&&setValueByPath(e,["parameters","includeRaiReason"],r);const d=getValueByPath(n,["language"]);e!==void 0&&d!=null&&setValueByPath(e,["parameters","language"],d);const p=getValueByPath(n,["outputMimeType"]);e!==void 0&&p!=null&&setValueByPath(e,["parameters","outputOptions","mimeType"],p);const _=getValueByPath(n,["outputCompressionQuality"]);e!==void 0&&_!=null&&setValueByPath(e,["parameters","outputOptions","compressionQuality"],_);const y=getValueByPath(n,["addWatermark"]);e!==void 0&&y!=null&&setValueByPath(e,["parameters","addWatermark"],y);const v=getValueByPath(n,["labels"]);e!==void 0&&v!=null&&setValueByPath(e,["labels"],v);const T=getValueByPath(n,["editMode"]);e!==void 0&&T!=null&&setValueByPath(e,["parameters","editMode"],T);const w=getValueByPath(n,["baseSteps"]);return e!==void 0&&w!=null&&setValueByPath(e,["parameters","editConfig","baseSteps"],w),t}function editImageParametersInternalToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["prompt"]);o!=null&&setValueByPath(t,["instances[0]","prompt"],o);const u=getValueByPath(e,["referenceImages"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(g=>referenceImageAPIInternalToVertex(g))),setValueByPath(t,["instances[0]","referenceImages"],m)}const l=getValueByPath(e,["config"]);return l!=null&&editImageConfigToVertex(l,t),t}function editImageResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["predictions"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>generatedImageFromVertex(u))),setValueByPath(e,["generatedImages"],o)}return e}function embedContentConfigToMldev(n,e){const t={},s=getValueByPath(n,["taskType"]);e!==void 0&&s!=null&&setValueByPath(e,["requests[]","taskType"],s);const o=getValueByPath(n,["title"]);e!==void 0&&o!=null&&setValueByPath(e,["requests[]","title"],o);const u=getValueByPath(n,["outputDimensionality"]);if(e!==void 0&&u!=null&&setValueByPath(e,["requests[]","outputDimensionality"],u),getValueByPath(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(getValueByPath(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function embedContentConfigToVertex(n,e){const t={},s=getValueByPath(n,["taskType"]);e!==void 0&&s!=null&&setValueByPath(e,["instances[]","task_type"],s);const o=getValueByPath(n,["title"]);e!==void 0&&o!=null&&setValueByPath(e,["instances[]","title"],o);const u=getValueByPath(n,["outputDimensionality"]);e!==void 0&&u!=null&&setValueByPath(e,["parameters","outputDimensionality"],u);const l=getValueByPath(n,["mimeType"]);e!==void 0&&l!=null&&setValueByPath(e,["instances[]","mimeType"],l);const m=getValueByPath(n,["autoTruncate"]);return e!==void 0&&m!=null&&setValueByPath(e,["parameters","autoTruncate"],m),t}function embedContentParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["contents"]);if(o!=null){let m=tContentsForEmbed(n,o);Array.isArray(m)&&(m=m.map(g=>g)),setValueByPath(t,["requests[]","content"],m)}const u=getValueByPath(e,["config"]);u!=null&&embedContentConfigToMldev(u,t);const l=getValueByPath(e,["model"]);return l!==void 0&&setValueByPath(t,["requests[]","model"],tModel(n,l)),t}function embedContentParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["contents"]);if(o!=null){let l=tContentsForEmbed(n,o);Array.isArray(l)&&(l=l.map(m=>m)),setValueByPath(t,["instances[]","content"],l)}const u=getValueByPath(e,["config"]);return u!=null&&embedContentConfigToVertex(u,t),t}function embedContentResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["embeddings"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(l=>l)),setValueByPath(e,["embeddings"],u)}const o=getValueByPath(n,["metadata"]);return o!=null&&setValueByPath(e,["metadata"],o),e}function embedContentResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["predictions[]","embeddings"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(l=>contentEmbeddingFromVertex(l))),setValueByPath(e,["embeddings"],u)}const o=getValueByPath(n,["metadata"]);return o!=null&&setValueByPath(e,["metadata"],o),e}function endpointFromVertex(n){const e={},t=getValueByPath(n,["endpoint"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["deployedModelId"]);return s!=null&&setValueByPath(e,["deployedModelId"],s),e}function fileDataToMldev$1(n){const e={};if(getValueByPath(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=getValueByPath(n,["fileUri"]);t!=null&&setValueByPath(e,["fileUri"],t);const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function functionCallToMldev$1(n){const e={},t=getValueByPath(n,["id"]);t!=null&&setValueByPath(e,["id"],t);const s=getValueByPath(n,["args"]);s!=null&&setValueByPath(e,["args"],s);const o=getValueByPath(n,["name"]);if(o!=null&&setValueByPath(e,["name"],o),getValueByPath(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(getValueByPath(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function functionCallingConfigToMldev(n){const e={},t=getValueByPath(n,["mode"]);t!=null&&setValueByPath(e,["mode"],t);const s=getValueByPath(n,["allowedFunctionNames"]);if(s!=null&&setValueByPath(e,["allowedFunctionNames"],s),getValueByPath(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function functionDeclarationToVertex(n){const e={};if(getValueByPath(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=getValueByPath(n,["description"]);t!=null&&setValueByPath(e,["description"],t);const s=getValueByPath(n,["name"]);s!=null&&setValueByPath(e,["name"],s);const o=getValueByPath(n,["parameters"]);o!=null&&setValueByPath(e,["parameters"],o);const u=getValueByPath(n,["parametersJsonSchema"]);u!=null&&setValueByPath(e,["parametersJsonSchema"],u);const l=getValueByPath(n,["response"]);l!=null&&setValueByPath(e,["response"],l);const m=getValueByPath(n,["responseJsonSchema"]);return m!=null&&setValueByPath(e,["responseJsonSchema"],m),e}function generateContentConfigToMldev(n,e,t){const s={},o=getValueByPath(e,["systemInstruction"]);t!==void 0&&o!=null&&setValueByPath(t,["systemInstruction"],contentToMldev$1(tContent(o)));const u=getValueByPath(e,["temperature"]);u!=null&&setValueByPath(s,["temperature"],u);const l=getValueByPath(e,["topP"]);l!=null&&setValueByPath(s,["topP"],l);const m=getValueByPath(e,["topK"]);m!=null&&setValueByPath(s,["topK"],m);const g=getValueByPath(e,["candidateCount"]);g!=null&&setValueByPath(s,["candidateCount"],g);const h=getValueByPath(e,["maxOutputTokens"]);h!=null&&setValueByPath(s,["maxOutputTokens"],h);const f=getValueByPath(e,["stopSequences"]);f!=null&&setValueByPath(s,["stopSequences"],f);const i=getValueByPath(e,["responseLogprobs"]);i!=null&&setValueByPath(s,["responseLogprobs"],i);const r=getValueByPath(e,["logprobs"]);r!=null&&setValueByPath(s,["logprobs"],r);const d=getValueByPath(e,["presencePenalty"]);d!=null&&setValueByPath(s,["presencePenalty"],d);const p=getValueByPath(e,["frequencyPenalty"]);p!=null&&setValueByPath(s,["frequencyPenalty"],p);const _=getValueByPath(e,["seed"]);_!=null&&setValueByPath(s,["seed"],_);const y=getValueByPath(e,["responseMimeType"]);y!=null&&setValueByPath(s,["responseMimeType"],y);const v=getValueByPath(e,["responseSchema"]);v!=null&&setValueByPath(s,["responseSchema"],tSchema(v));const T=getValueByPath(e,["responseJsonSchema"]);if(T!=null&&setValueByPath(s,["responseJsonSchema"],T),getValueByPath(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(getValueByPath(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const w=getValueByPath(e,["safetySettings"]);if(t!==void 0&&w!=null){let re=w;Array.isArray(re)&&(re=re.map(W=>safetySettingToMldev(W))),setValueByPath(t,["safetySettings"],re)}const E=getValueByPath(e,["tools"]);if(t!==void 0&&E!=null){let re=tTools(E);Array.isArray(re)&&(re=re.map(W=>toolToMldev$1(tTool(W)))),setValueByPath(t,["tools"],re)}const P=getValueByPath(e,["toolConfig"]);if(t!==void 0&&P!=null&&setValueByPath(t,["toolConfig"],toolConfigToMldev(P)),getValueByPath(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const R=getValueByPath(e,["cachedContent"]);t!==void 0&&R!=null&&setValueByPath(t,["cachedContent"],tCachedContentName(n,R));const I=getValueByPath(e,["responseModalities"]);I!=null&&setValueByPath(s,["responseModalities"],I);const N=getValueByPath(e,["mediaResolution"]);N!=null&&setValueByPath(s,["mediaResolution"],N);const B=getValueByPath(e,["speechConfig"]);if(B!=null&&setValueByPath(s,["speechConfig"],tSpeechConfig(B)),getValueByPath(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const D=getValueByPath(e,["thinkingConfig"]);D!=null&&setValueByPath(s,["thinkingConfig"],D);const Y=getValueByPath(e,["imageConfig"]);Y!=null&&setValueByPath(s,["imageConfig"],imageConfigToMldev(Y));const se=getValueByPath(e,["enableEnhancedCivicAnswers"]);return se!=null&&setValueByPath(s,["enableEnhancedCivicAnswers"],se),s}function generateContentConfigToVertex(n,e,t){const s={},o=getValueByPath(e,["systemInstruction"]);t!==void 0&&o!=null&&setValueByPath(t,["systemInstruction"],tContent(o));const u=getValueByPath(e,["temperature"]);u!=null&&setValueByPath(s,["temperature"],u);const l=getValueByPath(e,["topP"]);l!=null&&setValueByPath(s,["topP"],l);const m=getValueByPath(e,["topK"]);m!=null&&setValueByPath(s,["topK"],m);const g=getValueByPath(e,["candidateCount"]);g!=null&&setValueByPath(s,["candidateCount"],g);const h=getValueByPath(e,["maxOutputTokens"]);h!=null&&setValueByPath(s,["maxOutputTokens"],h);const f=getValueByPath(e,["stopSequences"]);f!=null&&setValueByPath(s,["stopSequences"],f);const i=getValueByPath(e,["responseLogprobs"]);i!=null&&setValueByPath(s,["responseLogprobs"],i);const r=getValueByPath(e,["logprobs"]);r!=null&&setValueByPath(s,["logprobs"],r);const d=getValueByPath(e,["presencePenalty"]);d!=null&&setValueByPath(s,["presencePenalty"],d);const p=getValueByPath(e,["frequencyPenalty"]);p!=null&&setValueByPath(s,["frequencyPenalty"],p);const _=getValueByPath(e,["seed"]);_!=null&&setValueByPath(s,["seed"],_);const y=getValueByPath(e,["responseMimeType"]);y!=null&&setValueByPath(s,["responseMimeType"],y);const v=getValueByPath(e,["responseSchema"]);v!=null&&setValueByPath(s,["responseSchema"],tSchema(v));const T=getValueByPath(e,["responseJsonSchema"]);T!=null&&setValueByPath(s,["responseJsonSchema"],T);const w=getValueByPath(e,["routingConfig"]);w!=null&&setValueByPath(s,["routingConfig"],w);const E=getValueByPath(e,["modelSelectionConfig"]);E!=null&&setValueByPath(s,["modelConfig"],E);const P=getValueByPath(e,["safetySettings"]);if(t!==void 0&&P!=null){let k=P;Array.isArray(k)&&(k=k.map(H=>H)),setValueByPath(t,["safetySettings"],k)}const R=getValueByPath(e,["tools"]);if(t!==void 0&&R!=null){let k=tTools(R);Array.isArray(k)&&(k=k.map(H=>toolToVertex(tTool(H)))),setValueByPath(t,["tools"],k)}const I=getValueByPath(e,["toolConfig"]);t!==void 0&&I!=null&&setValueByPath(t,["toolConfig"],I);const N=getValueByPath(e,["labels"]);t!==void 0&&N!=null&&setValueByPath(t,["labels"],N);const B=getValueByPath(e,["cachedContent"]);t!==void 0&&B!=null&&setValueByPath(t,["cachedContent"],tCachedContentName(n,B));const D=getValueByPath(e,["responseModalities"]);D!=null&&setValueByPath(s,["responseModalities"],D);const Y=getValueByPath(e,["mediaResolution"]);Y!=null&&setValueByPath(s,["mediaResolution"],Y);const se=getValueByPath(e,["speechConfig"]);se!=null&&setValueByPath(s,["speechConfig"],speechConfigToVertex(tSpeechConfig(se)));const re=getValueByPath(e,["audioTimestamp"]);re!=null&&setValueByPath(s,["audioTimestamp"],re);const W=getValueByPath(e,["thinkingConfig"]);W!=null&&setValueByPath(s,["thinkingConfig"],W);const $=getValueByPath(e,["imageConfig"]);if($!=null&&setValueByPath(s,["imageConfig"],imageConfigToVertex($)),getValueByPath(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return s}function generateContentParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["contents"]);if(o!=null){let l=tContents(o);Array.isArray(l)&&(l=l.map(m=>contentToMldev$1(m))),setValueByPath(t,["contents"],l)}const u=getValueByPath(e,["config"]);return u!=null&&setValueByPath(t,["generationConfig"],generateContentConfigToMldev(n,u,t)),t}function generateContentParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["contents"]);if(o!=null){let l=tContents(o);Array.isArray(l)&&(l=l.map(m=>m)),setValueByPath(t,["contents"],l)}const u=getValueByPath(e,["config"]);return u!=null&&setValueByPath(t,["generationConfig"],generateContentConfigToVertex(n,u,t)),t}function generateContentResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["candidates"]);if(s!=null){let g=s;Array.isArray(g)&&(g=g.map(h=>candidateFromMldev(h))),setValueByPath(e,["candidates"],g)}const o=getValueByPath(n,["modelVersion"]);o!=null&&setValueByPath(e,["modelVersion"],o);const u=getValueByPath(n,["promptFeedback"]);u!=null&&setValueByPath(e,["promptFeedback"],u);const l=getValueByPath(n,["responseId"]);l!=null&&setValueByPath(e,["responseId"],l);const m=getValueByPath(n,["usageMetadata"]);return m!=null&&setValueByPath(e,["usageMetadata"],m),e}function generateContentResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["candidates"]);if(s!=null){let h=s;Array.isArray(h)&&(h=h.map(f=>f)),setValueByPath(e,["candidates"],h)}const o=getValueByPath(n,["createTime"]);o!=null&&setValueByPath(e,["createTime"],o);const u=getValueByPath(n,["modelVersion"]);u!=null&&setValueByPath(e,["modelVersion"],u);const l=getValueByPath(n,["promptFeedback"]);l!=null&&setValueByPath(e,["promptFeedback"],l);const m=getValueByPath(n,["responseId"]);m!=null&&setValueByPath(e,["responseId"],m);const g=getValueByPath(n,["usageMetadata"]);return g!=null&&setValueByPath(e,["usageMetadata"],g),e}function generateImagesConfigToMldev(n,e){const t={};if(getValueByPath(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(getValueByPath(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=getValueByPath(n,["numberOfImages"]);e!==void 0&&s!=null&&setValueByPath(e,["parameters","sampleCount"],s);const o=getValueByPath(n,["aspectRatio"]);e!==void 0&&o!=null&&setValueByPath(e,["parameters","aspectRatio"],o);const u=getValueByPath(n,["guidanceScale"]);if(e!==void 0&&u!=null&&setValueByPath(e,["parameters","guidanceScale"],u),getValueByPath(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=getValueByPath(n,["safetyFilterLevel"]);e!==void 0&&l!=null&&setValueByPath(e,["parameters","safetySetting"],l);const m=getValueByPath(n,["personGeneration"]);e!==void 0&&m!=null&&setValueByPath(e,["parameters","personGeneration"],m);const g=getValueByPath(n,["includeSafetyAttributes"]);e!==void 0&&g!=null&&setValueByPath(e,["parameters","includeSafetyAttributes"],g);const h=getValueByPath(n,["includeRaiReason"]);e!==void 0&&h!=null&&setValueByPath(e,["parameters","includeRaiReason"],h);const f=getValueByPath(n,["language"]);e!==void 0&&f!=null&&setValueByPath(e,["parameters","language"],f);const i=getValueByPath(n,["outputMimeType"]);e!==void 0&&i!=null&&setValueByPath(e,["parameters","outputOptions","mimeType"],i);const r=getValueByPath(n,["outputCompressionQuality"]);if(e!==void 0&&r!=null&&setValueByPath(e,["parameters","outputOptions","compressionQuality"],r),getValueByPath(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(getValueByPath(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const d=getValueByPath(n,["imageSize"]);if(e!==void 0&&d!=null&&setValueByPath(e,["parameters","sampleImageSize"],d),getValueByPath(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function generateImagesConfigToVertex(n,e){const t={},s=getValueByPath(n,["outputGcsUri"]);e!==void 0&&s!=null&&setValueByPath(e,["parameters","storageUri"],s);const o=getValueByPath(n,["negativePrompt"]);e!==void 0&&o!=null&&setValueByPath(e,["parameters","negativePrompt"],o);const u=getValueByPath(n,["numberOfImages"]);e!==void 0&&u!=null&&setValueByPath(e,["parameters","sampleCount"],u);const l=getValueByPath(n,["aspectRatio"]);e!==void 0&&l!=null&&setValueByPath(e,["parameters","aspectRatio"],l);const m=getValueByPath(n,["guidanceScale"]);e!==void 0&&m!=null&&setValueByPath(e,["parameters","guidanceScale"],m);const g=getValueByPath(n,["seed"]);e!==void 0&&g!=null&&setValueByPath(e,["parameters","seed"],g);const h=getValueByPath(n,["safetyFilterLevel"]);e!==void 0&&h!=null&&setValueByPath(e,["parameters","safetySetting"],h);const f=getValueByPath(n,["personGeneration"]);e!==void 0&&f!=null&&setValueByPath(e,["parameters","personGeneration"],f);const i=getValueByPath(n,["includeSafetyAttributes"]);e!==void 0&&i!=null&&setValueByPath(e,["parameters","includeSafetyAttributes"],i);const r=getValueByPath(n,["includeRaiReason"]);e!==void 0&&r!=null&&setValueByPath(e,["parameters","includeRaiReason"],r);const d=getValueByPath(n,["language"]);e!==void 0&&d!=null&&setValueByPath(e,["parameters","language"],d);const p=getValueByPath(n,["outputMimeType"]);e!==void 0&&p!=null&&setValueByPath(e,["parameters","outputOptions","mimeType"],p);const _=getValueByPath(n,["outputCompressionQuality"]);e!==void 0&&_!=null&&setValueByPath(e,["parameters","outputOptions","compressionQuality"],_);const y=getValueByPath(n,["addWatermark"]);e!==void 0&&y!=null&&setValueByPath(e,["parameters","addWatermark"],y);const v=getValueByPath(n,["labels"]);e!==void 0&&v!=null&&setValueByPath(e,["labels"],v);const T=getValueByPath(n,["imageSize"]);e!==void 0&&T!=null&&setValueByPath(e,["parameters","sampleImageSize"],T);const w=getValueByPath(n,["enhancePrompt"]);return e!==void 0&&w!=null&&setValueByPath(e,["parameters","enhancePrompt"],w),t}function generateImagesParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["prompt"]);o!=null&&setValueByPath(t,["instances[0]","prompt"],o);const u=getValueByPath(e,["config"]);return u!=null&&generateImagesConfigToMldev(u,t),t}function generateImagesParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["prompt"]);o!=null&&setValueByPath(t,["instances[0]","prompt"],o);const u=getValueByPath(e,["config"]);return u!=null&&generateImagesConfigToVertex(u,t),t}function generateImagesResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["predictions"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(l=>generatedImageFromMldev(l))),setValueByPath(e,["generatedImages"],u)}const o=getValueByPath(n,["positivePromptSafetyAttributes"]);return o!=null&&setValueByPath(e,["positivePromptSafetyAttributes"],safetyAttributesFromMldev(o)),e}function generateImagesResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["predictions"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(l=>generatedImageFromVertex(l))),setValueByPath(e,["generatedImages"],u)}const o=getValueByPath(n,["positivePromptSafetyAttributes"]);return o!=null&&setValueByPath(e,["positivePromptSafetyAttributes"],safetyAttributesFromVertex(o)),e}function generateVideosConfigToMldev(n,e){const t={},s=getValueByPath(n,["numberOfVideos"]);if(e!==void 0&&s!=null&&setValueByPath(e,["parameters","sampleCount"],s),getValueByPath(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(getValueByPath(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=getValueByPath(n,["durationSeconds"]);if(e!==void 0&&o!=null&&setValueByPath(e,["parameters","durationSeconds"],o),getValueByPath(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=getValueByPath(n,["aspectRatio"]);e!==void 0&&u!=null&&setValueByPath(e,["parameters","aspectRatio"],u);const l=getValueByPath(n,["resolution"]);e!==void 0&&l!=null&&setValueByPath(e,["parameters","resolution"],l);const m=getValueByPath(n,["personGeneration"]);if(e!==void 0&&m!=null&&setValueByPath(e,["parameters","personGeneration"],m),getValueByPath(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const g=getValueByPath(n,["negativePrompt"]);e!==void 0&&g!=null&&setValueByPath(e,["parameters","negativePrompt"],g);const h=getValueByPath(n,["enhancePrompt"]);if(e!==void 0&&h!=null&&setValueByPath(e,["parameters","enhancePrompt"],h),getValueByPath(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const f=getValueByPath(n,["lastFrame"]);e!==void 0&&f!=null&&setValueByPath(e,["instances[0]","lastFrame"],imageToMldev(f));const i=getValueByPath(n,["referenceImages"]);if(e!==void 0&&i!=null){let r=i;Array.isArray(r)&&(r=r.map(d=>videoGenerationReferenceImageToMldev(d))),setValueByPath(e,["instances[0]","referenceImages"],r)}if(getValueByPath(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(getValueByPath(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function generateVideosConfigToVertex(n,e){const t={},s=getValueByPath(n,["numberOfVideos"]);e!==void 0&&s!=null&&setValueByPath(e,["parameters","sampleCount"],s);const o=getValueByPath(n,["outputGcsUri"]);e!==void 0&&o!=null&&setValueByPath(e,["parameters","storageUri"],o);const u=getValueByPath(n,["fps"]);e!==void 0&&u!=null&&setValueByPath(e,["parameters","fps"],u);const l=getValueByPath(n,["durationSeconds"]);e!==void 0&&l!=null&&setValueByPath(e,["parameters","durationSeconds"],l);const m=getValueByPath(n,["seed"]);e!==void 0&&m!=null&&setValueByPath(e,["parameters","seed"],m);const g=getValueByPath(n,["aspectRatio"]);e!==void 0&&g!=null&&setValueByPath(e,["parameters","aspectRatio"],g);const h=getValueByPath(n,["resolution"]);e!==void 0&&h!=null&&setValueByPath(e,["parameters","resolution"],h);const f=getValueByPath(n,["personGeneration"]);e!==void 0&&f!=null&&setValueByPath(e,["parameters","personGeneration"],f);const i=getValueByPath(n,["pubsubTopic"]);e!==void 0&&i!=null&&setValueByPath(e,["parameters","pubsubTopic"],i);const r=getValueByPath(n,["negativePrompt"]);e!==void 0&&r!=null&&setValueByPath(e,["parameters","negativePrompt"],r);const d=getValueByPath(n,["enhancePrompt"]);e!==void 0&&d!=null&&setValueByPath(e,["parameters","enhancePrompt"],d);const p=getValueByPath(n,["generateAudio"]);e!==void 0&&p!=null&&setValueByPath(e,["parameters","generateAudio"],p);const _=getValueByPath(n,["lastFrame"]);e!==void 0&&_!=null&&setValueByPath(e,["instances[0]","lastFrame"],imageToVertex(_));const y=getValueByPath(n,["referenceImages"]);if(e!==void 0&&y!=null){let w=y;Array.isArray(w)&&(w=w.map(E=>videoGenerationReferenceImageToVertex(E))),setValueByPath(e,["instances[0]","referenceImages"],w)}const v=getValueByPath(n,["mask"]);e!==void 0&&v!=null&&setValueByPath(e,["instances[0]","mask"],videoGenerationMaskToVertex(v));const T=getValueByPath(n,["compressionQuality"]);return e!==void 0&&T!=null&&setValueByPath(e,["parameters","compressionQuality"],T),t}function generateVideosOperationFromMldev(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["metadata"]);s!=null&&setValueByPath(e,["metadata"],s);const o=getValueByPath(n,["done"]);o!=null&&setValueByPath(e,["done"],o);const u=getValueByPath(n,["error"]);u!=null&&setValueByPath(e,["error"],u);const l=getValueByPath(n,["response","generateVideoResponse"]);return l!=null&&setValueByPath(e,["response"],generateVideosResponseFromMldev(l)),e}function generateVideosOperationFromVertex(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["metadata"]);s!=null&&setValueByPath(e,["metadata"],s);const o=getValueByPath(n,["done"]);o!=null&&setValueByPath(e,["done"],o);const u=getValueByPath(n,["error"]);u!=null&&setValueByPath(e,["error"],u);const l=getValueByPath(n,["response"]);return l!=null&&setValueByPath(e,["response"],generateVideosResponseFromVertex(l)),e}function generateVideosParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["prompt"]);o!=null&&setValueByPath(t,["instances[0]","prompt"],o);const u=getValueByPath(e,["image"]);u!=null&&setValueByPath(t,["instances[0]","image"],imageToMldev(u));const l=getValueByPath(e,["video"]);l!=null&&setValueByPath(t,["instances[0]","video"],videoToMldev(l));const m=getValueByPath(e,["source"]);m!=null&&generateVideosSourceToMldev(m,t);const g=getValueByPath(e,["config"]);return g!=null&&generateVideosConfigToMldev(g,t),t}function generateVideosParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["prompt"]);o!=null&&setValueByPath(t,["instances[0]","prompt"],o);const u=getValueByPath(e,["image"]);u!=null&&setValueByPath(t,["instances[0]","image"],imageToVertex(u));const l=getValueByPath(e,["video"]);l!=null&&setValueByPath(t,["instances[0]","video"],videoToVertex(l));const m=getValueByPath(e,["source"]);m!=null&&generateVideosSourceToVertex(m,t);const g=getValueByPath(e,["config"]);return g!=null&&generateVideosConfigToVertex(g,t),t}function generateVideosResponseFromMldev(n){const e={},t=getValueByPath(n,["generatedSamples"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(l=>generatedVideoFromMldev(l))),setValueByPath(e,["generatedVideos"],u)}const s=getValueByPath(n,["raiMediaFilteredCount"]);s!=null&&setValueByPath(e,["raiMediaFilteredCount"],s);const o=getValueByPath(n,["raiMediaFilteredReasons"]);return o!=null&&setValueByPath(e,["raiMediaFilteredReasons"],o),e}function generateVideosResponseFromVertex(n){const e={},t=getValueByPath(n,["videos"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(l=>generatedVideoFromVertex(l))),setValueByPath(e,["generatedVideos"],u)}const s=getValueByPath(n,["raiMediaFilteredCount"]);s!=null&&setValueByPath(e,["raiMediaFilteredCount"],s);const o=getValueByPath(n,["raiMediaFilteredReasons"]);return o!=null&&setValueByPath(e,["raiMediaFilteredReasons"],o),e}function generateVideosSourceToMldev(n,e){const t={},s=getValueByPath(n,["prompt"]);e!==void 0&&s!=null&&setValueByPath(e,["instances[0]","prompt"],s);const o=getValueByPath(n,["image"]);e!==void 0&&o!=null&&setValueByPath(e,["instances[0]","image"],imageToMldev(o));const u=getValueByPath(n,["video"]);return e!==void 0&&u!=null&&setValueByPath(e,["instances[0]","video"],videoToMldev(u)),t}function generateVideosSourceToVertex(n,e){const t={},s=getValueByPath(n,["prompt"]);e!==void 0&&s!=null&&setValueByPath(e,["instances[0]","prompt"],s);const o=getValueByPath(n,["image"]);e!==void 0&&o!=null&&setValueByPath(e,["instances[0]","image"],imageToVertex(o));const u=getValueByPath(n,["video"]);return e!==void 0&&u!=null&&setValueByPath(e,["instances[0]","video"],videoToVertex(u)),t}function generatedImageFromMldev(n){const e={},t=getValueByPath(n,["_self"]);t!=null&&setValueByPath(e,["image"],imageFromMldev(t));const s=getValueByPath(n,["raiFilteredReason"]);s!=null&&setValueByPath(e,["raiFilteredReason"],s);const o=getValueByPath(n,["_self"]);return o!=null&&setValueByPath(e,["safetyAttributes"],safetyAttributesFromMldev(o)),e}function generatedImageFromVertex(n){const e={},t=getValueByPath(n,["_self"]);t!=null&&setValueByPath(e,["image"],imageFromVertex(t));const s=getValueByPath(n,["raiFilteredReason"]);s!=null&&setValueByPath(e,["raiFilteredReason"],s);const o=getValueByPath(n,["_self"]);o!=null&&setValueByPath(e,["safetyAttributes"],safetyAttributesFromVertex(o));const u=getValueByPath(n,["prompt"]);return u!=null&&setValueByPath(e,["enhancedPrompt"],u),e}function generatedImageMaskFromVertex(n){const e={},t=getValueByPath(n,["_self"]);t!=null&&setValueByPath(e,["mask"],imageFromVertex(t));const s=getValueByPath(n,["labels"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),setValueByPath(e,["labels"],o)}return e}function generatedVideoFromMldev(n){const e={},t=getValueByPath(n,["video"]);return t!=null&&setValueByPath(e,["video"],videoFromMldev(t)),e}function generatedVideoFromVertex(n){const e={},t=getValueByPath(n,["_self"]);return t!=null&&setValueByPath(e,["video"],videoFromVertex(t)),e}function generationConfigToVertex(n){const e={},t=getValueByPath(n,["modelSelectionConfig"]);t!=null&&setValueByPath(e,["modelConfig"],t);const s=getValueByPath(n,["responseJsonSchema"]);s!=null&&setValueByPath(e,["responseJsonSchema"],s);const o=getValueByPath(n,["audioTimestamp"]);o!=null&&setValueByPath(e,["audioTimestamp"],o);const u=getValueByPath(n,["candidateCount"]);u!=null&&setValueByPath(e,["candidateCount"],u);const l=getValueByPath(n,["enableAffectiveDialog"]);l!=null&&setValueByPath(e,["enableAffectiveDialog"],l);const m=getValueByPath(n,["frequencyPenalty"]);m!=null&&setValueByPath(e,["frequencyPenalty"],m);const g=getValueByPath(n,["logprobs"]);g!=null&&setValueByPath(e,["logprobs"],g);const h=getValueByPath(n,["maxOutputTokens"]);h!=null&&setValueByPath(e,["maxOutputTokens"],h);const f=getValueByPath(n,["mediaResolution"]);f!=null&&setValueByPath(e,["mediaResolution"],f);const i=getValueByPath(n,["presencePenalty"]);i!=null&&setValueByPath(e,["presencePenalty"],i);const r=getValueByPath(n,["responseLogprobs"]);r!=null&&setValueByPath(e,["responseLogprobs"],r);const d=getValueByPath(n,["responseMimeType"]);d!=null&&setValueByPath(e,["responseMimeType"],d);const p=getValueByPath(n,["responseModalities"]);p!=null&&setValueByPath(e,["responseModalities"],p);const _=getValueByPath(n,["responseSchema"]);_!=null&&setValueByPath(e,["responseSchema"],_);const y=getValueByPath(n,["routingConfig"]);y!=null&&setValueByPath(e,["routingConfig"],y);const v=getValueByPath(n,["seed"]);v!=null&&setValueByPath(e,["seed"],v);const T=getValueByPath(n,["speechConfig"]);T!=null&&setValueByPath(e,["speechConfig"],speechConfigToVertex(T));const w=getValueByPath(n,["stopSequences"]);w!=null&&setValueByPath(e,["stopSequences"],w);const E=getValueByPath(n,["temperature"]);E!=null&&setValueByPath(e,["temperature"],E);const P=getValueByPath(n,["thinkingConfig"]);P!=null&&setValueByPath(e,["thinkingConfig"],P);const R=getValueByPath(n,["topK"]);R!=null&&setValueByPath(e,["topK"],R);const I=getValueByPath(n,["topP"]);if(I!=null&&setValueByPath(e,["topP"],I),getValueByPath(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function getModelParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);return s!=null&&setValueByPath(t,["_url","name"],tModel(n,s)),t}function getModelParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);return s!=null&&setValueByPath(t,["_url","name"],tModel(n,s)),t}function googleMapsToMldev$1(n){const e={};if(getValueByPath(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=getValueByPath(n,["enableWidget"]);return t!=null&&setValueByPath(e,["enableWidget"],t),e}function googleSearchToMldev$1(n){const e={};if(getValueByPath(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(getValueByPath(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=getValueByPath(n,["timeRangeFilter"]);return t!=null&&setValueByPath(e,["timeRangeFilter"],t),e}function imageConfigToMldev(n){const e={},t=getValueByPath(n,["aspectRatio"]);t!=null&&setValueByPath(e,["aspectRatio"],t);const s=getValueByPath(n,["imageSize"]);if(s!=null&&setValueByPath(e,["imageSize"],s),getValueByPath(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(getValueByPath(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function imageConfigToVertex(n){const e={},t=getValueByPath(n,["aspectRatio"]);t!=null&&setValueByPath(e,["aspectRatio"],t);const s=getValueByPath(n,["imageSize"]);s!=null&&setValueByPath(e,["imageSize"],s);const o=getValueByPath(n,["outputMimeType"]);o!=null&&setValueByPath(e,["imageOutputOptions","mimeType"],o);const u=getValueByPath(n,["outputCompressionQuality"]);return u!=null&&setValueByPath(e,["imageOutputOptions","compressionQuality"],u),e}function imageFromMldev(n){const e={},t=getValueByPath(n,["bytesBase64Encoded"]);t!=null&&setValueByPath(e,["imageBytes"],tBytes(t));const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function imageFromVertex(n){const e={},t=getValueByPath(n,["gcsUri"]);t!=null&&setValueByPath(e,["gcsUri"],t);const s=getValueByPath(n,["bytesBase64Encoded"]);s!=null&&setValueByPath(e,["imageBytes"],tBytes(s));const o=getValueByPath(n,["mimeType"]);return o!=null&&setValueByPath(e,["mimeType"],o),e}function imageToMldev(n){const e={};if(getValueByPath(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=getValueByPath(n,["imageBytes"]);t!=null&&setValueByPath(e,["bytesBase64Encoded"],tBytes(t));const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function imageToVertex(n){const e={},t=getValueByPath(n,["gcsUri"]);t!=null&&setValueByPath(e,["gcsUri"],t);const s=getValueByPath(n,["imageBytes"]);s!=null&&setValueByPath(e,["bytesBase64Encoded"],tBytes(s));const o=getValueByPath(n,["mimeType"]);return o!=null&&setValueByPath(e,["mimeType"],o),e}function listModelsConfigToMldev(n,e,t){const s={},o=getValueByPath(e,["pageSize"]);t!==void 0&&o!=null&&setValueByPath(t,["_query","pageSize"],o);const u=getValueByPath(e,["pageToken"]);t!==void 0&&u!=null&&setValueByPath(t,["_query","pageToken"],u);const l=getValueByPath(e,["filter"]);t!==void 0&&l!=null&&setValueByPath(t,["_query","filter"],l);const m=getValueByPath(e,["queryBase"]);return t!==void 0&&m!=null&&setValueByPath(t,["_url","models_url"],tModelsUrl(n,m)),s}function listModelsConfigToVertex(n,e,t){const s={},o=getValueByPath(e,["pageSize"]);t!==void 0&&o!=null&&setValueByPath(t,["_query","pageSize"],o);const u=getValueByPath(e,["pageToken"]);t!==void 0&&u!=null&&setValueByPath(t,["_query","pageToken"],u);const l=getValueByPath(e,["filter"]);t!==void 0&&l!=null&&setValueByPath(t,["_query","filter"],l);const m=getValueByPath(e,["queryBase"]);return t!==void 0&&m!=null&&setValueByPath(t,["_url","models_url"],tModelsUrl(n,m)),s}function listModelsParametersToMldev(n,e){const t={},s=getValueByPath(e,["config"]);return s!=null&&listModelsConfigToMldev(n,s,t),t}function listModelsParametersToVertex(n,e){const t={},s=getValueByPath(e,["config"]);return s!=null&&listModelsConfigToVertex(n,s,t),t}function listModelsResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["nextPageToken"]);s!=null&&setValueByPath(e,["nextPageToken"],s);const o=getValueByPath(n,["_self"]);if(o!=null){let u=tExtractModels(o);Array.isArray(u)&&(u=u.map(l=>modelFromMldev(l))),setValueByPath(e,["models"],u)}return e}function listModelsResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["nextPageToken"]);s!=null&&setValueByPath(e,["nextPageToken"],s);const o=getValueByPath(n,["_self"]);if(o!=null){let u=tExtractModels(o);Array.isArray(u)&&(u=u.map(l=>modelFromVertex(l))),setValueByPath(e,["models"],u)}return e}function maskReferenceConfigToVertex(n){const e={},t=getValueByPath(n,["maskMode"]);t!=null&&setValueByPath(e,["maskMode"],t);const s=getValueByPath(n,["segmentationClasses"]);s!=null&&setValueByPath(e,["maskClasses"],s);const o=getValueByPath(n,["maskDilation"]);return o!=null&&setValueByPath(e,["dilation"],o),e}function modelFromMldev(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["displayName"]);s!=null&&setValueByPath(e,["displayName"],s);const o=getValueByPath(n,["description"]);o!=null&&setValueByPath(e,["description"],o);const u=getValueByPath(n,["version"]);u!=null&&setValueByPath(e,["version"],u);const l=getValueByPath(n,["_self"]);l!=null&&setValueByPath(e,["tunedModelInfo"],tunedModelInfoFromMldev(l));const m=getValueByPath(n,["inputTokenLimit"]);m!=null&&setValueByPath(e,["inputTokenLimit"],m);const g=getValueByPath(n,["outputTokenLimit"]);g!=null&&setValueByPath(e,["outputTokenLimit"],g);const h=getValueByPath(n,["supportedGenerationMethods"]);h!=null&&setValueByPath(e,["supportedActions"],h);const f=getValueByPath(n,["temperature"]);f!=null&&setValueByPath(e,["temperature"],f);const i=getValueByPath(n,["maxTemperature"]);i!=null&&setValueByPath(e,["maxTemperature"],i);const r=getValueByPath(n,["topP"]);r!=null&&setValueByPath(e,["topP"],r);const d=getValueByPath(n,["topK"]);d!=null&&setValueByPath(e,["topK"],d);const p=getValueByPath(n,["thinking"]);return p!=null&&setValueByPath(e,["thinking"],p),e}function modelFromVertex(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["displayName"]);s!=null&&setValueByPath(e,["displayName"],s);const o=getValueByPath(n,["description"]);o!=null&&setValueByPath(e,["description"],o);const u=getValueByPath(n,["versionId"]);u!=null&&setValueByPath(e,["version"],u);const l=getValueByPath(n,["deployedModels"]);if(l!=null){let i=l;Array.isArray(i)&&(i=i.map(r=>endpointFromVertex(r))),setValueByPath(e,["endpoints"],i)}const m=getValueByPath(n,["labels"]);m!=null&&setValueByPath(e,["labels"],m);const g=getValueByPath(n,["_self"]);g!=null&&setValueByPath(e,["tunedModelInfo"],tunedModelInfoFromVertex(g));const h=getValueByPath(n,["defaultCheckpointId"]);h!=null&&setValueByPath(e,["defaultCheckpointId"],h);const f=getValueByPath(n,["checkpoints"]);if(f!=null){let i=f;Array.isArray(i)&&(i=i.map(r=>r)),setValueByPath(e,["checkpoints"],i)}return e}function partToMldev$1(n){const e={},t=getValueByPath(n,["mediaResolution"]);t!=null&&setValueByPath(e,["mediaResolution"],t);const s=getValueByPath(n,["codeExecutionResult"]);s!=null&&setValueByPath(e,["codeExecutionResult"],s);const o=getValueByPath(n,["executableCode"]);o!=null&&setValueByPath(e,["executableCode"],o);const u=getValueByPath(n,["fileData"]);u!=null&&setValueByPath(e,["fileData"],fileDataToMldev$1(u));const l=getValueByPath(n,["functionCall"]);l!=null&&setValueByPath(e,["functionCall"],functionCallToMldev$1(l));const m=getValueByPath(n,["functionResponse"]);m!=null&&setValueByPath(e,["functionResponse"],m);const g=getValueByPath(n,["inlineData"]);g!=null&&setValueByPath(e,["inlineData"],blobToMldev$1(g));const h=getValueByPath(n,["text"]);h!=null&&setValueByPath(e,["text"],h);const f=getValueByPath(n,["thought"]);f!=null&&setValueByPath(e,["thought"],f);const i=getValueByPath(n,["thoughtSignature"]);i!=null&&setValueByPath(e,["thoughtSignature"],i);const r=getValueByPath(n,["videoMetadata"]);return r!=null&&setValueByPath(e,["videoMetadata"],r),e}function productImageToVertex(n){const e={},t=getValueByPath(n,["productImage"]);return t!=null&&setValueByPath(e,["image"],imageToVertex(t)),e}function recontextImageConfigToVertex(n,e){const t={},s=getValueByPath(n,["numberOfImages"]);e!==void 0&&s!=null&&setValueByPath(e,["parameters","sampleCount"],s);const o=getValueByPath(n,["baseSteps"]);e!==void 0&&o!=null&&setValueByPath(e,["parameters","baseSteps"],o);const u=getValueByPath(n,["outputGcsUri"]);e!==void 0&&u!=null&&setValueByPath(e,["parameters","storageUri"],u);const l=getValueByPath(n,["seed"]);e!==void 0&&l!=null&&setValueByPath(e,["parameters","seed"],l);const m=getValueByPath(n,["safetyFilterLevel"]);e!==void 0&&m!=null&&setValueByPath(e,["parameters","safetySetting"],m);const g=getValueByPath(n,["personGeneration"]);e!==void 0&&g!=null&&setValueByPath(e,["parameters","personGeneration"],g);const h=getValueByPath(n,["addWatermark"]);e!==void 0&&h!=null&&setValueByPath(e,["parameters","addWatermark"],h);const f=getValueByPath(n,["outputMimeType"]);e!==void 0&&f!=null&&setValueByPath(e,["parameters","outputOptions","mimeType"],f);const i=getValueByPath(n,["outputCompressionQuality"]);e!==void 0&&i!=null&&setValueByPath(e,["parameters","outputOptions","compressionQuality"],i);const r=getValueByPath(n,["enhancePrompt"]);e!==void 0&&r!=null&&setValueByPath(e,["parameters","enhancePrompt"],r);const d=getValueByPath(n,["labels"]);return e!==void 0&&d!=null&&setValueByPath(e,["labels"],d),t}function recontextImageParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["source"]);o!=null&&recontextImageSourceToVertex(o,t);const u=getValueByPath(e,["config"]);return u!=null&&recontextImageConfigToVertex(u,t),t}function recontextImageResponseFromVertex(n){const e={},t=getValueByPath(n,["predictions"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>generatedImageFromVertex(o))),setValueByPath(e,["generatedImages"],s)}return e}function recontextImageSourceToVertex(n,e){const t={},s=getValueByPath(n,["prompt"]);e!==void 0&&s!=null&&setValueByPath(e,["instances[0]","prompt"],s);const o=getValueByPath(n,["personImage"]);e!==void 0&&o!=null&&setValueByPath(e,["instances[0]","personImage","image"],imageToVertex(o));const u=getValueByPath(n,["productImages"]);if(e!==void 0&&u!=null){let l=u;Array.isArray(l)&&(l=l.map(m=>productImageToVertex(m))),setValueByPath(e,["instances[0]","productImages"],l)}return t}function referenceImageAPIInternalToVertex(n){const e={},t=getValueByPath(n,["referenceImage"]);t!=null&&setValueByPath(e,["referenceImage"],imageToVertex(t));const s=getValueByPath(n,["referenceId"]);s!=null&&setValueByPath(e,["referenceId"],s);const o=getValueByPath(n,["referenceType"]);o!=null&&setValueByPath(e,["referenceType"],o);const u=getValueByPath(n,["maskImageConfig"]);u!=null&&setValueByPath(e,["maskImageConfig"],maskReferenceConfigToVertex(u));const l=getValueByPath(n,["controlImageConfig"]);l!=null&&setValueByPath(e,["controlImageConfig"],controlReferenceConfigToVertex(l));const m=getValueByPath(n,["styleImageConfig"]);m!=null&&setValueByPath(e,["styleImageConfig"],m);const g=getValueByPath(n,["subjectImageConfig"]);return g!=null&&setValueByPath(e,["subjectImageConfig"],g),e}function safetyAttributesFromMldev(n){const e={},t=getValueByPath(n,["safetyAttributes","categories"]);t!=null&&setValueByPath(e,["categories"],t);const s=getValueByPath(n,["safetyAttributes","scores"]);s!=null&&setValueByPath(e,["scores"],s);const o=getValueByPath(n,["contentType"]);return o!=null&&setValueByPath(e,["contentType"],o),e}function safetyAttributesFromVertex(n){const e={},t=getValueByPath(n,["safetyAttributes","categories"]);t!=null&&setValueByPath(e,["categories"],t);const s=getValueByPath(n,["safetyAttributes","scores"]);s!=null&&setValueByPath(e,["scores"],s);const o=getValueByPath(n,["contentType"]);return o!=null&&setValueByPath(e,["contentType"],o),e}function safetySettingToMldev(n){const e={},t=getValueByPath(n,["category"]);if(t!=null&&setValueByPath(e,["category"],t),getValueByPath(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=getValueByPath(n,["threshold"]);return s!=null&&setValueByPath(e,["threshold"],s),e}function scribbleImageToVertex(n){const e={},t=getValueByPath(n,["image"]);return t!=null&&setValueByPath(e,["image"],imageToVertex(t)),e}function segmentImageConfigToVertex(n,e){const t={},s=getValueByPath(n,["mode"]);e!==void 0&&s!=null&&setValueByPath(e,["parameters","mode"],s);const o=getValueByPath(n,["maxPredictions"]);e!==void 0&&o!=null&&setValueByPath(e,["parameters","maxPredictions"],o);const u=getValueByPath(n,["confidenceThreshold"]);e!==void 0&&u!=null&&setValueByPath(e,["parameters","confidenceThreshold"],u);const l=getValueByPath(n,["maskDilation"]);e!==void 0&&l!=null&&setValueByPath(e,["parameters","maskDilation"],l);const m=getValueByPath(n,["binaryColorThreshold"]);e!==void 0&&m!=null&&setValueByPath(e,["parameters","binaryColorThreshold"],m);const g=getValueByPath(n,["labels"]);return e!==void 0&&g!=null&&setValueByPath(e,["labels"],g),t}function segmentImageParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["source"]);o!=null&&segmentImageSourceToVertex(o,t);const u=getValueByPath(e,["config"]);return u!=null&&segmentImageConfigToVertex(u,t),t}function segmentImageResponseFromVertex(n){const e={},t=getValueByPath(n,["predictions"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>generatedImageMaskFromVertex(o))),setValueByPath(e,["generatedMasks"],s)}return e}function segmentImageSourceToVertex(n,e){const t={},s=getValueByPath(n,["prompt"]);e!==void 0&&s!=null&&setValueByPath(e,["instances[0]","prompt"],s);const o=getValueByPath(n,["image"]);e!==void 0&&o!=null&&setValueByPath(e,["instances[0]","image"],imageToVertex(o));const u=getValueByPath(n,["scribbleImage"]);return e!==void 0&&u!=null&&setValueByPath(e,["instances[0]","scribble"],scribbleImageToVertex(u)),t}function speechConfigToVertex(n){const e={},t=getValueByPath(n,["voiceConfig"]);t!=null&&setValueByPath(e,["voiceConfig"],t);const s=getValueByPath(n,["languageCode"]);if(s!=null&&setValueByPath(e,["languageCode"],s),getValueByPath(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function toolConfigToMldev(n){const e={},t=getValueByPath(n,["functionCallingConfig"]);t!=null&&setValueByPath(e,["functionCallingConfig"],functionCallingConfigToMldev(t));const s=getValueByPath(n,["retrievalConfig"]);return s!=null&&setValueByPath(e,["retrievalConfig"],s),e}function toolToMldev$1(n){const e={},t=getValueByPath(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(i=>i)),setValueByPath(e,["functionDeclarations"],f)}if(getValueByPath(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=getValueByPath(n,["googleSearchRetrieval"]);s!=null&&setValueByPath(e,["googleSearchRetrieval"],s);const o=getValueByPath(n,["computerUse"]);o!=null&&setValueByPath(e,["computerUse"],o);const u=getValueByPath(n,["fileSearch"]);u!=null&&setValueByPath(e,["fileSearch"],u);const l=getValueByPath(n,["codeExecution"]);if(l!=null&&setValueByPath(e,["codeExecution"],l),getValueByPath(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const m=getValueByPath(n,["googleMaps"]);m!=null&&setValueByPath(e,["googleMaps"],googleMapsToMldev$1(m));const g=getValueByPath(n,["googleSearch"]);g!=null&&setValueByPath(e,["googleSearch"],googleSearchToMldev$1(g));const h=getValueByPath(n,["urlContext"]);return h!=null&&setValueByPath(e,["urlContext"],h),e}function toolToVertex(n){const e={},t=getValueByPath(n,["functionDeclarations"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>functionDeclarationToVertex(r))),setValueByPath(e,["functionDeclarations"],i)}const s=getValueByPath(n,["retrieval"]);s!=null&&setValueByPath(e,["retrieval"],s);const o=getValueByPath(n,["googleSearchRetrieval"]);o!=null&&setValueByPath(e,["googleSearchRetrieval"],o);const u=getValueByPath(n,["computerUse"]);if(u!=null&&setValueByPath(e,["computerUse"],u),getValueByPath(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=getValueByPath(n,["codeExecution"]);l!=null&&setValueByPath(e,["codeExecution"],l);const m=getValueByPath(n,["enterpriseWebSearch"]);m!=null&&setValueByPath(e,["enterpriseWebSearch"],m);const g=getValueByPath(n,["googleMaps"]);g!=null&&setValueByPath(e,["googleMaps"],g);const h=getValueByPath(n,["googleSearch"]);h!=null&&setValueByPath(e,["googleSearch"],h);const f=getValueByPath(n,["urlContext"]);return f!=null&&setValueByPath(e,["urlContext"],f),e}function tunedModelInfoFromMldev(n){const e={},t=getValueByPath(n,["baseModel"]);t!=null&&setValueByPath(e,["baseModel"],t);const s=getValueByPath(n,["createTime"]);s!=null&&setValueByPath(e,["createTime"],s);const o=getValueByPath(n,["updateTime"]);return o!=null&&setValueByPath(e,["updateTime"],o),e}function tunedModelInfoFromVertex(n){const e={},t=getValueByPath(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&setValueByPath(e,["baseModel"],t);const s=getValueByPath(n,["createTime"]);s!=null&&setValueByPath(e,["createTime"],s);const o=getValueByPath(n,["updateTime"]);return o!=null&&setValueByPath(e,["updateTime"],o),e}function updateModelConfigToMldev(n,e){const t={},s=getValueByPath(n,["displayName"]);e!==void 0&&s!=null&&setValueByPath(e,["displayName"],s);const o=getValueByPath(n,["description"]);e!==void 0&&o!=null&&setValueByPath(e,["description"],o);const u=getValueByPath(n,["defaultCheckpointId"]);return e!==void 0&&u!=null&&setValueByPath(e,["defaultCheckpointId"],u),t}function updateModelConfigToVertex(n,e){const t={},s=getValueByPath(n,["displayName"]);e!==void 0&&s!=null&&setValueByPath(e,["displayName"],s);const o=getValueByPath(n,["description"]);e!==void 0&&o!=null&&setValueByPath(e,["description"],o);const u=getValueByPath(n,["defaultCheckpointId"]);return e!==void 0&&u!=null&&setValueByPath(e,["defaultCheckpointId"],u),t}function updateModelParametersToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","name"],tModel(n,s));const o=getValueByPath(e,["config"]);return o!=null&&updateModelConfigToMldev(o,t),t}function updateModelParametersToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["config"]);return o!=null&&updateModelConfigToVertex(o,t),t}function upscaleImageAPIConfigInternalToVertex(n,e){const t={},s=getValueByPath(n,["outputGcsUri"]);e!==void 0&&s!=null&&setValueByPath(e,["parameters","storageUri"],s);const o=getValueByPath(n,["safetyFilterLevel"]);e!==void 0&&o!=null&&setValueByPath(e,["parameters","safetySetting"],o);const u=getValueByPath(n,["personGeneration"]);e!==void 0&&u!=null&&setValueByPath(e,["parameters","personGeneration"],u);const l=getValueByPath(n,["includeRaiReason"]);e!==void 0&&l!=null&&setValueByPath(e,["parameters","includeRaiReason"],l);const m=getValueByPath(n,["outputMimeType"]);e!==void 0&&m!=null&&setValueByPath(e,["parameters","outputOptions","mimeType"],m);const g=getValueByPath(n,["outputCompressionQuality"]);e!==void 0&&g!=null&&setValueByPath(e,["parameters","outputOptions","compressionQuality"],g);const h=getValueByPath(n,["enhanceInputImage"]);e!==void 0&&h!=null&&setValueByPath(e,["parameters","upscaleConfig","enhanceInputImage"],h);const f=getValueByPath(n,["imagePreservationFactor"]);e!==void 0&&f!=null&&setValueByPath(e,["parameters","upscaleConfig","imagePreservationFactor"],f);const i=getValueByPath(n,["labels"]);e!==void 0&&i!=null&&setValueByPath(e,["labels"],i);const r=getValueByPath(n,["numberOfImages"]);e!==void 0&&r!=null&&setValueByPath(e,["parameters","sampleCount"],r);const d=getValueByPath(n,["mode"]);return e!==void 0&&d!=null&&setValueByPath(e,["parameters","mode"],d),t}function upscaleImageAPIParametersInternalToVertex(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["_url","model"],tModel(n,s));const o=getValueByPath(e,["image"]);o!=null&&setValueByPath(t,["instances[0]","image"],imageToVertex(o));const u=getValueByPath(e,["upscaleFactor"]);u!=null&&setValueByPath(t,["parameters","upscaleConfig","upscaleFactor"],u);const l=getValueByPath(e,["config"]);return l!=null&&upscaleImageAPIConfigInternalToVertex(l,t),t}function upscaleImageResponseFromVertex(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["predictions"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>generatedImageFromVertex(u))),setValueByPath(e,["generatedImages"],o)}return e}function videoFromMldev(n){const e={},t=getValueByPath(n,["uri"]);t!=null&&setValueByPath(e,["uri"],t);const s=getValueByPath(n,["encodedVideo"]);s!=null&&setValueByPath(e,["videoBytes"],tBytes(s));const o=getValueByPath(n,["encoding"]);return o!=null&&setValueByPath(e,["mimeType"],o),e}function videoFromVertex(n){const e={},t=getValueByPath(n,["gcsUri"]);t!=null&&setValueByPath(e,["uri"],t);const s=getValueByPath(n,["bytesBase64Encoded"]);s!=null&&setValueByPath(e,["videoBytes"],tBytes(s));const o=getValueByPath(n,["mimeType"]);return o!=null&&setValueByPath(e,["mimeType"],o),e}function videoGenerationMaskToVertex(n){const e={},t=getValueByPath(n,["image"]);t!=null&&setValueByPath(e,["_self"],imageToVertex(t));const s=getValueByPath(n,["maskMode"]);return s!=null&&setValueByPath(e,["maskMode"],s),e}function videoGenerationReferenceImageToMldev(n){const e={},t=getValueByPath(n,["image"]);t!=null&&setValueByPath(e,["image"],imageToMldev(t));const s=getValueByPath(n,["referenceType"]);return s!=null&&setValueByPath(e,["referenceType"],s),e}function videoGenerationReferenceImageToVertex(n){const e={},t=getValueByPath(n,["image"]);t!=null&&setValueByPath(e,["image"],imageToVertex(t));const s=getValueByPath(n,["referenceType"]);return s!=null&&setValueByPath(e,["referenceType"],s),e}function videoToMldev(n){const e={},t=getValueByPath(n,["uri"]);t!=null&&setValueByPath(e,["uri"],t);const s=getValueByPath(n,["videoBytes"]);s!=null&&setValueByPath(e,["encodedVideo"],tBytes(s));const o=getValueByPath(n,["mimeType"]);return o!=null&&setValueByPath(e,["encoding"],o),e}function videoToVertex(n){const e={},t=getValueByPath(n,["uri"]);t!=null&&setValueByPath(e,["gcsUri"],t);const s=getValueByPath(n,["videoBytes"]);s!=null&&setValueByPath(e,["bytesBase64Encoded"],tBytes(s));const o=getValueByPath(n,["mimeType"]);return o!=null&&setValueByPath(e,["mimeType"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function createFileSearchStoreConfigToMldev(n,e){const t={},s=getValueByPath(n,["displayName"]);return e!==void 0&&s!=null&&setValueByPath(e,["displayName"],s),t}function createFileSearchStoreParametersToMldev(n){const e={},t=getValueByPath(n,["config"]);return t!=null&&createFileSearchStoreConfigToMldev(t,e),e}function deleteFileSearchStoreConfigToMldev(n,e){const t={},s=getValueByPath(n,["force"]);return e!==void 0&&s!=null&&setValueByPath(e,["_query","force"],s),t}function deleteFileSearchStoreParametersToMldev(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["_url","name"],t);const s=getValueByPath(n,["config"]);return s!=null&&deleteFileSearchStoreConfigToMldev(s,e),e}function getFileSearchStoreParametersToMldev(n){const e={},t=getValueByPath(n,["name"]);return t!=null&&setValueByPath(e,["_url","name"],t),e}function importFileConfigToMldev(n,e){const t={},s=getValueByPath(n,["customMetadata"]);if(e!==void 0&&s!=null){let u=s;Array.isArray(u)&&(u=u.map(l=>l)),setValueByPath(e,["customMetadata"],u)}const o=getValueByPath(n,["chunkingConfig"]);return e!==void 0&&o!=null&&setValueByPath(e,["chunkingConfig"],o),t}function importFileOperationFromMldev(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["name"],t);const s=getValueByPath(n,["metadata"]);s!=null&&setValueByPath(e,["metadata"],s);const o=getValueByPath(n,["done"]);o!=null&&setValueByPath(e,["done"],o);const u=getValueByPath(n,["error"]);u!=null&&setValueByPath(e,["error"],u);const l=getValueByPath(n,["response"]);return l!=null&&setValueByPath(e,["response"],importFileResponseFromMldev(l)),e}function importFileParametersToMldev(n){const e={},t=getValueByPath(n,["fileSearchStoreName"]);t!=null&&setValueByPath(e,["_url","file_search_store_name"],t);const s=getValueByPath(n,["fileName"]);s!=null&&setValueByPath(e,["fileName"],s);const o=getValueByPath(n,["config"]);return o!=null&&importFileConfigToMldev(o,e),e}function importFileResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["parent"]);s!=null&&setValueByPath(e,["parent"],s);const o=getValueByPath(n,["documentName"]);return o!=null&&setValueByPath(e,["documentName"],o),e}function listFileSearchStoresConfigToMldev(n,e){const t={},s=getValueByPath(n,["pageSize"]);e!==void 0&&s!=null&&setValueByPath(e,["_query","pageSize"],s);const o=getValueByPath(n,["pageToken"]);return e!==void 0&&o!=null&&setValueByPath(e,["_query","pageToken"],o),t}function listFileSearchStoresParametersToMldev(n){const e={},t=getValueByPath(n,["config"]);return t!=null&&listFileSearchStoresConfigToMldev(t,e),e}function listFileSearchStoresResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["nextPageToken"]);s!=null&&setValueByPath(e,["nextPageToken"],s);const o=getValueByPath(n,["fileSearchStores"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(l=>l)),setValueByPath(e,["fileSearchStores"],u)}return e}function uploadToFileSearchStoreConfigToMldev(n,e){const t={},s=getValueByPath(n,["mimeType"]);e!==void 0&&s!=null&&setValueByPath(e,["mimeType"],s);const o=getValueByPath(n,["displayName"]);e!==void 0&&o!=null&&setValueByPath(e,["displayName"],o);const u=getValueByPath(n,["customMetadata"]);if(e!==void 0&&u!=null){let m=u;Array.isArray(m)&&(m=m.map(g=>g)),setValueByPath(e,["customMetadata"],m)}const l=getValueByPath(n,["chunkingConfig"]);return e!==void 0&&l!=null&&setValueByPath(e,["chunkingConfig"],l),t}function uploadToFileSearchStoreParametersToMldev(n){const e={},t=getValueByPath(n,["fileSearchStoreName"]);t!=null&&setValueByPath(e,["_url","file_search_store_name"],t);const s=getValueByPath(n,["config"]);return s!=null&&uploadToFileSearchStoreConfigToMldev(s,e),e}function uploadToFileSearchStoreResumableResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);return t!=null&&setValueByPath(e,["sdkHttpResponse"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const CONTENT_TYPE_HEADER="Content-Type",SERVER_TIMEOUT_HEADER="X-Server-Timeout",USER_AGENT_HEADER="User-Agent",GOOGLE_API_CLIENT_HEADER="x-goog-api-client",SDK_VERSION="1.33.0",LIBRARY_LABEL=`google-genai-sdk/${SDK_VERSION}`,VERTEX_AI_API_DEFAULT_VERSION="v1beta1",GOOGLE_AI_API_DEFAULT_VERSION="v1beta";class ApiClient{constructor(e){var t,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const o={};this.clientOptions.vertexai?(o.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:VERTEX_AI_API_DEFAULT_VERSION,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:GOOGLE_AI_API_DEFAULT_VERSION,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,s){const o=[this.getRequestUrlInternal(t)];return s&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,s);if(e.queryParams)for(const[l,m]of Object.entries(e.queryParams))o.searchParams.append(l,String(m));let u={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else u.body=e.body;return u=await this.includeExtraHttpOptionsToRequestInit(u,t,o.toString(),e.abortSignal),this.unaryApiCall(o,u,e.httpMethod)}patchHttpOptions(e,t){const s=JSON.parse(JSON.stringify(e));for(const[o,u]of Object.entries(t))typeof u=="object"?s[o]=Object.assign(Object.assign({},s[o]),u):u!==void 0&&(s[o]=u);return s}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,s);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let u={};return u.body=e.body,u=await this.includeExtraHttpOptionsToRequestInit(u,t,o.toString(),e.abortSignal),this.streamApiCall(o,u,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,s,o){if(t&&t.timeout||o){const u=new AbortController,l=u.signal;if(t.timeout&&t?.timeout>0){const m=setTimeout(()=>u.abort(),t.timeout);m&&typeof m.unref=="function"&&m.unref()}o&&o.addEventListener("abort",()=>{u.abort()}),e.signal=l}return t&&t.extraBody!==null&&includeExtraBodyToRequestInit(e,t.extraBody),e.headers=await this.getHeadersInternal(t,s),e}async unaryApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async o=>(await throwErrorIfNotOK(o),new HttpResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async o=>(await throwErrorIfNotOK(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){return __asyncGenerator(this,arguments,function*(){var s;const o=(s=e?.body)===null||s===void 0?void 0:s.getReader(),u=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let l="";const m="data:",g=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:h,value:f}=yield __await(o.read());if(h){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const i=u.decode(f,{stream:!0});try{const p=JSON.parse(i);if("error"in p){const _=JSON.parse(JSON.stringify(p.error)),y=_.status,v=_.code,T=`got status: ${y}. ${JSON.stringify(p)}`;if(v>=400&&v<600)throw new ApiError({message:T,status:v})}}catch(p){if(p.name==="ApiError")throw p}l+=i;let r=-1,d=0;for(;;){r=-1,d=0;for(const y of g){const v=l.indexOf(y);v!==-1&&(r===-1||v<r)&&(r=v,d=y.length)}if(r===-1)break;const p=l.substring(0,r);l=l.substring(r+d);const _=p.trim();if(_.startsWith(m)){const y=_.substring(m.length).trim();try{const v=new Response(y,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield __await(new HttpResponse(v))}catch(v){throw new Error(`exception parsing stream chunk ${y}. ${v}`)}}}}}finally{o.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},t=LIBRARY_LABEL+" "+this.clientOptions.userAgentExtra;return e[USER_AGENT_HEADER]=t,e[GOOGLE_API_CLIENT_HEADER]=t,e[CONTENT_TYPE_HEADER]="application/json",e}async getHeadersInternal(e,t){const s=new Headers;if(e&&e.headers){for(const[o,u]of Object.entries(e.headers))s.append(o,u);e.timeout&&e.timeout>0&&s.append(SERVER_TIMEOUT_HEADER,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(s,t),s}getFileName(e){var t;let s="";return typeof e=="string"&&(s=e.replace(/[/\\]+$/,""),s=(t=s.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),s}async uploadFile(e,t){var s;const o={};t!=null&&(o.mimeType=t.mimeType,o.name=t.name,o.displayName=t.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);const u=this.clientOptions.uploader,l=await u.stat(e);o.sizeBytes=String(l.size);const m=(s=t?.mimeType)!==null&&s!==void 0?s:l.type;if(m===void 0||m==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=m;const g={file:o},h=this.getFileName(e),f=formatMap("upload/v1beta/files",g._url),i=await this.fetchUploadUrl(f,o.sizeBytes,o.mimeType,h,g,t?.httpOptions);return u.upload(e,i,this)}async uploadFileToFileSearchStore(e,t,s){var o;const u=this.clientOptions.uploader,l=await u.stat(t),m=String(l.size),g=(o=s?.mimeType)!==null&&o!==void 0?o:l.type;if(g===void 0||g==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const h=`upload/v1beta/${e}:uploadToFileSearchStore`,f=this.getFileName(t),i={};s!=null&&uploadToFileSearchStoreConfigToMldev(s,i);const r=await this.fetchUploadUrl(h,m,g,f,i,s?.httpOptions);return u.uploadToFileSearchStore(t,r,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,s,o,u,l){var m;let g={};l?g=l:g={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${s}`},o?{"X-Goog-Upload-File-Name":o}:{})};const h=await this.request({path:e,body:JSON.stringify(u),httpMethod:"POST",httpOptions:g});if(!h||!h?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const f=(m=h?.headers)===null||m===void 0?void 0:m["x-goog-upload-url"];if(f===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return f}}async function throwErrorIfNotOK(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let s;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await n.json():s={error:{message:await n.text(),code:n.status,status:n.statusText}};const o=JSON.stringify(s);throw t>=400&&t<600?new ApiError({message:o,status:t}):new Error(o)}}function includeExtraBodyToRequestInit(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const u=JSON.parse(n.body);if(typeof u=="object"&&u!==null&&!Array.isArray(u))t=u;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(u,l){const m=Object.assign({},u);for(const g in l)if(Object.prototype.hasOwnProperty.call(l,g)){const h=l[g],f=m[g];h&&typeof h=="object"&&!Array.isArray(h)&&f&&typeof f=="object"&&!Array.isArray(f)?m[g]=s(f,h):(f&&h&&typeof f!=typeof h&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${g}". Original type: ${typeof f}, New type: ${typeof h}. Overwriting.`),m[g]=h)}return m}const o=s(t,e);n.body=JSON.stringify(o)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const MCP_LABEL="mcp_used/unknown";let hasMcpToolUsageFromMcpToTool=!1;function hasMcpToolUsage(n){for(const e of n)if(isMcpCallableTool(e)||typeof e=="object"&&"inputSchema"in e)return!0;return hasMcpToolUsageFromMcpToTool}function setMcpUsageHeader(n){var e;const t=(e=n[GOOGLE_API_CLIENT_HEADER])!==null&&e!==void 0?e:"";n[GOOGLE_API_CLIENT_HEADER]=(t+` ${MCP_LABEL}`).trimStart()}function isMcpCallableTool(n){return n!==null&&typeof n=="object"&&n instanceof McpCallableTool}function listAllTools(n){return __asyncGenerator(this,arguments,function*(t,s=100){let o,u=0;for(;u<s;){const l=yield __await(t.listTools({cursor:o}));for(const m of l.tools)yield yield __await(m),u++;if(!l.nextCursor)break;o=l.nextCursor}})}class McpCallableTool{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new McpCallableTool(e,t)}async initialize(){var e,t,s,o;if(this.mcpTools.length>0)return;const u={},l=[];for(const f of this.mcpClients)try{for(var m=!0,g=(t=void 0,__asyncValues(listAllTools(f))),h;h=await g.next(),e=h.done,!e;m=!0){o=h.value,m=!1;const i=o;l.push(i);const r=i.name;if(u[r])throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);u[r]=f}}catch(i){t={error:i}}finally{try{!m&&!e&&(s=g.return)&&await s.call(g)}finally{if(t)throw t.error}}this.mcpTools=l,this.functionNameToMcpClient=u}async tool(){return await this.initialize(),mcpToolsToGeminiTool(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const o=this.functionNameToMcpClient[s.name];let u;this.config.timeout&&(u={timeout:this.config.timeout});const l=await o.callTool({name:s.name,arguments:s.args},void 0,u);t.push({functionResponse:{name:s.name,response:l.isError?{error:l}:l}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function handleWebSocketMessage$1(n,e,t){const s=new LiveMusicServerMessage;let o;t.data instanceof Blob?o=JSON.parse(await t.data.text()):o=JSON.parse(t.data),Object.assign(s,o),e(s)}class LiveMusic{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s}async connect(e){var t,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const o=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion(),l=mapToHeaders$1(this.apiClient.getDefaultHeaders()),m=this.apiClient.getApiKey(),g=`${o}/ws/google.ai.generativelanguage.${u}.GenerativeService.BidiGenerateMusic?key=${m}`;let h=()=>{};const f=new Promise(w=>{h=w}),i=e.callbacks,r=function(){h({})},d=this.apiClient,p={onopen:r,onmessage:w=>{handleWebSocketMessage$1(d,i.onmessage,w)},onerror:(t=i?.onerror)!==null&&t!==void 0?t:function(w){},onclose:(s=i?.onclose)!==null&&s!==void 0?s:function(w){}},_=this.webSocketFactory.create(g,headersToMap$1(l),p);_.connect(),await f;const T={setup:{model:tModel(this.apiClient,e.model)}};return _.send(JSON.stringify(T)),new LiveMusicSession(_,this.apiClient)}}class LiveMusicSession{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=liveMusicSetWeightedPromptsParametersToMldev(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=liveMusicSetConfigParametersToMldev(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(LiveMusicPlaybackControl.PLAY)}pause(){this.sendPlaybackControl(LiveMusicPlaybackControl.PAUSE)}stop(){this.sendPlaybackControl(LiveMusicPlaybackControl.STOP)}resetContext(){this.sendPlaybackControl(LiveMusicPlaybackControl.RESET_CONTEXT)}close(){this.conn.close()}}function headersToMap$1(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function mapToHeaders$1(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const FUNCTION_RESPONSE_REQUIRES_ID="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function handleWebSocketMessage(n,e,t){const s=new LiveServerMessage;let o;t.data instanceof Blob?o=await t.data.text():t.data instanceof ArrayBuffer?o=new TextDecoder().decode(t.data):o=t.data;const u=JSON.parse(o);if(n.isVertexAI()){const l=liveServerMessageFromVertex(u);Object.assign(s,l)}else Object.assign(s,u);e(s)}class Live{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s,this.music=new LiveMusic(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,s,o,u,l,m;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const g=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion();let f;const i=this.apiClient.getHeaders();e.config&&e.config.tools&&hasMcpToolUsage(e.config.tools)&&setMcpUsageHeader(i);const r=mapToHeaders(i);if(this.apiClient.isVertexAI())f=`${g}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(r,f);else{const B=this.apiClient.getApiKey();let D="BidiGenerateContent",Y="key";B?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),h!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),D="BidiGenerateContentConstrained",Y="access_token"),f=`${g}/ws/google.ai.generativelanguage.${h}.GenerativeService.${D}?${Y}=${B}`}let d=()=>{};const p=new Promise(B=>{d=B}),_=e.callbacks,y=function(){var B;(B=_?.onopen)===null||B===void 0||B.call(_),d({})},v=this.apiClient,T={onopen:y,onmessage:B=>{handleWebSocketMessage(v,_.onmessage,B)},onerror:(t=_?.onerror)!==null&&t!==void 0?t:function(B){},onclose:(s=_?.onclose)!==null&&s!==void 0?s:function(B){}},w=this.webSocketFactory.create(f,headersToMap(r),T);w.connect(),await p;let E=tModel(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&E.startsWith("publishers/")){const B=this.apiClient.getProject(),D=this.apiClient.getLocation();E=`projects/${B}/locations/${D}/`+E}let P={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Modality.AUDIO]}:e.config.responseModalities=[Modality.AUDIO]),!((u=e.config)===null||u===void 0)&&u.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const R=(m=(l=e.config)===null||l===void 0?void 0:l.tools)!==null&&m!==void 0?m:[],I=[];for(const B of R)if(this.isCallableTool(B)){const D=B;I.push(await D.tool())}else I.push(B);I.length>0&&(e.config.tools=I);const N={model:E,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?P=liveConnectParametersToVertex(this.apiClient,N):P=liveConnectParametersToMldev(this.apiClient,N),delete P.config,w.send(JSON.stringify(P)),new Session(w,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const defaultLiveSendClientContentParamerters={turnComplete:!0};class Session{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let s=[];try{s=tContents(t.turns),e.isVertexAI()||(s=s.map(o=>contentToMldev$1(o)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:s,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let s=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?s=t.functionResponses:s=[t.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const u of s){if(typeof u!="object"||u===null||!("name"in u)||!("response"in u))throw new Error(`Could not parse function response, type '${typeof u}'.`);if(!e.isVertexAI()&&!("id"in u))throw new Error(FUNCTION_RESPONSE_REQUIRES_ID)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},defaultLiveSendClientContentParamerters),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:liveSendRealtimeInputParametersToVertex(e)}:t={realtimeInput:liveSendRealtimeInputParametersToMldev(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function headersToMap(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function mapToHeaders(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const DEFAULT_MAX_REMOTE_CALLS=10;function shouldDisableAfc(n){var e,t,s;if(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(const l of(t=n?.tools)!==null&&t!==void 0?t:[])if(isCallableTool(l)){o=!0;break}if(!o)return!0;const u=(s=n?.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return u&&(u<0||!Number.isInteger(u))||u==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",u),!0):!1}function isCallableTool(n){return"callTool"in n&&typeof n.callTool=="function"}function hasCallableTools(n){var e,t,s;return(s=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(o=>isCallableTool(o)))!==null&&s!==void 0?s:!1}function findAfcIncompatibleToolIndexes(n){var e;const t=[];return!((e=n?.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((s,o)=>{if(isCallableTool(s))return;const u=s;u.functionDeclarations&&u.functionDeclarations.length>0&&t.push(o)}),t}function shouldAppendAfcHistory(n){var e;return!(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Models extends BaseModule{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var s,o,u,l,m;const g=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!hasCallableTools(t)||shouldDisableAfc(t.config))return await this.generateContentInternal(g);const h=findAfcIncompatibleToolIndexes(t);if(h.length>0){const _=h.map(y=>`tools[${y}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${_}.`)}let f,i;const r=tContents(g.contents),d=(u=(o=(s=g.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&u!==void 0?u:DEFAULT_MAX_REMOTE_CALLS;let p=0;for(;p<d&&(f=await this.generateContentInternal(g),!(!f.functionCalls||f.functionCalls.length===0));){const _=f.candidates[0].content,y=[];for(const v of(m=(l=t.config)===null||l===void 0?void 0:l.tools)!==null&&m!==void 0?m:[])if(isCallableTool(v)){const w=await v.callTool(f.functionCalls);y.push(...w)}p++,i={role:"user",parts:y},g.contents=tContents(g.contents),g.contents.push(_),g.contents.push(i),shouldAppendAfcHistory(g.config)&&(r.push(_),r.push(i))}return shouldAppendAfcHistory(g.config)&&(f.automaticFunctionCallingHistory=r),f},this.generateContentStream=async t=>{var s,o,u,l,m;if(this.maybeMoveToResponseJsonSchem(t),shouldDisableAfc(t.config)){const i=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(i)}const g=findAfcIncompatibleToolIndexes(t);if(g.length>0){const i=g.map(r=>`tools[${r}]`).join(", ");throw new Error(`Incompatible tools found at ${i}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const h=(u=(o=(s=t?.config)===null||s===void 0?void 0:s.toolConfig)===null||o===void 0?void 0:o.functionCallingConfig)===null||u===void 0?void 0:u.streamFunctionCallArguments,f=(m=(l=t?.config)===null||l===void 0?void 0:l.automaticFunctionCalling)===null||m===void 0?void 0:m.disable;if(h&&!f)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(s=>{var o;let u;const l=[];if(s?.generatedImages)for(const g of s.generatedImages)g&&g?.safetyAttributes&&((o=g?.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?u=g?.safetyAttributes:l.push(g);let m;return u?m={generatedImages:l,positivePromptSafetyAttributes:u,sdkHttpResponse:s.sdkHttpResponse}:m={generatedImages:l,sdkHttpResponse:s.sdkHttpResponse},m}),this.list=async t=>{var s;const l={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((s=l.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new Pager(PagedItem.PAGED_ITEM_MODELS,m=>this.listInternal(m),await this.listInternal(l),l)},this.editImage=async t=>{const s={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(s.referenceImages=t.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async t=>{let s={numberOfImages:1,mode:"upscale"};t.config&&(s=Object.assign(Object.assign({},s),t.config));const o={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:s};return await this.upscaleImageInternal(o)},this.generateVideos=async t=>{var s,o,u,l,m,g;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((s=t.video)===null||s===void 0)&&s.uri&&(!((o=t.video)===null||o===void 0)&&o.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((l=(u=t.source)===null||u===void 0?void 0:u.video)===null||l===void 0)&&l.uri&&(!((g=(m=t.source)===null||m===void 0?void 0:m.video)===null||g===void 0)&&g.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,s,o;const u=(t=e.config)===null||t===void 0?void 0:t.tools;if(!u)return e;const l=await Promise.all(u.map(async g=>isCallableTool(g)?await g.tool():g)),m={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:l})};if(m.config.tools=l,e.config&&e.config.tools&&hasMcpToolUsage(e.config.tools)){const g=(o=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&o!==void 0?o:{};let h=Object.assign({},g);Object.keys(h).length===0&&(h=this.apiClient.getDefaultHeaders()),setMcpUsageHeader(h),m.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:h})}return m}async initAfcToolsMap(e){var t,s,o;const u=new Map;for(const l of(s=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&s!==void 0?s:[])if(isCallableTool(l)){const m=l,g=await m.tool();for(const h of(o=g.functionDeclarations)!==null&&o!==void 0?o:[]){if(!h.name)throw new Error("Function declaration name is required.");if(u.has(h.name))throw new Error(`Duplicate tool declaration name: ${h.name}`);u.set(h.name,m)}}return u}async processAfcStream(e){var t,s,o;const u=(o=(s=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&o!==void 0?o:DEFAULT_MAX_REMOTE_CALLS;let l=!1,m=0;const g=await this.initAfcToolsMap(e);return(function(h,f,i){return __asyncGenerator(this,arguments,function*(){for(var r,d,p,_,y,v;m<u;){l&&(m++,l=!1);const P=yield __await(h.processParamsMaybeAddMcpUsage(i)),R=yield __await(h.generateContentStreamInternal(P)),I=[],N=[];try{for(var T=!0,w=(d=void 0,__asyncValues(R)),E;E=yield __await(w.next()),r=E.done,!r;T=!0){_=E.value,T=!1;const B=_;if(yield yield __await(B),B.candidates&&(!((y=B.candidates[0])===null||y===void 0)&&y.content)){N.push(B.candidates[0].content);for(const D of(v=B.candidates[0].content.parts)!==null&&v!==void 0?v:[])if(m<u&&D.functionCall){if(!D.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(D.functionCall.name)){const Y=yield __await(f.get(D.functionCall.name).callTool([D.functionCall]));I.push(...Y)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${D.functionCall.name}`)}}}}catch(B){d={error:B}}finally{try{!T&&!r&&(p=w.return)&&(yield __await(p.call(w)))}finally{if(d)throw d.error}}if(I.length>0){l=!0;const B=new GenerateContentResponse;B.candidates=[{content:{role:"user",parts:I}}],yield yield __await(B);const D=[];D.push(...N),D.push({role:"user",parts:I});const Y=tContents(i.contents).concat(D);i.contents=Y}else break}})})(this,g,e)}async generateContentInternal(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=generateContentParametersToVertex(this.apiClient,e);return m=formatMap("{model}:generateContent",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=generateContentResponseFromVertex(f),r=new GenerateContentResponse;return Object.assign(r,i),r})}else{const h=generateContentParametersToMldev(this.apiClient,e);return m=formatMap("{model}:generateContent",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=generateContentResponseFromMldev(f),r=new GenerateContentResponse;return Object.assign(r,i),r})}}async generateContentStreamInternal(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=generateContentParametersToVertex(this.apiClient,e);return m=formatMap("{model}:streamGenerateContent?alt=sse",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.requestStream({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),l.then(function(i){return __asyncGenerator(this,arguments,function*(){var r,d,p,_;try{for(var y=!0,v=__asyncValues(i),T;T=yield __await(v.next()),r=T.done,!r;y=!0){_=T.value,y=!1;const w=_,E=generateContentResponseFromVertex(yield __await(w.json()));E.sdkHttpResponse={headers:w.headers};const P=new GenerateContentResponse;Object.assign(P,E),yield yield __await(P)}}catch(w){d={error:w}}finally{try{!y&&!r&&(p=v.return)&&(yield __await(p.call(v)))}finally{if(d)throw d.error}}})})}else{const h=generateContentParametersToMldev(this.apiClient,e);return m=formatMap("{model}:streamGenerateContent?alt=sse",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.requestStream({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}),l.then(function(i){return __asyncGenerator(this,arguments,function*(){var r,d,p,_;try{for(var y=!0,v=__asyncValues(i),T;T=yield __await(v.next()),r=T.done,!r;y=!0){_=T.value,y=!1;const w=_,E=generateContentResponseFromMldev(yield __await(w.json()));E.sdkHttpResponse={headers:w.headers};const P=new GenerateContentResponse;Object.assign(P,E),yield yield __await(P)}}catch(w){d={error:w}}finally{try{!y&&!r&&(p=v.return)&&(yield __await(p.call(v)))}finally{if(d)throw d.error}}})})}}async embedContent(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=embedContentParametersToVertex(this.apiClient,e);return m=formatMap("{model}:predict",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=embedContentResponseFromVertex(f),r=new EmbedContentResponse;return Object.assign(r,i),r})}else{const h=embedContentParametersToMldev(this.apiClient,e);return m=formatMap("{model}:batchEmbedContents",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=embedContentResponseFromMldev(f),r=new EmbedContentResponse;return Object.assign(r,i),r})}}async generateImagesInternal(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=generateImagesParametersToVertex(this.apiClient,e);return m=formatMap("{model}:predict",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=generateImagesResponseFromVertex(f),r=new GenerateImagesResponse;return Object.assign(r,i),r})}else{const h=generateImagesParametersToMldev(this.apiClient,e);return m=formatMap("{model}:predict",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=generateImagesResponseFromMldev(f),r=new GenerateImagesResponse;return Object.assign(r,i),r})}}async editImageInternal(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI()){const m=editImageParametersInternalToVertex(this.apiClient,e);return u=formatMap("{model}:predict",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:g.headers},f})),o.then(g=>{const h=editImageResponseFromVertex(g),f=new EditImageResponse;return Object.assign(f,h),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI()){const m=upscaleImageAPIParametersInternalToVertex(this.apiClient,e);return u=formatMap("{model}:predict",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:g.headers},f})),o.then(g=>{const h=upscaleImageResponseFromVertex(g),f=new UpscaleImageResponse;return Object.assign(f,h),f})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI()){const m=recontextImageParametersToVertex(this.apiClient,e);return u=formatMap("{model}:predict",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>{const h=recontextImageResponseFromVertex(g),f=new RecontextImageResponse;return Object.assign(f,h),f})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI()){const m=segmentImageParametersToVertex(this.apiClient,e);return u=formatMap("{model}:predict",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>{const h=segmentImageResponseFromVertex(g),f=new SegmentImageResponse;return Object.assign(f,h),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=getModelParametersToVertex(this.apiClient,e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>modelFromVertex(f))}else{const h=getModelParametersToMldev(this.apiClient,e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json()),l.then(f=>modelFromMldev(f))}}async listInternal(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=listModelsParametersToVertex(this.apiClient,e);return m=formatMap("{models_url}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=listModelsResponseFromVertex(f),r=new ListModelsResponse;return Object.assign(r,i),r})}else{const h=listModelsParametersToMldev(this.apiClient,e);return m=formatMap("{models_url}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=listModelsResponseFromMldev(f),r=new ListModelsResponse;return Object.assign(r,i),r})}}async update(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=updateModelParametersToVertex(this.apiClient,e);return m=formatMap("{model}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>modelFromVertex(f))}else{const h=updateModelParametersToMldev(this.apiClient,e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json()),l.then(f=>modelFromMldev(f))}}async delete(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=deleteModelParametersToVertex(this.apiClient,e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=deleteModelResponseFromVertex(f),r=new DeleteModelResponse;return Object.assign(r,i),r})}else{const h=deleteModelParametersToMldev(this.apiClient,e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=deleteModelResponseFromMldev(f),r=new DeleteModelResponse;return Object.assign(r,i),r})}}async countTokens(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=countTokensParametersToVertex(this.apiClient,e);return m=formatMap("{model}:countTokens",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=countTokensResponseFromVertex(f),r=new CountTokensResponse;return Object.assign(r,i),r})}else{const h=countTokensParametersToMldev(this.apiClient,e);return m=formatMap("{model}:countTokens",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=countTokensResponseFromMldev(f),r=new CountTokensResponse;return Object.assign(r,i),r})}}async computeTokens(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI()){const m=computeTokensParametersToVertex(this.apiClient,e);return u=formatMap("{model}:computeTokens",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:g.headers},f})),o.then(g=>{const h=computeTokensResponseFromVertex(g),f=new ComputeTokensResponse;return Object.assign(f,h),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=generateVideosParametersToVertex(this.apiClient,e);return m=formatMap("{model}:predictLongRunning",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const i=generateVideosOperationFromVertex(f),r=new GenerateVideosOperation;return Object.assign(r,i),r})}else{const h=generateVideosParametersToMldev(this.apiClient,e);return m=formatMap("{model}:predictLongRunning",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json()),l.then(f=>{const i=generateVideosOperationFromMldev(f),r=new GenerateVideosOperation;return Object.assign(r,i),r})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Operations extends BaseModule{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,s=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=t.name.split("/operations/")[0];let u;s&&"httpOptions"in s&&(u=s.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:u}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:t.name,config:s});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async get(e){const t=e.operation,s=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=t.name.split("/operations/")[0];let u;s&&"httpOptions"in s&&(u=s.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:u}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:t.name,config:s});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=getOperationParametersToVertex(e);return m=formatMap("{operationName}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l}else{const h=getOperationParametersToMldev(e);return m=formatMap("{operationName}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json()),l}}async fetchPredictVideosOperationInternal(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI()){const m=fetchPredictOperationParametersToVertex(e);return u=formatMap("{resourceName}:fetchPredictOperation",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function blobToMldev(n){const e={},t=getValueByPath(n,["data"]);if(t!=null&&setValueByPath(e,["data"],t),getValueByPath(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function contentToMldev(n){const e={},t=getValueByPath(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>partToMldev(u))),setValueByPath(e,["parts"],o)}const s=getValueByPath(n,["role"]);return s!=null&&setValueByPath(e,["role"],s),e}function createAuthTokenConfigToMldev(n,e,t){const s={},o=getValueByPath(e,["expireTime"]);t!==void 0&&o!=null&&setValueByPath(t,["expireTime"],o);const u=getValueByPath(e,["newSessionExpireTime"]);t!==void 0&&u!=null&&setValueByPath(t,["newSessionExpireTime"],u);const l=getValueByPath(e,["uses"]);t!==void 0&&l!=null&&setValueByPath(t,["uses"],l);const m=getValueByPath(e,["liveConnectConstraints"]);t!==void 0&&m!=null&&setValueByPath(t,["bidiGenerateContentSetup"],liveConnectConstraintsToMldev(n,m));const g=getValueByPath(e,["lockAdditionalFields"]);return t!==void 0&&g!=null&&setValueByPath(t,["fieldMask"],g),s}function createAuthTokenParametersToMldev(n,e){const t={},s=getValueByPath(e,["config"]);return s!=null&&setValueByPath(t,["config"],createAuthTokenConfigToMldev(n,s,t)),t}function fileDataToMldev(n){const e={};if(getValueByPath(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=getValueByPath(n,["fileUri"]);t!=null&&setValueByPath(e,["fileUri"],t);const s=getValueByPath(n,["mimeType"]);return s!=null&&setValueByPath(e,["mimeType"],s),e}function functionCallToMldev(n){const e={},t=getValueByPath(n,["id"]);t!=null&&setValueByPath(e,["id"],t);const s=getValueByPath(n,["args"]);s!=null&&setValueByPath(e,["args"],s);const o=getValueByPath(n,["name"]);if(o!=null&&setValueByPath(e,["name"],o),getValueByPath(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(getValueByPath(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function googleMapsToMldev(n){const e={};if(getValueByPath(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=getValueByPath(n,["enableWidget"]);return t!=null&&setValueByPath(e,["enableWidget"],t),e}function googleSearchToMldev(n){const e={};if(getValueByPath(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(getValueByPath(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=getValueByPath(n,["timeRangeFilter"]);return t!=null&&setValueByPath(e,["timeRangeFilter"],t),e}function liveConnectConfigToMldev(n,e){const t={},s=getValueByPath(n,["generationConfig"]);e!==void 0&&s!=null&&setValueByPath(e,["setup","generationConfig"],s);const o=getValueByPath(n,["responseModalities"]);e!==void 0&&o!=null&&setValueByPath(e,["setup","generationConfig","responseModalities"],o);const u=getValueByPath(n,["temperature"]);e!==void 0&&u!=null&&setValueByPath(e,["setup","generationConfig","temperature"],u);const l=getValueByPath(n,["topP"]);e!==void 0&&l!=null&&setValueByPath(e,["setup","generationConfig","topP"],l);const m=getValueByPath(n,["topK"]);e!==void 0&&m!=null&&setValueByPath(e,["setup","generationConfig","topK"],m);const g=getValueByPath(n,["maxOutputTokens"]);e!==void 0&&g!=null&&setValueByPath(e,["setup","generationConfig","maxOutputTokens"],g);const h=getValueByPath(n,["mediaResolution"]);e!==void 0&&h!=null&&setValueByPath(e,["setup","generationConfig","mediaResolution"],h);const f=getValueByPath(n,["seed"]);e!==void 0&&f!=null&&setValueByPath(e,["setup","generationConfig","seed"],f);const i=getValueByPath(n,["speechConfig"]);e!==void 0&&i!=null&&setValueByPath(e,["setup","generationConfig","speechConfig"],tLiveSpeechConfig(i));const r=getValueByPath(n,["thinkingConfig"]);e!==void 0&&r!=null&&setValueByPath(e,["setup","generationConfig","thinkingConfig"],r);const d=getValueByPath(n,["enableAffectiveDialog"]);e!==void 0&&d!=null&&setValueByPath(e,["setup","generationConfig","enableAffectiveDialog"],d);const p=getValueByPath(n,["systemInstruction"]);e!==void 0&&p!=null&&setValueByPath(e,["setup","systemInstruction"],contentToMldev(tContent(p)));const _=getValueByPath(n,["tools"]);if(e!==void 0&&_!=null){let R=tTools(_);Array.isArray(R)&&(R=R.map(I=>toolToMldev(tTool(I)))),setValueByPath(e,["setup","tools"],R)}const y=getValueByPath(n,["sessionResumption"]);e!==void 0&&y!=null&&setValueByPath(e,["setup","sessionResumption"],sessionResumptionConfigToMldev(y));const v=getValueByPath(n,["inputAudioTranscription"]);e!==void 0&&v!=null&&setValueByPath(e,["setup","inputAudioTranscription"],v);const T=getValueByPath(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&setValueByPath(e,["setup","outputAudioTranscription"],T);const w=getValueByPath(n,["realtimeInputConfig"]);e!==void 0&&w!=null&&setValueByPath(e,["setup","realtimeInputConfig"],w);const E=getValueByPath(n,["contextWindowCompression"]);e!==void 0&&E!=null&&setValueByPath(e,["setup","contextWindowCompression"],E);const P=getValueByPath(n,["proactivity"]);if(e!==void 0&&P!=null&&setValueByPath(e,["setup","proactivity"],P),getValueByPath(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function liveConnectConstraintsToMldev(n,e){const t={},s=getValueByPath(e,["model"]);s!=null&&setValueByPath(t,["setup","model"],tModel(n,s));const o=getValueByPath(e,["config"]);return o!=null&&setValueByPath(t,["config"],liveConnectConfigToMldev(o,t)),t}function partToMldev(n){const e={},t=getValueByPath(n,["mediaResolution"]);t!=null&&setValueByPath(e,["mediaResolution"],t);const s=getValueByPath(n,["codeExecutionResult"]);s!=null&&setValueByPath(e,["codeExecutionResult"],s);const o=getValueByPath(n,["executableCode"]);o!=null&&setValueByPath(e,["executableCode"],o);const u=getValueByPath(n,["fileData"]);u!=null&&setValueByPath(e,["fileData"],fileDataToMldev(u));const l=getValueByPath(n,["functionCall"]);l!=null&&setValueByPath(e,["functionCall"],functionCallToMldev(l));const m=getValueByPath(n,["functionResponse"]);m!=null&&setValueByPath(e,["functionResponse"],m);const g=getValueByPath(n,["inlineData"]);g!=null&&setValueByPath(e,["inlineData"],blobToMldev(g));const h=getValueByPath(n,["text"]);h!=null&&setValueByPath(e,["text"],h);const f=getValueByPath(n,["thought"]);f!=null&&setValueByPath(e,["thought"],f);const i=getValueByPath(n,["thoughtSignature"]);i!=null&&setValueByPath(e,["thoughtSignature"],i);const r=getValueByPath(n,["videoMetadata"]);return r!=null&&setValueByPath(e,["videoMetadata"],r),e}function sessionResumptionConfigToMldev(n){const e={},t=getValueByPath(n,["handle"]);if(t!=null&&setValueByPath(e,["handle"],t),getValueByPath(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function toolToMldev(n){const e={},t=getValueByPath(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(i=>i)),setValueByPath(e,["functionDeclarations"],f)}if(getValueByPath(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=getValueByPath(n,["googleSearchRetrieval"]);s!=null&&setValueByPath(e,["googleSearchRetrieval"],s);const o=getValueByPath(n,["computerUse"]);o!=null&&setValueByPath(e,["computerUse"],o);const u=getValueByPath(n,["fileSearch"]);u!=null&&setValueByPath(e,["fileSearch"],u);const l=getValueByPath(n,["codeExecution"]);if(l!=null&&setValueByPath(e,["codeExecution"],l),getValueByPath(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const m=getValueByPath(n,["googleMaps"]);m!=null&&setValueByPath(e,["googleMaps"],googleMapsToMldev(m));const g=getValueByPath(n,["googleSearch"]);g!=null&&setValueByPath(e,["googleSearch"],googleSearchToMldev(g));const h=getValueByPath(n,["urlContext"]);return h!=null&&setValueByPath(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function getFieldMasks(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const s=n[t];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const o=Object.keys(s).map(u=>`${t}.${u}`);e.push(...o)}else e.push(t)}return e.join(",")}function convertBidiSetupToTokenSetup(n,e){let t=null;const s=n.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const u=s.setup;typeof u=="object"&&u!==null?(n.bidiGenerateContentSetup=u,t=u):delete n.bidiGenerateContentSetup}else s!==void 0&&delete n.bidiGenerateContentSetup;const o=n.fieldMask;if(t){const u=getFieldMasks(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)u?n.fieldMask=u:delete n.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){const l=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let m=[];o.length>0&&(m=o.map(h=>l.includes(h)?`generationConfig.${h}`:h));const g=[];u&&g.push(u),m.length>0&&g.push(...m),g.length>0?n.fieldMask=g.join(","):delete n.fieldMask}else delete n.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?n.fieldMask=o.join(","):delete n.fieldMask;return n}class Tokens extends BaseModule{constructor(e){super(),this.apiClient=e}async create(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const m=createAuthTokenParametersToMldev(this.apiClient,e);u=formatMap("auth_tokens",m._url),l=m._query,delete m.config,delete m._url,delete m._query;const g=convertBidiSetupToTokenSetup(m,e.config);return o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>h)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function deleteDocumentConfigToMldev(n,e){const t={},s=getValueByPath(n,["force"]);return e!==void 0&&s!=null&&setValueByPath(e,["_query","force"],s),t}function deleteDocumentParametersToMldev(n){const e={},t=getValueByPath(n,["name"]);t!=null&&setValueByPath(e,["_url","name"],t);const s=getValueByPath(n,["config"]);return s!=null&&deleteDocumentConfigToMldev(s,e),e}function getDocumentParametersToMldev(n){const e={},t=getValueByPath(n,["name"]);return t!=null&&setValueByPath(e,["_url","name"],t),e}function listDocumentsConfigToMldev(n,e){const t={},s=getValueByPath(n,["pageSize"]);e!==void 0&&s!=null&&setValueByPath(e,["_query","pageSize"],s);const o=getValueByPath(n,["pageToken"]);return e!==void 0&&o!=null&&setValueByPath(e,["_query","pageToken"],o),t}function listDocumentsParametersToMldev(n){const e={},t=getValueByPath(n,["parent"]);t!=null&&setValueByPath(e,["_url","parent"],t);const s=getValueByPath(n,["config"]);return s!=null&&listDocumentsConfigToMldev(s,e),e}function listDocumentsResponseFromMldev(n){const e={},t=getValueByPath(n,["sdkHttpResponse"]);t!=null&&setValueByPath(e,["sdkHttpResponse"],t);const s=getValueByPath(n,["nextPageToken"]);s!=null&&setValueByPath(e,["nextPageToken"],s);const o=getValueByPath(n,["documents"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(l=>l)),setValueByPath(e,["documents"],u)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Documents extends BaseModule{constructor(e){super(),this.apiClient=e,this.list=async t=>new Pager(PagedItem.PAGED_ITEM_DOCUMENTS,s=>this.listInternal({parent:t.parent,config:s.config}),await this.listInternal(t),t)}async get(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=getDocumentParametersToMldev(e);return u=formatMap("{name}",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>g)}}async delete(e){var t,s;let o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=deleteDocumentParametersToMldev(e);o=formatMap("{name}",l._url),u=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=listDocumentsParametersToMldev(e);return u=formatMap("{parent}/documents",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>{const h=listDocumentsResponseFromMldev(g),f=new ListDocumentsResponse;return Object.assign(f,h),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class FileSearchStores extends BaseModule{constructor(e,t=new Documents(e)){super(),this.apiClient=e,this.documents=t,this.list=async(s={})=>new Pager(PagedItem.PAGED_ITEM_FILE_SEARCH_STORES,o=>this.listInternal(o),await this.listInternal(s),s)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=createFileSearchStoreParametersToMldev(e);return u=formatMap("fileSearchStores",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>g)}}async get(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=getFileSearchStoreParametersToMldev(e);return u=formatMap("{name}",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>g)}}async delete(e){var t,s;let o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=deleteFileSearchStoreParametersToMldev(e);o=formatMap("{name}",l._url),u=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=listFileSearchStoresParametersToMldev(e);return u=formatMap("fileSearchStores",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>{const h=listFileSearchStoresResponseFromMldev(g),f=new ListFileSearchStoresResponse;return Object.assign(f,h),f})}}async uploadToFileSearchStoreInternal(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=uploadToFileSearchStoreParametersToMldev(e);return u=formatMap("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>{const h=uploadToFileSearchStoreResumableResponseFromMldev(g),f=new UploadToFileSearchStoreResumableResponse;return Object.assign(f,h),f})}}async importFile(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=importFileParametersToMldev(e);return u=formatMap("{file_search_store_name}:importFile",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json()),o.then(g=>{const h=importFileOperationFromMldev(g),f=new ImportFileOperation;return Object.assign(f,h),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let uuid4Internal=function(){const{crypto:n}=globalThis;if(n?.randomUUID)return uuid4Internal=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^t()&15>>+s/4).toString(16))};const uuid4=()=>uuid4Internal();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function isAbortError(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const castToError=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class GeminiNextGenAPIClientError extends Error{}class APIError extends GeminiNextGenAPIClientError{constructor(e,t,s,o){super(`${APIError.makeMessage(e,t,s)}`),this.status=e,this.headers=o,this.error=t}static makeMessage(e,t,s){const o=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,t,s,o){if(!e||!o)return new APIConnectionError({message:s,cause:castToError(t)});const u=t;return e===400?new BadRequestError(e,u,s,o):e===401?new AuthenticationError(e,u,s,o):e===403?new PermissionDeniedError(e,u,s,o):e===404?new NotFoundError(e,u,s,o):e===409?new ConflictError(e,u,s,o):e===422?new UnprocessableEntityError(e,u,s,o):e===429?new RateLimitError(e,u,s,o):e>=500?new InternalServerError(e,u,s,o):new APIError(e,u,s,o)}}class APIUserAbortError extends APIError{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class APIConnectionError extends APIError{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class APIConnectionTimeoutError extends APIConnectionError{constructor({message:e}={}){super({message:e??"Request timed out."})}}class BadRequestError extends APIError{}class AuthenticationError extends APIError{}class PermissionDeniedError extends APIError{}class NotFoundError extends APIError{}class ConflictError extends APIError{}class UnprocessableEntityError extends APIError{}class RateLimitError extends APIError{}class InternalServerError extends APIError{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const startsWithSchemeRegexp=/^[a-z][a-z0-9+.-]*:/i,isAbsoluteURL=n=>startsWithSchemeRegexp.test(n);let isArrayInternal=n=>(isArrayInternal=Array.isArray,isArrayInternal(n));const isArray=isArrayInternal;let isReadonlyArrayInternal=isArray;const isReadonlyArray=isReadonlyArrayInternal;function isEmptyObj(n){if(!n)return!0;for(const e in n)return!1;return!0}function hasOwn(n,e){return Object.prototype.hasOwnProperty.call(n,e)}const validatePositiveInteger=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new GeminiNextGenAPIClientError(`${n} must be an integer`);if(e<0)throw new GeminiNextGenAPIClientError(`${n} must be a positive integer`);return e},safeJSON=n=>{try{return JSON.parse(n)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const sleep$1=n=>new Promise(e=>setTimeout(e,n));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const VERSION$1="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function getDetectedPlatform(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const getPlatformProperties=()=>{var n,e,t,s,o;const u=getDetectedPlatform();if(u==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION$1,"X-Stainless-OS":normalizePlatform(Deno.build.os),"X-Stainless-Arch":normalizeArch(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(n=Deno.version)===null||n===void 0?void 0:n.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION$1,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(u==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION$1,"X-Stainless-OS":normalizePlatform((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":normalizeArch((s=globalThis.process.arch)!==null&&s!==void 0?s:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(o=globalThis.process.version)!==null&&o!==void 0?o:"unknown"};const l=getBrowserInfo();return l?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION$1,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${l.browser}`,"X-Stainless-Runtime-Version":l.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION$1,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function getBrowserInfo(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const s=t.exec(navigator.userAgent);if(s){const o=s[1]||0,u=s[2]||0,l=s[3]||0;return{browser:e,version:`${o}.${u}.${l}`}}}return null}const normalizeArch=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",normalizePlatform=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let _platformHeaders;const getPlatformHeaders=()=>_platformHeaders??(_platformHeaders=getPlatformProperties());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function getDefaultFetch(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function makeReadableStream(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function ReadableStreamFrom(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return makeReadableStream({start(){},async pull(t){const{done:s,value:o}=await e.next();s?t.close():t.enqueue(o)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function ReadableStreamToAsyncIterable(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function CancelReadableStream(n){var e,t;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((t=(e=n[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}const s=n.getReader(),o=s.cancel();s.releaseLock(),await o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const FallbackEncoder=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const checkFileSupport=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e?.versions)===null||n===void 0?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function makeFile(n,e,t){return checkFileSupport(),new File(n,e??"unknown_file",t)}function getName(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const isAsyncIterable=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const isBlobLike=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",isFileLike=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&isBlobLike(n),isResponseLike=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function toFile(n,e,t){if(checkFileSupport(),n=await n,isFileLike(n))return n instanceof File?n:makeFile([await n.arrayBuffer()],n.name);if(isResponseLike(n)){const o=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),makeFile(await getBytes(o),e,t)}const s=await getBytes(n);if(e||(e=getName(n)),!t?.type){const o=s.find(u=>typeof u=="object"&&"type"in u&&u.type);typeof o=="string"&&(t=Object.assign(Object.assign({},t),{type:o}))}return makeFile(s,e,t)}async function getBytes(n){var e,t,s,o,u;let l=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)l.push(n);else if(isBlobLike(n))l.push(n instanceof Blob?n:await n.arrayBuffer());else if(isAsyncIterable(n))try{for(var m=!0,g=__asyncValues(n),h;h=await g.next(),e=h.done,!e;m=!0){o=h.value,m=!1;const f=o;l.push(...await getBytes(f))}}catch(f){t={error:f}}finally{try{!m&&!e&&(s=g.return)&&await s.call(g)}finally{if(t)throw t.error}}else{const f=(u=n?.constructor)===null||u===void 0?void 0:u.name;throw new Error(`Unexpected data type: ${typeof n}${f?`; constructor: ${f}`:""}${propsForError(n)}`)}return l}function propsForError(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class APIResource{constructor(e){this._client=e}}APIResource._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function encodeURIPath(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const EMPTY=Object.freeze(Object.create(null)),createPathTagFunction=(n=encodeURIPath)=>(function(t,...s){if(t.length===1)return t[0];let o=!1;const u=[],l=t.reduce((f,i,r)=>{var d,p,_;/[?#]/.test(i)&&(o=!0);const y=s[r];let v=(o?encodeURIComponent:n)(""+y);return r!==s.length&&(y==null||typeof y=="object"&&y.toString===((_=Object.getPrototypeOf((p=Object.getPrototypeOf((d=y.hasOwnProperty)!==null&&d!==void 0?d:EMPTY))!==null&&p!==void 0?p:EMPTY))===null||_===void 0?void 0:_.toString))&&(v=y+"",u.push({start:f.length+i.length,length:v.length,error:`Value of type ${Object.prototype.toString.call(y).slice(8,-1)} is not a valid path parameter`})),f+i+(r===s.length?"":v)},""),m=l.split(/[?#]/,1)[0],g=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;let h;for(;(h=g.exec(m))!==null;)u.push({start:h.index,length:h[0].length,error:`Value "${h[0]}" can't be safely passed as a path parameter`});if(u.sort((f,i)=>f.start-i.start),u.length>0){let f=0;const i=u.reduce((r,d)=>{const p=" ".repeat(d.start-f),_="^".repeat(d.length);return f=d.start+d.length,r+p+_},"");throw new GeminiNextGenAPIClientError(`Path parameters result in path with invalid segments:
${u.map(r=>r.error).join(`
`)}
${l}
${i}`)}return l}),path=createPathTagFunction(encodeURIPath);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class BaseInteractions extends APIResource{create(e,t){var s;const{api_version:o=this._client.apiVersion}=e,u=__rest(e,["api_version"]);if("model"in u&&"agent_config"in u)throw new GeminiNextGenAPIClientError("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in u&&"generation_config"in u)throw new GeminiNextGenAPIClientError("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(path`/${o}/interactions`,Object.assign(Object.assign({body:u},t),{stream:(s=e.stream)!==null&&s!==void 0?s:!1}))}delete(e,t={},s){const{api_version:o=this._client.apiVersion}=t??{};return this._client.delete(path`/${o}/interactions/${e}`,s)}cancel(e,t={},s){const{api_version:o=this._client.apiVersion}=t??{};return this._client.post(path`/${o}/interactions/${e}/cancel`,s)}get(e,t={},s){var o;const u=t??{},{api_version:l=this._client.apiVersion}=u,m=__rest(u,["api_version"]);return this._client.get(path`/${l}/interactions/${e}`,Object.assign(Object.assign({query:m},s),{stream:(o=t?.stream)!==null&&o!==void 0?o:!1}))}}BaseInteractions._key=Object.freeze(["interactions"]);class Interactions extends BaseInteractions{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function concatBytes(n){let e=0;for(const o of n)e+=o.length;const t=new Uint8Array(e);let s=0;for(const o of n)t.set(o,s),s+=o.length;return t}let encodeUTF8_;function encodeUTF8(n){let e;return(encodeUTF8_??(e=new globalThis.TextEncoder,encodeUTF8_=e.encode.bind(e)))(n)}let decodeUTF8_;function decodeUTF8(n){let e;return(decodeUTF8_??(e=new globalThis.TextDecoder,decodeUTF8_=e.decode.bind(e)))(n)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class LineDecoder{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?encodeUTF8(e):e;this.buffer=concatBytes([this.buffer,t]);const s=[];let o;for(;(o=findNewlineIndex(this.buffer,this.carriageReturnIndex))!=null;){if(o.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=o.index;continue}if(this.carriageReturnIndex!=null&&(o.index!==this.carriageReturnIndex+1||o.carriage)){s.push(decodeUTF8(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const u=this.carriageReturnIndex!==null?o.preceding-1:o.preceding,l=decodeUTF8(this.buffer.subarray(0,u));s.push(l),this.buffer=this.buffer.subarray(o.index),this.carriageReturnIndex=null}return s}flush(){return this.buffer.length?this.decode(`
`):[]}}LineDecoder.NEWLINE_CHARS=new Set([`
`,"\r"]);LineDecoder.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function findNewlineIndex(n,e){for(let o=e??0;o<n.length;o++){if(n[o]===10)return{preceding:o,index:o+1,carriage:!1};if(n[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function findDoubleNewlineIndex(n){for(let s=0;s<n.length-1;s++){if(n[s]===10&&n[s+1]===10||n[s]===13&&n[s+1]===13)return s+2;if(n[s]===13&&n[s+1]===10&&s+3<n.length&&n[s+2]===13&&n[s+3]===10)return s+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const levelNumbers={off:0,error:200,warn:300,info:400,debug:500},parseLogLevel=(n,e,t)=>{if(n){if(hasOwn(levelNumbers,n))return n;loggerFor(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(levelNumbers))}`)}};function noop(){}function makeLogFn(n,e,t){return!e||levelNumbers[n]>levelNumbers[t]?noop:e[n].bind(e)}const noopLogger={error:noop,warn:noop,info:noop,debug:noop};let cachedLoggers=new WeakMap;function loggerFor(n){var e;const t=n.logger,s=(e=n.logLevel)!==null&&e!==void 0?e:"off";if(!t)return noopLogger;const o=cachedLoggers.get(t);if(o&&o[0]===s)return o[1];const u={error:makeLogFn("error",t,s),warn:makeLogFn("warn",t,s),info:makeLogFn("info",t,s),debug:makeLogFn("debug",t,s)};return cachedLoggers.set(t,[s,u]),u}const formatRequestDetails=n=>(n.options&&(n.options=Object.assign({},n.options),delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Stream{constructor(e,t,s){this.iterator=e,this.controller=t,this.client=s}static fromSSEResponse(e,t,s){let o=!1;const u=s?loggerFor(s):console;function l(){return __asyncGenerator(this,arguments,function*(){var g,h,f,i;if(o)throw new GeminiNextGenAPIClientError("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let r=!1;try{try{for(var d=!0,p=__asyncValues(_iterSSEMessages(e,t)),_;_=yield __await(p.next()),g=_.done,!g;d=!0){i=_.value,d=!1;const y=i;if(!r)if(y.data.startsWith("[DONE]")){r=!0;continue}else try{yield yield __await(JSON.parse(y.data))}catch(v){throw u.error("Could not parse message into JSON:",y.data),u.error("From chunk:",y.raw),v}}}catch(y){h={error:y}}finally{try{!d&&!g&&(f=p.return)&&(yield __await(f.call(p)))}finally{if(h)throw h.error}}r=!0}catch(y){if(isAbortError(y))return yield __await(void 0);throw y}finally{r||t.abort()}})}return new Stream(l,t,s)}static fromReadableStream(e,t,s){let o=!1;function u(){return __asyncGenerator(this,arguments,function*(){var g,h,f,i;const r=new LineDecoder,d=ReadableStreamToAsyncIterable(e);try{for(var p=!0,_=__asyncValues(d),y;y=yield __await(_.next()),g=y.done,!g;p=!0){i=y.value,p=!1;const v=i;for(const T of r.decode(v))yield yield __await(T)}}catch(v){h={error:v}}finally{try{!p&&!g&&(f=_.return)&&(yield __await(f.call(_)))}finally{if(h)throw h.error}}for(const v of r.flush())yield yield __await(v)})}function l(){return __asyncGenerator(this,arguments,function*(){var g,h,f,i;if(o)throw new GeminiNextGenAPIClientError("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let r=!1;try{try{for(var d=!0,p=__asyncValues(u()),_;_=yield __await(p.next()),g=_.done,!g;d=!0){i=_.value,d=!1;const y=i;r||y&&(yield yield __await(JSON.parse(y)))}}catch(y){h={error:y}}finally{try{!d&&!g&&(f=p.return)&&(yield __await(f.call(p)))}finally{if(h)throw h.error}}r=!0}catch(y){if(isAbortError(y))return yield __await(void 0);throw y}finally{r||t.abort()}})}return new Stream(l,t,s)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),o=u=>({next:()=>{if(u.length===0){const l=s.next();e.push(l),t.push(l)}return u.shift()}});return[new Stream(()=>o(e),this.controller,this.client),new Stream(()=>o(t),this.controller,this.client)]}toReadableStream(){const e=this;let t;return makeReadableStream({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:o,done:u}=await t.next();if(u)return s.close();const l=encodeUTF8(JSON.stringify(o)+`
`);s.enqueue(l)}catch(o){s.error(o)}},async cancel(){var s;await((s=t.return)===null||s===void 0?void 0:s.call(t))}})}}function _iterSSEMessages(n,e){return __asyncGenerator(this,arguments,function*(){var s,o,u,l;if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new GeminiNextGenAPIClientError("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new GeminiNextGenAPIClientError("Attempted to iterate over a response with no body");const m=new SSEDecoder,g=new LineDecoder,h=ReadableStreamToAsyncIterable(n.body);try{for(var f=!0,i=__asyncValues(iterSSEChunks(h)),r;r=yield __await(i.next()),s=r.done,!s;f=!0){l=r.value,f=!1;const d=l;for(const p of g.decode(d)){const _=m.decode(p);_&&(yield yield __await(_))}}}catch(d){o={error:d}}finally{try{!f&&!s&&(u=i.return)&&(yield __await(u.call(i)))}finally{if(o)throw o.error}}for(const d of g.flush()){const p=m.decode(d);p&&(yield yield __await(p))}})}function iterSSEChunks(n){return __asyncGenerator(this,arguments,function*(){var t,s,o,u;let l=new Uint8Array;try{for(var m=!0,g=__asyncValues(n),h;h=yield __await(g.next()),t=h.done,!t;m=!0){u=h.value,m=!1;const f=u;if(f==null)continue;const i=f instanceof ArrayBuffer?new Uint8Array(f):typeof f=="string"?encodeUTF8(f):f;let r=new Uint8Array(l.length+i.length);r.set(l),r.set(i,l.length),l=r;let d;for(;(d=findDoubleNewlineIndex(l))!==-1;)yield yield __await(l.slice(0,d)),l=l.slice(d)}}catch(f){s={error:f}}finally{try{!m&&!t&&(o=g.return)&&(yield __await(o.call(g)))}finally{if(s)throw s.error}}l.length>0&&(yield yield __await(l))})}class SSEDecoder{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const u={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],u}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,o]=partition(e,":");return o.startsWith(" ")&&(o=o.substring(1)),t==="event"?this.event=o:t==="data"&&this.data.push(o),null}}function partition(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function defaultParseResponse(n,e){const{response:t,requestLogID:s,retryOfRequestLogID:o,startTime:u}=e,l=await(async()=>{var m;if(e.options.stream)return loggerFor(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,n):Stream.fromSSEResponse(t,e.controller,n);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const g=t.headers.get("content-type"),h=(m=g?.split(";")[0])===null||m===void 0?void 0:m.trim();return h?.includes("application/json")||h?.endsWith("+json")?await t.json():await t.text()})();return loggerFor(n).debug(`[${s}] response parsed`,formatRequestDetails({retryOfRequestLogID:o,url:t.url,status:t.status,body:l,durationMs:Date.now()-u})),l}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class APIPromise extends Promise{constructor(e,t,s=defaultParseResponse){super(o=>{o(null)}),this.responsePromise=t,this.parseResponse=s,this.client=e}_thenUnwrap(e){return new APIPromise(this.client,this.responsePromise,async(t,s)=>e(await this.parseResponse(t,s),s))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const brand_privateNullableHeaders=Symbol("brand.privateNullableHeaders");function*iterateHeaders(n){if(!n)return;if(brand_privateNullableHeaders in n){const{values:s,nulls:o}=n;yield*s.entries();for(const u of o)yield[u,null];return}let e=!1,t;n instanceof Headers?t=n.entries():isReadonlyArray(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let s of t){const o=s[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");const u=isReadonlyArray(s[1])?s[1]:[s[1]];let l=!1;for(const m of u)m!==void 0&&(e&&!l&&(l=!0,yield[o,null]),yield[o,m])}}const buildHeaders=n=>{const e=new Headers,t=new Set;for(const s of n){const o=new Set;for(const[u,l]of iterateHeaders(s)){const m=u.toLowerCase();o.has(m)||(e.delete(u),o.add(m)),l===null?(e.delete(u),t.add(m)):(e.append(u,l),t.delete(m))}}return{[brand_privateNullableHeaders]:!0,values:e,nulls:t}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const readEnv=n=>{var e,t,s,o,u,l;if(typeof globalThis.process<"u")return(s=(t=(e=define_globalThis_process_env_default)===null||e===void 0?void 0:e[n])===null||t===void 0?void 0:t.trim())!==null&&s!==void 0?s:void 0;if(typeof globalThis.Deno<"u")return(l=(u=(o=globalThis.Deno.env)===null||o===void 0?void 0:o.get)===null||u===void 0?void 0:u.call(o,n))===null||l===void 0?void 0:l.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var _a;class BaseGeminiNextGenAPIClient{constructor(e){var t,s,o,u,l,m,g,h=e===void 0?{}:e,{baseURL:f=readEnv("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:i=(t=readEnv("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:r="v1beta"}=h,d=__rest(h,["baseURL","apiKey","apiVersion"]);const p=Object.assign(Object.assign({apiKey:i,apiVersion:r},d),{baseURL:f||"https://generativelanguage.googleapis.com"});this.baseURL=p.baseURL,this.timeout=(s=p.timeout)!==null&&s!==void 0?s:BaseGeminiNextGenAPIClient.DEFAULT_TIMEOUT,this.logger=(o=p.logger)!==null&&o!==void 0?o:console;const _="warn";this.logLevel=_,this.logLevel=(l=(u=parseLogLevel(p.logLevel,"ClientOptions.logLevel",this))!==null&&u!==void 0?u:parseLogLevel(readEnv("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&l!==void 0?l:_,this.fetchOptions=p.fetchOptions,this.maxRetries=(m=p.maxRetries)!==null&&m!==void 0?m:2,this.fetch=(g=p.fetch)!==null&&g!==void 0?g:getDefaultFetch(),this.encoder=FallbackEncoder,this._options=p,this.apiKey=i,this.apiVersion=r}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){if(this.apiKey!=null)return buildHeaders([{"x-goog-api-key":this.apiKey}])}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>typeof s<"u").map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new GeminiNextGenAPIClientError(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${VERSION$1}`}defaultIdempotencyKey(){return`stainless-node-retry-${uuid4()}`}makeStatusError(e,t,s,o){return APIError.generate(e,t,s,o)}buildURL(e,t,s){const o=!this.baseURLOverridden()&&s||this.baseURL,u=isAbsoluteURL(e)?new URL(e):new URL(o+(o.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),l=this.defaultQuery();return isEmptyObj(l)||(t=Object.assign(Object.assign({},l),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(u.search=this.stringifyQuery(t)),u.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(o=>Object.assign({method:e,path:t},o)))}request(e,t=null){return new APIPromise(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){var o,u,l;const m=await e,g=(o=m.maxRetries)!==null&&o!==void 0?o:this.maxRetries;t==null&&(t=g),await this.prepareOptions(m);const{req:h,url:f,timeout:i}=await this.buildRequest(m,{retryCount:g-t});await this.prepareRequest(h,{url:f,options:m});const r="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=s===void 0?"":`, retryOf: ${s}`,p=Date.now();if(loggerFor(this).debug(`[${r}] sending request`,formatRequestDetails({retryOfRequestLogID:s,method:m.method,url:f,options:m,headers:h.headers})),!((u=m.signal)===null||u===void 0)&&u.aborted)throw new APIUserAbortError;const _=new AbortController,y=await this.fetchWithTimeout(f,h,i,_).catch(castToError),v=Date.now();if(y instanceof globalThis.Error){const w=`retrying, ${t} attempts remaining`;if(!((l=m.signal)===null||l===void 0)&&l.aborted)throw new APIUserAbortError;const E=isAbortError(y)||/timed? ?out/i.test(String(y)+("cause"in y?String(y.cause):""));if(t)return loggerFor(this).info(`[${r}] connection ${E?"timed out":"failed"} - ${w}`),loggerFor(this).debug(`[${r}] connection ${E?"timed out":"failed"} (${w})`,formatRequestDetails({retryOfRequestLogID:s,url:f,durationMs:v-p,message:y.message})),this.retryRequest(m,t,s??r);throw loggerFor(this).info(`[${r}] connection ${E?"timed out":"failed"} - error; no more retries left`),loggerFor(this).debug(`[${r}] connection ${E?"timed out":"failed"} (error; no more retries left)`,formatRequestDetails({retryOfRequestLogID:s,url:f,durationMs:v-p,message:y.message})),E?new APIConnectionTimeoutError:new APIConnectionError({cause:y})}const T=`[${r}${d}] ${h.method} ${f} ${y.ok?"succeeded":"failed"} with status ${y.status} in ${v-p}ms`;if(!y.ok){const w=await this.shouldRetry(y);if(t&&w){const B=`retrying, ${t} attempts remaining`;return await CancelReadableStream(y.body),loggerFor(this).info(`${T} - ${B}`),loggerFor(this).debug(`[${r}] response error (${B})`,formatRequestDetails({retryOfRequestLogID:s,url:y.url,status:y.status,headers:y.headers,durationMs:v-p})),this.retryRequest(m,t,s??r,y.headers)}const E=w?"error; no more retries left":"error; not retryable";loggerFor(this).info(`${T} - ${E}`);const P=await y.text().catch(B=>castToError(B).message),R=safeJSON(P),I=R?void 0:P;throw loggerFor(this).debug(`[${r}] response error (${E})`,formatRequestDetails({retryOfRequestLogID:s,url:y.url,status:y.status,headers:y.headers,message:I,durationMs:Date.now()-p})),this.makeStatusError(y.status,R,I,y.headers)}return loggerFor(this).info(T),loggerFor(this).debug(`[${r}] response start`,formatRequestDetails({retryOfRequestLogID:s,url:y.url,status:y.status,headers:y.headers,durationMs:v-p})),{response:y,options:m,controller:_,requestLogID:r,retryOfRequestLogID:s,startTime:p}}async fetchWithTimeout(e,t,s,o){const u=t||{},{signal:l,method:m}=u,g=__rest(u,["signal","method"]);l&&l.addEventListener("abort",()=>o.abort());const h=setTimeout(()=>o.abort(),s),f=globalThis.ReadableStream&&g.body instanceof globalThis.ReadableStream||typeof g.body=="object"&&g.body!==null&&Symbol.asyncIterator in g.body,i=Object.assign(Object.assign(Object.assign({signal:o.signal},f?{duplex:"half"}:{}),{method:"GET"}),g);m&&(i.method=m.toUpperCase());try{return await this.fetch.call(void 0,e,i)}finally{clearTimeout(h)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s,o){var u;let l;const m=o?.get("retry-after-ms");if(m){const h=parseFloat(m);Number.isNaN(h)||(l=h)}const g=o?.get("retry-after");if(g&&!l){const h=parseFloat(g);Number.isNaN(h)?l=Date.parse(g)-Date.now():l=h*1e3}if(!(l&&0<=l&&l<60*1e3)){const h=(u=e.maxRetries)!==null&&u!==void 0?u:this.maxRetries;l=this.calculateDefaultRetryTimeoutMillis(t,h)}return await sleep$1(l),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const u=t-e,l=Math.min(.5*Math.pow(2,u),8),m=1-Math.random()*.25;return l*m*1e3}async buildRequest(e,{retryCount:t=0}={}){var s,o,u;const l=Object.assign({},e),{method:m,path:g,query:h,defaultBaseURL:f}=l,i=this.buildURL(g,h,f);"timeout"in l&&validatePositiveInteger("timeout",l.timeout),l.timeout=(s=l.timeout)!==null&&s!==void 0?s:this.timeout;const{bodyHeaders:r,body:d}=this.buildBody({options:l}),p=await this.buildHeaders({options:e,method:m,bodyHeaders:r,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:m,headers:p},l.signal&&{signal:l.signal}),globalThis.ReadableStream&&d instanceof globalThis.ReadableStream&&{duplex:"half"}),d&&{body:d}),(o=this.fetchOptions)!==null&&o!==void 0?o:{}),(u=l.fetchOptions)!==null&&u!==void 0?u:{}),url:i,timeout:l.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:o}){let u={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),u[this.idempotencyHeader]=e.idempotencyKey);const l=buildHeaders([u,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(o)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),getPlatformHeaders()),await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(l),l.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const s=buildHeaders([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:ReadableStreamFrom(e)}:this.encoder({body:e,headers:s})}}BaseGeminiNextGenAPIClient.DEFAULT_TIMEOUT=6e4;class GeminiNextGenAPIClient extends BaseGeminiNextGenAPIClient{constructor(){super(...arguments),this.interactions=new Interactions(this)}}_a=GeminiNextGenAPIClient;GeminiNextGenAPIClient.GeminiNextGenAPIClient=_a;GeminiNextGenAPIClient.GeminiNextGenAPIClientError=GeminiNextGenAPIClientError;GeminiNextGenAPIClient.APIError=APIError;GeminiNextGenAPIClient.APIConnectionError=APIConnectionError;GeminiNextGenAPIClient.APIConnectionTimeoutError=APIConnectionTimeoutError;GeminiNextGenAPIClient.APIUserAbortError=APIUserAbortError;GeminiNextGenAPIClient.NotFoundError=NotFoundError;GeminiNextGenAPIClient.ConflictError=ConflictError;GeminiNextGenAPIClient.RateLimitError=RateLimitError;GeminiNextGenAPIClient.BadRequestError=BadRequestError;GeminiNextGenAPIClient.AuthenticationError=AuthenticationError;GeminiNextGenAPIClient.InternalServerError=InternalServerError;GeminiNextGenAPIClient.PermissionDeniedError=PermissionDeniedError;GeminiNextGenAPIClient.UnprocessableEntityError=UnprocessableEntityError;GeminiNextGenAPIClient.toFile=toFile;GeminiNextGenAPIClient.Interactions=Interactions;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cancelTuningJobParametersToMldev(n,e){const t={},s=getValueByPath(n,["name"]);return s!=null&&setValueByPath(t,["_url","name"],s),t}function cancelTuningJobParametersToVertex(n,e){const t={},s=getValueByPath(n,["name"]);return s!=null&&setValueByPath(t,["_url","name"],s),t}function cancelTuningJobResponseFromMldev(n,e){const t={},s=getValueByPath(n,["sdkHttpResponse"]);return s!=null&&setValueByPath(t,["sdkHttpResponse"],s),t}function cancelTuningJobResponseFromVertex(n,e){const t={},s=getValueByPath(n,["sdkHttpResponse"]);return s!=null&&setValueByPath(t,["sdkHttpResponse"],s),t}function createTuningJobConfigToMldev(n,e,t){const s={};if(getValueByPath(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const o=getValueByPath(n,["tunedModelDisplayName"]);if(e!==void 0&&o!=null&&setValueByPath(e,["displayName"],o),getValueByPath(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const u=getValueByPath(n,["epochCount"]);e!==void 0&&u!=null&&setValueByPath(e,["tuningTask","hyperparameters","epochCount"],u);const l=getValueByPath(n,["learningRateMultiplier"]);if(l!=null&&setValueByPath(s,["tuningTask","hyperparameters","learningRateMultiplier"],l),getValueByPath(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(getValueByPath(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(getValueByPath(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const m=getValueByPath(n,["batchSize"]);e!==void 0&&m!=null&&setValueByPath(e,["tuningTask","hyperparameters","batchSize"],m);const g=getValueByPath(n,["learningRate"]);if(e!==void 0&&g!=null&&setValueByPath(e,["tuningTask","hyperparameters","learningRate"],g),getValueByPath(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(getValueByPath(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return s}function createTuningJobConfigToVertex(n,e,t){const s={};let o=getValueByPath(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const d=getValueByPath(n,["validationDataset"]);e!==void 0&&d!=null&&setValueByPath(e,["supervisedTuningSpec"],tuningValidationDatasetToVertex(d))}else if(o==="PREFERENCE_TUNING"){const d=getValueByPath(n,["validationDataset"]);e!==void 0&&d!=null&&setValueByPath(e,["preferenceOptimizationSpec"],tuningValidationDatasetToVertex(d))}const u=getValueByPath(n,["tunedModelDisplayName"]);e!==void 0&&u!=null&&setValueByPath(e,["tunedModelDisplayName"],u);const l=getValueByPath(n,["description"]);e!==void 0&&l!=null&&setValueByPath(e,["description"],l);let m=getValueByPath(t,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){const d=getValueByPath(n,["epochCount"]);e!==void 0&&d!=null&&setValueByPath(e,["supervisedTuningSpec","hyperParameters","epochCount"],d)}else if(m==="PREFERENCE_TUNING"){const d=getValueByPath(n,["epochCount"]);e!==void 0&&d!=null&&setValueByPath(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],d)}let g=getValueByPath(t,["config","method"]);if(g===void 0&&(g="SUPERVISED_FINE_TUNING"),g==="SUPERVISED_FINE_TUNING"){const d=getValueByPath(n,["learningRateMultiplier"]);e!==void 0&&d!=null&&setValueByPath(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],d)}else if(g==="PREFERENCE_TUNING"){const d=getValueByPath(n,["learningRateMultiplier"]);e!==void 0&&d!=null&&setValueByPath(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],d)}let h=getValueByPath(t,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const d=getValueByPath(n,["exportLastCheckpointOnly"]);e!==void 0&&d!=null&&setValueByPath(e,["supervisedTuningSpec","exportLastCheckpointOnly"],d)}else if(h==="PREFERENCE_TUNING"){const d=getValueByPath(n,["exportLastCheckpointOnly"]);e!==void 0&&d!=null&&setValueByPath(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],d)}let f=getValueByPath(t,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const d=getValueByPath(n,["adapterSize"]);e!==void 0&&d!=null&&setValueByPath(e,["supervisedTuningSpec","hyperParameters","adapterSize"],d)}else if(f==="PREFERENCE_TUNING"){const d=getValueByPath(n,["adapterSize"]);e!==void 0&&d!=null&&setValueByPath(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],d)}if(getValueByPath(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(getValueByPath(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const i=getValueByPath(n,["labels"]);e!==void 0&&i!=null&&setValueByPath(e,["labels"],i);const r=getValueByPath(n,["beta"]);return e!==void 0&&r!=null&&setValueByPath(e,["preferenceOptimizationSpec","hyperParameters","beta"],r),s}function createTuningJobParametersPrivateToMldev(n,e){const t={},s=getValueByPath(n,["baseModel"]);s!=null&&setValueByPath(t,["baseModel"],s);const o=getValueByPath(n,["preTunedModel"]);o!=null&&setValueByPath(t,["preTunedModel"],o);const u=getValueByPath(n,["trainingDataset"]);u!=null&&tuningDatasetToMldev(u);const l=getValueByPath(n,["config"]);return l!=null&&createTuningJobConfigToMldev(l,t),t}function createTuningJobParametersPrivateToVertex(n,e){const t={},s=getValueByPath(n,["baseModel"]);s!=null&&setValueByPath(t,["baseModel"],s);const o=getValueByPath(n,["preTunedModel"]);o!=null&&setValueByPath(t,["preTunedModel"],o);const u=getValueByPath(n,["trainingDataset"]);u!=null&&tuningDatasetToVertex(u,t,e);const l=getValueByPath(n,["config"]);return l!=null&&createTuningJobConfigToVertex(l,t,e),t}function getTuningJobParametersToMldev(n,e){const t={},s=getValueByPath(n,["name"]);return s!=null&&setValueByPath(t,["_url","name"],s),t}function getTuningJobParametersToVertex(n,e){const t={},s=getValueByPath(n,["name"]);return s!=null&&setValueByPath(t,["_url","name"],s),t}function listTuningJobsConfigToMldev(n,e,t){const s={},o=getValueByPath(n,["pageSize"]);e!==void 0&&o!=null&&setValueByPath(e,["_query","pageSize"],o);const u=getValueByPath(n,["pageToken"]);e!==void 0&&u!=null&&setValueByPath(e,["_query","pageToken"],u);const l=getValueByPath(n,["filter"]);return e!==void 0&&l!=null&&setValueByPath(e,["_query","filter"],l),s}function listTuningJobsConfigToVertex(n,e,t){const s={},o=getValueByPath(n,["pageSize"]);e!==void 0&&o!=null&&setValueByPath(e,["_query","pageSize"],o);const u=getValueByPath(n,["pageToken"]);e!==void 0&&u!=null&&setValueByPath(e,["_query","pageToken"],u);const l=getValueByPath(n,["filter"]);return e!==void 0&&l!=null&&setValueByPath(e,["_query","filter"],l),s}function listTuningJobsParametersToMldev(n,e){const t={},s=getValueByPath(n,["config"]);return s!=null&&listTuningJobsConfigToMldev(s,t),t}function listTuningJobsParametersToVertex(n,e){const t={},s=getValueByPath(n,["config"]);return s!=null&&listTuningJobsConfigToVertex(s,t),t}function listTuningJobsResponseFromMldev(n,e){const t={},s=getValueByPath(n,["sdkHttpResponse"]);s!=null&&setValueByPath(t,["sdkHttpResponse"],s);const o=getValueByPath(n,["nextPageToken"]);o!=null&&setValueByPath(t,["nextPageToken"],o);const u=getValueByPath(n,["tunedModels"]);if(u!=null){let l=u;Array.isArray(l)&&(l=l.map(m=>tuningJobFromMldev(m))),setValueByPath(t,["tuningJobs"],l)}return t}function listTuningJobsResponseFromVertex(n,e){const t={},s=getValueByPath(n,["sdkHttpResponse"]);s!=null&&setValueByPath(t,["sdkHttpResponse"],s);const o=getValueByPath(n,["nextPageToken"]);o!=null&&setValueByPath(t,["nextPageToken"],o);const u=getValueByPath(n,["tuningJobs"]);if(u!=null){let l=u;Array.isArray(l)&&(l=l.map(m=>tuningJobFromVertex(m))),setValueByPath(t,["tuningJobs"],l)}return t}function tunedModelFromMldev(n,e){const t={},s=getValueByPath(n,["name"]);s!=null&&setValueByPath(t,["model"],s);const o=getValueByPath(n,["name"]);return o!=null&&setValueByPath(t,["endpoint"],o),t}function tuningDatasetToMldev(n,e){const t={};if(getValueByPath(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(getValueByPath(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const s=getValueByPath(n,["examples"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),setValueByPath(t,["examples","examples"],o)}return t}function tuningDatasetToVertex(n,e,t){const s={};let o=getValueByPath(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const l=getValueByPath(n,["gcsUri"]);e!==void 0&&l!=null&&setValueByPath(e,["supervisedTuningSpec","trainingDatasetUri"],l)}else if(o==="PREFERENCE_TUNING"){const l=getValueByPath(n,["gcsUri"]);e!==void 0&&l!=null&&setValueByPath(e,["preferenceOptimizationSpec","trainingDatasetUri"],l)}let u=getValueByPath(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const l=getValueByPath(n,["vertexDatasetResource"]);e!==void 0&&l!=null&&setValueByPath(e,["supervisedTuningSpec","trainingDatasetUri"],l)}else if(u==="PREFERENCE_TUNING"){const l=getValueByPath(n,["vertexDatasetResource"]);e!==void 0&&l!=null&&setValueByPath(e,["preferenceOptimizationSpec","trainingDatasetUri"],l)}if(getValueByPath(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return s}function tuningJobFromMldev(n,e){const t={},s=getValueByPath(n,["sdkHttpResponse"]);s!=null&&setValueByPath(t,["sdkHttpResponse"],s);const o=getValueByPath(n,["name"]);o!=null&&setValueByPath(t,["name"],o);const u=getValueByPath(n,["state"]);u!=null&&setValueByPath(t,["state"],tTuningJobStatus(u));const l=getValueByPath(n,["createTime"]);l!=null&&setValueByPath(t,["createTime"],l);const m=getValueByPath(n,["tuningTask","startTime"]);m!=null&&setValueByPath(t,["startTime"],m);const g=getValueByPath(n,["tuningTask","completeTime"]);g!=null&&setValueByPath(t,["endTime"],g);const h=getValueByPath(n,["updateTime"]);h!=null&&setValueByPath(t,["updateTime"],h);const f=getValueByPath(n,["description"]);f!=null&&setValueByPath(t,["description"],f);const i=getValueByPath(n,["baseModel"]);i!=null&&setValueByPath(t,["baseModel"],i);const r=getValueByPath(n,["_self"]);return r!=null&&setValueByPath(t,["tunedModel"],tunedModelFromMldev(r)),t}function tuningJobFromVertex(n,e){const t={},s=getValueByPath(n,["sdkHttpResponse"]);s!=null&&setValueByPath(t,["sdkHttpResponse"],s);const o=getValueByPath(n,["name"]);o!=null&&setValueByPath(t,["name"],o);const u=getValueByPath(n,["state"]);u!=null&&setValueByPath(t,["state"],tTuningJobStatus(u));const l=getValueByPath(n,["createTime"]);l!=null&&setValueByPath(t,["createTime"],l);const m=getValueByPath(n,["startTime"]);m!=null&&setValueByPath(t,["startTime"],m);const g=getValueByPath(n,["endTime"]);g!=null&&setValueByPath(t,["endTime"],g);const h=getValueByPath(n,["updateTime"]);h!=null&&setValueByPath(t,["updateTime"],h);const f=getValueByPath(n,["error"]);f!=null&&setValueByPath(t,["error"],f);const i=getValueByPath(n,["description"]);i!=null&&setValueByPath(t,["description"],i);const r=getValueByPath(n,["baseModel"]);r!=null&&setValueByPath(t,["baseModel"],r);const d=getValueByPath(n,["tunedModel"]);d!=null&&setValueByPath(t,["tunedModel"],d);const p=getValueByPath(n,["preTunedModel"]);p!=null&&setValueByPath(t,["preTunedModel"],p);const _=getValueByPath(n,["supervisedTuningSpec"]);_!=null&&setValueByPath(t,["supervisedTuningSpec"],_);const y=getValueByPath(n,["preferenceOptimizationSpec"]);y!=null&&setValueByPath(t,["preferenceOptimizationSpec"],y);const v=getValueByPath(n,["tuningDataStats"]);v!=null&&setValueByPath(t,["tuningDataStats"],v);const T=getValueByPath(n,["encryptionSpec"]);T!=null&&setValueByPath(t,["encryptionSpec"],T);const w=getValueByPath(n,["partnerModelTuningSpec"]);w!=null&&setValueByPath(t,["partnerModelTuningSpec"],w);const E=getValueByPath(n,["customBaseModel"]);E!=null&&setValueByPath(t,["customBaseModel"],E);const P=getValueByPath(n,["experiment"]);P!=null&&setValueByPath(t,["experiment"],P);const R=getValueByPath(n,["labels"]);R!=null&&setValueByPath(t,["labels"],R);const I=getValueByPath(n,["outputUri"]);I!=null&&setValueByPath(t,["outputUri"],I);const N=getValueByPath(n,["pipelineJob"]);N!=null&&setValueByPath(t,["pipelineJob"],N);const B=getValueByPath(n,["serviceAccount"]);B!=null&&setValueByPath(t,["serviceAccount"],B);const D=getValueByPath(n,["tunedModelDisplayName"]);D!=null&&setValueByPath(t,["tunedModelDisplayName"],D);const Y=getValueByPath(n,["veoTuningSpec"]);return Y!=null&&setValueByPath(t,["veoTuningSpec"],Y),t}function tuningOperationFromMldev(n,e){const t={},s=getValueByPath(n,["sdkHttpResponse"]);s!=null&&setValueByPath(t,["sdkHttpResponse"],s);const o=getValueByPath(n,["name"]);o!=null&&setValueByPath(t,["name"],o);const u=getValueByPath(n,["metadata"]);u!=null&&setValueByPath(t,["metadata"],u);const l=getValueByPath(n,["done"]);l!=null&&setValueByPath(t,["done"],l);const m=getValueByPath(n,["error"]);return m!=null&&setValueByPath(t,["error"],m),t}function tuningValidationDatasetToVertex(n,e){const t={},s=getValueByPath(n,["gcsUri"]);s!=null&&setValueByPath(t,["validationDatasetUri"],s);const o=getValueByPath(n,["vertexDatasetResource"]);return o!=null&&setValueByPath(t,["validationDatasetUri"],o),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Tunings extends BaseModule{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Pager(PagedItem.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var s;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const o={tunedModelName:t.baseModel};!((s=t.config)===null||s===void 0)&&s.preTunedModelCheckpointId&&(o.checkpointId=t.config.preTunedModelCheckpointId);const u=Object.assign(Object.assign({},t),{preTunedModel:o});return u.baseModel=void 0,await this.tuneInternal(u)}else{const o=Object.assign({},t);return await this.tuneInternal(o)}else{const o=Object.assign({},t),u=await this.tuneMldevInternal(o);let l="";return u.metadata!==void 0&&u.metadata.tunedModel!==void 0?l=u.metadata.tunedModel:u.name!==void 0&&u.name.includes("/operations/")&&(l=u.name.split("/operations/")[0]),{name:l,state:JobState.JOB_STATE_QUEUED}}}}async getInternal(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=getTuningJobParametersToVertex(e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>tuningJobFromVertex(f))}else{const h=getTuningJobParametersToMldev(e);return m=formatMap("{name}",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>tuningJobFromMldev(f))}}async listInternal(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=listTuningJobsParametersToVertex(e);return m=formatMap("tuningJobs",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=listTuningJobsResponseFromVertex(f),r=new ListTuningJobsResponse;return Object.assign(r,i),r})}else{const h=listTuningJobsParametersToMldev(e);return m=formatMap("tunedModels",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=listTuningJobsResponseFromMldev(f),r=new ListTuningJobsResponse;return Object.assign(r,i),r})}}async cancel(e){var t,s,o,u;let l,m="",g={};if(this.apiClient.isVertexAI()){const h=cancelTuningJobParametersToVertex(e);return m=formatMap("{name}:cancel",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=cancelTuningJobResponseFromVertex(f),r=new CancelTuningJobResponse;return Object.assign(r,i),r})}else{const h=cancelTuningJobParametersToMldev(e);return m=formatMap("{name}:cancel",h._url),g=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:m,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(f=>f.json().then(i=>{const r=i;return r.sdkHttpResponse={headers:f.headers},r})),l.then(f=>{const i=cancelTuningJobResponseFromMldev(f),r=new CancelTuningJobResponse;return Object.assign(r,i),r})}}async tuneInternal(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI()){const m=createTuningJobParametersPrivateToVertex(e,e);return u=formatMap("tuningJobs",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:g.headers},f})),o.then(g=>tuningJobFromVertex(g))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,s;let o,u="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const m=createTuningJobParametersPrivateToMldev(e);return u=formatMap("tunedModels",m._url),l=m._query,delete m._url,delete m._query,o=this.apiClient.request({path:u,queryParams:l,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(g=>g.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:g.headers},f})),o.then(g=>tuningOperationFromMldev(g))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class BrowserDownloader{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const MAX_CHUNK_SIZE=1024*1024*8,MAX_RETRY_COUNT=3,INITIAL_RETRY_DELAY_MS=1e3,DELAY_MULTIPLIER=2,X_GOOG_UPLOAD_STATUS_HEADER_FIELD="x-goog-upload-status";async function uploadBlob(n,e,t){var s;const o=await uploadBlobInternal(n,e,t),u=await o?.json();if(((s=o?.headers)===null||s===void 0?void 0:s[X_GOOG_UPLOAD_STATUS_HEADER_FIELD])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return u.file}async function uploadBlobToFileSearchStore(n,e,t){var s;const o=await uploadBlobInternal(n,e,t),u=await o?.json();if(((s=o?.headers)===null||s===void 0?void 0:s[X_GOOG_UPLOAD_STATUS_HEADER_FIELD])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const l=uploadToFileSearchStoreOperationFromMldev(u),m=new UploadToFileSearchStoreOperation;return Object.assign(m,l),m}async function uploadBlobInternal(n,e,t){var s,o;let u=0,l=0,m=new HttpResponse(new Response),g="upload";for(u=n.size;l<u;){const h=Math.min(MAX_CHUNK_SIZE,u-l),f=n.slice(l,l+h);l+h>=u&&(g+=", finalize");let i=0,r=INITIAL_RETRY_DELAY_MS;for(;i<MAX_RETRY_COUNT&&(m=await t.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":g,"X-Goog-Upload-Offset":String(l),"Content-Length":String(h)}}}),!(!((s=m?.headers)===null||s===void 0)&&s[X_GOOG_UPLOAD_STATUS_HEADER_FIELD]));)i++,await sleep(r),r=r*DELAY_MULTIPLIER;if(l+=h,((o=m?.headers)===null||o===void 0?void 0:o[X_GOOG_UPLOAD_STATUS_HEADER_FIELD])!=="active")break;if(u<=l)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return m}async function getBlobStat(n){return{size:n.size,type:n.type}}function sleep(n){return new Promise(e=>setTimeout(e,n))}class BrowserUploader{async upload(e,t,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await uploadBlob(e,t,s)}async uploadToFileSearchStore(e,t,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await uploadBlobToFileSearchStore(e,t,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await getBlobStat(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class BrowserWebSocketFactory{create(e,t,s){return new BrowserWebSocket(e,t,s)}}class BrowserWebSocket{constructor(e,t,s){this.url=e,this.headers=t,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const GOOGLE_API_KEY_HEADER="x-goog-api-key";class WebAuth{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(GOOGLE_API_KEY_HEADER)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(GOOGLE_API_KEY_HEADER,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const LANGUAGE_LABEL_PREFIX="gl-node/";class GoogleGenAI{get interactions(){if(this._interactions!==void 0)return this._interactions;if(console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions."),this.vertexai)throw new Error("This version of the GenAI SDK does not support Vertex AI API for interactions.");const e=this.httpOptions;e?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const t=new GeminiNextGenAPIClient({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const s=getBaseUrl(e.httpOptions,e.vertexai,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const o=new WebAuth(this.apiKey);this.apiClient=new ApiClient({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:LANGUAGE_LABEL_PREFIX+"web",uploader:new BrowserUploader,downloader:new BrowserDownloader}),this.models=new Models(this.apiClient),this.live=new Live(this.apiClient,o,new BrowserWebSocketFactory),this.batches=new Batches(this.apiClient),this.chats=new Chats(this.models,this.apiClient),this.caches=new Caches(this.apiClient),this.files=new Files(this.apiClient),this.operations=new Operations(this.apiClient),this.authTokens=new Tokens(this.apiClient),this.tunings=new Tunings(this.apiClient),this.fileSearchStores=new FileSearchStores(this.apiClient)}}const STORAGE_KEY$1="idp_system_settings",obfuscate=n=>btoa(n.split("").map((e,t)=>String.fromCharCode(e.charCodeAt(0)^123)).join("")),deobfuscate=n=>{try{return atob(n).split("").map((e,t)=>String.fromCharCode(e.charCodeAt(0)^123)).join("")}catch{return""}},loadSettings=()=>{try{const n=localStorage.getItem(STORAGE_KEY$1);if(n){const e=JSON.parse(n);return e.sapPassword&&(e.sapPassword=deobfuscate(e.sapPassword)),{sapBaseUrl:e.sapBaseUrl||"",customerServicePath:e.customerServicePath||DEFAULT_SAP_PATHS.CUSTOMER_SERVICE,orderServicePath:e.orderServicePath||DEFAULT_SAP_PATHS.ORDER_SERVICE,sapUsername:e.sapUsername||"",sapPassword:e.sapPassword||"",extractionEngine:e.extractionEngine||"gemini-cloud",bypassProxy:e.bypassProxy||!1}}}catch(n){console.error("Failed to load settings",n)}return{sapBaseUrl:"",customerServicePath:DEFAULT_SAP_PATHS.CUSTOMER_SERVICE,orderServicePath:DEFAULT_SAP_PATHS.ORDER_SERVICE,sapUsername:"",sapPassword:"",extractionEngine:"gemini-cloud",bypassProxy:!1}},saveSettings=n=>{try{const e={...n};e.sapPassword&&(e.sapPassword=obfuscate(e.sapPassword)),localStorage.setItem(STORAGE_KEY$1,JSON.stringify(e))}catch(e){throw console.error("Failed to save settings",e),e}},getBasicAuthHeader=n=>n.sapUsername&&n.sapPassword?"Basic "+btoa(n.sapUsername+":"+n.sapPassword):null;var runtime={exports:{}},hasRequiredRuntime;function requireRuntime(){return hasRequiredRuntime||(hasRequiredRuntime=1,(function(n){var e=(function(t){var s=Object.prototype,o=s.hasOwnProperty,u=Object.defineProperty||function(ee,ce,q){ee[ce]=q.value},l,m=typeof Symbol=="function"?Symbol:{},g=m.iterator||"@@iterator",h=m.asyncIterator||"@@asyncIterator",f=m.toStringTag||"@@toStringTag";function i(ee,ce,q){return Object.defineProperty(ee,ce,{value:q,enumerable:!0,configurable:!0,writable:!0}),ee[ce]}try{i({},"")}catch{i=function(ce,q,le){return ce[q]=le}}function r(ee,ce,q,le){var be=ce&&ce.prototype instanceof w?ce:w,xe=Object.create(be.prototype),Ee=new k(le||[]);return u(xe,"_invoke",{value:se(ee,q,Ee)}),xe}t.wrap=r;function d(ee,ce,q){try{return{type:"normal",arg:ee.call(ce,q)}}catch(le){return{type:"throw",arg:le}}}var p="suspendedStart",_="suspendedYield",y="executing",v="completed",T={};function w(){}function E(){}function P(){}var R={};i(R,g,function(){return this});var I=Object.getPrototypeOf,N=I&&I(I(H([])));N&&N!==s&&o.call(N,g)&&(R=N);var B=P.prototype=w.prototype=Object.create(R);E.prototype=P,u(B,"constructor",{value:P,configurable:!0}),u(P,"constructor",{value:E,configurable:!0}),E.displayName=i(P,f,"GeneratorFunction");function D(ee){["next","throw","return"].forEach(function(ce){i(ee,ce,function(q){return this._invoke(ce,q)})})}t.isGeneratorFunction=function(ee){var ce=typeof ee=="function"&&ee.constructor;return ce?ce===E||(ce.displayName||ce.name)==="GeneratorFunction":!1},t.mark=function(ee){return Object.setPrototypeOf?Object.setPrototypeOf(ee,P):(ee.__proto__=P,i(ee,f,"GeneratorFunction")),ee.prototype=Object.create(B),ee},t.awrap=function(ee){return{__await:ee}};function Y(ee,ce){function q(xe,Ee,we,U){var L=d(ee[xe],ee,Ee);if(L.type==="throw")U(L.arg);else{var M=L.arg,C=M.value;return C&&typeof C=="object"&&o.call(C,"__await")?ce.resolve(C.__await).then(function(V){q("next",V,we,U)},function(V){q("throw",V,we,U)}):ce.resolve(C).then(function(V){M.value=V,we(M)},function(V){return q("throw",V,we,U)})}}var le;function be(xe,Ee){function we(){return new ce(function(U,L){q(xe,Ee,U,L)})}return le=le?le.then(we,we):we()}u(this,"_invoke",{value:be})}D(Y.prototype),i(Y.prototype,h,function(){return this}),t.AsyncIterator=Y,t.async=function(ee,ce,q,le,be){be===void 0&&(be=Promise);var xe=new Y(r(ee,ce,q,le),be);return t.isGeneratorFunction(ce)?xe:xe.next().then(function(Ee){return Ee.done?Ee.value:xe.next()})};function se(ee,ce,q){var le=p;return function(xe,Ee){if(le===y)throw new Error("Generator is already running");if(le===v){if(xe==="throw")throw Ee;return de()}for(q.method=xe,q.arg=Ee;;){var we=q.delegate;if(we){var U=re(we,q);if(U){if(U===T)continue;return U}}if(q.method==="next")q.sent=q._sent=q.arg;else if(q.method==="throw"){if(le===p)throw le=v,q.arg;q.dispatchException(q.arg)}else q.method==="return"&&q.abrupt("return",q.arg);le=y;var L=d(ee,ce,q);if(L.type==="normal"){if(le=q.done?v:_,L.arg===T)continue;return{value:L.arg,done:q.done}}else L.type==="throw"&&(le=v,q.method="throw",q.arg=L.arg)}}}function re(ee,ce){var q=ce.method,le=ee.iterator[q];if(le===l)return ce.delegate=null,q==="throw"&&ee.iterator.return&&(ce.method="return",ce.arg=l,re(ee,ce),ce.method==="throw")||q!=="return"&&(ce.method="throw",ce.arg=new TypeError("The iterator does not provide a '"+q+"' method")),T;var be=d(le,ee.iterator,ce.arg);if(be.type==="throw")return ce.method="throw",ce.arg=be.arg,ce.delegate=null,T;var xe=be.arg;if(!xe)return ce.method="throw",ce.arg=new TypeError("iterator result is not an object"),ce.delegate=null,T;if(xe.done)ce[ee.resultName]=xe.value,ce.next=ee.nextLoc,ce.method!=="return"&&(ce.method="next",ce.arg=l);else return xe;return ce.delegate=null,T}D(B),i(B,f,"Generator"),i(B,g,function(){return this}),i(B,"toString",function(){return"[object Generator]"});function W(ee){var ce={tryLoc:ee[0]};1 in ee&&(ce.catchLoc=ee[1]),2 in ee&&(ce.finallyLoc=ee[2],ce.afterLoc=ee[3]),this.tryEntries.push(ce)}function $(ee){var ce=ee.completion||{};ce.type="normal",delete ce.arg,ee.completion=ce}function k(ee){this.tryEntries=[{tryLoc:"root"}],ee.forEach(W,this),this.reset(!0)}t.keys=function(ee){var ce=Object(ee),q=[];for(var le in ce)q.push(le);return q.reverse(),function be(){for(;q.length;){var xe=q.pop();if(xe in ce)return be.value=xe,be.done=!1,be}return be.done=!0,be}};function H(ee){if(ee){var ce=ee[g];if(ce)return ce.call(ee);if(typeof ee.next=="function")return ee;if(!isNaN(ee.length)){var q=-1,le=function be(){for(;++q<ee.length;)if(o.call(ee,q))return be.value=ee[q],be.done=!1,be;return be.value=l,be.done=!0,be};return le.next=le}}return{next:de}}t.values=H;function de(){return{value:l,done:!0}}return k.prototype={constructor:k,reset:function(ee){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach($),!ee)for(var ce in this)ce.charAt(0)==="t"&&o.call(this,ce)&&!isNaN(+ce.slice(1))&&(this[ce]=l)},stop:function(){this.done=!0;var ee=this.tryEntries[0],ce=ee.completion;if(ce.type==="throw")throw ce.arg;return this.rval},dispatchException:function(ee){if(this.done)throw ee;var ce=this;function q(U,L){return xe.type="throw",xe.arg=ee,ce.next=U,L&&(ce.method="next",ce.arg=l),!!L}for(var le=this.tryEntries.length-1;le>=0;--le){var be=this.tryEntries[le],xe=be.completion;if(be.tryLoc==="root")return q("end");if(be.tryLoc<=this.prev){var Ee=o.call(be,"catchLoc"),we=o.call(be,"finallyLoc");if(Ee&&we){if(this.prev<be.catchLoc)return q(be.catchLoc,!0);if(this.prev<be.finallyLoc)return q(be.finallyLoc)}else if(Ee){if(this.prev<be.catchLoc)return q(be.catchLoc,!0)}else if(we){if(this.prev<be.finallyLoc)return q(be.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(ee,ce){for(var q=this.tryEntries.length-1;q>=0;--q){var le=this.tryEntries[q];if(le.tryLoc<=this.prev&&o.call(le,"finallyLoc")&&this.prev<le.finallyLoc){var be=le;break}}be&&(ee==="break"||ee==="continue")&&be.tryLoc<=ce&&ce<=be.finallyLoc&&(be=null);var xe=be?be.completion:{};return xe.type=ee,xe.arg=ce,be?(this.method="next",this.next=be.finallyLoc,T):this.complete(xe)},complete:function(ee,ce){if(ee.type==="throw")throw ee.arg;return ee.type==="break"||ee.type==="continue"?this.next=ee.arg:ee.type==="return"?(this.rval=this.arg=ee.arg,this.method="return",this.next="end"):ee.type==="normal"&&ce&&(this.next=ce),T},finish:function(ee){for(var ce=this.tryEntries.length-1;ce>=0;--ce){var q=this.tryEntries[ce];if(q.finallyLoc===ee)return this.complete(q.completion,q.afterLoc),$(q),T}},catch:function(ee){for(var ce=this.tryEntries.length-1;ce>=0;--ce){var q=this.tryEntries[ce];if(q.tryLoc===ee){var le=q.completion;if(le.type==="throw"){var be=le.arg;$(q)}return be}}throw new Error("illegal catch attempt")},delegateYield:function(ee,ce,q){return this.delegate={iterator:H(ee),resultName:ce,nextLoc:q},this.method==="next"&&(this.arg=l),T}},t})(n.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(runtime)),runtime.exports}var getId,hasRequiredGetId;function requireGetId(){return hasRequiredGetId||(hasRequiredGetId=1,getId=(n,e)=>`${n}-${e}-${Math.random().toString(16).slice(3,8)}`),getId}var createJob,hasRequiredCreateJob;function requireCreateJob(){if(hasRequiredCreateJob)return createJob;hasRequiredCreateJob=1;const n=requireGetId();let e=0;return createJob=({id:t,action:s,payload:o={}})=>{let u=t;return typeof u>"u"&&(u=n("Job",e),e+=1),{id:u,action:s,payload:o}},createJob}var log={},hasRequiredLog;function requireLog(){if(hasRequiredLog)return log;hasRequiredLog=1;let n=!1;return log.logging=n,log.setLogging=e=>{n=e},log.log=(...e)=>n?console.log.apply(this,e):null,log}var createScheduler,hasRequiredCreateScheduler;function requireCreateScheduler(){if(hasRequiredCreateScheduler)return createScheduler;hasRequiredCreateScheduler=1;const n=requireCreateJob(),{log:e}=requireLog(),t=requireGetId();let s=0;return createScheduler=()=>{const o=t("Scheduler",s),u={},l={};let m=[];s+=1;const g=()=>m.length,h=()=>Object.keys(u).length,f=()=>{if(m.length!==0){const _=Object.keys(u);for(let y=0;y<_.length;y+=1)if(typeof l[_[y]]>"u"){m[0](u[_[y]]);break}}},i=(_,y)=>new Promise((v,T)=>{const w=n({action:_,payload:y});m.push(async E=>{m.shift(),l[E.id]=w;try{v(await E[_].apply(this,[...y,w.id]))}catch(P){T(P)}finally{delete l[E.id],f()}}),e(`[${o}]: Add ${w.id} to JobQueue`),e(`[${o}]: JobQueue length=${m.length}`),f()});return{addWorker:_=>(u[_.id]=_,e(`[${o}]: Add ${_.id}`),e(`[${o}]: Number of workers=${h()}`),f(),_.id),addJob:async(_,...y)=>{if(h()===0)throw Error(`[${o}]: You need to have at least one worker before adding jobs`);return i(_,y)},terminate:async()=>{Object.keys(u).forEach(async _=>{await u[_].terminate()}),m=[]},getQueueLen:g,getNumWorkers:h}},createScheduler}function commonjsRequire(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var isElectron_1,hasRequiredIsElectron;function requireIsElectron(){if(hasRequiredIsElectron)return isElectron_1;hasRequiredIsElectron=1;function n(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}return isElectron_1=n,isElectron_1}var getEnvironment,hasRequiredGetEnvironment;function requireGetEnvironment(){if(hasRequiredGetEnvironment)return getEnvironment;hasRequiredGetEnvironment=1;const n=requireIsElectron();return getEnvironment=e=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":n()?t.type="electron":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof commonjsRequire=="function"&&(t.type="node"),typeof e>"u"?t:t[e]},getEnvironment}var resolvePaths,hasRequiredResolvePaths;function requireResolvePaths(){if(hasRequiredResolvePaths)return resolvePaths;hasRequiredResolvePaths=1;const e=requireGetEnvironment()("type")==="browser"?t=>new URL(t,window.location.href).href:t=>t;return resolvePaths=t=>{const s={...t};return["corePath","workerPath","langPath"].forEach(o=>{t[o]&&(s[o]=e(s[o]))}),s},resolvePaths}var circularize,hasRequiredCircularize;function requireCircularize(){return hasRequiredCircularize||(hasRequiredCircularize=1,circularize=n=>{const e=[],t=[],s=[],o=[],u=[];return n.blocks&&n.blocks.forEach(l=>{l.paragraphs.forEach(m=>{m.lines.forEach(g=>{g.words.forEach(h=>{h.symbols.forEach(f=>{u.push({...f,page:n,block:l,paragraph:m,line:g,word:h})}),o.push({...h,page:n,block:l,paragraph:m,line:g})}),s.push({...g,page:n,block:l,paragraph:m})}),t.push({...m,page:n,block:l})}),e.push({...l,page:n})}),{...n,blocks:e,paragraphs:t,lines:s,words:o,symbols:u}}),circularize}var OEM,hasRequiredOEM;function requireOEM(){return hasRequiredOEM||(hasRequiredOEM=1,OEM={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3}),OEM}const version="5.1.1",require$$0$1={version};var defaultOptions,hasRequiredDefaultOptions$1;function requireDefaultOptions$1(){return hasRequiredDefaultOptions$1||(hasRequiredDefaultOptions$1=1,defaultOptions={workerBlobURL:!0,logger:()=>{}}),defaultOptions}var defaultOptions_1,hasRequiredDefaultOptions;function requireDefaultOptions(){if(hasRequiredDefaultOptions)return defaultOptions_1;hasRequiredDefaultOptions=1;const n=require$$0$1.version;return defaultOptions_1={...requireDefaultOptions$1(),workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${n}/dist/worker.min.js`},defaultOptions_1}var spawnWorker,hasRequiredSpawnWorker;function requireSpawnWorker(){return hasRequiredSpawnWorker||(hasRequiredSpawnWorker=1,spawnWorker=({workerPath:n,workerBlobURL:e})=>{let t;if(Blob&&URL&&e){const s=new Blob([`importScripts("${n}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(s))}else t=new Worker(n);return t}),spawnWorker}var terminateWorker,hasRequiredTerminateWorker;function requireTerminateWorker(){return hasRequiredTerminateWorker||(hasRequiredTerminateWorker=1,terminateWorker=n=>{n.terminate()}),terminateWorker}var onMessage,hasRequiredOnMessage;function requireOnMessage(){return hasRequiredOnMessage||(hasRequiredOnMessage=1,onMessage=(n,e)=>{n.onmessage=({data:t})=>{e(t)}}),onMessage}var send,hasRequiredSend;function requireSend(){return hasRequiredSend||(hasRequiredSend=1,send=async(n,e)=>{n.postMessage(e)}),send}var loadImage_1,hasRequiredLoadImage;function requireLoadImage(){if(hasRequiredLoadImage)return loadImage_1;hasRequiredLoadImage=1;const n=t=>new Promise((s,o)=>{const u=new FileReader;u.onload=()=>{s(u.result)},u.onerror=({target:{error:{code:l}}})=>{o(Error(`File could not be read! Code=${l}`))},u.readAsArrayBuffer(t)}),e=async t=>{let s=t;if(typeof t>"u")return"undefined";if(typeof t=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(t)?s=atob(t.split(",")[1]).split("").map(o=>o.charCodeAt(0)):s=await(await fetch(t)).arrayBuffer();else if(typeof HTMLElement<"u"&&t instanceof HTMLElement)t.tagName==="IMG"&&(s=await e(t.src)),t.tagName==="VIDEO"&&(s=await e(t.poster)),t.tagName==="CANVAS"&&await new Promise(o=>{t.toBlob(async u=>{s=await n(u),o()})});else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas){const o=await t.convertToBlob();s=await n(o)}else(t instanceof File||t instanceof Blob)&&(s=await n(t));return new Uint8Array(s)};return loadImage_1=e,loadImage_1}var browser,hasRequiredBrowser;function requireBrowser(){if(hasRequiredBrowser)return browser;hasRequiredBrowser=1;const n=requireDefaultOptions(),e=requireSpawnWorker(),t=requireTerminateWorker(),s=requireOnMessage(),o=requireSend(),u=requireLoadImage();return browser={defaultOptions:n,spawnWorker:e,terminateWorker:t,onMessage:s,send:o,loadImage:u},browser}var createWorker,hasRequiredCreateWorker;function requireCreateWorker(){if(hasRequiredCreateWorker)return createWorker;hasRequiredCreateWorker=1;const n=requireResolvePaths(),e=requireCircularize(),t=requireCreateJob(),{log:s}=requireLog(),o=requireGetId(),u=requireOEM(),{defaultOptions:l,spawnWorker:m,terminateWorker:g,onMessage:h,loadImage:f,send:i}=requireBrowser();let r=0;return createWorker=async(d="eng",p=u.LSTM_ONLY,_={},y={})=>{const v=o("Worker",r),{logger:T,errorHandler:w,...E}=n({...l,..._}),P={},R={},I=typeof d=="string"?d.split("+"):d;let N=p,B=y;const D=[u.DEFAULT,u.LSTM_ONLY].includes(p)&&!E.legacyCore;let Y,se;const re=new Promise((X,ne)=>{se=X,Y=ne}),W=X=>{Y(X.message)};let $=m(E);$.onerror=W,r+=1;const k=(X,ne)=>{P[X]=ne},H=(X,ne)=>{R[X]=ne},de=({id:X,action:ne,payload:ie})=>new Promise((fe,ye)=>{s(`[${v}]: Start ${X}, action=${ne}`);const pe=`${ne}-${X}`;k(pe,fe),H(pe,ye),i($,{workerId:v,jobId:X,action:ne,payload:ie})}),ee=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),ce=X=>de(t({id:X,action:"load",payload:{options:{lstmOnly:D,corePath:E.corePath,logging:E.logging}}})),q=(X,ne,ie)=>de(t({id:ie,action:"FS",payload:{method:"writeFile",args:[X,ne]}})),le=(X,ne)=>de(t({id:ne,action:"FS",payload:{method:"readFile",args:[X,{encoding:"utf8"}]}})),be=(X,ne)=>de(t({id:ne,action:"FS",payload:{method:"unlink",args:[X]}})),xe=(X,ne,ie)=>de(t({id:ie,action:"FS",payload:{method:X,args:ne}})),Ee=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),we=(X,ne)=>de(t({id:ne,action:"loadLanguage",payload:{langs:X,options:{langPath:E.langPath,dataPath:E.dataPath,cachePath:E.cachePath,cacheMethod:E.cacheMethod,gzip:E.gzip,lstmOnly:[u.DEFAULT,u.LSTM_ONLY].includes(N)&&!E.legacyLang}}})),U=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),L=(X,ne,ie,fe)=>de(t({id:fe,action:"initialize",payload:{langs:X,oem:ne,config:ie}})),M=(X="eng",ne,ie,fe)=>{if(D&&[u.TESSERACT_ONLY,u.TESSERACT_LSTM_COMBINED].includes(ne))throw Error("Legacy model requested but code missing.");const ye=ne||N;N=ye;const pe=ie||B;B=pe;const ue=(typeof X=="string"?X.split("+"):X).filter(Ie=>!I.includes(Ie));return I.push(...ue),ue.length>0?we(ue,fe).then(()=>L(X,ye,pe,fe)):L(X,ye,pe,fe)},C=(X={},ne)=>de(t({id:ne,action:"setParameters",payload:{params:X}})),V=async(X,ne={},ie={blocks:!0,text:!0,hocr:!0,tsv:!0},fe)=>de(t({id:fe,action:"recognize",payload:{image:await f(X),options:ne,output:ie}})),O=(X="Tesseract OCR Result",ne=!1,ie)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),de(t({id:ie,action:"getPDF",payload:{title:X,textonly:ne}}))),z=async(X,ne)=>{if(D)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return de(t({id:ne,action:"detect",payload:{image:await f(X)}}))},j=async()=>($!==null&&(g($),$=null),Promise.resolve());h($,({workerId:X,jobId:ne,status:ie,action:fe,data:ye})=>{const pe=`${fe}-${ne}`;if(ie==="resolve"){s(`[${X}]: Complete ${ne}`);let te=ye;fe==="recognize"?te=e(ye):fe==="getPDF"&&(te=Array.from({...ye,length:Object.keys(ye).length})),P[pe]({jobId:ne,data:te})}else if(ie==="reject")if(R[pe](ye),fe==="load"&&Y(ye),w)w(ye);else throw Error(ye);else ie==="progress"&&T({...ye,userJobId:ne})});const J={id:v,worker:$,setResolve:k,setReject:H,load:ee,writeText:q,readText:le,removeFile:be,FS:xe,loadLanguage:Ee,initialize:U,reinitialize:M,setParameters:C,recognize:V,getPDF:O,detect:z,terminate:j};return ce().then(()=>we(d)).then(()=>L(d,p,y)).then(()=>se(J)).catch(()=>{}),re},createWorker}var Tesseract$1,hasRequiredTesseract;function requireTesseract(){if(hasRequiredTesseract)return Tesseract$1;hasRequiredTesseract=1;const n=requireCreateWorker();return Tesseract$1={recognize:async(s,o,u)=>{const l=await n(o,1,u);return l.recognize(s).finally(async()=>{await l.terminate()})},detect:async(s,o)=>{const u=await n("osd",0,o);return u.detect(s).finally(async()=>{await u.terminate()})}},Tesseract$1}var languages,hasRequiredLanguages;function requireLanguages(){return hasRequiredLanguages||(hasRequiredLanguages=1,languages={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"}),languages}var PSM,hasRequiredPSM;function requirePSM(){return hasRequiredPSM||(hasRequiredPSM=1,PSM={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"}),PSM}var src,hasRequiredSrc;function requireSrc(){if(hasRequiredSrc)return src;hasRequiredSrc=1,requireRuntime();const n=requireCreateScheduler(),e=requireCreateWorker(),t=requireTesseract(),s=requireLanguages(),o=requireOEM(),u=requirePSM(),{setLogging:l}=requireLog();return src={languages:s,OEM:o,PSM:u,createScheduler:n,createWorker:e,setLogging:l,...t},src}var srcExports=requireSrc();const Tesseract=getDefaultExportFromCjs(srcExports),scriptRel="modulepreload",assetsURL=function(n){return"/"+n},seen={},__vitePreload=function(e,t,s){let o=Promise.resolve();if(t&&t.length>0){let l=function(h){return Promise.all(h.map(f=>Promise.resolve(f).then(i=>({status:"fulfilled",value:i}),i=>({status:"rejected",reason:i}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),g=m?.nonce||m?.getAttribute("nonce");o=l(t.map(h=>{if(h=assetsURL(h),h in seen)return;seen[h]=!0;const f=h.endsWith(".css"),i=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${i}`))return;const r=document.createElement("link");if(r.rel=f?"stylesheet":scriptRel,f||(r.as="script"),r.crossOrigin="",r.href=h,g&&r.setAttribute("nonce",g),document.head.appendChild(r),f)return new Promise((d,p)=>{r.addEventListener("load",d),r.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${h}`)))})}))}function u(l){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=l,window.dispatchEvent(m),!m.defaultPrevented)throw l}return o.then(l=>{for(const m of l||[])m.status==="rejected"&&u(m.reason);return e().catch(u)})};var __webpack_modules__={640:((n,e,t)=>{t.d(e,{AnnotationLayer:()=>Ee,FreeTextAnnotationElement:()=>Y,InkAnnotationElement:()=>de,StampAnnotationElement:()=>be});var s=t(266),o=t(473),u=t(780);function l(we){return Math.floor(Math.max(0,Math.min(1,we))*255).toString(16).padStart(2,"0")}function m(we){return Math.max(0,Math.min(255,255*we))}class g{static CMYK_G([U,L,M,C]){return["G",1-Math.min(1,.3*U+.59*M+.11*L+C)]}static G_CMYK([U]){return["CMYK",0,0,0,1-U]}static G_RGB([U]){return["RGB",U,U,U]}static G_rgb([U]){return U=m(U),[U,U,U]}static G_HTML([U]){const L=l(U);return`#${L}${L}${L}`}static RGB_G([U,L,M]){return["G",.3*U+.59*L+.11*M]}static RGB_rgb(U){return U.map(m)}static RGB_HTML(U){return`#${U.map(l).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([U,L,M,C]){return["RGB",1-Math.min(1,U+C),1-Math.min(1,M+C),1-Math.min(1,L+C)]}static CMYK_rgb([U,L,M,C]){return[m(1-Math.min(1,U+C)),m(1-Math.min(1,M+C)),m(1-Math.min(1,L+C))]}static CMYK_HTML(U){const L=this.CMYK_RGB(U).slice(1);return this.RGB_HTML(L)}static RGB_CMYK([U,L,M]){const C=1-U,V=1-L,O=1-M,z=Math.min(C,V,O);return["CMYK",C,V,O,z]}}var h=t(160);const f=1e3,i=9,r=new WeakSet;function d(we){return{width:we[2]-we[0],height:we[3]-we[1]}}class p{static create(U){switch(U.data.annotationType){case s.AnnotationType.LINK:return new y(U);case s.AnnotationType.TEXT:return new v(U);case s.AnnotationType.WIDGET:switch(U.data.fieldType){case"Tx":return new w(U);case"Btn":return U.data.radioButton?new R(U):U.data.checkBox?new P(U):new I(U);case"Ch":return new N(U);case"Sig":return new E(U)}return new T(U);case s.AnnotationType.POPUP:return new B(U);case s.AnnotationType.FREETEXT:return new Y(U);case s.AnnotationType.LINE:return new se(U);case s.AnnotationType.SQUARE:return new re(U);case s.AnnotationType.CIRCLE:return new W(U);case s.AnnotationType.POLYLINE:return new $(U);case s.AnnotationType.CARET:return new H(U);case s.AnnotationType.INK:return new de(U);case s.AnnotationType.POLYGON:return new k(U);case s.AnnotationType.HIGHLIGHT:return new ee(U);case s.AnnotationType.UNDERLINE:return new ce(U);case s.AnnotationType.SQUIGGLY:return new q(U);case s.AnnotationType.STRIKEOUT:return new le(U);case s.AnnotationType.STAMP:return new be(U);case s.AnnotationType.FILEATTACHMENT:return new xe(U);default:return new _(U)}}}class _{#e=!1;constructor(U,{isRenderable:L=!1,ignoreBorder:M=!1,createQuadrilaterals:C=!1}={}){this.isRenderable=L,this.data=U.data,this.layer=U.layer,this.linkService=U.linkService,this.downloadManager=U.downloadManager,this.imageResourcesPath=U.imageResourcesPath,this.renderForms=U.renderForms,this.svgFactory=U.svgFactory,this.annotationStorage=U.annotationStorage,this.enableScripting=U.enableScripting,this.hasJSActions=U.hasJSActions,this._fieldObjects=U.fieldObjects,this.parent=U.parent,L&&(this.container=this._createContainer(M)),C&&this._createQuadrilaterals()}static _hasPopupData({titleObj:U,contentsObj:L,richText:M}){return!!(U?.str||L?.str||M?.str)}get hasPopupData(){return _._hasPopupData(this.data)}_createContainer(U){const{data:L,parent:{page:M,viewport:C}}=this,V=document.createElement("section");V.setAttribute("data-annotation-id",L.id),this instanceof T||(V.tabIndex=f),V.style.zIndex=this.parent.zIndex++,this.data.popupRef&&V.setAttribute("aria-haspopup","dialog"),L.noRotate&&V.classList.add("norotate");const{pageWidth:O,pageHeight:z,pageX:j,pageY:J}=C.rawDims;if(!L.rect||this instanceof B){const{rotation:ye}=L;return!L.hasOwnCanvas&&ye!==0&&this.setRotation(ye,V),V}const{width:X,height:ne}=d(L.rect),ie=s.Util.normalizeRect([L.rect[0],M.view[3]-L.rect[1]+M.view[1],L.rect[2],M.view[3]-L.rect[3]+M.view[1]]);if(!U&&L.borderStyle.width>0){V.style.borderWidth=`${L.borderStyle.width}px`;const ye=L.borderStyle.horizontalCornerRadius,pe=L.borderStyle.verticalCornerRadius;if(ye>0||pe>0){const ue=`calc(${ye}px * var(--scale-factor)) / calc(${pe}px * var(--scale-factor))`;V.style.borderRadius=ue}else if(this instanceof R){const ue=`calc(${X}px * var(--scale-factor)) / calc(${ne}px * var(--scale-factor))`;V.style.borderRadius=ue}switch(L.borderStyle.style){case s.AnnotationBorderStyleType.SOLID:V.style.borderStyle="solid";break;case s.AnnotationBorderStyleType.DASHED:V.style.borderStyle="dashed";break;case s.AnnotationBorderStyleType.BEVELED:(0,s.warn)("Unimplemented border style: beveled");break;case s.AnnotationBorderStyleType.INSET:(0,s.warn)("Unimplemented border style: inset");break;case s.AnnotationBorderStyleType.UNDERLINE:V.style.borderBottomStyle="solid";break}const te=L.borderColor||null;te?(this.#e=!0,V.style.borderColor=s.Util.makeHexColor(te[0]|0,te[1]|0,te[2]|0)):V.style.borderWidth=0}V.style.left=`${100*(ie[0]-j)/O}%`,V.style.top=`${100*(ie[1]-J)/z}%`;const{rotation:fe}=L;return L.hasOwnCanvas||fe===0?(V.style.width=`${100*X/O}%`,V.style.height=`${100*ne/z}%`):this.setRotation(fe,V),V}setRotation(U,L=this.container){if(!this.data.rect)return;const{pageWidth:M,pageHeight:C}=this.parent.viewport.rawDims,{width:V,height:O}=d(this.data.rect);let z,j;U%180===0?(z=100*V/M,j=100*O/C):(z=100*O/M,j=100*V/C),L.style.width=`${z}%`,L.style.height=`${j}%`,L.setAttribute("data-main-rotation",(360-U)%360)}get _commonActions(){const U=(L,M,C)=>{const V=C.detail[L],O=V[0],z=V.slice(1);C.target.style[M]=g[`${O}_HTML`](z),this.annotationStorage.setValue(this.data.id,{[M]:g[`${O}_rgb`](z)})};return(0,s.shadow)(this,"_commonActions",{display:L=>{const{display:M}=L.detail,C=M%2===1;this.container.style.visibility=C?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:C,noPrint:M===1||M===2})},print:L=>{this.annotationStorage.setValue(this.data.id,{noPrint:!L.detail.print})},hidden:L=>{const{hidden:M}=L.detail;this.container.style.visibility=M?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:M,noView:M})},focus:L=>{setTimeout(()=>L.target.focus({preventScroll:!1}),0)},userName:L=>{L.target.title=L.detail.userName},readonly:L=>{L.target.disabled=L.detail.readonly},required:L=>{this._setRequired(L.target,L.detail.required)},bgColor:L=>{U("bgColor","backgroundColor",L)},fillColor:L=>{U("fillColor","backgroundColor",L)},fgColor:L=>{U("fgColor","color",L)},textColor:L=>{U("textColor","color",L)},borderColor:L=>{U("borderColor","borderColor",L)},strokeColor:L=>{U("strokeColor","borderColor",L)},rotation:L=>{const M=L.detail.rotation;this.setRotation(M),this.annotationStorage.setValue(this.data.id,{rotation:M})}})}_dispatchEventFromSandbox(U,L){const M=this._commonActions;for(const C of Object.keys(L.detail))(U[C]||M[C])?.(L)}_setDefaultPropertiesFromJS(U){if(!this.enableScripting)return;const L=this.annotationStorage.getRawValue(this.data.id);if(!L)return;const M=this._commonActions;for(const[C,V]of Object.entries(L)){const O=M[C];if(O){const z={detail:{[C]:V},target:U};O(z),delete L[C]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:U}=this.data;if(!U)return;const[L,M,C,V]=this.data.rect;if(U.length===1){const[,{x:pe,y:te},{x:ue,y:Ie}]=U[0];if(C===pe&&V===te&&L===ue&&M===Ie)return}const{style:O}=this.container;let z;if(this.#e){const{borderColor:pe,borderWidth:te}=O;O.borderWidth=0,z=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${pe}" stroke-width="${te}">`],this.container.classList.add("hasBorder")}const j=C-L,J=V-M,{svgFactory:X}=this,ne=X.createElement("svg");ne.classList.add("quadrilateralsContainer"),ne.setAttribute("width",0),ne.setAttribute("height",0);const ie=X.createElement("defs");ne.append(ie);const fe=X.createElement("clipPath"),ye=`clippath_${this.data.id}`;fe.setAttribute("id",ye),fe.setAttribute("clipPathUnits","objectBoundingBox"),ie.append(fe);for(const[,{x:pe,y:te},{x:ue,y:Ie}]of U){const ae=X.createElement("rect"),De=(ue-L)/j,ze=(V-te)/J,Ge=(pe-ue)/j,He=(te-Ie)/J;ae.setAttribute("x",De),ae.setAttribute("y",ze),ae.setAttribute("width",Ge),ae.setAttribute("height",He),fe.append(ae),z?.push(`<rect vector-effect="non-scaling-stroke" x="${De}" y="${ze}" width="${Ge}" height="${He}"/>`)}this.#e&&(z.push("</g></svg>')"),O.backgroundImage=z.join("")),this.container.append(ne),this.container.style.clipPath=`url(#${ye})`}_createPopup(){const{container:U,data:L}=this;U.setAttribute("aria-haspopup","dialog");const M=new B({data:{color:L.color,titleObj:L.titleObj,modificationDate:L.modificationDate,contentsObj:L.contentsObj,richText:L.richText,parentRect:L.rect,borderStyle:0,id:`popup_${L.id}`,rotation:L.rotation},parent:this.parent,elements:[this]});this.parent.div.append(M.render())}render(){(0,s.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(U,L=null){const M=[];if(this._fieldObjects){const C=this._fieldObjects[U];if(C)for(const{page:V,id:O,exportValues:z}of C){if(V===-1||O===L)continue;const j=typeof z=="string"?z:null,J=document.querySelector(`[data-element-id="${O}"]`);if(J&&!r.has(J)){(0,s.warn)(`_getElementsByName - element not allowed: ${O}`);continue}M.push({id:O,exportValue:j,domElement:J})}return M}for(const C of document.getElementsByName(U)){const{exportValue:V}=C,O=C.getAttribute("data-element-id");O!==L&&r.has(C)&&M.push({id:O,exportValue:V,domElement:C})}return M}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const U=this.getElementsToTriggerPopup();if(Array.isArray(U))for(const L of U)L.classList.add("highlightArea");else U.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:U,data:{id:L}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:U,editId:L})})}}class y extends _{constructor(U,L=null){super(U,{isRenderable:!0,ignoreBorder:!!L?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=U.data.isTooltipOnly}render(){const{data:U,linkService:L}=this,M=document.createElement("a");M.setAttribute("data-element-id",U.id);let C=!1;return U.url?(L.addLinkAttributes(M,U.url,U.newWindow),C=!0):U.action?(this._bindNamedAction(M,U.action),C=!0):U.attachment?(this.#t(M,U.attachment,U.attachmentDest),C=!0):U.setOCGState?(this.#n(M,U.setOCGState),C=!0):U.dest?(this._bindLink(M,U.dest),C=!0):(U.actions&&(U.actions.Action||U.actions["Mouse Up"]||U.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(M,U),C=!0),U.resetForm?(this._bindResetFormAction(M,U.resetForm),C=!0):this.isTooltipOnly&&!C&&(this._bindLink(M,""),C=!0)),this.container.classList.add("linkAnnotation"),C&&this.container.append(M),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(U,L){U.href=this.linkService.getDestinationHash(L),U.onclick=()=>(L&&this.linkService.goToDestination(L),!1),(L||L==="")&&this.#e()}_bindNamedAction(U,L){U.href=this.linkService.getAnchorUrl(""),U.onclick=()=>(this.linkService.executeNamedAction(L),!1),this.#e()}#t(U,L,M=null){U.href=this.linkService.getAnchorUrl(""),U.onclick=()=>(this.downloadManager?.openOrDownloadData(L.content,L.filename,M),!1),this.#e()}#n(U,L){U.href=this.linkService.getAnchorUrl(""),U.onclick=()=>(this.linkService.executeSetOCGState(L),!1),this.#e()}_bindJSAction(U,L){U.href=this.linkService.getAnchorUrl("");const M=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const C of Object.keys(L.actions)){const V=M.get(C);V&&(U[V]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:L.id,name:C}}),!1))}U.onclick||(U.onclick=()=>!1),this.#e()}_bindResetFormAction(U,L){const M=U.onclick;if(M||(U.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){(0,s.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),M||(U.onclick=()=>!1);return}U.onclick=()=>{M?.();const{fields:C,refs:V,include:O}=L,z=[];if(C.length!==0||V.length!==0){const X=new Set(V);for(const ne of C){const ie=this._fieldObjects[ne]||[];for(const{id:fe}of ie)X.add(fe)}for(const ne of Object.values(this._fieldObjects))for(const ie of ne)X.has(ie.id)===O&&z.push(ie)}else for(const X of Object.values(this._fieldObjects))z.push(...X);const j=this.annotationStorage,J=[];for(const X of z){const{id:ne}=X;switch(J.push(ne),X.type){case"text":{const fe=X.defaultValue||"";j.setValue(ne,{value:fe});break}case"checkbox":case"radiobutton":{const fe=X.defaultValue===X.exportValues;j.setValue(ne,{value:fe});break}case"combobox":case"listbox":{const fe=X.defaultValue||"";j.setValue(ne,{value:fe});break}default:continue}const ie=document.querySelector(`[data-element-id="${ne}"]`);if(ie){if(!r.has(ie)){(0,s.warn)(`_bindResetFormAction - element not allowed: ${ne}`);continue}}else continue;ie.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:J,name:"ResetForm"}}),!1}}}class v extends _{constructor(U){super(U,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const U=document.createElement("img");return U.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",U.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),U.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(U),this.container}}class T extends _{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(U){this.data.hasOwnCanvas&&(U.previousSibling?.nodeName==="CANVAS"&&(U.previousSibling.hidden=!0),U.hidden=!1)}_getKeyModifier(U){return s.FeatureTest.platform.isMac?U.metaKey:U.ctrlKey}_setEventListener(U,L,M,C,V){M.includes("mouse")?U.addEventListener(M,O=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:C,value:V(O),shift:O.shiftKey,modifier:this._getKeyModifier(O)}})}):U.addEventListener(M,O=>{if(M==="blur"){if(!L.focused||!O.relatedTarget)return;L.focused=!1}else if(M==="focus"){if(L.focused)return;L.focused=!0}V&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:C,value:V(O)}})})}_setEventListeners(U,L,M,C){for(const[V,O]of M)(O==="Action"||this.data.actions?.[O])&&((O==="Focus"||O==="Blur")&&(L||={focused:!1}),this._setEventListener(U,L,V,O,C),O==="Focus"&&!this.data.actions?.Blur?this._setEventListener(U,L,"blur","Blur",null):O==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(U,L,"focus","Focus",null))}_setBackgroundColor(U){const L=this.data.backgroundColor||null;U.style.backgroundColor=L===null?"transparent":s.Util.makeHexColor(L[0],L[1],L[2])}_setTextStyle(U){const L=["left","center","right"],{fontColor:M}=this.data.defaultAppearanceData,C=this.data.defaultAppearanceData.fontSize||i,V=U.style;let O;const z=2,j=J=>Math.round(10*J)/10;if(this.data.multiLine){const J=Math.abs(this.data.rect[3]-this.data.rect[1]-z),X=Math.round(J/(s.LINE_FACTOR*C))||1,ne=J/X;O=Math.min(C,j(ne/s.LINE_FACTOR))}else{const J=Math.abs(this.data.rect[3]-this.data.rect[1]-z);O=Math.min(C,j(J/s.LINE_FACTOR))}V.fontSize=`calc(${O}px * var(--scale-factor))`,V.color=s.Util.makeHexColor(M[0],M[1],M[2]),this.data.textAlignment!==null&&(V.textAlign=L[this.data.textAlignment])}_setRequired(U,L){L?U.setAttribute("required",!0):U.removeAttribute("required"),U.setAttribute("aria-required",L)}}class w extends T{constructor(U){const L=U.renderForms||U.data.hasOwnCanvas||!U.data.hasAppearance&&!!U.data.fieldValue;super(U,{isRenderable:L})}setPropertyOnSiblings(U,L,M,C){const V=this.annotationStorage;for(const O of this._getElementsByName(U.name,U.id))O.domElement&&(O.domElement[L]=M),V.setValue(O.id,{[C]:M})}render(){const U=this.annotationStorage,L=this.data.id;this.container.classList.add("textWidgetAnnotation");let M=null;if(this.renderForms){const C=U.getValue(L,{value:this.data.fieldValue});let V=C.value||"";const O=U.getValue(L,{charLimit:this.data.maxLen}).charLimit;O&&V.length>O&&(V=V.slice(0,O));let z=C.formattedValue||this.data.textContent?.join(`
`)||null;z&&this.data.comb&&(z=z.replaceAll(/\s+/g,""));const j={userValue:V,formattedValue:z,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(M=document.createElement("textarea"),M.textContent=z??V,this.data.doNotScroll&&(M.style.overflowY="hidden")):(M=document.createElement("input"),M.type="text",M.setAttribute("value",z??V),this.data.doNotScroll&&(M.style.overflowX="hidden")),this.data.hasOwnCanvas&&(M.hidden=!0),r.add(M),M.setAttribute("data-element-id",L),M.disabled=this.data.readOnly,M.name=this.data.fieldName,M.tabIndex=f,this._setRequired(M,this.data.required),O&&(M.maxLength=O),M.addEventListener("input",X=>{U.setValue(L,{value:X.target.value}),this.setPropertyOnSiblings(M,"value",X.target.value,"value"),j.formattedValue=null}),M.addEventListener("resetform",X=>{const ne=this.data.defaultFieldValue??"";M.value=j.userValue=ne,j.formattedValue=null});let J=X=>{const{formattedValue:ne}=j;ne!=null&&(X.target.value=ne),X.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){M.addEventListener("focus",ne=>{if(j.focused)return;const{target:ie}=ne;j.userValue&&(ie.value=j.userValue),j.lastCommittedValue=ie.value,j.commitKey=1,this.data.actions?.Focus||(j.focused=!0)}),M.addEventListener("updatefromsandbox",ne=>{this.showElementAndHideCanvas(ne.target);const ie={value(fe){j.userValue=fe.detail.value??"",U.setValue(L,{value:j.userValue.toString()}),fe.target.value=j.userValue},formattedValue(fe){const{formattedValue:ye}=fe.detail;j.formattedValue=ye,ye!=null&&fe.target!==document.activeElement&&(fe.target.value=ye),U.setValue(L,{formattedValue:ye})},selRange(fe){fe.target.setSelectionRange(...fe.detail.selRange)},charLimit:fe=>{const{charLimit:ye}=fe.detail,{target:pe}=fe;if(ye===0){pe.removeAttribute("maxLength");return}pe.setAttribute("maxLength",ye);let te=j.userValue;!te||te.length<=ye||(te=te.slice(0,ye),pe.value=j.userValue=te,U.setValue(L,{value:te}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:L,name:"Keystroke",value:te,willCommit:!0,commitKey:1,selStart:pe.selectionStart,selEnd:pe.selectionEnd}}))}};this._dispatchEventFromSandbox(ie,ne)}),M.addEventListener("keydown",ne=>{j.commitKey=1;let ie=-1;if(ne.key==="Escape"?ie=0:ne.key==="Enter"&&!this.data.multiLine?ie=2:ne.key==="Tab"&&(j.commitKey=3),ie===-1)return;const{value:fe}=ne.target;j.lastCommittedValue!==fe&&(j.lastCommittedValue=fe,j.userValue=fe,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:L,name:"Keystroke",value:fe,willCommit:!0,commitKey:ie,selStart:ne.target.selectionStart,selEnd:ne.target.selectionEnd}}))});const X=J;J=null,M.addEventListener("blur",ne=>{if(!j.focused||!ne.relatedTarget)return;this.data.actions?.Blur||(j.focused=!1);const{value:ie}=ne.target;j.userValue=ie,j.lastCommittedValue!==ie&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:L,name:"Keystroke",value:ie,willCommit:!0,commitKey:j.commitKey,selStart:ne.target.selectionStart,selEnd:ne.target.selectionEnd}}),X(ne)}),this.data.actions?.Keystroke&&M.addEventListener("beforeinput",ne=>{j.lastCommittedValue=null;const{data:ie,target:fe}=ne,{value:ye,selectionStart:pe,selectionEnd:te}=fe;let ue=pe,Ie=te;switch(ne.inputType){case"deleteWordBackward":{const ae=ye.substring(0,pe).match(/\w*[^\w]*$/);ae&&(ue-=ae[0].length);break}case"deleteWordForward":{const ae=ye.substring(pe).match(/^[^\w]*\w*/);ae&&(Ie+=ae[0].length);break}case"deleteContentBackward":pe===te&&(ue-=1);break;case"deleteContentForward":pe===te&&(Ie+=1);break}ne.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:L,name:"Keystroke",value:ye,change:ie||"",willCommit:!1,selStart:ue,selEnd:Ie}})}),this._setEventListeners(M,j,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ne=>ne.target.value)}if(J&&M.addEventListener("blur",J),this.data.comb){const ne=(this.data.rect[2]-this.data.rect[0])/O;M.classList.add("comb"),M.style.letterSpacing=`calc(${ne}px * var(--scale-factor) - 1ch)`}}else M=document.createElement("div"),M.textContent=this.data.fieldValue,M.style.verticalAlign="middle",M.style.display="table-cell",this.data.hasOwnCanvas&&(M.hidden=!0);return this._setTextStyle(M),this._setBackgroundColor(M),this._setDefaultPropertiesFromJS(M),this.container.append(M),this.container}}class E extends T{constructor(U){super(U,{isRenderable:!!U.data.hasOwnCanvas})}}class P extends T{constructor(U){super(U,{isRenderable:U.renderForms})}render(){const U=this.annotationStorage,L=this.data,M=L.id;let C=U.getValue(M,{value:L.exportValue===L.fieldValue}).value;typeof C=="string"&&(C=C!=="Off",U.setValue(M,{value:C})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const V=document.createElement("input");return r.add(V),V.setAttribute("data-element-id",M),V.disabled=L.readOnly,this._setRequired(V,this.data.required),V.type="checkbox",V.name=L.fieldName,C&&V.setAttribute("checked",!0),V.setAttribute("exportValue",L.exportValue),V.tabIndex=f,V.addEventListener("change",O=>{const{name:z,checked:j}=O.target;for(const J of this._getElementsByName(z,M)){const X=j&&J.exportValue===L.exportValue;J.domElement&&(J.domElement.checked=X),U.setValue(J.id,{value:X})}U.setValue(M,{value:j})}),V.addEventListener("resetform",O=>{const z=L.defaultFieldValue||"Off";O.target.checked=z===L.exportValue}),this.enableScripting&&this.hasJSActions&&(V.addEventListener("updatefromsandbox",O=>{const z={value(j){j.target.checked=j.detail.value!=="Off",U.setValue(M,{value:j.target.checked})}};this._dispatchEventFromSandbox(z,O)}),this._setEventListeners(V,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],O=>O.target.checked)),this._setBackgroundColor(V),this._setDefaultPropertiesFromJS(V),this.container.append(V),this.container}}class R extends T{constructor(U){super(U,{isRenderable:U.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const U=this.annotationStorage,L=this.data,M=L.id;let C=U.getValue(M,{value:L.fieldValue===L.buttonValue}).value;if(typeof C=="string"&&(C=C!==L.buttonValue,U.setValue(M,{value:C})),C)for(const O of this._getElementsByName(L.fieldName,M))U.setValue(O.id,{value:!1});const V=document.createElement("input");if(r.add(V),V.setAttribute("data-element-id",M),V.disabled=L.readOnly,this._setRequired(V,this.data.required),V.type="radio",V.name=L.fieldName,C&&V.setAttribute("checked",!0),V.tabIndex=f,V.addEventListener("change",O=>{const{name:z,checked:j}=O.target;for(const J of this._getElementsByName(z,M))U.setValue(J.id,{value:!1});U.setValue(M,{value:j})}),V.addEventListener("resetform",O=>{const z=L.defaultFieldValue;O.target.checked=z!=null&&z===L.buttonValue}),this.enableScripting&&this.hasJSActions){const O=L.buttonValue;V.addEventListener("updatefromsandbox",z=>{const j={value:J=>{const X=O===J.detail.value;for(const ne of this._getElementsByName(J.target.name)){const ie=X&&ne.id===M;ne.domElement&&(ne.domElement.checked=ie),U.setValue(ne.id,{value:ie})}}};this._dispatchEventFromSandbox(j,z)}),this._setEventListeners(V,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],z=>z.target.checked)}return this._setBackgroundColor(V),this._setDefaultPropertiesFromJS(V),this.container.append(V),this.container}}class I extends y{constructor(U){super(U,{ignoreBorder:U.data.hasAppearance})}render(){const U=super.render();U.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(U.title=this.data.alternativeText);const L=U.lastChild;return this.enableScripting&&this.hasJSActions&&L&&(this._setDefaultPropertiesFromJS(L),L.addEventListener("updatefromsandbox",M=>{this._dispatchEventFromSandbox({},M)})),U}}class N extends T{constructor(U){super(U,{isRenderable:U.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const U=this.annotationStorage,L=this.data.id,M=U.getValue(L,{value:this.data.fieldValue}),C=document.createElement("select");r.add(C),C.setAttribute("data-element-id",L),C.disabled=this.data.readOnly,this._setRequired(C,this.data.required),C.name=this.data.fieldName,C.tabIndex=f;let V=this.data.combo&&this.data.options.length>0;this.data.combo||(C.size=this.data.options.length,this.data.multiSelect&&(C.multiple=!0)),C.addEventListener("resetform",X=>{const ne=this.data.defaultFieldValue;for(const ie of C.options)ie.selected=ie.value===ne});for(const X of this.data.options){const ne=document.createElement("option");ne.textContent=X.displayValue,ne.value=X.exportValue,M.value.includes(X.exportValue)&&(ne.setAttribute("selected",!0),V=!1),C.append(ne)}let O=null;if(V){const X=document.createElement("option");X.value=" ",X.setAttribute("hidden",!0),X.setAttribute("selected",!0),C.prepend(X),O=()=>{X.remove(),C.removeEventListener("input",O),O=null},C.addEventListener("input",O)}const z=X=>{const ne=X?"value":"textContent",{options:ie,multiple:fe}=C;return fe?Array.prototype.filter.call(ie,ye=>ye.selected).map(ye=>ye[ne]):ie.selectedIndex===-1?null:ie[ie.selectedIndex][ne]};let j=z(!1);const J=X=>{const ne=X.target.options;return Array.prototype.map.call(ne,ie=>({displayValue:ie.textContent,exportValue:ie.value}))};return this.enableScripting&&this.hasJSActions?(C.addEventListener("updatefromsandbox",X=>{const ne={value(ie){O?.();const fe=ie.detail.value,ye=new Set(Array.isArray(fe)?fe:[fe]);for(const pe of C.options)pe.selected=ye.has(pe.value);U.setValue(L,{value:z(!0)}),j=z(!1)},multipleSelection(ie){C.multiple=!0},remove(ie){const fe=C.options,ye=ie.detail.remove;fe[ye].selected=!1,C.remove(ye),fe.length>0&&Array.prototype.findIndex.call(fe,te=>te.selected)===-1&&(fe[0].selected=!0),U.setValue(L,{value:z(!0),items:J(ie)}),j=z(!1)},clear(ie){for(;C.length!==0;)C.remove(0);U.setValue(L,{value:null,items:[]}),j=z(!1)},insert(ie){const{index:fe,displayValue:ye,exportValue:pe}=ie.detail.insert,te=C.children[fe],ue=document.createElement("option");ue.textContent=ye,ue.value=pe,te?te.before(ue):C.append(ue),U.setValue(L,{value:z(!0),items:J(ie)}),j=z(!1)},items(ie){const{items:fe}=ie.detail;for(;C.length!==0;)C.remove(0);for(const ye of fe){const{displayValue:pe,exportValue:te}=ye,ue=document.createElement("option");ue.textContent=pe,ue.value=te,C.append(ue)}C.options.length>0&&(C.options[0].selected=!0),U.setValue(L,{value:z(!0),items:J(ie)}),j=z(!1)},indices(ie){const fe=new Set(ie.detail.indices);for(const ye of ie.target.options)ye.selected=fe.has(ye.index);U.setValue(L,{value:z(!0)}),j=z(!1)},editable(ie){ie.target.disabled=!ie.detail.editable}};this._dispatchEventFromSandbox(ne,X)}),C.addEventListener("input",X=>{const ne=z(!0);U.setValue(L,{value:ne}),X.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:L,name:"Keystroke",value:j,changeEx:ne,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(C,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],X=>X.target.value)):C.addEventListener("input",function(X){U.setValue(L,{value:z(!0)})}),this.data.combo&&this._setTextStyle(C),this._setBackgroundColor(C),this._setDefaultPropertiesFromJS(C),this.container.append(C),this.container}}class B extends _{constructor(U){const{data:L,elements:M}=U;super(U,{isRenderable:_._hasPopupData(L)}),this.elements=M}render(){this.container.classList.add("popupAnnotation");const U=new D({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),L=[];for(const M of this.elements)M.popup=U,L.push(M.data.id),M.addHighlightArea();return this.container.setAttribute("aria-controls",L.map(M=>`${s.AnnotationPrefix}${M}`).join(",")),this.container}}class D{#e=this.#b.bind(this);#t=this.#m.bind(this);#n=this.#_.bind(this);#r=this.#v.bind(this);#s=null;#i=null;#o=null;#l=null;#u=null;#c=null;#f=null;#h=!1;#d=null;#a=null;#p=null;#g=null;#y=!1;constructor({container:U,color:L,elements:M,titleObj:C,modificationDate:V,contentsObj:O,richText:z,parent:j,rect:J,parentRect:X,open:ne}){this.#i=U,this.#g=C,this.#o=O,this.#p=z,this.#c=j,this.#s=L,this.#a=J,this.#f=X,this.#u=M,this.#l=o.PDFDateString.toDateObject(V),this.trigger=M.flatMap(ie=>ie.getElementsToTriggerPopup());for(const ie of this.trigger)ie.addEventListener("click",this.#r),ie.addEventListener("mouseenter",this.#n),ie.addEventListener("mouseleave",this.#t),ie.classList.add("popupTriggerArea");for(const ie of M)ie.container?.addEventListener("keydown",this.#e);this.#i.hidden=!0,ne&&this.#v()}render(){if(this.#d)return;const{page:{view:U},viewport:{rawDims:{pageWidth:L,pageHeight:M,pageX:C,pageY:V}}}=this.#c,O=this.#d=document.createElement("div");if(O.className="popup",this.#s){const ae=O.style.outlineColor=s.Util.makeHexColor(...this.#s);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?O.style.backgroundColor=`color-mix(in srgb, ${ae} 30%, white)`:O.style.backgroundColor=s.Util.makeHexColor(...this.#s.map(ze=>Math.floor(.7*(255-ze)+ze)))}const z=document.createElement("span");z.className="header";const j=document.createElement("h1");if(z.append(j),{dir:j.dir,str:j.textContent}=this.#g,O.append(z),this.#l){const ae=document.createElement("span");ae.classList.add("popupDate"),ae.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),ae.setAttribute("data-l10n-args",JSON.stringify({date:this.#l.toLocaleDateString(),time:this.#l.toLocaleTimeString()})),z.append(ae)}const J=this.#o,X=this.#p;if(X?.str&&(!J?.str||J.str===X.str))h.XfaLayer.render({xfaHtml:X.html,intent:"richText",div:O}),O.lastChild.classList.add("richText","popupContent");else{const ae=this._formatContents(J);O.append(ae)}let ne=!!this.#f,ie=ne?this.#f:this.#a;for(const ae of this.#u)if(!ie||s.Util.intersect(ae.data.rect,ie)!==null){ie=ae.data.rect,ne=!0;break}const fe=s.Util.normalizeRect([ie[0],U[3]-ie[1]+U[1],ie[2],U[3]-ie[3]+U[1]]),pe=ne?ie[2]-ie[0]+5:0,te=fe[0]+pe,ue=fe[1],{style:Ie}=this.#i;Ie.left=`${100*(te-C)/L}%`,Ie.top=`${100*(ue-V)/M}%`,this.#i.append(O)}_formatContents({str:U,dir:L}){const M=document.createElement("p");M.classList.add("popupContent"),M.dir=L;const C=U.split(/(?:\r\n?|\n)/);for(let V=0,O=C.length;V<O;++V){const z=C[V];M.append(document.createTextNode(z)),V<O-1&&M.append(document.createElement("br"))}return M}#b(U){U.altKey||U.shiftKey||U.ctrlKey||U.metaKey||(U.key==="Enter"||U.key==="Escape"&&this.#h)&&this.#v()}#v(){this.#h=!this.#h,this.#h?(this.#_(),this.#i.addEventListener("click",this.#r),this.#i.addEventListener("keydown",this.#e)):(this.#m(),this.#i.removeEventListener("click",this.#r),this.#i.removeEventListener("keydown",this.#e))}#_(){this.#d||this.render(),this.isVisible?this.#h&&this.#i.classList.add("focused"):(this.#i.hidden=!1,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)+1e3)}#m(){this.#i.classList.remove("focused"),!(this.#h||!this.isVisible)&&(this.#i.hidden=!0,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)-1e3)}forceHide(){this.#y=this.isVisible,this.#y&&(this.#i.hidden=!0)}maybeShow(){this.#y&&(this.#y=!1,this.#i.hidden=!1)}get isVisible(){return this.#i.hidden===!1}}class Y extends _{constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0}),this.textContent=U.data.textContent,this.textPosition=U.data.textPosition,this.annotationEditorType=s.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const U=document.createElement("div");U.classList.add("annotationTextContent"),U.setAttribute("role","comment");for(const L of this.textContent){const M=document.createElement("span");M.textContent=L,U.append(M)}this.container.append(U)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}get _isEditable(){return this.data.hasOwnCanvas}}class se extends _{#e=null;constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const U=this.data,{width:L,height:M}=d(U.rect),C=this.svgFactory.create(L,M,!0),V=this.#e=this.svgFactory.createElement("svg:line");return V.setAttribute("x1",U.rect[2]-U.lineCoordinates[0]),V.setAttribute("y1",U.rect[3]-U.lineCoordinates[1]),V.setAttribute("x2",U.rect[2]-U.lineCoordinates[2]),V.setAttribute("y2",U.rect[3]-U.lineCoordinates[3]),V.setAttribute("stroke-width",U.borderStyle.width||1),V.setAttribute("stroke","transparent"),V.setAttribute("fill","transparent"),C.append(V),this.container.append(C),!U.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class re extends _{#e=null;constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const U=this.data,{width:L,height:M}=d(U.rect),C=this.svgFactory.create(L,M,!0),V=U.borderStyle.width,O=this.#e=this.svgFactory.createElement("svg:rect");return O.setAttribute("x",V/2),O.setAttribute("y",V/2),O.setAttribute("width",L-V),O.setAttribute("height",M-V),O.setAttribute("stroke-width",V||1),O.setAttribute("stroke","transparent"),O.setAttribute("fill","transparent"),C.append(O),this.container.append(C),!U.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class W extends _{#e=null;constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const U=this.data,{width:L,height:M}=d(U.rect),C=this.svgFactory.create(L,M,!0),V=U.borderStyle.width,O=this.#e=this.svgFactory.createElement("svg:ellipse");return O.setAttribute("cx",L/2),O.setAttribute("cy",M/2),O.setAttribute("rx",L/2-V/2),O.setAttribute("ry",M/2-V/2),O.setAttribute("stroke-width",V||1),O.setAttribute("stroke","transparent"),O.setAttribute("fill","transparent"),C.append(O),this.container.append(C),!U.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class $ extends _{#e=null;constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const U=this.data,{width:L,height:M}=d(U.rect),C=this.svgFactory.create(L,M,!0);let V=[];for(const z of U.vertices){const j=z.x-U.rect[0],J=U.rect[3]-z.y;V.push(j+","+J)}V=V.join(" ");const O=this.#e=this.svgFactory.createElement(this.svgElementName);return O.setAttribute("points",V),O.setAttribute("stroke-width",U.borderStyle.width||1),O.setAttribute("stroke","transparent"),O.setAttribute("fill","transparent"),C.append(O),this.container.append(C),!U.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class k extends ${constructor(U){super(U),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class H extends _{constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class de extends _{#e=[];constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=s.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const U=this.data,{width:L,height:M}=d(U.rect),C=this.svgFactory.create(L,M,!0);for(const V of U.inkLists){let O=[];for(const j of V){const J=j.x-U.rect[0],X=U.rect[3]-j.y;O.push(`${J},${X}`)}O=O.join(" ");const z=this.svgFactory.createElement(this.svgElementName);this.#e.push(z),z.setAttribute("points",O),z.setAttribute("stroke-width",U.borderStyle.width||1),z.setAttribute("stroke","transparent"),z.setAttribute("fill","transparent"),!U.popupRef&&this.hasPopupData&&this._createPopup(),C.append(z)}return this.container.append(C),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class ee extends _{constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class ce extends _{constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class q extends _{constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class le extends _{constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class be extends _{constructor(U){super(U,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class xe extends _{#e=null;constructor(U){super(U,{isRenderable:!0});const{filename:L,content:M}=this.data.file;this.filename=(0,o.getFilenameFromUrl)(L,!0),this.content=M,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:L,content:M})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:U,data:L}=this;let M;L.hasAppearance||L.fillAlpha===0?M=document.createElement("div"):(M=document.createElement("img"),M.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(L.name)?"paperclip":"pushpin"}.svg`,L.fillAlpha&&L.fillAlpha<1&&(M.style=`filter: opacity(${Math.round(L.fillAlpha*100)}%);`)),M.addEventListener("dblclick",this.#t.bind(this)),this.#e=M;const{isMac:C}=s.FeatureTest.platform;return U.addEventListener("keydown",V=>{V.key==="Enter"&&(C?V.metaKey:V.ctrlKey)&&this.#t()}),!L.popupRef&&this.hasPopupData?this._createPopup():M.classList.add("popupTriggerArea"),U.append(M),U}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Ee{#e=null;#t=null;#n=new Map;constructor({div:U,accessibilityManager:L,annotationCanvasMap:M,page:C,viewport:V}){this.div=U,this.#e=L,this.#t=M,this.page=C,this.viewport=V,this.zIndex=0}#r(U,L){const M=U.firstChild||U;M.id=`${s.AnnotationPrefix}${L}`,this.div.append(U),this.#e?.moveElementInDOM(this.div,U,M,!1)}async render(U){const{annotations:L}=U,M=this.div;(0,o.setLayerDimensions)(M,this.viewport);const C=new Map,V={data:null,layer:M,linkService:U.linkService,downloadManager:U.downloadManager,imageResourcesPath:U.imageResourcesPath||"",renderForms:U.renderForms!==!1,svgFactory:new o.DOMSVGFactory,annotationStorage:U.annotationStorage||new u.AnnotationStorage,enableScripting:U.enableScripting===!0,hasJSActions:U.hasJSActions,fieldObjects:U.fieldObjects,parent:this,elements:null};for(const O of L){if(O.noHTML)continue;const z=O.annotationType===s.AnnotationType.POPUP;if(z){const X=C.get(O.id);if(!X)continue;V.elements=X}else{const{width:X,height:ne}=d(O.rect);if(X<=0||ne<=0)continue}V.data=O;const j=p.create(V);if(!j.isRenderable)continue;if(!z&&O.popupRef){const X=C.get(O.popupRef);X?X.push(j):C.set(O.popupRef,[j])}j.annotationEditorType>0&&this.#n.set(j.data.id,j);const J=j.render();O.hidden&&(J.style.visibility="hidden"),this.#r(J,O.id)}this.#s()}update({viewport:U}){const L=this.div;this.viewport=U,(0,o.setLayerDimensions)(L,{rotation:U.rotation}),this.#s(),L.hidden=!1}#s(){if(!this.#t)return;const U=this.div;for(const[L,M]of this.#t){const C=U.querySelector(`[data-annotation-id="${L}"]`);if(!C)continue;const{firstChild:V}=C;V?V.nodeName==="CANVAS"?V.replaceWith(M):V.before(M):C.append(M)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(U){return this.#n.get(U)}}}),780:((n,e,t)=>{t.d(e,{AnnotationStorage:()=>m,PrintAnnotationStorage:()=>g,SerializableEmpty:()=>l});var s=t(266),o=t(115),u=t(825);const l=Object.freeze({map:null,hash:"",transfer:void 0});class m{#e=!1;#t=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(f,i){const r=this.#t.get(f);return r===void 0?i:Object.assign(i,r)}getRawValue(f){return this.#t.get(f)}remove(f){if(this.#t.delete(f),this.#t.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const i of this.#t.values())if(i instanceof o.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(f,i){const r=this.#t.get(f);let d=!1;if(r!==void 0)for(const[p,_]of Object.entries(i))r[p]!==_&&(d=!0,r[p]=_);else d=!0,this.#t.set(f,i);d&&this.#n(),i instanceof o.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(i.constructor._type)}has(f){return this.#t.has(f)}getAll(){return this.#t.size>0?(0,s.objectFromMap)(this.#t):null}setAll(f){for(const[i,r]of Object.entries(f))this.setValue(i,r)}get size(){return this.#t.size}#n(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new g(this)}get serializable(){if(this.#t.size===0)return l;const f=new Map,i=new u.MurmurHash3_64,r=[],d=Object.create(null);let p=!1;for(const[_,y]of this.#t){const v=y instanceof o.AnnotationEditor?y.serialize(!1,d):y;v&&(f.set(_,v),i.update(`${_}:${JSON.stringify(v)}`),p||=!!v.bitmap)}if(p)for(const _ of f.values())_.bitmap&&r.push(_.bitmap);return f.size>0?{map:f,hash:i.hexdigest(),transfer:r}:l}}class g extends m{#e;constructor(f){super();const{map:i,hash:r,transfer:d}=f.serializable,p=structuredClone(i,d?{transfer:d}:null);this.#e={map:p,hash:r,transfer:d}}get print(){(0,s.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}}}),406:((n,e,t)=>{t.a(n,async(s,o)=>{try{let se=function(M){if(typeof M=="string"||M instanceof URL?M={url:M}:(0,u.isArrayBuffer)(M)&&(M={data:M}),typeof M!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!M.url&&!M.data&&!M.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const C=new k,{docId:V}=C,O=M.url?W(M.url):null,z=M.data?$(M.data):null,j=M.httpHeaders||null,J=M.withCredentials===!0,X=M.password??null,ne=M.range instanceof H?M.range:null,ie=Number.isInteger(M.rangeChunkSize)&&M.rangeChunkSize>0?M.rangeChunkSize:P;let fe=M.worker instanceof le?M.worker:null;const ye=M.verbosity,pe=typeof M.docBaseUrl=="string"&&!(0,m.isDataScheme)(M.docBaseUrl)?M.docBaseUrl:null,te=typeof M.cMapUrl=="string"?M.cMapUrl:null,ue=M.cMapPacked!==!1,Ie=M.CMapReaderFactory||B,ae=typeof M.standardFontDataUrl=="string"?M.standardFontDataUrl:null,De=M.StandardFontDataFactory||Y,ze=M.stopAtErrors!==!0,Ge=Number.isInteger(M.maxImageSize)&&M.maxImageSize>-1?M.maxImageSize:-1,He=M.isEvalSupported!==!1,Ye=typeof M.isOffscreenCanvasSupported=="boolean"?M.isOffscreenCanvasSupported:!u.isNodeJS,Xe=Number.isInteger(M.canvasMaxAreaInBytes)?M.canvasMaxAreaInBytes:-1,it=typeof M.disableFontFace=="boolean"?M.disableFontFace:u.isNodeJS,ut=M.fontExtraProperties===!0,qe=M.enableXfa===!0,Je=M.ownerDocument||globalThis.document,Pt=M.disableRange===!0,zt=M.disableStream===!0,Gt=M.disableAutoFetch===!0,nt=M.pdfBug===!0,At=ne?ne.length:M.length??NaN,Mt=typeof M.useSystemFonts=="boolean"?M.useSystemFonts:!u.isNodeJS&&!it,$t=typeof M.useWorkerFetch=="boolean"?M.useWorkerFetch:Ie===m.DOMCMapReaderFactory&&De===m.DOMStandardFontDataFactory&&te&&ae&&(0,m.isValidFetchUrl)(te,document.baseURI)&&(0,m.isValidFetchUrl)(ae,document.baseURI),et=M.canvasFactory||new N({ownerDocument:Je}),rt=M.filterFactory||new D({docId:V,ownerDocument:Je}),st=null;(0,u.setVerbosityLevel)(ye);const Jt={canvasFactory:et,filterFactory:rt};if($t||(Jt.cMapReaderFactory=new Ie({baseUrl:te,isCompressed:ue}),Jt.standardFontDataFactory=new De({baseUrl:ae})),!fe){const on={verbosity:ye,port:i.GlobalWorkerOptions.workerPort};fe=on.port?le.fromPort(on):new le(on),C._worker=fe}const Dt={docId:V,apiVersion:"4.0.379",data:z,password:X,disableAutoFetch:Gt,rangeChunkSize:ie,length:At,docBaseUrl:pe,enableXfa:qe,evaluatorOptions:{maxImageSize:Ge,disableFontFace:it,ignoreErrors:ze,isEvalSupported:He,isOffscreenCanvasSupported:Ye,canvasMaxAreaInBytes:Xe,fontExtraProperties:ut,useSystemFonts:Mt,cMapUrl:$t?te:null,standardFontDataUrl:$t?ae:null}},xn={ignoreErrors:ze,isEvalSupported:He,disableFontFace:it,fontExtraProperties:ut,enableXfa:qe,ownerDocument:Je,disableAutoFetch:Gt,pdfBug:nt,styleElement:st};return fe.promise.then(function(){if(C.destroyed)throw new Error("Loading aborted");const on=re(fe,Dt),Tn=new Promise(function(Vt){let wn;ne?wn=new _.PDFDataTransportStream({length:At,initialData:ne.initialData,progressiveDone:ne.progressiveDone,contentDispositionFilename:ne.contentDispositionFilename,disableRange:Pt,disableStream:zt},ne):z||(wn=(gn=>u.isNodeJS?new T.PDFNodeStream(gn):(0,m.isValidFetchUrl)(gn.url)?new y.PDFFetchStream(gn):new v.PDFNetworkStream(gn))({url:O,length:At,httpHeaders:j,withCredentials:J,rangeChunkSize:ie,disableRange:Pt,disableStream:zt})),Vt(wn)});return Promise.all([on,Tn]).then(function([Vt,wn]){if(C.destroyed)throw new Error("Loading aborted");const Fn=new r.MessageHandler(V,Vt,fe.port),gn=new be(Fn,C,wn,xn,Jt);C._transport=gn,Fn.send("Ready",null)})}).catch(C._capability.reject),C},W=function(M){if(M instanceof URL)return M.href;try{return new URL(M,window.location).href}catch{if(u.isNodeJS&&typeof M=="string")return M}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")},$=function(M){if(u.isNodeJS&&typeof Buffer<"u"&&M instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(M instanceof Uint8Array&&M.byteLength===M.buffer.byteLength)return M;if(typeof M=="string")return(0,u.stringToBytes)(M);if(typeof M=="object"&&!isNaN(M?.length)||(0,u.isArrayBuffer)(M))return new Uint8Array(M);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")};t.d(e,{PDFDataRangeTransport:()=>H,PDFWorker:()=>le,build:()=>L,getDocument:()=>se,version:()=>U});var u=t(266),l=t(780),m=t(473),g=t(742),h=t(738),f=t(250),i=t(368),r=t(694),d=t(472),p=t(890),_=t(92),y=t(171),v=t(474),T=t(498),w=t(521),E=s([h,T]);[h,T]=E.then?(await E)():E;const P=65536,R=100,I=5e3,N=u.isNodeJS?h.NodeCanvasFactory:m.DOMCanvasFactory,B=u.isNodeJS?h.NodeCMapReaderFactory:m.DOMCMapReaderFactory,D=u.isNodeJS?h.NodeFilterFactory:m.DOMFilterFactory,Y=u.isNodeJS?h.NodeStandardFontDataFactory:m.DOMStandardFontDataFactory;async function re(M,C){if(M.destroyed)throw new Error("Worker was destroyed");const V=await M.messageHandler.sendWithPromise("GetDocRequest",C,C.data?[C.data.buffer]:null);if(M.destroyed)throw new Error("Worker was destroyed");return V}class k{static#e=0;constructor(){this._capability=new u.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${k.#e++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(C){throw this._worker?.port&&delete this._worker._pendingDestroy,C}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class H{constructor(C,V,O=!1,z=null){this.length=C,this.initialData=V,this.progressiveDone=O,this.contentDispositionFilename=z,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new u.PromiseCapability}addRangeListener(C){this._rangeListeners.push(C)}addProgressListener(C){this._progressListeners.push(C)}addProgressiveReadListener(C){this._progressiveReadListeners.push(C)}addProgressiveDoneListener(C){this._progressiveDoneListeners.push(C)}onDataRange(C,V){for(const O of this._rangeListeners)O(C,V)}onDataProgress(C,V){this._readyCapability.promise.then(()=>{for(const O of this._progressListeners)O(C,V)})}onDataProgressiveRead(C){this._readyCapability.promise.then(()=>{for(const V of this._progressiveReadListeners)V(C)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const C of this._progressiveDoneListeners)C()})}transportReady(){this._readyCapability.resolve()}requestDataRange(C,V){(0,u.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class de{constructor(C,V){this._pdfInfo=C,this._transport=V}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,u.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(C){return this._transport.getPage(C)}getPageIndex(C){return this._transport.getPageIndex(C)}getDestinations(){return this._transport.getDestinations()}getDestination(C){return this._transport.getDestination(C)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(C=!1){return this._transport.startCleanup(C||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class ee{#e=null;#t=!1;constructor(C,V,O,z=!1){this._pageIndex=C,this._pageInfo=V,this._transport=O,this._stats=z?new m.StatTimer:null,this._pdfBug=z,this.commonObjs=O.commonObjs,this.objs=new xe,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:C,rotation:V=this.rotate,offsetX:O=0,offsetY:z=0,dontFlip:j=!1}={}){return new m.PageViewport({viewBox:this.view,scale:C,rotation:V,offsetX:O,offsetY:z,dontFlip:j})}getAnnotations({intent:C="display"}={}){const V=this._transport.getRenderingIntent(C);return this._transport.getAnnotations(this._pageIndex,V.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,u.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:C,viewport:V,intent:O="display",annotationMode:z=u.AnnotationMode.ENABLE,transform:j=null,background:J=null,optionalContentConfigPromise:X=null,annotationCanvasMap:ne=null,pageColors:ie=null,printAnnotationStorage:fe=null}){this._stats?.time("Overall");const ye=this._transport.getRenderingIntent(O,z,fe);this.#t=!1,this.#r(),X||(X=this._transport.getOptionalContentConfig());let pe=this._intentStates.get(ye.cacheKey);pe||(pe=Object.create(null),this._intentStates.set(ye.cacheKey,pe)),pe.streamReaderCancelTimeout&&(clearTimeout(pe.streamReaderCancelTimeout),pe.streamReaderCancelTimeout=null);const te=!!(ye.renderingIntent&u.RenderingIntentFlag.PRINT);pe.displayReadyCapability||(pe.displayReadyCapability=new u.PromiseCapability,pe.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(ye));const ue=De=>{pe.renderTasks.delete(Ie),(this._maybeCleanupAfterRender||te)&&(this.#t=!0),this.#n(!te),De?(Ie.capability.reject(De),this._abortOperatorList({intentState:pe,reason:De instanceof Error?De:new Error(De)})):Ie.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},Ie=new we({callback:ue,params:{canvasContext:C,viewport:V,transform:j,background:J},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:ne,operatorList:pe.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!te,pdfBug:this._pdfBug,pageColors:ie});(pe.renderTasks||=new Set).add(Ie);const ae=Ie.task;return Promise.all([pe.displayReadyCapability.promise,X]).then(([De,ze])=>{if(this.destroyed){ue();return}this._stats?.time("Rendering"),Ie.initializeGraphics({transparency:De,optionalContentConfig:ze}),Ie.operatorListChanged()}).catch(ue),ae}getOperatorList({intent:C="display",annotationMode:V=u.AnnotationMode.ENABLE,printAnnotationStorage:O=null}={}){function z(){J.operatorList.lastChunk&&(J.opListReadCapability.resolve(J.operatorList),J.renderTasks.delete(X))}const j=this._transport.getRenderingIntent(C,V,O,!0);let J=this._intentStates.get(j.cacheKey);J||(J=Object.create(null),this._intentStates.set(j.cacheKey,J));let X;return J.opListReadCapability||(X=Object.create(null),X.operatorListChanged=z,J.opListReadCapability=new u.PromiseCapability,(J.renderTasks||=new Set).add(X),J.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(j)),J.opListReadCapability.promise}streamTextContent({includeMarkedContent:C=!1,disableNormalization:V=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:C===!0,disableNormalization:V===!0},{highWaterMark:100,size(z){return z.items.length}})}getTextContent(C={}){if(this._transport._htmlForXfa)return this.getXfa().then(O=>w.XfaText.textContent(O));const V=this.streamTextContent(C);return new Promise(function(O,z){function j(){J.read().then(function({value:ne,done:ie}){if(ie){O(X);return}Object.assign(X.styles,ne.styles),X.items.push(...ne.items),j()},z)}const J=V.getReader(),X={items:[],styles:Object.create(null)};j()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const C=[];for(const V of this._intentStates.values())if(this._abortOperatorList({intentState:V,reason:new Error("Page was destroyed."),force:!0}),!V.opListReadCapability)for(const O of V.renderTasks)C.push(O.completed),O.cancel();return this.objs.clear(),this.#t=!1,this.#r(),Promise.all(C)}cleanup(C=!1){this.#t=!0;const V=this.#n(!1);return C&&V&&(this._stats&&=new m.StatTimer),V}#n(C=!1){if(this.#r(),!this.#t||this.destroyed)return!1;if(C)return this.#e=setTimeout(()=>{this.#e=null,this.#n(!1)},I),!1;for(const{renderTasks:V,operatorList:O}of this._intentStates.values())if(V.size>0||!O.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}#r(){this.#e&&(clearTimeout(this.#e),this.#e=null)}_startRenderPage(C,V){const O=this._intentStates.get(V);O&&(this._stats?.timeEnd("Page Request"),O.displayReadyCapability?.resolve(C))}_renderPageChunk(C,V){for(let O=0,z=C.length;O<z;O++)V.operatorList.fnArray.push(C.fnArray[O]),V.operatorList.argsArray.push(C.argsArray[O]);V.operatorList.lastChunk=C.lastChunk,V.operatorList.separateAnnots=C.separateAnnots;for(const O of V.renderTasks)O.operatorListChanged();C.lastChunk&&this.#n(!0)}_pumpOperatorList({renderingIntent:C,cacheKey:V,annotationStorageSerializable:O}){const{map:z,transfer:j}=O,X=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:C,cacheKey:V,annotationStorage:z},j).getReader(),ne=this._intentStates.get(V);ne.streamReader=X;const ie=()=>{X.read().then(({value:fe,done:ye})=>{if(ye){ne.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(fe,ne),ie())},fe=>{if(ne.streamReader=null,!this._transport.destroyed){if(ne.operatorList){ne.operatorList.lastChunk=!0;for(const ye of ne.renderTasks)ye.operatorListChanged();this.#n(!0)}if(ne.displayReadyCapability)ne.displayReadyCapability.reject(fe);else if(ne.opListReadCapability)ne.opListReadCapability.reject(fe);else throw fe}})};ie()}_abortOperatorList({intentState:C,reason:V,force:O=!1}){if(C.streamReader){if(C.streamReaderCancelTimeout&&(clearTimeout(C.streamReaderCancelTimeout),C.streamReaderCancelTimeout=null),!O){if(C.renderTasks.size>0)return;if(V instanceof m.RenderingCancelledException){let z=R;V.extraDelay>0&&V.extraDelay<1e3&&(z+=V.extraDelay),C.streamReaderCancelTimeout=setTimeout(()=>{C.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:C,reason:V,force:!0})},z);return}}if(C.streamReader.cancel(new u.AbortException(V.message)).catch(()=>{}),C.streamReader=null,!this._transport.destroyed){for(const[z,j]of this._intentStates)if(j===C){this._intentStates.delete(z);break}this.cleanup()}}}get stats(){return this._stats}}class ce{#e=new Set;#t=Promise.resolve();postMessage(C,V){const O={data:structuredClone(C,V?{transfer:V}:null)};this.#t.then(()=>{for(const z of this.#e)z.call(this,O)})}addEventListener(C,V){this.#e.add(V)}removeEventListener(C,V){this.#e.delete(V)}terminate(){this.#e.clear()}}const q={isWorkerDisabled:!1,fakeWorkerId:0};u.isNodeJS&&(q.isWorkerDisabled=!0,i.GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"),q.isSameOrigin=function(M,C){let V;try{if(V=new URL(M),!V.origin||V.origin==="null")return!1}catch{return!1}const O=new URL(C,V);return V.origin===O.origin},q.createCDNWrapper=function(M){const C=`await import("${M}");`;return URL.createObjectURL(new Blob([C],{type:"text/javascript"}))};class le{static#e;constructor({name:C=null,port:V=null,verbosity:O=(0,u.getVerbosityLevel)()}={}){if(this.name=C,this.destroyed=!1,this.verbosity=O,this._readyCapability=new u.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,V){if(le.#e?.has(V))throw new Error("Cannot use more than one PDFWorker per port.");(le.#e||=new WeakMap).set(V,this),this._initializeFromPort(V);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(C){this._port=C,this._messageHandler=new r.MessageHandler("main","worker",C),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!q.isWorkerDisabled&&!le.#t){let{workerSrc:C}=le;try{q.isSameOrigin(window.location.href,C)||(C=q.createCDNWrapper(new URL(C,window.location).href));const V=new Worker(C,{type:"module"}),O=new r.MessageHandler("main","worker",V),z=()=>{V.removeEventListener("error",j),O.destroy(),V.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},j=()=>{this._webWorker||z()};V.addEventListener("error",j),O.on("test",X=>{if(V.removeEventListener("error",j),this.destroyed){z();return}X?(this._messageHandler=O,this._port=V,this._webWorker=V,this._readyCapability.resolve(),O.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),O.destroy(),V.terminate())}),O.on("ready",X=>{if(V.removeEventListener("error",j),this.destroyed){z();return}try{J()}catch{this._setupFakeWorker()}});const J=()=>{const X=new Uint8Array;O.send("test",X,[X.buffer])};J();return}catch{(0,u.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){q.isWorkerDisabled||((0,u.warn)("Setting up fake worker."),q.isWorkerDisabled=!0),le._setupFakeWorkerGlobal.then(C=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const V=new ce;this._port=V;const O=`fake${q.fakeWorkerId++}`,z=new r.MessageHandler(O+"_worker",O,V);C.setup(z,V);const j=new r.MessageHandler(O,O+"_worker",V);this._messageHandler=j,this._readyCapability.resolve(),j.send("configure",{verbosity:this.verbosity})}).catch(C=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${C.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),le.#e?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(C){if(!C?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const V=this.#e?.get(C.port);if(V){if(V._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return V}return new le(C)}static get workerSrc(){if(i.GlobalWorkerOptions.workerSrc)return i.GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#t(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const C=async()=>this.#t?this.#t:(await import(this.workerSrc)).WorkerMessageHandler;return(0,u.shadow)(this,"_setupFakeWorkerGlobal",C())}}class be{#e=new Map;#t=new Map;#n=new Map;#r=null;constructor(C,V,O,z,j){this.messageHandler=C,this.loadingTask=V,this.commonObjs=new xe,this.fontLoader=new g.FontLoader({ownerDocument:z.ownerDocument,styleElement:z.styleElement}),this._params=z,this.canvasFactory=j.canvasFactory,this.filterFactory=j.filterFactory,this.cMapReaderFactory=j.cMapReaderFactory,this.standardFontDataFactory=j.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=O,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new u.PromiseCapability,this.setupMessageHandler()}#s(C,V=null){const O=this.#e.get(C);if(O)return O;const z=this.messageHandler.sendWithPromise(C,V);return this.#e.set(C,z),z}get annotationStorage(){return(0,u.shadow)(this,"annotationStorage",new l.AnnotationStorage)}getRenderingIntent(C,V=u.AnnotationMode.ENABLE,O=null,z=!1){let j=u.RenderingIntentFlag.DISPLAY,J=l.SerializableEmpty;switch(C){case"any":j=u.RenderingIntentFlag.ANY;break;case"display":break;case"print":j=u.RenderingIntentFlag.PRINT;break;default:(0,u.warn)(`getRenderingIntent - invalid intent: ${C}`)}switch(V){case u.AnnotationMode.DISABLE:j+=u.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case u.AnnotationMode.ENABLE:break;case u.AnnotationMode.ENABLE_FORMS:j+=u.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case u.AnnotationMode.ENABLE_STORAGE:j+=u.RenderingIntentFlag.ANNOTATIONS_STORAGE,J=(j&u.RenderingIntentFlag.PRINT&&O instanceof l.PrintAnnotationStorage?O:this.annotationStorage).serializable;break;default:(0,u.warn)(`getRenderingIntent - invalid annotationMode: ${V}`)}return z&&(j+=u.RenderingIntentFlag.OPLIST),{renderingIntent:j,cacheKey:`${j}_${J.hash}`,annotationStorageSerializable:J}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new u.PromiseCapability,this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const C=[];for(const O of this.#t.values())C.push(O._destroy());this.#t.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const V=this.messageHandler.sendWithPromise("Terminate",null);return C.push(V),Promise.all(C).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new u.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:C,loadingTask:V}=this;C.on("GetReader",(O,z)=>{(0,u.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=j=>{this._lastProgress={loaded:j.loaded,total:j.total}},z.onPull=()=>{this._fullReader.read().then(function({value:j,done:J}){if(J){z.close();return}(0,u.assert)(j instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),z.enqueue(new Uint8Array(j),1,[j])}).catch(j=>{z.error(j)})},z.onCancel=j=>{this._fullReader.cancel(j),z.ready.catch(J=>{if(!this.destroyed)throw J})}}),C.on("ReaderHeadersReady",O=>{const z=new u.PromiseCapability,j=this._fullReader;return j.headersReady.then(()=>{(!j.isStreamingSupported||!j.isRangeSupported)&&(this._lastProgress&&V.onProgress?.(this._lastProgress),j.onProgress=J=>{V.onProgress?.({loaded:J.loaded,total:J.total})}),z.resolve({isStreamingSupported:j.isStreamingSupported,isRangeSupported:j.isRangeSupported,contentLength:j.contentLength})},z.reject),z.promise}),C.on("GetRangeReader",(O,z)=>{(0,u.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const j=this._networkStream.getRangeReader(O.begin,O.end);if(!j){z.close();return}z.onPull=()=>{j.read().then(function({value:J,done:X}){if(X){z.close();return}(0,u.assert)(J instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),z.enqueue(new Uint8Array(J),1,[J])}).catch(J=>{z.error(J)})},z.onCancel=J=>{j.cancel(J),z.ready.catch(X=>{if(!this.destroyed)throw X})}}),C.on("GetDoc",({pdfInfo:O})=>{this._numPages=O.numPages,this._htmlForXfa=O.htmlForXfa,delete O.htmlForXfa,V._capability.resolve(new de(O,this))}),C.on("DocException",function(O){let z;switch(O.name){case"PasswordException":z=new u.PasswordException(O.message,O.code);break;case"InvalidPDFException":z=new u.InvalidPDFException(O.message);break;case"MissingPDFException":z=new u.MissingPDFException(O.message);break;case"UnexpectedResponseException":z=new u.UnexpectedResponseException(O.message,O.status);break;case"UnknownErrorException":z=new u.UnknownErrorException(O.message,O.details);break;default:(0,u.unreachable)("DocException - expected a valid Error.")}V._capability.reject(z)}),C.on("PasswordRequest",O=>{if(this.#r=new u.PromiseCapability,V.onPassword){const z=j=>{j instanceof Error?this.#r.reject(j):this.#r.resolve({password:j})};try{V.onPassword(z,O.code)}catch(j){this.#r.reject(j)}}else this.#r.reject(new u.PasswordException(O.message,O.code));return this.#r.promise}),C.on("DataLoaded",O=>{V.onProgress?.({loaded:O.length,total:O.length}),this.downloadInfoCapability.resolve(O)}),C.on("StartRenderPage",O=>{if(this.destroyed)return;this.#t.get(O.pageIndex)._startRenderPage(O.transparency,O.cacheKey)}),C.on("commonobj",([O,z,j])=>{if(this.destroyed||this.commonObjs.has(O))return null;switch(z){case"Font":const J=this._params;if("error"in j){const fe=j.error;(0,u.warn)(`Error during font loading: ${fe}`),this.commonObjs.resolve(O,fe);break}const X=J.pdfBug&&globalThis.FontInspector?.enabled?(fe,ye)=>globalThis.FontInspector.fontAdded(fe,ye):null,ne=new g.FontFaceObject(j,{isEvalSupported:J.isEvalSupported,disableFontFace:J.disableFontFace,ignoreErrors:J.ignoreErrors,inspectFont:X});this.fontLoader.bind(ne).catch(fe=>C.sendWithPromise("FontFallback",{id:O})).finally(()=>{!J.fontExtraProperties&&ne.data&&(ne.data=null),this.commonObjs.resolve(O,ne)});break;case"CopyLocalImage":const{imageRef:ie}=j;(0,u.assert)(ie,"The imageRef must be defined.");for(const fe of this.#t.values())for(const[,ye]of fe.objs)if(ye.ref===ie)return ye.dataLen?(this.commonObjs.resolve(O,structuredClone(ye)),ye.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(O,j);break;default:throw new Error(`Got unknown common object type ${z}`)}return null}),C.on("obj",([O,z,j,J])=>{if(this.destroyed)return;const X=this.#t.get(z);if(!X.objs.has(O)){if(X._intentStates.size===0){J?.bitmap?.close();return}switch(j){case"Image":X.objs.resolve(O,J),J?.dataLen>u.MAX_IMAGE_SIZE_TO_CACHE&&(X._maybeCleanupAfterRender=!0);break;case"Pattern":X.objs.resolve(O,J);break;default:throw new Error(`Got unknown object type ${j}`)}}}),C.on("DocProgress",O=>{this.destroyed||V.onProgress?.({loaded:O.loaded,total:O.total})}),C.on("FetchBuiltInCMap",O=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(O):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),C.on("FetchStandardFontData",O=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(O):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,u.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:C,transfer:V}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:C,filename:this._fullReader?.filename??null},V).finally(()=>{this.annotationStorage.resetModified()})}getPage(C){if(!Number.isInteger(C)||C<=0||C>this._numPages)return Promise.reject(new Error("Invalid page request."));const V=C-1,O=this.#n.get(V);if(O)return O;const z=this.messageHandler.sendWithPromise("GetPage",{pageIndex:V}).then(j=>{if(this.destroyed)throw new Error("Transport destroyed");const J=new ee(V,j,this,this._params.pdfBug);return this.#t.set(V,J),J});return this.#n.set(V,z),z}getPageIndex(C){return typeof C!="object"||C===null||!Number.isInteger(C.num)||C.num<0||!Number.isInteger(C.gen)||C.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:C.num,gen:C.gen})}getAnnotations(C,V){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:C,intent:V})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(C){return typeof C!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:C})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(C){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:C})}getStructTree(C){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:C})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(C=>new p.OptionalContentConfig(C))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const C="GetMetadata",V=this.#e.get(C);if(V)return V;const O=this.messageHandler.sendWithPromise(C,null).then(z=>({info:z[0],metadata:z[1]?new d.Metadata(z[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(C,O),O}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(C=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const V of this.#t.values())if(!V.cleanup())throw new Error(`startCleanup: Page ${V.pageNumber} is currently rendering.`);this.commonObjs.clear(),C||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:C,enableXfa:V}=this._params;return(0,u.shadow)(this,"loadingParams",{disableAutoFetch:C,enableXfa:V})}}class xe{#e=Object.create(null);#t(C){return this.#e[C]||={capability:new u.PromiseCapability,data:null}}get(C,V=null){if(V){const z=this.#t(C);return z.capability.promise.then(()=>V(z.data)),null}const O=this.#e[C];if(!O?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${C}.`);return O.data}has(C){return this.#e[C]?.capability.settled??!1}resolve(C,V=null){const O=this.#t(C);O.data=V,O.capability.resolve()}clear(){for(const C in this.#e){const{data:V}=this.#e[C];V?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const C in this.#e){const{capability:V,data:O}=this.#e[C];V.settled&&(yield[C,O])}}}class Ee{#e=null;constructor(C){this.#e=C,this.onContinue=null}get promise(){return this.#e.capability.promise}cancel(C=0){this.#e.cancel(null,C)}get separateAnnots(){const{separateAnnots:C}=this.#e.operatorList;if(!C)return!1;const{annotationCanvasMap:V}=this.#e;return C.form||C.canvas&&V?.size>0}}class we{static#e=new WeakSet;constructor({callback:C,params:V,objs:O,commonObjs:z,annotationCanvasMap:j,operatorList:J,pageIndex:X,canvasFactory:ne,filterFactory:ie,useRequestAnimationFrame:fe=!1,pdfBug:ye=!1,pageColors:pe=null}){this.callback=C,this.params=V,this.objs=O,this.commonObjs=z,this.annotationCanvasMap=j,this.operatorListIdx=null,this.operatorList=J,this._pageIndex=X,this.canvasFactory=ne,this.filterFactory=ie,this._pdfBug=ye,this.pageColors=pe,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=fe===!0&&typeof window<"u",this.cancelled=!1,this.capability=new u.PromiseCapability,this.task=new Ee(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=V.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:C=!1,optionalContentConfig:V}){if(this.cancelled)return;if(this._canvas){if(we.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");we.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:O,viewport:z,transform:j,background:J}=this.params;this.gfx=new f.CanvasGraphics(O,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:V},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:j,viewport:z,transparency:C,background:J}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(C=null,V=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),we.#e.delete(this._canvas),this.callback(C||new m.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,V))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),we.#e.delete(this._canvas),this.callback())))}}const U="4.0.379",L="9e14d04fd";o()}catch(P){o(P)}})}),822:((n,e,t)=>{t.d(e,{BaseCMapReaderFactory:()=>l,BaseCanvasFactory:()=>u,BaseFilterFactory:()=>o,BaseSVGFactory:()=>g,BaseStandardFontDataFactory:()=>m});var s=t(266);class o{constructor(){this.constructor===o&&(0,s.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(f){return"none"}addHCMFilter(f,i){return"none"}addHighlightHCMFilter(f,i,r,d){return"none"}destroy(f=!1){}}class u{constructor(){this.constructor===u&&(0,s.unreachable)("Cannot initialize BaseCanvasFactory.")}create(f,i){if(f<=0||i<=0)throw new Error("Invalid canvas size");const r=this._createCanvas(f,i);return{canvas:r,context:r.getContext("2d")}}reset(f,i,r){if(!f.canvas)throw new Error("Canvas is not specified");if(i<=0||r<=0)throw new Error("Invalid canvas size");f.canvas.width=i,f.canvas.height=r}destroy(f){if(!f.canvas)throw new Error("Canvas is not specified");f.canvas.width=0,f.canvas.height=0,f.canvas=null,f.context=null}_createCanvas(f,i){(0,s.unreachable)("Abstract method `_createCanvas` called.")}}class l{constructor({baseUrl:f=null,isCompressed:i=!0}){this.constructor===l&&(0,s.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=f,this.isCompressed=i}async fetch({name:f}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!f)throw new Error("CMap name must be specified.");const i=this.baseUrl+f+(this.isCompressed?".bcmap":""),r=this.isCompressed?s.CMapCompressionType.BINARY:s.CMapCompressionType.NONE;return this._fetchData(i,r).catch(d=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${i}`)})}_fetchData(f,i){(0,s.unreachable)("Abstract method `_fetchData` called.")}}class m{constructor({baseUrl:f=null}){this.constructor===m&&(0,s.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=f}async fetch({filename:f}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!f)throw new Error("Font filename must be specified.");const i=`${this.baseUrl}${f}`;return this._fetchData(i).catch(r=>{throw new Error(`Unable to load font data at: ${i}`)})}_fetchData(f){(0,s.unreachable)("Abstract method `_fetchData` called.")}}class g{constructor(){this.constructor===g&&(0,s.unreachable)("Cannot initialize BaseSVGFactory.")}create(f,i,r=!1){if(f<=0||i<=0)throw new Error("Invalid SVG dimensions");const d=this._createSVG("svg:svg");return d.setAttribute("version","1.1"),r||(d.setAttribute("width",`${f}px`),d.setAttribute("height",`${i}px`)),d.setAttribute("preserveAspectRatio","none"),d.setAttribute("viewBox",`0 0 ${f} ${i}`),d}createElement(f){if(typeof f!="string")throw new Error("Invalid SVG element type");return this._createSVG(f)}_createSVG(f){(0,s.unreachable)("Abstract method `_createSVG` called.")}}}),250:((n,e,t)=>{t.d(e,{CanvasGraphics:()=>U});var s=t(266),o=t(473);const u={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function l(L,M){if(!M)return;const C=M[2]-M[0],V=M[3]-M[1],O=new Path2D;O.rect(M[0],M[1],C,V),L.clip(O)}class m{constructor(){this.constructor===m&&(0,s.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,s.unreachable)("Abstract method `getPattern` called.")}}class g extends m{constructor(M){super(),this._type=M[1],this._bbox=M[2],this._colorStops=M[3],this._p0=M[4],this._p1=M[5],this._r0=M[6],this._r1=M[7],this.matrix=null}_createGradient(M){let C;this._type==="axial"?C=M.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(C=M.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const V of this._colorStops)C.addColorStop(V[0],V[1]);return C}getPattern(M,C,V,O){let z;if(O===u.STROKE||O===u.FILL){const j=C.current.getClippedPathBoundingBox(O,(0,o.getCurrentTransform)(M))||[0,0,0,0],J=Math.ceil(j[2]-j[0])||1,X=Math.ceil(j[3]-j[1])||1,ne=C.cachedCanvases.getCanvas("pattern",J,X,!0),ie=ne.context;ie.clearRect(0,0,ie.canvas.width,ie.canvas.height),ie.beginPath(),ie.rect(0,0,ie.canvas.width,ie.canvas.height),ie.translate(-j[0],-j[1]),V=s.Util.transform(V,[1,0,0,1,j[0],j[1]]),ie.transform(...C.baseTransform),this.matrix&&ie.transform(...this.matrix),l(ie,this._bbox),ie.fillStyle=this._createGradient(ie),ie.fill(),z=M.createPattern(ne.canvas,"no-repeat");const fe=new DOMMatrix(V);z.setTransform(fe)}else l(M,this._bbox),z=this._createGradient(M);return z}}function h(L,M,C,V,O,z,j,J){const X=M.coords,ne=M.colors,ie=L.data,fe=L.width*4;let ye;X[C+1]>X[V+1]&&(ye=C,C=V,V=ye,ye=z,z=j,j=ye),X[V+1]>X[O+1]&&(ye=V,V=O,O=ye,ye=j,j=J,J=ye),X[C+1]>X[V+1]&&(ye=C,C=V,V=ye,ye=z,z=j,j=ye);const pe=(X[C]+M.offsetX)*M.scaleX,te=(X[C+1]+M.offsetY)*M.scaleY,ue=(X[V]+M.offsetX)*M.scaleX,Ie=(X[V+1]+M.offsetY)*M.scaleY,ae=(X[O]+M.offsetX)*M.scaleX,De=(X[O+1]+M.offsetY)*M.scaleY;if(te>=De)return;const ze=ne[z],Ge=ne[z+1],He=ne[z+2],Ye=ne[j],Xe=ne[j+1],it=ne[j+2],ut=ne[J],qe=ne[J+1],Je=ne[J+2],Pt=Math.round(te),zt=Math.round(De);let Gt,nt,At,Mt,$t,et,rt,st;for(let Jt=Pt;Jt<=zt;Jt++){if(Jt<Ie){const Vt=Jt<te?0:(te-Jt)/(te-Ie);Gt=pe-(pe-ue)*Vt,nt=ze-(ze-Ye)*Vt,At=Ge-(Ge-Xe)*Vt,Mt=He-(He-it)*Vt}else{let Vt;Jt>De?Vt=1:Ie===De?Vt=0:Vt=(Ie-Jt)/(Ie-De),Gt=ue-(ue-ae)*Vt,nt=Ye-(Ye-ut)*Vt,At=Xe-(Xe-qe)*Vt,Mt=it-(it-Je)*Vt}let Dt;Jt<te?Dt=0:Jt>De?Dt=1:Dt=(te-Jt)/(te-De),$t=pe-(pe-ae)*Dt,et=ze-(ze-ut)*Dt,rt=Ge-(Ge-qe)*Dt,st=He-(He-Je)*Dt;const xn=Math.round(Math.min(Gt,$t)),on=Math.round(Math.max(Gt,$t));let Tn=fe*Jt+xn*4;for(let Vt=xn;Vt<=on;Vt++)Dt=(Gt-Vt)/(Gt-$t),Dt<0?Dt=0:Dt>1&&(Dt=1),ie[Tn++]=nt-(nt-et)*Dt|0,ie[Tn++]=At-(At-rt)*Dt|0,ie[Tn++]=Mt-(Mt-st)*Dt|0,ie[Tn++]=255}}function f(L,M,C){const V=M.coords,O=M.colors;let z,j;switch(M.type){case"lattice":const J=M.verticesPerRow,X=Math.floor(V.length/J)-1,ne=J-1;for(z=0;z<X;z++){let ie=z*J;for(let fe=0;fe<ne;fe++,ie++)h(L,C,V[ie],V[ie+1],V[ie+J],O[ie],O[ie+1],O[ie+J]),h(L,C,V[ie+J+1],V[ie+1],V[ie+J],O[ie+J+1],O[ie+1],O[ie+J])}break;case"triangles":for(z=0,j=V.length;z<j;z+=3)h(L,C,V[z],V[z+1],V[z+2],O[z],O[z+1],O[z+2]);break;default:throw new Error("illegal figure")}}class i extends m{constructor(M){super(),this._coords=M[2],this._colors=M[3],this._figures=M[4],this._bounds=M[5],this._bbox=M[7],this._background=M[8],this.matrix=null}_createMeshCanvas(M,C,V){const J=Math.floor(this._bounds[0]),X=Math.floor(this._bounds[1]),ne=Math.ceil(this._bounds[2])-J,ie=Math.ceil(this._bounds[3])-X,fe=Math.min(Math.ceil(Math.abs(ne*M[0]*1.1)),3e3),ye=Math.min(Math.ceil(Math.abs(ie*M[1]*1.1)),3e3),pe=ne/fe,te=ie/ye,ue={coords:this._coords,colors:this._colors,offsetX:-J,offsetY:-X,scaleX:1/pe,scaleY:1/te},Ie=fe+4,ae=ye+4,De=V.getCanvas("mesh",Ie,ae,!1),ze=De.context,Ge=ze.createImageData(fe,ye);if(C){const Ye=Ge.data;for(let Xe=0,it=Ye.length;Xe<it;Xe+=4)Ye[Xe]=C[0],Ye[Xe+1]=C[1],Ye[Xe+2]=C[2],Ye[Xe+3]=255}for(const Ye of this._figures)f(Ge,Ye,ue);return ze.putImageData(Ge,2,2),{canvas:De.canvas,offsetX:J-2*pe,offsetY:X-2*te,scaleX:pe,scaleY:te}}getPattern(M,C,V,O){l(M,this._bbox);let z;if(O===u.SHADING)z=s.Util.singularValueDecompose2dScale((0,o.getCurrentTransform)(M));else if(z=s.Util.singularValueDecompose2dScale(C.baseTransform),this.matrix){const J=s.Util.singularValueDecompose2dScale(this.matrix);z=[z[0]*J[0],z[1]*J[1]]}const j=this._createMeshCanvas(z,O===u.SHADING?null:this._background,C.cachedCanvases);return O!==u.SHADING&&(M.setTransform(...C.baseTransform),this.matrix&&M.transform(...this.matrix)),M.translate(j.offsetX,j.offsetY),M.scale(j.scaleX,j.scaleY),M.createPattern(j.canvas,"no-repeat")}}class r extends m{getPattern(){return"hotpink"}}function d(L){switch(L[0]){case"RadialAxial":return new g(L);case"Mesh":return new i(L);case"Dummy":return new r}throw new Error(`Unknown IR type: ${L[0]}`)}const p={COLORED:1,UNCOLORED:2};class _{static MAX_PATTERN_SIZE=3e3;constructor(M,C,V,O,z){this.operatorList=M[2],this.matrix=M[3]||[1,0,0,1,0,0],this.bbox=M[4],this.xstep=M[5],this.ystep=M[6],this.paintType=M[7],this.tilingType=M[8],this.color=C,this.ctx=V,this.canvasGraphicsFactory=O,this.baseTransform=z}createPatternCanvas(M){const C=this.operatorList,V=this.bbox,O=this.xstep,z=this.ystep,j=this.paintType,J=this.tilingType,X=this.color,ne=this.canvasGraphicsFactory;(0,s.info)("TilingType: "+J);const ie=V[0],fe=V[1],ye=V[2],pe=V[3],te=s.Util.singularValueDecompose2dScale(this.matrix),ue=s.Util.singularValueDecompose2dScale(this.baseTransform),Ie=[te[0]*ue[0],te[1]*ue[1]],ae=this.getSizeAndScale(O,this.ctx.canvas.width,Ie[0]),De=this.getSizeAndScale(z,this.ctx.canvas.height,Ie[1]),ze=M.cachedCanvases.getCanvas("pattern",ae.size,De.size,!0),Ge=ze.context,He=ne.createCanvasGraphics(Ge);He.groupLevel=M.groupLevel,this.setFillAndStrokeStyleToContext(He,j,X);let Ye=ie,Xe=fe,it=ye,ut=pe;return ie<0&&(Ye=0,it+=Math.abs(ie)),fe<0&&(Xe=0,ut+=Math.abs(fe)),Ge.translate(-(ae.scale*Ye),-(De.scale*Xe)),He.transform(ae.scale,0,0,De.scale,0,0),Ge.save(),this.clipBbox(He,Ye,Xe,it,ut),He.baseTransform=(0,o.getCurrentTransform)(He.ctx),He.executeOperatorList(C),He.endDrawing(),{canvas:ze.canvas,scaleX:ae.scale,scaleY:De.scale,offsetX:Ye,offsetY:Xe}}getSizeAndScale(M,C,V){M=Math.abs(M);const O=Math.max(_.MAX_PATTERN_SIZE,C);let z=Math.ceil(M*V);return z>=O?z=O:V=z/M,{scale:V,size:z}}clipBbox(M,C,V,O,z){const j=O-C,J=z-V;M.ctx.rect(C,V,j,J),M.current.updateRectMinMax((0,o.getCurrentTransform)(M.ctx),[C,V,O,z]),M.clip(),M.endPath()}setFillAndStrokeStyleToContext(M,C,V){const O=M.ctx,z=M.current;switch(C){case p.COLORED:const j=this.ctx;O.fillStyle=j.fillStyle,O.strokeStyle=j.strokeStyle,z.fillColor=j.fillStyle,z.strokeColor=j.strokeStyle;break;case p.UNCOLORED:const J=s.Util.makeHexColor(V[0],V[1],V[2]);O.fillStyle=J,O.strokeStyle=J,z.fillColor=J,z.strokeColor=J;break;default:throw new s.FormatError(`Unsupported paint type: ${C}`)}}getPattern(M,C,V,O){let z=V;O!==u.SHADING&&(z=s.Util.transform(z,C.baseTransform),this.matrix&&(z=s.Util.transform(z,this.matrix)));const j=this.createPatternCanvas(C);let J=new DOMMatrix(z);J=J.translate(j.offsetX,j.offsetY),J=J.scale(1/j.scaleX,1/j.scaleY);const X=M.createPattern(j.canvas,"repeat");return X.setTransform(J),X}}function y({src:L,srcPos:M=0,dest:C,width:V,height:O,nonBlackColor:z=4294967295,inverseDecode:j=!1}){const J=s.FeatureTest.isLittleEndian?4278190080:255,[X,ne]=j?[z,J]:[J,z],ie=V>>3,fe=V&7,ye=L.length;C=new Uint32Array(C.buffer);let pe=0;for(let te=0;te<O;te++){for(const Ie=M+ie;M<Ie;M++){const ae=M<ye?L[M]:255;C[pe++]=ae&128?ne:X,C[pe++]=ae&64?ne:X,C[pe++]=ae&32?ne:X,C[pe++]=ae&16?ne:X,C[pe++]=ae&8?ne:X,C[pe++]=ae&4?ne:X,C[pe++]=ae&2?ne:X,C[pe++]=ae&1?ne:X}if(fe===0)continue;const ue=M<ye?L[M++]:255;for(let Ie=0;Ie<fe;Ie++)C[pe++]=ue&1<<7-Ie?ne:X}return{srcPos:M,destPos:pe}}const v=16,T=100,w=4096,E=15,P=10,R=1e3,I=16;function N(L,M){if(L._removeMirroring)throw new Error("Context is already forwarding operations.");L.__originalSave=L.save,L.__originalRestore=L.restore,L.__originalRotate=L.rotate,L.__originalScale=L.scale,L.__originalTranslate=L.translate,L.__originalTransform=L.transform,L.__originalSetTransform=L.setTransform,L.__originalResetTransform=L.resetTransform,L.__originalClip=L.clip,L.__originalMoveTo=L.moveTo,L.__originalLineTo=L.lineTo,L.__originalBezierCurveTo=L.bezierCurveTo,L.__originalRect=L.rect,L.__originalClosePath=L.closePath,L.__originalBeginPath=L.beginPath,L._removeMirroring=()=>{L.save=L.__originalSave,L.restore=L.__originalRestore,L.rotate=L.__originalRotate,L.scale=L.__originalScale,L.translate=L.__originalTranslate,L.transform=L.__originalTransform,L.setTransform=L.__originalSetTransform,L.resetTransform=L.__originalResetTransform,L.clip=L.__originalClip,L.moveTo=L.__originalMoveTo,L.lineTo=L.__originalLineTo,L.bezierCurveTo=L.__originalBezierCurveTo,L.rect=L.__originalRect,L.closePath=L.__originalClosePath,L.beginPath=L.__originalBeginPath,delete L._removeMirroring},L.save=function(){M.save(),this.__originalSave()},L.restore=function(){M.restore(),this.__originalRestore()},L.translate=function(V,O){M.translate(V,O),this.__originalTranslate(V,O)},L.scale=function(V,O){M.scale(V,O),this.__originalScale(V,O)},L.transform=function(V,O,z,j,J,X){M.transform(V,O,z,j,J,X),this.__originalTransform(V,O,z,j,J,X)},L.setTransform=function(V,O,z,j,J,X){M.setTransform(V,O,z,j,J,X),this.__originalSetTransform(V,O,z,j,J,X)},L.resetTransform=function(){M.resetTransform(),this.__originalResetTransform()},L.rotate=function(V){M.rotate(V),this.__originalRotate(V)},L.clip=function(V){M.clip(V),this.__originalClip(V)},L.moveTo=function(C,V){M.moveTo(C,V),this.__originalMoveTo(C,V)},L.lineTo=function(C,V){M.lineTo(C,V),this.__originalLineTo(C,V)},L.bezierCurveTo=function(C,V,O,z,j,J){M.bezierCurveTo(C,V,O,z,j,J),this.__originalBezierCurveTo(C,V,O,z,j,J)},L.rect=function(C,V,O,z){M.rect(C,V,O,z),this.__originalRect(C,V,O,z)},L.closePath=function(){M.closePath(),this.__originalClosePath()},L.beginPath=function(){M.beginPath(),this.__originalBeginPath()}}class B{constructor(M){this.canvasFactory=M,this.cache=Object.create(null)}getCanvas(M,C,V){let O;return this.cache[M]!==void 0?(O=this.cache[M],this.canvasFactory.reset(O,C,V)):(O=this.canvasFactory.create(C,V),this.cache[M]=O),O}delete(M){delete this.cache[M]}clear(){for(const M in this.cache){const C=this.cache[M];this.canvasFactory.destroy(C),delete this.cache[M]}}}function D(L,M,C,V,O,z,j,J,X,ne){const[ie,fe,ye,pe,te,ue]=(0,o.getCurrentTransform)(L);if(fe===0&&ye===0){const De=j*ie+te,ze=Math.round(De),Ge=J*pe+ue,He=Math.round(Ge),Ye=(j+X)*ie+te,Xe=Math.abs(Math.round(Ye)-ze)||1,it=(J+ne)*pe+ue,ut=Math.abs(Math.round(it)-He)||1;return L.setTransform(Math.sign(ie),0,0,Math.sign(pe),ze,He),L.drawImage(M,C,V,O,z,0,0,Xe,ut),L.setTransform(ie,fe,ye,pe,te,ue),[Xe,ut]}if(ie===0&&pe===0){const De=J*ye+te,ze=Math.round(De),Ge=j*fe+ue,He=Math.round(Ge),Ye=(J+ne)*ye+te,Xe=Math.abs(Math.round(Ye)-ze)||1,it=(j+X)*fe+ue,ut=Math.abs(Math.round(it)-He)||1;return L.setTransform(0,Math.sign(fe),Math.sign(ye),0,ze,He),L.drawImage(M,C,V,O,z,0,0,ut,Xe),L.setTransform(ie,fe,ye,pe,te,ue),[ut,Xe]}L.drawImage(M,C,V,O,z,j,J,X,ne);const Ie=Math.hypot(ie,fe),ae=Math.hypot(ye,pe);return[Ie*X,ae*ne]}function Y(L){const{width:M,height:C}=L;if(M>R||C>R)return null;const V=1e3,O=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),z=M+1;let j=new Uint8Array(z*(C+1)),J,X,ne;const ie=M+7&-8;let fe=new Uint8Array(ie*C),ye=0;for(const ae of L.data){let De=128;for(;De>0;)fe[ye++]=ae&De?0:255,De>>=1}let pe=0;for(ye=0,fe[ye]!==0&&(j[0]=1,++pe),X=1;X<M;X++)fe[ye]!==fe[ye+1]&&(j[X]=fe[ye]?2:1,++pe),ye++;for(fe[ye]!==0&&(j[X]=2,++pe),J=1;J<C;J++){ye=J*ie,ne=J*z,fe[ye-ie]!==fe[ye]&&(j[ne]=fe[ye]?1:8,++pe);let ae=(fe[ye]?4:0)+(fe[ye-ie]?8:0);for(X=1;X<M;X++)ae=(ae>>2)+(fe[ye+1]?4:0)+(fe[ye-ie+1]?8:0),O[ae]&&(j[ne+X]=O[ae],++pe),ye++;if(fe[ye-ie]!==fe[ye]&&(j[ne+X]=fe[ye]?2:4,++pe),pe>V)return null}for(ye=ie*(C-1),ne=J*z,fe[ye]!==0&&(j[ne]=8,++pe),X=1;X<M;X++)fe[ye]!==fe[ye+1]&&(j[ne+X]=fe[ye]?4:8,++pe),ye++;if(fe[ye]!==0&&(j[ne+X]=4,++pe),pe>V)return null;const te=new Int32Array([0,z,-1,0,-z,0,0,0,1]),ue=new Path2D;for(J=0;pe&&J<=C;J++){let ae=J*z;const De=ae+M;for(;ae<De&&!j[ae];)ae++;if(ae===De)continue;ue.moveTo(ae%z,J);const ze=ae;let Ge=j[ae];do{const He=te[Ge];do ae+=He;while(!j[ae]);const Ye=j[ae];Ye!==5&&Ye!==10?(Ge=Ye,j[ae]=0):(Ge=Ye&51*Ge>>4,j[ae]&=Ge>>2|Ge<<2),ue.lineTo(ae%z,ae/z|0),j[ae]||--pe}while(ze!==ae);--J}return fe=null,j=null,function(ae){ae.save(),ae.scale(1/M,-1/C),ae.translate(0,-C),ae.fill(ue),ae.beginPath(),ae.restore()}}class se{constructor(M,C){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=s.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=s.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=s.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,M,C])}clone(){const M=Object.create(this);return M.clipBox=this.clipBox.slice(),M}setCurrentPoint(M,C){this.x=M,this.y=C}updatePathMinMax(M,C,V){[C,V]=s.Util.applyTransform([C,V],M),this.minX=Math.min(this.minX,C),this.minY=Math.min(this.minY,V),this.maxX=Math.max(this.maxX,C),this.maxY=Math.max(this.maxY,V)}updateRectMinMax(M,C){const V=s.Util.applyTransform(C,M),O=s.Util.applyTransform(C.slice(2),M),z=s.Util.applyTransform([C[0],C[3]],M),j=s.Util.applyTransform([C[2],C[1]],M);this.minX=Math.min(this.minX,V[0],O[0],z[0],j[0]),this.minY=Math.min(this.minY,V[1],O[1],z[1],j[1]),this.maxX=Math.max(this.maxX,V[0],O[0],z[0],j[0]),this.maxY=Math.max(this.maxY,V[1],O[1],z[1],j[1])}updateScalingPathMinMax(M,C){s.Util.scaleMinMax(M,C),this.minX=Math.min(this.minX,C[0]),this.maxX=Math.max(this.maxX,C[1]),this.minY=Math.min(this.minY,C[2]),this.maxY=Math.max(this.maxY,C[3])}updateCurvePathMinMax(M,C,V,O,z,j,J,X,ne,ie){const fe=s.Util.bezierBoundingBox(C,V,O,z,j,J,X,ne);if(ie){ie[0]=Math.min(ie[0],fe[0],fe[2]),ie[1]=Math.max(ie[1],fe[0],fe[2]),ie[2]=Math.min(ie[2],fe[1],fe[3]),ie[3]=Math.max(ie[3],fe[1],fe[3]);return}this.updateRectMinMax(M,fe)}getPathBoundingBox(M=u.FILL,C=null){const V=[this.minX,this.minY,this.maxX,this.maxY];if(M===u.STROKE){C||(0,s.unreachable)("Stroke bounding box must include transform.");const O=s.Util.singularValueDecompose2dScale(C),z=O[0]*this.lineWidth/2,j=O[1]*this.lineWidth/2;V[0]-=z,V[1]-=j,V[2]+=z,V[3]+=j}return V}updateClipFromPath(){const M=s.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(M||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(M){this.clipBox=M,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(M=u.FILL,C=null){return s.Util.intersect(this.clipBox,this.getPathBoundingBox(M,C))}}function re(L,M){if(typeof ImageData<"u"&&M instanceof ImageData){L.putImageData(M,0,0);return}const C=M.height,V=M.width,O=C%I,z=(C-O)/I,j=O===0?z:z+1,J=L.createImageData(V,I);let X=0,ne;const ie=M.data,fe=J.data;let ye,pe,te,ue;if(M.kind===s.ImageKind.GRAYSCALE_1BPP){const Ie=ie.byteLength,ae=new Uint32Array(fe.buffer,0,fe.byteLength>>2),De=ae.length,ze=V+7>>3,Ge=4294967295,He=s.FeatureTest.isLittleEndian?4278190080:255;for(ye=0;ye<j;ye++){for(te=ye<z?I:O,ne=0,pe=0;pe<te;pe++){const Ye=Ie-X;let Xe=0;const it=Ye>ze?V:Ye*8-7,ut=it&-8;let qe=0,Je=0;for(;Xe<ut;Xe+=8)Je=ie[X++],ae[ne++]=Je&128?Ge:He,ae[ne++]=Je&64?Ge:He,ae[ne++]=Je&32?Ge:He,ae[ne++]=Je&16?Ge:He,ae[ne++]=Je&8?Ge:He,ae[ne++]=Je&4?Ge:He,ae[ne++]=Je&2?Ge:He,ae[ne++]=Je&1?Ge:He;for(;Xe<it;Xe++)qe===0&&(Je=ie[X++],qe=128),ae[ne++]=Je&qe?Ge:He,qe>>=1}for(;ne<De;)ae[ne++]=0;L.putImageData(J,0,ye*I)}}else if(M.kind===s.ImageKind.RGBA_32BPP){for(pe=0,ue=V*I*4,ye=0;ye<z;ye++)fe.set(ie.subarray(X,X+ue)),X+=ue,L.putImageData(J,0,pe),pe+=I;ye<j&&(ue=V*O*4,fe.set(ie.subarray(X,X+ue)),L.putImageData(J,0,pe))}else if(M.kind===s.ImageKind.RGB_24BPP)for(te=I,ue=V*te,ye=0;ye<j;ye++){for(ye>=z&&(te=O,ue=V*te),ne=0,pe=ue;pe--;)fe[ne++]=ie[X++],fe[ne++]=ie[X++],fe[ne++]=ie[X++],fe[ne++]=255;L.putImageData(J,0,ye*I)}else throw new Error(`bad image kind: ${M.kind}`)}function W(L,M){if(M.bitmap){L.drawImage(M.bitmap,0,0);return}const C=M.height,V=M.width,O=C%I,z=(C-O)/I,j=O===0?z:z+1,J=L.createImageData(V,I);let X=0;const ne=M.data,ie=J.data;for(let fe=0;fe<j;fe++){const ye=fe<z?I:O;({srcPos:X}=y({src:ne,srcPos:X,dest:ie,width:V,height:ye,nonBlackColor:0})),L.putImageData(J,0,fe*I)}}function $(L,M){const C=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const V of C)L[V]!==void 0&&(M[V]=L[V]);L.setLineDash!==void 0&&(M.setLineDash(L.getLineDash()),M.lineDashOffset=L.lineDashOffset)}function k(L){if(L.strokeStyle=L.fillStyle="#000000",L.fillRule="nonzero",L.globalAlpha=1,L.lineWidth=1,L.lineCap="butt",L.lineJoin="miter",L.miterLimit=10,L.globalCompositeOperation="source-over",L.font="10px sans-serif",L.setLineDash!==void 0&&(L.setLineDash([]),L.lineDashOffset=0),!s.isNodeJS){const{filter:M}=L;M!=="none"&&M!==""&&(L.filter="none")}}function H(L,M,C,V){const O=L.length;for(let z=3;z<O;z+=4){const j=L[z];if(j===0)L[z-3]=M,L[z-2]=C,L[z-1]=V;else if(j<255){const J=255-j;L[z-3]=L[z-3]*j+M*J>>8,L[z-2]=L[z-2]*j+C*J>>8,L[z-1]=L[z-1]*j+V*J>>8}}}function de(L,M,C){const V=L.length,O=1/255;for(let z=3;z<V;z+=4){const j=C?C[L[z]]:L[z];M[z]=M[z]*j*O|0}}function ee(L,M,C){const V=L.length;for(let O=3;O<V;O+=4){const z=L[O-3]*77+L[O-2]*152+L[O-1]*28;M[O]=C?M[O]*C[z>>8]>>8:M[O]*z>>16}}function ce(L,M,C,V,O,z,j,J,X,ne,ie){const fe=!!z,ye=fe?z[0]:0,pe=fe?z[1]:0,te=fe?z[2]:0,ue=O==="Luminosity"?ee:de,ae=Math.min(V,Math.ceil(1048576/C));for(let De=0;De<V;De+=ae){const ze=Math.min(ae,V-De),Ge=L.getImageData(J-ne,De+(X-ie),C,ze),He=M.getImageData(J,De+X,C,ze);fe&&H(Ge.data,ye,pe,te),ue(Ge.data,He.data,j),M.putImageData(He,J,De+X)}}function q(L,M,C,V){const O=V[0],z=V[1],j=V[2]-O,J=V[3]-z;j===0||J===0||(ce(M.context,C,j,J,M.subtype,M.backdrop,M.transferMap,O,z,M.offsetX,M.offsetY),L.save(),L.globalAlpha=1,L.globalCompositeOperation="source-over",L.setTransform(1,0,0,1,0,0),L.drawImage(C.canvas,0,0),L.restore())}function le(L,M){const C=s.Util.singularValueDecompose2dScale(L);C[0]=Math.fround(C[0]),C[1]=Math.fround(C[1]);const V=Math.fround((globalThis.devicePixelRatio||1)*o.PixelsPerInch.PDF_TO_CSS_UNITS);return M!==void 0?M:C[0]<=V||C[1]<=V}const be=["butt","round","square"],xe=["miter","round","bevel"],Ee={},we={};class U{constructor(M,C,V,O,z,{optionalContentConfig:j,markedContentStack:J=null},X,ne){this.ctx=M,this.current=new se(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=C,this.objs=V,this.canvasFactory=O,this.filterFactory=z,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=J||[],this.optionalContentConfig=j,this.cachedCanvases=new B(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=X,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=ne,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(M,C=null){return typeof M=="string"?M.startsWith("g_")?this.commonObjs.get(M):this.objs.get(M):C}beginDrawing({transform:M,viewport:C,transparency:V=!1,background:O=null}){const z=this.ctx.canvas.width,j=this.ctx.canvas.height,J=this.ctx.fillStyle;if(this.ctx.fillStyle=O||"#ffffff",this.ctx.fillRect(0,0,z,j),this.ctx.fillStyle=J,V){const X=this.cachedCanvases.getCanvas("transparent",z,j);this.compositeCtx=this.ctx,this.transparentCanvas=X.canvas,this.ctx=X.context,this.ctx.save(),this.ctx.transform(...(0,o.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),k(this.ctx),M&&(this.ctx.transform(...M),this.outputScaleX=M[0],this.outputScaleY=M[0]),this.ctx.transform(...C.transform),this.viewportScale=C.scale,this.baseTransform=(0,o.getCurrentTransform)(this.ctx)}executeOperatorList(M,C,V,O){const z=M.argsArray,j=M.fnArray;let J=C||0;const X=z.length;if(X===J)return J;const ne=X-J>P&&typeof V=="function",ie=ne?Date.now()+E:0;let fe=0;const ye=this.commonObjs,pe=this.objs;let te;for(;;){if(O!==void 0&&J===O.nextBreakPoint)return O.breakIt(J,V),J;if(te=j[J],te!==s.OPS.dependency)this[te].apply(this,z[J]);else for(const ue of z[J]){const Ie=ue.startsWith("g_")?ye:pe;if(!Ie.has(ue))return Ie.get(ue,V),J}if(J++,J===X)return J;if(ne&&++fe>P){if(Date.now()>ie)return V(),J;fe=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const M of this._cachedBitmapsMap.values()){for(const C of M.values())typeof HTMLCanvasElement<"u"&&C instanceof HTMLCanvasElement&&(C.width=C.height=0);M.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const M=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(M!=="none"){const C=this.ctx.filter;this.ctx.filter=M,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=C}}}_scaleImage(M,C){const V=M.width,O=M.height;let z=Math.max(Math.hypot(C[0],C[1]),1),j=Math.max(Math.hypot(C[2],C[3]),1),J=V,X=O,ne="prescale1",ie,fe;for(;z>2&&J>1||j>2&&X>1;){let ye=J,pe=X;z>2&&J>1&&(ye=J>=16384?Math.floor(J/2)-1||1:Math.ceil(J/2),z/=J/ye),j>2&&X>1&&(pe=X>=16384?Math.floor(X/2)-1||1:Math.ceil(X)/2,j/=X/pe),ie=this.cachedCanvases.getCanvas(ne,ye,pe),fe=ie.context,fe.clearRect(0,0,ye,pe),fe.drawImage(M,0,0,J,X,0,0,ye,pe),M=ie.canvas,J=ye,X=pe,ne=ne==="prescale1"?"prescale2":"prescale1"}return{img:M,paintWidth:J,paintHeight:X}}_createMaskCanvas(M){const C=this.ctx,{width:V,height:O}=M,z=this.current.fillColor,j=this.current.patternFill,J=(0,o.getCurrentTransform)(C);let X,ne,ie,fe;if((M.bitmap||M.data)&&M.count>1){const it=M.bitmap||M.data.buffer;ne=JSON.stringify(j?J:[J.slice(0,4),z]),X=this._cachedBitmapsMap.get(it),X||(X=new Map,this._cachedBitmapsMap.set(it,X));const ut=X.get(ne);if(ut&&!j){const qe=Math.round(Math.min(J[0],J[2])+J[4]),Je=Math.round(Math.min(J[1],J[3])+J[5]);return{canvas:ut,offsetX:qe,offsetY:Je}}ie=ut}ie||(fe=this.cachedCanvases.getCanvas("maskCanvas",V,O),W(fe.context,M));let ye=s.Util.transform(J,[1/V,0,0,-1/O,0,0]);ye=s.Util.transform(ye,[1,0,0,1,0,-O]);const[pe,te,ue,Ie]=s.Util.getAxialAlignedBoundingBox([0,0,V,O],ye),ae=Math.round(ue-pe)||1,De=Math.round(Ie-te)||1,ze=this.cachedCanvases.getCanvas("fillCanvas",ae,De),Ge=ze.context,He=pe,Ye=te;Ge.translate(-He,-Ye),Ge.transform(...ye),ie||(ie=this._scaleImage(fe.canvas,(0,o.getCurrentTransformInverse)(Ge)),ie=ie.img,X&&j&&X.set(ne,ie)),Ge.imageSmoothingEnabled=le((0,o.getCurrentTransform)(Ge),M.interpolate),D(Ge,ie,0,0,ie.width,ie.height,0,0,V,O),Ge.globalCompositeOperation="source-in";const Xe=s.Util.transform((0,o.getCurrentTransformInverse)(Ge),[1,0,0,1,-He,-Ye]);return Ge.fillStyle=j?z.getPattern(C,this,Xe,u.FILL):z,Ge.fillRect(0,0,V,O),X&&!j&&(this.cachedCanvases.delete("fillCanvas"),X.set(ne,ze.canvas)),{canvas:ze.canvas,offsetX:Math.round(He),offsetY:Math.round(Ye)}}setLineWidth(M){M!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=M,this.ctx.lineWidth=M}setLineCap(M){this.ctx.lineCap=be[M]}setLineJoin(M){this.ctx.lineJoin=xe[M]}setMiterLimit(M){this.ctx.miterLimit=M}setDash(M,C){const V=this.ctx;V.setLineDash!==void 0&&(V.setLineDash(M),V.lineDashOffset=C)}setRenderingIntent(M){}setFlatness(M){}setGState(M){for(const[C,V]of M)switch(C){case"LW":this.setLineWidth(V);break;case"LC":this.setLineCap(V);break;case"LJ":this.setLineJoin(V);break;case"ML":this.setMiterLimit(V);break;case"D":this.setDash(V[0],V[1]);break;case"RI":this.setRenderingIntent(V);break;case"FL":this.setFlatness(V);break;case"Font":this.setFont(V[0],V[1]);break;case"CA":this.current.strokeAlpha=V;break;case"ca":this.current.fillAlpha=V,this.ctx.globalAlpha=V;break;case"BM":this.ctx.globalCompositeOperation=V;break;case"SMask":this.current.activeSMask=V?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(V);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const M=this.inSMaskMode;this.current.activeSMask&&!M?this.beginSMaskMode():!this.current.activeSMask&&M&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const M=this.ctx.canvas.width,C=this.ctx.canvas.height,V="smaskGroupAt"+this.groupLevel,O=this.cachedCanvases.getCanvas(V,M,C);this.suspendedCtx=this.ctx,this.ctx=O.context;const z=this.ctx;z.setTransform(...(0,o.getCurrentTransform)(this.suspendedCtx)),$(this.suspendedCtx,z),N(z,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),$(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(M){if(!this.current.activeSMask)return;M?(M[0]=Math.floor(M[0]),M[1]=Math.floor(M[1]),M[2]=Math.ceil(M[2]),M[3]=Math.ceil(M[3])):M=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const C=this.current.activeSMask,V=this.suspendedCtx;q(V,C,this.ctx,M),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?($(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const M=this.current;this.stateStack.push(M),this.current=M.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),$(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(M,C,V,O,z,j){this.ctx.transform(M,C,V,O,z,j),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(M,C,V){const O=this.ctx,z=this.current;let j=z.x,J=z.y,X,ne;const ie=(0,o.getCurrentTransform)(O),fe=ie[0]===0&&ie[3]===0||ie[1]===0&&ie[2]===0,ye=fe?V.slice(0):null;for(let pe=0,te=0,ue=M.length;pe<ue;pe++)switch(M[pe]|0){case s.OPS.rectangle:j=C[te++],J=C[te++];const Ie=C[te++],ae=C[te++],De=j+Ie,ze=J+ae;O.moveTo(j,J),Ie===0||ae===0?O.lineTo(De,ze):(O.lineTo(De,J),O.lineTo(De,ze),O.lineTo(j,ze)),fe||z.updateRectMinMax(ie,[j,J,De,ze]),O.closePath();break;case s.OPS.moveTo:j=C[te++],J=C[te++],O.moveTo(j,J),fe||z.updatePathMinMax(ie,j,J);break;case s.OPS.lineTo:j=C[te++],J=C[te++],O.lineTo(j,J),fe||z.updatePathMinMax(ie,j,J);break;case s.OPS.curveTo:X=j,ne=J,j=C[te+4],J=C[te+5],O.bezierCurveTo(C[te],C[te+1],C[te+2],C[te+3],j,J),z.updateCurvePathMinMax(ie,X,ne,C[te],C[te+1],C[te+2],C[te+3],j,J,ye),te+=6;break;case s.OPS.curveTo2:X=j,ne=J,O.bezierCurveTo(j,J,C[te],C[te+1],C[te+2],C[te+3]),z.updateCurvePathMinMax(ie,X,ne,j,J,C[te],C[te+1],C[te+2],C[te+3],ye),j=C[te+2],J=C[te+3],te+=4;break;case s.OPS.curveTo3:X=j,ne=J,j=C[te+2],J=C[te+3],O.bezierCurveTo(C[te],C[te+1],j,J,j,J),z.updateCurvePathMinMax(ie,X,ne,C[te],C[te+1],j,J,j,J,ye),te+=4;break;case s.OPS.closePath:O.closePath();break}fe&&z.updateScalingPathMinMax(ie,ye),z.setCurrentPoint(j,J)}closePath(){this.ctx.closePath()}stroke(M=!0){const C=this.ctx,V=this.current.strokeColor;C.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof V=="object"&&V?.getPattern?(C.save(),C.strokeStyle=V.getPattern(C,this,(0,o.getCurrentTransformInverse)(C),u.STROKE),this.rescaleAndStroke(!1),C.restore()):this.rescaleAndStroke(!0)),M&&this.consumePath(this.current.getClippedPathBoundingBox()),C.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(M=!0){const C=this.ctx,V=this.current.fillColor,O=this.current.patternFill;let z=!1;O&&(C.save(),C.fillStyle=V.getPattern(C,this,(0,o.getCurrentTransformInverse)(C),u.FILL),z=!0);const j=this.current.getClippedPathBoundingBox();this.contentVisible&&j!==null&&(this.pendingEOFill?(C.fill("evenodd"),this.pendingEOFill=!1):C.fill()),z&&C.restore(),M&&this.consumePath(j)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Ee}eoClip(){this.pendingClip=we}beginText(){this.current.textMatrix=s.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const M=this.pendingTextPaths,C=this.ctx;if(M===void 0){C.beginPath();return}C.save(),C.beginPath();for(const V of M)C.setTransform(...V.transform),C.translate(V.x,V.y),V.addToPath(C,V.fontSize);C.restore(),C.clip(),C.beginPath(),delete this.pendingTextPaths}setCharSpacing(M){this.current.charSpacing=M}setWordSpacing(M){this.current.wordSpacing=M}setHScale(M){this.current.textHScale=M/100}setLeading(M){this.current.leading=-M}setFont(M,C){const V=this.commonObjs.get(M),O=this.current;if(!V)throw new Error(`Can't find font for ${M}`);if(O.fontMatrix=V.fontMatrix||s.FONT_IDENTITY_MATRIX,(O.fontMatrix[0]===0||O.fontMatrix[3]===0)&&(0,s.warn)("Invalid font matrix for font "+M),C<0?(C=-C,O.fontDirection=-1):O.fontDirection=1,this.current.font=V,this.current.fontSize=C,V.isType3Font)return;const z=V.loadedName||"sans-serif",j=V.systemFontInfo?.css||`"${z}", ${V.fallbackName}`;let J="normal";V.black?J="900":V.bold&&(J="bold");const X=V.italic?"italic":"normal";let ne=C;C<v?ne=v:C>T&&(ne=T),this.current.fontSizeScale=C/ne,this.ctx.font=`${X} ${J} ${ne}px ${j}`}setTextRenderingMode(M){this.current.textRenderingMode=M}setTextRise(M){this.current.textRise=M}moveText(M,C){this.current.x=this.current.lineX+=M,this.current.y=this.current.lineY+=C}setLeadingMoveText(M,C){this.setLeading(-C),this.moveText(M,C)}setTextMatrix(M,C,V,O,z,j){this.current.textMatrix=[M,C,V,O,z,j],this.current.textMatrixScale=Math.hypot(M,C),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(M,C,V,O){const z=this.ctx,j=this.current,J=j.font,X=j.textRenderingMode,ne=j.fontSize/j.fontSizeScale,ie=X&s.TextRenderingMode.FILL_STROKE_MASK,fe=!!(X&s.TextRenderingMode.ADD_TO_PATH_FLAG),ye=j.patternFill&&!J.missingFile;let pe;(J.disableFontFace||fe||ye)&&(pe=J.getPathGenerator(this.commonObjs,M)),J.disableFontFace||ye?(z.save(),z.translate(C,V),z.beginPath(),pe(z,ne),O&&z.setTransform(...O),(ie===s.TextRenderingMode.FILL||ie===s.TextRenderingMode.FILL_STROKE)&&z.fill(),(ie===s.TextRenderingMode.STROKE||ie===s.TextRenderingMode.FILL_STROKE)&&z.stroke(),z.restore()):((ie===s.TextRenderingMode.FILL||ie===s.TextRenderingMode.FILL_STROKE)&&z.fillText(M,C,V),(ie===s.TextRenderingMode.STROKE||ie===s.TextRenderingMode.FILL_STROKE)&&z.strokeText(M,C,V)),fe&&(this.pendingTextPaths||=[]).push({transform:(0,o.getCurrentTransform)(z),x:C,y:V,fontSize:ne,addToPath:pe})}get isFontSubpixelAAEnabled(){const{context:M}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);M.scale(1.5,1),M.fillText("I",0,10);const C=M.getImageData(0,0,10,10).data;let V=!1;for(let O=3;O<C.length;O+=4)if(C[O]>0&&C[O]<255){V=!0;break}return(0,s.shadow)(this,"isFontSubpixelAAEnabled",V)}showText(M){const C=this.current,V=C.font;if(V.isType3Font)return this.showType3Text(M);const O=C.fontSize;if(O===0)return;const z=this.ctx,j=C.fontSizeScale,J=C.charSpacing,X=C.wordSpacing,ne=C.fontDirection,ie=C.textHScale*ne,fe=M.length,ye=V.vertical,pe=ye?1:-1,te=V.defaultVMetrics,ue=O*C.fontMatrix[0],Ie=C.textRenderingMode===s.TextRenderingMode.FILL&&!V.disableFontFace&&!C.patternFill;z.save(),z.transform(...C.textMatrix),z.translate(C.x,C.y+C.textRise),ne>0?z.scale(ie,-1):z.scale(ie,1);let ae;if(C.patternFill){z.save();const Ye=C.fillColor.getPattern(z,this,(0,o.getCurrentTransformInverse)(z),u.FILL);ae=(0,o.getCurrentTransform)(z),z.restore(),z.fillStyle=Ye}let De=C.lineWidth;const ze=C.textMatrixScale;if(ze===0||De===0){const Ye=C.textRenderingMode&s.TextRenderingMode.FILL_STROKE_MASK;(Ye===s.TextRenderingMode.STROKE||Ye===s.TextRenderingMode.FILL_STROKE)&&(De=this.getSinglePixelWidth())}else De/=ze;if(j!==1&&(z.scale(j,j),De/=j),z.lineWidth=De,V.isInvalidPDFjsFont){const Ye=[];let Xe=0;for(const it of M)Ye.push(it.unicode),Xe+=it.width;z.fillText(Ye.join(""),0,0),C.x+=Xe*ue*ie,z.restore(),this.compose();return}let Ge=0,He;for(He=0;He<fe;++He){const Ye=M[He];if(typeof Ye=="number"){Ge+=pe*Ye*O/1e3;continue}let Xe=!1;const it=(Ye.isSpace?X:0)+J,ut=Ye.fontChar,qe=Ye.accent;let Je,Pt,zt=Ye.width;if(ye){const nt=Ye.vmetric||te,At=-(Ye.vmetric?nt[1]:zt*.5)*ue,Mt=nt[2]*ue;zt=nt?-nt[0]:zt,Je=At/j,Pt=(Ge+Mt)/j}else Je=Ge/j,Pt=0;if(V.remeasure&&zt>0){const nt=z.measureText(ut).width*1e3/O*j;if(zt<nt&&this.isFontSubpixelAAEnabled){const At=zt/nt;Xe=!0,z.save(),z.scale(At,1),Je/=At}else zt!==nt&&(Je+=(zt-nt)/2e3*O/j)}if(this.contentVisible&&(Ye.isInFont||V.missingFile)){if(Ie&&!qe)z.fillText(ut,Je,Pt);else if(this.paintChar(ut,Je,Pt,ae),qe){const nt=Je+O*qe.offset.x/j,At=Pt-O*qe.offset.y/j;this.paintChar(qe.fontChar,nt,At,ae)}}const Gt=ye?zt*ue-it*ne:zt*ue+it*ne;Ge+=Gt,Xe&&z.restore()}ye?C.y-=Ge:C.x+=Ge*ie,z.restore(),this.compose()}showType3Text(M){const C=this.ctx,V=this.current,O=V.font,z=V.fontSize,j=V.fontDirection,J=O.vertical?1:-1,X=V.charSpacing,ne=V.wordSpacing,ie=V.textHScale*j,fe=V.fontMatrix||s.FONT_IDENTITY_MATRIX,ye=M.length,pe=V.textRenderingMode===s.TextRenderingMode.INVISIBLE;let te,ue,Ie,ae;if(!(pe||z===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,C.save(),C.transform(...V.textMatrix),C.translate(V.x,V.y),C.scale(ie,j),te=0;te<ye;++te){if(ue=M[te],typeof ue=="number"){ae=J*ue*z/1e3,this.ctx.translate(ae,0),V.x+=ae*ie;continue}const De=(ue.isSpace?ne:0)+X,ze=O.charProcOperatorList[ue.operatorListId];if(!ze){(0,s.warn)(`Type3 character "${ue.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=ue,this.save(),C.scale(z,z),C.transform(...fe),this.executeOperatorList(ze),this.restore()),Ie=s.Util.applyTransform([ue.width,0],fe)[0]*z+De,C.translate(Ie,0),V.x+=Ie*ie}C.restore(),this.processingType3=null}}setCharWidth(M,C){}setCharWidthAndBounds(M,C,V,O,z,j){this.ctx.rect(V,O,z-V,j-O),this.ctx.clip(),this.endPath()}getColorN_Pattern(M){let C;if(M[0]==="TilingPattern"){const V=M[1],O=this.baseTransform||(0,o.getCurrentTransform)(this.ctx),z={createCanvasGraphics:j=>new U(j,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};C=new _(M,V,this.ctx,z,O)}else C=this._getPattern(M[1],M[2]);return C}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(M,C,V){const O=s.Util.makeHexColor(M,C,V);this.ctx.strokeStyle=O,this.current.strokeColor=O}setFillRGBColor(M,C,V){const O=s.Util.makeHexColor(M,C,V);this.ctx.fillStyle=O,this.current.fillColor=O,this.current.patternFill=!1}_getPattern(M,C=null){let V;return this.cachedPatterns.has(M)?V=this.cachedPatterns.get(M):(V=d(this.getObject(M)),this.cachedPatterns.set(M,V)),C&&(V.matrix=C),V}shadingFill(M){if(!this.contentVisible)return;const C=this.ctx;this.save();const V=this._getPattern(M);C.fillStyle=V.getPattern(C,this,(0,o.getCurrentTransformInverse)(C),u.SHADING);const O=(0,o.getCurrentTransformInverse)(C);if(O){const{width:z,height:j}=C.canvas,[J,X,ne,ie]=s.Util.getAxialAlignedBoundingBox([0,0,z,j],O);this.ctx.fillRect(J,X,ne-J,ie-X)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,s.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,s.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(M,C){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(M)&&M.length===6&&this.transform(...M),this.baseTransform=(0,o.getCurrentTransform)(this.ctx),C)){const V=C[2]-C[0],O=C[3]-C[1];this.ctx.rect(C[0],C[1],V,O),this.current.updateRectMinMax((0,o.getCurrentTransform)(this.ctx),C),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(M){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const C=this.ctx;M.isolated||(0,s.info)("TODO: Support non-isolated groups."),M.knockout&&(0,s.warn)("Knockout groups not supported.");const V=(0,o.getCurrentTransform)(C);if(M.matrix&&C.transform(...M.matrix),!M.bbox)throw new Error("Bounding box is required.");let O=s.Util.getAxialAlignedBoundingBox(M.bbox,(0,o.getCurrentTransform)(C));const z=[0,0,C.canvas.width,C.canvas.height];O=s.Util.intersect(O,z)||[0,0,0,0];const j=Math.floor(O[0]),J=Math.floor(O[1]);let X=Math.max(Math.ceil(O[2])-j,1),ne=Math.max(Math.ceil(O[3])-J,1),ie=1,fe=1;X>w&&(ie=X/w,X=w),ne>w&&(fe=ne/w,ne=w),this.current.startNewPathAndClipBox([0,0,X,ne]);let ye="groupAt"+this.groupLevel;M.smask&&(ye+="_smask_"+this.smaskCounter++%2);const pe=this.cachedCanvases.getCanvas(ye,X,ne),te=pe.context;te.scale(1/ie,1/fe),te.translate(-j,-J),te.transform(...V),M.smask?this.smaskStack.push({canvas:pe.canvas,context:te,offsetX:j,offsetY:J,scaleX:ie,scaleY:fe,subtype:M.smask.subtype,backdrop:M.smask.backdrop,transferMap:M.smask.transferMap||null,startTransformInverse:null}):(C.setTransform(1,0,0,1,0,0),C.translate(j,J),C.scale(ie,fe),C.save()),$(C,te),this.ctx=te,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(C),this.groupLevel++}endGroup(M){if(!this.contentVisible)return;this.groupLevel--;const C=this.ctx,V=this.groupStack.pop();if(this.ctx=V,this.ctx.imageSmoothingEnabled=!1,M.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const O=(0,o.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...O);const z=s.Util.getAxialAlignedBoundingBox([0,0,C.canvas.width,C.canvas.height],O);this.ctx.drawImage(C.canvas,0,0),this.ctx.restore(),this.compose(z)}}beginAnnotation(M,C,V,O,z){if(this.#e(),k(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(C)&&C.length===4){const j=C[2]-C[0],J=C[3]-C[1];if(z&&this.annotationCanvasMap){V=V.slice(),V[4]-=C[0],V[5]-=C[1],C=C.slice(),C[0]=C[1]=0,C[2]=j,C[3]=J;const[X,ne]=s.Util.singularValueDecompose2dScale((0,o.getCurrentTransform)(this.ctx)),{viewportScale:ie}=this,fe=Math.ceil(j*this.outputScaleX*ie),ye=Math.ceil(J*this.outputScaleY*ie);this.annotationCanvas=this.canvasFactory.create(fe,ye);const{canvas:pe,context:te}=this.annotationCanvas;this.annotationCanvasMap.set(M,pe),this.annotationCanvas.savedCtx=this.ctx,this.ctx=te,this.ctx.save(),this.ctx.setTransform(X,0,0,-ne,0,J*ne),k(this.ctx)}else k(this.ctx),this.ctx.rect(C[0],C[1],j,J),this.ctx.clip(),this.endPath()}this.current=new se(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...V),this.transform(...O)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(M){if(!this.contentVisible)return;const C=M.count;M=this.getObject(M.data,M),M.count=C;const V=this.ctx,O=this.processingType3;if(O&&(O.compiled===void 0&&(O.compiled=Y(M)),O.compiled)){O.compiled(V);return}const z=this._createMaskCanvas(M),j=z.canvas;V.save(),V.setTransform(1,0,0,1,0,0),V.drawImage(j,z.offsetX,z.offsetY),V.restore(),this.compose()}paintImageMaskXObjectRepeat(M,C,V=0,O=0,z,j){if(!this.contentVisible)return;M=this.getObject(M.data,M);const J=this.ctx;J.save();const X=(0,o.getCurrentTransform)(J);J.transform(C,V,O,z,0,0);const ne=this._createMaskCanvas(M);J.setTransform(1,0,0,1,ne.offsetX-X[4],ne.offsetY-X[5]);for(let ie=0,fe=j.length;ie<fe;ie+=2){const ye=s.Util.transform(X,[C,V,O,z,j[ie],j[ie+1]]),[pe,te]=s.Util.applyTransform([0,0],ye);J.drawImage(ne.canvas,pe,te)}J.restore(),this.compose()}paintImageMaskXObjectGroup(M){if(!this.contentVisible)return;const C=this.ctx,V=this.current.fillColor,O=this.current.patternFill;for(const z of M){const{data:j,width:J,height:X,transform:ne}=z,ie=this.cachedCanvases.getCanvas("maskCanvas",J,X),fe=ie.context;fe.save();const ye=this.getObject(j,z);W(fe,ye),fe.globalCompositeOperation="source-in",fe.fillStyle=O?V.getPattern(fe,this,(0,o.getCurrentTransformInverse)(C),u.FILL):V,fe.fillRect(0,0,J,X),fe.restore(),C.save(),C.transform(...ne),C.scale(1,-1),D(C,ie.canvas,0,0,J,X,0,-1,1,1),C.restore()}this.compose()}paintImageXObject(M){if(!this.contentVisible)return;const C=this.getObject(M);if(!C){(0,s.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(C)}paintImageXObjectRepeat(M,C,V,O){if(!this.contentVisible)return;const z=this.getObject(M);if(!z){(0,s.warn)("Dependent image isn't ready yet");return}const j=z.width,J=z.height,X=[];for(let ne=0,ie=O.length;ne<ie;ne+=2)X.push({transform:[C,0,0,V,O[ne],O[ne+1]],x:0,y:0,w:j,h:J});this.paintInlineImageXObjectGroup(z,X)}applyTransferMapsToCanvas(M){return this.current.transferMaps!=="none"&&(M.filter=this.current.transferMaps,M.drawImage(M.canvas,0,0),M.filter="none"),M.canvas}applyTransferMapsToBitmap(M){if(this.current.transferMaps==="none")return M.bitmap;const{bitmap:C,width:V,height:O}=M,z=this.cachedCanvases.getCanvas("inlineImage",V,O),j=z.context;return j.filter=this.current.transferMaps,j.drawImage(C,0,0),j.filter="none",z.canvas}paintInlineImageXObject(M){if(!this.contentVisible)return;const C=M.width,V=M.height,O=this.ctx;if(this.save(),!s.isNodeJS){const{filter:J}=O;J!=="none"&&J!==""&&(O.filter="none")}O.scale(1/C,-1/V);let z;if(M.bitmap)z=this.applyTransferMapsToBitmap(M);else if(typeof HTMLElement=="function"&&M instanceof HTMLElement||!M.data)z=M;else{const X=this.cachedCanvases.getCanvas("inlineImage",C,V).context;re(X,M),z=this.applyTransferMapsToCanvas(X)}const j=this._scaleImage(z,(0,o.getCurrentTransformInverse)(O));O.imageSmoothingEnabled=le((0,o.getCurrentTransform)(O),M.interpolate),D(O,j.img,0,0,j.paintWidth,j.paintHeight,0,-V,C,V),this.compose(),this.restore()}paintInlineImageXObjectGroup(M,C){if(!this.contentVisible)return;const V=this.ctx;let O;if(M.bitmap)O=M.bitmap;else{const z=M.width,j=M.height,X=this.cachedCanvases.getCanvas("inlineImage",z,j).context;re(X,M),O=this.applyTransferMapsToCanvas(X)}for(const z of C)V.save(),V.transform(...z.transform),V.scale(1,-1),D(V,O,z.x,z.y,z.w,z.h,0,-1,1,1),V.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(M){}markPointProps(M,C){}beginMarkedContent(M){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(M,C){M==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(C)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(M){const C=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(M);const V=this.ctx;this.pendingClip&&(C||(this.pendingClip===we?V.clip("evenodd"):V.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),V.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const M=(0,o.getCurrentTransform)(this.ctx);if(M[1]===0&&M[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(M[0]),Math.abs(M[3]));else{const C=Math.abs(M[0]*M[3]-M[2]*M[1]),V=Math.hypot(M[0],M[2]),O=Math.hypot(M[1],M[3]);this._cachedGetSinglePixelWidth=Math.max(V,O)/C}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:M}=this.current,{a:C,b:V,c:O,d:z}=this.ctx.getTransform();let j,J;if(V===0&&O===0){const X=Math.abs(C),ne=Math.abs(z);if(X===ne)if(M===0)j=J=1/X;else{const ie=X*M;j=J=ie<1?1/ie:1}else if(M===0)j=1/X,J=1/ne;else{const ie=X*M,fe=ne*M;j=ie<1?1/ie:1,J=fe<1?1/fe:1}}else{const X=Math.abs(C*z-V*O),ne=Math.hypot(C,V),ie=Math.hypot(O,z);if(M===0)j=ie/X,J=ne/X;else{const fe=M*X;j=ie>fe?ie/fe:1,J=ne>fe?ne/fe:1}}this._cachedScaleForStroking[0]=j,this._cachedScaleForStroking[1]=J}return this._cachedScaleForStroking}rescaleAndStroke(M){const{ctx:C}=this,{lineWidth:V}=this.current,[O,z]=this.getScaleForStroking();if(C.lineWidth=V||1,O===1&&z===1){C.stroke();return}const j=C.getLineDash();if(M&&C.save(),C.scale(O,z),j.length>0){const J=Math.max(O,z);C.setLineDash(j.map(X=>X/J)),C.lineDashOffset/=J}C.stroke(),M&&C.restore()}isContentVisible(){for(let M=this.markedContentStack.length-1;M>=0;M--)if(!this.markedContentStack[M].visible)return!1;return!0}}for(const L in s.OPS)U.prototype[L]!==void 0&&(U.prototype[s.OPS[L]]=U.prototype[L])}),473:((n,e,t)=>{t.d(e,{DOMCMapReaderFactory:()=>f,DOMCanvasFactory:()=>g,DOMFilterFactory:()=>m,DOMSVGFactory:()=>r,DOMStandardFontDataFactory:()=>i,PDFDateString:()=>I,PageViewport:()=>d,PixelsPerInch:()=>l,RenderingCancelledException:()=>p,StatTimer:()=>w,fetchData:()=>h,getColorValues:()=>D,getCurrentTransform:()=>Y,getCurrentTransformInverse:()=>se,getFilenameFromUrl:()=>v,getPdfFilenameFromUrl:()=>T,getRGB:()=>B,getXfaPageViewport:()=>N,isDataScheme:()=>_,isPdfFile:()=>y,isValidFetchUrl:()=>E,noContextMenu:()=>P,setLayerDimensions:()=>re});var s=t(822),o=t(266);const u="http://www.w3.org/2000/svg";class l{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}class m extends s.BaseFilterFactory{#e;#t;#n;#r;#s;#i;#o;#l;#u;#c;#f=0;constructor({docId:$,ownerDocument:k=globalThis.document}={}){super(),this.#n=$,this.#r=k}get#h(){return this.#e||=new Map}get#d(){if(!this.#t){const $=this.#r.createElement("div"),{style:k}=$;k.visibility="hidden",k.contain="strict",k.width=k.height=0,k.position="absolute",k.top=k.left=0,k.zIndex=-1;const H=this.#r.createElementNS(u,"svg");H.setAttribute("width",0),H.setAttribute("height",0),this.#t=this.#r.createElementNS(u,"defs"),$.append(H),H.append(this.#t),this.#r.body.append($)}return this.#t}addFilter($){if(!$)return"none";let k=this.#h.get($);if(k)return k;let H,de,ee,ce;if($.length===1){const xe=$[0],Ee=new Array(256);for(let we=0;we<256;we++)Ee[we]=xe[we]/255;ce=H=de=ee=Ee.join(",")}else{const[xe,Ee,we]=$,U=new Array(256),L=new Array(256),M=new Array(256);for(let C=0;C<256;C++)U[C]=xe[C]/255,L[C]=Ee[C]/255,M[C]=we[C]/255;H=U.join(","),de=L.join(","),ee=M.join(","),ce=`${H}${de}${ee}`}if(k=this.#h.get(ce),k)return this.#h.set($,k),k;const q=`g_${this.#n}_transfer_map_${this.#f++}`,le=`url(#${q})`;this.#h.set($,le),this.#h.set(ce,le);const be=this.#p(q);return this.#y(H,de,ee,be),le}addHCMFilter($,k){const H=`${$}-${k}`;if(this.#i===H)return this.#o;if(this.#i=H,this.#o="none",this.#s?.remove(),!$||!k)return this.#o;const de=this.#b($);$=o.Util.makeHexColor(...de);const ee=this.#b(k);if(k=o.Util.makeHexColor(...ee),this.#d.style.color="",$==="#000000"&&k==="#ffffff"||$===k)return this.#o;const ce=new Array(256);for(let Ee=0;Ee<=255;Ee++){const we=Ee/255;ce[Ee]=we<=.03928?we/12.92:((we+.055)/1.055)**2.4}const q=ce.join(","),le=`g_${this.#n}_hcm_filter`,be=this.#l=this.#p(le);this.#y(q,q,q,be),this.#a(be);const xe=(Ee,we)=>{const U=de[Ee]/255,L=ee[Ee]/255,M=new Array(we+1);for(let C=0;C<=we;C++)M[C]=U+C/we*(L-U);return M.join(",")};return this.#y(xe(0,5),xe(1,5),xe(2,5),be),this.#o=`url(#${le})`,this.#o}addHighlightHCMFilter($,k,H,de){const ee=`${$}-${k}-${H}-${de}`;if(this.#u===ee)return this.#c;if(this.#u=ee,this.#c="none",this.#l?.remove(),!$||!k)return this.#c;const[ce,q]=[$,k].map(this.#b.bind(this));let le=Math.round(.2126*ce[0]+.7152*ce[1]+.0722*ce[2]),be=Math.round(.2126*q[0]+.7152*q[1]+.0722*q[2]),[xe,Ee]=[H,de].map(this.#b.bind(this));be<le&&([le,be,xe,Ee]=[be,le,Ee,xe]),this.#d.style.color="";const we=(M,C,V)=>{const O=new Array(256),z=(be-le)/V,j=M/255,J=(C-M)/(255*V);let X=0;for(let ne=0;ne<=V;ne++){const ie=Math.round(le+ne*z),fe=j+ne*J;for(let ye=X;ye<=ie;ye++)O[ye]=fe;X=ie+1}for(let ne=X;ne<256;ne++)O[ne]=O[X-1];return O.join(",")},U=`g_${this.#n}_hcm_highlight_filter`,L=this.#l=this.#p(U);return this.#a(L),this.#y(we(xe[0],Ee[0],5),we(xe[1],Ee[1],5),we(xe[2],Ee[2],5),L),this.#c=`url(#${U})`,this.#c}destroy($=!1){$&&(this.#o||this.#c)||(this.#t&&(this.#t.parentNode.parentNode.remove(),this.#t=null),this.#e&&(this.#e.clear(),this.#e=null),this.#f=0)}#a($){const k=this.#r.createElementNS(u,"feColorMatrix");k.setAttribute("type","matrix"),k.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),$.append(k)}#p($){const k=this.#r.createElementNS(u,"filter");return k.setAttribute("color-interpolation-filters","sRGB"),k.setAttribute("id",$),this.#d.append(k),k}#g($,k,H){const de=this.#r.createElementNS(u,k);de.setAttribute("type","discrete"),de.setAttribute("tableValues",H),$.append(de)}#y($,k,H,de){const ee=this.#r.createElementNS(u,"feComponentTransfer");de.append(ee),this.#g(ee,"feFuncR",$),this.#g(ee,"feFuncG",k),this.#g(ee,"feFuncB",H)}#b($){return this.#d.style.color=$,B(getComputedStyle(this.#d).getPropertyValue("color"))}}class g extends s.BaseCanvasFactory{constructor({ownerDocument:$=globalThis.document}={}){super(),this._document=$}_createCanvas($,k){const H=this._document.createElement("canvas");return H.width=$,H.height=k,H}}async function h(W,$="text"){if(E(W,document.baseURI)){const k=await fetch(W);if(!k.ok)throw new Error(k.statusText);switch($){case"arraybuffer":return k.arrayBuffer();case"blob":return k.blob();case"json":return k.json()}return k.text()}return new Promise((k,H)=>{const de=new XMLHttpRequest;de.open("GET",W,!0),de.responseType=$,de.onreadystatechange=()=>{if(de.readyState===XMLHttpRequest.DONE){if(de.status===200||de.status===0){let ee;switch($){case"arraybuffer":case"blob":case"json":ee=de.response;break;default:ee=de.responseText;break}if(ee){k(ee);return}}H(new Error(de.statusText))}},de.send(null)})}class f extends s.BaseCMapReaderFactory{_fetchData($,k){return h($,this.isCompressed?"arraybuffer":"text").then(H=>({cMapData:H instanceof ArrayBuffer?new Uint8Array(H):(0,o.stringToBytes)(H),compressionType:k}))}}class i extends s.BaseStandardFontDataFactory{_fetchData($){return h($,"arraybuffer").then(k=>new Uint8Array(k))}}class r extends s.BaseSVGFactory{_createSVG($){return document.createElementNS(u,$)}}class d{constructor({viewBox:$,scale:k,rotation:H,offsetX:de=0,offsetY:ee=0,dontFlip:ce=!1}){this.viewBox=$,this.scale=k,this.rotation=H,this.offsetX=de,this.offsetY=ee;const q=($[2]+$[0])/2,le=($[3]+$[1])/2;let be,xe,Ee,we;switch(H%=360,H<0&&(H+=360),H){case 180:be=-1,xe=0,Ee=0,we=1;break;case 90:be=0,xe=1,Ee=1,we=0;break;case 270:be=0,xe=-1,Ee=-1,we=0;break;case 0:be=1,xe=0,Ee=0,we=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}ce&&(Ee=-Ee,we=-we);let U,L,M,C;be===0?(U=Math.abs(le-$[1])*k+de,L=Math.abs(q-$[0])*k+ee,M=($[3]-$[1])*k,C=($[2]-$[0])*k):(U=Math.abs(q-$[0])*k+de,L=Math.abs(le-$[1])*k+ee,M=($[2]-$[0])*k,C=($[3]-$[1])*k),this.transform=[be*k,xe*k,Ee*k,we*k,U-be*k*q-Ee*k*le,L-xe*k*q-we*k*le],this.width=M,this.height=C}get rawDims(){const{viewBox:$}=this;return(0,o.shadow)(this,"rawDims",{pageWidth:$[2]-$[0],pageHeight:$[3]-$[1],pageX:$[0],pageY:$[1]})}clone({scale:$=this.scale,rotation:k=this.rotation,offsetX:H=this.offsetX,offsetY:de=this.offsetY,dontFlip:ee=!1}={}){return new d({viewBox:this.viewBox.slice(),scale:$,rotation:k,offsetX:H,offsetY:de,dontFlip:ee})}convertToViewportPoint($,k){return o.Util.applyTransform([$,k],this.transform)}convertToViewportRectangle($){const k=o.Util.applyTransform([$[0],$[1]],this.transform),H=o.Util.applyTransform([$[2],$[3]],this.transform);return[k[0],k[1],H[0],H[1]]}convertToPdfPoint($,k){return o.Util.applyInverseTransform([$,k],this.transform)}}class p extends o.BaseException{constructor($,k=0){super($,"RenderingCancelledException"),this.extraDelay=k}}function _(W){const $=W.length;let k=0;for(;k<$&&W[k].trim()==="";)k++;return W.substring(k,k+5).toLowerCase()==="data:"}function y(W){return typeof W=="string"&&/\.pdf$/i.test(W)}function v(W,$=!1){return $||([W]=W.split(/[#?]/,1)),W.substring(W.lastIndexOf("/")+1)}function T(W,$="document.pdf"){if(typeof W!="string")return $;if(_(W))return(0,o.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),$;const k=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,H=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,de=k.exec(W);let ee=H.exec(de[1])||H.exec(de[2])||H.exec(de[3]);if(ee&&(ee=ee[0],ee.includes("%")))try{ee=H.exec(decodeURIComponent(ee))[0]}catch{}return ee||$}class w{started=Object.create(null);times=[];time($){$ in this.started&&(0,o.warn)(`Timer is already running for ${$}`),this.started[$]=Date.now()}timeEnd($){$ in this.started||(0,o.warn)(`Timer has not been started for ${$}`),this.times.push({name:$,start:this.started[$],end:Date.now()}),delete this.started[$]}toString(){const $=[];let k=0;for(const{name:H}of this.times)k=Math.max(H.length,k);for(const{name:H,start:de,end:ee}of this.times)$.push(`${H.padEnd(k)} ${ee-de}ms
`);return $.join("")}}function E(W,$){try{const{protocol:k}=$?new URL(W,$):new URL(W);return k==="http:"||k==="https:"}catch{return!1}}function P(W){W.preventDefault()}let R;class I{static toDateObject($){if(!$||typeof $!="string")return null;R||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const k=R.exec($);if(!k)return null;const H=parseInt(k[1],10);let de=parseInt(k[2],10);de=de>=1&&de<=12?de-1:0;let ee=parseInt(k[3],10);ee=ee>=1&&ee<=31?ee:1;let ce=parseInt(k[4],10);ce=ce>=0&&ce<=23?ce:0;let q=parseInt(k[5],10);q=q>=0&&q<=59?q:0;let le=parseInt(k[6],10);le=le>=0&&le<=59?le:0;const be=k[7]||"Z";let xe=parseInt(k[8],10);xe=xe>=0&&xe<=23?xe:0;let Ee=parseInt(k[9],10)||0;return Ee=Ee>=0&&Ee<=59?Ee:0,be==="-"?(ce+=xe,q+=Ee):be==="+"&&(ce-=xe,q-=Ee),new Date(Date.UTC(H,de,ee,ce,q,le))}}function N(W,{scale:$=1,rotation:k=0}){const{width:H,height:de}=W.attributes.style,ee=[0,0,parseInt(H),parseInt(de)];return new d({viewBox:ee,scale:$,rotation:k})}function B(W){if(W.startsWith("#")){const $=parseInt(W.slice(1),16);return[($&16711680)>>16,($&65280)>>8,$&255]}return W.startsWith("rgb(")?W.slice(4,-1).split(",").map($=>parseInt($)):W.startsWith("rgba(")?W.slice(5,-1).split(",").map($=>parseInt($)).slice(0,3):((0,o.warn)(`Not a valid color format: "${W}"`),[0,0,0])}function D(W){const $=document.createElement("span");$.style.visibility="hidden",document.body.append($);for(const k of W.keys()){$.style.color=k;const H=window.getComputedStyle($).color;W.set(k,B(H))}$.remove()}function Y(W){const{a:$,b:k,c:H,d:de,e:ee,f:ce}=W.getTransform();return[$,k,H,de,ee,ce]}function se(W){const{a:$,b:k,c:H,d:de,e:ee,f:ce}=W.getTransform().invertSelf();return[$,k,H,de,ee,ce]}function re(W,$,k=!1,H=!0){if($ instanceof d){const{pageWidth:de,pageHeight:ee}=$.rawDims,{style:ce}=W,q=o.FeatureTest.isCSSRoundSupported,le=`var(--scale-factor) * ${de}px`,be=`var(--scale-factor) * ${ee}px`,xe=q?`round(${le}, 1px)`:`calc(${le})`,Ee=q?`round(${be}, 1px)`:`calc(${be})`;!k||$.rotation%180===0?(ce.width=xe,ce.height=Ee):(ce.width=Ee,ce.height=xe)}H&&W.setAttribute("data-main-rotation",$.rotation)}}),423:((n,e,t)=>{t.d(e,{DrawLayer:()=>u});var s=t(473),o=t(266);class u{#e=null;#t=0;#n=new Map;constructor({pageIndex:m}){this.pageIndex=m}setParent(m){if(!this.#e){this.#e=m;return}if(this.#e!==m){if(this.#n.size>0)for(const g of this.#n.values())g.remove(),m.append(g);this.#e=m}}static get _svgFactory(){return(0,o.shadow)(this,"_svgFactory",new s.DOMSVGFactory)}static#r(m,{x:g,y:h,width:f,height:i}){const{style:r}=m;r.top=`${100*h}%`,r.left=`${100*g}%`,r.width=`${100*f}%`,r.height=`${100*i}%`}#s(m){const g=u._svgFactory.create(1,1,!0);return this.#e.append(g),u.#r(g,m),g}highlight({outlines:m,box:g},h,f){const i=this.#t++,r=this.#s(g);r.classList.add("highlight");const d=u._svgFactory.createElement("defs");r.append(d);const p=u._svgFactory.createElement("path");d.append(p);const _=`path_p${this.pageIndex}_${i}`;p.setAttribute("id",_),p.setAttribute("d",u.#i(m));const y=u._svgFactory.createElement("clipPath");d.append(y);const v=`clip_${_}`;y.setAttribute("id",v),y.setAttribute("clipPathUnits","objectBoundingBox");const T=u._svgFactory.createElement("use");y.append(T),T.setAttribute("href",`#${_}`),T.classList.add("clip");const w=u._svgFactory.createElement("use");return r.append(w),r.setAttribute("fill",h),r.setAttribute("fill-opacity",f),w.setAttribute("href",`#${_}`),this.#n.set(i,r),{id:i,clipPathId:`url(#${v})`}}highlightOutline({outlines:m,box:g}){const h=this.#t++,f=this.#s(g);f.classList.add("highlightOutline");const i=u._svgFactory.createElement("defs");f.append(i);const r=u._svgFactory.createElement("path");i.append(r);const d=`path_p${this.pageIndex}_${h}`;r.setAttribute("id",d),r.setAttribute("d",u.#i(m)),r.setAttribute("vector-effect","non-scaling-stroke");const p=u._svgFactory.createElement("use");f.append(p),p.setAttribute("href",`#${d}`);const _=p.cloneNode();return f.append(_),p.classList.add("mainOutline"),_.classList.add("secondaryOutline"),this.#n.set(h,f),h}static#i(m){const g=[];for(const h of m){let[f,i]=h;g.push(`M${f} ${i}`);for(let r=2;r<h.length;r+=2){const d=h[r],p=h[r+1];d===f?(g.push(`V${p}`),i=p):p===i&&(g.push(`H${d}`),f=d)}g.push("Z")}return g.join(" ")}updateBox(m,g){u.#r(this.#n.get(m),g)}rotate(m,g){this.#n.get(m).setAttribute("data-main-rotation",g)}changeColor(m,g){this.#n.get(m).setAttribute("fill",g)}changeOpacity(m,g){this.#n.get(m).setAttribute("fill-opacity",g)}addClass(m,g){this.#n.get(m).classList.add(g)}removeClass(m,g){this.#n.get(m).classList.remove(g)}remove(m){this.#e!==null&&(this.#n.get(m).remove(),this.#n.delete(m))}destroy(){this.#e=null;for(const m of this.#n.values())m.remove();this.#n.clear()}}}),629:((n,e,t)=>{t.d(e,{AnnotationEditorLayer:()=>p});var s=t(266),o=t(115),u=t(812),l=t(640);class m extends o.AnnotationEditor{#e=this.editorDivBlur.bind(this);#t=this.editorDivFocus.bind(this);#n=this.editorDivInput.bind(this);#r=this.editorDivKeydown.bind(this);#s;#i="";#o=`${this.id}-editor`;#l;#u=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const y=m.prototype,v=E=>E.isEmpty(),T=u.AnnotationEditorUIManager.TRANSLATE_SMALL,w=u.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,s.shadow)(this,"_keyboardManager",new u.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],y.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],y.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],y._translateEmpty,{args:[-T,0],checker:v}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],y._translateEmpty,{args:[-w,0],checker:v}],[["ArrowRight","mac+ArrowRight"],y._translateEmpty,{args:[T,0],checker:v}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],y._translateEmpty,{args:[w,0],checker:v}],[["ArrowUp","mac+ArrowUp"],y._translateEmpty,{args:[0,-T],checker:v}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],y._translateEmpty,{args:[0,-w],checker:v}],[["ArrowDown","mac+ArrowDown"],y._translateEmpty,{args:[0,T],checker:v}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],y._translateEmpty,{args:[0,w],checker:v}]]))}static _type="freetext";static _editorType=s.AnnotationEditorType.FREETEXT;constructor(y){super({...y,name:"freeTextEditor"}),this.#s=y.color||m._defaultColor||o.AnnotationEditor._defaultLineColor,this.#l=y.fontSize||m._defaultFontSize}static initialize(y){o.AnnotationEditor.initialize(y,{strings:["pdfjs-free-text-default-content"]});const v=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(v.getPropertyValue("--freetext-padding"))}static updateDefaultParams(y,v){switch(y){case s.AnnotationEditorParamsType.FREETEXT_SIZE:m._defaultFontSize=v;break;case s.AnnotationEditorParamsType.FREETEXT_COLOR:m._defaultColor=v;break}}updateParams(y,v){switch(y){case s.AnnotationEditorParamsType.FREETEXT_SIZE:this.#c(v);break;case s.AnnotationEditorParamsType.FREETEXT_COLOR:this.#f(v);break}}static get defaultPropertiesToUpdate(){return[[s.AnnotationEditorParamsType.FREETEXT_SIZE,m._defaultFontSize],[s.AnnotationEditorParamsType.FREETEXT_COLOR,m._defaultColor||o.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[s.AnnotationEditorParamsType.FREETEXT_SIZE,this.#l],[s.AnnotationEditorParamsType.FREETEXT_COLOR,this.#s]]}#c(y){const v=w=>{this.editorDiv.style.fontSize=`calc(${w}px * var(--scale-factor))`,this.translate(0,-(w-this.#l)*this.parentScale),this.#l=w,this.#d()},T=this.#l;this.addCommands({cmd:()=>{v(y)},undo:()=>{v(T)},mustExec:!0,type:s.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#f(y){const v=this.#s;this.addCommands({cmd:()=>{this.#s=this.editorDiv.style.color=y},undo:()=>{this.#s=this.editorDiv.style.color=v},mustExec:!0,type:s.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(y,v){this._uiManager.translateSelectedEditors(y,v,!0)}getInitialTranslation(){const y=this.parentScale;return[-m._internalPadding*y,-(m._internalPadding+this.#l)*y]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(s.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#r),this.editorDiv.addEventListener("focus",this.#t),this.editorDiv.addEventListener("blur",this.#e),this.editorDiv.addEventListener("input",this.#n))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#o),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#r),this.editorDiv.removeEventListener("focus",this.#t),this.editorDiv.removeEventListener("blur",this.#e),this.editorDiv.removeEventListener("input",this.#n),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(y){this._focusEventsAllowed&&(super.focusin(y),y.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){if(this.width){this.#g();return}this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#h(){const y=this.editorDiv.getElementsByTagName("div");if(y.length===0)return this.editorDiv.innerText;const v=[];for(const T of y)v.push(T.innerText.replace(/\r\n?|\n/,""));return v.join(`
`)}#d(){const[y,v]=this.parentDimensions;let T;if(this.isAttachedToDOM)T=this.div.getBoundingClientRect();else{const{currentLayer:w,div:E}=this,P=E.style.display;E.style.display="hidden",w.div.append(this.div),T=E.getBoundingClientRect(),E.remove(),E.style.display=P}this.rotation%180===this.parentRotation%180?(this.width=T.width/y,this.height=T.height/v):(this.width=T.height/y,this.height=T.width/v),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const y=this.#i,v=this.#i=this.#h().trimEnd();if(y===v)return;const T=w=>{if(this.#i=w,!w){this.remove();return}this.#a(),this._uiManager.rebuild(this),this.#d()};this.addCommands({cmd:()=>{T(v)},undo:()=>{T(y)},mustExec:!1}),this.#d()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(y){this.enterInEditMode()}keydown(y){y.target===this.div&&y.key==="Enter"&&(this.enterInEditMode(),y.preventDefault())}editorDivKeydown(y){m._keyboardManager.exec(this,y)}editorDivFocus(y){this.isEditing=!0}editorDivBlur(y){this.isEditing=!1}editorDivInput(y){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let y,v;this.width&&(y=this.x,v=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#o),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),o.AnnotationEditor._l10nPromise.get("pdfjs-free-text-default-content").then(w=>this.editorDiv?.setAttribute("default-content",w)),this.editorDiv.contentEditable=!0;const{style:T}=this.editorDiv;if(T.fontSize=`calc(${this.#l}px * var(--scale-factor))`,T.color=this.#s,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,u.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[w,E]=this.parentDimensions;if(this.annotationElementId){const{position:P}=this.#u;let[R,I]=this.getInitialTranslation();[R,I]=this.pageTranslationToScreen(R,I);const[N,B]=this.pageDimensions,[D,Y]=this.pageTranslation;let se,re;switch(this.rotation){case 0:se=y+(P[0]-D)/N,re=v+this.height-(P[1]-Y)/B;break;case 90:se=y+(P[0]-D)/N,re=v-(P[1]-Y)/B,[R,I]=[I,-R];break;case 180:se=y-this.width+(P[0]-D)/N,re=v-(P[1]-Y)/B,[R,I]=[-R,-I];break;case 270:se=y+(P[0]-D-this.height*B)/N,re=v+(P[1]-Y-this.width*N)/B,[R,I]=[-I,R];break}this.setAt(se*w,re*E,R,I)}else this.setAt(y*w,v*E,this.width*w,this.height*E);this.#a(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}#a(){if(this.editorDiv.replaceChildren(),!!this.#i)for(const y of this.#i.split(`
`)){const v=document.createElement("div");v.append(y?document.createTextNode(y):document.createElement("br")),this.editorDiv.append(v)}}get contentDiv(){return this.editorDiv}static deserialize(y,v,T){let w=null;if(y instanceof l.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:P,fontColor:R},rect:I,rotation:N,id:B},textContent:D,textPosition:Y,parent:{page:{pageNumber:se}}}=y;if(!D||D.length===0)return null;w=y={annotationType:s.AnnotationEditorType.FREETEXT,color:Array.from(R),fontSize:P,value:D.join(`
`),position:Y,pageIndex:se-1,rect:I,rotation:N,id:B,deleted:!1}}const E=super.deserialize(y,v,T);return E.#l=y.fontSize,E.#s=s.Util.makeHexColor(...y.color),E.#i=y.value,E.annotationElementId=y.id||null,E.#u=w,E}serialize(y=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const v=m._internalPadding*this.parentScale,T=this.getRect(v,v),w=o.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#s),E={annotationType:s.AnnotationEditorType.FREETEXT,color:w,fontSize:this.#l,value:this.#i,pageIndex:this.pageIndex,rect:T,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return y?E:this.annotationElementId&&!this.#p(E)?null:(E.id=this.annotationElementId,E)}#p(y){const{value:v,fontSize:T,color:w,rect:E,pageIndex:P}=this.#u;return y.value!==v||y.fontSize!==T||y.rect.some((R,I)=>Math.abs(R-E[I])>=1)||y.color.some((R,I)=>R!==w[I])||y.pageIndex!==P}#g(y=!1){if(!this.annotationElementId)return;if(this.#d(),!y&&(this.width===0||this.height===0)){setTimeout(()=>this.#g(!0),0);return}const v=m._internalPadding*this.parentScale;this.#u.rect=this.getRect(v,v)}}var g=t(97),h=t(405);class f extends o.AnnotationEditor{#e;#t=null;#n=null;#r=null;#s=null;#i=null;#o=null;#l=null;#u;#c=null;static _defaultColor=null;static _defaultOpacity=1;static _l10nPromise;static _type="highlight";static _editorType=s.AnnotationEditorType.HIGHLIGHT;constructor(y){super({...y,name:"highlightEditor"}),f._defaultColor||=this._uiManager.highlightColors?.values().next().value||"#fff066",this.color=y.color||f._defaultColor,this.#u=y.opacity||f._defaultOpacity,this.#e=y.boxes||null,this._isDraggable=!1,this.#f(),this.#a(),this.rotate(this.rotation)}#f(){const y=new h.Outliner(this.#e,.001);this.#i=y.getOutlines(),{x:this.x,y:this.y,width:this.width,height:this.height}=this.#i.box;const v=new h.Outliner(this.#e,.0025,.001,this._uiManager.direction==="ltr");this.#r=v.getOutlines();const{lastPoint:T}=this.#r.box;this.#l=[(T[0]-this.x)/this.width,(T[1]-this.y)/this.height]}static initialize(y){o.AnnotationEditor.initialize(y)}static updateDefaultParams(y,v){switch(y){case s.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:f._defaultColor=v;break}}get toolbarPosition(){return this.#l}updateParams(y,v){switch(y){case s.AnnotationEditorParamsType.HIGHLIGHT_COLOR:this.#h(v);break}}static get defaultPropertiesToUpdate(){return[[s.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,f._defaultColor]]}get propertiesToUpdate(){return[[s.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||f._defaultColor]]}#h(y){const v=this.color;this.addCommands({cmd:()=>{this.color=y,this.parent.drawLayer.changeColor(this.#o,y),this.#n?.updateColor(y)},undo:()=>{this.color=v,this.parent.drawLayer.changeColor(this.#o,v),this.#n?.updateColor(v)},mustExec:!0,type:s.AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}async addEditToolbar(){const y=await super.addEditToolbar();return y?(this._uiManager.highlightColors&&(this.#n=new g.ColorPicker({editor:this}),y.addColorPicker(this.#n)),y):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(0)}getRect(y,v){return super.getRect(y,v,0)}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){super.remove(),this.#d()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#a(),this.isAttachedToDOM||this.parent.add(this)))}setParent(y){let v=!1;this.parent&&!y?this.#d():y&&(this.#a(y),v=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(y),v&&this.select()}#d(){this.#o===null||!this.parent||(this.parent.drawLayer.remove(this.#o),this.#o=null,this.parent.drawLayer.remove(this.#c),this.#c=null)}#a(y=this.parent){this.#o===null&&({id:this.#o,clipPathId:this.#t}=y.drawLayer.highlight(this.#i,this.color,this.#u),this.#s&&(this.#s.style.clipPath=this.#t),this.#c=y.drawLayer.highlightOutline(this.#r))}static#p({x:y,y:v,width:T,height:w},E){switch(E){case 90:return{x:1-v-w,y,width:w,height:T};case 180:return{x:1-y-T,y:1-v-w,width:T,height:w};case 270:return{x:v,y:1-y-T,width:w,height:T}}return{x:y,y:v,width:T,height:w}}rotate(y){const{drawLayer:v}=this.parent;v.rotate(this.#o,y),v.rotate(this.#c,y),v.updateBox(this.#o,f.#p(this,y)),v.updateBox(this.#c,f.#p(this.#r.box,y))}render(){if(this.div)return this.div;const y=super.render(),v=this.#s=document.createElement("div");y.append(v),v.className="internal",v.style.clipPath=this.#t;const[T,w]=this.parentDimensions;return this.setDims(this.width*T,this.height*w),(0,u.bindEvents)(this,this.#s,["pointerover","pointerleave"]),this.enableEditing(),y}pointerover(){this.parent.drawLayer.addClass(this.#c,"hovered")}pointerleave(){this.parent.drawLayer.removeClass(this.#c,"hovered")}select(){super.select(),this.parent?.drawLayer.removeClass(this.#c,"hovered"),this.parent?.drawLayer.addClass(this.#c,"selected")}unselect(){super.unselect(),this.parent?.drawLayer.removeClass(this.#c,"selected")}#g(){const[y,v]=this.pageDimensions,T=this.#e,w=new Array(T.length*8);let E=0;for(const{x:P,y:R,width:I,height:N}of T){const B=P*y,D=(1-R-N)*v;w[E]=w[E+4]=B,w[E+1]=w[E+3]=D,w[E+2]=w[E+6]=B+I*y,w[E+5]=w[E+7]=D+N*v,E+=8}return w}#y(){const[y,v]=this.pageDimensions,T=this.width*y,w=this.height*v,E=this.x*y,P=(1-this.y-this.height)*v,R=[];for(const I of this.#i.outlines){const N=new Array(I.length);for(let B=0;B<I.length;B+=2)N[B]=E+I[B]*T,N[B+1]=P+(1-I[B+1])*w;R.push(N)}return R}static deserialize(y,v,T){const w=super.deserialize(y,v,T),{rect:E,color:P,quadPoints:R}=y;w.color=s.Util.makeHexColor(...P),w.#u=y.opacity;const[I,N]=w.pageDimensions;w.width=(E[2]-E[0])/I,w.height=(E[3]-E[1])/N;const B=w.#e=[];for(let D=0;D<R.length;D+=8)B.push({x:R[4]/I,y:1-R[D+5]/N,width:(R[D+2]-R[D])/I,height:(R[D+5]-R[D+1])/N});return w.#f(),w}serialize(y=!1){if(this.isEmpty()||y)return null;const v=this.getRect(0,0),T=o.AnnotationEditor._colorManager.convert(this.color);return{annotationType:s.AnnotationEditorType.HIGHLIGHT,color:T,opacity:this.#u,quadPoints:this.#g(),outlines:this.#y(),pageIndex:this.pageIndex,rect:v,rotation:0,structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}}var i=t(473);class r extends o.AnnotationEditor{#e=0;#t=0;#n=this.canvasPointermove.bind(this);#r=this.canvasPointerleave.bind(this);#s=this.canvasPointerup.bind(this);#i=this.canvasPointerdown.bind(this);#o=null;#l=new Path2D;#u=!1;#c=!1;#f=!1;#h=null;#d=0;#a=0;#p=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=s.AnnotationEditorType.INK;constructor(y){super({...y,name:"inkEditor"}),this.color=y.color||null,this.thickness=y.thickness||null,this.opacity=y.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(y){o.AnnotationEditor.initialize(y)}static updateDefaultParams(y,v){switch(y){case s.AnnotationEditorParamsType.INK_THICKNESS:r._defaultThickness=v;break;case s.AnnotationEditorParamsType.INK_COLOR:r._defaultColor=v;break;case s.AnnotationEditorParamsType.INK_OPACITY:r._defaultOpacity=v/100;break}}updateParams(y,v){switch(y){case s.AnnotationEditorParamsType.INK_THICKNESS:this.#g(v);break;case s.AnnotationEditorParamsType.INK_COLOR:this.#y(v);break;case s.AnnotationEditorParamsType.INK_OPACITY:this.#b(v);break}}static get defaultPropertiesToUpdate(){return[[s.AnnotationEditorParamsType.INK_THICKNESS,r._defaultThickness],[s.AnnotationEditorParamsType.INK_COLOR,r._defaultColor||o.AnnotationEditor._defaultLineColor],[s.AnnotationEditorParamsType.INK_OPACITY,Math.round(r._defaultOpacity*100)]]}get propertiesToUpdate(){return[[s.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||r._defaultThickness],[s.AnnotationEditorParamsType.INK_COLOR,this.color||r._defaultColor||o.AnnotationEditor._defaultLineColor],[s.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??r._defaultOpacity))]]}#g(y){const v=this.thickness;this.addCommands({cmd:()=>{this.thickness=y,this.#M()},undo:()=>{this.thickness=v,this.#M()},mustExec:!0,type:s.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#y(y){const v=this.color;this.addCommands({cmd:()=>{this.color=y,this.#x()},undo:()=>{this.color=v,this.#x()},mustExec:!0,type:s.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#b(y){y/=100;const v=this.opacity;this.addCommands({cmd:()=>{this.opacity=y,this.#x()},undo:()=>{this.opacity=v,this.#x()},mustExec:!0,type:s.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#S(),this.#T()),this.isAttachedToDOM||(this.parent.add(this),this.#R()),this.#M()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#o&&(clearTimeout(this.#o),this.#o=null),this.#h.disconnect(),this.#h=null,super.remove())}setParent(y){!this.parent&&y?this._uiManager.removeShouldRescale(this):this.parent&&y===null&&this._uiManager.addShouldRescale(this),super.setParent(y)}onScaleChanging(){const[y,v]=this.parentDimensions,T=this.width*y,w=this.height*v;this.setDimensions(T,w)}enableEditMode(){this.#u||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#i))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#i))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#v(){const{parentRotation:y,parentDimensions:[v,T]}=this;switch(y){case 90:return[0,T,T,v];case 180:return[v,T,v,T];case 270:return[v,0,T,v];default:return[0,0,v,T]}}#_(){const{ctx:y,color:v,opacity:T,thickness:w,parentScale:E,scaleFactor:P}=this;y.lineWidth=w*E/P,y.lineCap="round",y.lineJoin="round",y.miterLimit=10,y.strokeStyle=`${v}${(0,u.opacityToHex)(T)}`}#m(y,v){this.canvas.addEventListener("contextmenu",i.noContextMenu),this.canvas.addEventListener("pointerleave",this.#r),this.canvas.addEventListener("pointermove",this.#n),this.canvas.addEventListener("pointerup",this.#s),this.canvas.removeEventListener("pointerdown",this.#i),this.isEditing=!0,this.#f||(this.#f=!0,this.#R(),this.thickness||=r._defaultThickness,this.color||=r._defaultColor||o.AnnotationEditor._defaultLineColor,this.opacity??=r._defaultOpacity),this.currentPath.push([y,v]),this.#c=!1,this.#_(),this.#p=()=>{this.#V(),this.#p&&window.requestAnimationFrame(this.#p)},window.requestAnimationFrame(this.#p)}#E(y,v){const[T,w]=this.currentPath.at(-1);if(this.currentPath.length>1&&y===T&&v===w)return;const E=this.currentPath;let P=this.#l;if(E.push([y,v]),this.#c=!0,E.length<=2){P.moveTo(...E[0]),P.lineTo(y,v);return}E.length===3&&(this.#l=P=new Path2D,P.moveTo(...E[0])),this.#N(P,...E.at(-3),...E.at(-2),y,v)}#I(){if(this.currentPath.length===0)return;const y=this.currentPath.at(-1);this.#l.lineTo(...y)}#B(y,v){this.#p=null,y=Math.min(Math.max(y,0),this.canvas.width),v=Math.min(Math.max(v,0),this.canvas.height),this.#E(y,v),this.#I();let T;if(this.currentPath.length!==1)T=this.#O();else{const I=[y,v];T=[[I,I.slice(),I.slice(),I]]}const w=this.#l,E=this.currentPath;this.currentPath=[],this.#l=new Path2D;const P=()=>{this.allRawPaths.push(E),this.paths.push(T),this.bezierPath2D.push(w),this.rebuild()},R=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#S(),this.#T()),this.#M())};this.addCommands({cmd:P,undo:R,mustExec:!0})}#V(){if(!this.#c)return;this.#c=!1;const y=Math.ceil(this.thickness*this.parentScale),v=this.currentPath.slice(-3),T=v.map(P=>P[0]),w=v.map(P=>P[1]);Math.min(...T)-y,Math.max(...T)+y,Math.min(...w)-y,Math.max(...w)+y;const{ctx:E}=this;E.save(),E.clearRect(0,0,this.canvas.width,this.canvas.height);for(const P of this.bezierPath2D)E.stroke(P);E.stroke(this.#l),E.restore()}#N(y,v,T,w,E,P,R){const I=(v+w)/2,N=(T+E)/2,B=(w+P)/2,D=(E+R)/2;y.bezierCurveTo(I+2*(w-I)/3,N+2*(E-N)/3,B+2*(w-B)/3,D+2*(E-D)/3,B,D)}#O(){const y=this.currentPath;if(y.length<=2)return[[y[0],y[0],y.at(-1),y.at(-1)]];const v=[];let T,[w,E]=y[0];for(T=1;T<y.length-2;T++){const[Y,se]=y[T],[re,W]=y[T+1],$=(Y+re)/2,k=(se+W)/2,H=[w+2*(Y-w)/3,E+2*(se-E)/3],de=[$+2*(Y-$)/3,k+2*(se-k)/3];v.push([[w,E],H,de,[$,k]]),[w,E]=[$,k]}const[P,R]=y[T],[I,N]=y[T+1],B=[w+2*(P-w)/3,E+2*(R-E)/3],D=[I+2*(P-I)/3,N+2*(R-N)/3];return v.push([[w,E],B,D,[I,N]]),v}#x(){if(this.isEmpty()){this.#P();return}this.#_();const{canvas:y,ctx:v}=this;v.setTransform(1,0,0,1,0,0),v.clearRect(0,0,y.width,y.height),this.#P();for(const T of this.bezierPath2D)v.stroke(T)}commit(){this.#u||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#u=!0,this.div.classList.add("disabled"),this.#M(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(y){this._focusEventsAllowed&&(super.focusin(y),this.enableEditMode())}canvasPointerdown(y){y.button!==0||!this.isInEditMode()||this.#u||(this.setInForeground(),y.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#m(y.offsetX,y.offsetY))}canvasPointermove(y){y.preventDefault(),this.#E(y.offsetX,y.offsetY)}canvasPointerup(y){y.preventDefault(),this.#k(y)}canvasPointerleave(y){this.#k(y)}#k(y){this.canvas.removeEventListener("pointerleave",this.#r),this.canvas.removeEventListener("pointermove",this.#n),this.canvas.removeEventListener("pointerup",this.#s),this.canvas.addEventListener("pointerdown",this.#i),this.#o&&clearTimeout(this.#o),this.#o=setTimeout(()=>{this.#o=null,this.canvas.removeEventListener("contextmenu",i.noContextMenu)},10),this.#B(y.offsetX,y.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#S(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#T(){this.#h=new ResizeObserver(y=>{const v=y[0].contentRect;v.width&&v.height&&this.setDimensions(v.width,v.height)}),this.#h.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#u}render(){if(this.div)return this.div;let y,v;this.width&&(y=this.x,v=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[T,w,E,P]=this.#v();if(this.setAt(T,w,0,0),this.setDims(E,P),this.#S(),this.width){const[R,I]=this.parentDimensions;this.setAspectRatio(this.width*R,this.height*I),this.setAt(y*R,v*I,this.width*R,this.height*I),this.#f=!0,this.#R(),this.setDims(this.width*R,this.height*I),this.#x(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#T(),this.div}#R(){if(!this.#f)return;const[y,v]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*y),this.canvas.height=Math.ceil(this.height*v),this.#P()}setDimensions(y,v){const T=Math.round(y),w=Math.round(v);if(this.#d===T&&this.#a===w)return;this.#d=T,this.#a=w,this.canvas.style.visibility="hidden";const[E,P]=this.parentDimensions;this.width=y/E,this.height=v/P,this.fixAndSetPosition(),this.#u&&this.#L(y,v),this.#R(),this.#x(),this.canvas.style.visibility="visible",this.fixDims()}#L(y,v){const T=this.#D(),w=(y-T)/this.#t,E=(v-T)/this.#e;this.scaleFactor=Math.min(w,E)}#P(){const y=this.#D()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+y,this.translationY*this.scaleFactor+y)}static#A(y){const v=new Path2D;for(let T=0,w=y.length;T<w;T++){const[E,P,R,I]=y[T];T===0&&v.moveTo(...E),v.bezierCurveTo(P[0],P[1],R[0],R[1],I[0],I[1])}return v}static#C(y,v,T){const[w,E,P,R]=v;switch(T){case 0:for(let I=0,N=y.length;I<N;I+=2)y[I]+=w,y[I+1]=R-y[I+1];break;case 90:for(let I=0,N=y.length;I<N;I+=2){const B=y[I];y[I]=y[I+1]+w,y[I+1]=B+E}break;case 180:for(let I=0,N=y.length;I<N;I+=2)y[I]=P-y[I],y[I+1]+=E;break;case 270:for(let I=0,N=y.length;I<N;I+=2){const B=y[I];y[I]=P-y[I+1],y[I+1]=R-B}break;default:throw new Error("Invalid rotation")}return y}static#U(y,v,T){const[w,E,P,R]=v;switch(T){case 0:for(let I=0,N=y.length;I<N;I+=2)y[I]-=w,y[I+1]=R-y[I+1];break;case 90:for(let I=0,N=y.length;I<N;I+=2){const B=y[I];y[I]=y[I+1]-E,y[I+1]=B-w}break;case 180:for(let I=0,N=y.length;I<N;I+=2)y[I]=P-y[I],y[I+1]-=E;break;case 270:for(let I=0,N=y.length;I<N;I+=2){const B=y[I];y[I]=R-y[I+1],y[I+1]=P-B}break;default:throw new Error("Invalid rotation")}return y}#$(y,v,T,w){const E=[],P=this.thickness/2,R=y*v+P,I=y*T+P;for(const N of this.paths){const B=[],D=[];for(let Y=0,se=N.length;Y<se;Y++){const[re,W,$,k]=N[Y],H=y*re[0]+R,de=y*re[1]+I,ee=y*W[0]+R,ce=y*W[1]+I,q=y*$[0]+R,le=y*$[1]+I,be=y*k[0]+R,xe=y*k[1]+I;Y===0&&(B.push(H,de),D.push(H,de)),B.push(ee,ce,q,le,be,xe),D.push(ee,ce),Y===se-1&&D.push(be,xe)}E.push({bezier:r.#C(B,w,this.rotation),points:r.#C(D,w,this.rotation)})}return E}#F(){let y=1/0,v=-1/0,T=1/0,w=-1/0;for(const E of this.paths)for(const[P,R,I,N]of E){const B=s.Util.bezierBoundingBox(...P,...R,...I,...N);y=Math.min(y,B[0]),T=Math.min(T,B[1]),v=Math.max(v,B[2]),w=Math.max(w,B[3])}return[y,T,v,w]}#D(){return this.#u?Math.ceil(this.thickness*this.parentScale):0}#M(y=!1){if(this.isEmpty())return;if(!this.#u){this.#x();return}const v=this.#F(),T=this.#D();this.#t=Math.max(o.AnnotationEditor.MIN_SIZE,v[2]-v[0]),this.#e=Math.max(o.AnnotationEditor.MIN_SIZE,v[3]-v[1]);const w=Math.ceil(T+this.#t*this.scaleFactor),E=Math.ceil(T+this.#e*this.scaleFactor),[P,R]=this.parentDimensions;this.width=w/P,this.height=E/R,this.setAspectRatio(w,E);const I=this.translationX,N=this.translationY;this.translationX=-v[0],this.translationY=-v[1],this.#R(),this.#x(),this.#d=w,this.#a=E,this.setDims(w,E);const B=y?T/this.scaleFactor/2:0;this.translate(I-this.translationX-B,N-this.translationY-B)}static deserialize(y,v,T){if(y instanceof l.InkAnnotationElement)return null;const w=super.deserialize(y,v,T);w.thickness=y.thickness,w.color=s.Util.makeHexColor(...y.color),w.opacity=y.opacity;const[E,P]=w.pageDimensions,R=w.width*E,I=w.height*P,N=w.parentScale,B=y.thickness/2;w.#u=!0,w.#d=Math.round(R),w.#a=Math.round(I);const{paths:D,rect:Y,rotation:se}=y;for(let{bezier:W}of D){W=r.#U(W,Y,se);const $=[];w.paths.push($);let k=N*(W[0]-B),H=N*(W[1]-B);for(let ee=2,ce=W.length;ee<ce;ee+=6){const q=N*(W[ee]-B),le=N*(W[ee+1]-B),be=N*(W[ee+2]-B),xe=N*(W[ee+3]-B),Ee=N*(W[ee+4]-B),we=N*(W[ee+5]-B);$.push([[k,H],[q,le],[be,xe],[Ee,we]]),k=Ee,H=we}const de=this.#A($);w.bezierPath2D.push(de)}const re=w.#F();return w.#t=Math.max(o.AnnotationEditor.MIN_SIZE,re[2]-re[0]),w.#e=Math.max(o.AnnotationEditor.MIN_SIZE,re[3]-re[1]),w.#L(R,I),w}serialize(){if(this.isEmpty())return null;const y=this.getRect(0,0),v=o.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:s.AnnotationEditorType.INK,color:v,thickness:this.thickness,opacity:this.opacity,paths:this.#$(this.scaleFactor/this.parentScale,this.translationX,this.translationY,y),pageIndex:this.pageIndex,rect:y,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class d extends o.AnnotationEditor{#e=null;#t=null;#n=null;#r=null;#s=null;#i="";#o=null;#l=null;#u=null;#c=!1;#f=!1;static _type="stamp";static _editorType=s.AnnotationEditorType.STAMP;constructor(y){super({...y,name:"stampEditor"}),this.#r=y.bitmapUrl,this.#s=y.bitmapFile}static initialize(y){o.AnnotationEditor.initialize(y)}static get supportedTypes(){const y=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,s.shadow)(this,"supportedTypes",y.map(v=>`image/${v}`))}static get supportedTypesStr(){return(0,s.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(y){return this.supportedTypes.includes(y)}static paste(y,v){v.pasteEditor(s.AnnotationEditorType.STAMP,{bitmapFile:y.getAsFile()})}#h(y,v=!1){if(!y){this.remove();return}this.#e=y.bitmap,v||(this.#t=y.id,this.#c=y.isSvg),y.file&&(this.#i=y.file.name),this.#p()}#d(){this.#n=null,this._uiManager.enableWaiting(!1),this.#o&&this.div.focus()}#a(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(v=>this.#h(v,!0)).finally(()=>this.#d());return}if(this.#r){const v=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(v).then(T=>this.#h(T)).finally(()=>this.#d());return}if(this.#s){const v=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(v).then(T=>this.#h(T)).finally(()=>this.#d());return}const y=document.createElement("input");y.type="file",y.accept=d.supportedTypesStr,this.#n=new Promise(v=>{y.addEventListener("change",async()=>{if(!y.files||y.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const T=await this._uiManager.imageManager.getFromFile(y.files[0]);this.#h(T)}v()}),y.addEventListener("cancel",()=>{this.remove(),v()})}).finally(()=>this.#d()),y.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#o?.remove(),this.#o=null,this.#l?.disconnect(),this.#l=null,this.#u&&(clearTimeout(this.#u),this.#u=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#a();return}super.rebuild(),this.div!==null&&(this.#t&&this.#a(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#n||this.#e||this.#r||this.#s)}get isResizable(){return!0}render(){if(this.div)return this.div;let y,v;if(this.width&&(y=this.x,v=this.y),super.render(),this.div.hidden=!0,this.#e?this.#p():this.#a(),this.width){const[T,w]=this.parentDimensions;this.setAt(y*T,v*w,this.width*T,this.height*w)}return this.div}#p(){const{div:y}=this;let{width:v,height:T}=this.#e;const[w,E]=this.pageDimensions,P=.75;if(this.width)v=this.width*w,T=this.height*E;else if(v>P*w||T>P*E){const B=Math.min(P*w/v,P*E/T);v*=B,T*=B}const[R,I]=this.parentDimensions;this.setDims(v*R/w,T*I/E),this._uiManager.enableWaiting(!1);const N=this.#o=document.createElement("canvas");y.append(N),y.hidden=!1,this.#b(v,T),this.#_(),this.#f||(this.parent.addUndoableEditor(this),this.#f=!0),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton(),this.#i&&N.setAttribute("aria-label",this.#i)}#g(y,v){const[T,w]=this.parentDimensions;this.width=y/T,this.height=v/w,this.setDims(y,v),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#u!==null&&clearTimeout(this.#u);const E=200;this.#u=setTimeout(()=>{this.#u=null,this.#b(y,v)},E)}#y(y,v){const{width:T,height:w}=this.#e;let E=T,P=w,R=this.#e;for(;E>2*y||P>2*v;){const I=E,N=P;E>2*y&&(E=E>=16384?Math.floor(E/2)-1:Math.ceil(E/2)),P>2*v&&(P=P>=16384?Math.floor(P/2)-1:Math.ceil(P/2));const B=new OffscreenCanvas(E,P);B.getContext("2d").drawImage(R,0,0,I,N,0,0,E,P),R=B.transferToImageBitmap()}return R}#b(y,v){y=Math.ceil(y),v=Math.ceil(v);const T=this.#o;if(!T||T.width===y&&T.height===v)return;T.width=y,T.height=v;const w=this.#c?this.#e:this.#y(y,v),E=T.getContext("2d");E.filter=this._uiManager.hcmFilter,E.drawImage(w,0,0,w.width,w.height,0,0,y,v)}getImageForAltText(){return this.#o}#v(y){if(y){if(this.#c){const w=this._uiManager.imageManager.getSvgUrl(this.#t);if(w)return w}const v=document.createElement("canvas");return{width:v.width,height:v.height}=this.#e,v.getContext("2d").drawImage(this.#e,0,0),v.toDataURL()}if(this.#c){const[v,T]=this.pageDimensions,w=Math.round(this.width*v*i.PixelsPerInch.PDF_TO_CSS_UNITS),E=Math.round(this.height*T*i.PixelsPerInch.PDF_TO_CSS_UNITS),P=new OffscreenCanvas(w,E);return P.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,w,E),P.transferToImageBitmap()}return structuredClone(this.#e)}#_(){this.#l=new ResizeObserver(y=>{const v=y[0].contentRect;v.width&&v.height&&this.#g(v.width,v.height)}),this.#l.observe(this.div)}static deserialize(y,v,T){if(y instanceof l.StampAnnotationElement)return null;const w=super.deserialize(y,v,T),{rect:E,bitmapUrl:P,bitmapId:R,isSvg:I,accessibilityData:N}=y;R&&T.imageManager.isValidId(R)?w.#t=R:w.#r=P,w.#c=I;const[B,D]=w.pageDimensions;return w.width=(E[2]-E[0])/B,w.height=(E[3]-E[1])/D,N&&(w.altTextData=N),w}serialize(y=!1,v=null){if(this.isEmpty())return null;const T={annotationType:s.AnnotationEditorType.STAMP,bitmapId:this.#t,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(y)return T.bitmapUrl=this.#v(!0),T.accessibilityData=this.altTextData,T;const{decorative:w,altText:E}=this.altTextData;if(!w&&E&&(T.accessibilityData={type:"Figure",alt:E}),v===null)return T;v.stamps||=new Map;const P=this.#c?(T.rect[2]-T.rect[0])*(T.rect[3]-T.rect[1]):null;if(!v.stamps.has(this.#t))v.stamps.set(this.#t,{area:P,serialized:T}),T.bitmap=this.#v(!1);else if(this.#c){const R=v.stamps.get(this.#t);P>R.area&&(R.area=P,R.serialized.bitmap.close(),R.serialized.bitmap=this.#v(!1))}return T}}class p{#e;#t=!1;#n=null;#r=this.pointerup.bind(this);#s=this.pointerUpAfterSelection.bind(this);#i=this.pointerdown.bind(this);#o=null;#l=this.selectionStart.bind(this);#u=new Map;#c=!1;#f=!1;#h=!1;#d=null;#a;static _initialized=!1;static#p=new Map([m,r,d,f].map(y=>[y._editorType,y]));constructor({uiManager:y,pageIndex:v,div:T,accessibilityManager:w,annotationLayer:E,drawLayer:P,textLayer:R,viewport:I,l10n:N}){const B=[...p.#p.values()];if(!p._initialized){p._initialized=!0;for(const D of B)D.initialize(N)}y.registerEditorTypes(B),this.#a=y,this.pageIndex=v,this.div=T,this.#e=w,this.#n=E,this.viewport=I,this.#d=R,this.drawLayer=P,this.#a.addLayer(this)}get isEmpty(){return this.#u.size===0}updateToolbar(y){this.#a.updateToolbar(y)}updateMode(y=this.#a.getMode()){switch(this.#_(),y){case s.AnnotationEditorType.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;case s.AnnotationEditorType.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case s.AnnotationEditorType.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}if(y!==s.AnnotationEditorType.NONE){const{classList:v}=this.div;for(const T of p.#p.values())v.toggle(`${T._type}Editing`,y===T._editorType);this.div.hidden=!1}}addInkEditorIfNeeded(y){if(this.#a.getMode()!==s.AnnotationEditorType.INK)return;if(!y){for(const T of this.#u.values())if(T.isEmpty()){T.setInBackground();return}}this.#b({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(y){this.#a.setEditingState(y)}addCommands(y){this.#a.addCommands(y)}togglePointerEvents(y=!1){this.div.classList.toggle("disabled",!y)}enable(){this.togglePointerEvents(!0);const y=new Set;for(const T of this.#u.values())T.enableEditing(),T.annotationElementId&&y.add(T.annotationElementId);if(!this.#n)return;const v=this.#n.getEditableAnnotations();for(const T of v){if(T.hide(),this.#a.isDeletedAnnotationElement(T.data.id)||y.has(T.data.id))continue;const w=this.deserialize(T);w&&(this.addOrRebuild(w),w.enableEditing())}}disable(){this.#h=!0,this.togglePointerEvents(!1);const y=new Set;for(const T of this.#u.values()){if(T.disableEditing(),!T.annotationElementId||T.serialize()!==null){y.add(T.annotationElementId);continue}this.getEditableAnnotation(T.annotationElementId)?.show(),T.remove()}if(this.#n){const T=this.#n.getEditableAnnotations();for(const w of T){const{id:E}=w.data;y.has(E)||this.#a.isDeletedAnnotationElement(E)||w.show()}}this.#_(),this.isEmpty&&(this.div.hidden=!0);const{classList:v}=this.div;for(const T of p.#p.values())v.remove(`${T._type}Editing`);this.disableTextSelection(),this.#h=!1}getEditableAnnotation(y){return this.#n?.getEditableAnnotation(y)||null}setActiveEditor(y){this.#a.getActive()!==y&&this.#a.setActiveEditor(y)}enableTextSelection(){this.#d?.div&&document.addEventListener("selectstart",this.#l)}disableTextSelection(){this.#d?.div&&document.removeEventListener("selectstart",this.#l)}enableClick(){this.div.addEventListener("pointerdown",this.#i),this.div.addEventListener("pointerup",this.#r)}disableClick(){this.div.removeEventListener("pointerdown",this.#i),this.div.removeEventListener("pointerup",this.#r)}attach(y){this.#u.set(y.id,y);const{annotationElementId:v}=y;v&&this.#a.isDeletedAnnotationElement(v)&&this.#a.removeDeletedAnnotationElement(y)}detach(y){this.#u.delete(y.id),this.#e?.removePointerInTextLayer(y.contentDiv),!this.#h&&y.annotationElementId&&this.#a.addDeletedAnnotationElement(y)}remove(y){this.detach(y),this.#a.removeEditor(y),y.div.remove(),y.isAttachedToDOM=!1,this.#f||this.addInkEditorIfNeeded(!1)}changeParent(y){y.parent!==this&&(y.annotationElementId&&(this.#a.addDeletedAnnotationElement(y.annotationElementId),o.AnnotationEditor.deleteAnnotationElement(y),y.annotationElementId=null),this.attach(y),y.parent?.detach(y),y.setParent(this),y.div&&y.isAttachedToDOM&&(y.div.remove(),this.div.append(y.div)))}add(y){if(this.changeParent(y),this.#a.addEditor(y),this.attach(y),!y.isAttachedToDOM){const v=y.render();this.div.append(v),y.isAttachedToDOM=!0}y.fixAndSetPosition(),y.onceAdded(),this.#a.addToAnnotationStorage(y)}moveEditorInDOM(y){if(!y.isAttachedToDOM)return;const{activeElement:v}=document;y.div.contains(v)&&!this.#o&&(y._focusEventsAllowed=!1,this.#o=setTimeout(()=>{this.#o=null,y.div.contains(document.activeElement)?y._focusEventsAllowed=!0:(y.div.addEventListener("focusin",()=>{y._focusEventsAllowed=!0},{once:!0}),v.focus())},0)),y._structTreeParentId=this.#e?.moveElementInDOM(this.div,y.div,y.contentDiv,!0)}addOrRebuild(y){y.needsToBeRebuilt()?(y.parent||=this,y.rebuild()):this.add(y)}addUndoableEditor(y){const v=()=>y._uiManager.rebuild(y),T=()=>{y.remove()};this.addCommands({cmd:v,undo:T,mustExec:!1})}getNextId(){return this.#a.getId()}get#g(){return p.#p.get(this.#a.getMode())}#y(y){const v=this.#g;return v?new v.prototype.constructor(y):null}canCreateNewEmptyEditor(){return this.#g?.canCreateNewEmptyEditor()}pasteEditor(y,v){this.#a.updateToolbar(y),this.#a.updateMode(y);const{offsetX:T,offsetY:w}=this.#v(),E=this.getNextId(),P=this.#y({parent:this,id:E,x:T,y:w,uiManager:this.#a,isCentered:!0,...v});P&&this.add(P)}deserialize(y){return p.#p.get(y.annotationType??y.annotationEditorType)?.deserialize(y,this,this.#a)||null}#b(y,v,T={}){const w=this.getNextId(),E=this.#y({parent:this,id:w,x:y.offsetX,y:y.offsetY,uiManager:this.#a,isCentered:v,...T});return E&&this.add(E),E}#v(){const{x:y,y:v,width:T,height:w}=this.div.getBoundingClientRect(),E=Math.max(0,y),P=Math.max(0,v),R=Math.min(window.innerWidth,y+T),I=Math.min(window.innerHeight,v+w),N=(E+R)/2-y,B=(P+I)/2-v,[D,Y]=this.viewport.rotation%180===0?[N,B]:[B,N];return{offsetX:D,offsetY:Y}}addNewEditor(){this.#b(this.#v(),!0)}setSelected(y){this.#a.setSelected(y)}toggleSelected(y){this.#a.toggleSelected(y)}isSelected(y){return this.#a.isSelected(y)}unselect(y){this.#a.unselect(y)}selectionStart(y){this.#d?.div.addEventListener("pointerup",this.#s,{once:!0})}pointerUpAfterSelection(y){const v=document.getSelection();if(v.rangeCount===0)return;const T=v.getRangeAt(0);if(T.collapsed||!this.#d?.div.contains(T.commonAncestorContainer))return;const{x:w,y:E,width:P,height:R}=this.#d.div.getBoundingClientRect(),I=T.getClientRects();let N;switch(this.viewport.rotation){case 90:N=(D,Y,se,re)=>({x:(Y-E)/R,y:1-(D+se-w)/P,width:re/R,height:se/P});break;case 180:N=(D,Y,se,re)=>({x:1-(D+se-w)/P,y:1-(Y+re-E)/R,width:se/P,height:re/R});break;case 270:N=(D,Y,se,re)=>({x:1-(Y+re-E)/R,y:(D-w)/P,width:re/R,height:se/P});break;default:N=(D,Y,se,re)=>({x:(D-w)/P,y:(Y-E)/R,width:se/P,height:re/R});break}const B=[];for(const{x:D,y:Y,width:se,height:re}of I)se===0||re===0||B.push(N(D,Y,se,re));B.length!==0&&this.#b(y,!1,{boxes:B}),v.empty()}pointerup(y){const{isMac:v}=s.FeatureTest.platform;if(!(y.button!==0||y.ctrlKey&&v)&&y.target===this.div&&this.#c){if(this.#c=!1,!this.#t){this.#t=!0;return}if(this.#a.getMode()===s.AnnotationEditorType.STAMP){this.#a.unselectAll();return}this.#b(y,!1)}}pointerdown(y){if(this.#a.getMode()===s.AnnotationEditorType.HIGHLIGHT&&this.enableTextSelection(),this.#c){this.#c=!1;return}const{isMac:v}=s.FeatureTest.platform;if(y.button!==0||y.ctrlKey&&v||y.target!==this.div)return;this.#c=!0;const T=this.#a.getActive();this.#t=!T||T.isEmpty()}findNewParent(y,v,T){const w=this.#a.findParent(v,T);return w===null||w===this?!1:(w.changeParent(y),!0)}destroy(){this.#a.getActive()?.parent===this&&(this.#a.commitOrRemove(),this.#a.setActiveEditor(null)),this.#o&&(clearTimeout(this.#o),this.#o=null);for(const y of this.#u.values())this.#e?.removePointerInTextLayer(y.contentDiv),y.setParent(null),y.isAttachedToDOM=!1,y.div.remove();this.div=null,this.#u.clear(),this.#a.removeLayer(this)}#_(){this.#f=!0;for(const y of this.#u.values())y.isEmpty()&&y.remove();this.#f=!1}render({viewport:y}){this.viewport=y,(0,i.setLayerDimensions)(this.div,y);for(const v of this.#a.getEditors(this.pageIndex))this.add(v);this.updateMode()}update({viewport:y}){this.#a.commitOrRemove();const v=this.viewport.rotation,T=y.rotation;if(this.viewport=y,(0,i.setLayerDimensions)(this.div,{rotation:T}),v!==T)for(const w of this.#u.values())w.rotate(T);this.updateMode()}get pageDimensions(){const{pageWidth:y,pageHeight:v}=this.viewport.rawDims;return[y,v]}}}),97:((n,e,t)=>{t.d(e,{ColorPicker:()=>l});var s=t(266),o=t(812),u=t(473);class l{#e=this.#h.bind(this);#t=null;#n=null;#r;#s=null;#i=!1;#o=!1;#l;#u=null;static get _keyboardManager(){return(0,s.shadow)(this,"_keyboardManager",new o.KeyboardManager([[["Escape","mac+Escape"],l.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],l.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],l.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],l.prototype._moveToPrevious],[["Home","mac+Home"],l.prototype._moveToBeginning],[["End","mac+End"],l.prototype._moveToEnd]]))}constructor({editor:g=null,uiManager:h=null}){this.#o=!g,this.#u=g?._uiManager||h,this.#l=this.#u._eventBus,this.#r=g?.color||this.#u?.highlightColors.values().next().value||"#FFFF98"}renderButton(){const g=this.#t=document.createElement("button");g.className="colorPicker",g.tabIndex="0",g.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),g.setAttribute("aria-haspopup",!0),g.addEventListener("click",this.#d.bind(this));const h=this.#n=document.createElement("span");return h.className="swatch",h.style.backgroundColor=this.#r,g.append(h),g}renderMainDropdown(){const g=this.#s=this.#c(s.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR);return g.setAttribute("aria-orientation","horizontal"),g.setAttribute("aria-labelledby","highlightColorPickerLabel"),g}#c(g){const h=document.createElement("div");h.addEventListener("contextmenu",u.noContextMenu),h.className="dropdown",h.role="listbox",h.setAttribute("aria-multiselectable",!1),h.setAttribute("aria-orientation","vertical"),h.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[f,i]of this.#u.highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=f,r.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${f}`);const d=document.createElement("span");r.append(d),d.className="swatch",d.style.backgroundColor=i,r.setAttribute("aria-selected",i===this.#r),r.addEventListener("click",this.#f.bind(this,g,i)),h.append(r)}return h.addEventListener("keydown",this.#e),h}#f(g,h,f){f.stopPropagation(),this.#l.dispatch("switchannotationeditorparams",{source:this,type:g,value:h})}_colorSelectFromKeyboard(g){const h=g.target.getAttribute("data-color");h&&this.#f(h,g)}_moveToNext(g){if(g.target===this.#t){this.#s.firstChild?.focus();return}g.target.nextSibling?.focus()}_moveToPrevious(g){g.target.previousSibling?.focus()}_moveToBeginning(){this.#s.firstChild?.focus()}_moveToEnd(){this.#s.lastChild?.focus()}#h(g){l._keyboardManager.exec(this,g)}#d(g){if(this.#s&&!this.#s.classList.contains("hidden")){this.hideDropdown();return}if(this.#t.addEventListener("keydown",this.#e),this.#i=g.detail===0,this.#s){this.#s.classList.remove("hidden");return}const h=this.#s=this.#c(s.AnnotationEditorParamsType.HIGHLIGHT_COLOR);this.#t.append(h)}hideDropdown(){this.#s?.classList.add("hidden")}_hideDropdownFromKeyboard(){this.#o||!this.#s||this.#s.classList.contains("hidden")||(this.hideDropdown(),this.#t.removeEventListener("keydown",this.#e),this.#t.focus({preventScroll:!0,focusVisible:this.#i}))}updateColor(g){if(this.#n&&(this.#n.style.backgroundColor=g),!this.#s)return;const h=this.#u.highlightColors.values();for(const f of this.#s.children)f.setAttribute("aria-selected",h.next().value===g)}destroy(){this.#t?.remove(),this.#t=null,this.#n=null,this.#s?.remove(),this.#s=null}}}),115:((n,e,t)=>{t.d(e,{AnnotationEditor:()=>g});var s=t(812),o=t(266),u=t(473);class l{#e="";#t=!1;#n=null;#r=null;#s=null;#i=!1;#o=null;static _l10nPromise=null;constructor(i){this.#o=i}static initialize(i){l._l10nPromise||=i}async render(){const i=this.#n=document.createElement("button");i.className="altText";const r=await l._l10nPromise.get("pdfjs-editor-alt-text-button-label");i.textContent=r,i.setAttribute("aria-label",r),i.tabIndex="0",i.addEventListener("contextmenu",u.noContextMenu),i.addEventListener("pointerdown",p=>p.stopPropagation());const d=p=>{p.preventDefault(),this.#o._uiManager.editAltText(this.#o)};return i.addEventListener("click",d,{capture:!0}),i.addEventListener("keydown",p=>{p.target===i&&p.key==="Enter"&&(this.#i=!0,d(p))}),await this.#l(),i}finish(){this.#n&&(this.#n.focus({focusVisible:this.#i}),this.#i=!1)}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:i,decorative:r}){this.#e===i&&this.#t===r||(this.#e=i,this.#t=r,this.#l())}toggle(i=!1){this.#n&&(!i&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#n.disabled=!i)}destroy(){this.#n?.remove(),this.#n=null,this.#r=null}async#l(){const i=this.#n;if(!i)return;if(!this.#e&&!this.#t){i.classList.remove("done"),this.#r?.remove();return}i.classList.add("done"),l._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then(p=>{i.setAttribute("aria-label",p)});let r=this.#r;if(!r){this.#r=r=document.createElement("span"),r.className="tooltip",r.setAttribute("role","tooltip");const p=r.id=`alt-text-tooltip-${this.#o.id}`;i.setAttribute("aria-describedby",p);const _=100;i.addEventListener("mouseenter",()=>{this.#s=setTimeout(()=>{this.#s=null,this.#r.classList.add("show"),this.#o._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.#o.editorType,data:{action:"alt_text_tooltip"}}})},_)}),i.addEventListener("mouseleave",()=>{this.#s&&(clearTimeout(this.#s),this.#s=null),this.#r?.classList.remove("show")})}r.innerText=this.#t?await l._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):this.#e,r.parentNode||i.append(r),this.#o.getImageForAltText()?.setAttribute("aria-describedby",r.id)}}class m{#e=null;#t=null;#n;#r=null;constructor(i){this.#n=i}render(){const i=this.#e=document.createElement("div");i.className="editToolbar",i.addEventListener("contextmenu",u.noContextMenu),i.addEventListener("pointerdown",m.#s);const r=this.#r=document.createElement("div");r.className="buttons",i.append(r);const d=this.#n.toolbarPosition;if(d){const{style:p}=i,_=this.#n._uiManager.direction==="ltr"?1-d[0]:d[0];p.insetInlineEnd=`${100*_}%`,p.top=`calc(${100*d[1]}% + var(--editor-toolbar-vert-offset))`}return this.#u(),i}static#s(i){i.stopPropagation()}#i(i){this.#n._focusEventsAllowed=!1,i.preventDefault(),i.stopPropagation()}#o(i){this.#n._focusEventsAllowed=!0,i.preventDefault(),i.stopPropagation()}#l(i){i.addEventListener("focusin",this.#i.bind(this),{capture:!0}),i.addEventListener("focusout",this.#o.bind(this),{capture:!0}),i.addEventListener("contextmenu",u.noContextMenu)}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden")}#u(){const i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",`pdfjs-editor-remove-${this.#n.editorType}-button`),this.#l(i),i.addEventListener("click",r=>{this.#n._uiManager.delete()}),this.#r.append(i)}get#c(){const i=document.createElement("div");return i.className="divider",i}addAltTextButton(i){this.#l(i),this.#r.prepend(i,this.#c)}addColorPicker(i){this.#t=i;const r=i.renderButton();this.#l(r),this.#r.prepend(r,this.#c)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class g{#e=null;#t=null;#n=!1;#r=null;#s=null;#i=this.focusin.bind(this);#o=this.focusout.bind(this);#l=null;#u="";#c=!1;#f=!1;#h=!1;#d=!1;#a=null;_initialOptions=Object.create(null);_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#p=!1;#g=g._zIndex++;static _borderLineWidth=-1;static _colorManager=new s.ColorManager;static _zIndex=1;static get _resizerKeyboardManager(){const i=g.prototype._resizeWithKeyboard,r=s.AnnotationEditorUIManager.TRANSLATE_SMALL,d=s.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,o.shadow)(this,"_resizerKeyboardManager",new s.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],i,{args:[-r,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],i,{args:[-d,0]}],[["ArrowRight","mac+ArrowRight"],i,{args:[r,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],i,{args:[d,0]}],[["ArrowUp","mac+ArrowUp"],i,{args:[0,-r]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],i,{args:[0,-d]}],[["ArrowDown","mac+ArrowDown"],i,{args:[0,r]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],i,{args:[0,d]}],[["Escape","mac+Escape"],g.prototype._stopResizingWithKeyboard]]))}constructor(i){this.constructor===g&&(0,o.unreachable)("Cannot initialize AnnotationEditor."),this.parent=i.parent,this.id=i.id,this.width=this.height=null,this.pageIndex=i.parent.pageIndex,this.name=i.name,this.div=null,this._uiManager=i.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=i.isCentered,this._structTreeParentId=null;const{rotation:r,rawDims:{pageWidth:d,pageHeight:p,pageX:_,pageY:y}}=this.parent.viewport;this.rotation=r,this.pageRotation=(360+r-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[d,p],this.pageTranslation=[_,y];const[v,T]=this.parentDimensions;this.x=i.x/v,this.y=i.y/T,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,o.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(i){const r=new h({id:i.parent.getNextId(),parent:i.parent,uiManager:i._uiManager});r.annotationElementId=i.annotationElementId,r.deleted=!0,r._uiManager.addToAnnotationStorage(r)}static initialize(i,r=null){if(g._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map(p=>[p,i.get(p.replaceAll(/([A-Z])/g,_=>`-${_.toLowerCase()}`))])),r?.strings)for(const p of r.strings)g._l10nPromise.set(p,i.get(p));if(g._borderLineWidth!==-1)return;const d=getComputedStyle(document.documentElement);g._borderLineWidth=parseFloat(d.getPropertyValue("--outline-width"))||0}static updateDefaultParams(i,r){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(i){return!1}static paste(i,r){(0,o.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#p}set _isDraggable(i){this.#p=i,this.div?.classList.toggle("draggable",i)}get isEnterHandled(){return!0}center(){const[i,r]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*r/(i*2),this.y+=this.width*i/(r*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*r/(i*2),this.y-=this.width*i/(r*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(i){this._uiManager.addCommands(i)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#g}setParent(i){i!==null?(this.pageIndex=i.pageIndex,this.pageDimensions=i.pageDimensions):this.#T(),this.parent=i}focusin(i){this._focusEventsAllowed&&(this.#c?this.#c=!1:this.parent.setSelected(this))}focusout(i){!this._focusEventsAllowed||!this.isAttachedToDOM||i.relatedTarget?.closest(`#${this.id}`)||(i.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(i,r,d,p){const[_,y]=this.parentDimensions;[d,p]=this.screenToPageTranslation(d,p),this.x=(i+d)/_,this.y=(r+p)/y,this.fixAndSetPosition()}#y([i,r],d,p){[d,p]=this.screenToPageTranslation(d,p),this.x+=d/i,this.y+=p/r,this.fixAndSetPosition()}translate(i,r){this.#y(this.parentDimensions,i,r)}translateInPage(i,r){this.#y(this.pageDimensions,i,r),this.div.scrollIntoView({block:"nearest"})}drag(i,r){const[d,p]=this.parentDimensions;if(this.x+=i/d,this.y+=r/p,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:w,y:E}=this.div.getBoundingClientRect();this.parent.findNewParent(this,w,E)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:_,y}=this;const[v,T]=this.#b();_+=v,y+=T,this.div.style.left=`${(100*_).toFixed(2)}%`,this.div.style.top=`${(100*y).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}#b(){const[i,r]=this.parentDimensions,{_borderLineWidth:d}=g,p=d/i,_=d/r;switch(this.rotation){case 90:return[-p,_];case 180:return[p,_];case 270:return[p,-_];default:return[-p,-_]}}fixAndSetPosition(i=this.rotation){const[r,d]=this.pageDimensions;let{x:p,y:_,width:y,height:v}=this;switch(y*=r,v*=d,p*=r,_*=d,i){case 0:p=Math.max(0,Math.min(r-y,p)),_=Math.max(0,Math.min(d-v,_));break;case 90:p=Math.max(0,Math.min(r-v,p)),_=Math.min(d,Math.max(y,_));break;case 180:p=Math.min(r,Math.max(y,p)),_=Math.min(d,Math.max(v,_));break;case 270:p=Math.min(r,Math.max(v,p)),_=Math.max(0,Math.min(d-y,_));break}this.x=p/=r,this.y=_/=d;const[T,w]=this.#b();p+=T,_+=w;const{style:E}=this.div;E.left=`${(100*p).toFixed(2)}%`,E.top=`${(100*_).toFixed(2)}%`,this.moveInDOM()}static#v(i,r,d){switch(d){case 90:return[r,-i];case 180:return[-i,-r];case 270:return[-r,i];default:return[i,r]}}screenToPageTranslation(i,r){return g.#v(i,r,this.parentRotation)}pageTranslationToScreen(i,r){return g.#v(i,r,360-this.parentRotation)}#_(i){switch(i){case 90:{const[r,d]=this.pageDimensions;return[0,-r/d,d/r,0]}case 180:return[-1,0,0,-1];case 270:{const[r,d]=this.pageDimensions;return[0,r/d,-d/r,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:i,pageDimensions:[r,d]}=this,p=r*i,_=d*i;return o.FeatureTest.isCSSRoundSupported?[Math.round(p),Math.round(_)]:[p,_]}setDims(i,r){const[d,p]=this.parentDimensions;this.div.style.width=`${(100*i/d).toFixed(2)}%`,this.#n||(this.div.style.height=`${(100*r/p).toFixed(2)}%`)}fixDims(){const{style:i}=this.div,{height:r,width:d}=i,p=d.endsWith("%"),_=!this.#n&&r.endsWith("%");if(p&&_)return;const[y,v]=this.parentDimensions;p||(i.width=`${(100*parseFloat(d)/y).toFixed(2)}%`),!this.#n&&!_&&(i.height=`${(100*parseFloat(r)/v).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#m(){if(this.#r)return;this.#r=document.createElement("div"),this.#r.classList.add("resizers");const i=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];for(const r of i){const d=document.createElement("div");this.#r.append(d),d.classList.add("resizer",r),d.setAttribute("data-resizer-name",r),d.addEventListener("pointerdown",this.#E.bind(this,r)),d.addEventListener("contextmenu",u.noContextMenu),d.tabIndex=-1}this.div.prepend(this.#r)}#E(i,r){r.preventDefault();const{isMac:d}=o.FeatureTest.platform;if(r.button!==0||r.ctrlKey&&d)return;this.#t?.toggle(!1);const p=this.#B.bind(this,i),_=this._isDraggable;this._isDraggable=!1;const y={passive:!0,capture:!0};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",p,y);const v=this.x,T=this.y,w=this.width,E=this.height,P=this.parent.div.style.cursor,R=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(r.target).cursor;const I=()=>{this.parent.togglePointerEvents(!0),this.#t?.toggle(!0),this._isDraggable=_,window.removeEventListener("pointerup",I),window.removeEventListener("blur",I),window.removeEventListener("pointermove",p,y),this.parent.div.style.cursor=P,this.div.style.cursor=R,this.#I(v,T,w,E)};window.addEventListener("pointerup",I),window.addEventListener("blur",I)}#I(i,r,d,p){const _=this.x,y=this.y,v=this.width,T=this.height;_===i&&y===r&&v===d&&T===p||this.addCommands({cmd:()=>{this.width=v,this.height=T,this.x=_,this.y=y;const[w,E]=this.parentDimensions;this.setDims(w*v,E*T),this.fixAndSetPosition()},undo:()=>{this.width=d,this.height=p,this.x=i,this.y=r;const[w,E]=this.parentDimensions;this.setDims(w*d,E*p),this.fixAndSetPosition()},mustExec:!0})}#B(i,r){const[d,p]=this.parentDimensions,_=this.x,y=this.y,v=this.width,T=this.height,w=g.MIN_SIZE/d,E=g.MIN_SIZE/p,P=U=>Math.round(U*1e4)/1e4,R=this.#_(this.rotation),I=(U,L)=>[R[0]*U+R[2]*L,R[1]*U+R[3]*L],N=this.#_(360-this.rotation),B=(U,L)=>[N[0]*U+N[2]*L,N[1]*U+N[3]*L];let D,Y,se=!1,re=!1;switch(i){case"topLeft":se=!0,D=(U,L)=>[0,0],Y=(U,L)=>[U,L];break;case"topMiddle":D=(U,L)=>[U/2,0],Y=(U,L)=>[U/2,L];break;case"topRight":se=!0,D=(U,L)=>[U,0],Y=(U,L)=>[0,L];break;case"middleRight":re=!0,D=(U,L)=>[U,L/2],Y=(U,L)=>[0,L/2];break;case"bottomRight":se=!0,D=(U,L)=>[U,L],Y=(U,L)=>[0,0];break;case"bottomMiddle":D=(U,L)=>[U/2,L],Y=(U,L)=>[U/2,0];break;case"bottomLeft":se=!0,D=(U,L)=>[0,L],Y=(U,L)=>[U,0];break;case"middleLeft":re=!0,D=(U,L)=>[0,L/2],Y=(U,L)=>[U,L/2];break}const W=D(v,T),$=Y(v,T);let k=I(...$);const H=P(_+k[0]),de=P(y+k[1]);let ee=1,ce=1,[q,le]=this.screenToPageTranslation(r.movementX,r.movementY);if([q,le]=B(q/d,le/p),se){const U=Math.hypot(v,T);ee=ce=Math.max(Math.min(Math.hypot($[0]-W[0]-q,$[1]-W[1]-le)/U,1/v,1/T),w/v,E/T)}else re?ee=Math.max(w,Math.min(1,Math.abs($[0]-W[0]-q)))/v:ce=Math.max(E,Math.min(1,Math.abs($[1]-W[1]-le)))/T;const be=P(v*ee),xe=P(T*ce);k=I(...Y(be,xe));const Ee=H-k[0],we=de-k[1];this.width=be,this.height=xe,this.x=Ee,this.y=we,this.setDims(d*be,p*xe),this.fixAndSetPosition()}altTextFinish(){this.#t?.finish()}async addEditToolbar(){return this.#l||this.#h?this.#l:(this.#l=new m(this),this.div.append(this.#l.render()),this.#t&&this.#l.addAltTextButton(await this.#t.render()),this.#l)}removeEditToolbar(){this.#l&&(this.#l.remove(),this.#l=null,this.#t?.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#t||(l.initialize(g._l10nPromise),this.#t=new l(this),await this.addEditToolbar())}get altTextData(){return this.#t?.data}set altTextData(i){this.#t&&(this.#t.data=i)}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#i),this.div.addEventListener("focusout",this.#o);const[i,r]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*r/i).toFixed(2)}%`,this.div.style.maxHeight=`${(100*i/r).toFixed(2)}%`);const[d,p]=this.getInitialTranslation();return this.translate(d,p),(0,s.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(i){const{isMac:r}=o.FeatureTest.platform;if(i.button!==0||i.ctrlKey&&r){i.preventDefault();return}if(this.#c=!0,this._isDraggable){this.#N(i);return}this.#V(i)}#V(i){const{isMac:r}=o.FeatureTest.platform;i.ctrlKey&&!r||i.shiftKey||i.metaKey&&r?this.parent.toggleSelected(this):this.parent.setSelected(this)}#N(i){const r=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let d,p;r&&(d={passive:!0,capture:!0},p=y=>{const[v,T]=this.screenToPageTranslation(y.movementX,y.movementY);this._uiManager.dragSelectedEditors(v,T)},window.addEventListener("pointermove",p,d));const _=()=>{window.removeEventListener("pointerup",_),window.removeEventListener("blur",_),r&&window.removeEventListener("pointermove",p,d),this.#c=!1,this._uiManager.endDragSession()||this.#V(i)};window.addEventListener("pointerup",_),window.addEventListener("blur",_)}moveInDOM(){this.#a&&clearTimeout(this.#a),this.#a=setTimeout(()=>{this.#a=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(i,r,d){i.changeParent(this),this.x=r,this.y=d,this.fixAndSetPosition()}getRect(i,r,d=this.rotation){const p=this.parentScale,[_,y]=this.pageDimensions,[v,T]=this.pageTranslation,w=i/p,E=r/p,P=this.x*_,R=this.y*y,I=this.width*_,N=this.height*y;switch(d){case 0:return[P+w+v,y-R-E-N+T,P+w+I+v,y-R-E+T];case 90:return[P+E+v,y-R+w+T,P+E+N+v,y-R+w+I+T];case 180:return[P-w-I+v,y-R+E+T,P-w+v,y-R+E+N+T];case 270:return[P-E-N+v,y-R-w-I+T,P-E+v,y-R-w+T];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(i,r){const[d,p,_,y]=i,v=_-d,T=y-p;switch(this.rotation){case 0:return[d,r-y,v,T];case 90:return[d,r-p,T,v];case 180:return[_,r-p,v,T];case 270:return[_,r-y,T,v];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#h=!0}disableEditMode(){this.#h=!1}isInEditMode(){return this.#h}shouldGetKeyboardEvents(){return this.#d}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#i),this.div?.addEventListener("focusout",this.#o)}rotate(i){}serialize(i=!1,r=null){(0,o.unreachable)("An editor must be serializable")}static deserialize(i,r,d){const p=new this.prototype.constructor({parent:r,id:r.getNextId(),uiManager:d});p.rotation=i.rotation;const[_,y]=p.pageDimensions,[v,T,w,E]=p.getRectInCurrentCoords(i.rect,y);return p.x=v/_,p.y=T/y,p.width=w/_,p.height=E/y,p}remove(){this.div.removeEventListener("focusin",this.#i),this.div.removeEventListener("focusout",this.#o),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#a&&(clearTimeout(this.#a),this.#a=null),this.#T(),this.removeEditToolbar()}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#m(),this.#r.classList.remove("hidden"),(0,s.bindEvents)(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(i){if(!this.isResizable||i.target!==this.div||i.key!=="Enter")return;this._uiManager.setSelected(this),this.#s={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const r=this.#r.children;if(!this.#e){this.#e=Array.from(r);const y=this.#O.bind(this),v=this.#x.bind(this);for(const T of this.#e){const w=T.getAttribute("data-resizer-name");T.setAttribute("role","spinbutton"),T.addEventListener("keydown",y),T.addEventListener("blur",v),T.addEventListener("focus",this.#k.bind(this,w)),g._l10nPromise.get(`pdfjs-editor-resizer-label-${w}`).then(E=>T.setAttribute("aria-label",E))}}const d=this.#e[0];let p=0;for(const y of r){if(y===d)break;p++}const _=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(_!==p){if(_<p)for(let v=0;v<p-_;v++)this.#r.append(this.#r.firstChild);else if(_>p)for(let v=0;v<_-p;v++)this.#r.firstChild.before(this.#r.lastChild);let y=0;for(const v of r){const w=this.#e[y++].getAttribute("data-resizer-name");g._l10nPromise.get(`pdfjs-editor-resizer-label-${w}`).then(E=>v.setAttribute("aria-label",E))}}this.#S(0),this.#d=!0,this.#r.firstChild.focus({focusVisible:!0}),i.preventDefault(),i.stopImmediatePropagation()}#O(i){g._resizerKeyboardManager.exec(this,i)}#x(i){this.#d&&i.relatedTarget?.parentNode!==this.#r&&this.#T()}#k(i){this.#u=this.#d?i:""}#S(i){if(this.#e)for(const r of this.#e)r.tabIndex=i}_resizeWithKeyboard(i,r){this.#d&&this.#B(this.#u,{movementX:i,movementY:r})}#T(){if(this.#d=!1,this.#S(-1),this.#s){const{savedX:i,savedY:r,savedWidth:d,savedHeight:p}=this.#s;this.#I(i,r,d,p),this.#s=null}}_stopResizingWithKeyboard(){this.#T(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this.#l){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this.#l?.show()});return}this.#l?.show()}unselect(){this.#r?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus(),this.#l?.hide()}updateParams(i,r){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#f}set isEditing(i){this.#f=i,this.parent&&(i?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(i,r){this.#n=!0;const d=i/r,{style:p}=this.div;p.aspectRatio=d,p.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}}class h extends g{constructor(i){super(i),this.annotationElementId=i.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}}),405:((n,e,t)=>{t.d(e,{Outliner:()=>s});class s{#e;#t=[];#n=[];constructor(u,l=0,m=0,g=!0){let h=1/0,f=-1/0,i=1/0,r=-1/0;const d=10**-4;for(const{x:E,y:P,width:R,height:I}of u){const N=Math.floor((E-l)/d)*d,B=Math.ceil((E+R+l)/d)*d,D=Math.floor((P-l)/d)*d,Y=Math.ceil((P+I+l)/d)*d,se=[N,D,Y,!0],re=[B,D,Y,!1];this.#t.push(se,re),h=Math.min(h,N),f=Math.max(f,B),i=Math.min(i,D),r=Math.max(r,Y)}const p=f-h+2*m,_=r-i+2*m,y=h-m,v=i-m,T=this.#t.at(g?-1:-2),w=[T[0],T[2]];for(const E of this.#t){const[P,R,I]=E;E[0]=(P-y)/p,E[1]=(R-v)/_,E[2]=(I-v)/_}this.#e={x:y,y:v,width:p,height:_,lastPoint:w}}getOutlines(){this.#t.sort((l,m)=>l[0]-m[0]||l[1]-m[1]||l[2]-m[2]);const u=[];for(const l of this.#t)l[3]?(u.push(...this.#l(l)),this.#i(l)):(this.#o(l),u.push(...this.#l(l)));return this.#r(u)}#r(u){const l=[],m=new Set;for(const f of u){const[i,r,d]=f;l.push([i,r,f],[i,d,f])}l.sort((f,i)=>f[1]-i[1]||f[0]-i[0]);for(let f=0,i=l.length;f<i;f+=2){const r=l[f][2],d=l[f+1][2];r.push(d),d.push(r),m.add(r),m.add(d)}const g=[];let h;for(;m.size>0;){const f=m.values().next().value;let[i,r,d,p,_]=f;m.delete(f);let y=i,v=r;for(h=[i,d],g.push(h);;){let T;if(m.has(p))T=p;else if(m.has(_))T=_;else break;m.delete(T),[i,r,d,p,_]=T,y!==i&&(h.push(y,v,i,v===r?r:d),y=i),v=v===r?d:r}h.push(y,v)}return{outlines:g,box:this.#e}}#s(u){const l=this.#n;let m=0,g=l.length-1;for(;m<=g;){const h=m+g>>1,f=l[h][0];if(f===u)return h;f<u?m=h+1:g=h-1}return g+1}#i([,u,l]){const m=this.#s(u);this.#n.splice(m,0,[u,l])}#o([,u,l]){const m=this.#s(u);for(let g=m;g<this.#n.length;g++){const[h,f]=this.#n[g];if(h!==u)break;if(h===u&&f===l){this.#n.splice(g,1);return}}for(let g=m-1;g>=0;g--){const[h,f]=this.#n[g];if(h!==u)break;if(h===u&&f===l){this.#n.splice(g,1);return}}}#l(u){const[l,m,g]=u,h=[[l,m,g]],f=this.#s(g);for(let i=0;i<f;i++){const[r,d]=this.#n[i];for(let p=0,_=h.length;p<_;p++){const[,y,v]=h[p];if(!(d<=y||v<=r)){if(y>=r){if(v>d)h[p][1]=d;else{if(_===1)return[];h.splice(p,1),p--,_--}continue}h[p][2]=r,v>d&&h.push([l,d,v])}}}return h}}}),812:((n,e,t)=>{t.d(e,{AnnotationEditorUIManager:()=>r,ColorManager:()=>i,KeyboardManager:()=>f,bindEvents:()=>u,opacityToHex:()=>l});var s=t(266),o=t(473);function u(d,p,_){for(const y of _)p.addEventListener(y,d[y].bind(d))}function l(d){return Math.round(Math.min(255,Math.max(1,255*d))).toString(16).padStart(2,"0")}class m{#e=0;getId(){return`${s.AnnotationEditorPrefix}${this.#e++}`}}class g{#e=(0,s.getUuid)();#t=0;#n=null;static get _isSVGFittingCanvas(){const p='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',y=new OffscreenCanvas(1,3).getContext("2d"),v=new Image;v.src=p;const T=v.decode().then(()=>(y.drawImage(v,0,0,1,1,0,0,1,3),new Uint32Array(y.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,s.shadow)(this,"_isSVGFittingCanvas",T)}async#r(p,_){this.#n||=new Map;let y=this.#n.get(p);if(y===null)return null;if(y?.bitmap)return y.refCounter+=1,y;try{y||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let v;if(typeof _=="string"?(y.url=_,v=await(0,o.fetchData)(_,"blob")):v=y.file=_,v.type==="image/svg+xml"){const T=g._isSVGFittingCanvas,w=new FileReader,E=new Image,P=new Promise((R,I)=>{E.onload=()=>{y.bitmap=E,y.isSvg=!0,R()},w.onload=async()=>{const N=y.svgUrl=w.result;E.src=await T?`${N}#svgView(preserveAspectRatio(none))`:N},E.onerror=w.onerror=I});w.readAsDataURL(v),await P}else y.bitmap=await createImageBitmap(v);y.refCounter=1}catch(v){console.error(v),y=null}return this.#n.set(p,y),y&&this.#n.set(y.id,y),y}async getFromFile(p){const{lastModified:_,name:y,size:v,type:T}=p;return this.#r(`${_}_${y}_${v}_${T}`,p)}async getFromUrl(p){return this.#r(p,p)}async getFromId(p){this.#n||=new Map;const _=this.#n.get(p);return _?_.bitmap?(_.refCounter+=1,_):_.file?this.getFromFile(_.file):this.getFromUrl(_.url):null}getSvgUrl(p){const _=this.#n.get(p);return _?.isSvg?_.svgUrl:null}deleteId(p){this.#n||=new Map;const _=this.#n.get(p);_&&(_.refCounter-=1,_.refCounter===0&&(_.bitmap=null))}isValidId(p){return p.startsWith(`image_${this.#e}_`)}}class h{#e=[];#t=!1;#n;#r=-1;constructor(p=128){this.#n=p}add({cmd:p,undo:_,mustExec:y,type:v=NaN,overwriteIfSameType:T=!1,keepUndo:w=!1}){if(y&&p(),this.#t)return;const E={cmd:p,undo:_,type:v};if(this.#r===-1){this.#e.length>0&&(this.#e.length=0),this.#r=0,this.#e.push(E);return}if(T&&this.#e[this.#r].type===v){w&&(E.undo=this.#e[this.#r].undo),this.#e[this.#r]=E;return}const P=this.#r+1;P===this.#n?this.#e.splice(0,1):(this.#r=P,P<this.#e.length&&this.#e.splice(P)),this.#e.push(E)}undo(){this.#r!==-1&&(this.#t=!0,this.#e[this.#r].undo(),this.#t=!1,this.#r-=1)}redo(){this.#r<this.#e.length-1&&(this.#r+=1,this.#t=!0,this.#e[this.#r].cmd(),this.#t=!1)}hasSomethingToUndo(){return this.#r!==-1}hasSomethingToRedo(){return this.#r<this.#e.length-1}destroy(){this.#e=null}}class f{constructor(p){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:_}=s.FeatureTest.platform;for(const[y,v,T={}]of p)for(const w of y){const E=w.startsWith("mac+");_&&E?(this.callbacks.set(w.slice(4),{callback:v,options:T}),this.allKeys.add(w.split("+").at(-1))):!_&&!E&&(this.callbacks.set(w,{callback:v,options:T}),this.allKeys.add(w.split("+").at(-1)))}}#e(p){p.altKey&&this.buffer.push("alt"),p.ctrlKey&&this.buffer.push("ctrl"),p.metaKey&&this.buffer.push("meta"),p.shiftKey&&this.buffer.push("shift"),this.buffer.push(p.key);const _=this.buffer.join("+");return this.buffer.length=0,_}exec(p,_){if(!this.allKeys.has(_.key))return;const y=this.callbacks.get(this.#e(_));if(!y)return;const{callback:v,options:{bubbles:T=!1,args:w=[],checker:E=null}}=y;E&&!E(p,_)||(v.bind(p,...w,_)(),T||(_.stopPropagation(),_.preventDefault()))}}class i{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const p=new Map([["CanvasText",null],["Canvas",null]]);return(0,o.getColorValues)(p),(0,s.shadow)(this,"_colors",p)}convert(p){const _=(0,o.getRGB)(p);if(!window.matchMedia("(forced-colors: active)").matches)return _;for(const[y,v]of this._colors)if(v.every((T,w)=>T===_[w]))return i._colorsMapping.get(y);return _}getHexCode(p){const _=this._colors.get(p);return _?s.Util.makeHexColor(..._):p}}class r{#e=null;#t=new Map;#n=new Map;#r=null;#s=null;#i=new h;#o=0;#l=new Set;#u=null;#c=null;#f=new Set;#h=null;#d=null;#a=null;#p=new m;#g=!1;#y=!1;#b=null;#v=null;#_=s.AnnotationEditorType.NONE;#m=new Set;#E=null;#I=this.blur.bind(this);#B=this.focus.bind(this);#V=this.copy.bind(this);#N=this.cut.bind(this);#O=this.paste.bind(this);#x=this.keydown.bind(this);#k=this.onEditingAction.bind(this);#S=this.onPageChanging.bind(this);#T=this.onScaleChanging.bind(this);#R=this.onRotationChanging.bind(this);#L={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#P=[0,0];#A=null;#C=null;#U=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const p=r.prototype,_=w=>w.#C.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&w.hasSomethingToControl(),y=(w,{target:E})=>{if(E instanceof HTMLInputElement){const{type:P}=E;return P!=="text"&&P!=="number"}return!0},v=this.TRANSLATE_SMALL,T=this.TRANSLATE_BIG;return(0,s.shadow)(this,"_keyboardManager",new f([[["ctrl+a","mac+meta+a"],p.selectAll,{checker:y}],[["ctrl+z","mac+meta+z"],p.undo,{checker:y}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],p.redo,{checker:y}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],p.delete,{checker:y}],[["Enter","mac+Enter"],p.addNewEditorFromKeyboard,{checker:(w,{target:E})=>!(E instanceof HTMLButtonElement)&&w.#C.contains(E)&&!w.isEnterHandled}],[[" ","mac+ "],p.addNewEditorFromKeyboard,{checker:w=>w.#C.contains(document.activeElement)}],[["Escape","mac+Escape"],p.unselectAll],[["ArrowLeft","mac+ArrowLeft"],p.translateSelectedEditors,{args:[-v,0],checker:_}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],p.translateSelectedEditors,{args:[-T,0],checker:_}],[["ArrowRight","mac+ArrowRight"],p.translateSelectedEditors,{args:[v,0],checker:_}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],p.translateSelectedEditors,{args:[T,0],checker:_}],[["ArrowUp","mac+ArrowUp"],p.translateSelectedEditors,{args:[0,-v],checker:_}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],p.translateSelectedEditors,{args:[0,-T],checker:_}],[["ArrowDown","mac+ArrowDown"],p.translateSelectedEditors,{args:[0,v],checker:_}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],p.translateSelectedEditors,{args:[0,T],checker:_}]]))}constructor(p,_,y,v,T,w,E){this.#C=p,this.#U=_,this.#r=y,this._eventBus=v,this._eventBus._on("editingaction",this.#k),this._eventBus._on("pagechanging",this.#S),this._eventBus._on("scalechanging",this.#T),this._eventBus._on("rotationchanging",this.#R),this.#s=T.annotationStorage,this.#h=T.filterFactory,this.#E=w,this.#a=E||null,this.viewParameters={realScale:o.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){this.#M(),this.#F(),this._eventBus._off("editingaction",this.#k),this._eventBus._off("pagechanging",this.#S),this._eventBus._off("scalechanging",this.#T),this._eventBus._off("rotationchanging",this.#R);for(const p of this.#n.values())p.destroy();this.#n.clear(),this.#t.clear(),this.#f.clear(),this.#e=null,this.#m.clear(),this.#i.destroy(),this.#r?.destroy(),this.#d&&(clearTimeout(this.#d),this.#d=null),this.#A&&(clearTimeout(this.#A),this.#A=null)}get hcmFilter(){return(0,s.shadow)(this,"hcmFilter",this.#E?this.#h.addHCMFilter(this.#E.foreground,this.#E.background):"none")}get direction(){return(0,s.shadow)(this,"direction",getComputedStyle(this.#C).direction)}get highlightColors(){return(0,s.shadow)(this,"highlightColors",this.#a?new Map(this.#a.split(",").map(p=>p.split("=").map(_=>_.trim()))):null)}setMainHighlightColorPicker(p){this.#v=p}editAltText(p){this.#r?.editAltText(this,p)}onPageChanging({pageNumber:p}){this.#o=p-1}focusMainContainer(){this.#C.focus()}findParent(p,_){for(const y of this.#n.values()){const{x:v,y:T,width:w,height:E}=y.div.getBoundingClientRect();if(p>=v&&p<=v+w&&_>=T&&_<=T+E)return y}return null}disableUserSelect(p=!1){this.#U.classList.toggle("noUserSelect",p)}addShouldRescale(p){this.#f.add(p)}removeShouldRescale(p){this.#f.delete(p)}onScaleChanging({scale:p}){this.commitOrRemove(),this.viewParameters.realScale=p*o.PixelsPerInch.PDF_TO_CSS_UNITS;for(const _ of this.#f)_.onScaleChanging()}onRotationChanging({pagesRotation:p}){this.commitOrRemove(),this.viewParameters.rotation=p}addToAnnotationStorage(p){!p.isEmpty()&&this.#s&&!this.#s.has(p.id)&&this.#s.setValue(p.id,p)}#$(){window.addEventListener("focus",this.#B),window.addEventListener("blur",this.#I)}#F(){window.removeEventListener("focus",this.#B),window.removeEventListener("blur",this.#I)}blur(){if(!this.hasSelection)return;const{activeElement:p}=document;for(const _ of this.#m)if(_.div.contains(p)){this.#b=[_,p],_._focusEventsAllowed=!1;break}}focus(){if(!this.#b)return;const[p,_]=this.#b;this.#b=null,_.addEventListener("focusin",()=>{p._focusEventsAllowed=!0},{once:!0}),_.focus()}#D(){window.addEventListener("keydown",this.#x)}#M(){window.removeEventListener("keydown",this.#x)}#j(){document.addEventListener("copy",this.#V),document.addEventListener("cut",this.#N),document.addEventListener("paste",this.#O)}#H(){document.removeEventListener("copy",this.#V),document.removeEventListener("cut",this.#N),document.removeEventListener("paste",this.#O)}addEditListeners(){this.#D(),this.#j()}removeEditListeners(){this.#M(),this.#H()}copy(p){if(p.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const _=[];for(const y of this.#m){const v=y.serialize(!0);v&&_.push(v)}_.length!==0&&p.clipboardData.setData("application/pdfjs",JSON.stringify(_))}cut(p){this.copy(p),this.delete()}paste(p){p.preventDefault();const{clipboardData:_}=p;for(const T of _.items)for(const w of this.#c)if(w.isHandlingMimeForPasting(T.type)){w.paste(T,this.currentLayer);return}let y=_.getData("application/pdfjs");if(!y)return;try{y=JSON.parse(y)}catch(T){(0,s.warn)(`paste: "${T.message}".`);return}if(!Array.isArray(y))return;this.unselectAll();const v=this.currentLayer;try{const T=[];for(const P of y){const R=v.deserialize(P);if(!R)return;T.push(R)}const w=()=>{for(const P of T)this.#q(P);this.#Y(T)},E=()=>{for(const P of T)P.remove()};this.addCommands({cmd:w,undo:E,mustExec:!0})}catch(T){(0,s.warn)(`paste: "${T.message}".`)}}keydown(p){this.isEditorHandlingKeyboard||r._keyboardManager.exec(this,p)}onEditingAction(p){["undo","redo","delete","selectAll"].includes(p.name)&&this[p.name]()}#w(p){Object.entries(p).some(([y,v])=>this.#L[y]!==v)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#L,p)})}#z(p){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:p})}setEditingState(p){p?(this.#$(),this.#D(),this.#j(),this.#w({isEditing:this.#_!==s.AnnotationEditorType.NONE,isEmpty:this.#G(),hasSomethingToUndo:this.#i.hasSomethingToUndo(),hasSomethingToRedo:this.#i.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#F(),this.#M(),this.#H(),this.#w({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(p){if(!this.#c){this.#c=p;for(const _ of this.#c)this.#z(_.defaultPropertiesToUpdate)}}getId(){return this.#p.getId()}get currentLayer(){return this.#n.get(this.#o)}getLayer(p){return this.#n.get(p)}get currentPageIndex(){return this.#o}addLayer(p){this.#n.set(p.pageIndex,p),this.#g?p.enable():p.disable()}removeLayer(p){this.#n.delete(p.pageIndex)}updateMode(p,_=null,y=!1){if(this.#_!==p){if(this.#_=p,p===s.AnnotationEditorType.NONE){this.setEditingState(!1),this.#X();return}this.setEditingState(!0),this.#W(),this.unselectAll();for(const v of this.#n.values())v.updateMode(p);if(!_&&y){this.addNewEditorFromKeyboard();return}if(_){for(const v of this.#t.values())if(v.annotationElementId===_){this.setSelected(v),v.enterInEditMode();break}}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(p){p!==this.#_&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:p})}updateParams(p,_){if(this.#c){switch(p){case s.AnnotationEditorParamsType.CREATE:this.currentLayer.addNewEditor();return;case s.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:this.#v?.updateColor(_);break}for(const y of this.#m)y.updateParams(p,_);for(const y of this.#c)y.updateDefaultParams(p,_)}}enableWaiting(p=!1){if(this.#y!==p){this.#y=p;for(const _ of this.#n.values())p?_.disableClick():_.enableClick(),_.div.classList.toggle("waiting",p)}}#W(){if(!this.#g){this.#g=!0;for(const p of this.#n.values())p.enable()}}#X(){if(this.unselectAll(),this.#g){this.#g=!1;for(const p of this.#n.values())p.disable()}}getEditors(p){const _=[];for(const y of this.#t.values())y.pageIndex===p&&_.push(y);return _}getEditor(p){return this.#t.get(p)}addEditor(p){this.#t.set(p.id,p)}removeEditor(p){p.div.contains(document.activeElement)&&(this.#d&&clearTimeout(this.#d),this.#d=setTimeout(()=>{this.focusMainContainer(),this.#d=null},0)),this.#t.delete(p.id),this.unselect(p),(!p.annotationElementId||!this.#l.has(p.annotationElementId))&&this.#s?.remove(p.id)}addDeletedAnnotationElement(p){this.#l.add(p.annotationElementId),p.deleted=!0}isDeletedAnnotationElement(p){return this.#l.has(p)}removeDeletedAnnotationElement(p){this.#l.delete(p.annotationElementId),p.deleted=!1}#q(p){const _=this.#n.get(p.pageIndex);_?_.addOrRebuild(p):this.addEditor(p)}setActiveEditor(p){this.#e!==p&&(this.#e=p,p&&this.#z(p.propertiesToUpdate))}toggleSelected(p){if(this.#m.has(p)){this.#m.delete(p),p.unselect(),this.#w({hasSelectedEditor:this.hasSelection});return}this.#m.add(p),p.select(),this.#z(p.propertiesToUpdate),this.#w({hasSelectedEditor:!0})}setSelected(p){for(const _ of this.#m)_!==p&&_.unselect();this.#m.clear(),this.#m.add(p),p.select(),this.#z(p.propertiesToUpdate),this.#w({hasSelectedEditor:!0})}isSelected(p){return this.#m.has(p)}get firstSelectedEditor(){return this.#m.values().next().value}unselect(p){p.unselect(),this.#m.delete(p),this.#w({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#m.size!==0}get isEnterHandled(){return this.#m.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#i.undo(),this.#w({hasSomethingToUndo:this.#i.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#G()})}redo(){this.#i.redo(),this.#w({hasSomethingToUndo:!0,hasSomethingToRedo:this.#i.hasSomethingToRedo(),isEmpty:this.#G()})}addCommands(p){this.#i.add(p),this.#w({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#G()})}#G(){if(this.#t.size===0)return!0;if(this.#t.size===1)for(const p of this.#t.values())return p.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const p=[...this.#m],_=()=>{for(const v of p)v.remove()},y=()=>{for(const v of p)this.#q(v)};this.addCommands({cmd:_,undo:y,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#Y(p){this.#m.clear();for(const _ of p)_.isEmpty()||(this.#m.add(_),_.select());this.#w({hasSelectedEditor:!0})}selectAll(){for(const p of this.#m)p.commit();this.#Y(this.#t.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#_!==s.AnnotationEditorType.NONE))&&this.hasSelection){for(const p of this.#m)p.unselect();this.#m.clear(),this.#w({hasSelectedEditor:!1})}}translateSelectedEditors(p,_,y=!1){if(y||this.commitOrRemove(),!this.hasSelection)return;this.#P[0]+=p,this.#P[1]+=_;const[v,T]=this.#P,w=[...this.#m],E=1e3;this.#A&&clearTimeout(this.#A),this.#A=setTimeout(()=>{this.#A=null,this.#P[0]=this.#P[1]=0,this.addCommands({cmd:()=>{for(const P of w)this.#t.has(P.id)&&P.translateInPage(v,T)},undo:()=>{for(const P of w)this.#t.has(P.id)&&P.translateInPage(-v,-T)},mustExec:!1})},E);for(const P of w)P.translateInPage(p,_)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#u=new Map;for(const p of this.#m)this.#u.set(p,{savedX:p.x,savedY:p.y,savedPageIndex:p.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#u)return!1;this.disableUserSelect(!1);const p=this.#u;this.#u=null;let _=!1;for(const[{x:v,y:T,pageIndex:w},E]of p)E.newX=v,E.newY=T,E.newPageIndex=w,_||=v!==E.savedX||T!==E.savedY||w!==E.savedPageIndex;if(!_)return!1;const y=(v,T,w,E)=>{if(this.#t.has(v.id)){const P=this.#n.get(E);P?v._setParentAndPosition(P,T,w):(v.pageIndex=E,v.x=T,v.y=w)}};return this.addCommands({cmd:()=>{for(const[v,{newX:T,newY:w,newPageIndex:E}]of p)y(v,T,w,E)},undo:()=>{for(const[v,{savedX:T,savedY:w,savedPageIndex:E}]of p)y(v,T,w,E)},mustExec:!0}),!0}dragSelectedEditors(p,_){if(this.#u)for(const y of this.#u.keys())y.drag(p,_)}rebuild(p){if(p.parent===null){const _=this.getLayer(p.pageIndex);_?(_.changeParent(p),_.addOrRebuild(p)):(this.addEditor(p),this.addToAnnotationStorage(p),p.rebuild())}else p.parent.addOrRebuild(p)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#m.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(p){return this.#e===p}getActive(){return this.#e}getMode(){return this.#_}get imageManager(){return(0,s.shadow)(this,"imageManager",new g)}}}),171:((n,e,t)=>{t.d(e,{PDFFetchStream:()=>g});var s=t(266),o=t(253);function u(i,r,d){return{method:"GET",headers:i,signal:d.signal,mode:"cors",credentials:r?"include":"same-origin",redirect:"follow"}}function l(i){const r=new Headers;for(const d in i){const p=i[d];p!==void 0&&r.append(d,p)}return r}function m(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:((0,s.warn)(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}class g{constructor(r){this.source=r,this.isHttp=/^https?:/i.test(r.url),this.httpHeaders=this.isHttp&&r.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,s.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new h(this),this._fullRequestReader}getRangeReader(r,d){if(d<=this._progressiveDataLength)return null;const p=new f(this,r,d);return this._rangeRequestReaders.push(p),p}cancelAllRequests(r){this._fullRequestReader?.cancel(r);for(const d of this._rangeRequestReaders.slice(0))d.cancel(r)}}class h{constructor(r){this._stream=r,this._reader=null,this._loaded=0,this._filename=null;const d=r.source;this._withCredentials=d.withCredentials||!1,this._contentLength=d.length,this._headersCapability=new s.PromiseCapability,this._disableRange=d.disableRange||!1,this._rangeChunkSize=d.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!d.disableStream,this._isRangeSupported=!d.disableRange,this._headers=l(this._stream.httpHeaders);const p=d.url;fetch(p,u(this._headers,this._withCredentials,this._abortController)).then(_=>{if(!(0,o.validateResponseStatus)(_.status))throw(0,o.createResponseStatusError)(_.status,p);this._reader=_.body.getReader(),this._headersCapability.resolve();const y=w=>_.headers.get(w),{allowRangeRequests:v,suggestedLength:T}=(0,o.validateRangeRequestCapabilities)({getResponseHeader:y,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=v,this._contentLength=T||this._contentLength,this._filename=(0,o.extractFilenameFromHeader)(y),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new s.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:r,done:d}=await this._reader.read();return d?{value:r,done:d}:(this._loaded+=r.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:m(r),done:!1})}cancel(r){this._reader?.cancel(r),this._abortController.abort()}}class f{constructor(r,d,p){this._stream=r,this._reader=null,this._loaded=0;const _=r.source;this._withCredentials=_.withCredentials||!1,this._readCapability=new s.PromiseCapability,this._isStreamingSupported=!_.disableStream,this._abortController=new AbortController,this._headers=l(this._stream.httpHeaders),this._headers.append("Range",`bytes=${d}-${p-1}`);const y=_.url;fetch(y,u(this._headers,this._withCredentials,this._abortController)).then(v=>{if(!(0,o.validateResponseStatus)(v.status))throw(0,o.createResponseStatusError)(v.status,y);this._readCapability.resolve(),this._reader=v.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:r,done:d}=await this._reader.read();return d?{value:r,done:d}:(this._loaded+=r.byteLength,this.onProgress?.({loaded:this._loaded}),{value:m(r),done:!1})}cancel(r){this._reader?.cancel(r),this._abortController.abort()}}}),742:((n,e,t)=>{t.d(e,{FontFaceObject:()=>u,FontLoader:()=>o});var s=t(266);class o{#e=new Set;constructor({ownerDocument:m=globalThis.document,styleElement:g=null}){this._document=m,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(m){this.nativeFontFaces.add(m),this._document.fonts.add(m)}removeNativeFontFace(m){this.nativeFontFaces.delete(m),this._document.fonts.delete(m)}insertRule(m){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const g=this.styleElement.sheet;g.insertRule(m,g.cssRules.length)}clear(){for(const m of this.nativeFontFaces)this._document.fonts.delete(m);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:m,_inspectFont:g}){if(!(!m||this.#e.has(m.loadedName))){if((0,s.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:h,src:f,style:i}=m,r=new FontFace(h,f,i);this.addNativeFontFace(r);try{await r.load(),this.#e.add(h),g?.(m)}catch{(0,s.warn)(`Cannot load system font: ${m.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}return}(0,s.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(m){if(m.attached||m.missingFile&&!m.systemFontInfo)return;if(m.attached=!0,m.systemFontInfo){await this.loadSystemFont(m);return}if(this.isFontLoadingAPISupported){const h=m.createNativeFontFace();if(h){this.addNativeFontFace(h);try{await h.loaded}catch(f){throw(0,s.warn)(`Failed to load font '${h.family}': '${f}'.`),m.disableFontFace=!0,f}}return}const g=m.createFontFaceRule();if(g){if(this.insertRule(g),this.isSyncFontLoadingSupported)return;await new Promise(h=>{const f=this._queueLoadingCallback(h);this._prepareFontLoadEvent(m,f)})}}get isFontLoadingAPISupported(){const m=!!this._document?.fonts;return(0,s.shadow)(this,"isFontLoadingAPISupported",m)}get isSyncFontLoadingSupported(){let m=!1;return(s.isNodeJS||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(m=!0),(0,s.shadow)(this,"isSyncFontLoadingSupported",m)}_queueLoadingCallback(m){function g(){for((0,s.assert)(!f.done,"completeRequest() cannot be called twice."),f.done=!0;h.length>0&&h[0].done;){const i=h.shift();setTimeout(i.callback,0)}}const{loadingRequests:h}=this,f={done:!1,complete:g,callback:m};return h.push(f),f}get _loadTestFont(){const m=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,s.shadow)(this,"_loadTestFont",m)}_prepareFontLoadEvent(m,g){function h(D,Y){return D.charCodeAt(Y)<<24|D.charCodeAt(Y+1)<<16|D.charCodeAt(Y+2)<<8|D.charCodeAt(Y+3)&255}function f(D,Y,se,re){const W=D.substring(0,Y),$=D.substring(Y+se);return W+re+$}let i,r;const d=this._document.createElement("canvas");d.width=1,d.height=1;const p=d.getContext("2d");let _=0;function y(D,Y){if(++_>30){(0,s.warn)("Load test font never loaded."),Y();return}if(p.font="30px "+D,p.fillText(".",0,20),p.getImageData(0,0,1,1).data[3]>0){Y();return}setTimeout(y.bind(null,D,Y))}const v=`lt${Date.now()}${this.loadTestFontId++}`;let T=this._loadTestFont;T=f(T,976,v.length,v);const E=16,P=1482184792;let R=h(T,E);for(i=0,r=v.length-3;i<r;i+=4)R=R-P+h(v,i)|0;i<v.length&&(R=R-P+h(v+"XXX",i)|0),T=f(T,E,4,(0,s.string32)(R));const I=`url(data:font/opentype;base64,${btoa(T)});`,N=`@font-face {font-family:"${v}";src:${I}}`;this.insertRule(N);const B=this._document.createElement("div");B.style.visibility="hidden",B.style.width=B.style.height="10px",B.style.position="absolute",B.style.top=B.style.left="0px";for(const D of[m.loadedName,v]){const Y=this._document.createElement("span");Y.textContent="Hi",Y.style.fontFamily=D,B.append(Y)}this._document.body.append(B),y(v,()=>{B.remove(),g.complete()})}}class u{constructor(m,{isEvalSupported:g=!0,disableFontFace:h=!1,ignoreErrors:f=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(const r in m)this[r]=m[r];this.isEvalSupported=g!==!1,this.disableFontFace=h===!0,this.ignoreErrors=f===!0,this._inspectFont=i}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let m;if(!this.cssFontInfo)m=new FontFace(this.loadedName,this.data,{});else{const g={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(g.style=`oblique ${this.cssFontInfo.italicAngle}deg`),m=new FontFace(this.cssFontInfo.fontFamily,this.data,g)}return this._inspectFont?.(this),m}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const m=(0,s.bytesToString)(this.data),g=`url(data:${this.mimetype};base64,${btoa(m)});`;let h;if(!this.cssFontInfo)h=`@font-face {font-family:"${this.loadedName}";src:${g}}`;else{let f=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(f+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),h=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${f}src:${g}}`}return this._inspectFont?.(this,g),h}getPathGenerator(m,g){if(this.compiledGlyphs[g]!==void 0)return this.compiledGlyphs[g];let h;try{h=m.get(this.loadedName+"_path_"+g)}catch(f){if(!this.ignoreErrors)throw f;return(0,s.warn)(`getPathGenerator - ignoring character: "${f}".`),this.compiledGlyphs[g]=function(i,r){}}if(this.isEvalSupported&&s.FeatureTest.isEvalSupported){const f=[];for(const i of h){const r=i.args!==void 0?i.args.join(","):"";f.push("c.",i.cmd,"(",r,`);
`)}return this.compiledGlyphs[g]=new Function("c","size",f.join(""))}return this.compiledGlyphs[g]=function(f,i){for(const r of h)r.cmd==="scale"&&(r.args=[i,-i]),f[r.cmd].apply(f,r.args)}}}}),472:((n,e,t)=>{t.d(e,{Metadata:()=>o});var s=t(266);class o{#e;#t;constructor({parsedData:l,rawData:m}){this.#e=l,this.#t=m}getRaw(){return this.#t}get(l){return this.#e.get(l)??null}getAll(){return(0,s.objectFromMap)(this.#e)}has(l){return this.#e.has(l)}}}),474:((n,e,t)=>{t.d(e,{PDFNetworkStream:()=>h});var s=t(266),o=t(253);const u=200,l=206;function m(r){const d=r.response;return typeof d!="string"?d:(0,s.stringToBytes)(d).buffer}class g{constructor(d,p={}){this.url=d,this.isHttp=/^https?:/i.test(d),this.httpHeaders=this.isHttp&&p.httpHeaders||Object.create(null),this.withCredentials=p.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(d,p,_){const y={begin:d,end:p};for(const v in _)y[v]=_[v];return this.request(y)}requestFull(d){return this.request(d)}request(d){const p=new XMLHttpRequest,_=this.currXhrId++,y=this.pendingRequests[_]={xhr:p};p.open("GET",this.url),p.withCredentials=this.withCredentials;for(const v in this.httpHeaders){const T=this.httpHeaders[v];T!==void 0&&p.setRequestHeader(v,T)}return this.isHttp&&"begin"in d&&"end"in d?(p.setRequestHeader("Range",`bytes=${d.begin}-${d.end-1}`),y.expectedStatus=l):y.expectedStatus=u,p.responseType="arraybuffer",d.onError&&(p.onerror=function(v){d.onError(p.status)}),p.onreadystatechange=this.onStateChange.bind(this,_),p.onprogress=this.onProgress.bind(this,_),y.onHeadersReceived=d.onHeadersReceived,y.onDone=d.onDone,y.onError=d.onError,y.onProgress=d.onProgress,p.send(null),_}onProgress(d,p){const _=this.pendingRequests[d];_&&_.onProgress?.(p)}onStateChange(d,p){const _=this.pendingRequests[d];if(!_)return;const y=_.xhr;if(y.readyState>=2&&_.onHeadersReceived&&(_.onHeadersReceived(),delete _.onHeadersReceived),y.readyState!==4||!(d in this.pendingRequests))return;if(delete this.pendingRequests[d],y.status===0&&this.isHttp){_.onError?.(y.status);return}const v=y.status||u;if(!(v===u&&_.expectedStatus===l)&&v!==_.expectedStatus){_.onError?.(y.status);return}const w=m(y);if(v===l){const E=y.getResponseHeader("Content-Range"),P=/bytes (\d+)-(\d+)\/(\d+)/.exec(E);_.onDone({begin:parseInt(P[1],10),chunk:w})}else w?_.onDone({begin:0,chunk:w}):_.onError?.(y.status)}getRequestXhr(d){return this.pendingRequests[d].xhr}isPendingRequest(d){return d in this.pendingRequests}abortRequest(d){const p=this.pendingRequests[d].xhr;delete this.pendingRequests[d],p.abort()}}class h{constructor(d){this._source=d,this._manager=new g(d.url,{httpHeaders:d.httpHeaders,withCredentials:d.withCredentials}),this._rangeChunkSize=d.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(d){const p=this._rangeRequestReaders.indexOf(d);p>=0&&this._rangeRequestReaders.splice(p,1)}getFullReader(){return(0,s.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new f(this._manager,this._source),this._fullRequestReader}getRangeReader(d,p){const _=new i(this._manager,d,p);return _.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(_),_}cancelAllRequests(d){this._fullRequestReader?.cancel(d);for(const p of this._rangeRequestReaders.slice(0))p.cancel(d)}}class f{constructor(d,p){this._manager=d;const _={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=p.url,this._fullRequestId=d.requestFull(_),this._headersReceivedCapability=new s.PromiseCapability,this._disableRange=p.disableRange||!1,this._contentLength=p.length,this._rangeChunkSize=p.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const d=this._fullRequestId,p=this._manager.getRequestXhr(d),_=T=>p.getResponseHeader(T),{allowRangeRequests:y,suggestedLength:v}=(0,o.validateRangeRequestCapabilities)({getResponseHeader:_,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});y&&(this._isRangeSupported=!0),this._contentLength=v||this._contentLength,this._filename=(0,o.extractFilenameFromHeader)(_),this._isRangeSupported&&this._manager.abortRequest(d),this._headersReceivedCapability.resolve()}_onDone(d){if(d&&(this._requests.length>0?this._requests.shift().resolve({value:d.chunk,done:!1}):this._cachedChunks.push(d.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(d){this._storedError=(0,o.createResponseStatusError)(d,this._url),this._headersReceivedCapability.reject(this._storedError);for(const p of this._requests)p.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(d){this.onProgress?.({loaded:d.loaded,total:d.lengthComputable?d.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const d=new s.PromiseCapability;return this._requests.push(d),d.promise}cancel(d){this._done=!0,this._headersReceivedCapability.reject(d);for(const p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class i{constructor(d,p,_){this._manager=d;const y={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=d.url,this._requestId=d.requestRange(p,_,y),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(d){const p=d.chunk;this._requests.length>0?this._requests.shift().resolve({value:p,done:!1}):this._queuedChunk=p,this._done=!0;for(const _ of this._requests)_.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(d){this._storedError=(0,o.createResponseStatusError)(d,this._url);for(const p of this._requests)p.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(d){this.isStreamingSupported||this.onProgress?.({loaded:d.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const p=this._queuedChunk;return this._queuedChunk=null,{value:p,done:!1}}if(this._done)return{value:void 0,done:!0};const d=new s.PromiseCapability;return this._requests.push(d),d.promise}cancel(d){this._done=!0;for(const p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}}),253:((n,e,t)=>{t.d(e,{createResponseStatusError:()=>g,extractFilenameFromHeader:()=>m,validateRangeRequestCapabilities:()=>l,validateResponseStatus:()=>h});var s=t(266);function o(f){let i=!0,r=d("filename\\*","i").exec(f);if(r){r=r[1];let E=v(r);return E=unescape(E),E=T(E),E=w(E),_(E)}if(r=y(f),r){const E=w(r);return _(E)}if(r=d("filename","i").exec(f),r){r=r[1];let E=v(r);return E=w(E),_(E)}function d(E,P){return new RegExp("(?:^|;)\\s*"+E+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',P)}function p(E,P){if(E){if(!/^[\x00-\xFF]+$/.test(P))return P;try{const R=new TextDecoder(E,{fatal:!0}),I=(0,s.stringToBytes)(P);P=R.decode(I),i=!1}catch{}}return P}function _(E){return i&&/[\x80-\xff]/.test(E)&&(E=p("utf-8",E),i&&(E=p("iso-8859-1",E))),E}function y(E){const P=[];let R;const I=d("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(R=I.exec(E))!==null;){let[,B,D,Y]=R;if(B=parseInt(B,10),B in P){if(B===0)break;continue}P[B]=[D,Y]}const N=[];for(let B=0;B<P.length&&B in P;++B){let[D,Y]=P[B];Y=v(Y),D&&(Y=unescape(Y),B===0&&(Y=T(Y))),N.push(Y)}return N.join("")}function v(E){if(E.startsWith('"')){const P=E.slice(1).split('\\"');for(let R=0;R<P.length;++R){const I=P[R].indexOf('"');I!==-1&&(P[R]=P[R].slice(0,I),P.length=R+1),P[R]=P[R].replaceAll(/\\(.)/g,"$1")}E=P.join('"')}return E}function T(E){const P=E.indexOf("'");if(P===-1)return E;const R=E.slice(0,P),N=E.slice(P+1).replace(/^[^']*'/,"");return p(R,N)}function w(E){return!E.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(E)?E:E.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(P,R,I,N){if(I==="q"||I==="Q")return N=N.replaceAll("_"," "),N=N.replaceAll(/=([0-9a-fA-F]{2})/g,function(B,D){return String.fromCharCode(parseInt(D,16))}),p(R,N);try{N=atob(N)}catch{}return p(R,N)})}return""}var u=t(473);function l({getResponseHeader:f,isHttp:i,rangeChunkSize:r,disableRange:d}){const p={allowRangeRequests:!1,suggestedLength:void 0},_=parseInt(f("Content-Length"),10);return!Number.isInteger(_)||(p.suggestedLength=_,_<=2*r)||d||!i||f("Accept-Ranges")!=="bytes"||(f("Content-Encoding")||"identity")!=="identity"||(p.allowRangeRequests=!0),p}function m(f){const i=f("Content-Disposition");if(i){let r=o(i);if(r.includes("%"))try{r=decodeURIComponent(r)}catch{}if((0,u.isPdfFile)(r))return r}return null}function g(f,i){return f===404||f===0&&i.startsWith("file:")?new s.MissingPDFException('Missing PDF "'+i+'".'):new s.UnexpectedResponseException(`Unexpected server response (${f}) while retrieving PDF "${i}".`,f)}function h(f){return f===200||f===206}}),498:((n,e,t)=>{t.a(n,async(s,o)=>{try{let r=function(P){const R=f.parse(P);return R.protocol==="file:"||R.host?R:/^[a-z]:[/\\]/i.test(P)?f.parse(`file:///${P}`):(R.host||(R.protocol="file:"),R)},y=function(P,R){return{protocol:P.protocol,auth:P.auth,host:P.hostname,port:P.port,path:P.path,method:"GET",headers:R}};t.d(e,{PDFNodeStream:()=>d});var u=t(266),l=t(253);let m,g,h,f;u.isNodeJS&&(m=await __vitePreload(()=>import("./__vite-browser-external-DTHgcB49.js").then(P=>P.O),[]),g=await __vitePreload(()=>import("./__vite-browser-external-DTHgcB49.js").then(P=>P.O),[]),h=await __vitePreload(()=>import("./__vite-browser-external-DTHgcB49.js").then(P=>P.O),[]),f=await __vitePreload(()=>import("./__vite-browser-external-DTHgcB49.js").then(P=>P.O),[]));const i=/^file:\/\/\/[a-zA-Z]:\//;class d{constructor(R){this.source=R,this.url=r(R.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&R.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,u.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new w(this):new v(this),this._fullRequestReader}getRangeReader(R,I){if(I<=this._progressiveDataLength)return null;const N=this.isFsUrl?new E(this,R,I):new T(this,R,I);return this._rangeRequestReaders.push(N),N}cancelAllRequests(R){this._fullRequestReader?.cancel(R);for(const I of this._rangeRequestReaders.slice(0))I.cancel(R)}}class p{constructor(R){this._url=R.url,this._done=!1,this._storedError=null,this.onProgress=null;const I=R.source;this._contentLength=I.length,this._loaded=0,this._filename=null,this._disableRange=I.disableRange||!1,this._rangeChunkSize=I.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!I.disableStream,this._isRangeSupported=!I.disableRange,this._readableStream=null,this._readCapability=new u.PromiseCapability,this._headersCapability=new u.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const R=this._readableStream.read();return R===null?(this._readCapability=new u.PromiseCapability,this.read()):(this._loaded+=R.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(R).buffer,done:!1})}cancel(R){if(!this._readableStream){this._error(R);return}this._readableStream.destroy(R)}_error(R){this._storedError=R,this._readCapability.resolve()}_setReadableStream(R){this._readableStream=R,R.on("readable",()=>{this._readCapability.resolve()}),R.on("end",()=>{R.destroy(),this._done=!0,this._readCapability.resolve()}),R.on("error",I=>{this._error(I)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new u.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class _{constructor(R){this._url=R.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new u.PromiseCapability;const I=R.source;this._isStreamingSupported=!I.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const R=this._readableStream.read();return R===null?(this._readCapability=new u.PromiseCapability,this.read()):(this._loaded+=R.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(R).buffer,done:!1})}cancel(R){if(!this._readableStream){this._error(R);return}this._readableStream.destroy(R)}_error(R){this._storedError=R,this._readCapability.resolve()}_setReadableStream(R){this._readableStream=R,R.on("readable",()=>{this._readCapability.resolve()}),R.on("end",()=>{R.destroy(),this._done=!0,this._readCapability.resolve()}),R.on("error",I=>{this._error(I)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class v extends p{constructor(R){super(R);const I=N=>{if(N.statusCode===404){const se=new u.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=se,this._headersCapability.reject(se);return}this._headersCapability.resolve(),this._setReadableStream(N);const B=se=>this._readableStream.headers[se.toLowerCase()],{allowRangeRequests:D,suggestedLength:Y}=(0,l.validateRangeRequestCapabilities)({getResponseHeader:B,isHttp:R.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=D,this._contentLength=Y||this._contentLength,this._filename=(0,l.extractFilenameFromHeader)(B)};this._request=null,this._url.protocol==="http:"?this._request=g.request(y(this._url,R.httpHeaders),I):this._request=h.request(y(this._url,R.httpHeaders),I),this._request.on("error",N=>{this._storedError=N,this._headersCapability.reject(N)}),this._request.end()}}class T extends _{constructor(R,I,N){super(R),this._httpHeaders={};for(const D in R.httpHeaders){const Y=R.httpHeaders[D];Y!==void 0&&(this._httpHeaders[D]=Y)}this._httpHeaders.Range=`bytes=${I}-${N-1}`;const B=D=>{if(D.statusCode===404){const Y=new u.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=Y;return}this._setReadableStream(D)};this._request=null,this._url.protocol==="http:"?this._request=g.request(y(this._url,this._httpHeaders),B):this._request=h.request(y(this._url,this._httpHeaders),B),this._request.on("error",D=>{this._storedError=D}),this._request.end()}}class w extends p{constructor(R){super(R);let I=decodeURIComponent(this._url.path);i.test(this._url.href)&&(I=I.replace(/^\//,"")),m.lstat(I,(N,B)=>{if(N){N.code==="ENOENT"&&(N=new u.MissingPDFException(`Missing PDF "${I}".`)),this._storedError=N,this._headersCapability.reject(N);return}this._contentLength=B.size,this._setReadableStream(m.createReadStream(I)),this._headersCapability.resolve()})}}class E extends _{constructor(R,I,N){super(R);let B=decodeURIComponent(this._url.path);i.test(this._url.href)&&(B=B.replace(/^\//,"")),this._setReadableStream(m.createReadStream(B,{start:I,end:N-1}))}}o()}catch(m){o(m)}},1)}),738:((n,e,t)=>{t.a(n,async(s,o)=>{try{t.d(e,{NodeCMapReaderFactory:()=>d,NodeCanvasFactory:()=>r,NodeFilterFactory:()=>i,NodeStandardFontDataFactory:()=>p});var u=t(822),l=t(266);let m,g,h;if(l.isNodeJS){m=await __vitePreload(()=>import("./__vite-browser-external-DTHgcB49.js").then(_=>_.O),[]);try{g=await __vitePreload(()=>import("./__vite-browser-external-DTHgcB49.js").then(_=>_.O),[])}catch{}try{h=await __vitePreload(()=>import("./path2d-polyfill.esm-BlsVoZcq.js"),[])}catch{}}const f=function(_){return new Promise((y,v)=>{m.readFile(_,(T,w)=>{if(T||!w){v(new Error(T));return}y(new Uint8Array(w))})})};class i extends u.BaseFilterFactory{}class r extends u.BaseCanvasFactory{_createCanvas(y,v){return g.createCanvas(y,v)}}class d extends u.BaseCMapReaderFactory{_fetchData(y,v){return f(y).then(T=>({cMapData:T,compressionType:v}))}}class p extends u.BaseStandardFontDataFactory{_fetchData(y){return f(y)}}o()}catch(m){o(m)}},1)}),890:((n,e,t)=>{t.d(e,{OptionalContentConfig:()=>m});var s=t(266),o=t(825);const u=Symbol("INTERNAL");class l{#e=!0;constructor(h,f){this.name=h,this.intent=f}get visible(){return this.#e}_setVisible(h,f){h!==u&&(0,s.unreachable)("Internal method `_setVisible` called."),this.#e=f}}class m{#e=null;#t=new Map;#n=null;#r=null;constructor(h){if(this.name=null,this.creator=null,h!==null){this.name=h.name,this.creator=h.creator,this.#r=h.order;for(const f of h.groups)this.#t.set(f.id,new l(f.name,f.intent));if(h.baseState==="OFF")for(const f of this.#t.values())f._setVisible(u,!1);for(const f of h.on)this.#t.get(f)._setVisible(u,!0);for(const f of h.off)this.#t.get(f)._setVisible(u,!1);this.#n=this.getHash()}}#s(h){const f=h.length;if(f<2)return!0;const i=h[0];for(let r=1;r<f;r++){const d=h[r];let p;if(Array.isArray(d))p=this.#s(d);else if(this.#t.has(d))p=this.#t.get(d).visible;else return(0,s.warn)(`Optional content group not found: ${d}`),!0;switch(i){case"And":if(!p)return!1;break;case"Or":if(p)return!0;break;case"Not":return!p;default:return!0}}return i==="And"}isVisible(h){if(this.#t.size===0)return!0;if(!h)return(0,s.warn)("Optional content group not defined."),!0;if(h.type==="OCG")return this.#t.has(h.id)?this.#t.get(h.id).visible:((0,s.warn)(`Optional content group not found: ${h.id}`),!0);if(h.type==="OCMD"){if(h.expression)return this.#s(h.expression);if(!h.policy||h.policy==="AnyOn"){for(const f of h.ids){if(!this.#t.has(f))return(0,s.warn)(`Optional content group not found: ${f}`),!0;if(this.#t.get(f).visible)return!0}return!1}else if(h.policy==="AllOn"){for(const f of h.ids){if(!this.#t.has(f))return(0,s.warn)(`Optional content group not found: ${f}`),!0;if(!this.#t.get(f).visible)return!1}return!0}else if(h.policy==="AnyOff"){for(const f of h.ids){if(!this.#t.has(f))return(0,s.warn)(`Optional content group not found: ${f}`),!0;if(!this.#t.get(f).visible)return!0}return!1}else if(h.policy==="AllOff"){for(const f of h.ids){if(!this.#t.has(f))return(0,s.warn)(`Optional content group not found: ${f}`),!0;if(this.#t.get(f).visible)return!1}return!0}return(0,s.warn)(`Unknown optional content policy ${h.policy}.`),!0}return(0,s.warn)(`Unknown group type ${h.type}.`),!0}setVisibility(h,f=!0){if(!this.#t.has(h)){(0,s.warn)(`Optional content group not found: ${h}`);return}this.#t.get(h)._setVisible(u,!!f),this.#e=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#t.size?this.#r?this.#r.slice():[...this.#t.keys()]:null}getGroups(){return this.#t.size>0?(0,s.objectFromMap)(this.#t):null}getGroup(h){return this.#t.get(h)||null}getHash(){if(this.#e!==null)return this.#e;const h=new o.MurmurHash3_64;for(const[f,i]of this.#t)h.update(`${f}:${i.visible}`);return this.#e=h.hexdigest()}}}),739:((n,e,t)=>{t.d(e,{renderTextLayer:()=>_,updateTextLayer:()=>y});var s=t(266),o=t(473);const u=1e5,l=30,m=.8,g=new Map;function h(v,T){let w;if(T&&s.FeatureTest.isOffscreenCanvasSupported)w=new OffscreenCanvas(v,v).getContext("2d",{alpha:!1});else{const E=document.createElement("canvas");E.width=E.height=v,w=E.getContext("2d",{alpha:!1})}return w}function f(v,T){const w=g.get(v);if(w)return w;const E=h(l,T);E.font=`${l}px ${v}`;const P=E.measureText("");let R=P.fontBoundingBoxAscent,I=Math.abs(P.fontBoundingBoxDescent);if(R){const B=R/(R+I);return g.set(v,B),E.canvas.width=E.canvas.height=0,B}E.strokeStyle="red",E.clearRect(0,0,l,l),E.strokeText("g",0,0);let N=E.getImageData(0,0,l,l).data;I=0;for(let B=N.length-1-3;B>=0;B-=4)if(N[B]>0){I=Math.ceil(B/4/l);break}E.clearRect(0,0,l,l),E.strokeText("A",0,l),N=E.getImageData(0,0,l,l).data,R=0;for(let B=0,D=N.length;B<D;B+=4)if(N[B]>0){R=l-Math.floor(B/4/l);break}if(E.canvas.width=E.canvas.height=0,R){const B=R/(R+I);return g.set(v,B),B}return g.set(v,m),m}function i(v,T,w){const E=document.createElement("span"),P={angle:0,canvasWidth:0,hasText:T.str!=="",hasEOL:T.hasEOL,fontSize:0};v._textDivs.push(E);const R=s.Util.transform(v._transform,T.transform);let I=Math.atan2(R[1],R[0]);const N=w[T.fontName];N.vertical&&(I+=Math.PI/2);const B=v._fontInspectorEnabled&&N.fontSubstitution||N.fontFamily,D=Math.hypot(R[2],R[3]),Y=D*f(B,v._isOffscreenCanvasSupported);let se,re;I===0?(se=R[4],re=R[5]-Y):(se=R[4]+Y*Math.sin(I),re=R[5]-Y*Math.cos(I));const W="calc(var(--scale-factor)*",$=E.style;v._container===v._rootContainer?($.left=`${(100*se/v._pageWidth).toFixed(2)}%`,$.top=`${(100*re/v._pageHeight).toFixed(2)}%`):($.left=`${W}${se.toFixed(2)}px)`,$.top=`${W}${re.toFixed(2)}px)`),$.fontSize=`${W}${D.toFixed(2)}px)`,$.fontFamily=B,P.fontSize=D,E.setAttribute("role","presentation"),E.textContent=T.str,E.dir=T.dir,v._fontInspectorEnabled&&(E.dataset.fontName=N.fontSubstitutionLoadedName||T.fontName),I!==0&&(P.angle=I*(180/Math.PI));let k=!1;if(T.str.length>1)k=!0;else if(T.str!==" "&&T.transform[0]!==T.transform[3]){const H=Math.abs(T.transform[0]),de=Math.abs(T.transform[3]);H!==de&&Math.max(H,de)/Math.min(H,de)>1.5&&(k=!0)}k&&(P.canvasWidth=N.vertical?T.height:T.width),v._textDivProperties.set(E,P),v._isReadableStream&&v._layoutText(E)}function r(v){const{div:T,scale:w,properties:E,ctx:P,prevFontSize:R,prevFontFamily:I}=v,{style:N}=T;let B="";if(E.canvasWidth!==0&&E.hasText){const{fontFamily:D}=N,{canvasWidth:Y,fontSize:se}=E;(R!==se||I!==D)&&(P.font=`${se*w}px ${D}`,v.prevFontSize=se,v.prevFontFamily=D);const{width:re}=P.measureText(T.textContent);re>0&&(B=`scaleX(${Y*w/re})`)}E.angle!==0&&(B=`rotate(${E.angle}deg) ${B}`),B.length>0&&(N.transform=B)}function d(v){if(v._canceled)return;const T=v._textDivs,w=v._capability;if(T.length>u){w.resolve();return}if(!v._isReadableStream)for(const P of T)v._layoutText(P);w.resolve()}class p{constructor({textContentSource:T,container:w,viewport:E,textDivs:P,textDivProperties:R,textContentItemsStr:I,isOffscreenCanvasSupported:N}){this._textContentSource=T,this._isReadableStream=T instanceof ReadableStream,this._container=this._rootContainer=w,this._textDivs=P||[],this._textContentItemsStr=I||[],this._isOffscreenCanvasSupported=N,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=R||new WeakMap,this._canceled=!1,this._capability=new s.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:E.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:h(0,N)};const{pageWidth:B,pageHeight:D,pageX:Y,pageY:se}=E.rawDims;this._transform=[1,0,0,-1,-Y,se+D],this._pageWidth=B,this._pageHeight=D,(0,o.setLayerDimensions)(w,E),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new s.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new s.AbortException("TextLayer task cancelled."))}_processItems(T,w){for(const E of T){if(E.str===void 0){if(E.type==="beginMarkedContentProps"||E.type==="beginMarkedContent"){const P=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),E.id!==null&&this._container.setAttribute("id",`${E.id}`),P.append(this._container)}else E.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(E.str),i(this,E,w)}}_layoutText(T){const w=this._layoutTextParams.properties=this._textDivProperties.get(T);if(this._layoutTextParams.div=T,r(this._layoutTextParams),w.hasText&&this._container.append(T),w.hasEOL){const E=document.createElement("br");E.setAttribute("role","presentation"),this._container.append(E)}}_render(){const T=new s.PromiseCapability;let w=Object.create(null);if(this._isReadableStream){const E=()=>{this._reader.read().then(({value:P,done:R})=>{if(R){T.resolve();return}Object.assign(w,P.styles),this._processItems(P.items,w),E()},T.reject)};this._reader=this._textContentSource.getReader(),E()}else if(this._textContentSource){const{items:E,styles:P}=this._textContentSource;this._processItems(E,P),T.resolve()}else throw new Error('No "textContentSource" parameter specified.');T.promise.then(()=>{w=null,d(this)},this._capability.reject)}}function _(v){const T=new p(v);return T._render(),T}function y({container:v,viewport:T,textDivs:w,textDivProperties:E,isOffscreenCanvasSupported:P,mustRotate:R=!0,mustRescale:I=!0}){if(R&&(0,o.setLayerDimensions)(v,{rotation:T.rotation}),I){const N=h(0,P),D={prevFontSize:null,prevFontFamily:null,div:null,scale:T.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:N};for(const Y of w)D.properties=E.get(Y),D.div=Y,r(D)}}}),92:((n,e,t)=>{t.d(e,{PDFDataTransportStream:()=>u});var s=t(266),o=t(473);class u{constructor({length:h,initialData:f,progressiveDone:i=!1,contentDispositionFilename:r=null,disableRange:d=!1,disableStream:p=!1},_){if((0,s.assert)(_,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=i,this._contentDispositionFilename=r,f?.length>0){const y=f instanceof Uint8Array&&f.byteLength===f.buffer.byteLength?f.buffer:new Uint8Array(f).buffer;this._queuedChunks.push(y)}this._pdfDataRangeTransport=_,this._isStreamingSupported=!p,this._isRangeSupported=!d,this._contentLength=h,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((y,v)=>{this._onReceiveData({begin:y,chunk:v})}),this._pdfDataRangeTransport.addProgressListener((y,v)=>{this._onProgress({loaded:y,total:v})}),this._pdfDataRangeTransport.addProgressiveReadListener(y=>{this._onReceiveData({chunk:y})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:h,chunk:f}){const i=f instanceof Uint8Array&&f.byteLength===f.buffer.byteLength?f.buffer:new Uint8Array(f).buffer;if(h===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const r=this._rangeReaders.some(function(d){return d._begin!==h?!1:(d._enqueue(i),!0)});(0,s.assert)(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(h){h.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:h.loaded}):this._fullRequestReader?.onProgress?.({loaded:h.loaded,total:h.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(h){const f=this._rangeReaders.indexOf(h);f>=0&&this._rangeReaders.splice(f,1)}getFullReader(){(0,s.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const h=this._queuedChunks;return this._queuedChunks=null,new l(this,h,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(h,f){if(f<=this._progressiveDataLength)return null;const i=new m(this,h,f);return this._pdfDataRangeTransport.requestDataRange(h,f),this._rangeReaders.push(i),i}cancelAllRequests(h){this._fullRequestReader?.cancel(h);for(const f of this._rangeReaders.slice(0))f.cancel(h);this._pdfDataRangeTransport.abort()}}class l{constructor(h,f,i=!1,r=null){this._stream=h,this._done=i||!1,this._filename=(0,o.isPdfFile)(r)?r:null,this._queuedChunks=f||[],this._loaded=0;for(const d of this._queuedChunks)this._loaded+=d.byteLength;this._requests=[],this._headersReady=Promise.resolve(),h._fullRequestReader=this,this.onProgress=null}_enqueue(h){this._done||(this._requests.length>0?this._requests.shift().resolve({value:h,done:!1}):this._queuedChunks.push(h),this._loaded+=h.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const h=new s.PromiseCapability;return this._requests.push(h),h.promise}cancel(h){this._done=!0;for(const f of this._requests)f.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class m{constructor(h,f,i){this._stream=h,this._begin=f,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(h){if(!this._done){if(this._requests.length===0)this._queuedChunk=h;else{this._requests.shift().resolve({value:h,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const f=this._queuedChunk;return this._queuedChunk=null,{value:f,done:!1}}if(this._done)return{value:void 0,done:!0};const h=new s.PromiseCapability;return this._requests.push(h),h.promise}cancel(h){this._done=!0;for(const f of this._requests)f.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}}),368:((n,e,t)=>{t.d(e,{GlobalWorkerOptions:()=>s});const s=Object.create(null);s.workerPort=null,s.workerSrc=""}),160:((n,e,t)=>{t.d(e,{XfaLayer:()=>o});var s=t(521);class o{static setupStorage(l,m,g,h,f){const i=h.getValue(m,{value:null});switch(g.name){case"textarea":if(i.value!==null&&(l.textContent=i.value),f==="print")break;l.addEventListener("input",r=>{h.setValue(m,{value:r.target.value})});break;case"input":if(g.attributes.type==="radio"||g.attributes.type==="checkbox"){if(i.value===g.attributes.xfaOn?l.setAttribute("checked",!0):i.value===g.attributes.xfaOff&&l.removeAttribute("checked"),f==="print")break;l.addEventListener("change",r=>{h.setValue(m,{value:r.target.checked?r.target.getAttribute("xfaOn"):r.target.getAttribute("xfaOff")})})}else{if(i.value!==null&&l.setAttribute("value",i.value),f==="print")break;l.addEventListener("input",r=>{h.setValue(m,{value:r.target.value})})}break;case"select":if(i.value!==null){l.setAttribute("value",i.value);for(const r of g.children)r.attributes.value===i.value?r.attributes.selected=!0:r.attributes.hasOwnProperty("selected")&&delete r.attributes.selected}l.addEventListener("input",r=>{const d=r.target.options,p=d.selectedIndex===-1?"":d[d.selectedIndex].value;h.setValue(m,{value:p})});break}}static setAttributes({html:l,element:m,storage:g=null,intent:h,linkService:f}){const{attributes:i}=m,r=l instanceof HTMLAnchorElement;i.type==="radio"&&(i.name=`${i.name}-${h}`);for(const[d,p]of Object.entries(i))if(p!=null)switch(d){case"class":p.length&&l.setAttribute(d,p.join(" "));break;case"dataId":break;case"id":l.setAttribute("data-element-id",p);break;case"style":Object.assign(l.style,p);break;case"textContent":l.textContent=p;break;default:(!r||d!=="href"&&d!=="newWindow")&&l.setAttribute(d,p)}r&&f.addLinkAttributes(l,i.href,i.newWindow),g&&i.dataId&&this.setupStorage(l,i.dataId,m,g)}static render(l){const m=l.annotationStorage,g=l.linkService,h=l.xfaHtml,f=l.intent||"display",i=document.createElement(h.name);h.attributes&&this.setAttributes({html:i,element:h,intent:f,linkService:g});const r=f!=="richText",d=l.div;if(d.append(i),l.viewport){const y=`matrix(${l.viewport.transform.join(",")})`;d.style.transform=y}r&&d.setAttribute("class","xfaLayer xfaFont");const p=[];if(h.children.length===0){if(h.value){const y=document.createTextNode(h.value);i.append(y),r&&s.XfaText.shouldBuildText(h.name)&&p.push(y)}return{textDivs:p}}const _=[[h,-1,i]];for(;_.length>0;){const[y,v,T]=_.at(-1);if(v+1===y.children.length){_.pop();continue}const w=y.children[++_.at(-1)[1]];if(w===null)continue;const{name:E}=w;if(E==="#text"){const R=document.createTextNode(w.value);p.push(R),T.append(R);continue}const P=w?.attributes?.xmlns?document.createElementNS(w.attributes.xmlns,E):document.createElement(E);if(T.append(P),w.attributes&&this.setAttributes({html:P,element:w,storage:m,intent:f,linkService:g}),w.children?.length>0)_.push([w,-1,P]);else if(w.value){const R=document.createTextNode(w.value);r&&s.XfaText.shouldBuildText(E)&&p.push(R),P.append(R)}}for(const y of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))y.setAttribute("readOnly",!0);return{textDivs:p}}static update(l){const m=`matrix(${l.viewport.transform.join(",")})`;l.div.style.transform=m,l.div.hidden=!1}}}),521:((n,e,t)=>{t.d(e,{XfaText:()=>s});class s{static textContent(u){const l=[],m={items:l,styles:Object.create(null)};function g(h){if(!h)return;let f=null;const i=h.name;if(i==="#text")f=h.value;else if(s.shouldBuildText(i))h?.attributes?.textContent?f=h.attributes.textContent:h.value&&(f=h.value);else return;if(f!==null&&l.push({str:f}),!!h.children)for(const r of h.children)g(r)}return g(u),m}static shouldBuildText(u){return!(u==="textarea"||u==="input"||u==="option"||u==="select")}}}),907:((n,e,t)=>{t.a(n,async(s,o)=>{try{t.d(e,{AbortException:()=>u.AbortException,AnnotationEditorLayer:()=>h.AnnotationEditorLayer,AnnotationEditorParamsType:()=>u.AnnotationEditorParamsType,AnnotationEditorType:()=>u.AnnotationEditorType,AnnotationEditorUIManager:()=>f.AnnotationEditorUIManager,AnnotationLayer:()=>i.AnnotationLayer,AnnotationMode:()=>u.AnnotationMode,CMapCompressionType:()=>u.CMapCompressionType,ColorPicker:()=>r.ColorPicker,DOMSVGFactory:()=>m.DOMSVGFactory,DrawLayer:()=>d.DrawLayer,FeatureTest:()=>u.FeatureTest,GlobalWorkerOptions:()=>p.GlobalWorkerOptions,ImageKind:()=>u.ImageKind,InvalidPDFException:()=>u.InvalidPDFException,MissingPDFException:()=>u.MissingPDFException,OPS:()=>u.OPS,Outliner:()=>_.Outliner,PDFDataRangeTransport:()=>l.PDFDataRangeTransport,PDFDateString:()=>m.PDFDateString,PDFWorker:()=>l.PDFWorker,PasswordResponses:()=>u.PasswordResponses,PermissionFlag:()=>u.PermissionFlag,PixelsPerInch:()=>m.PixelsPerInch,PromiseCapability:()=>u.PromiseCapability,RenderingCancelledException:()=>m.RenderingCancelledException,UnexpectedResponseException:()=>u.UnexpectedResponseException,Util:()=>u.Util,VerbosityLevel:()=>u.VerbosityLevel,XfaLayer:()=>y.XfaLayer,build:()=>l.build,createValidAbsoluteUrl:()=>u.createValidAbsoluteUrl,fetchData:()=>m.fetchData,getDocument:()=>l.getDocument,getFilenameFromUrl:()=>m.getFilenameFromUrl,getPdfFilenameFromUrl:()=>m.getPdfFilenameFromUrl,getXfaPageViewport:()=>m.getXfaPageViewport,isDataScheme:()=>m.isDataScheme,isPdfFile:()=>m.isPdfFile,noContextMenu:()=>m.noContextMenu,normalizeUnicode:()=>u.normalizeUnicode,renderTextLayer:()=>g.renderTextLayer,setLayerDimensions:()=>m.setLayerDimensions,shadow:()=>u.shadow,updateTextLayer:()=>g.updateTextLayer,version:()=>l.version});var u=t(266),l=t(406),m=t(473),g=t(739),h=t(629),f=t(812),i=t(640),r=t(97),d=t(423),p=t(368),_=t(405),y=t(160),v=s([l]);l=(v.then?(await v)():v)[0];const T="4.0.379",w="9e14d04fd";o()}catch(T){o(T)}})}),694:((n,e,t)=>{t.d(e,{MessageHandler:()=>m});var s=t(266);const o={DATA:1,ERROR:2},u={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function l(g){switch(g instanceof Error||typeof g=="object"&&g!==null||(0,s.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),g.name){case"AbortException":return new s.AbortException(g.message);case"MissingPDFException":return new s.MissingPDFException(g.message);case"PasswordException":return new s.PasswordException(g.message,g.code);case"UnexpectedResponseException":return new s.UnexpectedResponseException(g.message,g.status);case"UnknownErrorException":return new s.UnknownErrorException(g.message,g.details);default:return new s.UnknownErrorException(g.message,g.toString())}}class m{constructor(h,f,i){this.sourceName=h,this.targetName=f,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=r=>{const d=r.data;if(d.targetName!==this.sourceName)return;if(d.stream){this.#t(d);return}if(d.callback){const _=d.callbackId,y=this.callbackCapabilities[_];if(!y)throw new Error(`Cannot resolve callback ${_}`);if(delete this.callbackCapabilities[_],d.callback===o.DATA)y.resolve(d.data);else if(d.callback===o.ERROR)y.reject(l(d.reason));else throw new Error("Unexpected callback case");return}const p=this.actionHandler[d.action];if(!p)throw new Error(`Unknown action from worker: ${d.action}`);if(d.callbackId){const _=this.sourceName,y=d.sourceName;new Promise(function(v){v(p(d.data))}).then(function(v){i.postMessage({sourceName:_,targetName:y,callback:o.DATA,callbackId:d.callbackId,data:v})},function(v){i.postMessage({sourceName:_,targetName:y,callback:o.ERROR,callbackId:d.callbackId,reason:l(v)})});return}if(d.streamId){this.#e(d);return}p(d.data)},i.addEventListener("message",this._onComObjOnMessage)}on(h,f){const i=this.actionHandler;if(i[h])throw new Error(`There is already an actionName called "${h}"`);i[h]=f}send(h,f,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:h,data:f},i)}sendWithPromise(h,f,i){const r=this.callbackId++,d=new s.PromiseCapability;this.callbackCapabilities[r]=d;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:h,callbackId:r,data:f},i)}catch(p){d.reject(p)}return d.promise}sendWithStream(h,f,i,r){const d=this.streamId++,p=this.sourceName,_=this.targetName,y=this.comObj;return new ReadableStream({start:v=>{const T=new s.PromiseCapability;return this.streamControllers[d]={controller:v,startCall:T,pullCall:null,cancelCall:null,isClosed:!1},y.postMessage({sourceName:p,targetName:_,action:h,streamId:d,data:f,desiredSize:v.desiredSize},r),T.promise},pull:v=>{const T=new s.PromiseCapability;return this.streamControllers[d].pullCall=T,y.postMessage({sourceName:p,targetName:_,stream:u.PULL,streamId:d,desiredSize:v.desiredSize}),T.promise},cancel:v=>{(0,s.assert)(v instanceof Error,"cancel must have a valid reason");const T=new s.PromiseCapability;return this.streamControllers[d].cancelCall=T,this.streamControllers[d].isClosed=!0,y.postMessage({sourceName:p,targetName:_,stream:u.CANCEL,streamId:d,reason:l(v)}),T.promise}},i)}#e(h){const f=h.streamId,i=this.sourceName,r=h.sourceName,d=this.comObj,p=this,_=this.actionHandler[h.action],y={enqueue(v,T=1,w){if(this.isCancelled)return;const E=this.desiredSize;this.desiredSize-=T,E>0&&this.desiredSize<=0&&(this.sinkCapability=new s.PromiseCapability,this.ready=this.sinkCapability.promise),d.postMessage({sourceName:i,targetName:r,stream:u.ENQUEUE,streamId:f,chunk:v},w)},close(){this.isCancelled||(this.isCancelled=!0,d.postMessage({sourceName:i,targetName:r,stream:u.CLOSE,streamId:f}),delete p.streamSinks[f])},error(v){(0,s.assert)(v instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,d.postMessage({sourceName:i,targetName:r,stream:u.ERROR,streamId:f,reason:l(v)}))},sinkCapability:new s.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:h.desiredSize,ready:null};y.sinkCapability.resolve(),y.ready=y.sinkCapability.promise,this.streamSinks[f]=y,new Promise(function(v){v(_(h.data,y))}).then(function(){d.postMessage({sourceName:i,targetName:r,stream:u.START_COMPLETE,streamId:f,success:!0})},function(v){d.postMessage({sourceName:i,targetName:r,stream:u.START_COMPLETE,streamId:f,reason:l(v)})})}#t(h){const f=h.streamId,i=this.sourceName,r=h.sourceName,d=this.comObj,p=this.streamControllers[f],_=this.streamSinks[f];switch(h.stream){case u.START_COMPLETE:h.success?p.startCall.resolve():p.startCall.reject(l(h.reason));break;case u.PULL_COMPLETE:h.success?p.pullCall.resolve():p.pullCall.reject(l(h.reason));break;case u.PULL:if(!_){d.postMessage({sourceName:i,targetName:r,stream:u.PULL_COMPLETE,streamId:f,success:!0});break}_.desiredSize<=0&&h.desiredSize>0&&_.sinkCapability.resolve(),_.desiredSize=h.desiredSize,new Promise(function(y){y(_.onPull?.())}).then(function(){d.postMessage({sourceName:i,targetName:r,stream:u.PULL_COMPLETE,streamId:f,success:!0})},function(y){d.postMessage({sourceName:i,targetName:r,stream:u.PULL_COMPLETE,streamId:f,reason:l(y)})});break;case u.ENQUEUE:if((0,s.assert)(p,"enqueue should have stream controller"),p.isClosed)break;p.controller.enqueue(h.chunk);break;case u.CLOSE:if((0,s.assert)(p,"close should have stream controller"),p.isClosed)break;p.isClosed=!0,p.controller.close(),this.#n(p,f);break;case u.ERROR:(0,s.assert)(p,"error should have stream controller"),p.controller.error(l(h.reason)),this.#n(p,f);break;case u.CANCEL_COMPLETE:h.success?p.cancelCall.resolve():p.cancelCall.reject(l(h.reason)),this.#n(p,f);break;case u.CANCEL:if(!_)break;new Promise(function(y){y(_.onCancel?.(l(h.reason)))}).then(function(){d.postMessage({sourceName:i,targetName:r,stream:u.CANCEL_COMPLETE,streamId:f,success:!0})},function(y){d.postMessage({sourceName:i,targetName:r,stream:u.CANCEL_COMPLETE,streamId:f,reason:l(y)})}),_.sinkCapability.reject(l(h.reason)),_.isCancelled=!0,delete this.streamSinks[f];break;default:throw new Error("Unexpected stream case")}}async#n(h,f){await Promise.allSettled([h.startCall?.promise,h.pullCall?.promise,h.cancelCall?.promise]),delete this.streamControllers[f]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}}),825:((n,e,t)=>{t.d(e,{MurmurHash3_64:()=>m});var s=t(266);const o=3285377520,u=4294901760,l=65535;class m{constructor(h){this.h1=h?h&4294967295:o,this.h2=h?h&4294967295:o}update(h){let f,i;if(typeof h=="string"){f=new Uint8Array(h.length*2),i=0;for(let I=0,N=h.length;I<N;I++){const B=h.charCodeAt(I);B<=255?f[i++]=B:(f[i++]=B>>>8,f[i++]=B&255)}}else if((0,s.isArrayBuffer)(h))f=h.slice(),i=f.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const r=i>>2,d=i-r*4,p=new Uint32Array(f.buffer,0,r);let _=0,y=0,v=this.h1,T=this.h2;const w=3432918353,E=461845907,P=w&l,R=E&l;for(let I=0;I<r;I++)I&1?(_=p[I],_=_*w&u|_*P&l,_=_<<15|_>>>17,_=_*E&u|_*R&l,v^=_,v=v<<13|v>>>19,v=v*5+3864292196):(y=p[I],y=y*w&u|y*P&l,y=y<<15|y>>>17,y=y*E&u|y*R&l,T^=y,T=T<<13|T>>>19,T=T*5+3864292196);switch(_=0,d){case 3:_^=f[r*4+2]<<16;case 2:_^=f[r*4+1]<<8;case 1:_^=f[r*4],_=_*w&u|_*P&l,_=_<<15|_>>>17,_=_*E&u|_*R&l,r&1?v^=_:T^=_}this.h1=v,this.h2=T}hexdigest(){let h=this.h1,f=this.h2;return h^=f>>>1,h=h*3981806797&u|h*36045&l,f=f*4283543511&u|((f<<16|h>>>16)*2950163797&u)>>>16,h^=f>>>1,h=h*444984403&u|h*60499&l,f=f*3301882366&u|((f<<16|h>>>16)*3120437893&u)>>>16,h^=f>>>1,(h>>>0).toString(16).padStart(8,"0")+(f>>>0).toString(16).padStart(8,"0")}}}),266:((n,e,t)=>{t.d(e,{AbortException:()=>be,AnnotationBorderStyleType:()=>v,AnnotationEditorParamsType:()=>r,AnnotationEditorPrefix:()=>f,AnnotationEditorType:()=>i,AnnotationMode:()=>h,AnnotationPrefix:()=>ye,AnnotationType:()=>y,BaseException:()=>k,CMapCompressionType:()=>w,FONT_IDENTITY_MATRIX:()=>u,FeatureTest:()=>C,FormatError:()=>le,IDENTITY_MATRIX:()=>o,ImageKind:()=>_,InvalidPDFException:()=>ee,LINE_FACTOR:()=>m,MAX_IMAGE_SIZE_TO_CACHE:()=>l,MissingPDFException:()=>ce,OPS:()=>E,PasswordException:()=>H,PasswordResponses:()=>P,PermissionFlag:()=>d,PromiseCapability:()=>J,RenderingIntentFlag:()=>g,TextRenderingMode:()=>p,UnexpectedResponseException:()=>q,UnknownErrorException:()=>de,Util:()=>O,VerbosityLevel:()=>T,assert:()=>se,bytesToString:()=>xe,createValidAbsoluteUrl:()=>W,getUuid:()=>fe,getVerbosityLevel:()=>N,info:()=>B,isArrayBuffer:()=>j,isNodeJS:()=>s,normalizeUnicode:()=>ie,objectFromMap:()=>U,setVerbosityLevel:()=>I,shadow:()=>$,string32:()=>we,stringToBytes:()=>Ee,unreachable:()=>Y,warn:()=>D});const s=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),o=[1,0,0,1,0,0],u=[.001,0,0,.001,0,0],l=1e7,m=1.35,g={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},h={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},f="pdfjs_internal_editor_",i={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},r={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32},d={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},p={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},_={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},y={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},v={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},T={ERRORS:0,WARNINGS:1,INFOS:5},w={NONE:0,BINARY:1},E={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},P={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let R=T.WARNINGS;function I(pe){Number.isInteger(pe)&&(R=pe)}function N(){return R}function B(pe){R>=T.INFOS&&console.log(`Info: ${pe}`)}function D(pe){R>=T.WARNINGS&&console.log(`Warning: ${pe}`)}function Y(pe){throw new Error(pe)}function se(pe,te){pe||Y(te)}function re(pe){switch(pe?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function W(pe,te=null,ue=null){if(!pe)return null;try{if(ue&&typeof pe=="string"&&(ue.addDefaultProtocol&&pe.startsWith("www.")&&pe.match(/\./g)?.length>=2&&(pe=`http://${pe}`),ue.tryConvertEncoding))try{pe=z(pe)}catch{}const Ie=te?new URL(pe,te):new URL(pe);if(re(Ie))return Ie}catch{}return null}function $(pe,te,ue,Ie=!1){return Object.defineProperty(pe,te,{value:ue,enumerable:!Ie,configurable:!0,writable:!1}),ue}const k=(function(){function te(ue,Ie){this.constructor===te&&Y("Cannot initialize BaseException."),this.message=ue,this.name=Ie}return te.prototype=new Error,te.constructor=te,te})();class H extends k{constructor(te,ue){super(te,"PasswordException"),this.code=ue}}class de extends k{constructor(te,ue){super(te,"UnknownErrorException"),this.details=ue}}class ee extends k{constructor(te){super(te,"InvalidPDFException")}}class ce extends k{constructor(te){super(te,"MissingPDFException")}}class q extends k{constructor(te,ue){super(te,"UnexpectedResponseException"),this.status=ue}}class le extends k{constructor(te){super(te,"FormatError")}}class be extends k{constructor(te){super(te,"AbortException")}}function xe(pe){(typeof pe!="object"||pe?.length===void 0)&&Y("Invalid argument for bytesToString");const te=pe.length,ue=8192;if(te<ue)return String.fromCharCode.apply(null,pe);const Ie=[];for(let ae=0;ae<te;ae+=ue){const De=Math.min(ae+ue,te),ze=pe.subarray(ae,De);Ie.push(String.fromCharCode.apply(null,ze))}return Ie.join("")}function Ee(pe){typeof pe!="string"&&Y("Invalid argument for stringToBytes");const te=pe.length,ue=new Uint8Array(te);for(let Ie=0;Ie<te;++Ie)ue[Ie]=pe.charCodeAt(Ie)&255;return ue}function we(pe){return String.fromCharCode(pe>>24&255,pe>>16&255,pe>>8&255,pe&255)}function U(pe){const te=Object.create(null);for(const[ue,Ie]of pe)te[ue]=Ie;return te}function L(){const pe=new Uint8Array(4);return pe[0]=1,new Uint32Array(pe.buffer,0,1)[0]===1}function M(){try{return new Function(""),!0}catch{return!1}}class C{static get isLittleEndian(){return $(this,"isLittleEndian",L())}static get isEvalSupported(){return $(this,"isEvalSupported",M())}static get isOffscreenCanvasSupported(){return $(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?$(this,"platform",{isMac:navigator.platform.includes("Mac")}):$(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return $(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const V=[...Array(256).keys()].map(pe=>pe.toString(16).padStart(2,"0"));class O{static makeHexColor(te,ue,Ie){return`#${V[te]}${V[ue]}${V[Ie]}`}static scaleMinMax(te,ue){let Ie;te[0]?(te[0]<0&&(Ie=ue[0],ue[0]=ue[1],ue[1]=Ie),ue[0]*=te[0],ue[1]*=te[0],te[3]<0&&(Ie=ue[2],ue[2]=ue[3],ue[3]=Ie),ue[2]*=te[3],ue[3]*=te[3]):(Ie=ue[0],ue[0]=ue[2],ue[2]=Ie,Ie=ue[1],ue[1]=ue[3],ue[3]=Ie,te[1]<0&&(Ie=ue[2],ue[2]=ue[3],ue[3]=Ie),ue[2]*=te[1],ue[3]*=te[1],te[2]<0&&(Ie=ue[0],ue[0]=ue[1],ue[1]=Ie),ue[0]*=te[2],ue[1]*=te[2]),ue[0]+=te[4],ue[1]+=te[4],ue[2]+=te[5],ue[3]+=te[5]}static transform(te,ue){return[te[0]*ue[0]+te[2]*ue[1],te[1]*ue[0]+te[3]*ue[1],te[0]*ue[2]+te[2]*ue[3],te[1]*ue[2]+te[3]*ue[3],te[0]*ue[4]+te[2]*ue[5]+te[4],te[1]*ue[4]+te[3]*ue[5]+te[5]]}static applyTransform(te,ue){const Ie=te[0]*ue[0]+te[1]*ue[2]+ue[4],ae=te[0]*ue[1]+te[1]*ue[3]+ue[5];return[Ie,ae]}static applyInverseTransform(te,ue){const Ie=ue[0]*ue[3]-ue[1]*ue[2],ae=(te[0]*ue[3]-te[1]*ue[2]+ue[2]*ue[5]-ue[4]*ue[3])/Ie,De=(-te[0]*ue[1]+te[1]*ue[0]+ue[4]*ue[1]-ue[5]*ue[0])/Ie;return[ae,De]}static getAxialAlignedBoundingBox(te,ue){const Ie=this.applyTransform(te,ue),ae=this.applyTransform(te.slice(2,4),ue),De=this.applyTransform([te[0],te[3]],ue),ze=this.applyTransform([te[2],te[1]],ue);return[Math.min(Ie[0],ae[0],De[0],ze[0]),Math.min(Ie[1],ae[1],De[1],ze[1]),Math.max(Ie[0],ae[0],De[0],ze[0]),Math.max(Ie[1],ae[1],De[1],ze[1])]}static inverseTransform(te){const ue=te[0]*te[3]-te[1]*te[2];return[te[3]/ue,-te[1]/ue,-te[2]/ue,te[0]/ue,(te[2]*te[5]-te[4]*te[3])/ue,(te[4]*te[1]-te[5]*te[0])/ue]}static singularValueDecompose2dScale(te){const ue=[te[0],te[2],te[1],te[3]],Ie=te[0]*ue[0]+te[1]*ue[2],ae=te[0]*ue[1]+te[1]*ue[3],De=te[2]*ue[0]+te[3]*ue[2],ze=te[2]*ue[1]+te[3]*ue[3],Ge=(Ie+ze)/2,He=Math.sqrt((Ie+ze)**2-4*(Ie*ze-De*ae))/2,Ye=Ge+He||1,Xe=Ge-He||1;return[Math.sqrt(Ye),Math.sqrt(Xe)]}static normalizeRect(te){const ue=te.slice(0);return te[0]>te[2]&&(ue[0]=te[2],ue[2]=te[0]),te[1]>te[3]&&(ue[1]=te[3],ue[3]=te[1]),ue}static intersect(te,ue){const Ie=Math.max(Math.min(te[0],te[2]),Math.min(ue[0],ue[2])),ae=Math.min(Math.max(te[0],te[2]),Math.max(ue[0],ue[2]));if(Ie>ae)return null;const De=Math.max(Math.min(te[1],te[3]),Math.min(ue[1],ue[3])),ze=Math.min(Math.max(te[1],te[3]),Math.max(ue[1],ue[3]));return De>ze?null:[Ie,De,ae,ze]}static bezierBoundingBox(te,ue,Ie,ae,De,ze,Ge,He){const Ye=[],Xe=[[],[]];let it,ut,qe,Je,Pt,zt,Gt,nt;for(let et=0;et<2;++et){if(et===0?(ut=6*te-12*Ie+6*De,it=-3*te+9*Ie-9*De+3*Ge,qe=3*Ie-3*te):(ut=6*ue-12*ae+6*ze,it=-3*ue+9*ae-9*ze+3*He,qe=3*ae-3*ue),Math.abs(it)<1e-12){if(Math.abs(ut)<1e-12)continue;Je=-qe/ut,0<Je&&Je<1&&Ye.push(Je);continue}Gt=ut*ut-4*qe*it,nt=Math.sqrt(Gt),!(Gt<0)&&(Pt=(-ut+nt)/(2*it),0<Pt&&Pt<1&&Ye.push(Pt),zt=(-ut-nt)/(2*it),0<zt&&zt<1&&Ye.push(zt))}let At=Ye.length,Mt;const $t=At;for(;At--;)Je=Ye[At],Mt=1-Je,Xe[0][At]=Mt*Mt*Mt*te+3*Mt*Mt*Je*Ie+3*Mt*Je*Je*De+Je*Je*Je*Ge,Xe[1][At]=Mt*Mt*Mt*ue+3*Mt*Mt*Je*ae+3*Mt*Je*Je*ze+Je*Je*Je*He;return Xe[0][$t]=te,Xe[1][$t]=ue,Xe[0][$t+1]=Ge,Xe[1][$t+1]=He,Xe[0].length=Xe[1].length=$t+2,[Math.min(...Xe[0]),Math.min(...Xe[1]),Math.max(...Xe[0]),Math.max(...Xe[1])]}}function z(pe){return decodeURIComponent(escape(pe))}function j(pe){return typeof pe=="object"&&pe?.byteLength!==void 0}class J{#e=!1;constructor(){this.promise=new Promise((te,ue)=>{this.resolve=Ie=>{this.#e=!0,te(Ie)},this.reject=Ie=>{this.#e=!0,ue(Ie)}})}get settled(){return this.#e}}let X=null,ne=null;function ie(pe){return X||(X=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,ne=new Map([["","t"]])),pe.replaceAll(X,(te,ue,Ie)=>ue?ue.normalize("NFKC"):ne.get(Ie))}function fe(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const pe=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(pe);else for(let te=0;te<32;te++)pe[te]=Math.floor(Math.random()*255);return xe(pe)}const ye="pdfjs_internal_id_"})},__webpack_module_cache__={};function __webpack_require__(n){var e=__webpack_module_cache__[n];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[n]={exports:{}};return __webpack_modules__[n](t,t.exports,__webpack_require__),t.exports}(()=>{var n=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",e=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",s=u=>{u&&u.d<1&&(u.d=1,u.forEach(l=>l.r--),u.forEach(l=>l.r--?l.r++:l()))},o=u=>u.map(l=>{if(l!==null&&typeof l=="object"){if(l[n])return l;if(l.then){var m=[];m.d=0,l.then(f=>{g[e]=f,s(m)},f=>{g[t]=f,s(m)});var g={};return g[n]=f=>f(m),g}}var h={};return h[n]=f=>{},h[e]=l,h});__webpack_require__.a=(u,l,m)=>{var g;m&&((g=[]).d=-1);var h=new Set,f=u.exports,i,r,d,p=new Promise((_,y)=>{d=y,r=_});p[e]=f,p[n]=_=>(g&&_(g),h.forEach(_),p.catch(y=>{})),u.exports=p,l(_=>{i=o(_);var y,v=()=>i.map(w=>{if(w[t])throw w[t];return w[e]}),T=new Promise(w=>{y=()=>w(v),y.r=0;var E=P=>P!==g&&!h.has(P)&&(h.add(P),P&&!P.d&&(y.r++,P.push(y)));i.map(P=>P[n](E))});return y.r?T:v()},_=>(_?d(p[t]=_):r(f),s(g))),g&&g.d<0&&(g.d=0)}})();__webpack_require__.d=(n,e)=>{for(var t in e)__webpack_require__.o(e,t)&&!__webpack_require__.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};__webpack_require__.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var __webpack_exports__=__webpack_require__(907);__webpack_exports__=globalThis.pdfjsLib=await(globalThis.pdfjsLibPromise=__webpack_exports__);__webpack_exports__.AbortException;__webpack_exports__.AnnotationEditorLayer;__webpack_exports__.AnnotationEditorParamsType;__webpack_exports__.AnnotationEditorType;__webpack_exports__.AnnotationEditorUIManager;__webpack_exports__.AnnotationLayer;__webpack_exports__.AnnotationMode;__webpack_exports__.CMapCompressionType;__webpack_exports__.ColorPicker;__webpack_exports__.DOMSVGFactory;__webpack_exports__.DrawLayer;__webpack_exports__.FeatureTest;var __webpack_exports__GlobalWorkerOptions=__webpack_exports__.GlobalWorkerOptions;__webpack_exports__.ImageKind;__webpack_exports__.InvalidPDFException;__webpack_exports__.MissingPDFException;__webpack_exports__.OPS;__webpack_exports__.Outliner;__webpack_exports__.PDFDataRangeTransport;__webpack_exports__.PDFDateString;__webpack_exports__.PDFWorker;__webpack_exports__.PasswordResponses;__webpack_exports__.PermissionFlag;__webpack_exports__.PixelsPerInch;__webpack_exports__.PromiseCapability;__webpack_exports__.RenderingCancelledException;__webpack_exports__.UnexpectedResponseException;__webpack_exports__.Util;__webpack_exports__.VerbosityLevel;__webpack_exports__.XfaLayer;__webpack_exports__.build;__webpack_exports__.createValidAbsoluteUrl;__webpack_exports__.fetchData;var __webpack_exports__getDocument=__webpack_exports__.getDocument;__webpack_exports__.getFilenameFromUrl;__webpack_exports__.getPdfFilenameFromUrl;__webpack_exports__.getXfaPageViewport;__webpack_exports__.isDataScheme;__webpack_exports__.isPdfFile;__webpack_exports__.noContextMenu;__webpack_exports__.normalizeUnicode;__webpack_exports__.renderTextLayer;__webpack_exports__.setLayerDimensions;__webpack_exports__.shadow;__webpack_exports__.updateTextLayer;__webpack_exports__.version;function dispatchCallback(n,e){n&&n(e)}function reverseDictionary(n){return Object.fromEntries(Object.entries(n).map(([e,t])=>[t,e]))}function escapeRegExp(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const Callable=class{constructor(){let n=function(...e){return n._call(...e)};return Object.setPrototypeOf(n,new.target.prototype)}_call(...n){throw Error("Must implement _call method in subclass")}};function isTypedArray(n){return n?.prototype?.__proto__?.constructor?.name==="TypedArray"}function isIntegralNumber(n){return Number.isInteger(n)||typeof n=="bigint"}function exists(n){return n!=null}function calculateDimensions(n){const e=[];let t=n;for(;Array.isArray(t);)e.push(t.length),t=t[0];return e}function pop(n,e,t=void 0){const s=n[e];if(s!==void 0)return delete n[e],s;if(t===void 0)throw Error(`Key ${e} does not exist in object.`);return t}function mergeArrays(...n){return Array.prototype.concat.apply([],n)}function product(...n){return n.reduce((e,t)=>e.flatMap(s=>t.map(o=>[s,o])))}function calculateReflectOffset(n,e){return Math.abs((n+e)%(2*e)-e)}var ortWeb_min$1={exports:{}};const backends={},backendsSortedByPriority=[],registerBackend=(n,e,t)=>{if(e&&typeof e.init=="function"&&typeof e.createSessionHandler=="function"){const s=backends[n];if(s===void 0)backends[n]={backend:e,priority:t};else{if(s.priority>t)return;if(s.priority===t&&s.backend!==e)throw new Error(`cannot register backend "${n}" using priority ${t}`)}if(t>=0){const o=backendsSortedByPriority.indexOf(n);o!==-1&&backendsSortedByPriority.splice(o,1);for(let u=0;u<backendsSortedByPriority.length;u++)if(backends[backendsSortedByPriority[u]].priority<=t){backendsSortedByPriority.splice(u,0,n);return}backendsSortedByPriority.push(n)}return}throw new TypeError("not a valid backend")},resolveBackend=async n=>{const e=n.length===0?backendsSortedByPriority:n,t=[];for(const s of e){const o=backends[s];if(o){if(o.initialized)return o.backend;if(o.aborted)continue;const u=!!o.initPromise;try{return u||(o.initPromise=o.backend.init()),await o.initPromise,o.initialized=!0,o.backend}catch(l){u||t.push({name:s,err:l}),o.aborted=!0}finally{delete o.initPromise}}}throw new Error(`no available backend found. ERR: ${t.map(s=>`[${s.name}] ${s.err}`).join(", ")}`)};class EnvImpl{constructor(){this.wasm={},this.webgl={},this.logLevelInternal="warning"}set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);this.logLevelInternal=e}}get logLevel(){return this.logLevelInternal}}const env$2=new EnvImpl,isBigInt64ArrayAvailable=typeof BigInt64Array<"u"&&typeof BigInt64Array.from=="function",isBigUint64ArrayAvailable=typeof BigUint64Array<"u"&&typeof BigUint64Array.from=="function",NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);isBigInt64ArrayAvailable&&(NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("int64",BigInt64Array),NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set(BigInt64Array,"int64"));isBigUint64ArrayAvailable&&(NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("uint64",BigUint64Array),NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set(BigUint64Array,"uint64"));const calculateSize=n=>{let e=1;for(let t=0;t<n.length;t++){const s=n[t];if(typeof s!="number"||!Number.isSafeInteger(s))throw new TypeError(`dims[${t}] must be an integer, got: ${s}`);if(s<0)throw new RangeError(`dims[${t}] must be a non-negative integer, got: ${s}`);e*=s}return e};let Tensor$2=class ys{constructor(e,t,s){let o,u,l;if(typeof e=="string")if(o=e,l=s,e==="string"){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");u=t}else{const g=NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.get(e);if(g===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t))u=g.from(t);else if(t instanceof g)u=t;else throw new TypeError(`A ${o} tensor's data must be type of ${g}`)}else if(l=t,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const g=typeof e[0];if(g==="string")o="string",u=e;else if(g==="boolean")o="bool",u=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${g}.`)}else{const g=NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.get(e.constructor);if(g===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);o=g,u=e}if(l===void 0)l=[u.length];else if(!Array.isArray(l))throw new TypeError("A tensor's dims must be a number array");const m=calculateSize(l);if(m!==u.length)throw new Error(`Tensor's size(${m}) does not match data length(${u.length}).`);this.dims=l,this.type=o,this.data=u,this.size=m}static bufferToTensor(e,t){if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");const{height:s,width:o}=t,u=t.norm;let l,m;u===void 0||u.mean===void 0?l=255:l=u.mean,u===void 0||u.bias===void 0?m=0:m=u.bias;const g=t.bitmapFormat!==void 0?t.bitmapFormat:"RGBA",h=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",f=s*o,i=h==="RGBA"?new Float32Array(f*4):new Float32Array(f*3);let r=4,d=0,p=1,_=2,y=3,v=0,T=f,w=f*2,E=-1;g==="RGB"&&(r=3,d=0,p=1,_=2,y=-1),h==="RGBA"?E=f*3:h==="RBG"?(v=0,w=f,T=f*2):h==="BGR"&&(w=0,T=f,v=f*2);for(let R=0;R<f;R++,d+=r,_+=r,p+=r,y+=r)i[v++]=(e[d]+m)/l,i[T++]=(e[p]+m)/l,i[w++]=(e[_]+m)/l,E!==-1&&y!==-1&&(i[E++]=(e[y]+m)/l);return h==="RGBA"?new ys("float32",i,[1,4,s,o]):new ys("float32",i,[1,3,s,o])}static async fromImage(e,t){const s=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,o=typeof ImageData<"u"&&e instanceof ImageData,u=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,l=typeof String<"u"&&(e instanceof String||typeof e=="string");let m,g={};if(s){const h=document.createElement("canvas"),f=h.getContext("2d");if(f!=null){let i=e.naturalHeight,r=e.naturalWidth;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(i=t.resizedHeight,r=t.resizedWidth),t!==void 0){if(g=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");if(g.tensorFormat="RGBA",t.height!==void 0&&t.height!==i)throw new Error("Image input config height doesn't match HTMLImageElement height");if(g.height=i,t.width!==void 0&&t.width!==r)throw new Error("Image input config width doesn't match HTMLImageElement width");g.width=r}else g.tensorFormat="RGBA",g.height=i,g.width=r;h.width=r,h.height=i,f.drawImage(e,0,0,r,i),m=f.getImageData(0,0,r,i).data}else throw new Error("Can not access image data")}else if(o){const h="RGBA";let f,i;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(f=t.resizedHeight,i=t.resizedWidth):(f=e.height,i=e.width),t!==void 0){if(g=t,t.bitmapFormat!==void 0&&t.bitmapFormat!==h)throw new Error("Image input config format must be RGBA for ImageData");g.bitmapFormat="RGBA"}else g.bitmapFormat="RGBA";if(g.height=f,g.width=i,t!==void 0){const r=document.createElement("canvas");r.width=i,r.height=f;const d=r.getContext("2d");if(d!=null)d.putImageData(e,0,0),m=d.getImageData(0,0,i,f).data;else throw new Error("Can not access image data")}else m=e.data}else if(u){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");if(t.bitmapFormat!==void 0)throw new Error("Image input config format must be defined for ImageBitmap");const h=document.createElement("canvas").getContext("2d");if(h!=null){const f=e.height,i=e.width;if(h.drawImage(e,0,0,i,f),m=h.getImageData(0,0,i,f).data,t!==void 0){if(t.height!==void 0&&t.height!==f)throw new Error("Image input config height doesn't match ImageBitmap height");if(g.height=f,t.width!==void 0&&t.width!==i)throw new Error("Image input config width doesn't match ImageBitmap width");g.width=i}else g.height=f,g.width=i;return ys.bufferToTensor(m,g)}else throw new Error("Can not access image data")}else{if(l)return new Promise((h,f)=>{const i=document.createElement("canvas"),r=i.getContext("2d");if(!e||!r)return f();const d=new Image;d.crossOrigin="Anonymous",d.src=e,d.onload=()=>{i.width=d.width,i.height=d.height,r.drawImage(d,0,0,i.width,i.height);const p=r.getImageData(0,0,i.width,i.height);if(t!==void 0){if(t.height!==void 0&&t.height!==i.height)throw new Error("Image input config height doesn't match ImageBitmap height");if(g.height=i.height,t.width!==void 0&&t.width!==i.width)throw new Error("Image input config width doesn't match ImageBitmap width");g.width=i.width}else g.height=i.height,g.width=i.width;h(ys.bufferToTensor(p.data,g))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(m!==void 0)return ys.bufferToTensor(m,g);throw new Error("Input data provided is not supported - aborted tensor creation")}toImageData(e){var t,s;const o=document.createElement("canvas").getContext("2d");let u;if(o!=null){const l=this.dims[3],m=this.dims[2],g=this.dims[1],h=e!==void 0&&e.format!==void 0?e.format:"RGB",f=e!==void 0&&((t=e.norm)===null||t===void 0?void 0:t.mean)!==void 0?e.norm.mean:255,i=e!==void 0&&((s=e.norm)===null||s===void 0?void 0:s.bias)!==void 0?e.norm.bias:0,r=m*l;if(e!==void 0){if(e.height!==void 0&&e.height!==m)throw new Error("Image output config height doesn't match tensor height");if(e.width!==void 0&&e.width!==l)throw new Error("Image output config width doesn't match tensor width");if(e.format!==void 0&&g===4&&e.format!=="RGBA"||g===3&&e.format!=="RGB"&&e.format!=="BGR")throw new Error("Tensor format doesn't match input tensor dims")}const d=4;let p=0,_=1,y=2,v=3,T=0,w=r,E=r*2,P=-1;h==="RGBA"?(T=0,w=r,E=r*2,P=r*3):h==="RGB"?(T=0,w=r,E=r*2):h==="RBG"&&(T=0,E=r,w=r*2),u=o.createImageData(l,m);for(let R=0;R<m*l;p+=d,_+=d,y+=d,v+=d,R++)u.data[p]=(this.data[T++]-i)*f,u.data[_]=(this.data[w++]-i)*f,u.data[y]=(this.data[E++]-i)*f,u.data[v]=P===-1?255:(this.data[P++]-i)*f}else throw new Error("Can not access image data");return u}reshape(e){return new ys(this.type,this.data,e)}};const Tensor$1=Tensor$2;let InferenceSession$2=class Eh{constructor(e){this.handler=e}async run(e,t,s){const o={};let u={};if(typeof e!="object"||e===null||e instanceof Tensor$1||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let l=!0;if(typeof t=="object"){if(t===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof Tensor$1)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(t.length===0)throw new TypeError("'fetches' cannot be an empty array.");l=!1;for(const h of t){if(typeof h!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(h)===-1)throw new RangeError(`'fetches' contains invalid output name: ${h}.`);o[h]=null}if(typeof s=="object"&&s!==null)u=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else{let h=!1;const f=Object.getOwnPropertyNames(t);for(const i of this.outputNames)if(f.indexOf(i)!==-1){const r=t[i];(r===null||r instanceof Tensor$1)&&(h=!0,l=!1,o[i]=r)}if(h){if(typeof s=="object"&&s!==null)u=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else u=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(const h of this.inputNames)if(typeof e[h]>"u")throw new Error(`input '${h}' is missing in 'feeds'.`);if(l)for(const h of this.outputNames)o[h]=null;const m=await this.handler.run(e,o,u),g={};for(const h in m)Object.hasOwnProperty.call(m,h)&&(g[h]=new Tensor$1(m[h].type,m[h].data,m[h].dims));return g}static async create(e,t,s,o){let u,l={};if(typeof e=="string"){if(u=e,typeof t=="object"&&t!==null)l=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(u=e,typeof t=="object"&&t!==null)l=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer){const i=e;let r=0,d=e.byteLength;if(typeof t=="object"&&t!==null)l=t;else if(typeof t=="number"){if(r=t,!Number.isSafeInteger(r))throw new RangeError("'byteOffset' must be an integer.");if(r<0||r>=i.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${i.byteLength}).`);if(d=e.byteLength-r,typeof s=="number"){if(d=s,!Number.isSafeInteger(d))throw new RangeError("'byteLength' must be an integer.");if(d<=0||r+d>i.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${i.byteLength-r}].`);if(typeof o=="object"&&o!==null)l=o;else if(typeof o<"u")throw new TypeError("'options' must be an object.")}else if(typeof s<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof t<"u")throw new TypeError("'options' must be an object.");u=new Uint8Array(i,r,d)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");const g=(l.executionProviders||[]).map(i=>typeof i=="string"?i:i.name),f=await(await resolveBackend(g)).createSessionHandler(u,l);return new Eh(f)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}};const InferenceSession$1=InferenceSession$2,lib=Object.freeze(Object.defineProperty({__proto__:null,InferenceSession:InferenceSession$1,Tensor:Tensor$1,env:env$2,registerBackend},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(lib);/*!
* ONNX Runtime Web v1.14.0
* Copyright (c) Microsoft Corporation. All rights reserved.
* Licensed under the MIT License.
*/var hasRequiredOrtWeb_min;function requireOrtWeb_min(){return hasRequiredOrtWeb_min||(hasRequiredOrtWeb_min=1,(function(module,exports$1){(function(n,e){module.exports=e(require$$0)})(self,(__WEBPACK_EXTERNAL_MODULE__1670__=>(()=>{var __webpack_modules__={3474:(n,e,t)=>{var s,o=(s=(s=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(u){function l(){return ee.buffer!=q&&z(ee.buffer),le}function m(){return ee.buffer!=q&&z(ee.buffer),be}function g(){return ee.buffer!=q&&z(ee.buffer),xe}function h(){return ee.buffer!=q&&z(ee.buffer),Ee}function f(){return ee.buffer!=q&&z(ee.buffer),we}var i,r,d;u=u||{},i||(i=u!==void 0?u:{}),i.ready=new Promise((function(G,K){r=G,d=K}));var p,_,y,v,T,w,E=Object.assign({},i),P="./this.program",R=(G,K)=>{throw K},I=typeof window=="object",N=typeof importScripts=="function",B=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",D=i.ENVIRONMENT_IS_PTHREAD||!1,Y="";function se(G){return i.locateFile?i.locateFile(G,Y):Y+G}if(B){let G;Y=N?t(908).dirname(Y)+"/":"//",w=()=>{T||(v=t(1384),T=t(908))},p=function(K,oe){return w(),K=T.normalize(K),v.readFileSync(K,oe?void 0:"utf8")},y=K=>((K=p(K,!0)).buffer||(K=new Uint8Array(K)),K),_=(K,oe,ge)=>{w(),K=T.normalize(K),v.readFile(K,(function(Pe,Be){Pe?ge(Pe):oe(Be.buffer)}))},1<process.argv.length&&(P=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(K){if(!(K instanceof He))throw K})),process.on("unhandledRejection",(function(K){throw K})),R=(K,oe)=>{if(ye())throw process.exitCode=K,oe;oe instanceof He||H("exiting due to exception: "+oe),process.exit(K)},i.inspect=function(){return"[Emscripten Module object]"};try{G=t(9925)}catch(K){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),K}t.g.Worker=G.Worker}else(I||N)&&(N?Y=self.location.href:typeof document<"u"&&document.currentScript&&(Y=document.currentScript.src),s&&(Y=s),Y=Y.indexOf("blob:")!==0?Y.substr(0,Y.replace(/[?#].*/,"").lastIndexOf("/")+1):"",B||(p=G=>{var K=new XMLHttpRequest;return K.open("GET",G,!1),K.send(null),K.responseText},N&&(y=G=>{var K=new XMLHttpRequest;return K.open("GET",G,!1),K.responseType="arraybuffer",K.send(null),new Uint8Array(K.response)}),_=(G,K,oe)=>{var ge=new XMLHttpRequest;ge.open("GET",G,!0),ge.responseType="arraybuffer",ge.onload=()=>{ge.status==200||ge.status==0&&ge.response?K(ge.response):oe()},ge.onerror=oe,ge.send(null)}));B&&typeof performance>"u"&&(t.g.performance=t(6953).performance);var re=console.log.bind(console),W=console.warn.bind(console);B&&(w(),re=G=>v.writeSync(1,G+`
`),W=G=>v.writeSync(2,G+`
`));var $,k=i.print||re,H=i.printErr||W;Object.assign(i,E),E=null,i.thisProgram&&(P=i.thisProgram),i.quit&&(R=i.quit),i.wasmBinary&&($=i.wasmBinary);var de=i.noExitRuntime||!1;typeof WebAssembly!="object"&&ae("no native wasm support detected");var ee,ce,q,le,be,xe,Ee,we,U=!1,L=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function M(G,K,oe){var ge=(K>>>=0)+oe;for(oe=K;G[oe]&&!(oe>=ge);)++oe;if(16<oe-K&&G.buffer&&L)return L.decode(G.buffer instanceof SharedArrayBuffer?G.slice(K,oe):G.subarray(K,oe));for(ge="";K<oe;){var Pe=G[K++];if(128&Pe){var Be=63&G[K++];if((224&Pe)==192)ge+=String.fromCharCode((31&Pe)<<6|Be);else{var je=63&G[K++];65536>(Pe=(240&Pe)==224?(15&Pe)<<12|Be<<6|je:(7&Pe)<<18|Be<<12|je<<6|63&G[K++])?ge+=String.fromCharCode(Pe):(Pe-=65536,ge+=String.fromCharCode(55296|Pe>>10,56320|1023&Pe))}}else ge+=String.fromCharCode(Pe)}return ge}function C(G,K){return(G>>>=0)?M(m(),G,K):""}function V(G,K,oe,ge){if(!(0<ge))return 0;var Pe=oe>>>=0;ge=oe+ge-1;for(var Be=0;Be<G.length;++Be){var je=G.charCodeAt(Be);if(55296<=je&&57343>=je&&(je=65536+((1023&je)<<10)|1023&G.charCodeAt(++Be)),127>=je){if(oe>=ge)break;K[oe++>>>0]=je}else{if(2047>=je){if(oe+1>=ge)break;K[oe++>>>0]=192|je>>6}else{if(65535>=je){if(oe+2>=ge)break;K[oe++>>>0]=224|je>>12}else{if(oe+3>=ge)break;K[oe++>>>0]=240|je>>18,K[oe++>>>0]=128|je>>12&63}K[oe++>>>0]=128|je>>6&63}K[oe++>>>0]=128|63&je}}return K[oe>>>0]=0,oe-Pe}function O(G){for(var K=0,oe=0;oe<G.length;++oe){var ge=G.charCodeAt(oe);127>=ge?K++:2047>=ge?K+=2:55296<=ge&&57343>=ge?(K+=4,++oe):K+=3}return K}function z(G){q=G,i.HEAP8=le=new Int8Array(G),i.HEAP16=new Int16Array(G),i.HEAP32=xe=new Int32Array(G),i.HEAPU8=be=new Uint8Array(G),i.HEAPU16=new Uint16Array(G),i.HEAPU32=Ee=new Uint32Array(G),i.HEAPF32=new Float32Array(G),i.HEAPF64=we=new Float64Array(G)}D&&(q=i.buffer);var j=i.INITIAL_MEMORY||16777216;if(D)ee=i.wasmMemory,q=i.buffer;else if(i.wasmMemory)ee=i.wasmMemory;else if(!((ee=new WebAssembly.Memory({initial:j/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw H("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),B&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");ee&&(q=ee.buffer),j=q.byteLength,z(q);var J,X=[],ne=[],ie=[],fe=[];function ye(){return de||!1}function pe(){var G=i.preRun.shift();X.unshift(G)}var te,ue=0,Ie=null;function ae(G){throw D?postMessage({cmd:"onAbort",arg:G}):i.onAbort&&i.onAbort(G),H(G="Aborted("+G+")"),U=!0,G=new WebAssembly.RuntimeError(G+". Build with -sASSERTIONS for more info."),d(G),G}function De(){return te.startsWith("data:application/octet-stream;base64,")}function ze(){var G=te;try{if(G==te&&$)return new Uint8Array($);if(y)return y(G);throw"both async and sync fetching of the wasm failed"}catch(K){ae(K)}}te="ort-wasm-threaded.wasm",De()||(te=se(te));var Ge={};function He(G){this.name="ExitStatus",this.message="Program terminated with exit("+G+")",this.status=G}function Ye(G){(G=qe.Vb[G])||ae(),qe.mc(G)}function Xe(G){var K=qe.Cc();if(!K)return 6;qe.ac.push(K),qe.Vb[G.Ub]=K,K.Ub=G.Ub;var oe={cmd:"run",start_routine:G.Ic,arg:G.zc,pthread_ptr:G.Ub};return K.$b=()=>{oe.time=performance.now(),K.postMessage(oe,G.Nc)},K.loaded&&(K.$b(),delete K.$b),0}function it(G){if(D)return We(1,1,G);ye()||(qe.oc(),i.onExit&&i.onExit(G),U=!0),R(G,new He(G))}function ut(G,K){if(!K&&D)throw zt(G),"unwind";ye()||D||(vs(),Je(ie),_n(0),bs[1].length&&_s(1,10),bs[2].length&&_s(2,10),qe.oc()),it(G)}var qe={Yb:[],ac:[],qc:[],Vb:{},fc:function(){D&&qe.Ec()},Pc:function(){},Ec:function(){qe.receiveObjectTransfer=qe.Gc,qe.threadInitTLS=qe.pc,qe.setExitStatus=qe.nc,de=!1},nc:function(){},oc:function(){for(var G of Object.values(qe.Vb))qe.mc(G);for(G of qe.Yb)G.terminate();qe.Yb=[]},mc:function(G){var K=G.Ub;delete qe.Vb[K],qe.Yb.push(G),qe.ac.splice(qe.ac.indexOf(G),1),G.Ub=0,xs(K)},Gc:function(){},pc:function(){qe.qc.forEach((G=>G()))},Fc:function(G,K){G.onmessage=oe=>{var ge=(oe=oe.data).cmd;if(G.Ub&&(qe.Bc=G.Ub),oe.targetThread&&oe.targetThread!=es()){var Pe=qe.Vb[oe.Qc];Pe?Pe.postMessage(oe,oe.transferList):H('Internal error! Worker sent a message "'+ge+'" to target pthread '+oe.targetThread+", but that thread no longer exists!")}else ge==="processProxyingQueue"?ve(oe.queue):ge==="spawnThread"?Xe(oe):ge==="cleanupThread"?Ye(oe.thread):ge==="killThread"?(oe=oe.thread,ge=qe.Vb[oe],delete qe.Vb[oe],ge.terminate(),xs(oe),qe.ac.splice(qe.ac.indexOf(ge),1),ge.Ub=0):ge==="cancelThread"?qe.Vb[oe.thread].postMessage({cmd:"cancel"}):ge==="loaded"?(G.loaded=!0,K&&K(G),G.$b&&(G.$b(),delete G.$b)):ge==="print"?k("Thread "+oe.threadId+": "+oe.text):ge==="printErr"?H("Thread "+oe.threadId+": "+oe.text):ge==="alert"?alert("Thread "+oe.threadId+": "+oe.text):oe.target==="setimmediate"?G.postMessage(oe):ge==="onAbort"?i.onAbort&&i.onAbort(oe.arg):ge&&H("worker sent an unknown command "+ge);qe.Bc=void 0},G.onerror=oe=>{throw H("worker sent an error! "+oe.filename+":"+oe.lineno+": "+oe.message),oe},B&&(G.on("message",(function(oe){G.onmessage({data:oe})})),G.on("error",(function(oe){G.onerror(oe)})),G.on("detachedExit",(function(){}))),G.postMessage({cmd:"load",urlOrBlob:i.mainScriptUrlOrBlob||s,wasmMemory:ee,wasmModule:ce})},yc:function(){var G=se("ort-wasm-threaded.worker.js");qe.Yb.push(new Worker(G))},Cc:function(){return qe.Yb.length==0&&(qe.yc(),qe.Fc(qe.Yb[0])),qe.Yb.pop()}};function Je(G){for(;0<G.length;)G.shift()(i)}function Pt(G){var K=ft();return G=G(),ht(K),G}function zt(G){if(D)return We(2,0,G);try{ut(G)}catch(K){K instanceof He||K=="unwind"||R(1,K)}}i.PThread=qe,i.establishStackSpace=function(){var G=es(),K=g()[G+44>>2>>>0];G=g()[G+48>>2>>>0],ai(K,K-G),ht(K)};var Gt=[];function nt(G){var K=Gt[G];return K||(G>=Gt.length&&(Gt.length=G+1),Gt[G]=K=J.get(G)),K}i.invokeEntryPoint=function(G,K){G=nt(G)(K),ye()?qe.nc(G):lr(G)};var At,Mt,$t=[],et=0,rt=0;function st(G){this.Zb=G,this.Sb=G-24,this.xc=function(K){h()[this.Sb+4>>2>>>0]=K},this.bc=function(){return h()[this.Sb+4>>2>>>0]},this.wc=function(K){h()[this.Sb+8>>2>>>0]=K},this.Dc=function(){return h()[this.Sb+8>>2>>>0]},this.rc=function(){g()[this.Sb>>2>>>0]=0},this.hc=function(K){K=K?1:0,l()[this.Sb+12>>0>>>0]=K},this.uc=function(){return l()[this.Sb+12>>0>>>0]!=0},this.ic=function(K){K=K?1:0,l()[this.Sb+13>>0>>>0]=K},this.kc=function(){return l()[this.Sb+13>>0>>>0]!=0},this.fc=function(K,oe){this.cc(0),this.xc(K),this.wc(oe),this.rc(),this.hc(!1),this.ic(!1)},this.sc=function(){Atomics.add(g(),this.Sb>>2,1)},this.Hc=function(){return Atomics.sub(g(),this.Sb>>2,1)===1},this.cc=function(K){h()[this.Sb+16>>2>>>0]=K},this.tc=function(){return h()[this.Sb+16>>2>>>0]},this.vc=function(){if(ts(this.bc()))return h()[this.Zb>>2>>>0];var K=this.tc();return K!==0?K:this.Zb}}function Jt(G){return Wi(new st(G).Sb)}function Dt(G,K,oe,ge){return D?We(3,1,G,K,oe,ge):xn(G,K,oe,ge)}function xn(G,K,oe,ge){if(typeof SharedArrayBuffer>"u")return H("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var Pe=[];return D&&Pe.length===0?Dt(G,K,oe,ge):(G={Ic:oe,Ub:G,zc:ge,Nc:Pe},D?(G.Oc="spawnThread",postMessage(G,Pe),0):Xe(G))}function on(G,K,oe){return D?We(4,1,G,K,oe):0}function Tn(G,K){if(D)return We(5,1,G,K)}function Vt(G,K){if(D)return We(6,1,G,K)}function wn(G,K,oe){if(D)return We(7,1,G,K,oe)}function Fn(G,K,oe){return D?We(8,1,G,K,oe):0}function gn(G,K){if(D)return We(9,1,G,K)}function ir(G,K,oe){if(D)return We(10,1,G,K,oe)}function Ar(G,K,oe,ge){if(D)return We(11,1,G,K,oe,ge)}function Cr(G,K,oe,ge){if(D)return We(12,1,G,K,oe,ge)}function En(G,K,oe,ge){if(D)return We(13,1,G,K,oe,ge)}function Kt(G){if(D)return We(14,1,G)}function Z(G,K){if(D)return We(15,1,G,K)}function he(G,K,oe){if(D)return We(16,1,G,K,oe)}function ve(G){Atomics.store(g(),G>>2,1),es()&&ii(G),Atomics.compareExchange(g(),G>>2,1,0)}function Se(G){return h()[G>>>2]+4294967296*g()[G+4>>>2]}function Re(G,K,oe,ge,Pe,Be){return D?We(17,1,G,K,oe,ge,Pe,Be):-52}function Oe(G,K,oe,ge,Pe,Be){if(D)return We(18,1,G,K,oe,ge,Pe,Be)}function $e(G){var K=O(G)+1,oe=Mr(K);return oe&&V(G,l(),oe,K),oe}function Qe(G,K,oe){function ge(dt){return(dt=dt.toTimeString().match(/\(([A-Za-z ]+)\)$/))?dt[1]:"GMT"}if(D)return We(19,1,G,K,oe);var Pe=new Date().getFullYear(),Be=new Date(Pe,0,1),je=new Date(Pe,6,1);Pe=Be.getTimezoneOffset();var tt=je.getTimezoneOffset(),ot=Math.max(Pe,tt);g()[G>>2>>>0]=60*ot,g()[K>>2>>>0]=+(Pe!=tt),G=ge(Be),K=ge(je),G=$e(G),K=$e(K),tt<Pe?(h()[oe>>2>>>0]=G,h()[oe+4>>2>>>0]=K):(h()[oe>>2>>>0]=K,h()[oe+4>>2>>>0]=G)}function We(G,K){var oe=arguments.length-2,ge=arguments;return Pt((()=>{for(var Pe=oi(8*oe),Be=Pe>>3,je=0;je<oe;je++){var tt=ge[2+je];f()[Be+je>>>0]=tt}return or(G,oe,Pe,K)}))}i.executeNotifiedProxyingQueue=ve,Mt=B?()=>{var G=process.hrtime();return 1e3*G[0]+G[1]/1e6}:D?()=>performance.now()-i.__performance_now_clock_drift:()=>performance.now();var ct,Et=[],qt={};function _t(){if(!ct){var G,K={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:P||"./this.program"};for(G in qt)qt[G]===void 0?delete K[G]:K[G]=qt[G];var oe=[];for(G in K)oe.push(G+"="+K[G]);ct=oe}return ct}function ke(G,K){if(D)return We(20,1,G,K);var oe=0;return _t().forEach((function(ge,Pe){var Be=K+oe;for(Pe=h()[G+4*Pe>>2>>>0]=Be,Be=0;Be<ge.length;++Be)l()[Pe++>>0>>>0]=ge.charCodeAt(Be);l()[Pe>>0>>>0]=0,oe+=ge.length+1})),0}function yt(G,K){if(D)return We(21,1,G,K);var oe=_t();h()[G>>2>>>0]=oe.length;var ge=0;return oe.forEach((function(Pe){ge+=Pe.length+1})),h()[K>>2>>>0]=ge,0}function Ct(G){return D?We(22,1,G):52}function ln(G,K,oe,ge){return D?We(23,1,G,K,oe,ge):52}function Kn(G,K,oe,ge,Pe){return D?We(24,1,G,K,oe,ge,Pe):70}var bs=[null,[],[]];function _s(G,K){var oe=bs[G];K===0||K===10?((G===1?k:H)(M(oe,0)),oe.length=0):oe.push(K)}function Yi(G,K,oe,ge){if(D)return We(25,1,G,K,oe,ge);for(var Pe=0,Be=0;Be<oe;Be++){var je=h()[K>>2>>>0],tt=h()[K+4>>2>>>0];K+=8;for(var ot=0;ot<tt;ot++)_s(G,m()[je+ot>>>0]);Pe+=tt}return h()[ge>>2>>>0]=Pe,0}var un=0;function ar(G){return G%4==0&&(G%100!=0||G%400==0)}var Un=[31,29,31,30,31,30,31,31,30,31,30,31],bn=[31,28,31,30,31,30,31,31,30,31,30,31];function ni(G,K,oe,ge){function Pe(Ne,bt,kt){for(Ne=typeof Ne=="number"?Ne.toString():Ne||"";Ne.length<bt;)Ne=kt[0]+Ne;return Ne}function Be(Ne,bt){return Pe(Ne,bt,"0")}function je(Ne,bt){function kt(dr){return 0>dr?-1:0<dr?1:0}var Pn;return(Pn=kt(Ne.getFullYear()-bt.getFullYear()))===0&&(Pn=kt(Ne.getMonth()-bt.getMonth()))===0&&(Pn=kt(Ne.getDate()-bt.getDate())),Pn}function tt(Ne){switch(Ne.getDay()){case 0:return new Date(Ne.getFullYear()-1,11,29);case 1:return Ne;case 2:return new Date(Ne.getFullYear(),0,3);case 3:return new Date(Ne.getFullYear(),0,2);case 4:return new Date(Ne.getFullYear(),0,1);case 5:return new Date(Ne.getFullYear()-1,11,31);case 6:return new Date(Ne.getFullYear()-1,11,30)}}function ot(Ne){var bt=Ne.Wb;for(Ne=new Date(new Date(Ne.Xb+1900,0,1).getTime());0<bt;){var kt=Ne.getMonth(),Pn=(ar(Ne.getFullYear())?Un:bn)[kt];if(!(bt>Pn-Ne.getDate())){Ne.setDate(Ne.getDate()+bt);break}bt-=Pn-Ne.getDate()+1,Ne.setDate(1),11>kt?Ne.setMonth(kt+1):(Ne.setMonth(0),Ne.setFullYear(Ne.getFullYear()+1))}return kt=new Date(Ne.getFullYear()+1,0,4),bt=tt(new Date(Ne.getFullYear(),0,4)),kt=tt(kt),0>=je(bt,Ne)?0>=je(kt,Ne)?Ne.getFullYear()+1:Ne.getFullYear():Ne.getFullYear()-1}var dt=g()[ge+40>>2>>>0];for(var jt in ge={Lc:g()[ge>>2>>>0],Kc:g()[ge+4>>2>>>0],dc:g()[ge+8>>2>>>0],jc:g()[ge+12>>2>>>0],ec:g()[ge+16>>2>>>0],Xb:g()[ge+20>>2>>>0],Tb:g()[ge+24>>2>>>0],Wb:g()[ge+28>>2>>>0],Rc:g()[ge+32>>2>>>0],Jc:g()[ge+36>>2>>>0],Mc:dt?C(dt):""},oe=C(oe),dt={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})oe=oe.replace(new RegExp(jt,"g"),dt[jt]);var yn="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Sn="January February March April May June July August September October November December".split(" ");for(jt in dt={"%a":function(Ne){return yn[Ne.Tb].substring(0,3)},"%A":function(Ne){return yn[Ne.Tb]},"%b":function(Ne){return Sn[Ne.ec].substring(0,3)},"%B":function(Ne){return Sn[Ne.ec]},"%C":function(Ne){return Be((Ne.Xb+1900)/100|0,2)},"%d":function(Ne){return Be(Ne.jc,2)},"%e":function(Ne){return Pe(Ne.jc,2," ")},"%g":function(Ne){return ot(Ne).toString().substring(2)},"%G":function(Ne){return ot(Ne)},"%H":function(Ne){return Be(Ne.dc,2)},"%I":function(Ne){return(Ne=Ne.dc)==0?Ne=12:12<Ne&&(Ne-=12),Be(Ne,2)},"%j":function(Ne){for(var bt=0,kt=0;kt<=Ne.ec-1;bt+=(ar(Ne.Xb+1900)?Un:bn)[kt++]);return Be(Ne.jc+bt,3)},"%m":function(Ne){return Be(Ne.ec+1,2)},"%M":function(Ne){return Be(Ne.Kc,2)},"%n":function(){return`
`},"%p":function(Ne){return 0<=Ne.dc&&12>Ne.dc?"AM":"PM"},"%S":function(Ne){return Be(Ne.Lc,2)},"%t":function(){return"	"},"%u":function(Ne){return Ne.Tb||7},"%U":function(Ne){return Be(Math.floor((Ne.Wb+7-Ne.Tb)/7),2)},"%V":function(Ne){var bt=Math.floor((Ne.Wb+7-(Ne.Tb+6)%7)/7);if(2>=(Ne.Tb+371-Ne.Wb-2)%7&&bt++,bt)bt==53&&((kt=(Ne.Tb+371-Ne.Wb)%7)==4||kt==3&&ar(Ne.Xb)||(bt=1));else{bt=52;var kt=(Ne.Tb+7-Ne.Wb-1)%7;(kt==4||kt==5&&ar(Ne.Xb%400-1))&&bt++}return Be(bt,2)},"%w":function(Ne){return Ne.Tb},"%W":function(Ne){return Be(Math.floor((Ne.Wb+7-(Ne.Tb+6)%7)/7),2)},"%y":function(Ne){return(Ne.Xb+1900).toString().substring(2)},"%Y":function(Ne){return Ne.Xb+1900},"%z":function(Ne){var bt=0<=(Ne=Ne.Jc);return Ne=Math.abs(Ne)/60,(bt?"+":"-")+("0000"+(Ne/60*100+Ne%60)).slice(-4)},"%Z":function(Ne){return Ne.Mc},"%%":function(){return"%"}},oe=oe.replace(/%%/g,"\0\0"),dt)oe.includes(jt)&&(oe=oe.replace(new RegExp(jt,"g"),dt[jt](ge)));return jt=(function(Ne){var bt=Array(O(Ne)+1);return V(Ne,bt,0,bt.length),bt})(oe=oe.replace(/\0\0/g,"%")),jt.length>K?0:((function(Ne,bt){l().set(Ne,bt>>>0)})(jt,G),jt.length-1)}qe.fc();var Za=[null,it,zt,Dt,on,Tn,Vt,wn,Fn,gn,ir,Ar,Cr,En,Kt,Z,he,Re,Oe,Qe,ke,yt,Ct,ln,Kn,Yi],ri={b:function(G){return Mr(G+24)+24},n:function(G){return(G=new st(G)).uc()||(G.hc(!0),et--),G.ic(!1),$t.push(G),G.sc(),G.vc()},ma:function(G){throw H("Unexpected exception thrown, this is not properly supported - aborting"),U=!0,G},x:function(){gt(0);var G=$t.pop();if(G.Hc()&&!G.kc()){var K=G.Dc();K&&nt(K)(G.Zb),Jt(G.Zb)}rt=0},e:function(){var G=rt;if(!G)return un=0;var K=new st(G);K.cc(G);var oe=K.bc();if(!oe)return un=0,G;for(var ge=Array.prototype.slice.call(arguments),Pe=0;Pe<ge.length;Pe++){var Be=ge[Pe];if(Be===0||Be===oe)break;if(Ts(Be,oe,K.Sb+16))return un=Be,G}return un=oe,G},l:function(){var G=rt;if(!G)return un=0;var K=new st(G);K.cc(G);var oe=K.bc();if(!oe)return un=0,G;for(var ge=Array.prototype.slice.call(arguments),Pe=0;Pe<ge.length;Pe++){var Be=ge[Pe];if(Be===0||Be===oe)break;if(Ts(Be,oe,K.Sb+16))return un=Be,G}return un=oe,G},h:function(){var G=rt;if(!G)return un=0;var K=new st(G);K.cc(G);var oe=K.bc();if(!oe)return un=0,G;for(var ge=Array.prototype.slice.call(arguments),Pe=0;Pe<ge.length;Pe++){var Be=ge[Pe];if(Be===0||Be===oe)break;if(Ts(Be,oe,K.Sb+16))return un=Be,G}return un=oe,G},t:Jt,M:function(){var G=$t.pop();G||ae("no exception to throw");var K=G.Zb;throw G.kc()||($t.push(G),G.ic(!0),G.hc(!1),et++),rt=K,K},c:function(G,K,oe){throw new st(G).fc(K,oe),rt=G,et++,G},pa:function(){return et},Fa:function(G){si(G,!N,1,!I),qe.pc()},T:function(G){D?postMessage({cmd:"cleanupThread",thread:G}):Ye(G)},xa:xn,j:function(G){throw rt||(rt=G),G},H:on,Ma:Tn,ua:Vt,wa:wn,oa:Fn,Ka:gn,Ca:ir,Ja:Ar,V:Cr,va:En,sa:Kt,La:Z,ta:he,Ta:function(){},X:function(){ae("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ua:function(){ae("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},W:function(){return Date.now()},ya:function(){return 2097152},Oa:function(){return!0},za:function(G,K,oe,ge){if(G==K)setTimeout((()=>ve(ge)));else if(D)postMessage({targetThread:G,cmd:"processProxyingQueue",queue:ge});else{if(!(G=qe.Vb[G]))return;G.postMessage({cmd:"processProxyingQueue",queue:ge})}return 1},Ea:function(){return-1},Pa:function(G,K){G=new Date(1e3*Se(G)),g()[K>>2>>>0]=G.getUTCSeconds(),g()[K+4>>2>>>0]=G.getUTCMinutes(),g()[K+8>>2>>>0]=G.getUTCHours(),g()[K+12>>2>>>0]=G.getUTCDate(),g()[K+16>>2>>>0]=G.getUTCMonth(),g()[K+20>>2>>>0]=G.getUTCFullYear()-1900,g()[K+24>>2>>>0]=G.getUTCDay(),G=(G.getTime()-Date.UTC(G.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,g()[K+28>>2>>>0]=G},Qa:function(G,K){G=new Date(1e3*Se(G)),g()[K>>2>>>0]=G.getSeconds(),g()[K+4>>2>>>0]=G.getMinutes(),g()[K+8>>2>>>0]=G.getHours(),g()[K+12>>2>>>0]=G.getDate(),g()[K+16>>2>>>0]=G.getMonth(),g()[K+20>>2>>>0]=G.getFullYear()-1900,g()[K+24>>2>>>0]=G.getDay();var oe=new Date(G.getFullYear(),0,1),ge=(G.getTime()-oe.getTime())/864e5|0;g()[K+28>>2>>>0]=ge,g()[K+36>>2>>>0]=-60*G.getTimezoneOffset(),ge=new Date(G.getFullYear(),6,1).getTimezoneOffset(),G=0|(ge!=(oe=oe.getTimezoneOffset())&&G.getTimezoneOffset()==Math.min(oe,ge)),g()[K+32>>2>>>0]=G},Ra:function(G){var K=new Date(g()[G+20>>2>>>0]+1900,g()[G+16>>2>>>0],g()[G+12>>2>>>0],g()[G+8>>2>>>0],g()[G+4>>2>>>0],g()[G>>2>>>0],0),oe=g()[G+32>>2>>>0],ge=K.getTimezoneOffset(),Pe=new Date(K.getFullYear(),0,1),Be=new Date(K.getFullYear(),6,1).getTimezoneOffset(),je=Pe.getTimezoneOffset(),tt=Math.min(je,Be);return 0>oe?g()[G+32>>2>>>0]=+(Be!=je&&tt==ge):0<oe!=(tt==ge)&&(Be=Math.max(je,Be),K.setTime(K.getTime()+6e4*((0<oe?tt:Be)-ge))),g()[G+24>>2>>>0]=K.getDay(),oe=(K.getTime()-Pe.getTime())/864e5|0,g()[G+28>>2>>>0]=oe,g()[G>>2>>>0]=K.getSeconds(),g()[G+4>>2>>>0]=K.getMinutes(),g()[G+8>>2>>>0]=K.getHours(),g()[G+12>>2>>>0]=K.getDate(),g()[G+16>>2>>>0]=K.getMonth(),K.getTime()/1e3|0},Aa:Re,Ba:Oe,Sa:function G(K,oe,ge){G.Ac||(G.Ac=!0,Qe(K,oe,ge))},y:function(){ae("")},U:function(){if(!B&&!N){var G="Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread";At||(At={}),At[G]||(At[G]=1,B&&(G="warning: "+G),H(G))}},ra:function(){return 4294901760},B:Mt,Ia:function(G,K,oe){m().copyWithin(G>>>0,K>>>0,K+oe>>>0)},F:function(){return B?t(3993).cpus().length:navigator.hardwareConcurrency},Da:function(G,K,oe){Et.length=K,oe>>=3;for(var ge=0;ge<K;ge++)Et[ge]=f()[oe+ge>>>0];return(0>G?Ge[-G-1]:Za[G]).apply(null,Et)},qa:function(G){var K=m().length;if((G>>>=0)<=K||4294901760<G)return!1;for(var oe=1;4>=oe;oe*=2){var ge=K*(1+.2/oe);ge=Math.min(ge,G+100663296);var Pe=Math;ge=Math.max(G,ge),Pe=Pe.min.call(Pe,4294901760,ge+(65536-ge%65536)%65536);e:{try{ee.grow(Pe-q.byteLength+65535>>>16),z(ee.buffer);var Be=1;break e}catch{}Be=void 0}if(Be)return!0}return!1},Na:function(){throw"unwind"},Ga:ke,Ha:yt,J:ut,I:Ct,S:ln,ga:Kn,R:Yi,d:function(){return un},na:function G(K,oe){G.lc||(G.lc=(function(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var Pe=new Uint8Array(1);return()=>(crypto.getRandomValues(Pe),Pe[0])}if(B)try{var Be=t(Object((function(){var je=new Error("Cannot find module 'crypto'");throw je.code="MODULE_NOT_FOUND",je})()));return()=>Be.randomBytes(1)[0]}catch{}return()=>ae("randomDevice")})());for(var ge=0;ge<oe;ge++)l()[K+ge>>0>>>0]=G.lc();return 0},ia:function(G,K,oe){var ge=ft();try{return nt(G)(K,oe)}catch(Pe){if(ht(ge),Pe!==Pe+0)throw Pe;gt(1,0)}},ja:function(G,K,oe){var ge=ft();try{return nt(G)(K,oe)}catch(Pe){if(ht(ge),Pe!==Pe+0)throw Pe;gt(1,0)}},K:function(G){var K=ft();try{return nt(G)()}catch(oe){if(ht(K),oe!==oe+0)throw oe;gt(1,0)}},f:function(G,K){var oe=ft();try{return nt(G)(K)}catch(ge){if(ht(oe),ge!==ge+0)throw ge;gt(1,0)}},P:function(G,K,oe){var ge=ft();try{return nt(G)(K,oe)}catch(Pe){if(ht(ge),Pe!==Pe+0)throw Pe;gt(1,0)}},Q:function(G,K,oe){var ge=ft();try{return nt(G)(K,oe)}catch(Pe){if(ht(ge),Pe!==Pe+0)throw Pe;gt(1,0)}},k:function(G,K,oe){var ge=ft();try{return nt(G)(K,oe)}catch(Pe){if(ht(ge),Pe!==Pe+0)throw Pe;gt(1,0)}},p:function(G,K,oe,ge){var Pe=ft();try{return nt(G)(K,oe,ge)}catch(Be){if(ht(Pe),Be!==Be+0)throw Be;gt(1,0)}},q:function(G,K,oe,ge,Pe){var Be=ft();try{return nt(G)(K,oe,ge,Pe)}catch(je){if(ht(Be),je!==je+0)throw je;gt(1,0)}},N:function(G,K,oe,ge,Pe,Be){var je=ft();try{return nt(G)(K,oe,ge,Pe,Be)}catch(tt){if(ht(je),tt!==tt+0)throw tt;gt(1,0)}},s:function(G,K,oe,ge,Pe,Be){var je=ft();try{return nt(G)(K,oe,ge,Pe,Be)}catch(tt){if(ht(je),tt!==tt+0)throw tt;gt(1,0)}},w:function(G,K,oe,ge,Pe,Be,je){var tt=ft();try{return nt(G)(K,oe,ge,Pe,Be,je)}catch(ot){if(ht(tt),ot!==ot+0)throw ot;gt(1,0)}},L:function(G,K,oe,ge,Pe,Be,je,tt){var ot=ft();try{return nt(G)(K,oe,ge,Pe,Be,je,tt)}catch(dt){if(ht(ot),dt!==dt+0)throw dt;gt(1,0)}},E:function(G,K,oe,ge,Pe,Be,je,tt,ot,dt,jt,yn){var Sn=ft();try{return nt(G)(K,oe,ge,Pe,Be,je,tt,ot,dt,jt,yn)}catch(Ne){if(ht(Sn),Ne!==Ne+0)throw Ne;gt(1,0)}},aa:function(G,K,oe,ge,Pe,Be,je,tt){var ot=ft();try{return Ir(G,K,oe,ge,Pe,Be,je,tt)}catch(dt){if(ht(ot),dt!==dt+0)throw dt;gt(1,0)}},_:function(G,K,oe,ge,Pe,Be,je){var tt=ft();try{return ws(G,K,oe,ge,Pe,Be,je)}catch(ot){if(ht(tt),ot!==ot+0)throw ot;gt(1,0)}},Z:function(G,K,oe,ge,Pe){var Be=ft();try{return Gn(G,K,oe,ge,Pe)}catch(je){if(ht(Be),je!==je+0)throw je;gt(1,0)}},ca:function(G,K,oe,ge){var Pe=ft();try{return Ss(G,K,oe,ge)}catch(Be){if(ht(Pe),Be!==Be+0)throw Be;gt(1,0)}},$:function(G){var K=ft();try{return zn(G)}catch(oe){if(ht(K),oe!==oe+0)throw oe;gt(1,0)}},ba:function(G,K){var oe=ft();try{return ui(G,K)}catch(ge){if(ht(oe),ge!==ge+0)throw ge;gt(1,0)}},Y:function(G,K,oe){var ge=ft();try{return Es(G,K,oe)}catch(Pe){if(ht(ge),Pe!==Pe+0)throw Pe;gt(1,0)}},g:function(G){var K=ft();try{nt(G)()}catch(oe){if(ht(K),oe!==oe+0)throw oe;gt(1,0)}},r:function(G,K){var oe=ft();try{nt(G)(K)}catch(ge){if(ht(oe),ge!==ge+0)throw ge;gt(1,0)}},i:function(G,K,oe){var ge=ft();try{nt(G)(K,oe)}catch(Pe){if(ht(ge),Pe!==Pe+0)throw Pe;gt(1,0)}},ha:function(G,K,oe,ge){var Pe=ft();try{nt(G)(K,oe,ge)}catch(Be){if(ht(Pe),Be!==Be+0)throw Be;gt(1,0)}},m:function(G,K,oe,ge){var Pe=ft();try{nt(G)(K,oe,ge)}catch(Be){if(ht(Pe),Be!==Be+0)throw Be;gt(1,0)}},v:function(G,K,oe,ge,Pe){var Be=ft();try{nt(G)(K,oe,ge,Pe)}catch(je){if(ht(Be),je!==je+0)throw je;gt(1,0)}},u:function(G,K,oe,ge,Pe,Be){var je=ft();try{nt(G)(K,oe,ge,Pe,Be)}catch(tt){if(ht(je),tt!==tt+0)throw tt;gt(1,0)}},O:function(G,K,oe,ge,Pe,Be,je){var tt=ft();try{nt(G)(K,oe,ge,Pe,Be,je)}catch(ot){if(ht(tt),ot!==ot+0)throw ot;gt(1,0)}},A:function(G,K,oe,ge,Pe,Be,je,tt){var ot=ft();try{nt(G)(K,oe,ge,Pe,Be,je,tt)}catch(dt){if(ht(ot),dt!==dt+0)throw dt;gt(1,0)}},ka:function(G,K,oe,ge,Pe,Be,je,tt,ot){var dt=ft();try{nt(G)(K,oe,ge,Pe,Be,je,tt,ot)}catch(jt){if(ht(dt),jt!==jt+0)throw jt;gt(1,0)}},C:function(G,K,oe,ge,Pe,Be,je,tt,ot,dt,jt){var yn=ft();try{nt(G)(K,oe,ge,Pe,Be,je,tt,ot,dt,jt)}catch(Sn){if(ht(yn),Sn!==Sn+0)throw Sn;gt(1,0)}},D:function(G,K,oe,ge,Pe,Be,je,tt,ot,dt,jt,yn,Sn,Ne,bt,kt){var Pn=ft();try{nt(G)(K,oe,ge,Pe,Be,je,tt,ot,dt,jt,yn,Sn,Ne,bt,kt)}catch(dr){if(ht(Pn),dr!==dr+0)throw dr;gt(1,0)}},fa:function(G,K,oe,ge,Pe,Be,je,tt){var ot=ft();try{ur(G,K,oe,ge,Pe,Be,je,tt)}catch(dt){if(ht(ot),dt!==dt+0)throw dt;gt(1,0)}},da:function(G,K,oe,ge,Pe,Be,je,tt,ot,dt,jt,yn){var Sn=ft();try{li(G,K,oe,ge,Pe,Be,je,tt,ot,dt,jt,yn)}catch(Ne){if(ht(Sn),Ne!==Ne+0)throw Ne;gt(1,0)}},ea:function(G,K,oe,ge,Pe,Be){var je=ft();try{cr(G,K,oe,ge,Pe,Be)}catch(tt){if(ht(je),tt!==tt+0)throw tt;gt(1,0)}},o:function(G){return G},a:ee||i.wasmMemory,G:function(G){un=G},la:ni,z:function(G,K,oe,ge){return ni(G,K,oe,ge)}};(function(){function G(Pe,Be){i.asm=Pe.exports,qe.qc.push(i.asm.sb),J=i.asm.ub,ne.unshift(i.asm.Va),ce=Be,D||(ue--,i.monitorRunDependencies&&i.monitorRunDependencies(ue),ue==0&&Ie&&(Pe=Ie,Ie=null,Pe()))}function K(Pe){G(Pe.instance,Pe.module)}function oe(Pe){return(function(){if(!$&&(I||N)){if(typeof fetch=="function"&&!te.startsWith("file://"))return fetch(te,{credentials:"same-origin"}).then((function(Be){if(!Be.ok)throw"failed to load wasm binary file at '"+te+"'";return Be.arrayBuffer()})).catch((function(){return ze()}));if(_)return new Promise((function(Be,je){_(te,(function(tt){Be(new Uint8Array(tt))}),je)}))}return Promise.resolve().then((function(){return ze()}))})().then((function(Be){return WebAssembly.instantiate(Be,ge)})).then((function(Be){return Be})).then(Pe,(function(Be){H("failed to asynchronously prepare wasm: "+Be),ae(Be)}))}var ge={a:ri};if(D||(ue++,i.monitorRunDependencies&&i.monitorRunDependencies(ue)),i.instantiateWasm)try{return i.instantiateWasm(ge,G)}catch(Pe){return H("Module.instantiateWasm callback failed with error: "+Pe),!1}($||typeof WebAssembly.instantiateStreaming!="function"||De()||te.startsWith("file://")||B||typeof fetch!="function"?oe(K):fetch(te,{credentials:"same-origin"}).then((function(Pe){return WebAssembly.instantiateStreaming(Pe,ge).then(K,(function(Be){return H("wasm streaming compile failed: "+Be),H("falling back to ArrayBuffer instantiation"),oe(K)}))}))).catch(d)})(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.Va).apply(null,arguments)},i._OrtInit=function(){return(i._OrtInit=i.asm.Wa).apply(null,arguments)},i._OrtCreateSessionOptions=function(){return(i._OrtCreateSessionOptions=i.asm.Xa).apply(null,arguments)},i._OrtAppendExecutionProvider=function(){return(i._OrtAppendExecutionProvider=i.asm.Ya).apply(null,arguments)},i._OrtAddSessionConfigEntry=function(){return(i._OrtAddSessionConfigEntry=i.asm.Za).apply(null,arguments)},i._OrtReleaseSessionOptions=function(){return(i._OrtReleaseSessionOptions=i.asm._a).apply(null,arguments)},i._OrtCreateSession=function(){return(i._OrtCreateSession=i.asm.$a).apply(null,arguments)},i._OrtReleaseSession=function(){return(i._OrtReleaseSession=i.asm.ab).apply(null,arguments)},i._OrtGetInputCount=function(){return(i._OrtGetInputCount=i.asm.bb).apply(null,arguments)},i._OrtGetOutputCount=function(){return(i._OrtGetOutputCount=i.asm.cb).apply(null,arguments)},i._OrtGetInputName=function(){return(i._OrtGetInputName=i.asm.db).apply(null,arguments)},i._OrtGetOutputName=function(){return(i._OrtGetOutputName=i.asm.eb).apply(null,arguments)},i._OrtFree=function(){return(i._OrtFree=i.asm.fb).apply(null,arguments)},i._OrtCreateTensor=function(){return(i._OrtCreateTensor=i.asm.gb).apply(null,arguments)},i._OrtGetTensorData=function(){return(i._OrtGetTensorData=i.asm.hb).apply(null,arguments)},i._OrtReleaseTensor=function(){return(i._OrtReleaseTensor=i.asm.ib).apply(null,arguments)},i._OrtCreateRunOptions=function(){return(i._OrtCreateRunOptions=i.asm.jb).apply(null,arguments)},i._OrtAddRunConfigEntry=function(){return(i._OrtAddRunConfigEntry=i.asm.kb).apply(null,arguments)},i._OrtReleaseRunOptions=function(){return(i._OrtReleaseRunOptions=i.asm.lb).apply(null,arguments)},i._OrtRun=function(){return(i._OrtRun=i.asm.mb).apply(null,arguments)},i._OrtEndProfiling=function(){return(i._OrtEndProfiling=i.asm.nb).apply(null,arguments)};var es=i._pthread_self=function(){return(es=i._pthread_self=i.asm.ob).apply(null,arguments)},Mr=i._malloc=function(){return(Mr=i._malloc=i.asm.pb).apply(null,arguments)},Wi=i._free=function(){return(Wi=i._free=i.asm.qb).apply(null,arguments)},_n=i._fflush=function(){return(_n=i._fflush=i.asm.rb).apply(null,arguments)};i.__emscripten_tls_init=function(){return(i.__emscripten_tls_init=i.asm.sb).apply(null,arguments)};var vs=i.___funcs_on_exit=function(){return(vs=i.___funcs_on_exit=i.asm.tb).apply(null,arguments)},si=i.__emscripten_thread_init=function(){return(si=i.__emscripten_thread_init=i.asm.vb).apply(null,arguments)};i.__emscripten_thread_crashed=function(){return(i.__emscripten_thread_crashed=i.asm.wb).apply(null,arguments)};var Rr,or=i._emscripten_run_in_main_runtime_thread_js=function(){return(or=i._emscripten_run_in_main_runtime_thread_js=i.asm.xb).apply(null,arguments)},ii=i.__emscripten_proxy_execute_task_queue=function(){return(ii=i.__emscripten_proxy_execute_task_queue=i.asm.yb).apply(null,arguments)},xs=i.__emscripten_thread_free_data=function(){return(xs=i.__emscripten_thread_free_data=i.asm.zb).apply(null,arguments)},lr=i.__emscripten_thread_exit=function(){return(lr=i.__emscripten_thread_exit=i.asm.Ab).apply(null,arguments)},gt=i._setThrew=function(){return(gt=i._setThrew=i.asm.Bb).apply(null,arguments)},ai=i._emscripten_stack_set_limits=function(){return(ai=i._emscripten_stack_set_limits=i.asm.Cb).apply(null,arguments)},ft=i.stackSave=function(){return(ft=i.stackSave=i.asm.Db).apply(null,arguments)},ht=i.stackRestore=function(){return(ht=i.stackRestore=i.asm.Eb).apply(null,arguments)},oi=i.stackAlloc=function(){return(oi=i.stackAlloc=i.asm.Fb).apply(null,arguments)},Ts=i.___cxa_can_catch=function(){return(Ts=i.___cxa_can_catch=i.asm.Gb).apply(null,arguments)},ts=i.___cxa_is_pointer_type=function(){return(ts=i.___cxa_is_pointer_type=i.asm.Hb).apply(null,arguments)},zn=i.dynCall_j=function(){return(zn=i.dynCall_j=i.asm.Ib).apply(null,arguments)},ws=i.dynCall_iiiiij=function(){return(ws=i.dynCall_iiiiij=i.asm.Jb).apply(null,arguments)},Es=i.dynCall_jii=function(){return(Es=i.dynCall_jii=i.asm.Kb).apply(null,arguments)},ur=i.dynCall_viiiiij=function(){return(ur=i.dynCall_viiiiij=i.asm.Lb).apply(null,arguments)},cr=i.dynCall_vjji=function(){return(cr=i.dynCall_vjji=i.asm.Mb).apply(null,arguments)},li=i.dynCall_viiijjjii=function(){return(li=i.dynCall_viiijjjii=i.asm.Nb).apply(null,arguments)},Ss=i.dynCall_iij=function(){return(Ss=i.dynCall_iij=i.asm.Ob).apply(null,arguments)},ui=i.dynCall_ji=function(){return(ui=i.dynCall_ji=i.asm.Pb).apply(null,arguments)},Ir=i.dynCall_iiiiiij=function(){return(Ir=i.dynCall_iiiiiij=i.asm.Qb).apply(null,arguments)},Gn=i.dynCall_iiij=function(){return(Gn=i.dynCall_iiij=i.asm.Rb).apply(null,arguments)};function Ps(){function G(){if(!Rr&&(Rr=!0,i.calledRun=!0,!U)&&(D||Je(ne),r(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),!D)){if(i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;){var K=i.postRun.shift();fe.unshift(K)}Je(fe)}}if(!(0<ue))if(D)r(i),D||Je(ne),postMessage({cmd:"loaded"});else{if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)pe();Je(X),0<ue||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),G()}),1)):G())}}if(i.UTF8ToString=C,i.stringToUTF8=function(G,K,oe){return V(G,m(),K,oe)},i.lengthBytesUTF8=O,i.keepRuntimeAlive=ye,i.wasmMemory=ee,i.stackSave=ft,i.stackRestore=ht,i.stackAlloc=oi,i.ExitStatus=He,i.PThread=qe,Ie=function G(){Rr||Ps(),Rr||(Ie=G)},i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);0<i.preInit.length;)i.preInit.pop()();return Ps(),u.ready});n.exports=o},932:(n,e,t)=>{var s,o=(s=(s=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(u){var l,m,g;u=u||{},l||(l=u!==void 0?u:{}),l.ready=new Promise((function(Z,he){m=Z,g=he}));var h,f,i,r,d,p,_=Object.assign({},l),y="./this.program",v=(Z,he)=>{throw he},T=typeof window=="object",w=typeof importScripts=="function",E=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",P="";E?(P=w?t(908).dirname(P)+"/":"//",p=()=>{d||(r=t(1384),d=t(908))},h=function(Z,he){return p(),Z=d.normalize(Z),r.readFileSync(Z,he?void 0:"utf8")},i=Z=>((Z=h(Z,!0)).buffer||(Z=new Uint8Array(Z)),Z),f=(Z,he,ve)=>{p(),Z=d.normalize(Z),r.readFile(Z,(function(Se,Re){Se?ve(Se):he(Re.buffer)}))},1<process.argv.length&&(y=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(Z){if(!(Z instanceof ne))throw Z})),process.on("unhandledRejection",(function(Z){throw Z})),v=(Z,he)=>{if(B||0<L)throw process.exitCode=Z,he;he instanceof ne||N("exiting due to exception: "+he),process.exit(Z)},l.inspect=function(){return"[Emscripten Module object]"}):(T||w)&&(w?P=self.location.href:typeof document<"u"&&document.currentScript&&(P=document.currentScript.src),s&&(P=s),P=P.indexOf("blob:")!==0?P.substr(0,P.replace(/[?#].*/,"").lastIndexOf("/")+1):"",h=Z=>{var he=new XMLHttpRequest;return he.open("GET",Z,!1),he.send(null),he.responseText},w&&(i=Z=>{var he=new XMLHttpRequest;return he.open("GET",Z,!1),he.responseType="arraybuffer",he.send(null),new Uint8Array(he.response)}),f=(Z,he,ve)=>{var Se=new XMLHttpRequest;Se.open("GET",Z,!0),Se.responseType="arraybuffer",Se.onload=()=>{Se.status==200||Se.status==0&&Se.response?he(Se.response):ve()},Se.onerror=ve,Se.send(null)});var R,I=l.print||console.log.bind(console),N=l.printErr||console.warn.bind(console);Object.assign(l,_),_=null,l.thisProgram&&(y=l.thisProgram),l.quit&&(v=l.quit),l.wasmBinary&&(R=l.wasmBinary);var B=l.noExitRuntime||!1;typeof WebAssembly!="object"&&z("no native wasm support detected");var D,Y,se,re,W,$,k=!1,H=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function de(Z,he,ve){var Se=(he>>>=0)+ve;for(ve=he;Z[ve]&&!(ve>=Se);)++ve;if(16<ve-he&&Z.buffer&&H)return H.decode(Z.subarray(he,ve));for(Se="";he<ve;){var Re=Z[he++];if(128&Re){var Oe=63&Z[he++];if((224&Re)==192)Se+=String.fromCharCode((31&Re)<<6|Oe);else{var $e=63&Z[he++];65536>(Re=(240&Re)==224?(15&Re)<<12|Oe<<6|$e:(7&Re)<<18|Oe<<12|$e<<6|63&Z[he++])?Se+=String.fromCharCode(Re):(Re-=65536,Se+=String.fromCharCode(55296|Re>>10,56320|1023&Re))}}else Se+=String.fromCharCode(Re)}return Se}function ee(Z,he){return(Z>>>=0)?de(re,Z,he):""}function ce(Z,he,ve,Se){if(!(0<Se))return 0;var Re=ve>>>=0;Se=ve+Se-1;for(var Oe=0;Oe<Z.length;++Oe){var $e=Z.charCodeAt(Oe);if(55296<=$e&&57343>=$e&&($e=65536+((1023&$e)<<10)|1023&Z.charCodeAt(++Oe)),127>=$e){if(ve>=Se)break;he[ve++>>>0]=$e}else{if(2047>=$e){if(ve+1>=Se)break;he[ve++>>>0]=192|$e>>6}else{if(65535>=$e){if(ve+2>=Se)break;he[ve++>>>0]=224|$e>>12}else{if(ve+3>=Se)break;he[ve++>>>0]=240|$e>>18,he[ve++>>>0]=128|$e>>12&63}he[ve++>>>0]=128|$e>>6&63}he[ve++>>>0]=128|63&$e}}return he[ve>>>0]=0,ve-Re}function q(Z){for(var he=0,ve=0;ve<Z.length;++ve){var Se=Z.charCodeAt(ve);127>=Se?he++:2047>=Se?he+=2:55296<=Se&&57343>=Se?(he+=4,++ve):he+=3}return he}function le(){var Z=D.buffer;Y=Z,l.HEAP8=se=new Int8Array(Z),l.HEAP16=new Int16Array(Z),l.HEAP32=W=new Int32Array(Z),l.HEAPU8=re=new Uint8Array(Z),l.HEAPU16=new Uint16Array(Z),l.HEAPU32=$=new Uint32Array(Z),l.HEAPF32=new Float32Array(Z),l.HEAPF64=new Float64Array(Z)}var be,xe=[],Ee=[],we=[],U=[],L=0;function M(){var Z=l.preRun.shift();xe.unshift(Z)}var C,V=0,O=null;function z(Z){throw l.onAbort&&l.onAbort(Z),N(Z="Aborted("+Z+")"),k=!0,Z=new WebAssembly.RuntimeError(Z+". Build with -sASSERTIONS for more info."),g(Z),Z}function j(){return C.startsWith("data:application/octet-stream;base64,")}if(C="ort-wasm.wasm",!j()){var J=C;C=l.locateFile?l.locateFile(J,P):P+J}function X(){var Z=C;try{if(Z==C&&R)return new Uint8Array(R);if(i)return i(Z);throw"both async and sync fetching of the wasm failed"}catch(he){z(he)}}function ne(Z){this.name="ExitStatus",this.message="Program terminated with exit("+Z+")",this.status=Z}function ie(Z){for(;0<Z.length;)Z.shift()(l)}var fe=[],ye=0,pe=0;function te(Z){this.Db=Z,this.zb=Z-24,this.Ub=function(he){$[this.zb+4>>2>>>0]=he},this.Eb=function(){return $[this.zb+4>>2>>>0]},this.Sb=function(he){$[this.zb+8>>2>>>0]=he},this.Wb=function(){return $[this.zb+8>>2>>>0]},this.Tb=function(){W[this.zb>>2>>>0]=0},this.Ib=function(he){se[this.zb+12>>0>>>0]=he?1:0},this.Pb=function(){return se[this.zb+12>>0>>>0]!=0},this.Jb=function(he){se[this.zb+13>>0>>>0]=he?1:0},this.Lb=function(){return se[this.zb+13>>0>>>0]!=0},this.Rb=function(he,ve){this.Fb(0),this.Ub(he),this.Sb(ve),this.Tb(),this.Ib(!1),this.Jb(!1)},this.Nb=function(){W[this.zb>>2>>>0]+=1},this.Xb=function(){var he=W[this.zb>>2>>>0];return W[this.zb>>2>>>0]=he-1,he===1},this.Fb=function(he){$[this.zb+16>>2>>>0]=he},this.Ob=function(){return $[this.zb+16>>2>>>0]},this.Qb=function(){if(xn(this.Eb()))return $[this.Db>>2>>>0];var he=this.Ob();return he!==0?he:this.Db}}function ue(Z){return At(new te(Z).zb)}var Ie=[];function ae(Z){var he=Ie[Z];return he||(Z>=Ie.length&&(Ie.length=Z+1),Ie[Z]=he=be.get(Z)),he}function De(Z){var he=q(Z)+1,ve=nt(he);return ve&&ce(Z,se,ve,he),ve}var ze={};function Ge(){if(!He){var Z,he={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:y||"./this.program"};for(Z in ze)ze[Z]===void 0?delete he[Z]:he[Z]=ze[Z];var ve=[];for(Z in he)ve.push(Z+"="+he[Z]);He=ve}return He}var He,Ye=[null,[],[]];function Xe(Z,he){var ve=Ye[Z];he===0||he===10?((Z===1?I:N)(de(ve,0)),ve.length=0):ve.push(he)}var it=0;function ut(Z){return Z%4==0&&(Z%100!=0||Z%400==0)}var qe=[31,29,31,30,31,30,31,31,30,31,30,31],Je=[31,28,31,30,31,30,31,31,30,31,30,31];function Pt(Z,he,ve,Se){function Re(ke,yt,Ct){for(ke=typeof ke=="number"?ke.toString():ke||"";ke.length<yt;)ke=Ct[0]+ke;return ke}function Oe(ke,yt){return Re(ke,yt,"0")}function $e(ke,yt){function Ct(Kn){return 0>Kn?-1:0<Kn?1:0}var ln;return(ln=Ct(ke.getFullYear()-yt.getFullYear()))===0&&(ln=Ct(ke.getMonth()-yt.getMonth()))===0&&(ln=Ct(ke.getDate()-yt.getDate())),ln}function Qe(ke){switch(ke.getDay()){case 0:return new Date(ke.getFullYear()-1,11,29);case 1:return ke;case 2:return new Date(ke.getFullYear(),0,3);case 3:return new Date(ke.getFullYear(),0,2);case 4:return new Date(ke.getFullYear(),0,1);case 5:return new Date(ke.getFullYear()-1,11,31);case 6:return new Date(ke.getFullYear()-1,11,30)}}function We(ke){var yt=ke.Bb;for(ke=new Date(new Date(ke.Cb+1900,0,1).getTime());0<yt;){var Ct=ke.getMonth(),ln=(ut(ke.getFullYear())?qe:Je)[Ct];if(!(yt>ln-ke.getDate())){ke.setDate(ke.getDate()+yt);break}yt-=ln-ke.getDate()+1,ke.setDate(1),11>Ct?ke.setMonth(Ct+1):(ke.setMonth(0),ke.setFullYear(ke.getFullYear()+1))}return Ct=new Date(ke.getFullYear()+1,0,4),yt=Qe(new Date(ke.getFullYear(),0,4)),Ct=Qe(Ct),0>=$e(yt,ke)?0>=$e(Ct,ke)?ke.getFullYear()+1:ke.getFullYear():ke.getFullYear()-1}var ct=W[Se+40>>2>>>0];for(var Et in Se={$b:W[Se>>2>>>0],Zb:W[Se+4>>2>>>0],Gb:W[Se+8>>2>>>0],Kb:W[Se+12>>2>>>0],Hb:W[Se+16>>2>>>0],Cb:W[Se+20>>2>>>0],Ab:W[Se+24>>2>>>0],Bb:W[Se+28>>2>>>0],bc:W[Se+32>>2>>>0],Yb:W[Se+36>>2>>>0],ac:ct?ee(ct):""},ve=ee(ve),ct={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})ve=ve.replace(new RegExp(Et,"g"),ct[Et]);var qt="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),_t="January February March April May June July August September October November December".split(" ");for(Et in ct={"%a":function(ke){return qt[ke.Ab].substring(0,3)},"%A":function(ke){return qt[ke.Ab]},"%b":function(ke){return _t[ke.Hb].substring(0,3)},"%B":function(ke){return _t[ke.Hb]},"%C":function(ke){return Oe((ke.Cb+1900)/100|0,2)},"%d":function(ke){return Oe(ke.Kb,2)},"%e":function(ke){return Re(ke.Kb,2," ")},"%g":function(ke){return We(ke).toString().substring(2)},"%G":function(ke){return We(ke)},"%H":function(ke){return Oe(ke.Gb,2)},"%I":function(ke){return(ke=ke.Gb)==0?ke=12:12<ke&&(ke-=12),Oe(ke,2)},"%j":function(ke){for(var yt=0,Ct=0;Ct<=ke.Hb-1;yt+=(ut(ke.Cb+1900)?qe:Je)[Ct++]);return Oe(ke.Kb+yt,3)},"%m":function(ke){return Oe(ke.Hb+1,2)},"%M":function(ke){return Oe(ke.Zb,2)},"%n":function(){return`
`},"%p":function(ke){return 0<=ke.Gb&&12>ke.Gb?"AM":"PM"},"%S":function(ke){return Oe(ke.$b,2)},"%t":function(){return"	"},"%u":function(ke){return ke.Ab||7},"%U":function(ke){return Oe(Math.floor((ke.Bb+7-ke.Ab)/7),2)},"%V":function(ke){var yt=Math.floor((ke.Bb+7-(ke.Ab+6)%7)/7);if(2>=(ke.Ab+371-ke.Bb-2)%7&&yt++,yt)yt==53&&((Ct=(ke.Ab+371-ke.Bb)%7)==4||Ct==3&&ut(ke.Cb)||(yt=1));else{yt=52;var Ct=(ke.Ab+7-ke.Bb-1)%7;(Ct==4||Ct==5&&ut(ke.Cb%400-1))&&yt++}return Oe(yt,2)},"%w":function(ke){return ke.Ab},"%W":function(ke){return Oe(Math.floor((ke.Bb+7-(ke.Ab+6)%7)/7),2)},"%y":function(ke){return(ke.Cb+1900).toString().substring(2)},"%Y":function(ke){return ke.Cb+1900},"%z":function(ke){var yt=0<=(ke=ke.Yb);return ke=Math.abs(ke)/60,(yt?"+":"-")+("0000"+(ke/60*100+ke%60)).slice(-4)},"%Z":function(ke){return ke.ac},"%%":function(){return"%"}},ve=ve.replace(/%%/g,"\0\0"),ct)ve.includes(Et)&&(ve=ve.replace(new RegExp(Et,"g"),ct[Et](Se)));return Et=(function(ke){var yt=Array(q(ke)+1);return ce(ke,yt,0,yt.length),yt})(ve=ve.replace(/\0\0/g,"%")),Et.length>he?0:(se.set(Et,Z>>>0),Et.length-1)}var zt={a:function(Z){return nt(Z+24)+24},m:function(Z){return(Z=new te(Z)).Pb()||(Z.Ib(!0),ye--),Z.Jb(!1),fe.push(Z),Z.Nb(),Z.Qb()},ia:function(Z){throw N("Unexpected exception thrown, this is not properly supported - aborting"),k=!0,Z},w:function(){et(0);var Z=fe.pop();if(Z.Xb()&&!Z.Lb()){var he=Z.Wb();he&&ae(he)(Z.Db),ue(Z.Db)}pe=0},d:function(){var Z=pe;if(!Z)return it=0;var he=new te(Z);he.Fb(Z);var ve=he.Eb();if(!ve)return it=0,Z;for(var Se=Array.prototype.slice.call(arguments),Re=0;Re<Se.length;Re++){var Oe=Se[Re];if(Oe===0||Oe===ve)break;if(Dt(Oe,ve,he.zb+16))return it=Oe,Z}return it=ve,Z},k:function(){var Z=pe;if(!Z)return it=0;var he=new te(Z);he.Fb(Z);var ve=he.Eb();if(!ve)return it=0,Z;for(var Se=Array.prototype.slice.call(arguments),Re=0;Re<Se.length;Re++){var Oe=Se[Re];if(Oe===0||Oe===ve)break;if(Dt(Oe,ve,he.zb+16))return it=Oe,Z}return it=ve,Z},g:function(){var Z=pe;if(!Z)return it=0;var he=new te(Z);he.Fb(Z);var ve=he.Eb();if(!ve)return it=0,Z;for(var Se=Array.prototype.slice.call(arguments),Re=0;Re<Se.length;Re++){var Oe=Se[Re];if(Oe===0||Oe===ve)break;if(Dt(Oe,ve,he.zb+16))return it=Oe,Z}return it=ve,Z},s:ue,L:function(){var Z=fe.pop();Z||z("no exception to throw");var he=Z.Db;throw Z.Lb()||(fe.push(Z),Z.Jb(!0),Z.Ib(!1),ye++),pe=he,he},b:function(Z,he,ve){throw new te(Z).Rb(he,ve),pe=Z,ye++,Z},la:function(){return ye},i:function(Z){throw pe||(pe=Z),Z},H:function(){return 0},Ba:function(){},pa:function(){},ra:function(){},ka:function(){return 0},za:function(){},ua:function(){},ya:function(){},R:function(){},qa:function(){},na:function(){},Aa:function(){},oa:function(){},Ha:function(){},Ja:function(){z("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ia:function(){z("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},S:function(){return Date.now()},Ca:function(){return!0},Da:function(Z,he){Z=new Date(1e3*($[Z>>>2]+4294967296*W[Z+4>>>2])),W[he>>2>>>0]=Z.getUTCSeconds(),W[he+4>>2>>>0]=Z.getUTCMinutes(),W[he+8>>2>>>0]=Z.getUTCHours(),W[he+12>>2>>>0]=Z.getUTCDate(),W[he+16>>2>>>0]=Z.getUTCMonth(),W[he+20>>2>>>0]=Z.getUTCFullYear()-1900,W[he+24>>2>>>0]=Z.getUTCDay(),W[he+28>>2>>>0]=(Z.getTime()-Date.UTC(Z.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},Ea:function(Z,he){Z=new Date(1e3*($[Z>>>2]+4294967296*W[Z+4>>>2])),W[he>>2>>>0]=Z.getSeconds(),W[he+4>>2>>>0]=Z.getMinutes(),W[he+8>>2>>>0]=Z.getHours(),W[he+12>>2>>>0]=Z.getDate(),W[he+16>>2>>>0]=Z.getMonth(),W[he+20>>2>>>0]=Z.getFullYear()-1900,W[he+24>>2>>>0]=Z.getDay();var ve=new Date(Z.getFullYear(),0,1);W[he+28>>2>>>0]=(Z.getTime()-ve.getTime())/864e5|0,W[he+36>>2>>>0]=-60*Z.getTimezoneOffset();var Se=new Date(Z.getFullYear(),6,1).getTimezoneOffset();ve=ve.getTimezoneOffset(),W[he+32>>2>>>0]=0|(Se!=ve&&Z.getTimezoneOffset()==Math.min(ve,Se))},Fa:function(Z){var he=new Date(W[Z+20>>2>>>0]+1900,W[Z+16>>2>>>0],W[Z+12>>2>>>0],W[Z+8>>2>>>0],W[Z+4>>2>>>0],W[Z>>2>>>0],0),ve=W[Z+32>>2>>>0],Se=he.getTimezoneOffset(),Re=new Date(he.getFullYear(),0,1),Oe=new Date(he.getFullYear(),6,1).getTimezoneOffset(),$e=Re.getTimezoneOffset(),Qe=Math.min($e,Oe);return 0>ve?W[Z+32>>2>>>0]=+(Oe!=$e&&Qe==Se):0<ve!=(Qe==Se)&&(Oe=Math.max($e,Oe),he.setTime(he.getTime()+6e4*((0<ve?Qe:Oe)-Se))),W[Z+24>>2>>>0]=he.getDay(),W[Z+28>>2>>>0]=(he.getTime()-Re.getTime())/864e5|0,W[Z>>2>>>0]=he.getSeconds(),W[Z+4>>2>>>0]=he.getMinutes(),W[Z+8>>2>>>0]=he.getHours(),W[Z+12>>2>>>0]=he.getDate(),W[Z+16>>2>>>0]=he.getMonth(),he.getTime()/1e3|0},sa:function(){return-52},ta:function(){},Ga:function Z(he,ve,Se){Z.Vb||(Z.Vb=!0,(function(Re,Oe,$e){function Qe(_t){return(_t=_t.toTimeString().match(/\(([A-Za-z ]+)\)$/))?_t[1]:"GMT"}var We=new Date().getFullYear(),ct=new Date(We,0,1),Et=new Date(We,6,1);We=ct.getTimezoneOffset();var qt=Et.getTimezoneOffset();W[Re>>2>>>0]=60*Math.max(We,qt),W[Oe>>2>>>0]=+(We!=qt),Re=Qe(ct),Oe=Qe(Et),Re=De(Re),Oe=De(Oe),qt<We?($[$e>>2>>>0]=Re,$[$e+4>>2>>>0]=Oe):($[$e>>2>>>0]=Oe,$[$e+4>>2>>>0]=Re)})(he,ve,Se))},B:function(){z("")},ma:function(){return 4294901760},I:E?()=>{var Z=process.hrtime();return 1e3*Z[0]+Z[1]/1e6}:()=>performance.now(),xa:function(Z,he,ve){re.copyWithin(Z>>>0,he>>>0,he+ve>>>0)},G:function(Z){var he=re.length;if(4294901760<(Z>>>=0))return!1;for(var ve=1;4>=ve;ve*=2){var Se=he*(1+.2/ve);Se=Math.min(Se,Z+100663296);var Re=Math;Se=Math.max(Z,Se),Re=Re.min.call(Re,4294901760,Se+(65536-Se%65536)%65536);e:{try{D.grow(Re-Y.byteLength+65535>>>16),le();var Oe=1;break e}catch{}Oe=void 0}if(Oe)return!0}return!1},va:function(Z,he){var ve=0;return Ge().forEach((function(Se,Re){var Oe=he+ve;for(Re=$[Z+4*Re>>2>>>0]=Oe,Oe=0;Oe<Se.length;++Oe)se[Re++>>0>>>0]=Se.charCodeAt(Oe);se[Re>>0>>>0]=0,ve+=Se.length+1})),0},wa:function(Z,he){var ve=Ge();$[Z>>2>>>0]=ve.length;var Se=0;return ve.forEach((function(Re){Se+=Re.length+1})),$[he>>2>>>0]=Se,0},ba:function(Z){B||0<L||($t(),ie(we),Mt(0),Ye[1].length&&Xe(1,10),Ye[2].length&&Xe(2,10)),B||0<L||(l.onExit&&l.onExit(Z),k=!0),v(Z,new ne(Z))},E:function(){return 52},Q:function(){return 52},ca:function(){return 70},P:function(Z,he,ve,Se){for(var Re=0,Oe=0;Oe<ve;Oe++){var $e=$[he>>2>>>0],Qe=$[he+4>>2>>>0];he+=8;for(var We=0;We<Qe;We++)Xe(Z,re[$e+We>>>0]);Re+=Qe}return $[Se>>2>>>0]=Re,0},c:function(){return it},ja:function Z(he,ve){Z.Mb||(Z.Mb=(function(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var Re=new Uint8Array(1);return()=>(crypto.getRandomValues(Re),Re[0])}if(E)try{var Oe=t(Object((function(){var $e=new Error("Cannot find module 'crypto'");throw $e.code="MODULE_NOT_FOUND",$e})()));return()=>Oe.randomBytes(1)[0]}catch{}return()=>z("randomDevice")})());for(var Se=0;Se<ve;Se++)se[he+Se>>0>>>0]=Z.Mb();return 0},ea:function(Z,he,ve){var Se=rt();try{return ae(Z)(he,ve)}catch(Re){if(st(Se),Re!==Re+0)throw Re;et(1,0)}},fa:function(Z,he,ve){var Se=rt();try{return ae(Z)(he,ve)}catch(Re){if(st(Se),Re!==Re+0)throw Re;et(1,0)}},J:function(Z){var he=rt();try{return ae(Z)()}catch(ve){if(st(he),ve!==ve+0)throw ve;et(1,0)}},e:function(Z,he){var ve=rt();try{return ae(Z)(he)}catch(Se){if(st(ve),Se!==Se+0)throw Se;et(1,0)}},N:function(Z,he,ve){var Se=rt();try{return ae(Z)(he,ve)}catch(Re){if(st(Se),Re!==Re+0)throw Re;et(1,0)}},O:function(Z,he,ve){var Se=rt();try{return ae(Z)(he,ve)}catch(Re){if(st(Se),Re!==Re+0)throw Re;et(1,0)}},j:function(Z,he,ve){var Se=rt();try{return ae(Z)(he,ve)}catch(Re){if(st(Se),Re!==Re+0)throw Re;et(1,0)}},o:function(Z,he,ve,Se){var Re=rt();try{return ae(Z)(he,ve,Se)}catch(Oe){if(st(Re),Oe!==Oe+0)throw Oe;et(1,0)}},p:function(Z,he,ve,Se,Re){var Oe=rt();try{return ae(Z)(he,ve,Se,Re)}catch($e){if(st(Oe),$e!==$e+0)throw $e;et(1,0)}},M:function(Z,he,ve,Se,Re,Oe){var $e=rt();try{return ae(Z)(he,ve,Se,Re,Oe)}catch(Qe){if(st($e),Qe!==Qe+0)throw Qe;et(1,0)}},r:function(Z,he,ve,Se,Re,Oe){var $e=rt();try{return ae(Z)(he,ve,Se,Re,Oe)}catch(Qe){if(st($e),Qe!==Qe+0)throw Qe;et(1,0)}},v:function(Z,he,ve,Se,Re,Oe,$e){var Qe=rt();try{return ae(Z)(he,ve,Se,Re,Oe,$e)}catch(We){if(st(Qe),We!==We+0)throw We;et(1,0)}},K:function(Z,he,ve,Se,Re,Oe,$e,Qe){var We=rt();try{return ae(Z)(he,ve,Se,Re,Oe,$e,Qe)}catch(ct){if(st(We),ct!==ct+0)throw ct;et(1,0)}},D:function(Z,he,ve,Se,Re,Oe,$e,Qe,We,ct,Et,qt){var _t=rt();try{return ae(Z)(he,ve,Se,Re,Oe,$e,Qe,We,ct,Et,qt)}catch(ke){if(st(_t),ke!==ke+0)throw ke;et(1,0)}},X:function(Z,he,ve,Se,Re,Oe,$e,Qe){var We=rt();try{return Cr(Z,he,ve,Se,Re,Oe,$e,Qe)}catch(ct){if(st(We),ct!==ct+0)throw ct;et(1,0)}},V:function(Z,he,ve,Se,Re,Oe,$e){var Qe=rt();try{return Tn(Z,he,ve,Se,Re,Oe,$e)}catch(We){if(st(Qe),We!==We+0)throw We;et(1,0)}},U:function(Z,he,ve,Se,Re){var Oe=rt();try{return En(Z,he,ve,Se,Re)}catch($e){if(st(Oe),$e!==$e+0)throw $e;et(1,0)}},Z:function(Z,he,ve,Se){var Re=rt();try{return ir(Z,he,ve,Se)}catch(Oe){if(st(Re),Oe!==Oe+0)throw Oe;et(1,0)}},W:function(Z){var he=rt();try{return on(Z)}catch(ve){if(st(he),ve!==ve+0)throw ve;et(1,0)}},Y:function(Z,he){var ve=rt();try{return Ar(Z,he)}catch(Se){if(st(ve),Se!==Se+0)throw Se;et(1,0)}},T:function(Z,he,ve){var Se=rt();try{return Vt(Z,he,ve)}catch(Re){if(st(Se),Re!==Re+0)throw Re;et(1,0)}},f:function(Z){var he=rt();try{ae(Z)()}catch(ve){if(st(he),ve!==ve+0)throw ve;et(1,0)}},q:function(Z,he){var ve=rt();try{ae(Z)(he)}catch(Se){if(st(ve),Se!==Se+0)throw Se;et(1,0)}},h:function(Z,he,ve){var Se=rt();try{ae(Z)(he,ve)}catch(Re){if(st(Se),Re!==Re+0)throw Re;et(1,0)}},da:function(Z,he,ve,Se){var Re=rt();try{ae(Z)(he,ve,Se)}catch(Oe){if(st(Re),Oe!==Oe+0)throw Oe;et(1,0)}},l:function(Z,he,ve,Se){var Re=rt();try{ae(Z)(he,ve,Se)}catch(Oe){if(st(Re),Oe!==Oe+0)throw Oe;et(1,0)}},t:function(Z,he,ve,Se,Re){var Oe=rt();try{ae(Z)(he,ve,Se,Re)}catch($e){if(st(Oe),$e!==$e+0)throw $e;et(1,0)}},u:function(Z,he,ve,Se,Re,Oe){var $e=rt();try{ae(Z)(he,ve,Se,Re,Oe)}catch(Qe){if(st($e),Qe!==Qe+0)throw Qe;et(1,0)}},x:function(Z,he,ve,Se,Re,Oe,$e){var Qe=rt();try{ae(Z)(he,ve,Se,Re,Oe,$e)}catch(We){if(st(Qe),We!==We+0)throw We;et(1,0)}},z:function(Z,he,ve,Se,Re,Oe,$e,Qe){var We=rt();try{ae(Z)(he,ve,Se,Re,Oe,$e,Qe)}catch(ct){if(st(We),ct!==ct+0)throw ct;et(1,0)}},ga:function(Z,he,ve,Se,Re,Oe,$e,Qe,We){var ct=rt();try{ae(Z)(he,ve,Se,Re,Oe,$e,Qe,We)}catch(Et){if(st(ct),Et!==Et+0)throw Et;et(1,0)}},A:function(Z,he,ve,Se,Re,Oe,$e,Qe,We,ct,Et){var qt=rt();try{ae(Z)(he,ve,Se,Re,Oe,$e,Qe,We,ct,Et)}catch(_t){if(st(qt),_t!==_t+0)throw _t;et(1,0)}},C:function(Z,he,ve,Se,Re,Oe,$e,Qe,We,ct,Et,qt,_t,ke,yt,Ct){var ln=rt();try{ae(Z)(he,ve,Se,Re,Oe,$e,Qe,We,ct,Et,qt,_t,ke,yt,Ct)}catch(Kn){if(st(ln),Kn!==Kn+0)throw Kn;et(1,0)}},aa:function(Z,he,ve,Se,Re,Oe,$e,Qe){var We=rt();try{wn(Z,he,ve,Se,Re,Oe,$e,Qe)}catch(ct){if(st(We),ct!==ct+0)throw ct;et(1,0)}},_:function(Z,he,ve,Se,Re,Oe,$e,Qe,We,ct,Et,qt){var _t=rt();try{gn(Z,he,ve,Se,Re,Oe,$e,Qe,We,ct,Et,qt)}catch(ke){if(st(_t),ke!==ke+0)throw ke;et(1,0)}},$:function(Z,he,ve,Se,Re,Oe){var $e=rt();try{Fn(Z,he,ve,Se,Re,Oe)}catch(Qe){if(st($e),Qe!==Qe+0)throw Qe;et(1,0)}},n:function(Z){return Z},F:function(Z){it=Z},ha:Pt,y:function(Z,he,ve,Se){return Pt(Z,he,ve,Se)}};(function(){function Z(Re){l.asm=Re.exports,D=l.asm.Ka,le(),be=l.asm.ib,Ee.unshift(l.asm.La),V--,l.monitorRunDependencies&&l.monitorRunDependencies(V),V==0&&O&&(Re=O,O=null,Re())}function he(Re){Z(Re.instance)}function ve(Re){return(function(){if(!R&&(T||w)){if(typeof fetch=="function"&&!C.startsWith("file://"))return fetch(C,{credentials:"same-origin"}).then((function(Oe){if(!Oe.ok)throw"failed to load wasm binary file at '"+C+"'";return Oe.arrayBuffer()})).catch((function(){return X()}));if(f)return new Promise((function(Oe,$e){f(C,(function(Qe){Oe(new Uint8Array(Qe))}),$e)}))}return Promise.resolve().then((function(){return X()}))})().then((function(Oe){return WebAssembly.instantiate(Oe,Se)})).then((function(Oe){return Oe})).then(Re,(function(Oe){N("failed to asynchronously prepare wasm: "+Oe),z(Oe)}))}var Se={a:zt};if(V++,l.monitorRunDependencies&&l.monitorRunDependencies(V),l.instantiateWasm)try{return l.instantiateWasm(Se,Z)}catch(Re){return N("Module.instantiateWasm callback failed with error: "+Re),!1}(R||typeof WebAssembly.instantiateStreaming!="function"||j()||C.startsWith("file://")||E||typeof fetch!="function"?ve(he):fetch(C,{credentials:"same-origin"}).then((function(Re){return WebAssembly.instantiateStreaming(Re,Se).then(he,(function(Oe){return N("wasm streaming compile failed: "+Oe),N("falling back to ArrayBuffer instantiation"),ve(he)}))}))).catch(g)})(),l.___wasm_call_ctors=function(){return(l.___wasm_call_ctors=l.asm.La).apply(null,arguments)},l._OrtInit=function(){return(l._OrtInit=l.asm.Ma).apply(null,arguments)},l._OrtCreateSessionOptions=function(){return(l._OrtCreateSessionOptions=l.asm.Na).apply(null,arguments)},l._OrtAppendExecutionProvider=function(){return(l._OrtAppendExecutionProvider=l.asm.Oa).apply(null,arguments)},l._OrtAddSessionConfigEntry=function(){return(l._OrtAddSessionConfigEntry=l.asm.Pa).apply(null,arguments)},l._OrtReleaseSessionOptions=function(){return(l._OrtReleaseSessionOptions=l.asm.Qa).apply(null,arguments)},l._OrtCreateSession=function(){return(l._OrtCreateSession=l.asm.Ra).apply(null,arguments)},l._OrtReleaseSession=function(){return(l._OrtReleaseSession=l.asm.Sa).apply(null,arguments)},l._OrtGetInputCount=function(){return(l._OrtGetInputCount=l.asm.Ta).apply(null,arguments)},l._OrtGetOutputCount=function(){return(l._OrtGetOutputCount=l.asm.Ua).apply(null,arguments)},l._OrtGetInputName=function(){return(l._OrtGetInputName=l.asm.Va).apply(null,arguments)},l._OrtGetOutputName=function(){return(l._OrtGetOutputName=l.asm.Wa).apply(null,arguments)},l._OrtFree=function(){return(l._OrtFree=l.asm.Xa).apply(null,arguments)},l._OrtCreateTensor=function(){return(l._OrtCreateTensor=l.asm.Ya).apply(null,arguments)},l._OrtGetTensorData=function(){return(l._OrtGetTensorData=l.asm.Za).apply(null,arguments)},l._OrtReleaseTensor=function(){return(l._OrtReleaseTensor=l.asm._a).apply(null,arguments)},l._OrtCreateRunOptions=function(){return(l._OrtCreateRunOptions=l.asm.$a).apply(null,arguments)},l._OrtAddRunConfigEntry=function(){return(l._OrtAddRunConfigEntry=l.asm.ab).apply(null,arguments)},l._OrtReleaseRunOptions=function(){return(l._OrtReleaseRunOptions=l.asm.bb).apply(null,arguments)},l._OrtRun=function(){return(l._OrtRun=l.asm.cb).apply(null,arguments)},l._OrtEndProfiling=function(){return(l._OrtEndProfiling=l.asm.db).apply(null,arguments)};var Gt,nt=l._malloc=function(){return(nt=l._malloc=l.asm.eb).apply(null,arguments)},At=l._free=function(){return(At=l._free=l.asm.fb).apply(null,arguments)},Mt=l._fflush=function(){return(Mt=l._fflush=l.asm.gb).apply(null,arguments)},$t=l.___funcs_on_exit=function(){return($t=l.___funcs_on_exit=l.asm.hb).apply(null,arguments)},et=l._setThrew=function(){return(et=l._setThrew=l.asm.jb).apply(null,arguments)},rt=l.stackSave=function(){return(rt=l.stackSave=l.asm.kb).apply(null,arguments)},st=l.stackRestore=function(){return(st=l.stackRestore=l.asm.lb).apply(null,arguments)},Jt=l.stackAlloc=function(){return(Jt=l.stackAlloc=l.asm.mb).apply(null,arguments)},Dt=l.___cxa_can_catch=function(){return(Dt=l.___cxa_can_catch=l.asm.nb).apply(null,arguments)},xn=l.___cxa_is_pointer_type=function(){return(xn=l.___cxa_is_pointer_type=l.asm.ob).apply(null,arguments)},on=l.dynCall_j=function(){return(on=l.dynCall_j=l.asm.pb).apply(null,arguments)},Tn=l.dynCall_iiiiij=function(){return(Tn=l.dynCall_iiiiij=l.asm.qb).apply(null,arguments)},Vt=l.dynCall_jii=function(){return(Vt=l.dynCall_jii=l.asm.rb).apply(null,arguments)},wn=l.dynCall_viiiiij=function(){return(wn=l.dynCall_viiiiij=l.asm.sb).apply(null,arguments)},Fn=l.dynCall_vjji=function(){return(Fn=l.dynCall_vjji=l.asm.tb).apply(null,arguments)},gn=l.dynCall_viiijjjii=function(){return(gn=l.dynCall_viiijjjii=l.asm.ub).apply(null,arguments)},ir=l.dynCall_iij=function(){return(ir=l.dynCall_iij=l.asm.vb).apply(null,arguments)},Ar=l.dynCall_ji=function(){return(Ar=l.dynCall_ji=l.asm.wb).apply(null,arguments)},Cr=l.dynCall_iiiiiij=function(){return(Cr=l.dynCall_iiiiiij=l.asm.xb).apply(null,arguments)},En=l.dynCall_iiij=function(){return(En=l.dynCall_iiij=l.asm.yb).apply(null,arguments)};function Kt(){function Z(){if(!Gt&&(Gt=!0,l.calledRun=!0,!k)){if(ie(Ee),m(l),l.onRuntimeInitialized&&l.onRuntimeInitialized(),l.postRun)for(typeof l.postRun=="function"&&(l.postRun=[l.postRun]);l.postRun.length;){var he=l.postRun.shift();U.unshift(he)}ie(U)}}if(!(0<V)){if(l.preRun)for(typeof l.preRun=="function"&&(l.preRun=[l.preRun]);l.preRun.length;)M();ie(xe),0<V||(l.setStatus?(l.setStatus("Running..."),setTimeout((function(){setTimeout((function(){l.setStatus("")}),1),Z()}),1)):Z())}}if(l.UTF8ToString=ee,l.stringToUTF8=function(Z,he,ve){return ce(Z,re,he,ve)},l.lengthBytesUTF8=q,l.stackSave=rt,l.stackRestore=st,l.stackAlloc=Jt,O=function Z(){Gt||Kt(),Gt||(O=Z)},l.preInit)for(typeof l.preInit=="function"&&(l.preInit=[l.preInit]);0<l.preInit.length;)l.preInit.pop()();return Kt(),u.ready});n.exports=o},4537:n=>{n.exports=function(e,t){for(var s=new Array(arguments.length-1),o=0,u=2,l=!0;u<arguments.length;)s[o++]=arguments[u++];return new Promise((function(m,g){s[o]=function(h){if(l)if(l=!1,h)g(h);else{for(var f=new Array(arguments.length-1),i=0;i<f.length;)f[i++]=arguments[i];m.apply(null,f)}};try{e.apply(t||null,s)}catch(h){l&&(l=!1,g(h))}}))}},7419:(n,e)=>{var t=e;t.length=function(m){var g=m.length;if(!g)return 0;for(var h=0;--g%4>1&&m.charAt(g)==="=";)++h;return Math.ceil(3*m.length)/4-h};for(var s=new Array(64),o=new Array(123),u=0;u<64;)o[s[u]=u<26?u+65:u<52?u+71:u<62?u-4:u-59|43]=u++;t.encode=function(m,g,h){for(var f,i=null,r=[],d=0,p=0;g<h;){var _=m[g++];switch(p){case 0:r[d++]=s[_>>2],f=(3&_)<<4,p=1;break;case 1:r[d++]=s[f|_>>4],f=(15&_)<<2,p=2;break;case 2:r[d++]=s[f|_>>6],r[d++]=s[63&_],p=0}d>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,r)),d=0)}return p&&(r[d++]=s[f],r[d++]=61,p===1&&(r[d++]=61)),i?(d&&i.push(String.fromCharCode.apply(String,r.slice(0,d))),i.join("")):String.fromCharCode.apply(String,r.slice(0,d))};var l="invalid encoding";t.decode=function(m,g,h){for(var f,i=h,r=0,d=0;d<m.length;){var p=m.charCodeAt(d++);if(p===61&&r>1)break;if((p=o[p])===void 0)throw Error(l);switch(r){case 0:f=p,r=1;break;case 1:g[h++]=f<<2|(48&p)>>4,f=p,r=2;break;case 2:g[h++]=(15&f)<<4|(60&p)>>2,f=p,r=3;break;case 3:g[h++]=(3&f)<<6|p,r=0}}if(r===1)throw Error(l);return h-i},t.test=function(m){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(m)}},9211:n=>{function e(){this._listeners={}}n.exports=e,e.prototype.on=function(t,s,o){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:s,ctx:o||this}),this},e.prototype.off=function(t,s){if(t===void 0)this._listeners={};else if(s===void 0)this._listeners[t]=[];else for(var o=this._listeners[t],u=0;u<o.length;)o[u].fn===s?o.splice(u,1):++u;return this},e.prototype.emit=function(t){var s=this._listeners[t];if(s){for(var o=[],u=1;u<arguments.length;)o.push(arguments[u++]);for(u=0;u<s.length;)s[u].fn.apply(s[u++].ctx,o)}return this}},945:n=>{function e(l){return typeof Float32Array<"u"?(function(){var m=new Float32Array([-0]),g=new Uint8Array(m.buffer),h=g[3]===128;function f(p,_,y){m[0]=p,_[y]=g[0],_[y+1]=g[1],_[y+2]=g[2],_[y+3]=g[3]}function i(p,_,y){m[0]=p,_[y]=g[3],_[y+1]=g[2],_[y+2]=g[1],_[y+3]=g[0]}function r(p,_){return g[0]=p[_],g[1]=p[_+1],g[2]=p[_+2],g[3]=p[_+3],m[0]}function d(p,_){return g[3]=p[_],g[2]=p[_+1],g[1]=p[_+2],g[0]=p[_+3],m[0]}l.writeFloatLE=h?f:i,l.writeFloatBE=h?i:f,l.readFloatLE=h?r:d,l.readFloatBE=h?d:r})():(function(){function m(h,f,i,r){var d=f<0?1:0;if(d&&(f=-f),f===0)h(1/f>0?0:2147483648,i,r);else if(isNaN(f))h(2143289344,i,r);else if(f>34028234663852886e22)h((d<<31|2139095040)>>>0,i,r);else if(f<11754943508222875e-54)h((d<<31|Math.round(f/1401298464324817e-60))>>>0,i,r);else{var p=Math.floor(Math.log(f)/Math.LN2);h((d<<31|p+127<<23|8388607&Math.round(f*Math.pow(2,-p)*8388608))>>>0,i,r)}}function g(h,f,i){var r=h(f,i),d=2*(r>>31)+1,p=r>>>23&255,_=8388607&r;return p===255?_?NaN:d*(1/0):p===0?1401298464324817e-60*d*_:d*Math.pow(2,p-150)*(_+8388608)}l.writeFloatLE=m.bind(null,t),l.writeFloatBE=m.bind(null,s),l.readFloatLE=g.bind(null,o),l.readFloatBE=g.bind(null,u)})(),typeof Float64Array<"u"?(function(){var m=new Float64Array([-0]),g=new Uint8Array(m.buffer),h=g[7]===128;function f(p,_,y){m[0]=p,_[y]=g[0],_[y+1]=g[1],_[y+2]=g[2],_[y+3]=g[3],_[y+4]=g[4],_[y+5]=g[5],_[y+6]=g[6],_[y+7]=g[7]}function i(p,_,y){m[0]=p,_[y]=g[7],_[y+1]=g[6],_[y+2]=g[5],_[y+3]=g[4],_[y+4]=g[3],_[y+5]=g[2],_[y+6]=g[1],_[y+7]=g[0]}function r(p,_){return g[0]=p[_],g[1]=p[_+1],g[2]=p[_+2],g[3]=p[_+3],g[4]=p[_+4],g[5]=p[_+5],g[6]=p[_+6],g[7]=p[_+7],m[0]}function d(p,_){return g[7]=p[_],g[6]=p[_+1],g[5]=p[_+2],g[4]=p[_+3],g[3]=p[_+4],g[2]=p[_+5],g[1]=p[_+6],g[0]=p[_+7],m[0]}l.writeDoubleLE=h?f:i,l.writeDoubleBE=h?i:f,l.readDoubleLE=h?r:d,l.readDoubleBE=h?d:r})():(function(){function m(h,f,i,r,d,p){var _=r<0?1:0;if(_&&(r=-r),r===0)h(0,d,p+f),h(1/r>0?0:2147483648,d,p+i);else if(isNaN(r))h(0,d,p+f),h(2146959360,d,p+i);else if(r>17976931348623157e292)h(0,d,p+f),h((_<<31|2146435072)>>>0,d,p+i);else{var y;if(r<22250738585072014e-324)h((y=r/5e-324)>>>0,d,p+f),h((_<<31|y/4294967296)>>>0,d,p+i);else{var v=Math.floor(Math.log(r)/Math.LN2);v===1024&&(v=1023),h(4503599627370496*(y=r*Math.pow(2,-v))>>>0,d,p+f),h((_<<31|v+1023<<20|1048576*y&1048575)>>>0,d,p+i)}}}function g(h,f,i,r,d){var p=h(r,d+f),_=h(r,d+i),y=2*(_>>31)+1,v=_>>>20&2047,T=4294967296*(1048575&_)+p;return v===2047?T?NaN:y*(1/0):v===0?5e-324*y*T:y*Math.pow(2,v-1075)*(T+4503599627370496)}l.writeDoubleLE=m.bind(null,t,0,4),l.writeDoubleBE=m.bind(null,s,4,0),l.readDoubleLE=g.bind(null,o,0,4),l.readDoubleBE=g.bind(null,u,4,0)})(),l}function t(l,m,g){m[g]=255&l,m[g+1]=l>>>8&255,m[g+2]=l>>>16&255,m[g+3]=l>>>24}function s(l,m,g){m[g]=l>>>24,m[g+1]=l>>>16&255,m[g+2]=l>>>8&255,m[g+3]=255&l}function o(l,m){return(l[m]|l[m+1]<<8|l[m+2]<<16|l[m+3]<<24)>>>0}function u(l,m){return(l[m]<<24|l[m+1]<<16|l[m+2]<<8|l[m+3])>>>0}n.exports=e(e)},7199:module=>{function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}module.exports=inquire},6662:n=>{n.exports=function(e,t,s){var o=s||8192,u=o>>>1,l=null,m=o;return function(g){if(g<1||g>u)return e(g);m+g>o&&(l=e(o),m=0);var h=t.call(l,m,m+=g);return 7&m&&(m=1+(7|m)),h}}},4997:(n,e)=>{var t=e;t.length=function(s){for(var o=0,u=0,l=0;l<s.length;++l)(u=s.charCodeAt(l))<128?o+=1:u<2048?o+=2:(64512&u)==55296&&(64512&s.charCodeAt(l+1))==56320?(++l,o+=4):o+=3;return o},t.read=function(s,o,u){if(u-o<1)return"";for(var l,m=null,g=[],h=0;o<u;)(l=s[o++])<128?g[h++]=l:l>191&&l<224?g[h++]=(31&l)<<6|63&s[o++]:l>239&&l<365?(l=((7&l)<<18|(63&s[o++])<<12|(63&s[o++])<<6|63&s[o++])-65536,g[h++]=55296+(l>>10),g[h++]=56320+(1023&l)):g[h++]=(15&l)<<12|(63&s[o++])<<6|63&s[o++],h>8191&&((m||(m=[])).push(String.fromCharCode.apply(String,g)),h=0);return m?(h&&m.push(String.fromCharCode.apply(String,g.slice(0,h))),m.join("")):String.fromCharCode.apply(String,g.slice(0,h))},t.write=function(s,o,u){for(var l,m,g=u,h=0;h<s.length;++h)(l=s.charCodeAt(h))<128?o[u++]=l:l<2048?(o[u++]=l>>6|192,o[u++]=63&l|128):(64512&l)==55296&&(64512&(m=s.charCodeAt(h+1)))==56320?(l=65536+((1023&l)<<10)+(1023&m),++h,o[u++]=l>>18|240,o[u++]=l>>12&63|128,o[u++]=l>>6&63|128,o[u++]=63&l|128):(o[u++]=l>>12|224,o[u++]=l>>6&63|128,o[u++]=63&l|128);return u-g}},3442:(n,e)=>{e.__esModule=!0;var t=(function(){function s(o){if(!o)throw new TypeError("Invalid argument; `value` has no value.");this.value=s.EMPTY,o&&s.isGuid(o)&&(this.value=o)}return s.isGuid=function(o){var u=o.toString();return o&&(o instanceof s||s.validator.test(u))},s.create=function(){return new s([s.gen(2),s.gen(1),s.gen(1),s.gen(1),s.gen(3)].join("-"))},s.createEmpty=function(){return new s("emptyguid")},s.parse=function(o){return new s(o)},s.raw=function(){return[s.gen(2),s.gen(1),s.gen(1),s.gen(1),s.gen(3)].join("-")},s.gen=function(o){for(var u="",l=0;l<o;l++)u+=(65536*(1+Math.random())|0).toString(16).substring(1);return u},s.prototype.equals=function(o){return s.isGuid(o)&&this.value===o.toString()},s.prototype.isEmpty=function(){return this.value===s.EMPTY},s.prototype.toString=function(){return this.value},s.prototype.toJSON=function(){return{value:this.value}},s.validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),s.EMPTY="00000000-0000-0000-0000-000000000000",s})();e.Guid=t},3720:n=>{n.exports=t;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(B,D,Y){this.low=0|B,this.high=0|D,this.unsigned=!!Y}function s(B){return(B&&B.__isLong__)===!0}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0}),t.isLong=s;var o={},u={};function l(B,D){var Y,se,re;return D?(re=0<=(B>>>=0)&&B<256)&&(se=u[B])?se:(Y=g(B,(0|B)<0?-1:0,!0),re&&(u[B]=Y),Y):(re=-128<=(B|=0)&&B<128)&&(se=o[B])?se:(Y=g(B,B<0?-1:0,!1),re&&(o[B]=Y),Y)}function m(B,D){if(isNaN(B))return D?v:y;if(D){if(B<0)return v;if(B>=d)return R}else{if(B<=-p)return I;if(B+1>=p)return P}return B<0?m(-B,D).neg():g(B%r|0,B/r|0,D)}function g(B,D,Y){return new t(B,D,Y)}t.fromInt=l,t.fromNumber=m,t.fromBits=g;var h=Math.pow;function f(B,D,Y){if(B.length===0)throw Error("empty string");if(B==="NaN"||B==="Infinity"||B==="+Infinity"||B==="-Infinity")return y;if(typeof D=="number"?(Y=D,D=!1):D=!!D,(Y=Y||10)<2||36<Y)throw RangeError("radix");var se;if((se=B.indexOf("-"))>0)throw Error("interior hyphen");if(se===0)return f(B.substring(1),D,Y).neg();for(var re=m(h(Y,8)),W=y,$=0;$<B.length;$+=8){var k=Math.min(8,B.length-$),H=parseInt(B.substring($,$+k),Y);if(k<8){var de=m(h(Y,k));W=W.mul(de).add(m(H))}else W=(W=W.mul(re)).add(m(H))}return W.unsigned=D,W}function i(B,D){return typeof B=="number"?m(B,D):typeof B=="string"?f(B,D):g(B.low,B.high,typeof D=="boolean"?D:B.unsigned)}t.fromString=f,t.fromValue=i;var r=4294967296,d=r*r,p=d/2,_=l(1<<24),y=l(0);t.ZERO=y;var v=l(0,!0);t.UZERO=v;var T=l(1);t.ONE=T;var w=l(1,!0);t.UONE=w;var E=l(-1);t.NEG_ONE=E;var P=g(-1,2147483647,!1);t.MAX_VALUE=P;var R=g(-1,-1,!0);t.MAX_UNSIGNED_VALUE=R;var I=g(0,-2147483648,!1);t.MIN_VALUE=I;var N=t.prototype;N.toInt=function(){return this.unsigned?this.low>>>0:this.low},N.toNumber=function(){return this.unsigned?(this.high>>>0)*r+(this.low>>>0):this.high*r+(this.low>>>0)},N.toString=function(B){if((B=B||10)<2||36<B)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(I)){var D=m(B),Y=this.div(D),se=Y.mul(D).sub(this);return Y.toString(B)+se.toInt().toString(B)}return"-"+this.neg().toString(B)}for(var re=m(h(B,6),this.unsigned),W=this,$="";;){var k=W.div(re),H=(W.sub(k.mul(re)).toInt()>>>0).toString(B);if((W=k).isZero())return H+$;for(;H.length<6;)H="0"+H;$=""+H+$}},N.getHighBits=function(){return this.high},N.getHighBitsUnsigned=function(){return this.high>>>0},N.getLowBits=function(){return this.low},N.getLowBitsUnsigned=function(){return this.low>>>0},N.getNumBitsAbs=function(){if(this.isNegative())return this.eq(I)?64:this.neg().getNumBitsAbs();for(var B=this.high!=0?this.high:this.low,D=31;D>0&&(B&1<<D)==0;D--);return this.high!=0?D+33:D+1},N.isZero=function(){return this.high===0&&this.low===0},N.eqz=N.isZero,N.isNegative=function(){return!this.unsigned&&this.high<0},N.isPositive=function(){return this.unsigned||this.high>=0},N.isOdd=function(){return(1&this.low)==1},N.isEven=function(){return(1&this.low)==0},N.equals=function(B){return s(B)||(B=i(B)),(this.unsigned===B.unsigned||this.high>>>31!=1||B.high>>>31!=1)&&this.high===B.high&&this.low===B.low},N.eq=N.equals,N.notEquals=function(B){return!this.eq(B)},N.neq=N.notEquals,N.ne=N.notEquals,N.lessThan=function(B){return this.comp(B)<0},N.lt=N.lessThan,N.lessThanOrEqual=function(B){return this.comp(B)<=0},N.lte=N.lessThanOrEqual,N.le=N.lessThanOrEqual,N.greaterThan=function(B){return this.comp(B)>0},N.gt=N.greaterThan,N.greaterThanOrEqual=function(B){return this.comp(B)>=0},N.gte=N.greaterThanOrEqual,N.ge=N.greaterThanOrEqual,N.compare=function(B){if(s(B)||(B=i(B)),this.eq(B))return 0;var D=this.isNegative(),Y=B.isNegative();return D&&!Y?-1:!D&&Y?1:this.unsigned?B.high>>>0>this.high>>>0||B.high===this.high&&B.low>>>0>this.low>>>0?-1:1:this.sub(B).isNegative()?-1:1},N.comp=N.compare,N.negate=function(){return!this.unsigned&&this.eq(I)?I:this.not().add(T)},N.neg=N.negate,N.add=function(B){s(B)||(B=i(B));var D=this.high>>>16,Y=65535&this.high,se=this.low>>>16,re=65535&this.low,W=B.high>>>16,$=65535&B.high,k=B.low>>>16,H=0,de=0,ee=0,ce=0;return ee+=(ce+=re+(65535&B.low))>>>16,de+=(ee+=se+k)>>>16,H+=(de+=Y+$)>>>16,H+=D+W,g((ee&=65535)<<16|(ce&=65535),(H&=65535)<<16|(de&=65535),this.unsigned)},N.subtract=function(B){return s(B)||(B=i(B)),this.add(B.neg())},N.sub=N.subtract,N.multiply=function(B){if(this.isZero())return y;if(s(B)||(B=i(B)),e)return g(e.mul(this.low,this.high,B.low,B.high),e.get_high(),this.unsigned);if(B.isZero())return y;if(this.eq(I))return B.isOdd()?I:y;if(B.eq(I))return this.isOdd()?I:y;if(this.isNegative())return B.isNegative()?this.neg().mul(B.neg()):this.neg().mul(B).neg();if(B.isNegative())return this.mul(B.neg()).neg();if(this.lt(_)&&B.lt(_))return m(this.toNumber()*B.toNumber(),this.unsigned);var D=this.high>>>16,Y=65535&this.high,se=this.low>>>16,re=65535&this.low,W=B.high>>>16,$=65535&B.high,k=B.low>>>16,H=65535&B.low,de=0,ee=0,ce=0,q=0;return ce+=(q+=re*H)>>>16,ee+=(ce+=se*H)>>>16,ce&=65535,ee+=(ce+=re*k)>>>16,de+=(ee+=Y*H)>>>16,ee&=65535,de+=(ee+=se*k)>>>16,ee&=65535,de+=(ee+=re*$)>>>16,de+=D*H+Y*k+se*$+re*W,g((ce&=65535)<<16|(q&=65535),(de&=65535)<<16|(ee&=65535),this.unsigned)},N.mul=N.multiply,N.divide=function(B){if(s(B)||(B=i(B)),B.isZero())throw Error("division by zero");var D,Y,se;if(e)return this.unsigned||this.high!==-2147483648||B.low!==-1||B.high!==-1?g((this.unsigned?e.div_u:e.div_s)(this.low,this.high,B.low,B.high),e.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(B.unsigned||(B=B.toUnsigned()),B.gt(this))return v;if(B.gt(this.shru(1)))return w;se=v}else{if(this.eq(I))return B.eq(T)||B.eq(E)?I:B.eq(I)?T:(D=this.shr(1).div(B).shl(1)).eq(y)?B.isNegative()?T:E:(Y=this.sub(B.mul(D)),se=D.add(Y.div(B)));if(B.eq(I))return this.unsigned?v:y;if(this.isNegative())return B.isNegative()?this.neg().div(B.neg()):this.neg().div(B).neg();if(B.isNegative())return this.div(B.neg()).neg();se=y}for(Y=this;Y.gte(B);){D=Math.max(1,Math.floor(Y.toNumber()/B.toNumber()));for(var re=Math.ceil(Math.log(D)/Math.LN2),W=re<=48?1:h(2,re-48),$=m(D),k=$.mul(B);k.isNegative()||k.gt(Y);)k=($=m(D-=W,this.unsigned)).mul(B);$.isZero()&&($=T),se=se.add($),Y=Y.sub(k)}return se},N.div=N.divide,N.modulo=function(B){return s(B)||(B=i(B)),e?g((this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,B.low,B.high),e.get_high(),this.unsigned):this.sub(this.div(B).mul(B))},N.mod=N.modulo,N.rem=N.modulo,N.not=function(){return g(~this.low,~this.high,this.unsigned)},N.and=function(B){return s(B)||(B=i(B)),g(this.low&B.low,this.high&B.high,this.unsigned)},N.or=function(B){return s(B)||(B=i(B)),g(this.low|B.low,this.high|B.high,this.unsigned)},N.xor=function(B){return s(B)||(B=i(B)),g(this.low^B.low,this.high^B.high,this.unsigned)},N.shiftLeft=function(B){return s(B)&&(B=B.toInt()),(B&=63)==0?this:B<32?g(this.low<<B,this.high<<B|this.low>>>32-B,this.unsigned):g(0,this.low<<B-32,this.unsigned)},N.shl=N.shiftLeft,N.shiftRight=function(B){return s(B)&&(B=B.toInt()),(B&=63)==0?this:B<32?g(this.low>>>B|this.high<<32-B,this.high>>B,this.unsigned):g(this.high>>B-32,this.high>=0?0:-1,this.unsigned)},N.shr=N.shiftRight,N.shiftRightUnsigned=function(B){if(s(B)&&(B=B.toInt()),(B&=63)==0)return this;var D=this.high;return B<32?g(this.low>>>B|D<<32-B,D>>>B,this.unsigned):g(B===32?D:D>>>B-32,0,this.unsigned)},N.shru=N.shiftRightUnsigned,N.shr_u=N.shiftRightUnsigned,N.toSigned=function(){return this.unsigned?g(this.low,this.high,!1):this},N.toUnsigned=function(){return this.unsigned?this:g(this.low,this.high,!0)},N.toBytes=function(B){return B?this.toBytesLE():this.toBytesBE()},N.toBytesLE=function(){var B=this.high,D=this.low;return[255&D,D>>>8&255,D>>>16&255,D>>>24,255&B,B>>>8&255,B>>>16&255,B>>>24]},N.toBytesBE=function(){var B=this.high,D=this.low;return[B>>>24,B>>>16&255,B>>>8&255,255&B,D>>>24,D>>>16&255,D>>>8&255,255&D]},t.fromBytes=function(B,D,Y){return Y?t.fromBytesLE(B,D):t.fromBytesBE(B,D)},t.fromBytesLE=function(B,D){return new t(B[0]|B[1]<<8|B[2]<<16|B[3]<<24,B[4]|B[5]<<8|B[6]<<16|B[7]<<24,D)},t.fromBytesBE=function(B,D){return new t(B[4]<<24|B[5]<<16|B[6]<<8|B[7],B[0]<<24|B[1]<<16|B[2]<<8|B[3],D)}},1446:(n,e,t)=>{var s,o,u,l=t(2100),m=l.Reader,g=l.Writer,h=l.util,f=l.roots.default||(l.roots.default={});f.onnx=((u={}).Version=(s={},(o=Object.create(s))[s[0]="_START_VERSION"]=0,o[s[1]="IR_VERSION_2017_10_10"]=1,o[s[2]="IR_VERSION_2017_10_30"]=2,o[s[3]="IR_VERSION_2017_11_3"]=3,o[s[4]="IR_VERSION_2019_1_22"]=4,o[s[5]="IR_VERSION"]=5,o),u.AttributeProto=(function(){function i(r){if(this.floats=[],this.ints=[],this.strings=[],this.tensors=[],this.graphs=[],r)for(var d=Object.keys(r),p=0;p<d.length;++p)r[d[p]]!=null&&(this[d[p]]=r[d[p]])}return i.prototype.name="",i.prototype.refAttrName="",i.prototype.docString="",i.prototype.type=0,i.prototype.f=0,i.prototype.i=h.Long?h.Long.fromBits(0,0,!1):0,i.prototype.s=h.newBuffer([]),i.prototype.t=null,i.prototype.g=null,i.prototype.floats=h.emptyArray,i.prototype.ints=h.emptyArray,i.prototype.strings=h.emptyArray,i.prototype.tensors=h.emptyArray,i.prototype.graphs=h.emptyArray,i.create=function(r){return new i(r)},i.encode=function(r,d){if(d||(d=g.create()),r.name!=null&&r.hasOwnProperty("name")&&d.uint32(10).string(r.name),r.f!=null&&r.hasOwnProperty("f")&&d.uint32(21).float(r.f),r.i!=null&&r.hasOwnProperty("i")&&d.uint32(24).int64(r.i),r.s!=null&&r.hasOwnProperty("s")&&d.uint32(34).bytes(r.s),r.t!=null&&r.hasOwnProperty("t")&&f.onnx.TensorProto.encode(r.t,d.uint32(42).fork()).ldelim(),r.g!=null&&r.hasOwnProperty("g")&&f.onnx.GraphProto.encode(r.g,d.uint32(50).fork()).ldelim(),r.floats!=null&&r.floats.length){d.uint32(58).fork();for(var p=0;p<r.floats.length;++p)d.float(r.floats[p]);d.ldelim()}if(r.ints!=null&&r.ints.length){for(d.uint32(66).fork(),p=0;p<r.ints.length;++p)d.int64(r.ints[p]);d.ldelim()}if(r.strings!=null&&r.strings.length)for(p=0;p<r.strings.length;++p)d.uint32(74).bytes(r.strings[p]);if(r.tensors!=null&&r.tensors.length)for(p=0;p<r.tensors.length;++p)f.onnx.TensorProto.encode(r.tensors[p],d.uint32(82).fork()).ldelim();if(r.graphs!=null&&r.graphs.length)for(p=0;p<r.graphs.length;++p)f.onnx.GraphProto.encode(r.graphs[p],d.uint32(90).fork()).ldelim();return r.docString!=null&&r.hasOwnProperty("docString")&&d.uint32(106).string(r.docString),r.type!=null&&r.hasOwnProperty("type")&&d.uint32(160).int32(r.type),r.refAttrName!=null&&r.hasOwnProperty("refAttrName")&&d.uint32(170).string(r.refAttrName),d},i.encodeDelimited=function(r,d){return this.encode(r,d).ldelim()},i.decode=function(r,d){r instanceof m||(r=m.create(r));for(var p=d===void 0?r.len:r.pos+d,_=new f.onnx.AttributeProto;r.pos<p;){var y=r.uint32();switch(y>>>3){case 1:_.name=r.string();break;case 21:_.refAttrName=r.string();break;case 13:_.docString=r.string();break;case 20:_.type=r.int32();break;case 2:_.f=r.float();break;case 3:_.i=r.int64();break;case 4:_.s=r.bytes();break;case 5:_.t=f.onnx.TensorProto.decode(r,r.uint32());break;case 6:_.g=f.onnx.GraphProto.decode(r,r.uint32());break;case 7:if(_.floats&&_.floats.length||(_.floats=[]),(7&y)==2)for(var v=r.uint32()+r.pos;r.pos<v;)_.floats.push(r.float());else _.floats.push(r.float());break;case 8:if(_.ints&&_.ints.length||(_.ints=[]),(7&y)==2)for(v=r.uint32()+r.pos;r.pos<v;)_.ints.push(r.int64());else _.ints.push(r.int64());break;case 9:_.strings&&_.strings.length||(_.strings=[]),_.strings.push(r.bytes());break;case 10:_.tensors&&_.tensors.length||(_.tensors=[]),_.tensors.push(f.onnx.TensorProto.decode(r,r.uint32()));break;case 11:_.graphs&&_.graphs.length||(_.graphs=[]),_.graphs.push(f.onnx.GraphProto.decode(r,r.uint32()));break;default:r.skipType(7&y)}}return _},i.decodeDelimited=function(r){return r instanceof m||(r=new m(r)),this.decode(r,r.uint32())},i.verify=function(r){if(typeof r!="object"||r===null)return"object expected";if(r.name!=null&&r.hasOwnProperty("name")&&!h.isString(r.name))return"name: string expected";if(r.refAttrName!=null&&r.hasOwnProperty("refAttrName")&&!h.isString(r.refAttrName))return"refAttrName: string expected";if(r.docString!=null&&r.hasOwnProperty("docString")&&!h.isString(r.docString))return"docString: string expected";if(r.type!=null&&r.hasOwnProperty("type"))switch(r.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:}if(r.f!=null&&r.hasOwnProperty("f")&&typeof r.f!="number")return"f: number expected";if(r.i!=null&&r.hasOwnProperty("i")&&!(h.isInteger(r.i)||r.i&&h.isInteger(r.i.low)&&h.isInteger(r.i.high)))return"i: integer|Long expected";if(r.s!=null&&r.hasOwnProperty("s")&&!(r.s&&typeof r.s.length=="number"||h.isString(r.s)))return"s: buffer expected";if(r.t!=null&&r.hasOwnProperty("t")&&(p=f.onnx.TensorProto.verify(r.t)))return"t."+p;if(r.g!=null&&r.hasOwnProperty("g")&&(p=f.onnx.GraphProto.verify(r.g)))return"g."+p;if(r.floats!=null&&r.hasOwnProperty("floats")){if(!Array.isArray(r.floats))return"floats: array expected";for(var d=0;d<r.floats.length;++d)if(typeof r.floats[d]!="number")return"floats: number[] expected"}if(r.ints!=null&&r.hasOwnProperty("ints")){if(!Array.isArray(r.ints))return"ints: array expected";for(d=0;d<r.ints.length;++d)if(!(h.isInteger(r.ints[d])||r.ints[d]&&h.isInteger(r.ints[d].low)&&h.isInteger(r.ints[d].high)))return"ints: integer|Long[] expected"}if(r.strings!=null&&r.hasOwnProperty("strings")){if(!Array.isArray(r.strings))return"strings: array expected";for(d=0;d<r.strings.length;++d)if(!(r.strings[d]&&typeof r.strings[d].length=="number"||h.isString(r.strings[d])))return"strings: buffer[] expected"}if(r.tensors!=null&&r.hasOwnProperty("tensors")){if(!Array.isArray(r.tensors))return"tensors: array expected";for(d=0;d<r.tensors.length;++d)if(p=f.onnx.TensorProto.verify(r.tensors[d]))return"tensors."+p}if(r.graphs!=null&&r.hasOwnProperty("graphs")){if(!Array.isArray(r.graphs))return"graphs: array expected";for(d=0;d<r.graphs.length;++d){var p;if(p=f.onnx.GraphProto.verify(r.graphs[d]))return"graphs."+p}}return null},i.fromObject=function(r){if(r instanceof f.onnx.AttributeProto)return r;var d=new f.onnx.AttributeProto;switch(r.name!=null&&(d.name=String(r.name)),r.refAttrName!=null&&(d.refAttrName=String(r.refAttrName)),r.docString!=null&&(d.docString=String(r.docString)),r.type){case"UNDEFINED":case 0:d.type=0;break;case"FLOAT":case 1:d.type=1;break;case"INT":case 2:d.type=2;break;case"STRING":case 3:d.type=3;break;case"TENSOR":case 4:d.type=4;break;case"GRAPH":case 5:d.type=5;break;case"FLOATS":case 6:d.type=6;break;case"INTS":case 7:d.type=7;break;case"STRINGS":case 8:d.type=8;break;case"TENSORS":case 9:d.type=9;break;case"GRAPHS":case 10:d.type=10}if(r.f!=null&&(d.f=Number(r.f)),r.i!=null&&(h.Long?(d.i=h.Long.fromValue(r.i)).unsigned=!1:typeof r.i=="string"?d.i=parseInt(r.i,10):typeof r.i=="number"?d.i=r.i:typeof r.i=="object"&&(d.i=new h.LongBits(r.i.low>>>0,r.i.high>>>0).toNumber())),r.s!=null&&(typeof r.s=="string"?h.base64.decode(r.s,d.s=h.newBuffer(h.base64.length(r.s)),0):r.s.length&&(d.s=r.s)),r.t!=null){if(typeof r.t!="object")throw TypeError(".onnx.AttributeProto.t: object expected");d.t=f.onnx.TensorProto.fromObject(r.t)}if(r.g!=null){if(typeof r.g!="object")throw TypeError(".onnx.AttributeProto.g: object expected");d.g=f.onnx.GraphProto.fromObject(r.g)}if(r.floats){if(!Array.isArray(r.floats))throw TypeError(".onnx.AttributeProto.floats: array expected");d.floats=[];for(var p=0;p<r.floats.length;++p)d.floats[p]=Number(r.floats[p])}if(r.ints){if(!Array.isArray(r.ints))throw TypeError(".onnx.AttributeProto.ints: array expected");for(d.ints=[],p=0;p<r.ints.length;++p)h.Long?(d.ints[p]=h.Long.fromValue(r.ints[p])).unsigned=!1:typeof r.ints[p]=="string"?d.ints[p]=parseInt(r.ints[p],10):typeof r.ints[p]=="number"?d.ints[p]=r.ints[p]:typeof r.ints[p]=="object"&&(d.ints[p]=new h.LongBits(r.ints[p].low>>>0,r.ints[p].high>>>0).toNumber())}if(r.strings){if(!Array.isArray(r.strings))throw TypeError(".onnx.AttributeProto.strings: array expected");for(d.strings=[],p=0;p<r.strings.length;++p)typeof r.strings[p]=="string"?h.base64.decode(r.strings[p],d.strings[p]=h.newBuffer(h.base64.length(r.strings[p])),0):r.strings[p].length&&(d.strings[p]=r.strings[p])}if(r.tensors){if(!Array.isArray(r.tensors))throw TypeError(".onnx.AttributeProto.tensors: array expected");for(d.tensors=[],p=0;p<r.tensors.length;++p){if(typeof r.tensors[p]!="object")throw TypeError(".onnx.AttributeProto.tensors: object expected");d.tensors[p]=f.onnx.TensorProto.fromObject(r.tensors[p])}}if(r.graphs){if(!Array.isArray(r.graphs))throw TypeError(".onnx.AttributeProto.graphs: array expected");for(d.graphs=[],p=0;p<r.graphs.length;++p){if(typeof r.graphs[p]!="object")throw TypeError(".onnx.AttributeProto.graphs: object expected");d.graphs[p]=f.onnx.GraphProto.fromObject(r.graphs[p])}}return d},i.toObject=function(r,d){d||(d={});var p={};if((d.arrays||d.defaults)&&(p.floats=[],p.ints=[],p.strings=[],p.tensors=[],p.graphs=[]),d.defaults){if(p.name="",p.f=0,h.Long){var _=new h.Long(0,0,!1);p.i=d.longs===String?_.toString():d.longs===Number?_.toNumber():_}else p.i=d.longs===String?"0":0;d.bytes===String?p.s="":(p.s=[],d.bytes!==Array&&(p.s=h.newBuffer(p.s))),p.t=null,p.g=null,p.docString="",p.type=d.enums===String?"UNDEFINED":0,p.refAttrName=""}if(r.name!=null&&r.hasOwnProperty("name")&&(p.name=r.name),r.f!=null&&r.hasOwnProperty("f")&&(p.f=d.json&&!isFinite(r.f)?String(r.f):r.f),r.i!=null&&r.hasOwnProperty("i")&&(typeof r.i=="number"?p.i=d.longs===String?String(r.i):r.i:p.i=d.longs===String?h.Long.prototype.toString.call(r.i):d.longs===Number?new h.LongBits(r.i.low>>>0,r.i.high>>>0).toNumber():r.i),r.s!=null&&r.hasOwnProperty("s")&&(p.s=d.bytes===String?h.base64.encode(r.s,0,r.s.length):d.bytes===Array?Array.prototype.slice.call(r.s):r.s),r.t!=null&&r.hasOwnProperty("t")&&(p.t=f.onnx.TensorProto.toObject(r.t,d)),r.g!=null&&r.hasOwnProperty("g")&&(p.g=f.onnx.GraphProto.toObject(r.g,d)),r.floats&&r.floats.length){p.floats=[];for(var y=0;y<r.floats.length;++y)p.floats[y]=d.json&&!isFinite(r.floats[y])?String(r.floats[y]):r.floats[y]}if(r.ints&&r.ints.length)for(p.ints=[],y=0;y<r.ints.length;++y)typeof r.ints[y]=="number"?p.ints[y]=d.longs===String?String(r.ints[y]):r.ints[y]:p.ints[y]=d.longs===String?h.Long.prototype.toString.call(r.ints[y]):d.longs===Number?new h.LongBits(r.ints[y].low>>>0,r.ints[y].high>>>0).toNumber():r.ints[y];if(r.strings&&r.strings.length)for(p.strings=[],y=0;y<r.strings.length;++y)p.strings[y]=d.bytes===String?h.base64.encode(r.strings[y],0,r.strings[y].length):d.bytes===Array?Array.prototype.slice.call(r.strings[y]):r.strings[y];if(r.tensors&&r.tensors.length)for(p.tensors=[],y=0;y<r.tensors.length;++y)p.tensors[y]=f.onnx.TensorProto.toObject(r.tensors[y],d);if(r.graphs&&r.graphs.length)for(p.graphs=[],y=0;y<r.graphs.length;++y)p.graphs[y]=f.onnx.GraphProto.toObject(r.graphs[y],d);return r.docString!=null&&r.hasOwnProperty("docString")&&(p.docString=r.docString),r.type!=null&&r.hasOwnProperty("type")&&(p.type=d.enums===String?f.onnx.AttributeProto.AttributeType[r.type]:r.type),r.refAttrName!=null&&r.hasOwnProperty("refAttrName")&&(p.refAttrName=r.refAttrName),p},i.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},i.AttributeType=(function(){var r={},d=Object.create(r);return d[r[0]="UNDEFINED"]=0,d[r[1]="FLOAT"]=1,d[r[2]="INT"]=2,d[r[3]="STRING"]=3,d[r[4]="TENSOR"]=4,d[r[5]="GRAPH"]=5,d[r[6]="FLOATS"]=6,d[r[7]="INTS"]=7,d[r[8]="STRINGS"]=8,d[r[9]="TENSORS"]=9,d[r[10]="GRAPHS"]=10,d})(),i})(),u.ValueInfoProto=(function(){function i(r){if(r)for(var d=Object.keys(r),p=0;p<d.length;++p)r[d[p]]!=null&&(this[d[p]]=r[d[p]])}return i.prototype.name="",i.prototype.type=null,i.prototype.docString="",i.create=function(r){return new i(r)},i.encode=function(r,d){return d||(d=g.create()),r.name!=null&&r.hasOwnProperty("name")&&d.uint32(10).string(r.name),r.type!=null&&r.hasOwnProperty("type")&&f.onnx.TypeProto.encode(r.type,d.uint32(18).fork()).ldelim(),r.docString!=null&&r.hasOwnProperty("docString")&&d.uint32(26).string(r.docString),d},i.encodeDelimited=function(r,d){return this.encode(r,d).ldelim()},i.decode=function(r,d){r instanceof m||(r=m.create(r));for(var p=d===void 0?r.len:r.pos+d,_=new f.onnx.ValueInfoProto;r.pos<p;){var y=r.uint32();switch(y>>>3){case 1:_.name=r.string();break;case 2:_.type=f.onnx.TypeProto.decode(r,r.uint32());break;case 3:_.docString=r.string();break;default:r.skipType(7&y)}}return _},i.decodeDelimited=function(r){return r instanceof m||(r=new m(r)),this.decode(r,r.uint32())},i.verify=function(r){if(typeof r!="object"||r===null)return"object expected";if(r.name!=null&&r.hasOwnProperty("name")&&!h.isString(r.name))return"name: string expected";if(r.type!=null&&r.hasOwnProperty("type")){var d=f.onnx.TypeProto.verify(r.type);if(d)return"type."+d}return r.docString!=null&&r.hasOwnProperty("docString")&&!h.isString(r.docString)?"docString: string expected":null},i.fromObject=function(r){if(r instanceof f.onnx.ValueInfoProto)return r;var d=new f.onnx.ValueInfoProto;if(r.name!=null&&(d.name=String(r.name)),r.type!=null){if(typeof r.type!="object")throw TypeError(".onnx.ValueInfoProto.type: object expected");d.type=f.onnx.TypeProto.fromObject(r.type)}return r.docString!=null&&(d.docString=String(r.docString)),d},i.toObject=function(r,d){d||(d={});var p={};return d.defaults&&(p.name="",p.type=null,p.docString=""),r.name!=null&&r.hasOwnProperty("name")&&(p.name=r.name),r.type!=null&&r.hasOwnProperty("type")&&(p.type=f.onnx.TypeProto.toObject(r.type,d)),r.docString!=null&&r.hasOwnProperty("docString")&&(p.docString=r.docString),p},i.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},i})(),u.NodeProto=(function(){function i(r){if(this.input=[],this.output=[],this.attribute=[],r)for(var d=Object.keys(r),p=0;p<d.length;++p)r[d[p]]!=null&&(this[d[p]]=r[d[p]])}return i.prototype.input=h.emptyArray,i.prototype.output=h.emptyArray,i.prototype.name="",i.prototype.opType="",i.prototype.domain="",i.prototype.attribute=h.emptyArray,i.prototype.docString="",i.create=function(r){return new i(r)},i.encode=function(r,d){if(d||(d=g.create()),r.input!=null&&r.input.length)for(var p=0;p<r.input.length;++p)d.uint32(10).string(r.input[p]);if(r.output!=null&&r.output.length)for(p=0;p<r.output.length;++p)d.uint32(18).string(r.output[p]);if(r.name!=null&&r.hasOwnProperty("name")&&d.uint32(26).string(r.name),r.opType!=null&&r.hasOwnProperty("opType")&&d.uint32(34).string(r.opType),r.attribute!=null&&r.attribute.length)for(p=0;p<r.attribute.length;++p)f.onnx.AttributeProto.encode(r.attribute[p],d.uint32(42).fork()).ldelim();return r.docString!=null&&r.hasOwnProperty("docString")&&d.uint32(50).string(r.docString),r.domain!=null&&r.hasOwnProperty("domain")&&d.uint32(58).string(r.domain),d},i.encodeDelimited=function(r,d){return this.encode(r,d).ldelim()},i.decode=function(r,d){r instanceof m||(r=m.create(r));for(var p=d===void 0?r.len:r.pos+d,_=new f.onnx.NodeProto;r.pos<p;){var y=r.uint32();switch(y>>>3){case 1:_.input&&_.input.length||(_.input=[]),_.input.push(r.string());break;case 2:_.output&&_.output.length||(_.output=[]),_.output.push(r.string());break;case 3:_.name=r.string();break;case 4:_.opType=r.string();break;case 7:_.domain=r.string();break;case 5:_.attribute&&_.attribute.length||(_.attribute=[]),_.attribute.push(f.onnx.AttributeProto.decode(r,r.uint32()));break;case 6:_.docString=r.string();break;default:r.skipType(7&y)}}return _},i.decodeDelimited=function(r){return r instanceof m||(r=new m(r)),this.decode(r,r.uint32())},i.verify=function(r){if(typeof r!="object"||r===null)return"object expected";if(r.input!=null&&r.hasOwnProperty("input")){if(!Array.isArray(r.input))return"input: array expected";for(var d=0;d<r.input.length;++d)if(!h.isString(r.input[d]))return"input: string[] expected"}if(r.output!=null&&r.hasOwnProperty("output")){if(!Array.isArray(r.output))return"output: array expected";for(d=0;d<r.output.length;++d)if(!h.isString(r.output[d]))return"output: string[] expected"}if(r.name!=null&&r.hasOwnProperty("name")&&!h.isString(r.name))return"name: string expected";if(r.opType!=null&&r.hasOwnProperty("opType")&&!h.isString(r.opType))return"opType: string expected";if(r.domain!=null&&r.hasOwnProperty("domain")&&!h.isString(r.domain))return"domain: string expected";if(r.attribute!=null&&r.hasOwnProperty("attribute")){if(!Array.isArray(r.attribute))return"attribute: array expected";for(d=0;d<r.attribute.length;++d){var p=f.onnx.AttributeProto.verify(r.attribute[d]);if(p)return"attribute."+p}}return r.docString!=null&&r.hasOwnProperty("docString")&&!h.isString(r.docString)?"docString: string expected":null},i.fromObject=function(r){if(r instanceof f.onnx.NodeProto)return r;var d=new f.onnx.NodeProto;if(r.input){if(!Array.isArray(r.input))throw TypeError(".onnx.NodeProto.input: array expected");d.input=[];for(var p=0;p<r.input.length;++p)d.input[p]=String(r.input[p])}if(r.output){if(!Array.isArray(r.output))throw TypeError(".onnx.NodeProto.output: array expected");for(d.output=[],p=0;p<r.output.length;++p)d.output[p]=String(r.output[p])}if(r.name!=null&&(d.name=String(r.name)),r.opType!=null&&(d.opType=String(r.opType)),r.domain!=null&&(d.domain=String(r.domain)),r.attribute){if(!Array.isArray(r.attribute))throw TypeError(".onnx.NodeProto.attribute: array expected");for(d.attribute=[],p=0;p<r.attribute.length;++p){if(typeof r.attribute[p]!="object")throw TypeError(".onnx.NodeProto.attribute: object expected");d.attribute[p]=f.onnx.AttributeProto.fromObject(r.attribute[p])}}return r.docString!=null&&(d.docString=String(r.docString)),d},i.toObject=function(r,d){d||(d={});var p={};if((d.arrays||d.defaults)&&(p.input=[],p.output=[],p.attribute=[]),d.defaults&&(p.name="",p.opType="",p.docString="",p.domain=""),r.input&&r.input.length){p.input=[];for(var _=0;_<r.input.length;++_)p.input[_]=r.input[_]}if(r.output&&r.output.length)for(p.output=[],_=0;_<r.output.length;++_)p.output[_]=r.output[_];if(r.name!=null&&r.hasOwnProperty("name")&&(p.name=r.name),r.opType!=null&&r.hasOwnProperty("opType")&&(p.opType=r.opType),r.attribute&&r.attribute.length)for(p.attribute=[],_=0;_<r.attribute.length;++_)p.attribute[_]=f.onnx.AttributeProto.toObject(r.attribute[_],d);return r.docString!=null&&r.hasOwnProperty("docString")&&(p.docString=r.docString),r.domain!=null&&r.hasOwnProperty("domain")&&(p.domain=r.domain),p},i.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},i})(),u.ModelProto=(function(){function i(r){if(this.opsetImport=[],this.metadataProps=[],r)for(var d=Object.keys(r),p=0;p<d.length;++p)r[d[p]]!=null&&(this[d[p]]=r[d[p]])}return i.prototype.irVersion=h.Long?h.Long.fromBits(0,0,!1):0,i.prototype.opsetImport=h.emptyArray,i.prototype.producerName="",i.prototype.producerVersion="",i.prototype.domain="",i.prototype.modelVersion=h.Long?h.Long.fromBits(0,0,!1):0,i.prototype.docString="",i.prototype.graph=null,i.prototype.metadataProps=h.emptyArray,i.create=function(r){return new i(r)},i.encode=function(r,d){if(d||(d=g.create()),r.irVersion!=null&&r.hasOwnProperty("irVersion")&&d.uint32(8).int64(r.irVersion),r.producerName!=null&&r.hasOwnProperty("producerName")&&d.uint32(18).string(r.producerName),r.producerVersion!=null&&r.hasOwnProperty("producerVersion")&&d.uint32(26).string(r.producerVersion),r.domain!=null&&r.hasOwnProperty("domain")&&d.uint32(34).string(r.domain),r.modelVersion!=null&&r.hasOwnProperty("modelVersion")&&d.uint32(40).int64(r.modelVersion),r.docString!=null&&r.hasOwnProperty("docString")&&d.uint32(50).string(r.docString),r.graph!=null&&r.hasOwnProperty("graph")&&f.onnx.GraphProto.encode(r.graph,d.uint32(58).fork()).ldelim(),r.opsetImport!=null&&r.opsetImport.length)for(var p=0;p<r.opsetImport.length;++p)f.onnx.OperatorSetIdProto.encode(r.opsetImport[p],d.uint32(66).fork()).ldelim();if(r.metadataProps!=null&&r.metadataProps.length)for(p=0;p<r.metadataProps.length;++p)f.onnx.StringStringEntryProto.encode(r.metadataProps[p],d.uint32(114).fork()).ldelim();return d},i.encodeDelimited=function(r,d){return this.encode(r,d).ldelim()},i.decode=function(r,d){r instanceof m||(r=m.create(r));for(var p=d===void 0?r.len:r.pos+d,_=new f.onnx.ModelProto;r.pos<p;){var y=r.uint32();switch(y>>>3){case 1:_.irVersion=r.int64();break;case 8:_.opsetImport&&_.opsetImport.length||(_.opsetImport=[]),_.opsetImport.push(f.onnx.OperatorSetIdProto.decode(r,r.uint32()));break;case 2:_.producerName=r.string();break;case 3:_.producerVersion=r.string();break;case 4:_.domain=r.string();break;case 5:_.modelVersion=r.int64();break;case 6:_.docString=r.string();break;case 7:_.graph=f.onnx.GraphProto.decode(r,r.uint32());break;case 14:_.metadataProps&&_.metadataProps.length||(_.metadataProps=[]),_.metadataProps.push(f.onnx.StringStringEntryProto.decode(r,r.uint32()));break;default:r.skipType(7&y)}}return _},i.decodeDelimited=function(r){return r instanceof m||(r=new m(r)),this.decode(r,r.uint32())},i.verify=function(r){if(typeof r!="object"||r===null)return"object expected";if(r.irVersion!=null&&r.hasOwnProperty("irVersion")&&!(h.isInteger(r.irVersion)||r.irVersion&&h.isInteger(r.irVersion.low)&&h.isInteger(r.irVersion.high)))return"irVersion: integer|Long expected";if(r.opsetImport!=null&&r.hasOwnProperty("opsetImport")){if(!Array.isArray(r.opsetImport))return"opsetImport: array expected";for(var d=0;d<r.opsetImport.length;++d)if(p=f.onnx.OperatorSetIdProto.verify(r.opsetImport[d]))return"opsetImport."+p}if(r.producerName!=null&&r.hasOwnProperty("producerName")&&!h.isString(r.producerName))return"producerName: string expected";if(r.producerVersion!=null&&r.hasOwnProperty("producerVersion")&&!h.isString(r.producerVersion))return"producerVersion: string expected";if(r.domain!=null&&r.hasOwnProperty("domain")&&!h.isString(r.domain))return"domain: string expected";if(r.modelVersion!=null&&r.hasOwnProperty("modelVersion")&&!(h.isInteger(r.modelVersion)||r.modelVersion&&h.isInteger(r.modelVersion.low)&&h.isInteger(r.modelVersion.high)))return"modelVersion: integer|Long expected";if(r.docString!=null&&r.hasOwnProperty("docString")&&!h.isString(r.docString))return"docString: string expected";if(r.graph!=null&&r.hasOwnProperty("graph")&&(p=f.onnx.GraphProto.verify(r.graph)))return"graph."+p;if(r.metadataProps!=null&&r.hasOwnProperty("metadataProps")){if(!Array.isArray(r.metadataProps))return"metadataProps: array expected";for(d=0;d<r.metadataProps.length;++d){var p;if(p=f.onnx.StringStringEntryProto.verify(r.metadataProps[d]))return"metadataProps."+p}}return null},i.fromObject=function(r){if(r instanceof f.onnx.ModelProto)return r;var d=new f.onnx.ModelProto;if(r.irVersion!=null&&(h.Long?(d.irVersion=h.Long.fromValue(r.irVersion)).unsigned=!1:typeof r.irVersion=="string"?d.irVersion=parseInt(r.irVersion,10):typeof r.irVersion=="number"?d.irVersion=r.irVersion:typeof r.irVersion=="object"&&(d.irVersion=new h.LongBits(r.irVersion.low>>>0,r.irVersion.high>>>0).toNumber())),r.opsetImport){if(!Array.isArray(r.opsetImport))throw TypeError(".onnx.ModelProto.opsetImport: array expected");d.opsetImport=[];for(var p=0;p<r.opsetImport.length;++p){if(typeof r.opsetImport[p]!="object")throw TypeError(".onnx.ModelProto.opsetImport: object expected");d.opsetImport[p]=f.onnx.OperatorSetIdProto.fromObject(r.opsetImport[p])}}if(r.producerName!=null&&(d.producerName=String(r.producerName)),r.producerVersion!=null&&(d.producerVersion=String(r.producerVersion)),r.domain!=null&&(d.domain=String(r.domain)),r.modelVersion!=null&&(h.Long?(d.modelVersion=h.Long.fromValue(r.modelVersion)).unsigned=!1:typeof r.modelVersion=="string"?d.modelVersion=parseInt(r.modelVersion,10):typeof r.modelVersion=="number"?d.modelVersion=r.modelVersion:typeof r.modelVersion=="object"&&(d.modelVersion=new h.LongBits(r.modelVersion.low>>>0,r.modelVersion.high>>>0).toNumber())),r.docString!=null&&(d.docString=String(r.docString)),r.graph!=null){if(typeof r.graph!="object")throw TypeError(".onnx.ModelProto.graph: object expected");d.graph=f.onnx.GraphProto.fromObject(r.graph)}if(r.metadataProps){if(!Array.isArray(r.metadataProps))throw TypeError(".onnx.ModelProto.metadataProps: array expected");for(d.metadataProps=[],p=0;p<r.metadataProps.length;++p){if(typeof r.metadataProps[p]!="object")throw TypeError(".onnx.ModelProto.metadataProps: object expected");d.metadataProps[p]=f.onnx.StringStringEntryProto.fromObject(r.metadataProps[p])}}return d},i.toObject=function(r,d){d||(d={});var p={};if((d.arrays||d.defaults)&&(p.opsetImport=[],p.metadataProps=[]),d.defaults){if(h.Long){var _=new h.Long(0,0,!1);p.irVersion=d.longs===String?_.toString():d.longs===Number?_.toNumber():_}else p.irVersion=d.longs===String?"0":0;p.producerName="",p.producerVersion="",p.domain="",h.Long?(_=new h.Long(0,0,!1),p.modelVersion=d.longs===String?_.toString():d.longs===Number?_.toNumber():_):p.modelVersion=d.longs===String?"0":0,p.docString="",p.graph=null}if(r.irVersion!=null&&r.hasOwnProperty("irVersion")&&(typeof r.irVersion=="number"?p.irVersion=d.longs===String?String(r.irVersion):r.irVersion:p.irVersion=d.longs===String?h.Long.prototype.toString.call(r.irVersion):d.longs===Number?new h.LongBits(r.irVersion.low>>>0,r.irVersion.high>>>0).toNumber():r.irVersion),r.producerName!=null&&r.hasOwnProperty("producerName")&&(p.producerName=r.producerName),r.producerVersion!=null&&r.hasOwnProperty("producerVersion")&&(p.producerVersion=r.producerVersion),r.domain!=null&&r.hasOwnProperty("domain")&&(p.domain=r.domain),r.modelVersion!=null&&r.hasOwnProperty("modelVersion")&&(typeof r.modelVersion=="number"?p.modelVersion=d.longs===String?String(r.modelVersion):r.modelVersion:p.modelVersion=d.longs===String?h.Long.prototype.toString.call(r.modelVersion):d.longs===Number?new h.LongBits(r.modelVersion.low>>>0,r.modelVersion.high>>>0).toNumber():r.modelVersion),r.docString!=null&&r.hasOwnProperty("docString")&&(p.docString=r.docString),r.graph!=null&&r.hasOwnProperty("graph")&&(p.graph=f.onnx.GraphProto.toObject(r.graph,d)),r.opsetImport&&r.opsetImport.length){p.opsetImport=[];for(var y=0;y<r.opsetImport.length;++y)p.opsetImport[y]=f.onnx.OperatorSetIdProto.toObject(r.opsetImport[y],d)}if(r.metadataProps&&r.metadataProps.length)for(p.metadataProps=[],y=0;y<r.metadataProps.length;++y)p.metadataProps[y]=f.onnx.StringStringEntryProto.toObject(r.metadataProps[y],d);return p},i.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},i})(),u.StringStringEntryProto=(function(){function i(r){if(r)for(var d=Object.keys(r),p=0;p<d.length;++p)r[d[p]]!=null&&(this[d[p]]=r[d[p]])}return i.prototype.key="",i.prototype.value="",i.create=function(r){return new i(r)},i.encode=function(r,d){return d||(d=g.create()),r.key!=null&&r.hasOwnProperty("key")&&d.uint32(10).string(r.key),r.value!=null&&r.hasOwnProperty("value")&&d.uint32(18).string(r.value),d},i.encodeDelimited=function(r,d){return this.encode(r,d).ldelim()},i.decode=function(r,d){r instanceof m||(r=m.create(r));for(var p=d===void 0?r.len:r.pos+d,_=new f.onnx.StringStringEntryProto;r.pos<p;){var y=r.uint32();switch(y>>>3){case 1:_.key=r.string();break;case 2:_.value=r.string();break;default:r.skipType(7&y)}}return _},i.decodeDelimited=function(r){return r instanceof m||(r=new m(r)),this.decode(r,r.uint32())},i.verify=function(r){return typeof r!="object"||r===null?"object expected":r.key!=null&&r.hasOwnProperty("key")&&!h.isString(r.key)?"key: string expected":r.value!=null&&r.hasOwnProperty("value")&&!h.isString(r.value)?"value: string expected":null},i.fromObject=function(r){if(r instanceof f.onnx.StringStringEntryProto)return r;var d=new f.onnx.StringStringEntryProto;return r.key!=null&&(d.key=String(r.key)),r.value!=null&&(d.value=String(r.value)),d},i.toObject=function(r,d){d||(d={});var p={};return d.defaults&&(p.key="",p.value=""),r.key!=null&&r.hasOwnProperty("key")&&(p.key=r.key),r.value!=null&&r.hasOwnProperty("value")&&(p.value=r.value),p},i.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},i})(),u.TensorAnnotation=(function(){function i(r){if(this.quantParameterTensorNames=[],r)for(var d=Object.keys(r),p=0;p<d.length;++p)r[d[p]]!=null&&(this[d[p]]=r[d[p]])}return i.prototype.tensorName="",i.prototype.quantParameterTensorNames=h.emptyArray,i.create=function(r){return new i(r)},i.encode=function(r,d){if(d||(d=g.create()),r.tensorName!=null&&r.hasOwnProperty("tensorName")&&d.uint32(10).string(r.tensorName),r.quantParameterTensorNames!=null&&r.quantParameterTensorNames.length)for(var p=0;p<r.quantParameterTensorNames.length;++p)f.onnx.StringStringEntryProto.encode(r.quantParameterTensorNames[p],d.uint32(18).fork()).ldelim();return d},i.encodeDelimited=function(r,d){return this.encode(r,d).ldelim()},i.decode=function(r,d){r instanceof m||(r=m.create(r));for(var p=d===void 0?r.len:r.pos+d,_=new f.onnx.TensorAnnotation;r.pos<p;){var y=r.uint32();switch(y>>>3){case 1:_.tensorName=r.string();break;case 2:_.quantParameterTensorNames&&_.quantParameterTensorNames.length||(_.quantParameterTensorNames=[]),_.quantParameterTensorNames.push(f.onnx.StringStringEntryProto.decode(r,r.uint32()));break;default:r.skipType(7&y)}}return _},i.decodeDelimited=function(r){return r instanceof m||(r=new m(r)),this.decode(r,r.uint32())},i.verify=function(r){if(typeof r!="object"||r===null)return"object expected";if(r.tensorName!=null&&r.hasOwnProperty("tensorName")&&!h.isString(r.tensorName))return"tensorName: string expected";if(r.quantParameterTensorNames!=null&&r.hasOwnProperty("quantParameterTensorNames")){if(!Array.isArray(r.quantParameterTensorNames))return"quantParameterTensorNames: array expected";for(var d=0;d<r.quantParameterTensorNames.length;++d){var p=f.onnx.StringStringEntryProto.verify(r.quantParameterTensorNames[d]);if(p)return"quantParameterTensorNames."+p}}return null},i.fromObject=function(r){if(r instanceof f.onnx.TensorAnnotation)return r;var d=new f.onnx.TensorAnnotation;if(r.tensorName!=null&&(d.tensorName=String(r.tensorName)),r.quantParameterTensorNames){if(!Array.isArray(r.quantParameterTensorNames))throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: array expected");d.quantParameterTensorNames=[];for(var p=0;p<r.quantParameterTensorNames.length;++p){if(typeof r.quantParameterTensorNames[p]!="object")throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: object expected");d.quantParameterTensorNames[p]=f.onnx.StringStringEntryProto.fromObject(r.quantParameterTensorNames[p])}}return d},i.toObject=function(r,d){d||(d={});var p={};if((d.arrays||d.defaults)&&(p.quantParameterTensorNames=[]),d.defaults&&(p.tensorName=""),r.tensorName!=null&&r.hasOwnProperty("tensorName")&&(p.tensorName=r.tensorName),r.quantParameterTensorNames&&r.quantParameterTensorNames.length){p.quantParameterTensorNames=[];for(var _=0;_<r.quantParameterTensorNames.length;++_)p.quantParameterTensorNames[_]=f.onnx.StringStringEntryProto.toObject(r.quantParameterTensorNames[_],d)}return p},i.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},i})(),u.GraphProto=(function(){function i(r){if(this.node=[],this.initializer=[],this.input=[],this.output=[],this.valueInfo=[],this.quantizationAnnotation=[],r)for(var d=Object.keys(r),p=0;p<d.length;++p)r[d[p]]!=null&&(this[d[p]]=r[d[p]])}return i.prototype.node=h.emptyArray,i.prototype.name="",i.prototype.initializer=h.emptyArray,i.prototype.docString="",i.prototype.input=h.emptyArray,i.prototype.output=h.emptyArray,i.prototype.valueInfo=h.emptyArray,i.prototype.quantizationAnnotation=h.emptyArray,i.create=function(r){return new i(r)},i.encode=function(r,d){if(d||(d=g.create()),r.node!=null&&r.node.length)for(var p=0;p<r.node.length;++p)f.onnx.NodeProto.encode(r.node[p],d.uint32(10).fork()).ldelim();if(r.name!=null&&r.hasOwnProperty("name")&&d.uint32(18).string(r.name),r.initializer!=null&&r.initializer.length)for(p=0;p<r.initializer.length;++p)f.onnx.TensorProto.encode(r.initializer[p],d.uint32(42).fork()).ldelim();if(r.docString!=null&&r.hasOwnProperty("docString")&&d.uint32(82).string(r.docString),r.input!=null&&r.input.length)for(p=0;p<r.input.length;++p)f.onnx.ValueInfoProto.encode(r.input[p],d.uint32(90).fork()).ldelim();if(r.output!=null&&r.output.length)for(p=0;p<r.output.length;++p)f.onnx.ValueInfoProto.encode(r.output[p],d.uint32(98).fork()).ldelim();if(r.valueInfo!=null&&r.valueInfo.length)for(p=0;p<r.valueInfo.length;++p)f.onnx.ValueInfoProto.encode(r.valueInfo[p],d.uint32(106).fork()).ldelim();if(r.quantizationAnnotation!=null&&r.quantizationAnnotation.length)for(p=0;p<r.quantizationAnnotation.length;++p)f.onnx.TensorAnnotation.encode(r.quantizationAnnotation[p],d.uint32(114).fork()).ldelim();return d},i.encodeDelimited=function(r,d){return this.encode(r,d).ldelim()},i.decode=function(r,d){r instanceof m||(r=m.create(r));for(var p=d===void 0?r.len:r.pos+d,_=new f.onnx.GraphProto;r.pos<p;){var y=r.uint32();switch(y>>>3){case 1:_.node&&_.node.length||(_.node=[]),_.node.push(f.onnx.NodeProto.decode(r,r.uint32()));break;case 2:_.name=r.string();break;case 5:_.initializer&&_.initializer.length||(_.initializer=[]),_.initializer.push(f.onnx.TensorProto.decode(r,r.uint32()));break;case 10:_.docString=r.string();break;case 11:_.input&&_.input.length||(_.input=[]),_.input.push(f.onnx.ValueInfoProto.decode(r,r.uint32()));break;case 12:_.output&&_.output.length||(_.output=[]),_.output.push(f.onnx.ValueInfoProto.decode(r,r.uint32()));break;case 13:_.valueInfo&&_.valueInfo.length||(_.valueInfo=[]),_.valueInfo.push(f.onnx.ValueInfoProto.decode(r,r.uint32()));break;case 14:_.quantizationAnnotation&&_.quantizationAnnotation.length||(_.quantizationAnnotation=[]),_.quantizationAnnotation.push(f.onnx.TensorAnnotation.decode(r,r.uint32()));break;default:r.skipType(7&y)}}return _},i.decodeDelimited=function(r){return r instanceof m||(r=new m(r)),this.decode(r,r.uint32())},i.verify=function(r){if(typeof r!="object"||r===null)return"object expected";if(r.node!=null&&r.hasOwnProperty("node")){if(!Array.isArray(r.node))return"node: array expected";for(var d=0;d<r.node.length;++d)if(p=f.onnx.NodeProto.verify(r.node[d]))return"node."+p}if(r.name!=null&&r.hasOwnProperty("name")&&!h.isString(r.name))return"name: string expected";if(r.initializer!=null&&r.hasOwnProperty("initializer")){if(!Array.isArray(r.initializer))return"initializer: array expected";for(d=0;d<r.initializer.length;++d)if(p=f.onnx.TensorProto.verify(r.initializer[d]))return"initializer."+p}if(r.docString!=null&&r.hasOwnProperty("docString")&&!h.isString(r.docString))return"docString: string expected";if(r.input!=null&&r.hasOwnProperty("input")){if(!Array.isArray(r.input))return"input: array expected";for(d=0;d<r.input.length;++d)if(p=f.onnx.ValueInfoProto.verify(r.input[d]))return"input."+p}if(r.output!=null&&r.hasOwnProperty("output")){if(!Array.isArray(r.output))return"output: array expected";for(d=0;d<r.output.length;++d)if(p=f.onnx.ValueInfoProto.verify(r.output[d]))return"output."+p}if(r.valueInfo!=null&&r.hasOwnProperty("valueInfo")){if(!Array.isArray(r.valueInfo))return"valueInfo: array expected";for(d=0;d<r.valueInfo.length;++d)if(p=f.onnx.ValueInfoProto.verify(r.valueInfo[d]))return"valueInfo."+p}if(r.quantizationAnnotation!=null&&r.hasOwnProperty("quantizationAnnotation")){if(!Array.isArray(r.quantizationAnnotation))return"quantizationAnnotation: array expected";for(d=0;d<r.quantizationAnnotation.length;++d){var p;if(p=f.onnx.TensorAnnotation.verify(r.quantizationAnnotation[d]))return"quantizationAnnotation."+p}}return null},i.fromObject=function(r){if(r instanceof f.onnx.GraphProto)return r;var d=new f.onnx.GraphProto;if(r.node){if(!Array.isArray(r.node))throw TypeError(".onnx.GraphProto.node: array expected");d.node=[];for(var p=0;p<r.node.length;++p){if(typeof r.node[p]!="object")throw TypeError(".onnx.GraphProto.node: object expected");d.node[p]=f.onnx.NodeProto.fromObject(r.node[p])}}if(r.name!=null&&(d.name=String(r.name)),r.initializer){if(!Array.isArray(r.initializer))throw TypeError(".onnx.GraphProto.initializer: array expected");for(d.initializer=[],p=0;p<r.initializer.length;++p){if(typeof r.initializer[p]!="object")throw TypeError(".onnx.GraphProto.initializer: object expected");d.initializer[p]=f.onnx.TensorProto.fromObject(r.initializer[p])}}if(r.docString!=null&&(d.docString=String(r.docString)),r.input){if(!Array.isArray(r.input))throw TypeError(".onnx.GraphProto.input: array expected");for(d.input=[],p=0;p<r.input.length;++p){if(typeof r.input[p]!="object")throw TypeError(".onnx.GraphProto.input: object expected");d.input[p]=f.onnx.ValueInfoProto.fromObject(r.input[p])}}if(r.output){if(!Array.isArray(r.output))throw TypeError(".onnx.GraphProto.output: array expected");for(d.output=[],p=0;p<r.output.length;++p){if(typeof r.output[p]!="object")throw TypeError(".onnx.GraphProto.output: object expected");d.output[p]=f.onnx.ValueInfoProto.fromObject(r.output[p])}}if(r.valueInfo){if(!Array.isArray(r.valueInfo))throw TypeError(".onnx.GraphProto.valueInfo: array expected");for(d.valueInfo=[],p=0;p<r.valueInfo.length;++p){if(typeof r.valueInfo[p]!="object")throw TypeError(".onnx.GraphProto.valueInfo: object expected");d.valueInfo[p]=f.onnx.ValueInfoProto.fromObject(r.valueInfo[p])}}if(r.quantizationAnnotation){if(!Array.isArray(r.quantizationAnnotation))throw TypeError(".onnx.GraphProto.quantizationAnnotation: array expected");for(d.quantizationAnnotation=[],p=0;p<r.quantizationAnnotation.length;++p){if(typeof r.quantizationAnnotation[p]!="object")throw TypeError(".onnx.GraphProto.quantizationAnnotation: object expected");d.quantizationAnnotation[p]=f.onnx.TensorAnnotation.fromObject(r.quantizationAnnotation[p])}}return d},i.toObject=function(r,d){d||(d={});var p={};if((d.arrays||d.defaults)&&(p.node=[],p.initializer=[],p.input=[],p.output=[],p.valueInfo=[],p.quantizationAnnotation=[]),d.defaults&&(p.name="",p.docString=""),r.node&&r.node.length){p.node=[];for(var _=0;_<r.node.length;++_)p.node[_]=f.onnx.NodeProto.toObject(r.node[_],d)}if(r.name!=null&&r.hasOwnProperty("name")&&(p.name=r.name),r.initializer&&r.initializer.length)for(p.initializer=[],_=0;_<r.initializer.length;++_)p.initializer[_]=f.onnx.TensorProto.toObject(r.initializer[_],d);if(r.docString!=null&&r.hasOwnProperty("docString")&&(p.docString=r.docString),r.input&&r.input.length)for(p.input=[],_=0;_<r.input.length;++_)p.input[_]=f.onnx.ValueInfoProto.toObject(r.input[_],d);if(r.output&&r.output.length)for(p.output=[],_=0;_<r.output.length;++_)p.output[_]=f.onnx.ValueInfoProto.toObject(r.output[_],d);if(r.valueInfo&&r.valueInfo.length)for(p.valueInfo=[],_=0;_<r.valueInfo.length;++_)p.valueInfo[_]=f.onnx.ValueInfoProto.toObject(r.valueInfo[_],d);if(r.quantizationAnnotation&&r.quantizationAnnotation.length)for(p.quantizationAnnotation=[],_=0;_<r.quantizationAnnotation.length;++_)p.quantizationAnnotation[_]=f.onnx.TensorAnnotation.toObject(r.quantizationAnnotation[_],d);return p},i.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},i})(),u.TensorProto=(function(){function i(r){if(this.dims=[],this.floatData=[],this.int32Data=[],this.stringData=[],this.int64Data=[],this.externalData=[],this.doubleData=[],this.uint64Data=[],r)for(var d=Object.keys(r),p=0;p<d.length;++p)r[d[p]]!=null&&(this[d[p]]=r[d[p]])}return i.prototype.dims=h.emptyArray,i.prototype.dataType=0,i.prototype.segment=null,i.prototype.floatData=h.emptyArray,i.prototype.int32Data=h.emptyArray,i.prototype.stringData=h.emptyArray,i.prototype.int64Data=h.emptyArray,i.prototype.name="",i.prototype.docString="",i.prototype.rawData=h.newBuffer([]),i.prototype.externalData=h.emptyArray,i.prototype.dataLocation=0,i.prototype.doubleData=h.emptyArray,i.prototype.uint64Data=h.emptyArray,i.create=function(r){return new i(r)},i.encode=function(r,d){if(d||(d=g.create()),r.dims!=null&&r.dims.length){d.uint32(10).fork();for(var p=0;p<r.dims.length;++p)d.int64(r.dims[p]);d.ldelim()}if(r.dataType!=null&&r.hasOwnProperty("dataType")&&d.uint32(16).int32(r.dataType),r.segment!=null&&r.hasOwnProperty("segment")&&f.onnx.TensorProto.Segment.encode(r.segment,d.uint32(26).fork()).ldelim(),r.floatData!=null&&r.floatData.length){for(d.uint32(34).fork(),p=0;p<r.floatData.length;++p)d.float(r.floatData[p]);d.ldelim()}if(r.int32Data!=null&&r.int32Data.length){for(d.uint32(42).fork(),p=0;p<r.int32Data.length;++p)d.int32(r.int32Data[p]);d.ldelim()}if(r.stringData!=null&&r.stringData.length)for(p=0;p<r.stringData.length;++p)d.uint32(50).bytes(r.stringData[p]);if(r.int64Data!=null&&r.int64Data.length){for(d.uint32(58).fork(),p=0;p<r.int64Data.length;++p)d.int64(r.int64Data[p]);d.ldelim()}if(r.name!=null&&r.hasOwnProperty("name")&&d.uint32(66).string(r.name),r.rawData!=null&&r.hasOwnProperty("rawData")&&d.uint32(74).bytes(r.rawData),r.doubleData!=null&&r.doubleData.length){for(d.uint32(82).fork(),p=0;p<r.doubleData.length;++p)d.double(r.doubleData[p]);d.ldelim()}if(r.uint64Data!=null&&r.uint64Data.length){for(d.uint32(90).fork(),p=0;p<r.uint64Data.length;++p)d.uint64(r.uint64Data[p]);d.ldelim()}if(r.docString!=null&&r.hasOwnProperty("docString")&&d.uint32(98).string(r.docString),r.externalData!=null&&r.externalData.length)for(p=0;p<r.externalData.length;++p)f.onnx.StringStringEntryProto.encode(r.externalData[p],d.uint32(106).fork()).ldelim();return r.dataLocation!=null&&r.hasOwnProperty("dataLocation")&&d.uint32(112).int32(r.dataLocation),d},i.encodeDelimited=function(r,d){return this.encode(r,d).ldelim()},i.decode=function(r,d){r instanceof m||(r=m.create(r));for(var p=d===void 0?r.len:r.pos+d,_=new f.onnx.TensorProto;r.pos<p;){var y=r.uint32();switch(y>>>3){case 1:if(_.dims&&_.dims.length||(_.dims=[]),(7&y)==2)for(var v=r.uint32()+r.pos;r.pos<v;)_.dims.push(r.int64());else _.dims.push(r.int64());break;case 2:_.dataType=r.int32();break;case 3:_.segment=f.onnx.TensorProto.Segment.decode(r,r.uint32());break;case 4:if(_.floatData&&_.floatData.length||(_.floatData=[]),(7&y)==2)for(v=r.uint32()+r.pos;r.pos<v;)_.floatData.push(r.float());else _.floatData.push(r.float());break;case 5:if(_.int32Data&&_.int32Data.length||(_.int32Data=[]),(7&y)==2)for(v=r.uint32()+r.pos;r.pos<v;)_.int32Data.push(r.int32());else _.int32Data.push(r.int32());break;case 6:_.stringData&&_.stringData.length||(_.stringData=[]),_.stringData.push(r.bytes());break;case 7:if(_.int64Data&&_.int64Data.length||(_.int64Data=[]),(7&y)==2)for(v=r.uint32()+r.pos;r.pos<v;)_.int64Data.push(r.int64());else _.int64Data.push(r.int64());break;case 8:_.name=r.string();break;case 12:_.docString=r.string();break;case 9:_.rawData=r.bytes();break;case 13:_.externalData&&_.externalData.length||(_.externalData=[]),_.externalData.push(f.onnx.StringStringEntryProto.decode(r,r.uint32()));break;case 14:_.dataLocation=r.int32();break;case 10:if(_.doubleData&&_.doubleData.length||(_.doubleData=[]),(7&y)==2)for(v=r.uint32()+r.pos;r.pos<v;)_.doubleData.push(r.double());else _.doubleData.push(r.double());break;case 11:if(_.uint64Data&&_.uint64Data.length||(_.uint64Data=[]),(7&y)==2)for(v=r.uint32()+r.pos;r.pos<v;)_.uint64Data.push(r.uint64());else _.uint64Data.push(r.uint64());break;default:r.skipType(7&y)}}return _},i.decodeDelimited=function(r){return r instanceof m||(r=new m(r)),this.decode(r,r.uint32())},i.verify=function(r){if(typeof r!="object"||r===null)return"object expected";if(r.dims!=null&&r.hasOwnProperty("dims")){if(!Array.isArray(r.dims))return"dims: array expected";for(var d=0;d<r.dims.length;++d)if(!(h.isInteger(r.dims[d])||r.dims[d]&&h.isInteger(r.dims[d].low)&&h.isInteger(r.dims[d].high)))return"dims: integer|Long[] expected"}if(r.dataType!=null&&r.hasOwnProperty("dataType")&&!h.isInteger(r.dataType))return"dataType: integer expected";if(r.segment!=null&&r.hasOwnProperty("segment")&&(p=f.onnx.TensorProto.Segment.verify(r.segment)))return"segment."+p;if(r.floatData!=null&&r.hasOwnProperty("floatData")){if(!Array.isArray(r.floatData))return"floatData: array expected";for(d=0;d<r.floatData.length;++d)if(typeof r.floatData[d]!="number")return"floatData: number[] expected"}if(r.int32Data!=null&&r.hasOwnProperty("int32Data")){if(!Array.isArray(r.int32Data))return"int32Data: array expected";for(d=0;d<r.int32Data.length;++d)if(!h.isInteger(r.int32Data[d]))return"int32Data: integer[] expected"}if(r.stringData!=null&&r.hasOwnProperty("stringData")){if(!Array.isArray(r.stringData))return"stringData: array expected";for(d=0;d<r.stringData.length;++d)if(!(r.stringData[d]&&typeof r.stringData[d].length=="number"||h.isString(r.stringData[d])))return"stringData: buffer[] expected"}if(r.int64Data!=null&&r.hasOwnProperty("int64Data")){if(!Array.isArray(r.int64Data))return"int64Data: array expected";for(d=0;d<r.int64Data.length;++d)if(!(h.isInteger(r.int64Data[d])||r.int64Data[d]&&h.isInteger(r.int64Data[d].low)&&h.isInteger(r.int64Data[d].high)))return"int64Data: integer|Long[] expected"}if(r.name!=null&&r.hasOwnProperty("name")&&!h.isString(r.name))return"name: string expected";if(r.docString!=null&&r.hasOwnProperty("docString")&&!h.isString(r.docString))return"docString: string expected";if(r.rawData!=null&&r.hasOwnProperty("rawData")&&!(r.rawData&&typeof r.rawData.length=="number"||h.isString(r.rawData)))return"rawData: buffer expected";if(r.externalData!=null&&r.hasOwnProperty("externalData")){if(!Array.isArray(r.externalData))return"externalData: array expected";for(d=0;d<r.externalData.length;++d){var p;if(p=f.onnx.StringStringEntryProto.verify(r.externalData[d]))return"externalData."+p}}if(r.dataLocation!=null&&r.hasOwnProperty("dataLocation"))switch(r.dataLocation){default:return"dataLocation: enum value expected";case 0:case 1:}if(r.doubleData!=null&&r.hasOwnProperty("doubleData")){if(!Array.isArray(r.doubleData))return"doubleData: array expected";for(d=0;d<r.doubleData.length;++d)if(typeof r.doubleData[d]!="number")return"doubleData: number[] expected"}if(r.uint64Data!=null&&r.hasOwnProperty("uint64Data")){if(!Array.isArray(r.uint64Data))return"uint64Data: array expected";for(d=0;d<r.uint64Data.length;++d)if(!(h.isInteger(r.uint64Data[d])||r.uint64Data[d]&&h.isInteger(r.uint64Data[d].low)&&h.isInteger(r.uint64Data[d].high)))return"uint64Data: integer|Long[] expected"}return null},i.fromObject=function(r){if(r instanceof f.onnx.TensorProto)return r;var d=new f.onnx.TensorProto;if(r.dims){if(!Array.isArray(r.dims))throw TypeError(".onnx.TensorProto.dims: array expected");d.dims=[];for(var p=0;p<r.dims.length;++p)h.Long?(d.dims[p]=h.Long.fromValue(r.dims[p])).unsigned=!1:typeof r.dims[p]=="string"?d.dims[p]=parseInt(r.dims[p],10):typeof r.dims[p]=="number"?d.dims[p]=r.dims[p]:typeof r.dims[p]=="object"&&(d.dims[p]=new h.LongBits(r.dims[p].low>>>0,r.dims[p].high>>>0).toNumber())}if(r.dataType!=null&&(d.dataType=0|r.dataType),r.segment!=null){if(typeof r.segment!="object")throw TypeError(".onnx.TensorProto.segment: object expected");d.segment=f.onnx.TensorProto.Segment.fromObject(r.segment)}if(r.floatData){if(!Array.isArray(r.floatData))throw TypeError(".onnx.TensorProto.floatData: array expected");for(d.floatData=[],p=0;p<r.floatData.length;++p)d.floatData[p]=Number(r.floatData[p])}if(r.int32Data){if(!Array.isArray(r.int32Data))throw TypeError(".onnx.TensorProto.int32Data: array expected");for(d.int32Data=[],p=0;p<r.int32Data.length;++p)d.int32Data[p]=0|r.int32Data[p]}if(r.stringData){if(!Array.isArray(r.stringData))throw TypeError(".onnx.TensorProto.stringData: array expected");for(d.stringData=[],p=0;p<r.stringData.length;++p)typeof r.stringData[p]=="string"?h.base64.decode(r.stringData[p],d.stringData[p]=h.newBuffer(h.base64.length(r.stringData[p])),0):r.stringData[p].length&&(d.stringData[p]=r.stringData[p])}if(r.int64Data){if(!Array.isArray(r.int64Data))throw TypeError(".onnx.TensorProto.int64Data: array expected");for(d.int64Data=[],p=0;p<r.int64Data.length;++p)h.Long?(d.int64Data[p]=h.Long.fromValue(r.int64Data[p])).unsigned=!1:typeof r.int64Data[p]=="string"?d.int64Data[p]=parseInt(r.int64Data[p],10):typeof r.int64Data[p]=="number"?d.int64Data[p]=r.int64Data[p]:typeof r.int64Data[p]=="object"&&(d.int64Data[p]=new h.LongBits(r.int64Data[p].low>>>0,r.int64Data[p].high>>>0).toNumber())}if(r.name!=null&&(d.name=String(r.name)),r.docString!=null&&(d.docString=String(r.docString)),r.rawData!=null&&(typeof r.rawData=="string"?h.base64.decode(r.rawData,d.rawData=h.newBuffer(h.base64.length(r.rawData)),0):r.rawData.length&&(d.rawData=r.rawData)),r.externalData){if(!Array.isArray(r.externalData))throw TypeError(".onnx.TensorProto.externalData: array expected");for(d.externalData=[],p=0;p<r.externalData.length;++p){if(typeof r.externalData[p]!="object")throw TypeError(".onnx.TensorProto.externalData: object expected");d.externalData[p]=f.onnx.StringStringEntryProto.fromObject(r.externalData[p])}}switch(r.dataLocation){case"DEFAULT":case 0:d.dataLocation=0;break;case"EXTERNAL":case 1:d.dataLocation=1}if(r.doubleData){if(!Array.isArray(r.doubleData))throw TypeError(".onnx.TensorProto.doubleData: array expected");for(d.doubleData=[],p=0;p<r.doubleData.length;++p)d.doubleData[p]=Number(r.doubleData[p])}if(r.uint64Data){if(!Array.isArray(r.uint64Data))throw TypeError(".onnx.TensorProto.uint64Data: array expected");for(d.uint64Data=[],p=0;p<r.uint64Data.length;++p)h.Long?(d.uint64Data[p]=h.Long.fromValue(r.uint64Data[p])).unsigned=!0:typeof r.uint64Data[p]=="string"?d.uint64Data[p]=parseInt(r.uint64Data[p],10):typeof r.uint64Data[p]=="number"?d.uint64Data[p]=r.uint64Data[p]:typeof r.uint64Data[p]=="object"&&(d.uint64Data[p]=new h.LongBits(r.uint64Data[p].low>>>0,r.uint64Data[p].high>>>0).toNumber(!0))}return d},i.toObject=function(r,d){d||(d={});var p={};if((d.arrays||d.defaults)&&(p.dims=[],p.floatData=[],p.int32Data=[],p.stringData=[],p.int64Data=[],p.doubleData=[],p.uint64Data=[],p.externalData=[]),d.defaults&&(p.dataType=0,p.segment=null,p.name="",d.bytes===String?p.rawData="":(p.rawData=[],d.bytes!==Array&&(p.rawData=h.newBuffer(p.rawData))),p.docString="",p.dataLocation=d.enums===String?"DEFAULT":0),r.dims&&r.dims.length){p.dims=[];for(var _=0;_<r.dims.length;++_)typeof r.dims[_]=="number"?p.dims[_]=d.longs===String?String(r.dims[_]):r.dims[_]:p.dims[_]=d.longs===String?h.Long.prototype.toString.call(r.dims[_]):d.longs===Number?new h.LongBits(r.dims[_].low>>>0,r.dims[_].high>>>0).toNumber():r.dims[_]}if(r.dataType!=null&&r.hasOwnProperty("dataType")&&(p.dataType=r.dataType),r.segment!=null&&r.hasOwnProperty("segment")&&(p.segment=f.onnx.TensorProto.Segment.toObject(r.segment,d)),r.floatData&&r.floatData.length)for(p.floatData=[],_=0;_<r.floatData.length;++_)p.floatData[_]=d.json&&!isFinite(r.floatData[_])?String(r.floatData[_]):r.floatData[_];if(r.int32Data&&r.int32Data.length)for(p.int32Data=[],_=0;_<r.int32Data.length;++_)p.int32Data[_]=r.int32Data[_];if(r.stringData&&r.stringData.length)for(p.stringData=[],_=0;_<r.stringData.length;++_)p.stringData[_]=d.bytes===String?h.base64.encode(r.stringData[_],0,r.stringData[_].length):d.bytes===Array?Array.prototype.slice.call(r.stringData[_]):r.stringData[_];if(r.int64Data&&r.int64Data.length)for(p.int64Data=[],_=0;_<r.int64Data.length;++_)typeof r.int64Data[_]=="number"?p.int64Data[_]=d.longs===String?String(r.int64Data[_]):r.int64Data[_]:p.int64Data[_]=d.longs===String?h.Long.prototype.toString.call(r.int64Data[_]):d.longs===Number?new h.LongBits(r.int64Data[_].low>>>0,r.int64Data[_].high>>>0).toNumber():r.int64Data[_];if(r.name!=null&&r.hasOwnProperty("name")&&(p.name=r.name),r.rawData!=null&&r.hasOwnProperty("rawData")&&(p.rawData=d.bytes===String?h.base64.encode(r.rawData,0,r.rawData.length):d.bytes===Array?Array.prototype.slice.call(r.rawData):r.rawData),r.doubleData&&r.doubleData.length)for(p.doubleData=[],_=0;_<r.doubleData.length;++_)p.doubleData[_]=d.json&&!isFinite(r.doubleData[_])?String(r.doubleData[_]):r.doubleData[_];if(r.uint64Data&&r.uint64Data.length)for(p.uint64Data=[],_=0;_<r.uint64Data.length;++_)typeof r.uint64Data[_]=="number"?p.uint64Data[_]=d.longs===String?String(r.uint64Data[_]):r.uint64Data[_]:p.uint64Data[_]=d.longs===String?h.Long.prototype.toString.call(r.uint64Data[_]):d.longs===Number?new h.LongBits(r.uint64Data[_].low>>>0,r.uint64Data[_].high>>>0).toNumber(!0):r.uint64Data[_];if(r.docString!=null&&r.hasOwnProperty("docString")&&(p.docString=r.docString),r.externalData&&r.externalData.length)for(p.externalData=[],_=0;_<r.externalData.length;++_)p.externalData[_]=f.onnx.StringStringEntryProto.toObject(r.externalData[_],d);return r.dataLocation!=null&&r.hasOwnProperty("dataLocation")&&(p.dataLocation=d.enums===String?f.onnx.TensorProto.DataLocation[r.dataLocation]:r.dataLocation),p},i.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},i.DataType=(function(){var r={},d=Object.create(r);return d[r[0]="UNDEFINED"]=0,d[r[1]="FLOAT"]=1,d[r[2]="UINT8"]=2,d[r[3]="INT8"]=3,d[r[4]="UINT16"]=4,d[r[5]="INT16"]=5,d[r[6]="INT32"]=6,d[r[7]="INT64"]=7,d[r[8]="STRING"]=8,d[r[9]="BOOL"]=9,d[r[10]="FLOAT16"]=10,d[r[11]="DOUBLE"]=11,d[r[12]="UINT32"]=12,d[r[13]="UINT64"]=13,d[r[14]="COMPLEX64"]=14,d[r[15]="COMPLEX128"]=15,d[r[16]="BFLOAT16"]=16,d})(),i.Segment=(function(){function r(d){if(d)for(var p=Object.keys(d),_=0;_<p.length;++_)d[p[_]]!=null&&(this[p[_]]=d[p[_]])}return r.prototype.begin=h.Long?h.Long.fromBits(0,0,!1):0,r.prototype.end=h.Long?h.Long.fromBits(0,0,!1):0,r.create=function(d){return new r(d)},r.encode=function(d,p){return p||(p=g.create()),d.begin!=null&&d.hasOwnProperty("begin")&&p.uint32(8).int64(d.begin),d.end!=null&&d.hasOwnProperty("end")&&p.uint32(16).int64(d.end),p},r.encodeDelimited=function(d,p){return this.encode(d,p).ldelim()},r.decode=function(d,p){d instanceof m||(d=m.create(d));for(var _=p===void 0?d.len:d.pos+p,y=new f.onnx.TensorProto.Segment;d.pos<_;){var v=d.uint32();switch(v>>>3){case 1:y.begin=d.int64();break;case 2:y.end=d.int64();break;default:d.skipType(7&v)}}return y},r.decodeDelimited=function(d){return d instanceof m||(d=new m(d)),this.decode(d,d.uint32())},r.verify=function(d){return typeof d!="object"||d===null?"object expected":d.begin!=null&&d.hasOwnProperty("begin")&&!(h.isInteger(d.begin)||d.begin&&h.isInteger(d.begin.low)&&h.isInteger(d.begin.high))?"begin: integer|Long expected":d.end!=null&&d.hasOwnProperty("end")&&!(h.isInteger(d.end)||d.end&&h.isInteger(d.end.low)&&h.isInteger(d.end.high))?"end: integer|Long expected":null},r.fromObject=function(d){if(d instanceof f.onnx.TensorProto.Segment)return d;var p=new f.onnx.TensorProto.Segment;return d.begin!=null&&(h.Long?(p.begin=h.Long.fromValue(d.begin)).unsigned=!1:typeof d.begin=="string"?p.begin=parseInt(d.begin,10):typeof d.begin=="number"?p.begin=d.begin:typeof d.begin=="object"&&(p.begin=new h.LongBits(d.begin.low>>>0,d.begin.high>>>0).toNumber())),d.end!=null&&(h.Long?(p.end=h.Long.fromValue(d.end)).unsigned=!1:typeof d.end=="string"?p.end=parseInt(d.end,10):typeof d.end=="number"?p.end=d.end:typeof d.end=="object"&&(p.end=new h.LongBits(d.end.low>>>0,d.end.high>>>0).toNumber())),p},r.toObject=function(d,p){p||(p={});var _={};if(p.defaults){if(h.Long){var y=new h.Long(0,0,!1);_.begin=p.longs===String?y.toString():p.longs===Number?y.toNumber():y}else _.begin=p.longs===String?"0":0;h.Long?(y=new h.Long(0,0,!1),_.end=p.longs===String?y.toString():p.longs===Number?y.toNumber():y):_.end=p.longs===String?"0":0}return d.begin!=null&&d.hasOwnProperty("begin")&&(typeof d.begin=="number"?_.begin=p.longs===String?String(d.begin):d.begin:_.begin=p.longs===String?h.Long.prototype.toString.call(d.begin):p.longs===Number?new h.LongBits(d.begin.low>>>0,d.begin.high>>>0).toNumber():d.begin),d.end!=null&&d.hasOwnProperty("end")&&(typeof d.end=="number"?_.end=p.longs===String?String(d.end):d.end:_.end=p.longs===String?h.Long.prototype.toString.call(d.end):p.longs===Number?new h.LongBits(d.end.low>>>0,d.end.high>>>0).toNumber():d.end),_},r.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},r})(),i.DataLocation=(function(){var r={},d=Object.create(r);return d[r[0]="DEFAULT"]=0,d[r[1]="EXTERNAL"]=1,d})(),i})(),u.TensorShapeProto=(function(){function i(r){if(this.dim=[],r)for(var d=Object.keys(r),p=0;p<d.length;++p)r[d[p]]!=null&&(this[d[p]]=r[d[p]])}return i.prototype.dim=h.emptyArray,i.create=function(r){return new i(r)},i.encode=function(r,d){if(d||(d=g.create()),r.dim!=null&&r.dim.length)for(var p=0;p<r.dim.length;++p)f.onnx.TensorShapeProto.Dimension.encode(r.dim[p],d.uint32(10).fork()).ldelim();return d},i.encodeDelimited=function(r,d){return this.encode(r,d).ldelim()},i.decode=function(r,d){r instanceof m||(r=m.create(r));for(var p=d===void 0?r.len:r.pos+d,_=new f.onnx.TensorShapeProto;r.pos<p;){var y=r.uint32();y>>>3==1?(_.dim&&_.dim.length||(_.dim=[]),_.dim.push(f.onnx.TensorShapeProto.Dimension.decode(r,r.uint32()))):r.skipType(7&y)}return _},i.decodeDelimited=function(r){return r instanceof m||(r=new m(r)),this.decode(r,r.uint32())},i.verify=function(r){if(typeof r!="object"||r===null)return"object expected";if(r.dim!=null&&r.hasOwnProperty("dim")){if(!Array.isArray(r.dim))return"dim: array expected";for(var d=0;d<r.dim.length;++d){var p=f.onnx.TensorShapeProto.Dimension.verify(r.dim[d]);if(p)return"dim."+p}}return null},i.fromObject=function(r){if(r instanceof f.onnx.TensorShapeProto)return r;var d=new f.onnx.TensorShapeProto;if(r.dim){if(!Array.isArray(r.dim))throw TypeError(".onnx.TensorShapeProto.dim: array expected");d.dim=[];for(var p=0;p<r.dim.length;++p){if(typeof r.dim[p]!="object")throw TypeError(".onnx.TensorShapeProto.dim: object expected");d.dim[p]=f.onnx.TensorShapeProto.Dimension.fromObject(r.dim[p])}}return d},i.toObject=function(r,d){d||(d={});var p={};if((d.arrays||d.defaults)&&(p.dim=[]),r.dim&&r.dim.length){p.dim=[];for(var _=0;_<r.dim.length;++_)p.dim[_]=f.onnx.TensorShapeProto.Dimension.toObject(r.dim[_],d)}return p},i.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},i.Dimension=(function(){function r(p){if(p)for(var _=Object.keys(p),y=0;y<_.length;++y)p[_[y]]!=null&&(this[_[y]]=p[_[y]])}var d;return r.prototype.dimValue=h.Long?h.Long.fromBits(0,0,!1):0,r.prototype.dimParam="",r.prototype.denotation="",Object.defineProperty(r.prototype,"value",{get:h.oneOfGetter(d=["dimValue","dimParam"]),set:h.oneOfSetter(d)}),r.create=function(p){return new r(p)},r.encode=function(p,_){return _||(_=g.create()),p.dimValue!=null&&p.hasOwnProperty("dimValue")&&_.uint32(8).int64(p.dimValue),p.dimParam!=null&&p.hasOwnProperty("dimParam")&&_.uint32(18).string(p.dimParam),p.denotation!=null&&p.hasOwnProperty("denotation")&&_.uint32(26).string(p.denotation),_},r.encodeDelimited=function(p,_){return this.encode(p,_).ldelim()},r.decode=function(p,_){p instanceof m||(p=m.create(p));for(var y=_===void 0?p.len:p.pos+_,v=new f.onnx.TensorShapeProto.Dimension;p.pos<y;){var T=p.uint32();switch(T>>>3){case 1:v.dimValue=p.int64();break;case 2:v.dimParam=p.string();break;case 3:v.denotation=p.string();break;default:p.skipType(7&T)}}return v},r.decodeDelimited=function(p){return p instanceof m||(p=new m(p)),this.decode(p,p.uint32())},r.verify=function(p){if(typeof p!="object"||p===null)return"object expected";var _={};if(p.dimValue!=null&&p.hasOwnProperty("dimValue")&&(_.value=1,!(h.isInteger(p.dimValue)||p.dimValue&&h.isInteger(p.dimValue.low)&&h.isInteger(p.dimValue.high))))return"dimValue: integer|Long expected";if(p.dimParam!=null&&p.hasOwnProperty("dimParam")){if(_.value===1)return"value: multiple values";if(_.value=1,!h.isString(p.dimParam))return"dimParam: string expected"}return p.denotation!=null&&p.hasOwnProperty("denotation")&&!h.isString(p.denotation)?"denotation: string expected":null},r.fromObject=function(p){if(p instanceof f.onnx.TensorShapeProto.Dimension)return p;var _=new f.onnx.TensorShapeProto.Dimension;return p.dimValue!=null&&(h.Long?(_.dimValue=h.Long.fromValue(p.dimValue)).unsigned=!1:typeof p.dimValue=="string"?_.dimValue=parseInt(p.dimValue,10):typeof p.dimValue=="number"?_.dimValue=p.dimValue:typeof p.dimValue=="object"&&(_.dimValue=new h.LongBits(p.dimValue.low>>>0,p.dimValue.high>>>0).toNumber())),p.dimParam!=null&&(_.dimParam=String(p.dimParam)),p.denotation!=null&&(_.denotation=String(p.denotation)),_},r.toObject=function(p,_){_||(_={});var y={};return _.defaults&&(y.denotation=""),p.dimValue!=null&&p.hasOwnProperty("dimValue")&&(typeof p.dimValue=="number"?y.dimValue=_.longs===String?String(p.dimValue):p.dimValue:y.dimValue=_.longs===String?h.Long.prototype.toString.call(p.dimValue):_.longs===Number?new h.LongBits(p.dimValue.low>>>0,p.dimValue.high>>>0).toNumber():p.dimValue,_.oneofs&&(y.value="dimValue")),p.dimParam!=null&&p.hasOwnProperty("dimParam")&&(y.dimParam=p.dimParam,_.oneofs&&(y.value="dimParam")),p.denotation!=null&&p.hasOwnProperty("denotation")&&(y.denotation=p.denotation),y},r.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},r})(),i})(),u.TypeProto=(function(){function i(d){if(d)for(var p=Object.keys(d),_=0;_<p.length;++_)d[p[_]]!=null&&(this[p[_]]=d[p[_]])}var r;return i.prototype.tensorType=null,i.prototype.denotation="",Object.defineProperty(i.prototype,"value",{get:h.oneOfGetter(r=["tensorType"]),set:h.oneOfSetter(r)}),i.create=function(d){return new i(d)},i.encode=function(d,p){return p||(p=g.create()),d.tensorType!=null&&d.hasOwnProperty("tensorType")&&f.onnx.TypeProto.Tensor.encode(d.tensorType,p.uint32(10).fork()).ldelim(),d.denotation!=null&&d.hasOwnProperty("denotation")&&p.uint32(50).string(d.denotation),p},i.encodeDelimited=function(d,p){return this.encode(d,p).ldelim()},i.decode=function(d,p){d instanceof m||(d=m.create(d));for(var _=p===void 0?d.len:d.pos+p,y=new f.onnx.TypeProto;d.pos<_;){var v=d.uint32();switch(v>>>3){case 1:y.tensorType=f.onnx.TypeProto.Tensor.decode(d,d.uint32());break;case 6:y.denotation=d.string();break;default:d.skipType(7&v)}}return y},i.decodeDelimited=function(d){return d instanceof m||(d=new m(d)),this.decode(d,d.uint32())},i.verify=function(d){if(typeof d!="object"||d===null)return"object expected";if(d.tensorType!=null&&d.hasOwnProperty("tensorType")){var p=f.onnx.TypeProto.Tensor.verify(d.tensorType);if(p)return"tensorType."+p}return d.denotation!=null&&d.hasOwnProperty("denotation")&&!h.isString(d.denotation)?"denotation: string expected":null},i.fromObject=function(d){if(d instanceof f.onnx.TypeProto)return d;var p=new f.onnx.TypeProto;if(d.tensorType!=null){if(typeof d.tensorType!="object")throw TypeError(".onnx.TypeProto.tensorType: object expected");p.tensorType=f.onnx.TypeProto.Tensor.fromObject(d.tensorType)}return d.denotation!=null&&(p.denotation=String(d.denotation)),p},i.toObject=function(d,p){p||(p={});var _={};return p.defaults&&(_.denotation=""),d.tensorType!=null&&d.hasOwnProperty("tensorType")&&(_.tensorType=f.onnx.TypeProto.Tensor.toObject(d.tensorType,p),p.oneofs&&(_.value="tensorType")),d.denotation!=null&&d.hasOwnProperty("denotation")&&(_.denotation=d.denotation),_},i.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},i.Tensor=(function(){function d(p){if(p)for(var _=Object.keys(p),y=0;y<_.length;++y)p[_[y]]!=null&&(this[_[y]]=p[_[y]])}return d.prototype.elemType=0,d.prototype.shape=null,d.create=function(p){return new d(p)},d.encode=function(p,_){return _||(_=g.create()),p.elemType!=null&&p.hasOwnProperty("elemType")&&_.uint32(8).int32(p.elemType),p.shape!=null&&p.hasOwnProperty("shape")&&f.onnx.TensorShapeProto.encode(p.shape,_.uint32(18).fork()).ldelim(),_},d.encodeDelimited=function(p,_){return this.encode(p,_).ldelim()},d.decode=function(p,_){p instanceof m||(p=m.create(p));for(var y=_===void 0?p.len:p.pos+_,v=new f.onnx.TypeProto.Tensor;p.pos<y;){var T=p.uint32();switch(T>>>3){case 1:v.elemType=p.int32();break;case 2:v.shape=f.onnx.TensorShapeProto.decode(p,p.uint32());break;default:p.skipType(7&T)}}return v},d.decodeDelimited=function(p){return p instanceof m||(p=new m(p)),this.decode(p,p.uint32())},d.verify=function(p){if(typeof p!="object"||p===null)return"object expected";if(p.elemType!=null&&p.hasOwnProperty("elemType")&&!h.isInteger(p.elemType))return"elemType: integer expected";if(p.shape!=null&&p.hasOwnProperty("shape")){var _=f.onnx.TensorShapeProto.verify(p.shape);if(_)return"shape."+_}return null},d.fromObject=function(p){if(p instanceof f.onnx.TypeProto.Tensor)return p;var _=new f.onnx.TypeProto.Tensor;if(p.elemType!=null&&(_.elemType=0|p.elemType),p.shape!=null){if(typeof p.shape!="object")throw TypeError(".onnx.TypeProto.Tensor.shape: object expected");_.shape=f.onnx.TensorShapeProto.fromObject(p.shape)}return _},d.toObject=function(p,_){_||(_={});var y={};return _.defaults&&(y.elemType=0,y.shape=null),p.elemType!=null&&p.hasOwnProperty("elemType")&&(y.elemType=p.elemType),p.shape!=null&&p.hasOwnProperty("shape")&&(y.shape=f.onnx.TensorShapeProto.toObject(p.shape,_)),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},d})(),i})(),u.OperatorSetIdProto=(function(){function i(r){if(r)for(var d=Object.keys(r),p=0;p<d.length;++p)r[d[p]]!=null&&(this[d[p]]=r[d[p]])}return i.prototype.domain="",i.prototype.version=h.Long?h.Long.fromBits(0,0,!1):0,i.create=function(r){return new i(r)},i.encode=function(r,d){return d||(d=g.create()),r.domain!=null&&r.hasOwnProperty("domain")&&d.uint32(10).string(r.domain),r.version!=null&&r.hasOwnProperty("version")&&d.uint32(16).int64(r.version),d},i.encodeDelimited=function(r,d){return this.encode(r,d).ldelim()},i.decode=function(r,d){r instanceof m||(r=m.create(r));for(var p=d===void 0?r.len:r.pos+d,_=new f.onnx.OperatorSetIdProto;r.pos<p;){var y=r.uint32();switch(y>>>3){case 1:_.domain=r.string();break;case 2:_.version=r.int64();break;default:r.skipType(7&y)}}return _},i.decodeDelimited=function(r){return r instanceof m||(r=new m(r)),this.decode(r,r.uint32())},i.verify=function(r){return typeof r!="object"||r===null?"object expected":r.domain!=null&&r.hasOwnProperty("domain")&&!h.isString(r.domain)?"domain: string expected":r.version!=null&&r.hasOwnProperty("version")&&!(h.isInteger(r.version)||r.version&&h.isInteger(r.version.low)&&h.isInteger(r.version.high))?"version: integer|Long expected":null},i.fromObject=function(r){if(r instanceof f.onnx.OperatorSetIdProto)return r;var d=new f.onnx.OperatorSetIdProto;return r.domain!=null&&(d.domain=String(r.domain)),r.version!=null&&(h.Long?(d.version=h.Long.fromValue(r.version)).unsigned=!1:typeof r.version=="string"?d.version=parseInt(r.version,10):typeof r.version=="number"?d.version=r.version:typeof r.version=="object"&&(d.version=new h.LongBits(r.version.low>>>0,r.version.high>>>0).toNumber())),d},i.toObject=function(r,d){d||(d={});var p={};if(d.defaults)if(p.domain="",h.Long){var _=new h.Long(0,0,!1);p.version=d.longs===String?_.toString():d.longs===Number?_.toNumber():_}else p.version=d.longs===String?"0":0;return r.domain!=null&&r.hasOwnProperty("domain")&&(p.domain=r.domain),r.version!=null&&r.hasOwnProperty("version")&&(typeof r.version=="number"?p.version=d.longs===String?String(r.version):r.version:p.version=d.longs===String?h.Long.prototype.toString.call(r.version):d.longs===Number?new h.LongBits(r.version.low>>>0,r.version.high>>>0).toNumber():r.version),p},i.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},i})(),u),n.exports=f},2100:(n,e,t)=>{n.exports=t(9482)},9482:(n,e,t)=>{var s=e;function o(){s.util._configure(),s.Writer._configure(s.BufferWriter),s.Reader._configure(s.BufferReader)}s.build="minimal",s.Writer=t(1173),s.BufferWriter=t(3155),s.Reader=t(1408),s.BufferReader=t(593),s.util=t(9693),s.rpc=t(5994),s.roots=t(5054),s.configure=o,o()},1408:(n,e,t)=>{n.exports=g;var s,o=t(9693),u=o.LongBits,l=o.utf8;function m(_,y){return RangeError("index out of range: "+_.pos+" + "+(y||1)+" > "+_.len)}function g(_){this.buf=_,this.pos=0,this.len=_.length}var h,f=typeof Uint8Array<"u"?function(_){if(_ instanceof Uint8Array||Array.isArray(_))return new g(_);throw Error("illegal buffer")}:function(_){if(Array.isArray(_))return new g(_);throw Error("illegal buffer")},i=function(){return o.Buffer?function(_){return(g.create=function(y){return o.Buffer.isBuffer(y)?new s(y):f(y)})(_)}:f};function r(){var _=new u(0,0),y=0;if(!(this.len-this.pos>4)){for(;y<3;++y){if(this.pos>=this.len)throw m(this);if(_.lo=(_.lo|(127&this.buf[this.pos])<<7*y)>>>0,this.buf[this.pos++]<128)return _}return _.lo=(_.lo|(127&this.buf[this.pos++])<<7*y)>>>0,_}for(;y<4;++y)if(_.lo=(_.lo|(127&this.buf[this.pos])<<7*y)>>>0,this.buf[this.pos++]<128)return _;if(_.lo=(_.lo|(127&this.buf[this.pos])<<28)>>>0,_.hi=(_.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return _;if(y=0,this.len-this.pos>4){for(;y<5;++y)if(_.hi=(_.hi|(127&this.buf[this.pos])<<7*y+3)>>>0,this.buf[this.pos++]<128)return _}else for(;y<5;++y){if(this.pos>=this.len)throw m(this);if(_.hi=(_.hi|(127&this.buf[this.pos])<<7*y+3)>>>0,this.buf[this.pos++]<128)return _}throw Error("invalid varint encoding")}function d(_,y){return(_[y-4]|_[y-3]<<8|_[y-2]<<16|_[y-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw m(this,8);return new u(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}g.create=i(),g.prototype._slice=o.Array.prototype.subarray||o.Array.prototype.slice,g.prototype.uint32=(h=4294967295,function(){if(h=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(h=(h|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(h=(h|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(h=(h|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(h=(h|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return h;if((this.pos+=5)>this.len)throw this.pos=this.len,m(this,10);return h}),g.prototype.int32=function(){return 0|this.uint32()},g.prototype.sint32=function(){var _=this.uint32();return _>>>1^-(1&_)|0},g.prototype.bool=function(){return this.uint32()!==0},g.prototype.fixed32=function(){if(this.pos+4>this.len)throw m(this,4);return d(this.buf,this.pos+=4)},g.prototype.sfixed32=function(){if(this.pos+4>this.len)throw m(this,4);return 0|d(this.buf,this.pos+=4)},g.prototype.float=function(){if(this.pos+4>this.len)throw m(this,4);var _=o.float.readFloatLE(this.buf,this.pos);return this.pos+=4,_},g.prototype.double=function(){if(this.pos+8>this.len)throw m(this,4);var _=o.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,_},g.prototype.bytes=function(){var _=this.uint32(),y=this.pos,v=this.pos+_;if(v>this.len)throw m(this,_);return this.pos+=_,Array.isArray(this.buf)?this.buf.slice(y,v):y===v?new this.buf.constructor(0):this._slice.call(this.buf,y,v)},g.prototype.string=function(){var _=this.bytes();return l.read(_,0,_.length)},g.prototype.skip=function(_){if(typeof _=="number"){if(this.pos+_>this.len)throw m(this,_);this.pos+=_}else do if(this.pos>=this.len)throw m(this);while(128&this.buf[this.pos++]);return this},g.prototype.skipType=function(_){switch(_){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(_=7&this.uint32())!=4;)this.skipType(_);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+_+" at offset "+this.pos)}return this},g._configure=function(_){s=_,g.create=i(),s._configure();var y=o.Long?"toLong":"toNumber";o.merge(g.prototype,{int64:function(){return r.call(this)[y](!1)},uint64:function(){return r.call(this)[y](!0)},sint64:function(){return r.call(this).zzDecode()[y](!1)},fixed64:function(){return p.call(this)[y](!0)},sfixed64:function(){return p.call(this)[y](!1)}})}},593:(n,e,t)=>{n.exports=u;var s=t(1408);(u.prototype=Object.create(s.prototype)).constructor=u;var o=t(9693);function u(l){s.call(this,l)}u._configure=function(){o.Buffer&&(u.prototype._slice=o.Buffer.prototype.slice)},u.prototype.string=function(){var l=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+l,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+l,this.len))},u._configure()},5054:n=>{n.exports={}},5994:(n,e,t)=>{e.Service=t(7948)},7948:(n,e,t)=>{n.exports=o;var s=t(9693);function o(u,l,m){if(typeof u!="function")throw TypeError("rpcImpl must be a function");s.EventEmitter.call(this),this.rpcImpl=u,this.requestDelimited=!!l,this.responseDelimited=!!m}(o.prototype=Object.create(s.EventEmitter.prototype)).constructor=o,o.prototype.rpcCall=function u(l,m,g,h,f){if(!h)throw TypeError("request must be specified");var i=this;if(!f)return s.asPromise(u,i,l,m,g,h);if(i.rpcImpl)try{return i.rpcImpl(l,m[i.requestDelimited?"encodeDelimited":"encode"](h).finish(),(function(r,d){if(r)return i.emit("error",r,l),f(r);if(d!==null){if(!(d instanceof g))try{d=g[i.responseDelimited?"decodeDelimited":"decode"](d)}catch(p){return i.emit("error",p,l),f(p)}return i.emit("data",d,l),f(null,d)}i.end(!0)}))}catch(r){return i.emit("error",r,l),void setTimeout((function(){f(r)}),0)}else setTimeout((function(){f(Error("already ended"))}),0)},o.prototype.end=function(u){return this.rpcImpl&&(u||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},1945:(n,e,t)=>{n.exports=o;var s=t(9693);function o(g,h){this.lo=g>>>0,this.hi=h>>>0}var u=o.zero=new o(0,0);u.toNumber=function(){return 0},u.zzEncode=u.zzDecode=function(){return this},u.length=function(){return 1};var l=o.zeroHash="\0\0\0\0\0\0\0\0";o.fromNumber=function(g){if(g===0)return u;var h=g<0;h&&(g=-g);var f=g>>>0,i=(g-f)/4294967296>>>0;return h&&(i=~i>>>0,f=~f>>>0,++f>4294967295&&(f=0,++i>4294967295&&(i=0))),new o(f,i)},o.from=function(g){if(typeof g=="number")return o.fromNumber(g);if(s.isString(g)){if(!s.Long)return o.fromNumber(parseInt(g,10));g=s.Long.fromString(g)}return g.low||g.high?new o(g.low>>>0,g.high>>>0):u},o.prototype.toNumber=function(g){if(!g&&this.hi>>>31){var h=1+~this.lo>>>0,f=~this.hi>>>0;return h||(f=f+1>>>0),-(h+4294967296*f)}return this.lo+4294967296*this.hi},o.prototype.toLong=function(g){return s.Long?new s.Long(0|this.lo,0|this.hi,!!g):{low:0|this.lo,high:0|this.hi,unsigned:!!g}};var m=String.prototype.charCodeAt;o.fromHash=function(g){return g===l?u:new o((m.call(g,0)|m.call(g,1)<<8|m.call(g,2)<<16|m.call(g,3)<<24)>>>0,(m.call(g,4)|m.call(g,5)<<8|m.call(g,6)<<16|m.call(g,7)<<24)>>>0)},o.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},o.prototype.zzEncode=function(){var g=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^g)>>>0,this.lo=(this.lo<<1^g)>>>0,this},o.prototype.zzDecode=function(){var g=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^g)>>>0,this.hi=(this.hi>>>1^g)>>>0,this},o.prototype.length=function(){var g=this.lo,h=(this.lo>>>28|this.hi<<4)>>>0,f=this.hi>>>24;return f===0?h===0?g<16384?g<128?1:2:g<2097152?3:4:h<16384?h<128?5:6:h<2097152?7:8:f<128?9:10}},9693:function(n,e,t){var s=e;function o(l,m,g){for(var h=Object.keys(m),f=0;f<h.length;++f)l[h[f]]!==void 0&&g||(l[h[f]]=m[h[f]]);return l}function u(l){function m(g,h){if(!(this instanceof m))return new m(g,h);Object.defineProperty(this,"message",{get:function(){return g}}),Error.captureStackTrace?Error.captureStackTrace(this,m):Object.defineProperty(this,"stack",{value:new Error().stack||""}),h&&o(this,h)}return(m.prototype=Object.create(Error.prototype)).constructor=m,Object.defineProperty(m.prototype,"name",{get:function(){return l}}),m.prototype.toString=function(){return this.name+": "+this.message},m}s.asPromise=t(4537),s.base64=t(7419),s.EventEmitter=t(9211),s.float=t(945),s.inquire=t(7199),s.utf8=t(4997),s.pool=t(6662),s.LongBits=t(1945),s.isNode=!!(t.g!==void 0&&t.g&&t.g.process&&t.g.process.versions&&t.g.process.versions.node),s.global=s.isNode&&t.g||typeof window<"u"&&window||typeof self<"u"&&self||this,s.emptyArray=Object.freeze?Object.freeze([]):[],s.emptyObject=Object.freeze?Object.freeze({}):{},s.isInteger=Number.isInteger||function(l){return typeof l=="number"&&isFinite(l)&&Math.floor(l)===l},s.isString=function(l){return typeof l=="string"||l instanceof String},s.isObject=function(l){return l&&typeof l=="object"},s.isset=s.isSet=function(l,m){var g=l[m];return!(g==null||!l.hasOwnProperty(m))&&(typeof g!="object"||(Array.isArray(g)?g.length:Object.keys(g).length)>0)},s.Buffer=(function(){try{var l=s.inquire("buffer").Buffer;return l.prototype.utf8Write?l:null}catch{return null}})(),s._Buffer_from=null,s._Buffer_allocUnsafe=null,s.newBuffer=function(l){return typeof l=="number"?s.Buffer?s._Buffer_allocUnsafe(l):new s.Array(l):s.Buffer?s._Buffer_from(l):typeof Uint8Array>"u"?l:new Uint8Array(l)},s.Array=typeof Uint8Array<"u"?Uint8Array:Array,s.Long=s.global.dcodeIO&&s.global.dcodeIO.Long||s.global.Long||s.inquire("long"),s.key2Re=/^true|false|0|1$/,s.key32Re=/^-?(?:0|[1-9][0-9]*)$/,s.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,s.longToHash=function(l){return l?s.LongBits.from(l).toHash():s.LongBits.zeroHash},s.longFromHash=function(l,m){var g=s.LongBits.fromHash(l);return s.Long?s.Long.fromBits(g.lo,g.hi,m):g.toNumber(!!m)},s.merge=o,s.lcFirst=function(l){return l.charAt(0).toLowerCase()+l.substring(1)},s.newError=u,s.ProtocolError=u("ProtocolError"),s.oneOfGetter=function(l){for(var m={},g=0;g<l.length;++g)m[l[g]]=1;return function(){for(var h=Object.keys(this),f=h.length-1;f>-1;--f)if(m[h[f]]===1&&this[h[f]]!==void 0&&this[h[f]]!==null)return h[f]}},s.oneOfSetter=function(l){return function(m){for(var g=0;g<l.length;++g)l[g]!==m&&delete this[l[g]]}},s.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},s._configure=function(){var l=s.Buffer;l?(s._Buffer_from=l.from!==Uint8Array.from&&l.from||function(m,g){return new l(m,g)},s._Buffer_allocUnsafe=l.allocUnsafe||function(m){return new l(m)}):s._Buffer_from=s._Buffer_allocUnsafe=null}},1173:(n,e,t)=>{n.exports=i;var s,o=t(9693),u=o.LongBits,l=o.base64,m=o.utf8;function g(T,w,E){this.fn=T,this.len=w,this.next=void 0,this.val=E}function h(){}function f(T){this.head=T.head,this.tail=T.tail,this.len=T.len,this.next=T.states}function i(){this.len=0,this.head=new g(h,0,0),this.tail=this.head,this.states=null}var r=function(){return o.Buffer?function(){return(i.create=function(){return new s})()}:function(){return new i}};function d(T,w,E){w[E]=255&T}function p(T,w){this.len=T,this.next=void 0,this.val=w}function _(T,w,E){for(;T.hi;)w[E++]=127&T.lo|128,T.lo=(T.lo>>>7|T.hi<<25)>>>0,T.hi>>>=7;for(;T.lo>127;)w[E++]=127&T.lo|128,T.lo=T.lo>>>7;w[E++]=T.lo}function y(T,w,E){w[E]=255&T,w[E+1]=T>>>8&255,w[E+2]=T>>>16&255,w[E+3]=T>>>24}i.create=r(),i.alloc=function(T){return new o.Array(T)},o.Array!==Array&&(i.alloc=o.pool(i.alloc,o.Array.prototype.subarray)),i.prototype._push=function(T,w,E){return this.tail=this.tail.next=new g(T,w,E),this.len+=w,this},p.prototype=Object.create(g.prototype),p.prototype.fn=function(T,w,E){for(;T>127;)w[E++]=127&T|128,T>>>=7;w[E]=T},i.prototype.uint32=function(T){return this.len+=(this.tail=this.tail.next=new p((T>>>=0)<128?1:T<16384?2:T<2097152?3:T<268435456?4:5,T)).len,this},i.prototype.int32=function(T){return T<0?this._push(_,10,u.fromNumber(T)):this.uint32(T)},i.prototype.sint32=function(T){return this.uint32((T<<1^T>>31)>>>0)},i.prototype.uint64=function(T){var w=u.from(T);return this._push(_,w.length(),w)},i.prototype.int64=i.prototype.uint64,i.prototype.sint64=function(T){var w=u.from(T).zzEncode();return this._push(_,w.length(),w)},i.prototype.bool=function(T){return this._push(d,1,T?1:0)},i.prototype.fixed32=function(T){return this._push(y,4,T>>>0)},i.prototype.sfixed32=i.prototype.fixed32,i.prototype.fixed64=function(T){var w=u.from(T);return this._push(y,4,w.lo)._push(y,4,w.hi)},i.prototype.sfixed64=i.prototype.fixed64,i.prototype.float=function(T){return this._push(o.float.writeFloatLE,4,T)},i.prototype.double=function(T){return this._push(o.float.writeDoubleLE,8,T)};var v=o.Array.prototype.set?function(T,w,E){w.set(T,E)}:function(T,w,E){for(var P=0;P<T.length;++P)w[E+P]=T[P]};i.prototype.bytes=function(T){var w=T.length>>>0;if(!w)return this._push(d,1,0);if(o.isString(T)){var E=i.alloc(w=l.length(T));l.decode(T,E,0),T=E}return this.uint32(w)._push(v,w,T)},i.prototype.string=function(T){var w=m.length(T);return w?this.uint32(w)._push(m.write,w,T):this._push(d,1,0)},i.prototype.fork=function(){return this.states=new f(this),this.head=this.tail=new g(h,0,0),this.len=0,this},i.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new g(h,0,0),this.len=0),this},i.prototype.ldelim=function(){var T=this.head,w=this.tail,E=this.len;return this.reset().uint32(E),E&&(this.tail.next=T.next,this.tail=w,this.len+=E),this},i.prototype.finish=function(){for(var T=this.head.next,w=this.constructor.alloc(this.len),E=0;T;)T.fn(T.val,w,E),E+=T.len,T=T.next;return w},i._configure=function(T){s=T,i.create=r(),s._configure()}},3155:(n,e,t)=>{n.exports=u;var s=t(1173);(u.prototype=Object.create(s.prototype)).constructor=u;var o=t(9693);function u(){s.call(this)}function l(m,g,h){m.length<40?o.utf8.write(m,g,h):g.utf8Write?g.utf8Write(m,h):g.write(m,h)}u._configure=function(){u.alloc=o._Buffer_allocUnsafe,u.writeBytesBuffer=o.Buffer&&o.Buffer.prototype instanceof Uint8Array&&o.Buffer.prototype.set.name==="set"?function(m,g,h){g.set(m,h)}:function(m,g,h){if(m.copy)m.copy(g,h,0,m.length);else for(var f=0;f<m.length;)g[h++]=m[f++]}},u.prototype.bytes=function(m){o.isString(m)&&(m=o._Buffer_from(m,"base64"));var g=m.length>>>0;return this.uint32(g),g&&this._push(u.writeBytesBuffer,g,m),this},u.prototype.string=function(m){var g=o.Buffer.byteLength(m);return this.uint32(g),g&&this._push(l,g,m),this},u._configure()},7714:(n,e,t)=>{e.R=void 0;const s=t(6919),o=t(7448);e.R=new class{async init(){}async createSessionHandler(u,l){const m=new s.Session(l);return await m.loadModel(u),new o.OnnxjsSessionHandler(m)}}},4200:(n,e,t)=>{e.c8=e.rX=void 0;const s=t(1670),o=t(5381),u=t(2157),l=t(2306);e.rX=()=>{if((typeof s.env.wasm.initTimeout!="number"||s.env.wasm.initTimeout<0)&&(s.env.wasm.initTimeout=0),typeof s.env.wasm.simd!="boolean"&&(s.env.wasm.simd=!0),typeof s.env.wasm.proxy!="boolean"&&(s.env.wasm.proxy=!1),typeof s.env.wasm.numThreads!="number"||!Number.isInteger(s.env.wasm.numThreads)||s.env.wasm.numThreads<=0){const m=typeof navigator>"u"?(0,o.cpus)().length:navigator.hardwareConcurrency;s.env.wasm.numThreads=Math.min(4,Math.ceil((m||1)/2))}},e.c8=new class{async init(){(0,e.rX)(),await(0,u.initWasm)()}async createSessionHandler(m,g){const h=new l.OnnxruntimeWebAssemblySessionHandler;return await h.loadModel(m,g),Promise.resolve(h)}}},6018:function(n,e,t){var s=this&&this.__createBinding||(Object.create?function(l,m,g,h){h===void 0&&(h=g);var f=Object.getOwnPropertyDescriptor(m,g);f&&!("get"in f?!m.__esModule:f.writable||f.configurable)||(f={enumerable:!0,get:function(){return m[g]}}),Object.defineProperty(l,h,f)}:function(l,m,g,h){h===void 0&&(h=g),l[h]=m[g]}),o=this&&this.__exportStar||function(l,m){for(var g in l)g==="default"||Object.prototype.hasOwnProperty.call(m,g)||s(m,l,g)};Object.defineProperty(e,"__esModule",{value:!0}),o(t(1670),e);const u=t(1670);{const l=t(7714).R;(0,u.registerBackend)("webgl",l,-10)}{const l=t(4200).c8;(0,u.registerBackend)("cpu",l,10),(0,u.registerBackend)("wasm",l,10),(0,u.registerBackend)("xnnpack",l,9)}},246:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createAttributeWithCacheKey=void 0;class t{constructor(o){Object.assign(this,o)}get cacheKey(){return this._cacheKey||(this._cacheKey=Object.getOwnPropertyNames(this).sort().map((o=>`${this[o]}`)).join(";")),this._cacheKey}}e.createAttributeWithCacheKey=s=>new t(s)},7778:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Attribute=void 0;const s=t(1446),o=t(9395),u=t(9162),l=t(2517);var m=o.onnxruntime.experimental.fbs;class g{constructor(f){if(this._attributes=new Map,f!=null){for(const i of f)i instanceof s.onnx.AttributeProto?this._attributes.set(i.name,[g.getValue(i),g.getType(i)]):i instanceof m.Attribute&&this._attributes.set(i.name(),[g.getValue(i),g.getType(i)]);if(this._attributes.size<f.length)throw new Error("duplicated attribute names")}}set(f,i,r){this._attributes.set(f,[r,i])}delete(f){this._attributes.delete(f)}getFloat(f,i){return this.get(f,"float",i)}getInt(f,i){return this.get(f,"int",i)}getString(f,i){return this.get(f,"string",i)}getTensor(f,i){return this.get(f,"tensor",i)}getFloats(f,i){return this.get(f,"floats",i)}getInts(f,i){return this.get(f,"ints",i)}getStrings(f,i){return this.get(f,"strings",i)}getTensors(f,i){return this.get(f,"tensors",i)}get(f,i,r){const d=this._attributes.get(f);if(d===void 0){if(r!==void 0)return r;throw new Error(`required attribute not found: ${f}`)}if(d[1]!==i)throw new Error(`type mismatch: expected ${i} but got ${d[1]}`);return d[0]}static getType(f){const i=f instanceof s.onnx.AttributeProto?f.type:f.type();switch(i){case s.onnx.AttributeProto.AttributeType.FLOAT:return"float";case s.onnx.AttributeProto.AttributeType.INT:return"int";case s.onnx.AttributeProto.AttributeType.STRING:return"string";case s.onnx.AttributeProto.AttributeType.TENSOR:return"tensor";case s.onnx.AttributeProto.AttributeType.FLOATS:return"floats";case s.onnx.AttributeProto.AttributeType.INTS:return"ints";case s.onnx.AttributeProto.AttributeType.STRINGS:return"strings";case s.onnx.AttributeProto.AttributeType.TENSORS:return"tensors";default:throw new Error(`attribute type is not supported yet: ${s.onnx.AttributeProto.AttributeType[i]}`)}}static getValue(f){const i=f instanceof s.onnx.AttributeProto?f.type:f.type();if(i===s.onnx.AttributeProto.AttributeType.GRAPH||i===s.onnx.AttributeProto.AttributeType.GRAPHS)throw new Error("graph attribute is not supported yet");const r=this.getValueNoCheck(f);if(i===s.onnx.AttributeProto.AttributeType.INT&&l.LongUtil.isLong(r))return l.LongUtil.longToNumber(r);if(i===s.onnx.AttributeProto.AttributeType.INTS){const d=r,p=new Array(d.length);for(let _=0;_<d.length;_++){const y=d[_];p[_]=l.LongUtil.longToNumber(y)}return p}if(i===s.onnx.AttributeProto.AttributeType.TENSOR)return f instanceof s.onnx.AttributeProto?u.Tensor.fromProto(r):u.Tensor.fromOrtTensor(r);if(i===s.onnx.AttributeProto.AttributeType.TENSORS){if(f instanceof s.onnx.AttributeProto)return r.map((d=>u.Tensor.fromProto(d)));if(f instanceof m.Attribute)return r.map((d=>u.Tensor.fromOrtTensor(d)))}if(i===s.onnx.AttributeProto.AttributeType.STRING&&f instanceof s.onnx.AttributeProto){const d=r;return(0,l.decodeUtf8String)(d)}return i===s.onnx.AttributeProto.AttributeType.STRINGS&&f instanceof s.onnx.AttributeProto?r.map(l.decodeUtf8String):r}static getValueNoCheck(f){return f instanceof s.onnx.AttributeProto?this.getValueNoCheckFromOnnxFormat(f):this.getValueNoCheckFromOrtFormat(f)}static getValueNoCheckFromOnnxFormat(f){switch(f.type){case s.onnx.AttributeProto.AttributeType.FLOAT:return f.f;case s.onnx.AttributeProto.AttributeType.INT:return f.i;case s.onnx.AttributeProto.AttributeType.STRING:return f.s;case s.onnx.AttributeProto.AttributeType.TENSOR:return f.t;case s.onnx.AttributeProto.AttributeType.GRAPH:return f.g;case s.onnx.AttributeProto.AttributeType.FLOATS:return f.floats;case s.onnx.AttributeProto.AttributeType.INTS:return f.ints;case s.onnx.AttributeProto.AttributeType.STRINGS:return f.strings;case s.onnx.AttributeProto.AttributeType.TENSORS:return f.tensors;case s.onnx.AttributeProto.AttributeType.GRAPHS:return f.graphs;default:throw new Error(`unsupported attribute type: ${s.onnx.AttributeProto.AttributeType[f.type]}`)}}static getValueNoCheckFromOrtFormat(f){switch(f.type()){case m.AttributeType.FLOAT:return f.f();case m.AttributeType.INT:return f.i();case m.AttributeType.STRING:return f.s();case m.AttributeType.TENSOR:return f.t();case m.AttributeType.GRAPH:return f.g();case m.AttributeType.FLOATS:return f.floatsArray();case m.AttributeType.INTS:{const i=[];for(let r=0;r<f.intsLength();r++)i.push(f.ints(r));return i}case m.AttributeType.STRINGS:{const i=[];for(let r=0;r<f.stringsLength();r++)i.push(f.strings(r));return i}case m.AttributeType.TENSORS:{const i=[];for(let r=0;r<f.tensorsLength();r++)i.push(f.tensors(r));return i}default:throw new Error(`unsupported attribute type: ${m.AttributeType[f.type()]}`)}}}e.Attribute=g},7091:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.resolveBackend=e.backend=void 0;const s=t(5038),o=new Map;async function u(l){const m=e.backend;if(m[l]!==void 0&&(function(g){const h=g;return"initialize"in h&&typeof h.initialize=="function"&&"createSessionHandler"in h&&typeof h.createSessionHandler=="function"&&"dispose"in h&&typeof h.dispose=="function"})(m[l])){const g=m[l];let h=g.initialize();if(typeof h=="object"&&"then"in h&&(h=await h),h)return o.set(l,g),g}}e.backend={webgl:new s.WebGLBackend},e.resolveBackend=async function l(m){if(!m)return l(["webgl"]);{const g=typeof m=="string"?[m]:m;for(const h of g){const f=o.get(h);if(f)return f;const i=await u(h);if(i)return i}}throw new Error("no available backend to use")}},5038:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLBackend=void 0;const s=t(1670),o=t(6231),u=t(6416),l=t(7305);e.WebGLBackend=class{get contextId(){return s.env.webgl.contextId}set contextId(m){s.env.webgl.contextId=m}get matmulMaxBatchSize(){return s.env.webgl.matmulMaxBatchSize}set matmulMaxBatchSize(m){s.env.webgl.matmulMaxBatchSize=m}get textureCacheMode(){return s.env.webgl.textureCacheMode}set textureCacheMode(m){s.env.webgl.textureCacheMode=m}get pack(){return s.env.webgl.pack}set pack(m){s.env.webgl.pack=m}get async(){return s.env.webgl.async}set async(m){s.env.webgl.async=m}initialize(){try{return this.glContext=(0,l.createWebGLContext)(this.contextId),typeof this.matmulMaxBatchSize!="number"&&(this.matmulMaxBatchSize=16),typeof this.textureCacheMode!="string"&&(this.textureCacheMode="full"),typeof this.pack!="boolean"&&(this.pack=!1),typeof this.async!="boolean"&&(this.async=!1),o.Logger.setWithEnv(s.env),o.Logger.verbose("WebGLBackend",`Created WebGLContext: ${typeof this.glContext} with matmulMaxBatchSize: ${this.matmulMaxBatchSize}; textureCacheMode: ${this.textureCacheMode}; pack: ${this.pack}; async: ${this.async}.`),!0}catch(m){return o.Logger.warning("WebGLBackend",`Unable to initialize WebGLBackend. ${m}`),!1}}createSessionHandler(m){return new u.WebGLSessionHandler(this,m)}dispose(){this.glContext.dispose()}}},5107:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CoordsGlslLib=void 0;const s=t(2517),o=t(8520),u=t(5060),l=t(7859),m=t(9390);class g extends o.GlslLib{constructor(f){super(f)}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.offsetToCoords()),this.coordsToOffset()),this.toVec()),this.valueFrom()),this.getCommonUtilFuncs()),this.getInputsSamplingSnippets()),this.getOutputSamplingSnippet())}getCustomTypes(){return{}}offsetToCoords(){return{offsetToCoords:new o.GlslLibRoutine(`
      vec2 offsetToCoords(int offset, int width, int height) {
        int t = offset / width;
        int s = offset - t*width;
        vec2 coords = (vec2(s,t) + vec2(0.5,0.5)) / vec2(width, height);
        return coords;
      }
      `)}}coordsToOffset(){return{coordsToOffset:new o.GlslLibRoutine(`
      int coordsToOffset(vec2 coords, int width, int height) {
        float s = coords.s * float(width);
        float t = coords.t * float(height);
        int offset = int(t) * width + int(s);
        return offset;
      }
      `)}}getOutputSamplingSnippet(){const f=this.context.outputTextureLayout;return f.isPacked?this.getPackedOutputSamplingSnippet(f):this.getUnpackedOutputSamplingSnippet(f)}getPackedOutputSamplingSnippet(f){const i=f.unpackedShape,r=[f.width,f.height],d={},p="getOutputCoords";switch(i.length){case 0:d[p]=this.getOutputScalarCoords();break;case 1:d[p]=this.getOutputPacked1DCoords(i,r);break;case 2:d[p]=this.getOutputPacked2DCoords(i,r);break;case 3:d[p]=this.getOutputPacked3DCoords(i,r);break;default:d[p]=this.getOutputPackedNDCoords(i,r)}const _=`
      void setOutput(vec4 val) {
        ${(0,u.getGlsl)(this.context.glContext.version).output} = val;
      }
    `;return d.floatTextureSetRGBA=new o.GlslLibRoutine(_),d}getUnpackedOutputSamplingSnippet(f){const i=f.unpackedShape,r=[f.width,f.height],d={},p="getOutputCoords";switch(i.length){case 0:d[p]=this.getOutputScalarCoords();break;case 1:d[p]=this.getOutputUnpacked1DCoords(i,r);break;case 2:d[p]=this.getOutputUnpacked2DCoords(i,r);break;case 3:d[p]=this.getOutputUnpacked3DCoords(i,r);break;case 4:d[p]=this.getOutputUnpacked4DCoords(i,r);break;case 5:d[p]=this.getOutputUnpacked5DCoords(i,r);break;case 6:d[p]=this.getOutputUnpacked6DCoords(i,r);break;default:throw new Error(`Unsupported output dimensionality: ${i.length}`)}const _=`
        void setOutput(float val) {
          ${(0,u.getGlsl)(this.context.glContext.version).output} = vec4(val, 0, 0, 0);
        }
    `;return d.floatTextureSetR=new o.GlslLibRoutine(_),d}getOutputScalarCoords(){return new o.GlslLibRoutine(`
      int getOutputCoords() {
        return 0;
      }
    `)}getOutputPacked1DCoords(f,i){const r=i;let d="";return r[0]===1?(d=`
          int getOutputCoords() {
            return 2 * int(TexCoords.y * ${r[1]}.0);
          }
        `,new o.GlslLibRoutine(d)):r[1]===1?(d=`
          int getOutputCoords() {
            return 2 * int(TexCoords.x * ${r[0]}.0);
          }
        `,new o.GlslLibRoutine(d)):(d=`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                 vec2(${r[0]}, ${r[1]}));
          return 2 * (resTexRC.y * ${r[0]} + resTexRC.x);
        }
      `,new o.GlslLibRoutine(d))}getOutputPacked2DCoords(f,i){let r="";if(s.ArrayUtil.arraysEqual(f,i))return r=`
        ivec2 getOutputCoords() {
          return 2 * ivec2(TexCoords.xy * vec2(${i[0]}, ${i[1]}));
        }
      `,new o.GlslLibRoutine(r);const d=i,p=Math.ceil(f[1]/2);return r=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${d[0]}, ${d[1]}));

          int index = resTexRC.y * ${d[0]} + resTexRC.x;

          // reverse r and c order for packed texture
          int r = imod(index, ${p}) * 2;
          int c = 2 * (index / ${p});

          return ivec2(r, c);
        }
      `,new o.GlslLibRoutine(r)}getOutputPacked3DCoords(f,i){const r=[i[0],i[1]],d=Math.ceil(f[2]/2),p=d*Math.ceil(f[1]/2),_=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${r[0]}, ${r[1]}));
          int index = resTexRC.y * ${r[0]} + resTexRC.x;

          int b = index / ${p};
          index -= b * ${p};

          // reverse r and c order for packed texture
          int r = imod(index, ${d}) * 2;
          int c = 2 * (index / ${d});

          return ivec3(b, r, c);
        }
      `;return new o.GlslLibRoutine(_)}getOutputPackedNDCoords(f,i){const r=[i[0],i[1]],d=Math.ceil(f[f.length-1]/2),p=d*Math.ceil(f[f.length-2]/2);let _=p,y="",v="b, r, c";for(let w=2;w<f.length-1;w++)_*=f[f.length-w-1],y=`
      int b${w} = index / ${_};
      index -= b${w} * ${_};
    `+y,v=`b${w}, `+v;const T=`
      ivec${f.length} getOutputCoords() {
        ivec2 resTexRC = ivec2(TexCoords.xy *
                              vec2(${r[0]}, ${r[1]}));
        int index = resTexRC.y * ${r[0]} + resTexRC.x;

        ${y}

        int b = index / ${p};
        index -= b * ${p};

        // reverse r and c order for packed texture
        int r = imod(index, ${d}) * 2;
        int c = 2 * (index / ${d});

        return ivec${f.length}(${v});
      }
    `;return new o.GlslLibRoutine(T)}getOutputUnpacked1DCoords(f,i){const r=`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${i[0]}, ${i[1]}));
          return resTexRC.y * ${i[0]} + resTexRC.x;
        }
      `;return new o.GlslLibRoutine(r)}getOutputUnpacked2DCoords(f,i){const r=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${i[0]}, ${i[1]}));
          int index = resTexRC.y * ${i[0]} + resTexRC.x;
          int r = index / ${f[1]};
          int c = index - r * ${f[1]};
          return ivec2(r, c);
        }
      `;return new o.GlslLibRoutine(r)}getOutputUnpacked3DCoords(f,i){let r="";const d=f.length;let p=null;d<2&&(p=[]),p=new Array(d-1),p[d-2]=f[d-1];for(let v=d-3;v>=0;--v)p[v]=p[v+1]*f[v+1];const _=["r","c","d"],y=p.map(((v,T)=>`int ${_[T]} = index / ${v}; ${T===p.length-1?`int ${_[T+1]} = index - ${_[T]} * ${v}`:`index -= ${_[T]} * ${v}`};`)).join("");return r=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${i[0]}, ${i[1]}));
          int index = resTexRC.y * ${i[0]} + resTexRC.x;
          ${y}
          return ivec3(r, c, d);
        }
      `,new o.GlslLibRoutine(r)}getOutputUnpacked4DCoords(f,i){let r="";const d=f.length;let p=null;d<2&&(p=[]),p=new Array(d-1),p[d-2]=f[d-1];for(let v=d-3;v>=0;--v)p[v]=p[v+1]*f[v+1];const _=["r","c","d","d2"],y=p.map(((v,T)=>`int ${_[T]} = index / ${v}; ${T===p.length-1?`int ${_[T+1]} = index - ${_[T]} * ${v}`:`index -= ${_[T]} * ${v}`};`)).join("");return r=`
      ivec4 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${i[0]}, ${i[1]}));
          int index = resTexRC.y * ${i[0]} + resTexRC.x;
          ${y}
          return ivec4(r, c, d, d2);
        }
      `,new o.GlslLibRoutine(r)}getOutputUnpacked5DCoords(f,i){let r="";const d=f.length;let p=null;d<2&&(p=[]),p=new Array(d-1),p[d-2]=f[d-1];for(let v=d-3;v>=0;--v)p[v]=p[v+1]*f[v+1];const _=["r","c","d","d2","d3"],y=p.map(((v,T)=>`int ${_[T]} = index / ${v}; ${T===p.length-1?`int ${_[T+1]} = index - ${_[T]} * ${v}`:`index -= ${_[T]} * ${v}`};`)).join("");return r=`
      ivec5 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${i[0]}, ${i[1]}));
          int index = resTexRC.y * ${i[0]} + resTexRC.x;
          ${y}
          return ivec5(r, c, d, d2, d3);
        }
      `,new o.GlslLibRoutine(r)}getOutputUnpacked6DCoords(f,i){let r="";const d=f.length;let p=null;d<2&&(p=[]),p=new Array(d-1),p[d-2]=f[d-1];for(let v=d-3;v>=0;--v)p[v]=p[v+1]*f[v+1];const _=["r","c","d","d2","d3","d4"],y=p.map(((v,T)=>`int ${_[T]} = index / ${v}; ${T===p.length-1?`int ${_[T+1]} = index - ${_[T]} * ${v}`:`index -= ${_[T]} * ${v}`};`)).join("");return r=`
     ivec6 getOutputCoords() {
         ivec2 resTexRC = ivec2(TexCoords.xy *
                               vec2(${i[0]}, ${i[1]}));
         int index = resTexRC.y * ${i[0]} + resTexRC.x;
         ${y}
         return ivec6(r, c, d, d2, d3, d4);
       }
     `,new o.GlslLibRoutine(r)}getCommonUtilFuncs(){const f={};let i="uvFromFlat";f[i]=new o.GlslLibRoutine(`
    vec2 uvFromFlat(int texNumR, int texNumC, int index) {
      int texC = index / texNumR;
      int texR = index - texC * texNumR;
      // TODO: swap texR, texC order in following function so row is corresponding to u and column is corresponding to
      //       v.
      return (vec2(texR, texC) + halfCR) / vec2(texNumR, texNumC);
    }
    `),i="packedUVfrom1D",f[i]=new o.GlslLibRoutine(`
      vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
        int texelIndex = index / 2;
        int texR = texelIndex / texNumC;
        int texC = texelIndex - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),i="packedUVfrom2D",f[i]=new o.GlslLibRoutine(`
      vec2 packedUVfrom2D(int texNumR, int texNumC, int texelsInLogicalRow, int row, int col) {
        int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
        int texR = texelIndex / texNumC;
        int texC = texelIndex - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),i="packedUVfrom3D",f[i]=new o.GlslLibRoutine(`
      vec2 packedUVfrom3D(int texNumR, int texNumC,
          int texelsInBatch, int texelsInLogicalRow, int b,
          int row, int col) {
        int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
        int texR = index / texNumC;
        int texC = index - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),i="sampleTexture";const r=(0,u.getGlsl)(this.context.glContext.version);return f[i]=new o.GlslLibRoutine(`
        float sampleTexture(sampler2D textureSampler, vec2 uv) {
            return ${r.texture2D}(textureSampler, uv).r;
        }`),f}getInputsSamplingSnippets(){const f={},i=this.context.outputTextureLayout;return this.context.programInfo.inputNames.forEach(((r,d)=>{const p=this.context.inputTextureLayouts[d],_=(0,m.generateShaderFuncNameFromInputSamplerName)(r);p.isPacked?f[_]=this.getPackedSamplerFromInput(_,r,p):f[_]=this.getUnpackedSamplerFromInput(_,r,p);const y=(0,m.generateShaderFuncNameFromInputSamplerNameAtOutCoords)(r);p.unpackedShape.length<=i.unpackedShape.length&&(p.isPacked?f[y]=this.getPackedSamplerAtOutputCoords(y,p,i,r):f[y]=this.getUnpackedSamplerAtOutputCoords(y,p,i,r))})),f}getPackedSamplerAtOutputCoords(f,i,r,d){const p=i.unpackedShape,_=r.unpackedShape,y=d,v=(0,m.generateShaderFuncNameFromInputSamplerName)(y),T=p.length,w=_.length,E=s.BroadcastUtil.getBroadcastDims(p,_),P=(0,m.getCoordsDataType)(w),R=w-T;let I;const N=(0,m.getGlChannels)();I=T===0?"":w<2&&E.length>=1?"coords = 0;":E.map((W=>`coords.${N[W+R]} = 0;`)).join(`
`);let B="";B=w<2&&T>0?"coords":p.map(((W,$)=>`coords.${N[$+R]}`)).join(", ");let D="return outputValue;";const Y=s.ShapeUtil.size(p)===1,se=s.ShapeUtil.size(_)===1;if(T!==1||Y||se){if(Y&&!se)D=w===1?`
          return vec4(outputValue.x, outputValue.x, 0., 0.);
        `:`
          return vec4(outputValue.x);
        `;else if(E.length){const W=T-2,$=T-1;E.indexOf(W)>-1&&E.indexOf($)>-1?D="return vec4(outputValue.x);":E.indexOf(W)>-1?D="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":E.indexOf($)>-1&&(D="return vec4(outputValue.xx, outputValue.zz);")}}else D=`
        return vec4(outputValue.xy, outputValue.xy);
      `;const re=`
      vec4 ${f}() {
        ${P} coords = getOutputCoords();
        
        int lastDim = coords.${N[w-1]};
        coords.${N[w-1]} = coords.${N[w-2]};
        coords.${N[w-2]} = lastDim;
      
        ${I}
        vec4 outputValue = ${v}(${B});
        ${D}
      }
    `;return new o.GlslLibRoutine(re,["coordinates.getOutputCoords"])}getUnpackedSamplerAtOutputCoords(f,i,r,d){const p=[r.width,r.height],_=[i.width,i.height],y=i.unpackedShape.length,v=r.unpackedShape.length,T=i.unpackedShape,w=r.unpackedShape,E=(0,m.generateShaderFuncNameFromInputSamplerName)(d);if(y===v&&s.ArrayUtil.arraysEqual(_,p)){const se=`
          float ${f}() {
            return sampleTexture(${d}, TexCoords);
          }
        `;return new o.GlslLibRoutine(se,["coordinates.sampleTexture"])}const P=(0,m.getCoordsDataType)(v),R=s.BroadcastUtil.getBroadcastDims(T,w),I=v-y;let N;const B=(0,m.getGlChannels)();N=y===0?"":v<2&&R.length>=1?"coords = 0;":R.map((se=>`coords.${B[se+I]} = 0;`)).join(`
`);let D="";D=v<2&&y>0?"coords":i.unpackedShape.map(((se,re)=>`coords.${B[re+I]}`)).join(", ");const Y=`
        float ${f}() {
          ${P} coords = getOutputCoords();
          ${N}
          return ${E}(${D});
        }
      `;return new o.GlslLibRoutine(Y,["coordinates.getOutputCoords"])}getPackedSamplerFromInput(f,i,r){switch(r.unpackedShape.length){case 0:return this.getPackedSamplerScalar(f,i);case 1:return this.getPackedSampler1D(f,i,r);case 2:return this.getPackedSampler2D(f,i,r);case 3:return this.getPackedSampler3D(f,i,r);default:return this.getPackedSamplerND(f,i,r)}}getUnpackedSamplerFromInput(f,i,r){const d=r.unpackedShape;switch(d.length){case 0:return this.getUnpackedSamplerScalar(f,i,r);case 1:return this.getUnpackedSampler1D(f,i,r);case 2:return this.getUnpackedSampler2D(f,i,r);case 3:return this.getUnpackedSampler3D(f,i,r);case 4:return this.getUnpackedSampler4D(f,i,r);case 5:return this.getUnpackedSampler5D(f,i,r);case 6:return this.getUnpackedSampler6D(f,i,r);default:throw new Error(`Unsupported dimension ${d.length}-D`)}}getPackedSamplerScalar(f,i){const r=`
          vec4 ${f}() {
            return ${(0,u.getGlsl)(this.context.glContext.version).texture2D}(${i}, halfCR);
          }
        `;return new o.GlslLibRoutine(r)}getPackedSampler1D(f,i,r){const d=[r.width,r.height],p=[d[1],d[0]],_=(0,u.getGlsl)(this.context.glContext.version),y=`vec4 ${f}(int index) {
      vec2 uv = packedUVfrom1D(
      ${p[0]}, ${p[1]}, index);
      return ${_.texture2D}(${i}, uv);
    }`;return new o.GlslLibRoutine(y,["coordinates.packedUVfrom1D"])}getPackedSampler2D(f,i,r){const d=r.unpackedShape,p=[r.width,r.height],_=(0,u.getGlsl)(this.context.glContext.version),y=p[0],v=p[1];if(p!=null&&s.ArrayUtil.arraysEqual(d,p)){const P=`vec4 ${f}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${v}.0, ${y}.0);
        return ${_.texture2D}(${i}, uv);
      }`;return new o.GlslLibRoutine(P)}const T=p,w=Math.ceil(d[1]/2),E=`vec4 ${f}(int row, int col) {
      vec2 uv = packedUVfrom2D(${T[1]}, ${T[0]}, ${w}, row, col);
      return ${_.texture2D}(${i}, uv);
    }`;return new o.GlslLibRoutine(E,["coordinates.packedUVfrom2D"])}getPackedSampler3D(f,i,r){const d=r.unpackedShape,p=[r.width,r.height],_=[p[0],p[1]],y=(0,u.getGlsl)(this.context.glContext.version);if(d[0]===1){const P=d.slice(1),R=[1,2],I=(0,m.squeezeInputShape)(d,P),N=["b","row","col"],B=JSON.parse(JSON.stringify(r));B.unpackedShape=I;const D=this.getPackedSamplerFromInput(f,i,B),Y=`${D.routineBody}
      vec4 ${f}(int b, int row, int col) {
        return ${f}(${(0,m.getSqueezedParams)(N,R)});
      } `;return new o.GlslLibRoutine(Y,D.dependencies)}const v=_[0],T=_[1],w=Math.ceil(d[2]/2),E=`vec4 ${f}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${T}, ${v}, ${w*Math.ceil(d[1]/2)}, ${w}, b, row, col);
      return ${y.texture2D}(${i}, uv);}`;return new o.GlslLibRoutine(E,["coordinates.packedUVfrom3D"])}getPackedSamplerND(f,i,r){const d=r.unpackedShape,p=d.length,_=[r.width,r.height],y=(0,u.getGlsl)(this.context.glContext.version),v=[_[0],_[1]],T=v[1],w=v[0],E=Math.ceil(d[p-1]/2);let P=E*Math.ceil(d[p-2]/2),R="int b, int row, int col",I=`b * ${P} + (row / 2) * ${E} + (col / 2)`;for(let B=2;B<p-1;B++)R=`int b${B}, `+R,P*=d[p-B-1],I=`b${B} * ${P} + `+I;const N=`vec4 ${f}(${R}) {
      int index = ${I};
      int texR = index / ${w};
      int texC = index - texR * ${w};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${w}, ${T});
      return ${y.texture2D}(${i}, uv);
    }`;return new o.GlslLibRoutine(N)}getUnpackedSamplerScalar(f,i,r){const[d,p]=[r.width,r.height];if(d===1&&p===1){const y=`
          float ${f}() {
            return sampleTexture(${i}, halfCR);
          }
        `;return new o.GlslLibRoutine(y,["coordinates.sampleTexture"])}const _=`
        float ${f}() {
          int offset_${i} = coordsToOffset(TexCoords, ${d}, ${p});
          vec2 uv = uvFromFlat(${d}, ${p}, offset_${i});
          return sampleTexture(${i}, uv);
        }
      `;return new o.GlslLibRoutine(_,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler1D(f,i,r){const d=r.width,p=r.height;if(p===1&&d===1){const y=`
        float ${f}(int index) {
          return sampleTexture(${i}, halfCR);
        }
      `;return new o.GlslLibRoutine(y,["coordinates.sampleTexture"])}if(p===1){const y=`
          float ${f}(int index) {
            vec2 uv = vec2((float(index) + 0.5) / ${d}.0, 0.5);
            return sampleTexture(${i}, uv);
          }
        `;return new o.GlslLibRoutine(y,["coordinates.sampleTexture"])}if(d===1){const y=`
          float ${f}(int index) {
            vec2 uv = vec2(0.5, (float(index) + 0.5) / ${p}.0);
            return sampleTexture(${i}, uv);
          }
        `;return new o.GlslLibRoutine(y,["coordinates.sampleTexture"])}const _=`
        float ${f}(int index) {
          vec2 uv = uvFromFlat(${d}, ${p}, index);
          return sampleTexture(${i}, uv);
        }
      `;return new o.GlslLibRoutine(_,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler2D(f,i,r){const d=r.unpackedShape,p=[r.height,r.width];if(p!=null&&s.ArrayUtil.arraysEqual(d,p)){const P=`
          float ${f}(int row, int col) {
            vec2 uv = (vec2(row, col) + halfCR) / vec2(${p[1]}.0, ${p[0]}.0);
            return sampleTexture(${i}, uv);
          }
        `;return new o.GlslLibRoutine(P,["coordinates.sampleTexture"])}const{newShape:_,keptDims:y}=(0,l.squeezeShape)(d),v=_;if(v.length<d.length){const P=(0,m.squeezeInputShape)(d,v),R=JSON.parse(JSON.stringify(r));R.unpackedShape=P;const I=["col","row"],N=`
          ${this.getUnpackedSamplerFromInput(f,i,R).routineBody}
          float ${f}(int row, int col) {
            return ${f}(${(0,m.getSqueezedParams)(I,y)});
          }
        `;return new o.GlslLibRoutine(N,["coordinates.sampleTexture"])}const T=p[1],w=p[0];if(w===1){const P=`
          float ${f}(int row, int col) {
            int offset_${i} = coordsToOffset(TexCoords, ${T}, ${w});
            float index = dot(vec3(row, col, offset_${i}), vec3(${d[1]}, 1, 1));
            vec2 uv = vec2(0.5, (index + 0.5) / ${T}.0);
            return sampleTexture(${i}, uv);
          }
        `;return new o.GlslLibRoutine(P,["coordinates.sampleTexture","coordinates.coordsToOffset"])}if(T===1){const P=`
          float ${f}(int row, int col) {
            int offset_${i} = coordsToOffset(TexCoords, ${T}, ${w});
            float index = dot(vec3(row, col, offset_${i}), vec3(${d[1]}, 1, 1));
            vec2 uv = vec2((index + 0.5) / ${w}.0, 0.5);
            return sampleTexture(${i}, uv);
          }
        `;return new o.GlslLibRoutine(P,["coordinates.sampleTexture","coordinates.coordsToOffset"])}const E=`
        float ${f}(int row, int col) {
          int index = col * ${d[1]} + row;
          vec2 uv = uvFromFlat(${T}, ${w}, index);
          return sampleTexture(${i}, uv);
        }
      `;return new o.GlslLibRoutine(E,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler3D(f,i,r){const d=r.unpackedShape,p=d[1]*d[2],_=d[2],{newShape:y,keptDims:v}=(0,l.squeezeShape)(d),T=y;if(T.length<d.length){const E=(0,m.squeezeInputShape)(d,T),P=["batch","col","row"],R=JSON.parse(JSON.stringify(r));R.unpackedShape=E;const I=this.getUnpackedSamplerFromInput(f,i,R),N=v.reverse(),B=`
          ${I.routineBody}
          float ${f}(int batch, int row, int col) {
            return ${f}(${(0,m.getSqueezedParams)(P,N)});
          }
        `;return new o.GlslLibRoutine(B,I.dependencies)}const w=`
          float ${f}(int depth, int row, int col) {
            // Explicitly use integer operations as dot() only works on floats.
            int index = depth * ${p} + col * ${_} + row;
            vec2 uv = uvFromFlat(${r.width}, ${r.height}, index);
            return sampleTexture(${i}, uv);
          }
      `;return new o.GlslLibRoutine(w,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler4D(f,i,r){const d=r.unpackedShape,p=d[3],_=d[2]*p,y=`
        float ${f}(int row, int col, int depth, int depth2) {
          int index = row * ${d[1]*_} + col * ${_} +
              depth2 * ${p} + depth;
          vec2 uv = uvFromFlat(${r.width}, ${r.height}, index);
          return sampleTexture(${i}, uv);
        }
      `;return new o.GlslLibRoutine(y,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler5D(f,i,r){const d=r.unpackedShape,p=d[4],_=d[3]*p,y=d[2]*_,v=d[1]*y,{newShape:T,keptDims:w}=(0,l.squeezeShape)(d);if(T.length<d.length){const P=(0,m.squeezeInputShape)(d,T),R=["row","col","depth","depth2","depth3"],I=JSON.parse(JSON.stringify(r));I.unpackedShape=P;const N=`
          ${this.getUnpackedSamplerFromInput(f,i,I).routineBody}
          float ${f}(int row, int col, int depth, int depth2, int depth3) {
            return ${f}(${(0,m.getSqueezedParams)(R,w)});
          }
        `;return new o.GlslLibRoutine(N,["coordinates.sampleTexture","coordinates.uvFromFlat"])}const E=`
        float ${f}(int row, int col, int depth, int depth2, int depth3) {
          int index = row * ${v} + col * ${y} + depth * ${_} +
          depth3 * ${p} + depth2;
          vec2 uv = uvFromFlat(${r.width}, ${r.height}, index);
          return sampleTexture(${i}, uv);
        }
      `;return new o.GlslLibRoutine(E,["coordinates.sampleTexture","coordinates.uvFromFlat"])}getUnpackedSampler6D(f,i,r){const d=r.unpackedShape,p=d[5],_=d[4]*p,y=d[3]*_,v=d[2]*y,T=d[1]*v,{newShape:w,keptDims:E}=(0,l.squeezeShape)(d);if(w.length<d.length){const R=(0,m.squeezeInputShape)(d,w),I=["row","col","depth","depth2","depth3","depth4"],N=JSON.parse(JSON.stringify(r));N.unpackedShape=R;const B=`
            ${this.getUnpackedSamplerFromInput(f,i,N).routineBody}
            float ${f}(int row, int col, int depth,
              int depth2, int depth3, int depth4) {
              return ${f}(${(0,m.getSqueezedParams)(I,E)});
            }
          `;return new o.GlslLibRoutine(B,["coordinates.sampleTexture","coordinates.uvFromFlat"])}const P=`
          float ${f}(int row, int col, int depth,
            int depth2, int depth3, int depth4) {
            int index = row * ${T} + col * ${v} + depth * ${y} +
            depth2 * ${_} + depth3 * ${p} + depth4;
            vec2 uv = uvFromFlat(${r.width}, ${r.height}, index);
            return sampleTexture(${i}, uv);
          }
        `;return new o.GlslLibRoutine(P,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}toVec(){const f=this.context.outputTextureLayout,i=f.shape.length,r=f.strides,d=f.width,p=f.height,_=[];for(let v=0;v<i-1;++v)_.push(`
        c[${v}] = offset / ${r[v]};`),_.push(`
        offset -= c[${v}] * ${r[v]};`);_.push(`
        c[${i-1}] = offset;`);const y=`
      void toVec(vec2 texCoords, out int c[${i}]) {
        int offset = coordsToOffset(texCoords, ${d}, ${p});
        ${_.join("")}
      }
      void toVec(int offset, out int c[${i}]) {
        ${_.join("")}
      }
    `;return{toVec:new o.GlslLibRoutine(y,["coordinates.coordsToOffset"])}}valueFrom(){const f={};return this.context.programInfo.inputNames.forEach(((i,r)=>{const d=this.context.inputTextureLayouts[r],p=(d.unpackedShape.length>0?d.unpackedShape:d.shape).length;let _=`_${i}`;f[_]=new o.GlslLibRoutine(this.getValueFromSingle(i,p,d.width,d.height,!1),[`shapeUtils.indicesToOffset${_}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"]),_+="_T",f[_]=new o.GlslLibRoutine(this.getValueFromSingle(i,p,d.width,d.height,!0),[`shapeUtils.indicesToOffset${_}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"])})),f}getValueFromSingle(f,i,r,d,p){let _=`_${f}`;return p&&(_+="_T"),`
        float ${_}(int m[${i}]) {
          int offset = indicesToOffset${_}(m);
          vec2 coords = offsetToCoords(offset, ${r}, ${d});
          float value = getColorAsFloat(${(0,u.getGlsl)(this.context.glContext.version).texture2D}(${f}, coords));
          return value;
        }
        `}getPackedValueFrom(f,i,r,d,p){let _=`_${f}_Pack`;return p&&(_+="_T"),`
        vec4 ${_}(int m[${i}]) {
          int offset = indicesToOffset_${f}(m);
          vec2 coords = offsetToCoords(offset, ${r}, ${d});
          return ${(0,u.getGlsl)(this.context.glContext.version).texture2D}(${f}, coords);
        }
        `}}e.CoordsGlslLib=g},8520:(n,e)=>{var t;Object.defineProperty(e,"__esModule",{value:!0}),e.TopologicalSortGlslRoutines=e.GlslLibRoutineNode=e.GlslLibRoutine=e.GlslLib=e.GlslContext=e.FunctionType=void 0,(t=e.FunctionType||(e.FunctionType={}))[t.ValueBased=0]="ValueBased",t[t.Positional=1]="Positional",e.GlslContext=class{constructor(s,o,u,l){this.glContext=s,this.programInfo=o,this.inputTextureLayouts=u,this.outputTextureLayout=l}},e.GlslLib=class{constructor(s){this.context=s}},e.GlslLibRoutine=class{constructor(s,o){this.routineBody=s,this.dependencies=o}},e.GlslLibRoutineNode=class{constructor(s,o,u){this.name=s,this.dependencies=u||[],o&&(this.routineBody=o)}addDependency(s){s&&this.dependencies.push(s)}},e.TopologicalSortGlslRoutines=class{static returnOrderedNodes(s){if(!s||s.length===0)return[];if(s.length===1)return s;const o=new Set,u=new Set,l=new Array;return this.createOrderedNodes(s,o,u,l),l}static createOrderedNodes(s,o,u,l){for(let m=0;m<s.length;++m)this.dfsTraverse(s[m],o,u,l)}static dfsTraverse(s,o,u,l){if(!s||u.has(s.name))return;if(o.has(s.name))throw new Error("Cyclic dependency detected. Can't topologically sort routines needed for shader.");o.add(s.name);const m=s.dependencies;if(m&&m.length>0)for(let g=0;g<m.length;++g)this.dfsTraverse(m[g],o,u,l);l.push(s),u.add(s.name),o.delete(s.name)}}},7341:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EncodingGlslLib=void 0;const s=t(8520);class o extends s.GlslLib{constructor(l){super(l)}getFunctions(){return Object.assign(Object.assign({},this.encodeFloat32()),this.decodeFloat32())}getCustomTypes(){return{}}encodeFloat32(){return{encode:new s.GlslLibRoutine(`highp vec4 encode(highp float f) {
        return vec4(f, 0.0, 0.0, 0.0);
      }
        `)}}decodeFloat32(){return{decode:new s.GlslLibRoutine(`highp float decode(highp vec4 rgba) {
        return rgba.r;
      }
        `)}}encodeUint8(){const l=o.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{encode:new s.GlslLibRoutine(`
      highp vec4 encode(highp float f) {
        highp float F = abs(f);
        highp float Sign = step(0.0,-f);
        highp float Exponent = floor(log2(F));
        highp float Mantissa = (exp2(- Exponent) * F);
        Exponent = floor(log2(F) + 127.0) + floor(log2(Mantissa));
        highp vec4 rgba;
        rgba[0] = 128.0 * Sign  + floor(Exponent*exp2(-1.0));
        rgba[1] = 128.0 * mod(Exponent,2.0) + mod(floor(Mantissa*128.0),128.0);
        rgba[2] = floor(mod(floor(Mantissa*exp2(23.0 -8.0)),exp2(8.0)));
        rgba[3] = floor(exp2(23.0)*mod(Mantissa,exp2(-15.0)));
        ${l}
        rgba = rgba / 255.0; // values need to be normalized to [0,1]
        return rgba;
    }
        `)}}decodeUint8(){const l=o.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{decode:new s.GlslLibRoutine(`
        highp float decode(highp vec4 rgba) {
          rgba = rgba * 255.0; // values need to be de-normalized from [0,1] to [0,255]
          ${l}
          highp float Sign = 1.0 - step(128.0,rgba[0])*2.0;
          highp float Exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0;
          highp float Mantissa = mod(rgba[1],128.0)*65536.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);
          highp float Result =  Sign * exp2(Exponent) * (Mantissa * exp2(-23.0 ));
          return Result;
      }
        `)}}static isLittleEndian(){const l=new ArrayBuffer(4),m=new Uint32Array(l),g=new Uint8Array(l);if(m[0]=3735928559,g[0]===239)return!0;if(g[0]===222)return!1;throw new Error("unknown endianness")}}e.EncodingGlslLib=o},9894:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FragColorGlslLib=void 0;const s=t(8520),o=t(5060);class u extends s.GlslLib{constructor(m){super(m)}getFunctions(){return Object.assign(Object.assign({},this.setFragColor()),this.getColorAsFloat())}getCustomTypes(){return{}}setFragColor(){const m=(0,o.getGlsl)(this.context.glContext.version);return{setFragColor:new s.GlslLibRoutine(`
        void setFragColor(float value) {
            ${m.output} = encode(value);
        }
        `,["encoding.encode"])}}getColorAsFloat(){return{getColorAsFloat:new s.GlslLibRoutine(`
        float getColorAsFloat(vec4 color) {
            return decode(color);
        }
        `,["encoding.decode"])}}}e.FragColorGlslLib=u},2848:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.replaceInlines=void 0;const t=/@inline[\s\n\r]+(\w+)[\s\n\r]+([0-9a-zA-Z_]+)\s*\(([^)]*)\)\s*{(([^}]|[\n\r])*)}/gm;e.replaceInlines=function(s){const o={};let u;for(;(u=t.exec(s))!==null;){const l=u[3].split(",").map((m=>{const g=m.trim().split(" ");return g&&g.length===2?{type:g[0],name:g[1]}:null})).filter((m=>m!==null));o[u[2]]={params:l,body:u[4]}}for(const l in o){const m="(\\w+)?\\s+([_0-9a-zA-Z]+)\\s+=\\s+__FUNC__\\((.*)\\)\\s*;".replace("__FUNC__",l),g=new RegExp(m,"gm");for(;(u=g.exec(s))!==null;){const h=u[1],f=u[2],i=u[3].split(","),r=h?`${h} ${f};`:"";let d=o[l].body,p="";o[l].params.forEach(((y,v)=>{y&&(p+=`${y.type} ${y.name} = ${i[v]};
`)})),d=`${p}
 ${d}`,d=d.replace("return",`${f} = `);const _=`
      ${r}
      {
        ${d}
      }
      `;s=s.replace(u[0],_)}}return s.replace(t,"")}},8879:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlslPreprocessor=void 0;const s=t(8520),o=t(2848),u=t(5483),l=t(5060);e.GlslPreprocessor=class{constructor(m,g,h,f){this.libs={},this.glslLibRoutineDependencyGraph={},this.context=new s.GlslContext(m,g,h,f),Object.keys(u.glslRegistry).forEach((r=>{const d=new u.glslRegistry[r](this.context);this.libs[r]=d}));const i=this.glslLibRoutineDependencyGraph;for(const r in this.libs){const d=this.libs[r].getFunctions();for(const p in d){const _=r+"."+p;let y;i[_]?(y=i[_],y.routineBody=d[p].routineBody):(y=new s.GlslLibRoutineNode(_,d[p].routineBody),i[_]=y);const v=d[p].dependencies;if(v)for(let T=0;T<v.length;++T)if(i[v[T]])y.addDependency(i[v[T]]);else{const w=new s.GlslLibRoutineNode(v[T]);i[v[T]]=w,y.addDependency(w)}}}}preprocess(){const m=this.context.programInfo;let g=m.shaderSource;return this.context.programInfo.hasMain||(g=`${g}
      ${(0,l.getDefaultFragShaderMain)(this.context.glContext.version,this.context.outputTextureLayout.shape.length)}`),g=(0,o.replaceInlines)(g),`${(0,l.getFragShaderPreamble)(this.context.glContext.version)}
    ${this.getUniforms(m.inputNames,m.variables)}
    ${this.getImports(g)}
    ${g}`}getImports(m){const g=this.selectGlslLibRoutinesToBeIncluded(m);if(g.length===0)return"";let h="";for(let f=0;f<g.length;++f){if(!g[f].routineBody)throw new Error(`Missing body for the Glsl Library routine: ${g[f].name}`);h+=g[f].routineBody+`
`}return h}selectGlslLibRoutinesToBeIncluded(m){const g=[];return Object.keys(this.glslLibRoutineDependencyGraph).forEach((h=>{const f=h.split(".")[1];m.indexOf(f)!==-1&&g.push(this.glslLibRoutineDependencyGraph[h])})),s.TopologicalSortGlslRoutines.returnOrderedNodes(g)}getUniforms(m,g){const h=[];if(m)for(const f of m)h.push(`uniform sampler2D ${f};`);if(g)for(const f of g)h.push(`uniform ${f.type} ${f.name}${f.arrayLength?`[${f.arrayLength}]`:""};`);return h.join(`
`)}}},5483:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.glslRegistry=void 0;const s=t(5107),o=t(7341),u=t(9894),l=t(2655),m=t(3891);e.glslRegistry={encoding:o.EncodingGlslLib,fragcolor:u.FragColorGlslLib,vec:m.VecGlslLib,shapeUtils:l.ShapeUtilsGlslLib,coordinates:s.CoordsGlslLib}},2655:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ShapeUtilsGlslLib=void 0;const s=t(8520);class o extends s.GlslLib{constructor(l){super(l)}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.bcastIndex()),this.bcastMatmulIndex()),this.offsetToIndices()),this.indicesToOffset()),this.incrementIndices())}getCustomTypes(){return{}}bcastIndex(){const l=this.context.outputTextureLayout.shape.length,m={};return this.context.programInfo.inputNames.forEach(((g,h)=>{const f=this.context.inputTextureLayouts[h].unpackedShape;if(f.length<=l){const i=f.length,r=l-i,d=`bcastIndices_${g}`;let p="";for(let y=0;y<i;++y)p+=`
          realIndices[${y}] = int( mod(float(bcastedIndices[${r+y}]), ${f[y]}.0) );
          `;const _=`
        void ${d} (int bcastedIndices[${l}], out int realIndices[${i}]) {
          ${p}
        }
        `;m[d]=new s.GlslLibRoutine(_)}})),m}bcastMatmulIndex(){const l=this.context.outputTextureLayout.shape.length,m={};return this.context.programInfo.inputNames.forEach(((g,h)=>{const f=this.context.inputTextureLayouts[h].shape;if(!(f.length<2||f.length>l)){const i=f.length,r=l-i,d=`bcastMatmulIndices_${g}`;let p="";for(let y=0;y<i-2;++y)p+=`
          realIndices[${y}] = int( mod(float(bcastedIndices[${r+y}]), ${f[y]}.0) );
          `;const _=`
        void ${d}(int bcastedIndices[${l}], out int realIndices[${i}]) {
          ${p}
          realIndices[${i-1}] = bcastedIndices[${l-1}];
          realIndices[${i-2}] = bcastedIndices[${l-2}];
        }
        `;m[d]=new s.GlslLibRoutine(_)}})),m}indicesToOffset(){const l={};return this.context.programInfo.inputNames.forEach(((m,g)=>{const h=this.context.inputTextureLayouts[g].shape,f=this.context.inputTextureLayouts[g].strides,i=h.length;let r=`indicesToOffset_${m}`;l[r]=new s.GlslLibRoutine(o.indexToOffsetSingle(r,i,f)),r=`indicesToOffset_${m}_T`,l[r]=new s.GlslLibRoutine(o.indexToOffsetSingle(r,i,f.slice().reverse()))})),l}static indexToOffsetSingle(l,m,g){let h="";for(let f=m-1;f>=0;--f)h+=`
        offset += indices[${f}] * ${g[f]};
        `;return`
      int ${l}(int indices[${m}]) {
        int offset = 0;
        ${h}
        return offset;
      }
      `}offsetToIndices(){const l={};return this.context.programInfo.inputNames.forEach(((m,g)=>{const h=this.context.inputTextureLayouts[g].shape,f=this.context.inputTextureLayouts[g].strides,i=h.length;let r=`offsetToIndices_${m}`;l[r]=new s.GlslLibRoutine(o.offsetToIndicesSingle(r,i,f)),r=`offsetToIndices_${m}_T`,l[r]=new s.GlslLibRoutine(o.offsetToIndicesSingle(r,i,f.slice().reverse()))})),l}static offsetToIndicesSingle(l,m,g){const h=[];for(let f=0;f<m-1;++f)h.push(`
      indices[${f}] = offset / ${g[f]};`),h.push(`
        offset -= indices[${f}] * ${g[f]};`);return h.push(`
      indices[${m-1}] = offset;`),`
      void ${l}(int offset, out int indices[${m}]) {
        ${h.join("")}
      }
      `}incrementIndices(){const l={};return this.context.programInfo.inputNames.forEach(((m,g)=>{const h=this.context.inputTextureLayouts[g].shape,f=h.length,i=`incrementIndices_${m}`;let r="";for(let p=0;p<f;++p)r+=`
        shape[${p}] = ${h[p]};`;const d=`
        void ${i}(int axis, out int indices[${f}]) {
          int shape[${f}];
          ${r};
          for(int i = ${f} -1 ; i >= 0; --i) {
            if(i > axis) continue;
            indices[i] += 1;
            if(indices[i] < shape[i]) {
              break;
            }
            indices[i] = 0;
          }
        }
        `;l[i]=new s.GlslLibRoutine(d)})),l}}e.ShapeUtilsGlslLib=o},5060:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaultFragShaderMain=e.getFragShaderPreamble=e.getVertexShaderSource=e.getGlsl=void 0;const t={version:"",attribute:"attribute",varyingVertex:"varying",varyingFrag:"varying",texture2D:"texture2D",output:"gl_FragColor",outputDeclaration:""},s={version:"#version 300 es",attribute:"in",varyingVertex:"out",varyingFrag:"in",texture2D:"texture",output:"outputColor",outputDeclaration:"out vec4 outputColor;"};function o(u){return u===1?t:s}e.getGlsl=o,e.getVertexShaderSource=function(u){const l=o(u);return`${l.version}
      precision highp float;
      ${l.attribute} vec3 position;
      ${l.attribute} vec2 textureCoord;

      ${l.varyingVertex} vec2 TexCoords;

      void main()
      {
          gl_Position = vec4(position, 1.0);
          TexCoords = textureCoord;
      }`},e.getFragShaderPreamble=function(u){const l=o(u);return`${l.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${l.varyingFrag} vec2 TexCoords;
    ${l.outputDeclaration}
    const vec2 halfCR = vec2(0.5, 0.5);

    // Custom vector types to handle higher dimenalities.
    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    `},e.getDefaultFragShaderMain=function(u,l){return`
  void main() {
    int indices[${l}];
    toVec(TexCoords, indices);
    vec4 result = vec4(process(indices));
    ${o(u).output} = result;
  }
  `}},3891:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VecGlslLib=void 0;const s=t(8520);class o extends s.GlslLib{constructor(l){super(l)}getCustomTypes(){return{}}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign({},this.binaryVecFunctions()),this.copyVec()),this.setVecItem()),this.getVecItem())}binaryVecFunctions(){const l=this.context.outputTextureLayout.shape.length,m={add:"+=",sub:"-=",mul:"*=",div:"/="},g={};for(const h in m){const f=`${h}Vec`;let i="";for(let d=0;d<l;++d)i+=`
          dest[${d}] ${m[h]} src[${d}];
          `;const r=`
        void ${f}(int src[${l}], out int dest[${l}]) {
          ${i}
        }
        `;g[f]=new s.GlslLibRoutine(r)}return g}copyVec(){const l=this.context.outputTextureLayout.shape.length;let m="";for(let h=0;h<l;++h)m+=`
        dest[${h}] = src[${h}];
        `;const g=`
      void copyVec(int src[${l}], out int dest[${l}]) {
        ${m}
      }
      `;return{copyVec:new s.GlslLibRoutine(g)}}setVecItem(){const l=this.context.outputTextureLayout.shape.length;let m=`
        if(index < 0)
            index =${l} + index;
        if (index == 0)
            m[0] = value;
        `;for(let h=1;h<l-1;++h)m+=`
        else if (index == ${h})
            m[${h}] = value;
            `;m+=`
        else
            m[${l-1}] = value;
        `;const g=`
      void setVecItem(out int m[${l}], int index, int value) {
        ${m}
      }
        `;return{setVecItem:new s.GlslLibRoutine(g)}}getVecItem(){const l=this.context.outputTextureLayout.shape.length;let m=`
        if(index < 0)
            index = ${l} + index;
        if (index == 0)
            return m[0];
      `;for(let h=1;h<l-1;++h)m+=`
        else if (index == ${h})
            return m[${h}];
      `;m+=`
        else
            return m[${l-1}];
        `;const g=`
      int getVecItem(int m[${l}], int index) {
        ${m}
      }
    `;return{getVecItem:new s.GlslLibRoutine(g)}}}e.VecGlslLib=o},8316:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLInferenceHandler=void 0;const s=t(6231),o=t(9162),u=t(2517),l=t(2403),m=t(7019),g=t(8710),h=t(5611),f=t(4057),i=t(2039);e.WebGLInferenceHandler=class{constructor(r){this.session=r,this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map}calculateTextureWidthAndHeight(r,d){return(0,f.calculateTextureWidthAndHeight)(this.session.layoutStrategy,r,d)}executeProgram(r,d){if(d.length<r.inputNames.length)throw new Error(`Input size mustn't be less than ${r.inputNames.length}.`);if(r.inputNames.length!==r.inputTypes.length)throw new Error("input names size does not match input types");const p=[];for(let E=0;E<r.inputNames.length;++E)p[E]=this.getOrCreateTextureData(d[E],r.inputTypes[E]);const _=((E,P)=>{const R=P.map((N=>`${N.unpackedShape.join(",")};${N.width}x${N.height}`)).join("_");let I=E.name;return E.cacheHint&&(I+="["+E.cacheHint+"]"),I+=":"+R,I})(r,p);let y=this.session.programManager.getArtifact(_);const v=y?y.programInfo:typeof r.get=="function"?r.get():r,T=(0,f.createTextureLayoutFromTextureType)(this.session.layoutStrategy,v.output.dims,v.output.textureType),w=this.createTextureData(T,v.output.type);return y||(y=this.session.programManager.build(v,p,w),this.session.programManager.setArtifact(_,y)),this.runProgram(y,p,w),w}run(r,d){return this.executeProgram(r,d).tensor}runProgram(r,d,p){for(let _=0;_<d.length;++_)if(!!d[_].isPacked!=(r.programInfo.inputTypes[_]===i.TextureType.packed))throw new Error(`input[${_}] property packed inconsistent`);if(!!p.isPacked!=(r.programInfo.output.textureType===i.TextureType.packed))throw new Error("output property packed inconsistent");this.session.programManager.run(r,d,p)}getOrCreateTextureData(r,d){let p=this.getTextureData(r.dataId,d===i.TextureType.packed);if(!p&&(p=this.getTextureData(r.dataId,d!==i.TextureType.packed),p))return d===i.TextureType.packed?this.pack(p):this.unpack(p);if(!p){const _=(0,f.createTextureLayoutFromTextureType)(this.session.layoutStrategy,r.dims,d);if(d===i.TextureType.packedLastDimension){const T=r.dims;if(T.length===4){const w=[T[0],Math.ceil(T[1]*T[2]*T[3]/4)],E=(0,f.createTextureLayoutFromTextureType)(this.session.layoutStrategy,w,d);let P=r.numberData;if(T[1]*T[2]*T[3]%4!=0){const R=T[0],I=T[1]*T[2]*T[3],N=Math.ceil(I*1/4)*4;P=new Float32Array(R*N);for(let B=0;B<R;++B){const D=B*I,Y=B*N+B%1*I;P.set(r.numberData.subarray(D,D+I),Y)}}return this.createTextureData(E,r.type,P,r,1)}}if(d===i.TextureType.packed){const y=(0,f.createTextureLayoutFromShape)(this.session.layoutStrategy,r.dims,1,[],{reverseWH:!0}),v=this.createTextureData(y,r.type,r.numberData,r,1);p=this.pack(v)}else p=this.createTextureData(_,r.type,r.numberData,r,1)}return p}createTextureDataFromLayoutBindTensor(r,d,p,_){return this.createTextureData(r,d,p,_,1)}createTextureData(r,d,p,_,y){s.Logger.verbose("InferenceHandler",`Creating TextureData: layout:[${JSON.stringify(r)}]`);const v=this.session.textureManager.createTextureFromLayout(d,r,p,y);return this.createTextureDataFromTexture(r,d,v,_)}reshapeUnpacked(r,d){const p=this.getOrCreateTextureData(r,i.TextureType.unpacked),_={channels:p.channels,height:p.height,width:p.width,shape:d.length!==0?d:[1],strides:u.ShapeUtil.computeStrides(d),unpackedShape:d};return this.createTextureDataFromTexture(_,r.type,p.texture).tensor}reshapePacked(r,d){const p=this.getOrCreateTextureData(r,i.TextureType.packed);if((0,m.isReshapeCheap)(r.dims,d)){const w={channels:p.channels,height:p.height,width:p.width,shape:d.length!==0?d:[1],strides:u.ShapeUtil.computeStrides(d),unpackedShape:d,isPacked:!0};return this.createTextureDataFromTexture(w,r.type,p.texture).tensor}const _=(0,m.processDims3D)(r.dims),y=(0,m.processDims3D)(d),v=this.reshapePacked(r,_),T=this.run((0,m.createPackedReshape3DProgramInfoLoader)(this,v,y),[v]);return this.reshapePacked(T,d)}cast(r,d){const p=this.getOrCreateTextureData(r,i.TextureType.unpacked);return this.createTextureDataFromTexture(p,d,p.texture).tensor}createTextureDataFromTexture(r,d,p,_,y){const v=Object.assign(Object.assign({},r),{tensor:_||new o.Tensor(r.unpackedShape,d,(T=>this.readTexture(v)),(async T=>this.readTextureAsync(v)),void 0,y),texture:p});return this.setTextureData(v.tensor.dataId,v,r.isPacked),v}getTextureData(r,d=!1){return this.session.isInitializer(r)?this.session.getTextureData(r,d):d?this.packedTextureDataCache.get(r):this.unpackedTextureDataCache.get(r)}setTextureData(r,d,p=!1){this.session.isInitializer(r)?this.session.setTextureData(r,d,p):(p?this.packedTextureDataCache:this.unpackedTextureDataCache).set(r,d)}isTextureLayoutCached(r,d=!1){return!!this.getTextureData(r.dataId,d)}dispose(){this.session.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach((r=>this.session.textureManager.releaseTexture(r))),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach((r=>this.session.textureManager.releaseTexture(r))),this.unpackedTextureDataCache=new Map}readTexture(r){return r.isPacked?this.readTexture(this.unpack(r)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTexture(r,r.tensor.type,r.channels):this.session.textureManager.readUint8TextureAsFloat((0,g.encodeAsUint8)(this,r))}async readTextureAsync(r){return r.isPacked?this.readTextureAsync(this.unpack(r)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTextureAsync(r,r.tensor.type,r.channels):this.session.textureManager.readUint8TextureAsFloat((0,g.encodeAsUint8)(this,r))}pack(r){return this.executeProgram((0,l.createPackProgramInfoLoader)(this,r.tensor),[r.tensor])}unpack(r){return this.executeProgram((0,h.createUnpackProgramInfoLoader)(this,r.tensor),[r.tensor])}}},1640:function(n,e,t){var s=this&&this.__createBinding||(Object.create?function(ee,ce,q,le){le===void 0&&(le=q);var be=Object.getOwnPropertyDescriptor(ce,q);be&&!("get"in be?!ce.__esModule:be.writable||be.configurable)||(be={enumerable:!0,get:function(){return ce[q]}}),Object.defineProperty(ee,le,be)}:function(ee,ce,q,le){le===void 0&&(le=q),ee[le]=ce[q]}),o=this&&this.__setModuleDefault||(Object.create?function(ee,ce){Object.defineProperty(ee,"default",{enumerable:!0,value:ce})}:function(ee,ce){ee.default=ce}),u=this&&this.__importStar||function(ee){if(ee&&ee.__esModule)return ee;var ce={};if(ee!=null)for(var q in ee)q!=="default"&&Object.prototype.hasOwnProperty.call(ee,q)&&s(ce,ee,q);return o(ce,ee),ce};Object.defineProperty(e,"__esModule",{value:!0}),e.WEBGL_OP_RESOLVE_RULES=void 0;const l=t(2898),m=u(t(7839)),g=t(4196),h=t(2069),f=t(8138),i=t(9663),r=t(5193),d=t(7992),p=t(1253),_=t(4776),y=t(6572),v=t(3346),T=t(5623),w=t(2870),E=t(2143),P=t(4939),R=t(718),I=t(2268),N=t(8117),B=t(2278),D=t(5524),Y=t(5975),se=t(3933),re=t(6558),W=t(5723),$=t(3738),k=u(t(4909)),H=t(8428),de=t(9793);e.WEBGL_OP_RESOLVE_RULES=[["Abs","","6+",k.abs],["Acos","","7+",k.acos],["Add","","7+",m.add],["And","","7+",m.and],["Asin","","7+",k.asin],["Atan","","7+",k.atan],["AveragePool","","7+",E.averagePool,E.parseAveragePoolAttributes],["BatchNormalization","","7+",l.batchNormalization,l.parseBatchNormalizationAttributes],["Cast","","6+",g.cast,g.parseCastAttributes],["Ceil","","6+",k.ceil],["Clip","","6-10",k.clip,k.parseClipAttributes],["Clip","","11+",k.clipV11],["Concat","","4+",h.concat,h.parseConcatAttributes],["Conv","","1+",f.conv,f.parseConvAttributes],["ConvTranspose","","1+",i.convTranspose,i.parseConvTransposeAttributes],["Cos","","7+",k.cos],["Div","","7+",m.div],["Dropout","","7+",k.identity],["DepthToSpace","","1+",r.depthToSpace,r.parseDepthToSpaceAttributes],["Equal","","7+",m.equal],["Elu","","6+",k.elu,k.parseEluAttributes],["Exp","","6+",k.exp],["Flatten","","1+",d.flatten,d.parseFlattenAttributes],["Floor","","6+",k.floor],["FusedConv","com.microsoft","1+",f.conv,f.parseConvAttributes],["Gather","","1+",p.gather,p.parseGatherAttributes],["Gemm","","7-10",_.gemm,_.parseGemmAttributesV7],["Gemm","","11+",_.gemm,_.parseGemmAttributesV11],["GlobalAveragePool","","1+",E.globalAveragePool,E.parseGlobalAveragePoolAttributes],["GlobalMaxPool","","1+",E.globalMaxPool],["Greater","","7+",m.greater],["Identity","","1+",k.identity],["ImageScaler","","1+",y.imageScaler,y.parseImageScalerAttributes],["InstanceNormalization","","6+",v.instanceNormalization,v.parseInstanceNormalizationAttributes],["LeakyRelu","","6+",k.leakyRelu,k.parseLeakyReluAttributes],["Less","","7+",m.less],["Log","","6+",k.log],["MatMul","","1+",T.matMul,T.parseMatMulAttributes],["MaxPool","","1+",E.maxPool,E.parseMaxPoolAttributes],["Mul","","7+",m.mul],["Neg","","6+",k.neg],["Not","","1+",k.not],["Or","","7+",m.or],["Pad","","2-10",w.padV2,w.parsePadAttributesV2],["Pad","","11+",w.padV11,w.parsePadAttributesV11],["Pow","","7+",m.pow],["PRelu","","7+",m.pRelu],["ReduceLogSum","","1+",P.reduceLogSum,P.parseReduceAttributes],["ReduceMax","","1+",P.reduceMax,P.parseReduceAttributes],["ReduceMean","","1+",P.reduceMean,P.parseReduceAttributes],["ReduceMin","","1+",P.reduceMin,P.parseReduceAttributes],["ReduceProd","","1+",P.reduceProd,P.parseReduceAttributes],["ReduceSum","","1-12",P.reduceSum,P.parseReduceAttributes],["ReduceSumSquare","","1+",P.reduceLogSumSquare,P.parseReduceAttributes],["Relu","","6+",k.relu],["Reshape","","5+",R.reshape],["Resize","","10",I.resize,I.parseResizeAttributesV10],["Resize","","11+",I.resize,I.parseResizeAttributesV11],["Shape","","1+",N.shape],["Sigmoid","","6+",k.sigmoid],["Sin","","7+",k.sin],["Slice","","10+",B.sliceV10],["Slice","","1-9",B.slice,B.parseSliceAttributes],["Softmax","","1-12",D.softmax,D.parseSoftmaxAttributes],["Softmax","","13+",D.softmaxV13,D.parseSoftmaxAttributesV13],["Split","","2-12",Y.split,Y.parseSplitAttributes],["Sqrt","","6+",k.sqrt],["Squeeze","","1-12",se.squeeze,se.parseSqueezeAttributes],["Squeeze","","13+",se.squeezeV13],["Sub","","7+",m.sub],["Sum","","6+",re.sum],["Tan","","7+",k.tan],["Tanh","","6+",k.tanh],["Tile","","6+",W.tile],["Transpose","","1+",$.transpose,$.parseTransposeAttributes],["Upsample","","7-8",de.upsample,de.parseUpsampleAttributesV7],["Upsample","","9",de.upsample,de.parseUpsampleAttributesV9],["Unsqueeze","","1-12",H.unsqueeze,H.parseUnsqueezeAttributes],["Unsqueeze","","13+",H.unsqueezeV13],["Xor","","7+",m.xor]]},2898:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseBatchNormalizationAttributes=e.batchNormalization=void 0;const s=t(246),o=t(5060),u=t(2039),l={name:"BatchNormalization",inputNames:["A","Scale","B","Mean","Variance"],inputTypes:[u.TextureType.unpacked,u.TextureType.unpacked,u.TextureType.unpacked,u.TextureType.unpacked,u.TextureType.unpacked]};e.batchNormalization=(h,f,i)=>(g(f),[h.run(Object.assign(Object.assign({},l),{cacheHint:i.cacheKey,get:()=>m(h,f,i)}),f)]),e.parseBatchNormalizationAttributes=h=>{const f=h.attributes.getFloat("epsilon",1e-5),i=h.attributes.getFloat("momentum",.9),r=h.attributes.getInt("spatial",1);return(0,s.createAttributeWithCacheKey)({epsilon:f,momentum:i,spatial:r})};const m=(h,f,i)=>{const r=(0,o.getGlsl)(h.session.backend.glContext.version),d=f[0].dims.length,[p,_]=h.calculateTextureWidthAndHeight(f[1].dims,u.TextureType.unpacked),y=`
  float process(int[${d}] indices) {
    vec2 position = offsetToCoords(indices[1], ${p}, ${_});
    float scale = getColorAsFloat(${r.texture2D}(Scale, position));
    float mean = getColorAsFloat(${r.texture2D}(Mean, position));
    float variance = getColorAsFloat(${r.texture2D}(Variance, position));
    float b = getColorAsFloat(${r.texture2D}(B, position));

    return scale * ( (_A(indices) - mean) / sqrt(variance + float(${i.epsilon})) ) + b;
  }`;return Object.assign(Object.assign({},l),{output:{dims:f[0].dims,type:f[0].type,textureType:u.TextureType.unpacked},shaderSource:y})},g=h=>{if(!h||h.length!==5)throw new Error("BatchNormalization requires 5 inputs.");const f=h[0],i=h[1],r=h[2],d=h[3],p=h[4];if(f.dims.length<3||i.dims.length!==1||r.dims.length!==1||d.dims.length!==1||p.dims.length!==1)throw new Error("invalid input shape.");if(i.dims[0]!==f.dims[1]||r.dims[0]!==f.dims[1]||d.dims[0]!==f.dims[1]||p.dims[0]!==f.dims[1])throw new Error("invalid input shape.");if(f.type!=="float32"&&f.type!=="float64"||i.type!=="float32"&&i.type!=="float64"||r.type!=="float32"&&r.type!=="float64"||d.type!=="float32"&&d.type!=="float64"||p.type!=="float32"&&p.type!=="float64")throw new Error("invalid input tensor types.")}},7839:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.xor=e.sub=e.pRelu=e.pow=e.or=e.mul=e.less=e.greater=e.equal=e.div=e.and=e.add=e.glslPRelu=e.glslPow=e.glslXor=e.glslOr=e.glslAnd=e.glslLess=e.glslGreater=e.glslEqual=e.glslSub=e.glslMul=e.glslDiv=e.glslAdd=void 0;const s=t(2517),o=t(8520),u=t(5060),l=t(2039);function m(){const P="add_";return{body:`
  float ${P}(float a, float b) {
    return a + b;
  }
  vec4 ${P}(vec4 v1, vec4 v2) {
    return v1 + v2;
  }
  `,name:P,type:o.FunctionType.ValueBased}}function g(){const P="div_";return{body:`
  float ${P}(float a, float b) {
    return a / b;
  }
  vec4 ${P}(vec4 v1, vec4 v2) {
    return v1 / v2;
  }
  `,name:P,type:o.FunctionType.ValueBased}}function h(){const P="mul_";return{body:`
  float ${P}(float a, float b) {
    return a * b;
  }
  vec4 ${P}(vec4 v1, vec4 v2) {
    return v1 * v2;
  }
  `,name:P,type:o.FunctionType.ValueBased}}function f(){const P="sub_";return{body:`
  float ${P}(float a, float b) {
    return a - b;
  }
  vec4 ${P}(vec4 v1, vec4 v2) {
    return v1 - v2;
  }
  `,name:P,type:o.FunctionType.ValueBased}}function i(){const P="equal_";return{body:`
  float ${P}(float a, float b) {
    return float(a == b);
  }
  vec4 ${P}(vec4 v1, vec4 v2) {
    return vec4(equal(v1, v2));
  }
  `,name:P,type:o.FunctionType.ValueBased}}function r(){const P="greater_";return{body:`
  float ${P}(float a, float b) {
    return float(a > b);
  }
  vec4 ${P}(vec4 v1, vec4 v2) {
    return vec4( v1.r > v2.r ,
      v1.g > v2.g,
      v1.b > v2.b,
      v1.a > v2.a );
  }
  `,name:P,type:o.FunctionType.ValueBased}}function d(){const P="less_";return{body:`
  float ${P}(float a, float b) {
    return float(a < b);
  }
  vec4 ${P}(vec4 v1, vec4 v2) {
    return vec4( v1.r < v2.r ,
                v1.g < v2.g,
                v1.b < v2.b,
                v1.a < v2.a );
  }
  `,name:P,type:o.FunctionType.ValueBased}}function p(){const P="and_";return{body:`
  float ${P}(float a, float b) {
    return float( bool(a) && bool(b) );
  }
  vec4 ${P}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r && b2.r ,
                b1.g && b2.g,
                b1.b && b2.b,
                b1.a && b2.a );
  }
  `,name:P,type:o.FunctionType.ValueBased}}function _(){return{body:`
  float or_(float a, float b) {
    return float( bool(a) || bool(b) );
  }
  vec4 or_(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r || b2.r ,
                b1.g || b2.g,
                b1.b || b2.b,
                b1.a || b2.a );
  }
  `,name:"or_",type:o.FunctionType.ValueBased}}function y(){const P="xor_";return{body:`
  float ${P}(float a, float b) {
    return float( bool(a) ^^ bool(b) );
  }
  vec4 ${P}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r ^^ b2.r ,
                b1.g ^^ b2.g,
                b1.b ^^ b2.b,
                b1.a ^^ b2.a );
  }
  `,name:P,type:o.FunctionType.ValueBased}}function v(){return(function(P){const R=`${P}_`;return{body:`
  float ${R}(float a, float b) {
    return ${P}(a, b);
  }
  vec4 ${R}(vec4 v1, vec4 v2) {
    return ${P}(v1, v2);
  }
  `,name:R,type:o.FunctionType.ValueBased}})("pow")}function T(){const P="prelu_";return{body:`
  float ${P}(float a, float b) {
    return a < 0.0 ? a * b: a;
  }
  vec4 ${P}(vec4 v1, vec4 v2) {
    return vec4(
      v1.r < 0.0 ? v1.r * v2.r: v1.r,
      v1.g < 0.0 ? v1.g * v2.g: v1.g,
      v1.b < 0.0 ? v1.b * v2.b: v1.b,
      v1.a < 0.0 ? v1.a * v2.a: v1.a
      );
  }
  `,name:P,type:o.FunctionType.ValueBased}}e.glslAdd=m,e.glslDiv=g,e.glslMul=h,e.glslSub=f,e.glslEqual=i,e.glslGreater=r,e.glslLess=d,e.glslAnd=p,e.glslOr=_,e.glslXor=y,e.glslPow=v,e.glslPRelu=T;const w=(P,R,I,N=R[0].type,B)=>{const D=P.session.pack?l.TextureType.packed:l.TextureType.unpacked;return{name:I.name,inputNames:["A","B"],inputTypes:[D,D],cacheHint:B,get:()=>E(P,R,I,N)}},E=(P,R,I,N=R[0].type)=>{const B=P.session.pack?l.TextureType.packed:l.TextureType.unpacked,D=!s.ShapeUtil.areEqual(R[0].dims,R[1].dims);let Y=R[0].dims;const se=P.session.pack;if(D){const $=s.BroadcastUtil.calcShape(R[0].dims,R[1].dims,!1);if(!$)throw new Error("Can't perform binary op on the given tensors");Y=$;const k=Y.length,H=R[0].dims.length!==0?R[0].dims.length:1,de=R[1].dims.length!==0?R[1].dims.length:1,ee=R[0].dims.length!==0?"bcastIndices_A(indices, aindices);":"aindices[0] = 0;",ce=R[1].dims.length!==0?"bcastIndices_B(indices, bindices);":"bindices[0] = 0;",q=(0,u.getGlsl)(P.session.backend.glContext.version),le=se?`
      ${I.body}
      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();
        vec4 result = ${I.name}(a, b);
        ${q.output} = result;
      }`:`
      ${I.body}
      float process(int indices[${k}]) {
        int aindices[${H}];
        int bindices[${de}];
        ${ee}
        ${ce}
        return ${I.name}(_A(aindices), _B(bindices));
      }`;return{name:I.name,inputNames:["A","B"],inputTypes:[B,B],output:{dims:Y,type:N,textureType:B},shaderSource:le,hasMain:se}}const re=(0,u.getGlsl)(P.session.backend.glContext.version),W=`
    ${I.body}
    void main() {
      vec4 v1 = ${re.texture2D}(A, TexCoords);
      vec4 v2 = ${re.texture2D}(B, TexCoords);
      vec4 result = ${I.name}(v1, v2);
      ${re.output} = result;
    }
    `;return{name:I.name,inputNames:["A","B"],inputTypes:[B,B],output:{dims:R[0].dims,type:N,textureType:B},shaderSource:W,hasMain:!0}};e.add=(P,R)=>[P.run(w(P,R,m()),R)],e.and=(P,R)=>[P.run(w(P,R,p(),"bool"),R)],e.div=(P,R)=>[P.run(w(P,R,g()),R)],e.equal=(P,R)=>[P.run(w(P,R,i(),"bool"),R)],e.greater=(P,R)=>[P.run(w(P,R,r(),"bool"),R)],e.less=(P,R)=>[P.run(w(P,R,d(),"bool"),R)],e.mul=(P,R)=>[P.run(w(P,R,h()),R)],e.or=(P,R)=>[P.run(w(P,R,_(),"bool"),R)],e.pow=(P,R)=>[P.run(w(P,R,v()),R)],e.pRelu=(P,R)=>[P.run(w(P,R,T()),R)],e.sub=(P,R)=>[P.run(w(P,R,f()),R)],e.xor=(P,R)=>[P.run(w(P,R,y(),"bool"),R)]},4196:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseCastAttributes=e.cast=void 0;const s=t(2517);e.cast=(u,l,m)=>(o(l),[u.cast(l[0],m)]),e.parseCastAttributes=u=>s.ProtoUtil.tensorDataTypeFromProto(u.attributes.getInt("to"));const o=u=>{if(!u||u.length!==1)throw new Error("Cast requires 1 input.");if(u[0].type==="string")throw new Error("Invalid input type.")}},1163:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createPackedConcatProgramInfoLoader=void 0;const s=t(5060),o=t(2039),u=t(9390),l=t(2827);e.createPackedConcatProgramInfoLoader=(g,h,f)=>{const i=(r=h.length,d=f.cacheKey,{name:"Concat (packed)",inputNames:Array.from({length:r},((p,_)=>`X${_}`)),inputTypes:Array(r).fill(o.TextureType.packed),cacheHint:d});var r,d;return Object.assign(Object.assign({},i),{get:()=>((p,_,y,v)=>{const T=y[0].dims.slice();if(v>=T.length||v<-1*T.length)throw new Error("axis specified for concat doesn't match input dimensionality");v<0&&(v=T.length+v);const w=T.slice(0);for(let ee=1;ee<y.length;ee++){const ce=y[ee].dims.slice();for(let q=0;q<T.length;q++)if(q===v)w[v]+=ce[q];else if(T[q]!==ce[q])throw new Error("non concat dimensions must match")}const E=w.length,P=(0,l.getChannels)("coords",E),R=(0,u.getCoordsDataType)(E),I=(0,l.unpackFromChannel)(),N=y.map((ee=>ee.dims)),B=(0,u.getGlChannels)(E),D=new Array(N.length-1);D[0]=N[0][v];for(let ee=1;ee<D.length;ee++)D[ee]=D[ee-1]+N[ee][v];const Y=B[v],se=B.slice(-2),re=B.join();let W=`if (${Y} < ${D[0]}) {
        return getChannel(
            getX0(${re}), vec2(${se.join()}));
        }`;for(let ee=1;ee<D.length;ee++){const ce=D[ee-1];W+=`
            if (${Y} < ${D[ee]}  && ${Y} >= ${D[ee-1]}) {
              return getChannel(
                getX${ee}(${m(B,Y,ce)}),
                vec2(${m(se,Y,ce)}));
            }`}const $=D.length,k=D[D.length-1];W+=`
            return getChannel(
              getX${$}(${m(B,Y,k)}),
              vec2(${m(se,Y,k)}));`;const H=(0,s.getGlsl)(p.session.backend.glContext.version),de=`
          ${I}
          float getValue(${B.map((ee=>"int "+ee))}) {
            ${W}
          }

          void main() {
            ${R} coords = getOutputCoords();
            int lastDim = coords.${B[E-1]};
            coords.${B[E-1]} = coords.${B[E-2]};
            coords.${B[E-2]} = lastDim;

            vec4 result = vec4(getValue(${P}), 0., 0., 0.);

            ${P[E-1]} = ${P[E-1]} + 1;
            if (${P[E-1]} < ${w[E-1]}) {
              result.g = getValue(${P});
            }

            ${P[E-2]} = ${P[E-2]} + 1;
            if (${P[E-2]} < ${w[E-2]}) {
              result.a = getValue(${P});
            }

            ${P[E-1]} = ${P[E-1]} - 1;
            if (${P[E-2]} < ${w[E-2]} &&
                ${P[E-1]} < ${w[E-1]}) {
              result.b = getValue(${P});
            }
            ${H.output} = result;
          }
        `;return Object.assign(Object.assign({},_),{output:{dims:w,type:y[0].type,textureType:o.TextureType.packed},shaderSource:de,hasMain:!0})})(g,i,h,f.axis)})};const m=(g,h,f)=>{const i=g.indexOf(h);return g.map(((r,d)=>d===i?`${r} - ${f}`:r)).join()}},2069:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseConcatAttributes=e.concat=void 0;const s=t(246),o=t(2039),u=t(1163);e.concat=(r,d,p)=>(i(d),r.session.pack&&d[0].dims.length>1?[r.run((0,u.createPackedConcatProgramInfoLoader)(r,d,p),d)]:[r.run(l(r,d,p),d)]);const l=(r,d,p)=>{const _=(y=d.length,v=p.cacheKey,{name:"Concat",inputNames:Array.from({length:y},((T,w)=>`X${w}`)),inputTypes:Array(y).fill(o.TextureType.unpacked),cacheHint:v});var y,v;return Object.assign(Object.assign({},_),{get:()=>((T,w,E,P)=>{const R=E[0].dims.slice();if(P>=R.length||P<-1*R.length)throw new Error("axis specified for concat doesn't match input dimensionality");P<0&&(P=R.length+P);const I=R.slice(0);for(let re=1;re<E.length;re++){const W=E[re].dims.slice();for(let $=0;$<R.length;$++)if($===P)I[P]+=W[$];else if(R[$]!==W[$])throw new Error("non concat dimensions must match")}const N=I.length,B=new Array(E.length);let D=0;for(let re=0;re<B.length;++re)D+=E[re].dims[P],B[re]=D;let Y="";Y=E.length<5?m(B):g(B);const se=`
        ${h(E.length,N)}
        ${f(B)}
        ${Y}
        float process(int indices[${N}]) {
          int textureIndex = getTextureWhereDataResides (indices[${P}]);

          if(textureIndex != 0) {
            indices[${P}] = indices[${P}] - int(getSizeInConcatAxisValueFromIndex(textureIndex-int(1)));
          }

          return fetchDataFromCorrectTexture(textureIndex, indices);
        }`;return Object.assign(Object.assign({},w),{output:{dims:I,type:E[0].type,textureType:o.TextureType.unpacked},shaderSource:se})})(0,_,d,p.axis)})},m=r=>`int getTextureWhereDataResides(int index) {
      ${r.map(((d,p)=>`if(index<${d}) {return ${p};}
`)).join("")}
    }`,g=r=>m(r),h=(r,d)=>{const p=[`float fetchDataFromCorrectTexture(int textureIndex, int indices[${d}]) {`];for(let _=0;_<r;++_)_===0?p.push(`	if (textureIndex == ${_}) { return _X${_}(indices); }`):_===r-1?p.push(`	else { return _X${_}(indices); }`):p.push(`	else if (textureIndex == ${_}) { return _X${_}(indices); }`);return p.push("	}"),p.join(`
`)},f=r=>{const d=["int getSizeInConcatAxisValueFromIndex(int index) {"];for(let p=0;p<r.length;++p)p===0?d.push(`	if (index == ${p}) { return ${r[p]}; }`):p===r.length-1?d.push(`	else { return ${r[p]}; }`):d.push(`	else if (index == ${p}) { return ${r[p]}; }`);return d.push("	}"),d.join(`
`)};e.parseConcatAttributes=r=>(0,s.createAttributeWithCacheKey)({axis:r.attributes.getInt("axis")});const i=r=>{if(!r||r.length<1)throw new Error("too few inputs");const d=r[0].type,p=r[0].dims.length;if(d==="string")throw new Error("string tensor is not supported yet");for(const _ of r){if(_.type!==d)throw new Error("input tensors should be one type");if(_.dims.length!==p)throw new Error("input tensors should have the same shape")}}},4770:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createUnpackedGroupedConvProgramInfoLoader=void 0;const s=t(6231),o=t(5060),u=t(2039),l=t(8138),m=t(2823);e.createUnpackedGroupedConvProgramInfoLoader=(g,h,f)=>{const i=(r=h.length>2,d=f.cacheKey,{name:"GroupedConv",inputNames:r?["X","W","Bias"]:["X","W"],inputTypes:r?[u.TextureType.unpacked,u.TextureType.unpacked,u.TextureType.unpacked]:[u.TextureType.unpacked,u.TextureType.unpacked],cacheHint:d});var r,d;return Object.assign(Object.assign({},i),{get:()=>((p,_,y,v)=>{const T=_.length>2?"value += getBias(output_channel);":"",w=_[0].dims.slice(),E=_[1].dims.slice(),P=E[0]/v.group;s.Logger.verbose("GroupedConv",`autpPad:${v.autoPad}, dilations:${v.dilations}, group:${v.group}, kernelShape:${v.kernelShape}, pads:${v.pads}, strides:${v.strides}`);const R=(0,l.calculateOutputShape)(w,E,v.dilations,v.pads,v.strides),I=(0,o.getGlsl)(p.session.backend.glContext.version),{activationFunction:N,applyActivation:B}=(0,m.getActivationSnippet)(v),D=`
  const ivec2 strides = ivec2(${v.strides[0]}, ${v.strides[1]});
  const ivec2 pads = ivec2(${v.pads[0]}, ${v.pads[1]});
  ${N}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;
    ivec2 xRCCorner = coords.zw * strides - pads;
    int group_id = output_channel / ${P};

    float value = 0.0;
    for (int wInChannel = 0; wInChannel < ${E[1]}; wInChannel++) {
      int input_channel = group_id * ${E[1]} + wInChannel;
      for (int wHeight = 0; wHeight < ${E[2]}; wHeight++) {
        int xHeight = xRCCorner.x + wHeight * ${v.dilations[0]};

        if (xHeight < 0 || xHeight >= ${w[2]}) {
          continue;
        }

        for (int wWidth = 0; wWidth < ${E[3]}; wWidth++) {
          int xWidth = xRCCorner.y + wWidth * ${v.dilations[1]};
          if (xWidth < 0 || xWidth >= ${w[3]}) {
            continue;
          }

          float xVal = getX(batch, input_channel, xWidth, xHeight);
          float wVal = getW(output_channel, wInChannel, wWidth, wHeight);
          value += xVal*wVal;
        }
      }
    }
    ${T}
    ${B}
    ${I.output} = vec4(value, .0, .0, .0);
  }
`;return Object.assign(Object.assign({},y),{output:{dims:R,type:_[0].type,textureType:u.TextureType.unpacked},shaderSource:D,hasMain:!0})})(g,h,i,f)})}},1386:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.conv2DPacked=e.conv2DPackedPointwise=void 0;const s=t(8138),o=t(8555),u=t(708);e.conv2DPackedPointwise=(l,m,g)=>{const h=m[0].dims,f=m[1].dims,i=(0,s.calculateOutputShape)(h,f,g.dilations,g.pads,g.strides),r=l.reshapePacked(m[0],[h[1],h[2]*h[3]]),d=l.reshapePacked(m[1],[f[0],f[1]]),p=m.length>2?[d,r,m[2]]:[d,r],_=l.run((0,u.createPackedMatmulProgramInfoLoader)(l,p,g),p);return l.reshapePacked(_,i)},e.conv2DPacked=(l,m,g)=>{const h=m[0].dims,f=m[1].dims,i=(0,s.calculateOutputShape)(h,f,g.dilations,g.pads,g.strides),r=l.run((0,o.createPackedIm2ColProgramInfoLoader)(l,m[0],m[1],i,g),[m[0]]),d=l.reshapePacked(m[1],[f[0],f[1]*f[2]*f[3]]),p=m.length===3?[d,r,m[2]]:[d,r],_=l.run((0,u.createPackedMatmulProgramInfoLoader)(l,p,g),p);return l.reshapePacked(_,i)}},9663:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseConvTransposeAttributes=e.convTranspose=void 0;const s=t(246),o=t(5060),u=t(2039),l=t(2823),m=(d,p,_,y,v,T)=>(d-1)*p+_+(y-1)*v+1-T,g=(d,p,_,y,v)=>{const T=Math.floor(d/2);p==="SAME_UPPER"?(_[y]=T,_[v]=d-T):p==="SAME_LOWER"&&(_[y]=d-T,_[v]=T)};e.convTranspose=(d,p,_)=>(r(p,_),h(d,p,_));const h=(d,p,_)=>{const y=i(_,p);return[f(d,p,y)]},f=(d,p,_)=>d.run(((y,v,T)=>{const w=(E=v.length>2,P=T.cacheKey,{name:"ConvTranspose",inputNames:E?["X","W","B"]:["X","W"],inputTypes:E?[u.TextureType.unpacked,u.TextureType.unpacked,u.TextureType.unpacked]:[u.TextureType.unpacked,u.TextureType.unpacked],cacheHint:P});var E,P;return Object.assign(Object.assign({},w),{get:()=>((R,I,N,B)=>{const D=I.length>2?"getB(output_channel)":"0.0",Y=I[0].dims,se=I[1].dims,re=se[1],W=se[0]/B.group,$=[I[0].dims[0],I[1].dims[1]*B.group,...B.outputShape],k=(0,o.getGlsl)(R.session.backend.glContext.version),{activationFunction:H,applyActivation:de}=(0,l.getActivationSnippet)(B),ee=`
  const ivec2 strides = ivec2(${B.strides[0]}, ${B.strides[1]});
  const ivec2 pads = ivec2(${B.pads[0]}, ${B.pads[1]});
  ${H}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;

    ivec2 loc = coords.zw + pads;

    int group_id = output_channel / ${re};
    int wOutChannel = output_channel - group_id * ${re};

    float value = ${D};
    for (int inChannelOffset = 0; inChannelOffset < ${W}; inChannelOffset++) {
      int input_channel = group_id * ${W} + inChannelOffset;
      for (int wWOff = 0; wWOff < ${se[2]}; wWOff++) {
        for (int wHOff = 0; wHOff < ${se[3]}; wHOff++) {
          ivec2 wOff = ivec2(wWOff * ${B.dilations[0]}, wHOff * ${B.dilations[1]});
          ivec2 wLoc = loc - wOff;
          ivec2 wLocIn = wLoc / strides;
          if (
            wLocIn * strides == wLoc &&
            wLocIn.x >= 0 && wLocIn.x < ${Y[2]} &&
            wLocIn.y >= 0 && wLocIn.y < ${Y[3]}
          ) {
            float xVal = getX(batch, input_channel, wLocIn.y, wLocIn.x);
            float wVal = getW(input_channel, wOutChannel, wHOff, wWOff);
            value += xVal * wVal;
          }
        }
      }
    }
    ${de}
    ${k.output} = vec4(value, .0, .0, .0);
  }
`;return Object.assign(Object.assign({},N),{output:{dims:$,type:I[0].type,textureType:u.TextureType.unpacked},shaderSource:ee,hasMain:!0})})(y,v,w,T)})})(d,p,_),p),i=(d,p)=>{const _=d.kernelShape.slice();if(d.kernelShape.length===0)for(let w=2;w<p[1].dims.length;++w)_.push(p[1].dims[w]);const y=d.pads.slice(),v=d.outputShape.slice();((w,E,P,R,I,N,B,D)=>{const Y=w.length-2,se=D.length===0;for(let re=0;re<Y;++re){const W=se?w[re+2]*N[re]:D[re],$=m(w[re+2],N[re],I[re],E[re],P[re],W);g($,R,I,re,re+Y),se&&D.push(N[re]*(w[re+2]-1)+B[re]+(E[re]-1)*P[re]+1-I[re]-I[re+Y])}})(p[0].dims,_,d.dilations,d.autoPad,y,d.strides,d.outputPadding,v);const T=Object.assign({},d);return Object.assign(T,{kernelShape:_,pads:y,outputShape:v,cacheKey:d.cacheKey}),T};e.parseConvTransposeAttributes=d=>{const p=d.attributes,_=(0,l.parseInternalActivationAttributes)(p),y=p.getString("auto_pad","NOTSET"),v=p.getInts("dilations",[1,1]),T=p.getInt("group",1),w=p.getInts("kernel_shape",[]),E=p.getInts("output_padding",[0,0]),P=p.getInts("output_shape",[]),R=p.getInts("pads",[0,0,0,0]),I=p.getInts("strides",[1,1]);return(0,s.createAttributeWithCacheKey)(Object.assign({autoPad:y,dilations:v,group:T,kernelShape:w,outputPadding:E,outputShape:P,pads:R,strides:I},_))};const r=(d,p)=>{if(!d||d.length!==2&&d.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(d[0].dims.length!==4||d[1].dims.length!==4)throw new Error("currently only support 2-dimensional conv");if(d[0].dims[1]!==d[1].dims[0])throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");const _=d[1].dims[1]*p.group;if(d.length===3&&(d[2].dims.length!==1||d[2].dims[0]!==_))throw new Error("invalid bias");const y=d[0].dims.length-2;if(p.dilations.length!==y)throw new Error(`dilations should be ${y}D`);if(p.strides.length!==y)throw new Error(`strides should be ${y}D`);if(p.pads.length!==2*y)throw new Error(`pads should be ${2*y}D`);if(p.outputPadding.length!==y)throw new Error(`output_padding should be ${y}D`);if(p.kernelShape.length!==0&&p.kernelShape.length!==d[1].dims.length-2)throw new Error("invalid kernel shape");if(p.outputShape.length!==0&&p.outputShape.length!==d[0].dims.length-2)throw new Error("invalid output shape");if(d[0].type!=="float32"||d[1].type!=="float32")throw new Error("ConvTranspose input(X,W) should be float tensor");if(d.length===3&&d[2].type!=="float32")throw new Error("ConvTranspose input(bias) should be float tensor")}},8138:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseConvAttributes=e.conv=e.calculateOutputShape=void 0;const s=t(246),o=t(2517),u=t(4770),l=t(1386),m=t(9828),g=t(2823),h=t(3248),f=t(5623);e.calculateOutputShape=(y,v,T,w,E)=>{const P=y[0],R=y.slice(2),I=R.length,N=v[0],B=v.slice(2).map(((Y,se)=>Y+(Y-1)*(T[se]-1))),D=R.map(((Y,se)=>Y+w[se]+w[se+I])).map(((Y,se)=>Math.floor((Y-B[se]+E[se])/E[se])));return[P,N].concat(...D)},e.conv=(y,v,T)=>(_(v,T),i(y,v,T));const i=(y,v,T)=>{const w=p(T,v),E=y.session.pack,P=w.kernelShape[0]===1&&w.kernelShape[1]===1;return w.group>1?[y.run((0,u.createUnpackedGroupedConvProgramInfoLoader)(y,v,w),v)]:P&&E?[r(y,v,w)]:E&&v[0].dims.length===4&&v[0].dims[0]===1&&!P?[(0,l.conv2DPacked)(y,v,w)]:[d(y,v,w)]},r=(y,v,T)=>{const w=v[0].dims,E=v[1].dims,P=(0,e.calculateOutputShape)(w,E,T.dilations,T.pads,T.strides),R=y.reshapeUnpacked(v[0],[w[1],w[2]*w[3]]),I=y.reshapeUnpacked(v[1],[E[0],E[1]]),N=v.length>2?[I,R,v[2]]:[I,R],B=y.run((0,f.createMatmulProgramInfoLoader)(N,T),N);return y.reshapeUnpacked(B,P)},d=(y,v,T)=>{const w=v[0].dims,E=v[1].dims,P=(0,e.calculateOutputShape)(w,E,T.dilations,T.pads,T.strides),R=y.run((0,h.createIm2ColProgramInfoLoader)(y,v[0],v[1],P,T),[v[0]]),I=v.length===3?[R,v[1],v[2]]:[R,v[1]];return y.run((0,m.createDotProductProgramInfoLoader)(y,v,P,T),I)},p=(y,v)=>{const T=y.kernelShape.slice();if(y.kernelShape.length===0)for(let P=2;P<v[1].dims.length;++P)T.push(v[1].dims[P]);const w=y.pads.slice();o.PoolConvUtil.adjustPadsBasedOnAutoPad(v[0].dims,y.strides,y.dilations,T,w,y.autoPad);const E=Object.assign({},y);return Object.assign(E,{kernelShape:T,pads:w,cacheKey:y.cacheKey}),E};e.parseConvAttributes=y=>{const v=y.attributes,T=(0,g.parseInternalActivationAttributes)(v),w=v.getString("auto_pad","NOTSET"),E=v.getInts("dilations",[1,1]),P=v.getInt("group",1),R=v.getInts("kernel_shape",[]),I=v.getInts("pads",[0,0,0,0]),N=v.getInts("strides",[1,1]);return(0,s.createAttributeWithCacheKey)(Object.assign({autoPad:w,dilations:E,group:P,kernelShape:R,pads:I,strides:N},T))};const _=(y,v)=>{if(!y||y.length!==2&&y.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(y[0].dims.length!==4||y[1].dims.length!==4)throw new Error("currently only support 2-dimensional conv");if(y[0].dims[1]!==y[1].dims[1]*v.group)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(y.length===3&&(y[2].dims.length!==1||y[1].dims[0]!==y[2].dims[0]))throw new Error("invalid bias");const T=y[0].dims.length-2;if(v.dilations.length!==T)throw new Error(`dilations should be ${T}D`);if(v.strides.length!==T)throw new Error(`strides should be ${T}D`);if(v.pads.length!==2*T)throw new Error(`pads should be ${2*T}D`);if(v.kernelShape.length!==0&&v.kernelShape.length!==y[1].dims.length-2)throw new Error("invalid kernel shape");if(y[0].type!=="float32"||y[1].type!=="float32")throw new Error("Conv input(X,W) should be float tensor");if(y.length===3&&y[2].type!=="float32")throw new Error("Conv input(bias) should be float tensor")}},5193:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseDepthToSpaceAttributes=e.depthToSpace=void 0;const s=t(3738);e.depthToSpace=(u,l,m)=>{o(l);const g=m.blocksize,h=g*g,f=m.mode==="DCR"?[0,3,4,1,5,2]:[0,1,4,2,5,3],i=m.mode==="DCR"?[l[0].dims[0],g,g,l[0].dims[1]/h,l[0].dims[2],l[0].dims[3]]:[l[0].dims[0],l[0].dims[1]/h,g,g,l[0].dims[2],l[0].dims[3]],r=u.reshapeUnpacked(l[0],i),d={perm:f,cacheKey:`${f}`},[p]=(0,s.transpose)(u,[r],d),_=[l[0].dims[0],l[0].dims[1]/h,l[0].dims[2]*g,l[0].dims[3]*g];return[u.reshapeUnpacked(p,_)]},e.parseDepthToSpaceAttributes=u=>{const l=u.attributes.getInt("blocksize");if(l<1)throw new Error(`blocksize must be >= 1, but got : ${l} for DepthToSpace`);const m=u.attributes.getString("mode","DCR");if(m!=="DCR"&&m!=="CRD")throw new Error(`unrecognized mode: ${m} for DepthToSpace`);return{mode:m,blocksize:l}};const o=u=>{if(u.length!==1)throw new Error(`DepthToSpace expect 1 inputs, but got ${u.length}`);if(u[0].type==="string"||u[0].dims.length!==4)throw new TypeError("DepthToSpace input should be a 4-D numeric tensor")}},9828:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createDotProductProgramInfoLoader=void 0;const s=t(2517),o=t(5060),u=t(2039),l=t(2823),m=t(3248);e.createDotProductProgramInfoLoader=(g,h,f,i)=>{const r=((d,p)=>({name:"ConvDotProduct",inputNames:d?["Im2Col","K","B"]:["Im2Col","K"],inputTypes:d?[u.TextureType.unpacked,u.TextureType.packedLastDimension,u.TextureType.unpacked]:[u.TextureType.unpacked,u.TextureType.packedLastDimension],cacheKey:p.activationCacheKey}))(h.length>2,i);return Object.assign(Object.assign({},r),{get:()=>((d,p,_,y,v)=>{const T=_[0].dims,w=_[1].dims,E=[w[0],Math.ceil(T[1]*w[2]*w[3]/4)],P=(0,m.calculateIm2ColDims)(T,w,y),[R,I]=d.calculateTextureWidthAndHeight(E,u.TextureType.packedLastDimension),N=s.ShapeUtil.computeStrides(P),[B,D]=d.calculateTextureWidthAndHeight(P,u.TextureType.packedLastDimension),Y=y.length,se=_.length<3?"0.0":"_B(b)",re=Math.ceil(T[1]*w[2]*w[3]/4),{activationFunction:W,applyActivation:$}=(0,l.getActivationSnippet)(v),k=(0,o.getGlsl)(d.session.backend.glContext.version),H=`
${W}
float process(int indices[${Y}]) {
  int b[1];
  b[0] = indices[1];
  int im2col[4];
  im2col[0] = indices[0];
  im2col[1] = indices[2];
  im2col[2] = indices[3];
  int im2colOffset = im2col[0] * ${N[0]} + im2col[1] * ${N[1]} + im2col[2] * ${N[2]};
  int kernelOffset = indices[1] * ${E[1]};
  float value = ${se};
  for (int i = 0; i < ${re}; ++i) {
    vec2 im2colCoords = offsetToCoords(im2colOffset, ${B}, ${D});
    vec2 kernelCoords = offsetToCoords(kernelOffset, ${R}, ${I});
    value += dot(${k.texture2D}(Im2Col, im2colCoords), ${k.texture2D}(K, kernelCoords));
    ++im2colOffset;
    ++kernelOffset;
  }
  ${$}
  return value;
}`;return Object.assign(Object.assign({},p),{output:{dims:y,type:_[0].type,textureType:u.TextureType.unpacked},shaderSource:H})})(g,r,h,f,i)})}},7992:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseFlattenAttributes=e.flatten=void 0;const s=t(2517);e.flatten=(u,l,m)=>{o(l,m);const g=s.ShapeUtil.flattenShape(l[0].dims,m);return[u.reshapeUnpacked(l[0],g)]},e.parseFlattenAttributes=u=>u.attributes.getInt("axis",1);const o=(u,l)=>{if(!u||u.length!==1)throw new Error("Flatten requires 1 input.");const m=u[0].dims.length;if(m===0)throw new Error("scalar tensor is not supported.");if(l<-m||l>m)throw new Error("Invalid axis");if(u[0].type==="string")throw new Error("string tensor is not supported.")}},2823:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseInternalActivationAttributes=e.getActivationSnippet=void 0;const s=t(2517),o=t(4909);e.getActivationSnippet=function(u){let l;switch(u.activation){case"Relu":l=(0,o.glslRelu)();break;case"Sigmoid":l=(0,o.glslSigmoid)();break;case"Clip":l=(0,o.glslClip)(u.clipMin,u.clipMax);break;default:return{activationFunction:"",applyActivation:""}}const m=l.name;return{activationFunction:l.body,applyActivation:`value = ${m}_(value);`}},e.parseInternalActivationAttributes=u=>{const l=u.getString("activation","");if(l==="Clip"){const[m,g]=u.getFloats("activation_params",[s.MIN_CLIP,s.MAX_CLIP]);return{activation:l,clipMax:g,clipMin:m,activationCacheKey:`${l}:${m},${g}`}}return{activation:l,activationCacheKey:l}}},1253:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseGatherAttributes=e.gather=void 0;const s=t(246),o=t(782),u=t(2517),l=t(2039);e.gather=(f,i,r)=>(h(i,r.axis),[f.run(g(f,i,r),i)]),e.parseGatherAttributes=f=>(0,s.createAttributeWithCacheKey)({axis:f.attributes.getInt("axis",0)});const m={name:"Gather",inputNames:["A","B"],inputTypes:[l.TextureType.unpacked,l.TextureType.unpacked]},g=(f,i,r)=>{const d=Object.assign(Object.assign({},m),{cacheHint:r.cacheKey});return Object.assign(Object.assign({},d),{get:()=>((p,_,y,v)=>{const T=y[0].dims.slice(),w=y[1].dims.slice(),E=new Array(T.length+w.length-1);v=u.ShapeUtil.normalizeAxis(v,T.length);const P=[];for(let I=0;I<E.length;I++)I<v?(E[I]=T[I],P.push(`inputIdx[${I}] = outputIdx[${I}];`)):I<v+w.length?(E[I]=w[I-v],P.push(`indexDataIdx[${I-v}] = outputIdx[${I}];`)):(E[I]=T[I-w.length+1],P.push(`inputIdx[${I-w.length+1}] = outputIdx[${I}];`));const R=`
      float process(int outputIdx[${E.length||1}]) {
        int inputIdx[${T.length}];
        int indexDataIdx[${w.length||1}];
        indexDataIdx[0] = 0;
        ${P.join(`
        `)}
        int idx = int(_B(indexDataIdx));
        inputIdx[${v}] = idx < 0 ? idx + ${T[v]} : idx;
        return _A(inputIdx);
      }`;return Object.assign(Object.assign({},_),{output:{dims:E,type:y[0].type,textureType:l.TextureType.unpacked},shaderSource:R})})(0,d,i,r.axis)})},h=(f,i)=>{if(!f||f.length!==2)throw new Error("Gather requires 2 inputs.");const r=f[0].dims.length;if(r<1)throw new Error("Invalid input shape.");if(i<-r||i>r-1)throw new Error("Invalid axis.");if(o.NUMBER_TYPES.indexOf(f[0].type)===-1)throw new Error("Invaid input type.");if(f[1].type!=="int32"&&f[1].type!=="int16")throw new Error("Invaid input type.")}},4776:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseGemmAttributesV11=e.parseGemmAttributesV7=e.gemm=void 0;const s=t(246),o=t(2517),u=t(2039);e.gemm=(f,i,r)=>(h(i,r),[f.run(m(i,r),i)]);const l=(f,i)=>{const r=f.attributes.getInt("transA",0)!==0,d=f.attributes.getInt("transB",0)!==0,p=f.attributes.getFloat("alpha",1),_=f.attributes.getFloat("beta",1);return(0,s.createAttributeWithCacheKey)({transA:r,transB:d,alpha:p,beta:_,isOptionalC:i})};e.parseGemmAttributesV7=f=>l(f,!1),e.parseGemmAttributesV11=f=>l(f,!0);const m=(f,i)=>{const r={name:"Gemm",inputNames:f.length===3?["A","B","C"]:["A","B"],inputTypes:f.length===3?[u.TextureType.unpacked,u.TextureType.unpacked,u.TextureType.unpacked]:[u.TextureType.unpacked,u.TextureType.unpacked],key:i.cacheKey};return Object.assign(Object.assign({},r),{get:()=>g(r,f,i)})},g=(f,i,r)=>{const d=i[0].dims.slice(),p=i[1].dims.slice(),[_,y]=o.GemmUtil.getShapeOfGemmResult(d,r.transA,p,r.transB,i.length===3?i[2].dims:void 0),v=[_,y];if(!v)throw new Error("Can't use gemm on the given tensors");let T=d[d.length-1],w="";r.transA&&(T=d[0]),r.transA&&r.transB?w="value += _A_T(a) * _B_T(b);":r.transA&&!r.transB?w="value += _A_T(a) * _B(b);":!r.transA&&r.transB?w="value += _A(a) * _B_T(b);":r.transA||r.transB||(w="value += _A(a) * _B(b);");const E=v.length,P=`
      float process(int indices[${E}]) {
          int a[${E}];
          int b[${E}];
          ${i.length===3?`int c[${i[2].dims.length}];`:""}

          copyVec(indices, a);
          copyVec(indices, b);
          ${i.length===3?"bcastIndices_C(indices, c);":""}

          float value = 0.0;
          for (int k=0; k<${T}; ++k) {
              a[${E-1}] = k;
              b[${E-2}] = k;
              ${w}
          }

          value = value * alpha;
          ${i.length===3?"value += beta * _C(c);":""}
          return value;
      }`;return Object.assign(Object.assign({},f),{output:{dims:v,type:i[0].type,textureType:u.TextureType.unpacked},variables:[{name:"alpha",type:"float",data:r.alpha},{name:"beta",type:"float",data:r.beta}],shaderSource:P})},h=(f,i)=>{if(!f)throw new Error("Input is missing");if(i.isOptionalC&&(f.length<2||f.length>3))throw new Error("Invaid input shape.");if(!i.isOptionalC&&f.length!==3)throw new Error("Gemm requires 3 inputs");if(f.length===3&&f[2].dims.length!==1&&f[2].dims.length!==2)throw new Error("Invalid input shape of C");if(f[0].type!=="float32"&&f[0].type!=="float64"||f[1].type!=="float32"&&f[1].type!=="float64"||f.length===3&&f[2].type!=="float32"&&f[2].type!=="float64")throw new Error("Invalid input type.");if(f[0].type!==f[1].type||f.length===3&&f[0].type!==f[2].type)throw new Error("Input types are mismatched")}},8555:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createPackedIm2ColProgramInfoLoader=void 0;const s=t(5060),o=t(2039),u=t(2827);e.createPackedIm2ColProgramInfoLoader=(l,m,g,h,f)=>{const i=(r=f.cacheKey,{name:"Im2Col (packed)",inputNames:["A"],inputTypes:[o.TextureType.packed],cacheHint:r});var r;return Object.assign(Object.assign({},i),{get:()=>((d,p,_,y,v,T)=>{const w=_.dims,E=y.dims,P=v.length,R=[E[1]*E[2]*E[3],v[2]*v[3]],I=E[2]*E[3],N=(0,u.unpackFromChannel)(),B=(0,s.getGlsl)(d.session.backend.glContext.version);let D="";for(let se=0;se<=1;se++)for(let re=0;re<=1;re++)D+=`
            blockIndex = rc.x + ${re};
            pos = rc.y + ${se};

            if(blockIndex < ${R[1]} && pos < ${R[0]}) {
              offsetY = int(blockIndex / (${v[P-1]})) * ${T.strides[0]} -
                ${T.pads[0]};
              d0 = offsetY + ${T.dilations[0]} * (imod(pos, ${I}) / ${E[2]});

              if(d0 < ${w[2]} && d0 >= 0) {
                offsetX = imod(blockIndex, ${v[P-1]}) * ${T.strides[1]} -
                  ${T.pads[1]};
                d1 = offsetX + ${T.dilations[1]} * imod(imod(pos, ${I}), ${E[2]});

                if(d1 < ${w[3]} && d1 >= 0) {

                  ch = int(float(pos)/ ${I}.);
                    innerDims = vec2(d0, d1);
                    result[${2*se+re}] = getChannel(
                      getA(0, ch, int(innerDims.x),
                      int(innerDims.y)), innerDims);
                }
              }
            }

          `;const Y=`
      ${N}

      void main() {
        ivec2 rc = getOutputCoords();
          vec4 result = vec4(0.0);
          int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
          vec2 innerDims;
          ${D}
          ${B.output} = result;
      }
            `;return Object.assign(Object.assign({},p),{output:{dims:R,type:_.type,textureType:o.TextureType.packed},shaderSource:Y,hasMain:!0})})(l,i,m,g,h,f)})}},3248:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.calculateIm2ColDims=e.createIm2ColProgramInfoLoader=void 0;const s=t(2039);e.createIm2ColProgramInfoLoader=(o,u,l,m,g)=>{const h=(f=g.cacheKey,{name:"Im2Col",inputNames:["X"],inputTypes:[s.TextureType.unpacked],cacheHint:f});var f;return Object.assign(Object.assign({},h),{get:()=>((i,r,d,p,_,y)=>{const v=d.dims,T=p.dims,w=_.length,E=(0,e.calculateIm2ColDims)(v,T,_,4),P=`
        const int XC = ${v[1]};
        const int XH = ${v[2]};
        const int XW = ${v[3]};
        const int KH = ${y.kernelShape[0]};
        const int KW = ${y.kernelShape[1]};
        const int dilationH = ${y.dilations[0]};
        const int dilationW = ${y.dilations[1]};
        const int strideH = ${y.strides[0]};
        const int strideW = ${y.strides[1]};
        const int padH = ${y.pads[0]};
        const int padW = ${y.pads[1]};
        const int KHKW = KH*KW;
        const int XCKHKW = XC * KHKW;
        const int outputChannels = 4;
        vec4 process(int indices[${w}]) {
          int b  = indices[0]; // batch size
          int oh = indices[1] * strideH - padH; //output height
          int ow = indices[2] * strideW - padW; //output width
          int p = indices[3] * outputChannels; //patch
          vec4 value = vec4(0.0);
          for(int i=0; i < outputChannels; ++i) {
            if(p < XCKHKW) {
              int patchC = p / KHKW;
              int patchH = (p - patchC*KHKW) / KW;
              int patchW = (p - patchC*KHKW) - patchH * KW;
              int xh2 = oh + patchH * dilationH;
              int xw2 = ow + patchW * dilationW;
              int x[${v.length}];
              x[0] = b;
              x[1] = patchC;
              x[2] = xh2;
              x[3] = xw2;
              if(xh2 >= 0 &&
                  xh2 < XH &&
                  xw2 >= 0 &&
                  xw2 < XW) {
                value[i] = _X(x);
              }
            }
            ++p;
          }
          return value;
        }
        `;return Object.assign(Object.assign({},r),{output:{dims:E,type:d.type,textureType:s.TextureType.packedLastDimension},shaderSource:P})})(0,h,u,l,m,g)})},e.calculateIm2ColDims=(o,u,l,m=4)=>[l[0],l[2],l[3],Math.ceil(o[1]*u[2]*u[3]/m)]},6572:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseImageScalerAttributes=e.imageScaler=void 0;const s=t(246),o=t(2039);e.imageScaler=(h,f,i)=>(g(f),[h.run(l(h,f,i),f)]),e.parseImageScalerAttributes=h=>{const f=h.attributes.getFloat("scale"),i=h.attributes.getFloats("bias");return(0,s.createAttributeWithCacheKey)({scale:f,bias:i})};const u={name:"ImageScaler",inputNames:["X"],inputTypes:[o.TextureType.unpacked]},l=(h,f,i)=>{const r=Object.assign(Object.assign({},u),{cacheHint:i.cacheKey});return Object.assign(Object.assign({},r),{get:()=>((d,p,_,y)=>{const v=_[0].dims.slice(),T=v.length,w=`
      ${m(y.bias.length)}
      float process(int indices[${T}]) {
        return _X(indices) * scale + getBias(bias, indices[1]);
      }`;return Object.assign(Object.assign({},p),{output:{dims:v,type:_[0].type,textureType:o.TextureType.unpacked},variables:[{name:"bias",type:"float",arrayLength:y.bias.length,data:y.bias},{name:"scale",type:"float",data:y.scale}],shaderSource:w})})(0,r,f,i)})},m=h=>{const f=[`float getBias(float bias[${h}], int channel) {`];for(let i=0;i<h;++i)i===0?f.push(`	if (channel == ${i}) { return bias[${i}]; }`):i===h-1?f.push(`	else { return bias[${i}]; }`):f.push(`	else if (channel == ${i}) { return bias[${i}]; }`);return f.push("	}"),f.join(`
`)},g=h=>{if(!h||h.length!==1)throw new Error("ImageScaler requires 1 input.");if(h[0].dims.length!==4)throw new Error("Invalid input shape.");if(h[0].type!=="float32"&&h[0].type!=="float64")throw new Error("Invalid input type.")}},3346:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseInstanceNormalizationAttributes=e.instanceNormalization=void 0;const s=t(5060),o=t(2039);e.instanceNormalization=(f,i,r)=>{h(i);const d=f.run(l(i[0]),i);return[f.run(g(f,i[0],r,d.dims),[i[0],d,i[1],i[2]])]},e.parseInstanceNormalizationAttributes=f=>f.attributes.getFloat("epsilon",1e-5);const u={name:"InstanceNormalization_MeanAndVariance",inputNames:["X"],inputTypes:[o.TextureType.unpacked]},l=f=>Object.assign(Object.assign({},u),{get:()=>((i,r)=>{const d=r.dims.slice(),p=d[1],_=d[2]*d[3],y=[d[0],p],v=`
      vec4 process(int[2] indices) {
        vec4 v = vec4(0.0);
        int a[4];
        a[0] = indices[0];
        a[1] = indices[1];
        float temp = 0.0;
        for(int a2=0; a2<${d[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${d[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += x;
          }
        }
        float mean = temp / float(${_});
        temp = 0.0;
        for(int a2=0; a2<${d[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${d[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += (x - mean) * (x - mean);
          }
        }
        v.r = mean;
        v.g = temp / float(${_});

        return v;
      }`;return Object.assign(Object.assign({},i),{output:{dims:y,type:r.type,textureType:o.TextureType.packedLastDimension},shaderSource:v})})(u,f)}),m={name:"InstanceNormalization_ComputeOutput",inputNames:["X","MeanAndVariance","Scale","B"],inputTypes:[o.TextureType.unpacked,o.TextureType.packedLastDimension,o.TextureType.unpacked,o.TextureType.unpacked]},g=(f,i,r,d)=>{const p=Object.assign(Object.assign({},m),{cacheHint:`${r}`});return Object.assign(Object.assign({},p),{get:()=>((_,y,v,T,w)=>{const E=(0,s.getGlsl)(_.session.backend.glContext.version),[P,R]=_.calculateTextureWidthAndHeight(w,o.TextureType.packedLastDimension),[I,N]=[P/4,R],B=`
      vec4 get_MeanAndVariance(int[2] mv) {
        int offset = indicesToOffset_MeanAndVariance(mv);
        vec2 coords = offsetToCoords(offset, ${I}, ${N});
        return ${E.texture2D}(MeanAndVariance, coords);
      }

      float process(int[4] indices) {
        int mv[2];
        mv[0] = indices[0];
        mv[1] = indices[1];
        vec4 mean_and_variance = get_MeanAndVariance(mv);
        float mean = mean_and_variance.r;
        float variance = mean_and_variance.g;

        int sb[1];
        sb[0] = indices[1];
        float scale = _Scale(sb);
        float b = _B(sb);

        return scale * (_X(indices) - mean) / sqrt(variance + epsilon) + b;
      }`;return Object.assign(Object.assign({},y),{output:{dims:v.dims,type:v.type,textureType:o.TextureType.unpacked},variables:[{name:"epsilon",type:"float",data:T}],shaderSource:B})})(f,p,i,r,d)})},h=f=>{if(!f||f.length!==3)throw new Error("InstanceNormalization requires 3 inputs.");const i=f[0],r=f[1],d=f[2];if(i.dims.length<3||r.dims.length!==1||d.dims.length!==1)throw new Error("Invalid input shape.");if(r.dims[0]!==i.dims[1]||d.dims[0]!==i.dims[1])throw new Error("Input shapes are mismatched.");if(i.type!=="float32"&&i.type!=="float64"||r.type!=="float32"&&r.type!=="float64"||d.type!=="float32"&&d.type!=="float64")throw new Error("Invalid input type.");if(f[0].dims.length!==4)throw new Error("Only support 4-D input shape.")}},708:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createPackedMatmulProgramInfoLoader=void 0;const s=t(2517),o=t(5060),u=t(2039),l=t(9390),m=t(2823),g=t(5623);e.createPackedMatmulProgramInfoLoader=(h,f,i)=>{const r=(d=f.length>2,p=i.activationCacheKey,{name:"MatMul (packed)",inputNames:d?["A","B","Bias"]:["A","B"],inputTypes:d?[u.TextureType.packed,u.TextureType.packed,u.TextureType.packed]:[u.TextureType.packed,u.TextureType.packed],cacheHint:p});var d,p;return Object.assign(Object.assign({},r),{get:()=>((_,y,v,T)=>{const w=v.length>2,E=w?"value += getBiasForMatmul();":"",P=v[0].dims,R=v[1].dims,I=s.BroadcastUtil.calcShape(P,R,!0),N=!s.ShapeUtil.areEqual(v[0].dims,v[1].dims);if(!I)throw new Error("Can't use matmul on the given tensors");const B=P[P.length-1],D=Math.ceil(B/2),Y=P.length,se=R.length,re=(0,o.getGlsl)(_.session.backend.glContext.version),W=(0,l.getCoordsDataType)(I.length),$=I.length,k=(0,l.getGlChannels)(),{activationFunction:H,applyActivation:de}=(0,m.getActivationSnippet)(T),ee=w?`${(0,g.getBiasForMatmul)(W,k,v[2].dims,I,!0)}`:"",ce=N?`${(function(xe,Ee,we,U){let L=[],M=[];const C=we[0].dims,V=we[1].dims,O=C.length,z=V.length,j=U.length,J=j-O,X=j-z;L=C.map(((te,ue)=>`coords.${Ee[ue+J]}`)),L[O-1]="i*2",L.join(", "),M=V.map(((te,ue)=>`coords.${Ee[ue+X]}`)),M[z-2]="i*2",M.join(", ");const ne=s.BroadcastUtil.getBroadcastDims(C,U),ie=s.BroadcastUtil.getBroadcastDims(V,U),fe=ne.map((te=>`coords.${Ee[te+J]} = 0;`)).join(`
`),ye=ie.map((te=>`coords.${Ee[te+X]} = 0;`)).join(`
`),pe=`int lastDim = coords.${Ee[j-1]};
  coords.${Ee[j-1]} = coords.${Ee[j-2]};
  coords.${Ee[j-2]} = lastDim;`;return`
vec4 getAAtOutCoordsMatmul(int i) {
  ${xe} coords = getOutputCoords();
  ${pe}
  ${fe}
  vec4 outputValue = getA(${L});
  return outputValue;
}

vec4 getBAtOutCoordsMatmul(int i) {
  ${xe} coords = getOutputCoords();
  ${pe}
  ${ye}
  vec4 outputValue = getB(${M});
  return outputValue;
}`})(W,k,v,I)}`:"",q=N?"getAAtOutCoordsMatmul(i)":`getA(${(function(xe,Ee){let we="";for(let U=0;U<Ee-2;U++)we+=`rc.${xe[U]}, `;return we+=`rc.${xe[Ee-2]}, i*2`,we})(k,Y)})`,le=N?"getBAtOutCoordsMatmul(i)":`getB(${(function(xe,Ee){let we="";for(let U=0;U<Ee-2;U++)we+=`rc.${xe[U]}, `;return we+=`i*2, rc.${xe[Ee-1]}`,we})(k,se)})`,be=`
            ${ce}
            ${ee}
            ${H}
            void main() {
              ${N?"":`${W} rc =
          getOutputCoords(); int lastDim = rc.${k[$-1]}; rc.${k[$-1]} =
          rc.${k[$-2]}; rc.${k[$-2]} = lastDim;
      `}

              vec4 value = vec4(0);
              for (int i = 0; i < ${D}; i++) {
                vec4 a = ${q};
                vec4 b = ${le};

                value += (a.rrbb * b.rgrg);
                value += (a.ggaa * b.baba);
              }
              ${E}
              ${de}
              ${re.output} = value;
            }`;return Object.assign(Object.assign({},y),{output:{dims:I,type:v[0].type,textureType:u.TextureType.packed},shaderSource:be,hasMain:!0})})(h,r,f,i)})}},5623:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getBiasForMatmul=e.createMatmulProgramInfoLoader=e.parseMatMulAttributes=e.matMul=void 0;const s=t(2517),o=t(2039),u=t(9390),l=t(2823),m=t(708);function g(i,r){const d=(p=i.length>2,_=r.activationCacheKey,{name:"MatMul",inputNames:p?["A","B","Bias"]:["A","B"],inputTypes:p?[o.TextureType.unpacked,o.TextureType.unpacked,o.TextureType.unpacked]:[o.TextureType.unpacked,o.TextureType.unpacked],cacheHint:_});var p,_;return Object.assign(Object.assign({},d),{get:()=>(function(y,v,T){const w=v[0].dims,E=v[1].dims,P=s.BroadcastUtil.calcShape(w,E,!0);if(!P)throw new Error("Can't use matmul on the given tensors");const R=(0,u.getCoordsDataType)(P.length),I=(0,u.getGlChannels)(),{activationFunction:N,applyActivation:B}=(0,l.getActivationSnippet)(T),D=v.length>2,Y=D?"value += getBiasForMatmul();":"",se=D?`${f(R,I,v[2].dims,P,!1)}`:"",re=P.length,W=w.length,$=E.length,k=`
    ${N}
    ${se}
    float process(int indices[${re}]) {
        int a[${W}];
        int b[${$}];
        bcastMatmulIndices_A(indices, a);
        bcastMatmulIndices_B(indices, b);

        float value;
        for (int k=0; k<${w[w.length-1]}; ++k) {
            a[${W-1}] = k;
            b[${$-2}] = k;
            value += _A(a) * _B(b);
        }
        ${Y}
        ${B}
        return value;
    }`;return Object.assign(Object.assign({},y),{output:{dims:P,type:v[0].type,textureType:o.TextureType.unpacked},shaderSource:k})})(d,i,r)})}e.matMul=(i,r,d)=>(h(r),i.session.pack?[i.run((0,m.createPackedMatmulProgramInfoLoader)(i,r,d),r)]:[i.run(g(r,d),r)]),e.parseMatMulAttributes=i=>(0,l.parseInternalActivationAttributes)(i.attributes),e.createMatmulProgramInfoLoader=g;const h=i=>{if(!i||i.length!==2)throw new Error("MatMul requires 2 inputs.");if(i[0].dims[i[0].dims.length-1]!==i[1].dims[i[1].dims.length-2])throw new Error("shared dimension does not match.");if(i[0].type!=="float32"&&i[0].type!=="float64"||i[1].type!=="float32"&&i[1].type!=="float64")throw new Error("inputs should be float type");if(i[0].type!==i[1].type)throw new Error("inputs types should match")};function f(i,r,d,p,_){let y="";const v=d.length,T=p.length,w=T-v;y=T<2&&v>0?"coords":d.map(((R,I)=>`coords.${r[I+w]}`)).join(", ");const E=s.BroadcastUtil.getBroadcastDims(d,p).map((R=>`coords.${r[R+w]} = 0;`)).join(`
`);let P="vec4(outputValue.xx, outputValue.yy)";return s.ShapeUtil.size(d)===1&&(P="vec4(outputValue.x)"),_?`
vec4 getBiasForMatmul() {
  ${i} coords = getOutputCoords();
  ${E}
  vec4 outputValue = getBias(${y});
  return ${P};
}`:`
float getBiasForMatmul() {
  ${i} coords = getOutputCoords();
  ${E}
  return getBias(coords.x);
}`}e.getBiasForMatmul=f},2403:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createPackProgramInfoLoader=void 0;const s=t(5060),o=t(2039),u=t(9390),l=t(2827),m={name:"pack",inputNames:["A"],inputTypes:[o.TextureType.unpackedReversed]};e.createPackProgramInfoLoader=(g,h)=>Object.assign(Object.assign({},m),{get:()=>((f,i)=>{const r=(0,s.getGlsl)(f.session.backend.glContext.version),d=i.dims,p=d.length,_=i.dims.length,y=(0,u.getCoordsDataType)(_),v=(0,l.getChannels)("rc",_),T=(w=_,E=v,P=d[d.length-2],R=d[d.length-1],w===0||w===1?"":`
    int r = ${E[w-2]};
    int c = ${E[w-1]};
    int rp1 = ${E[w-2]} + 1;
    int cp1 = ${E[w-1]} + 1;
    bool rEdge = rp1 >= ${R};
    bool cEdge = cp1 >= ${P};
    `);var w,E,P,R;let I;I=p===0?[1,1]:p===1?[d[0],1]:[d[_-1],d[_-2]];const N=(function(Y,se,re){if(Y===0)return"false";if(Y===1)return`rc > ${se[0]}`;let W="";for(let $=Y-2;$<Y;$++)W+=`${re[$]} >= ${se[$-Y+2]}`,$<Y-1&&(W+="||");return W})(_,I,v),B=(function(Y,se){const re=Y.length;if(re===0)return"getA(), 0, 0, 0";if(re===1)return`getA(rc),
            rc + 1 >= ${Y[0]} ? 0. : getA(rc + 1),
            0, 0`;let W="";if(re>2)for(let $=0;$<re-2;++$)W+=`${se[$]},`;return`getA(${W}r, c),
          rEdge ? 0. : getA(${W}rp1, c),
          cEdge ? 0. : getA(${W}r, cp1),
          rEdge || cEdge ? 0. : getA(${W}rp1, cp1)`})(d,v),D=`
        void main() {
          ${y} rc = getOutputCoords();

          if(${N}) {
            ${r.output} = vec4(0);
          } else {
            ${T}

            ${r.output} = vec4(${B});
          }
        }
      `;return Object.assign(Object.assign({},m),{hasMain:!0,output:{dims:i.dims,type:i.type,textureType:o.TextureType.packed},shaderSource:D})})(g,h)})},2827:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.unpackFromChannel=e.getChannels=e.getVecChannels=void 0;const s=t(9390);function o(u,l){return(0,s.getGlChannels)(l).map((m=>`${u}.${m}`))}e.getVecChannels=o,e.getChannels=function(u,l){return l===1?[u]:o(u,l)},e.unpackFromChannel=function(){return`
    float getChannel(vec4 frag, int dim) {
      int modCoord = imod(dim, 2);
      return modCoord == 0 ? frag.r : frag.g;
    }

    float getChannel(vec4 frag, vec2 innerDims) {
      vec2 modCoord = mod(innerDims, 2.);
      return modCoord.x == 0. ?
        (modCoord.y == 0. ? frag.r : frag.g) :
        (modCoord.y == 0. ? frag.b : frag.a);
    }
  `}},2870:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parsePadAttributesV11=e.padV11=e.parsePadAttributesV2=e.padV2=void 0;const s=t(246),o=t(2517),u=t(5060),l=t(2039),m={name:"Pad",inputNames:["A"],inputTypes:[l.TextureType.unpacked]};e.padV2=(y,v,T)=>(f(v),[y.run(Object.assign(Object.assign({},m),{cacheHint:T.cacheKey,get:()=>h(y,v[0],T)}),v)]),e.parsePadAttributesV2=y=>{const v=y.attributes.getString("mode","constant"),T=y.attributes.getFloat("value",0),w=y.attributes.getInts("pads");return(0,s.createAttributeWithCacheKey)({mode:v,value:T,pads:w})},e.padV11=(y,v,T)=>{i(v);const w=g(y,v,T);return(0,e.padV2)(y,[v[0]],w)},e.parsePadAttributesV11=y=>y.attributes.getString("mode","constant");const g=(y,v,T)=>{if(!y.session.isInitializer(v[1].dataId)||v.length>=3&&!y.session.isInitializer(v[2].dataId))throw new Error("dynamic pad attributes are not allowed");const w=Array.from(v[1].integerData),E=v.length>=3?v[2].floatData[0]:0;return(0,s.createAttributeWithCacheKey)({mode:T,pads:w,value:E})},h=(y,v,T)=>{const w=o.ShapeUtil.padShape(v.dims.slice(),T.pads),E=w.length,P=`
      ${r(y,v,T)}
      float process(int[${E}] indices) {
          return padA(indices);
      }`;return{name:"Pad",inputNames:["A"],inputTypes:[l.TextureType.unpacked],output:{dims:w,type:v.type,textureType:l.TextureType.unpacked},shaderSource:P}},f=y=>{if(!y||y.length!==1)throw new Error("Pad requires 1 input");if(y[0].type!=="float32"&&y[0].type!=="float64")throw new Error("Invalid input type.")},i=y=>{if(!y||y.length!==2&&y.length!==3)throw new Error("Pad requires 2 or 3 inputs");if(y[1].type!=="int32")throw new Error("Invalid input type.");if(y.length>=3&&y[2].type==="string")throw new Error("Invalid input type.")},r=(y,v,T)=>{const w=(0,u.getGlsl)(y.session.backend.glContext.version),[E,P]=y.calculateTextureWidthAndHeight(v.dims,l.TextureType.unpacked),R=o.ShapeUtil.computeStrides(v.dims);switch(T.mode){case"constant":return d(w,v.dims,R,E,P,T.pads,T.value);case"reflect":return p(w,v.dims,R,E,P,T.pads);case"edge":return _(w,v.dims,R,E,P,T.pads);default:throw new Error("Invalid mode")}},d=(y,v,T,w,E,P,R)=>{const I=v.length;let N="";for(let B=I-1;B>=0;--B)N+=`
        k = m[${B}] - ${P[B]};
        if (k < 0)  return constant;
        if (k >= ${v[B]}) return constant;
        offset += k * ${T[B]};
        `;return`
      float padA(int m[${I}]) {
        const float constant = float(${R});
        int offset = 0;
        int k = 0;
        ${N}
        vec2 coords = offsetToCoords(offset, ${w}, ${E});
        float value = getColorAsFloat(${y.texture2D}(A, coords));
        return value;
      }
      `},p=(y,v,T,w,E,P)=>{const R=v.length;let I="";for(let N=R-1;N>=0;--N)I+=`
        k = m[${N}] - ${P[N]};
        if (k < 0) { k = -k; }
        {
          const int _2n_1 = ${2*(v[N]-1)};
          k = int( mod( float(k), float(_2n_1) ) ) ;
          if(k >= ${v[N]}) { k = _2n_1 - k; }
        }
        offset += k * ${T[N]};
        `;return`
      float padA(int m[${R}]) {
        int offset = 0;
        int k = 0;
        ${I}
        vec2 coords = offsetToCoords(offset, ${w}, ${E});
        float value = getColorAsFloat(${y.texture2D}(A, coords));
        return value;
      }
      `},_=(y,v,T,w,E,P)=>{const R=v.length;let I="";for(let N=R-1;N>=0;--N)I+=`
        k = m[${N}] - ${P[N]};
        if (k < 0)  k = 0;
        if (k >= ${v[N]}) k = ${v[N]-1};
        offset += k * ${T[N]};
      `;return`
      float padA(int m[${R}]) {
        int offset = 0;
        int k = 0;
        ${I}
        vec2 coords = offsetToCoords(offset, ${w}, ${E});
        float value = getColorAsFloat(${y.texture2D}(A, coords));
        return value;
      }
      `}},2143:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.globalMaxPool=e.parseMaxPoolAttributes=e.maxPool=e.parseGlobalAveragePoolAttributes=e.globalAveragePool=e.parseAveragePoolAttributes=e.averagePool=void 0;const s=t(246),o=t(2517),u=t(2039);e.averagePool=(_,y,v)=>{i(y);const T={name:"AveragePool",inputNames:["X"],inputTypes:[u.TextureType.unpacked],cacheHint:v.cacheKey};return[_.run(Object.assign(Object.assign({},T),{get:()=>l(y,T,!1,v)}),y)]},e.parseAveragePoolAttributes=_=>{const y=_.attributes.getString("auto_pad","NOTSET"),v=_.attributes.getInt("ceil_mode",0),T=_.attributes.getInt("count_include_pad",0)!==0,w=_.attributes.getInts("kernel_shape"),E=_.attributes.getInts("strides",[]),P=_.attributes.getInts("pads",[]);if(v!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");return(0,s.createAttributeWithCacheKey)({autoPad:y,ceilMode:v,countIncludePad:T,kernelShape:w,strides:E,pads:P})};const l=(_,y,v,T)=>{const[w,E]=g(_,T,v),P=o.ShapeUtil.size(w.kernelShape);let R="";w.countIncludePad?R+=`value /= float(${P});`:R+=`value /= float(${P} - pad);`;const I=`
        ${r(_[0].dims,w,"value += _X(x);",R,"0.0")}
      `;return Object.assign(Object.assign({},y),{output:{dims:E,type:_[0].type,textureType:u.TextureType.unpacked},shaderSource:I})};e.globalAveragePool=(_,y,v)=>{i(y);const T={name:"GlobalAveragePool",inputNames:["X"],inputTypes:[u.TextureType.unpacked],cacheHint:`${v.countIncludePad}`};return[_.run(Object.assign(Object.assign({},T),{get:()=>l(y,T,!0,v)}),y)]},e.parseGlobalAveragePoolAttributes=_=>{const y=_.attributes.getInt("count_include_pad",0)!==0;return(0,s.createAttributeWithCacheKey)({autoPad:"",ceilMode:0,countIncludePad:y,kernelShape:[],strides:[],pads:[]})},e.maxPool=(_,y,v)=>{i(y);const T={name:"MaxPool",inputNames:["X"],inputTypes:[u.TextureType.unpacked],cacheHint:v.cacheKey};return[_.run(Object.assign(Object.assign({},T),{get:()=>m(y,T,!1,v)}),y)]},e.parseMaxPoolAttributes=_=>{const y=_.attributes.getString("auto_pad","NOTSET"),v=_.attributes.getInt("ceil_mode",0),T=_.attributes.getInts("kernel_shape"),w=_.attributes.getInts("strides",[]),E=_.attributes.getInts("pads",[]),P=_.attributes.getInt("storage_order",0),R=_.attributes.getInts("dilations",[]);if(P!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(v!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");return(0,s.createAttributeWithCacheKey)({autoPad:y,ceilMode:v,countIncludePad:!1,kernelShape:T,strides:w,pads:E,storageOrder:P,dilations:R})};const m=(_,y,v,T)=>{const[w,E]=g(_,T,v),P=`
      ${r(_[0].dims,w,`
      value = max(_X(x), value);
    `,"","-1e5")}
    `;return Object.assign(Object.assign({},y),{output:{dims:E,type:_[0].type,textureType:u.TextureType.unpacked},shaderSource:P})},g=(_,y,v)=>{const T=_[0].dims.slice(),w=Object.hasOwnProperty.call(y,"dilations"),E=y.kernelShape.slice(),P=y.strides.slice(),R=w?y.dilations.slice():[],I=y.pads.slice();o.PoolConvUtil.adjustPoolAttributes(v,T,E,P,R,I);const N=o.PoolConvUtil.computePoolOutputShape(v,T,P,R,E,I,y.autoPad),B=Object.assign({},y);return w?Object.assign(B,{kernelShape:E,strides:P,pads:I,dilations:R,cacheKey:y.cacheKey}):Object.assign(B,{kernelShape:E,strides:P,pads:I,cacheKey:y.cacheKey}),[B,N]},h={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[],cacheKey:""},f={name:"GlobalMaxPool",inputNames:["X"],inputTypes:[u.TextureType.unpacked]};e.globalMaxPool=(_,y)=>(i(y),[_.run(Object.assign(Object.assign({},f),{get:()=>m(y,f,!0,h)}),y)]);const i=_=>{if(!_||_.length!==1)throw new Error("Pool ops requires 1 input.");if(_[0].type!=="float32"&&_[0].type!=="float64")throw new Error("Invalid input type.")},r=(_,y,v,T,w)=>{const E=_.length;if(y.kernelShape.length<=2){const P=y.kernelShape[y.kernelShape.length-1],R=y.strides[y.strides.length-1],I=y.pads[y.pads.length/2-1],N=y.pads[y.pads.length-1],B=_[E-1];let D="",Y="",se="";if(D=I+N!==0?`
          for (int i = 0; i < ${P}; i++) {
            x[${E} - 1] = indices[${E} - 1] * ${R} - ${I} + i;
            if (x[${E} - 1] < 0 || x[${E} - 1] >= ${B}) {
              pad++;
              continue;
            }
            ${v}
          }`:`
          for (int i = 0; i < ${P}; i++) {
            x[${E} - 1] = indices[${E} - 1] * ${R} - ${I} + i;
            ${v}
          }`,y.kernelShape.length===2){const re=y.kernelShape[y.kernelShape.length-2],W=y.strides[y.strides.length-2],$=y.pads[y.pads.length/2-2],k=y.pads[y.pads.length-2],H=_[E-2];Y=$+k!==0?`
            for (int j = 0; j < ${re}; j++) {
              x[${E} - 2] = indices[${E} - 2] * ${W} - ${$} + j;
              if (x[${E} - 2] < 0 || x[${E} - 2] >= ${H}) {
                pad+= ${P};
                continue;
              }
          `:`
            for (int j = 0; j < ${re}; j++) {
              x[${E} - 2] = indices[${E} - 2] * ${W} - ${$} + j;
            `,se=`
          }
        `}return`
        float process(int indices[${E}]) {
          int x[${E}];
          copyVec(indices, x);

          float value = ${w};
          int pad = 0;
          ${Y}
          ${D}
          ${se}
          ${T}
          return value;
        }
      `}{const P=o.ShapeUtil.size(y.kernelShape),R=o.ShapeUtil.computeStrides(y.kernelShape),I=R.length,N=y.pads.length,B=p(I),D=d(_,"inputDims"),Y=d(y.pads,"pads"),se=d(R,"kernelStrides"),re=d(y.strides,"strides");let W="";return W=y.pads.reduce((($,k)=>$+k))?`
            if (x[j] >= inputDims[j] || x[j] < 0) {
              pad++;
              isPad = true;
              break;
            }
          }
          if (!isPad) {
            ${v}
          }`:`
          }
          ${v}
        `,`
        ${B}
        float process(int indices[${E}]) {
          int x[${E}];
          copyVec(indices, x);
          int offset[${I}];
          int pads[${N}];
          int inputDims[${E}];
          int kernelStrides[${I}];
          int strides[${I}];
          ${Y}
          ${D}
          ${re}
          ${se}

          float value = ${w};
          int pad = 0;
          bool isPad = false;
          for (int i = 0; i < ${P}; i++) {
            offsetToIndices(i, kernelStrides, offset);
            isPad = false;
            for (int j = ${E} - ${I}; j < ${E}; j++) {
              x[j] = indices[j] * strides[j - ${E} + ${I}]
                + offset[j - ${E} + ${I}] - pads[j - 2];
              ${W}
          }
          ${T}

          return value;
        }
      `}},d=(_,y)=>{let v="";for(let T=0;T<_.length;T++)v+=`
      ${y}[${T}] = ${_[T]};
    `;return v},p=_=>`
  void offsetToIndices(int offset, int[${_}] strides, out int[${_}] indices) {
    if (${_} == 0) {
      return;
    }
    for (int i = 0; i < ${_} - 1; ++i) {
      indices[i] = offset / strides[i];
      offset -= indices[i] * strides[i];
    }
    indices[${_} - 1] = offset;
  }`},4939:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.reduceLogSumSquare=e.reduceLogSum=e.reduceProd=e.reduceMin=e.reduceMax=e.reduceMean=e.reduceSum=e.parseReduceAttributes=void 0;const s=t(246),o=t(782),u=t(2517),l=t(2039),m=(f,i,r,d,p)=>{h(i);const _={name:d,inputNames:["A"],inputTypes:[l.TextureType.unpacked]};return[f.run(Object.assign(Object.assign({},_),{cacheHint:r.cacheKey,get:()=>g(f,i,r,d,p,_)}),i)]};e.parseReduceAttributes=f=>{const i=f.attributes.getInts("axes",[]),r=f.attributes.getInt("keepdims",1)===1;return(0,s.createAttributeWithCacheKey)({axes:i,keepDims:r})};const g=(f,i,r,d,p,_)=>{const y=[],v=i[0].dims.length||1,T=[],w=u.ShapeUtil.normalizeAxes(r.axes,i[0].dims.length),E=p(i,w);let P=E[1];for(let I=0;I<i[0].dims.length;I++)w.indexOf(I)>=0||w.length===0?(r.keepDims&&y.push(1),P=`
          for(int j${I} = 0; j${I} < ${i[0].dims[I]}; j${I}++) {
            inputIdx[${I}] = j${I};
            ${P}
          }`):(T.push(`inputIdx[${I}] = outputIdx[${y.length}];`),y.push(i[0].dims[I]));const R=`
      float process(int outputIdx[${y.length||1}]) {
        float value;                 // final result
        int inputIdx[${v}];      // addressing input data
        ${T.join(`
`)}
        ${E[0]}       // init ops for reduce max/min
        ${P}
        ${E[2]}       // final computation for reduce mean
        return value;
      }`;return Object.assign(Object.assign({},_),{output:{dims:y,type:i[0].type,textureType:l.TextureType.unpacked},shaderSource:R})},h=f=>{if(!f||f.length!==1)throw new Error("Reduce op requires 1 input.");if(o.NUMBER_TYPES.indexOf(f[0].type)===-1)throw new Error("Invalid input type.")};e.reduceSum=(f,i,r)=>m(f,i,r,"ReduceSum",(()=>["value = 0.0;","value += _A(inputIdx);",""])),e.reduceMean=(f,i,r)=>m(f,i,r,"ReduceMean",((d,p)=>{let _=1;for(let y=0;y<d[0].dims.length;y++)(p.indexOf(y)>=0||p.length===0)&&(_*=d[0].dims[y]);return["value = 0.0;","value += _A(inputIdx);",`value /= ${_}.;`]})),e.reduceMax=(f,i,r)=>m(f,i,r,"ReduceMax",((d,p)=>{const _=[];for(let y=0;y<d[0].dims.length;y++)(p.indexOf(y)>=0||p.length===0)&&_.push(`inputIdx[${y}] = 0;`);return[`${_.join(`
`)}
value = _A(inputIdx);`,"value = max(value, _A(inputIdx));",""]})),e.reduceMin=(f,i,r)=>m(f,i,r,"ReduceMin",((d,p)=>{const _=[];for(let y=0;y<d[0].dims.length;y++)(p.indexOf(y)>=0||p.length===0)&&_.push(`inputIdx[${y}] = 0;`);return[`${_.join(`
`)}
value = _A(inputIdx);`,"value = min(value, _A(inputIdx));",""]})),e.reduceProd=(f,i,r)=>m(f,i,r,"ReduceProd",(()=>["value = 1.0;","value *= _A(inputIdx);",""])),e.reduceLogSum=(f,i,r)=>m(f,i,r,"ReduceLogSum",(()=>["value = 0.0;","value += _A(inputIdx);","value = log(value);"])),e.reduceLogSumSquare=(f,i,r)=>m(f,i,r,"ReduceLogSumSquare",(()=>["float t; value = 0.0;","t = _A(inputIdx); value += t * t;",""]))},7019:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isReshapeCheap=e.processDims3D=e.createPackedReshape3DProgramInfoLoader=void 0;const s=t(2517),o=t(5060),u=t(2039),l=t(2827);e.createPackedReshape3DProgramInfoLoader=(m,g,h)=>{const f=(i=>({name:"Reshape (packed)",inputTypes:[u.TextureType.packed],inputNames:["A"],cacheHint:`${i}`}))(h);return Object.assign(Object.assign({},f),{get:()=>((i,r,d,p)=>{const _=r.dims,y=p;let v="";for(let E=0;E<4;E++){let P="";switch(E){case 0:P="outputCoords = rc;";break;case 1:P="outputCoords = ivec3(rc.x, rc.y+1, rc.z);";break;case 2:P="outputCoords = ivec3(rc.x, rc.y, rc.z+1);";break;case 3:P="outputCoords = ivec3(rc.x, rc.y+1, rc.z+1);";break;default:throw new Error}v+=`
        ${P}
        ${E>0?"if(outputCoords.y < rows && outputCoords.z < cols){":""}
          int flattenedIndex = getFlattenedIndex(outputCoords);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flattenedIndex);
          vec2 innerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${E}] = getChannel(getA(inputRC.x, inputRC.y, inputRC.z), innerDims);

        ${E>0?"}":""}
      `}const T=(0,o.getGlsl)(i.session.backend.glContext.version),w=`
      ${(function(E){const P=s.ShapeUtil.computeStrides(E),R=["b","r","c"],I="index";return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${P.map(((N,B)=>`int ${R[B]} = ${I} / ${N}; ${B===P.length-1?`int ${R[B+1]} = ${I} - ${R[B]} * ${N}`:`index -= ${R[B]} * ${N}`};`)).join("")}
      return ivec3(b, r, c);
    }
  `})(_)}
      ${(function(E){const P=s.ShapeUtil.computeStrides(E);return`
  int getFlattenedIndex(ivec3 coords) {
    // reverse y, z order
    return coords.x * ${P[0]} + coords.z * ${P[1]} + coords.y;
  }
`})(y)}
      ${(0,l.unpackFromChannel)()}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.0);

        ivec3 outputCoords;
        int rows = ${y[2]};
        int cols = ${y[1]};

        ${v}
        ${T.output} = result;
      }
    `;return Object.assign(Object.assign({},d),{output:{dims:y,type:r.type,textureType:u.TextureType.packed},shaderSource:w,hasMain:!0})})(m,g,f,h)})},e.processDims3D=function(m){if(m.length===0)return[1,1,1];let g=1;for(let h=0;h<m.length-2;++h)g*=m[h];return[g,m.length>1?m[m.length-2]:1,m[m.length-1]]},e.isReshapeCheap=function(m,g){let h=!1;return h=m.length===0||g.length===0||(m.length<2||g.length<2?m[m.length-1]===g[g.length-1]:m[m.length-1]===g[g.length-1]&&m[m.length-2]===g[g.length-2]),h}},718:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.reshape=void 0;const s=t(2517);e.reshape=(o,u)=>{const l=s.ShapeUtil.calculateReshapedDims(u[0].dims,u[1].integerData);return o.session.pack?[o.reshapePacked(u[0],l)]:[o.reshapeUnpacked(u[0],l)]}},2268:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseResizeAttributesV11=e.parseResizeAttributesV10=e.resize=void 0;const s=t(5060),o=t(2039),u=t(9390),l=t(2827),m=t(9793),g={name:"Resize",inputNames:["A"],inputTypes:[o.TextureType.packed]};e.resize=(d,p,_)=>((0,m.validateInputs)(p,_),[d.run(Object.assign(Object.assign({},g),{cacheHint:_.cacheKey,get:()=>h(d,p,_)}),p)]),e.parseResizeAttributesV10=d=>(0,m.parseUpsampleAttributes)(d,10),e.parseResizeAttributesV11=d=>(0,m.parseUpsampleAttributes)(d,11);const h=(d,p,_)=>{const y=(0,s.getGlsl)(d.session.backend.glContext.version),[v,T]=f(p,_);if(v.every((W=>W===1))&&_.coordinateTransformMode!=="tf_crop_and_resize")return Object.assign(Object.assign({},g),{output:{dims:T,type:p[0].type,textureType:o.TextureType.packed},hasMain:!0,shaderSource:`void main() {
                    vec4 v = ${y.texture2D}(X, TexCoords);
                    ${y.output} = v;
                }`});const w=T.length;if(w<2)throw new Error(`output dimension should be at least 2, but got ${w}`);const E=T[w-2],P=T[w-1],R=p[0].dims;if(w!==R.length)throw new Error(`output dimension should match input ${R.length}, but got ${w}`);const I=R[w-2],N=R[w-1],B=v[w-2],D=v[w-1];let Y="";if(_.mode!=="linear")throw new Error(`resize (packed) does not support mode: '${_.mode}'`);switch(_.coordinateTransformMode){case"asymmetric":Y=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        return vec4(coords) / scaleWHWH;
                    }
                `;break;case"half_pixel":Y=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        return (vec4(coords) + 0.5) / scaleWHWH - 0.5;
                    }
                `;break;case"pytorch_half_pixel":Y=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 fcoords = vec4(coords);
                        return vec4(
                            ${P}.0 > 1.0 ? (fcoords.x + 0.5) / scaleWHWH.x - 0.5 : 0.0,
                            ${E}.0 > 1.0 ? (fcoords.y + 0.5) / scaleWHWH.y - 0.5 : 0.0,
                            ${P}.0 > 1.0 ? (fcoords.z + 0.5) / scaleWHWH.z - 0.5 : 0.0,
                            ${E}.0 > 1.0 ? (fcoords.w + 0.5) / scaleWHWH.w - 0.5 : 0.0
                          );
                    }
                `;break;case"align_corners":Y=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 resized = vec4(${P}.0 - 1.0, ${E}.0 - 1.0, ${P}.0 - 1.0,
                            ${E}.0 - 1.0);
                        vec4 original = vec4(${N}.0 - 1.0, ${I}.0 - 1.0, ${N}.0 - 1.0,
                            ${I}.0 - 1.0);
                        vec4 new_scale = original / resized;
                        return vec4(coords) * new_scale;
                    }
                `;break;default:throw new Error(`resize (packed) does not support coordinateTransformMode:                                 '${_.coordinateTransformMode}'`)}const se=(0,u.getCoordsDataType)(w),re=`
            const vec2 inputWH = vec2(${I}.0, ${N}.0);
            const vec4 scaleWHWH = vec4(float(${B}), float(${D}), float(${B}), float(${D}));
            ${(0,l.unpackFromChannel)()}
            ${Y}
            float getAValue(int x10, int r, int c, int d) {
                return getChannel(getA(x10, r, c, d), vec2(c, d));
            }
            void main() {
                ${se} rc = getOutputCoords();

                int batch = rc[0];
                int depth = rc[1];

                // retrieve the 4 coordinates that is used in the 4 packed output values.
                ivec4 coords = ivec4(rc.wz, rc.w + 1, rc.z + 1);

                // calculate the source index in fraction
                vec4 sourceFrac = getSourceFracIndex(coords);

                // get the lower and upper bound of the 4 values that will be packed into one texel.
                ivec4 x00 = ivec4(max(sourceFrac.xy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xy)));
                ivec4 x01 = ivec4(max(sourceFrac.xw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xw)));
                ivec4 x10 = ivec4(max(sourceFrac.zy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zy)));
                ivec4 x11 = ivec4(max(sourceFrac.zw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zw)));

                bool hasNextRow = rc.w < ${E-1};
                bool hasNextCol = rc.z < ${P-1};

                // pack x00, x01, x10, x11's top-left corner into one vec4 structure
                vec4 topLeft = vec4(
                    getAValue(batch, depth, x00.x, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.y) : 0.0);

                // pack x00, x01, x10, x11's top-right corner into one vec4 structure
                vec4 topRight = vec4(
                    getAValue(batch, depth, x00.x, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.w) : 0.0);

                // pack x00, x01, x10, x11's bottom-left corner into one vec4 structure
                vec4 bottomLeft = vec4(
                    getAValue(batch, depth, x00.z, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.y) : 0.0);

                // pack x00, x01, x10, x11's bottom-right corner into one vec4 structure
                vec4 bottomRight = vec4(
                    getAValue(batch, depth, x00.z, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.w) : 0.0);

                // calculate the interpolation fraction on u and v direction
                vec4 frac = vec4(sourceFrac) - floor(sourceFrac);
                vec4 clampFrac = clamp(frac, vec4(0.0), vec4(1.0));

                vec4 top = mix(topLeft, topRight, clampFrac.ywyw);
                vec4 bottom = mix(bottomLeft, bottomRight, clampFrac.ywyw);
                vec4 newValue = mix(top, bottom, clampFrac.xxzz);

                ${y.output} = vec4(newValue);
            }
        `;return Object.assign(Object.assign({},g),{output:{dims:T,type:p[0].type,textureType:o.TextureType.packed},hasMain:!0,shaderSource:re})},f=(d,p)=>{const _=d[0].dims;let y,v=p.scales;if(v.length===0){const w=d[p.scalesInputIdx];if(w&&w.size!==0){if(d[p.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");v=i(w,p.mode,p.isResize)}else{const E=d[p.sizesInputIdx];if(!E||E.size===0)throw new Error("Either scales or sizes MUST be provided as input.");y=Array.from(E.integerData),v=r(y,_,p.mode,p.isResize)}}else if(d[p.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");const T=y||_.map(((w,E)=>Math.floor(w*v[E])));return[v,T]},i=(d,p,_)=>{const y=Array.from(d.floatData);return(0,m.scalesValidation)(y,p,_),y},r=(d,p,_,y)=>{const v=p.length,T=new Array(v);for(let w=0,E=v;w<E;w++)if(p[w]===0){if(d[w]!==0)throw new Error("Input dim is zero but required output dim is non-zero.");T[w]=1}else T[w]=d[w]/p[w];return(0,m.scalesValidation)(T,_,y),T}},8117:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.shape=void 0;const s=t(9162);e.shape=(u,l)=>(o(l),[new s.Tensor([l[0].dims.length],"int32",void 0,void 0,new Int32Array(l[0].dims))]);const o=u=>{if(!u||u.length!==1)throw new Error("Shape requires 1 input.")}},2278:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.sliceV10=e.parseSliceAttributes=e.slice=void 0;const s=t(246),o=t(782),u=t(2517),l=t(2039),m={name:"Slice",inputNames:["A"],inputTypes:[l.TextureType.unpacked]};e.slice=(r,d,p)=>(h(d),[r.run(Object.assign(Object.assign({},m),{cacheHint:p.cacheKey,get:()=>g(r,d[0],p)}),d)]),e.parseSliceAttributes=r=>{const d=r.attributes.getInts("starts"),p=r.attributes.getInts("ends"),_=r.attributes.getInts("axes",[]);return(0,s.createAttributeWithCacheKey)({starts:d,ends:p,axes:_})};const g=(r,d,p)=>{const _=p.axes.length===0?d.dims.slice(0).map(((R,I)=>I)):p.axes,y=u.ShapeUtil.normalizeAxes(_,d.dims.length),v=p.starts.map(((R,I)=>R>d.dims[y[I]]-1?d.dims[y[I]]:u.ShapeUtil.normalizeAxis(R,d.dims[y[I]]))),T=p.ends.map(((R,I)=>R>d.dims[y[I]]-1?d.dims[y[I]]:u.ShapeUtil.normalizeAxis(R,d.dims[y[I]]))),w=d.dims.slice(),E=[];for(let R=0;R<y.length;R++)w[y[R]]=T[R]-v[R],v[R]>0&&E.push(`outputIdx[${y[R]}] += ${v[R]};`);const P=`
      float process(int outputIdx[${w.length}]) {
        ${E.join(`
      `)}
        return _A(outputIdx);
      }`;return Object.assign(Object.assign({},m),{output:{dims:w,type:d.type,textureType:l.TextureType.unpacked},shaderSource:P})},h=r=>{if(!r||r.length!==1)throw new Error("Slice requires 1 input.");if(o.NUMBER_TYPES.indexOf(r[0].type)===-1)throw new Error("Invalid input type.")};e.sliceV10=(r,d)=>{i(d);const p=f(r,d);return[r.run(Object.assign(Object.assign({},m),{cacheHint:p.cacheKey,get:()=>g(r,d[0],p)}),[d[0]])]};const f=(r,d)=>{if(!r.session.isInitializer(d[1].dataId)||!r.session.isInitializer(d[2].dataId)||d.length>=4&&!r.session.isInitializer(d[3].dataId)||d.length>=5&&!r.session.isInitializer(d[4].dataId))throw new Error("dynamic slice attributes are not allowed");if(d.length>=5&&d[4].integerData.some((v=>v!==1)))throw new Error("currently non-1 steps is not supported for Slice");const p=Array.from(d[1].integerData),_=Array.from(d[2].integerData),y=d.length>=4?Array.from(d[3].integerData):[];return{starts:p,ends:_,axes:y,cacheKey:`${y};${p};${_}`}},i=r=>{if(!r||r.length<3||r.length>5)throw new Error("Invalid input number.");if(r[1].type!=="int32"||r[1].dims.length!==1)throw new Error("Invalid input type.");if(r[2].type!=="int32"||r[2].dims.length!==1)throw new Error("Invalid input type.");if(r.length>=4&&(r[3].type!=="int32"||r[3].dims.length!==1))throw new Error("Invalid input type.");if(r.length>=5&&(r[4].type!=="int32"||r[4].dims.length!==1))throw new Error("Invalid input type.")}},5524:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.softmaxV13=e.parseSoftmaxAttributesV13=e.parseSoftmaxAttributes=e.softmax=void 0;const s=t(246),o=t(2517),u=t(5060),l=t(2039),m=t(3738),g={name:"SoftmaxComputeMax",inputNames:["A"],inputTypes:[l.TextureType.unpacked]},h={name:"SoftmaxComputeScale",inputNames:["A","Max"],inputTypes:[l.TextureType.unpacked,l.TextureType.unpacked]},f={name:"SoftMax",inputNames:["A","Max","Norm"],inputTypes:[l.TextureType.unpacked,l.TextureType.unpacked,l.TextureType.unpacked]};e.softmax=(y,v,T)=>{_(v);const w=v[0].dims.slice(),E=o.ShapeUtil.normalizeAxis(T.axis,w.length),P=o.ShapeUtil.sizeToDimension(w,E),R=o.ShapeUtil.sizeFromDimension(w,E);return i(y,v,T,P,R)},e.parseSoftmaxAttributes=y=>(0,s.createAttributeWithCacheKey)({axis:y.attributes.getInt("axis",1)}),e.parseSoftmaxAttributesV13=y=>(0,s.createAttributeWithCacheKey)({axis:y.attributes.getInt("axis",-1)}),e.softmaxV13=(y,v,T)=>{_(v);const w=v[0].dims.slice(),E=o.ShapeUtil.normalizeAxis(T.axis,w.length),P=w.length,R=E!==P-1,I=[];let N,B=[],D=[];R&&(B=Array.from({length:P}).map(((W,$)=>$)),B[E]=P-1,B[P-1]=E,B.map((W=>I.push(w[W]))),N=(0,s.createAttributeWithCacheKey)({perm:B}),D=(0,m.transpose)(y,v,N));const Y=R?o.ShapeUtil.sizeToDimension(I,P-1):o.ShapeUtil.sizeToDimension(w,P-1),se=R?o.ShapeUtil.sizeFromDimension(I,P-1):o.ShapeUtil.sizeFromDimension(w,P-1),re=i(y,R?D:v,T,Y,se);return R?(0,m.transpose)(y,re,N):re};const i=(y,v,T,w,E)=>{const P=r(y,v[0],w,E,[w]),R=y.run(Object.assign(Object.assign({},g),{cacheHint:T.cacheKey,get:()=>P}),v),I=d(y,v[0],w,E,P.output.dims,[w]),N=y.run(Object.assign(Object.assign({},h),{cacheHint:T.cacheKey,get:()=>I}),[v[0],R]),B=p(y,v[0],w,E,P.output.dims,I.output.dims);return[y.run(Object.assign(Object.assign({},f),{cacheHint:T.cacheKey,get:()=>B}),[v[0],R,N])]},r=(y,v,T,w,E)=>{const[P,R]=y.calculateTextureWidthAndHeight(v.dims,l.TextureType.unpacked),I=E.length;if(T<1||w<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(E.length!==1)throw new Error("Dimensionality of the output should be 1");if(E[0]!==T)throw new Error("Shape of the output should be equal to logical row count");const N=(0,u.getGlsl)(y.session.backend.glContext.version),B=`
      float process(int[${I}] indices) {
        int logical_row_start_offset = indices[0] * ${w};

        float max = getColorAsFloat(${N.texture2D}(A, offsetToCoords(logical_row_start_offset, ${P},
        ${R} )));
        for(int i=1; i<${w}; ++i)
        {
          float current = getColorAsFloat(${N.texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${P}, ${R})));
          if(current > max)
          max = current;
        }

        return max;
      }`;return Object.assign(Object.assign({},g),{output:{dims:E,type:v.type,textureType:l.TextureType.unpacked},shaderSource:B})},d=(y,v,T,w,E,P)=>{const[R,I]=y.calculateTextureWidthAndHeight(v.dims,l.TextureType.unpacked),N=P.length;if(T<1||w<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(P.length!==1)throw new Error("Dimensionality of the output should be 1");if(P[0]!==T)throw new Error("Shape of the output should be equal to logical row count");if(E.length!==1)throw new Error("Dimensionality of the intermediate results should be 1");if(E[0]!==T)throw new Error("Shape of the intermediate results should be equal to logical row count");const B=`
      float process(int[${N}] indices) {
        int logical_row_start_offset = indices[0] * ${w};

        float norm_factor = 0.0;
        float max = _Max(indices);
        for(int i=0; i<${w}; ++i)
        {
          norm_factor += exp(getColorAsFloat(${(0,u.getGlsl)(y.session.backend.glContext.version).texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${R}, ${I}))) - max);
        }

        return norm_factor;
      }`;return Object.assign(Object.assign({},h),{output:{dims:P,type:v.type,textureType:l.TextureType.unpacked},shaderSource:B})},p=(y,v,T,w,E,P)=>{const[R,I]=y.calculateTextureWidthAndHeight(v.dims,l.TextureType.unpacked),N=v.dims.length;if(T<1||w<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(E.length!==1||P.length!==1)throw new Error("Dimensionality of the intermediate results should be 1");if(E[0]!==T||P[0]!==T)throw new Error("Shape of the intermediate results should be equal to logical row count");const B=`
      float process(int[${N}] indices) {

      // get offset of current logical tensor index from the 2-D texture coordinates (TexCoords)
      int offset = coordsToOffset(TexCoords, ${R}, ${I});

      //determine the logical row for this index
      int logical_row_index[1];
      logical_row_index[0] = offset / ${w};

      float norm_factor = _Norm(logical_row_index);

      // avoid possible division by 0
      // if norm_facor is 0, all elements are zero
      // if so, return 0
      if(norm_factor == 0.0)
        return 0.0;

      return exp(_A(indices) - _Max(logical_row_index)) / norm_factor;
    }`;return Object.assign(Object.assign({},f),{output:{dims:v.dims,type:v.type,textureType:l.TextureType.unpacked},shaderSource:B})},_=y=>{if(!y||y.length!==1)throw new Error("Softmax requires 1 input.");if(y[0].type!=="float32"&&y[0].type!=="float64")throw new Error("Invalid input type")}},5975:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseSplitAttributes=e.split=void 0;const s=t(246),o=t(2517),u=t(2039),l={name:"Split",inputNames:["A"],inputTypes:[u.TextureType.unpacked]};e.split=(f,i,r)=>{h(i);const d=o.ShapeUtil.normalizeAxis(r.axis,i[0].dims.length),p=m(f,i,d,r),_=[];for(let y=0;y<p;++y)_.push(f.run(Object.assign(Object.assign({},l),{cacheHint:`${r.cacheKey};${y}`,get:()=>g(f,i[0],r,d,y)}),i));return _},e.parseSplitAttributes=f=>{const i=f.attributes.getInt("axis",0),r=f.attributes.getInts("split",[]),d=f.outputs.length;return(0,s.createAttributeWithCacheKey)({axis:i,split:r,numOutputs:d})};const m=(f,i,r,d)=>{const[,p]=o.SplitUtil.splitShape(i[0].dims,r,d.split,d.numOutputs);return p.length},g=(f,i,r,d,p)=>{const[_,y]=o.SplitUtil.splitShape(i.dims,d,r.split,r.numOutputs),v=y[p],T=_[p],w=`
      float process(int indices[${T.length}]) {
        indices[${d}] += ${v};
        return _A(indices);
      }
    `;return Object.assign(Object.assign({},l),{cacheHint:`${r.cacheKey}:${p}`,output:{dims:T,type:i.type,textureType:u.TextureType.unpacked},shaderSource:w})},h=f=>{if(!f||f.length!==1)throw new Error("Split requires one input.");if(f[0].type!=="int8"&&f[0].type!=="uint8"&&f[0].type!=="int16"&&f[0].type!=="uint16"&&f[0].type!=="int32"&&f[0].type!=="uint32"&&f[0].type!=="float32"&&f[0].type!=="float64"&&f[0].type!=="bool")throw new Error("Invalid input type.")}},3933:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseSqueezeAttributes=e.squeezeV13=e.squeeze=void 0;const s=t(2517);e.squeeze=(l,m,g)=>{o(m);const h=s.ShapeUtil.squeezeShape(m[0].dims,g);return[l.reshapeUnpacked(m[0],h)]},e.squeezeV13=(l,m)=>(u(m),(0,e.squeeze)(l,[m[0]],Array.from(m[1].integerData))),e.parseSqueezeAttributes=l=>l.attributes.getInts("axes");const o=l=>{if(!l||l.length!==1)throw new Error("Squeeze requires 1 input.");if(l[0].type==="string")throw new Error("invalid input tensor types.")},u=l=>{if(!l||l.length!==2)throw new Error("Squeeze requires 2 inputs.");if(l[1].type!=="int32")throw new Error("Invalid input type.")}},6558:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.sum=void 0;const s=t(5060),o=t(2039);e.sum=(m,g)=>{l(g);const h={name:"Sum",inputNames:g.map(((f,i)=>`X${i}`)),inputTypes:new Array(g.length).fill(o.TextureType.unpacked)};return[m.run(Object.assign(Object.assign({},h),{get:()=>u(m,g,h)}),g)]};const u=(m,g,h)=>{const f=(0,s.getGlsl)(m.session.backend.glContext.version),i=g[0].dims.slice(),r=`
      void main() {
        vec4 result = ${g.map(((d,p)=>`${f.texture2D}(X${p},TexCoords)`)).join(" + ")};
        ${f.output} = result;
      }
    `;return Object.assign(Object.assign({},h),{output:{dims:i,type:g[0].type,textureType:o.TextureType.unpacked},hasMain:!0,shaderSource:r})},l=m=>{if(!m||m.length===0)throw new Error("Sum requires inputs.");const g=m[0].dims.length;for(let h=1;h<m.length;h++){if(g!==m[h].dims.length)throw new Error("Input shapes are mismatched.");for(let f=0;f<g;f++)if(m[0].dims[f]!==m[h].dims[f])throw new Error("Input shapes are not matched.")}if(m[0].type!=="float32"&&m[0].type!=="float64")throw new Error("Invalid input type.");for(let h=1;h<m.length;h++)if(m[0].type!==m[h].type)throw new Error("Input types are not matched.")}},5723:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.tile=void 0;const s=t(782),o=t(2039);e.tile=(m,g)=>{l(g);const h={name:"Tile",inputNames:["A"],inputTypes:[o.TextureType.unpacked]};return[m.run(Object.assign(Object.assign({},h),{get:()=>u(m,g,h)}),g)]};const u=(m,g,h)=>{const f=g[0].dims.slice(),i=new Array(f.length),r=[];for(let _=0;_<f.length;_++)i[_]=f[_]*g[1].numberData[_],r.push(`inputIdx[${_}] = int(mod(float(outputIdx[${_}]), ${f[_]}.));`);const d=i.length,p=`
      float process(int outputIdx[${d}]) {
        int inputIdx[${d}];
        ${r.join(`
`)}
        return _A(inputIdx);
      }
    `;return Object.assign(Object.assign({},h),{output:{dims:i,type:g[0].type,textureType:o.TextureType.unpacked},shaderSource:p})},l=m=>{if(!m||m.length!==2)throw new Error("Tile requires 2 input.");if(m[1].dims.length!==1)throw new Error("The second input shape must 1 dimension.");if(m[1].dims[0]!==m[0].dims.length)throw new Error("Invalid input shape.");if(s.NUMBER_TYPES.indexOf(m[0].type)===-1)throw new Error("Invalid input type.");if(m[1].type!=="int32"&&m[1].type!=="int16")throw new Error("Invalid repeat type.")}},3738:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseTransposeAttributes=e.transpose=void 0;const s=t(246),o=t(2517),u=t(2039),l={name:"Transpose",inputNames:["A"],inputTypes:[u.TextureType.unpacked]};e.transpose=(r,d,p)=>(i(d),[r.run(Object.assign(Object.assign({},l),{cacheHint:p.cacheKey,get:()=>m(r,d[0],p.perm)}),d)]),e.parseTransposeAttributes=r=>(0,s.createAttributeWithCacheKey)({perm:r.attributes.getInts("perm",[])});const m=(r,d,p)=>{const _=d.dims;p=g(_,p);const y=h(_,p),v=_.length,T=`
      ${f("perm",p,v)}
      float process(int indices[${v}]) {
        int a[${v}];
        perm(a, indices);
        return _A(a);
      }`;return Object.assign(Object.assign({},l),{output:{dims:y,type:d.type,textureType:u.TextureType.unpacked},shaderSource:T})},g=(r,d)=>(d&&d.length!==r.length&&(d=[...r.keys()].reverse()),d),h=(r,d)=>(d=g(r,d),o.ShapeUtil.sortBasedOnPerm(r,d)),f=(r,d,p)=>{const _=[];_.push(`void ${r}(out int a[${p}], int src[${p}]) {`);for(let y=0;y<p;++y)_.push(`	a[${d[y]}]=src[${y}];`);return _.push("	}"),_.join(`
`)},i=r=>{if(!r||r.length!==1)throw new Error("Transpose requires 1 input.");if(r[0].type!=="float32"&&r[0].type!=="float64")throw new Error("input should be float tensor")}},8710:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.encodeAsUint8=void 0;const s=t(5060),o=t(2039);e.encodeAsUint8=(u,l)=>{const m=l.shape,g=(0,s.getGlsl)(u.session.backend.glContext.version),h=`
    const float FLOAT_MAX = 1.70141184e38;
    const float FLOAT_MIN = 1.17549435e-38;

    bool isNaN(float val) {
      return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
    }

    highp vec4 encodeAsUint8(highp float v) {
      if (isNaN(v)) {
        return vec4(255, 255, 255, 255);
      }

      highp float av = abs(v);

      if(av < FLOAT_MIN) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      } else if(v > FLOAT_MAX) {
        return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
      } else if(v < -FLOAT_MAX) {
        return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
      }

      highp vec4 c = vec4(0,0,0,0);

      highp float e = floor(log2(av));
      highp float m = exp2(fract(log2(av))) - 1.0;

      c[2] = floor(128.0 * m);
      m -= c[2] / 128.0;
      c[1] = floor(32768.0 * m);
      m -= c[1] / 32768.0;
      c[0] = floor(8388608.0 * m);

      highp float ebias = e + 127.0;
      c[3] = floor(ebias / 2.0);
      ebias -= c[3] * 2.0;
      c[2] += floor(ebias) * 128.0;

      c[3] += 128.0 * step(0.0, -v);

      return c / 255.0;
    }

    void main() {
      float value = ${g.texture2D}(X,TexCoords).r;
      ${g.output} = encodeAsUint8(value);
    }`,f={name:"Uint8Encode",inputTypes:[o.TextureType.unpacked],inputNames:["X"],output:{dims:m,type:l.tensor.type,textureType:o.TextureType.downloadUint8AsFloat},shaderSource:h,hasMain:!0};return u.executeProgram(f,[l.tensor])}},4909:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.tanh=e.tan=e.sqrt=e.sin=e.sigmoid=e.relu=e.not=e.neg=e.log=e.parseLeakyReluAttributes=e.leakyRelu=e.identity=e.floor=e.exp=e.parseEluAttributes=e.elu=e.cos=e.ceil=e.clipV11=e.parseClipAttributes=e.clip=e.atan=e.asin=e.acos=e.abs=e.glslTanh=e.glslTan=e.glslSqrt=e.glslSigmoid=e.glslRelu=e.glslSin=e.glslNot=e.glslNeg=e.glslLog=e.glslLeakyRelu=e.glslIdentity=e.glslClip=e.glslFloor=e.glslExp=e.glslElu=e.glslCos=e.glslCeil=e.glslAtan=e.glslAsin=e.glslAcos=e.glslAbs=void 0;const s=t(246),o=t(2517),u=t(8520),l=t(5060),m=t(2039);function g(){return re("abs")}function h(){return re("acos")}function f(){return re("asin")}function i(){return re("atan")}function r(){return re("ceil")}function d(){return re("cos")}function p(k){return{body:`
  const float alpha = float(${k});

  float elu_(float a) {
    return a >= 0.0 ? a: (exp(a) - 1.0) * alpha;
  }
  vec4 elu_(vec4 v) {
    return vec4(elu_(v.x), elu_(v.y), elu_(v.z), elu_(v.w));
  }
  `,name:"elu",type:u.FunctionType.ValueBased}}function _(){return re("exp")}function y(){return re("floor")}function v(k,H){const de="clip";return{body:`
  const float min = float(${k});
  const float max = float(${H});

  float ${de}_(float a) {
    return clamp(a, min, max);
  }
  vec4 ${de}_(vec4 v) {
    return clamp(v, min, max);
  }
  `,name:de,type:u.FunctionType.ValueBased}}function T(){const k="indentity";return{body:`
  float ${k}_(float a) {
    return a;
  }
  vec4 ${k}_(vec4 v) {
    return v;
  }
  `,name:k,type:u.FunctionType.ValueBased}}function w(k){const H="leakyRelu";return{body:`
  const float alpha = float(${k});

  float ${H}_(float a) {
    return a < 0.0 ? a * alpha : a;
  }
  vec4 ${H}_(vec4 v) {
    return vec4(${H}_(v.x), ${H}_(v.y), ${H}_(v.z), ${H}_(v.w));
  }
  `,name:H,type:u.FunctionType.ValueBased}}function E(){return re("log")}function P(){return{body:`
  float neg_(float a) {
    return -a;
  }
  vec4 neg_(vec4 v) {
    return -v;
  }
  `,name:"neg",type:u.FunctionType.ValueBased}}function R(){return{body:`
  float not_(float a) {
    return float( ! bool(a) );
  }
  bool not_(bool a) {
    return !a;
  }
  vec4 not_(vec4 v) {
    return vec4(!bool(v.x), !bool(v.y), !bool(v.z), !bool(v.w));
  }
  bvec4 not_(bvec4 v) {
    return bvec4(!v.x, !v.y, !v.z, !v.w);
  }
  `,name:"not",type:u.FunctionType.ValueBased}}function I(){return re("sin")}function N(){const k="relu";return{body:`
  float ${k}_(float a) {
    return max( a, 0.0 );
  }
  vec4 ${k}_(vec4 v) {
    return max( v, 0.0 );
  }
  `,name:k,type:u.FunctionType.ValueBased}}function B(){const k="sigmoid";return{body:`
  float ${k}_(float a) {
    return 1.0 / (1.0 + exp(-a));
  }
  vec4 ${k}_(vec4 v) {
    return 1.0 / (1.0 + exp(-v));
  }
  `,name:k,type:u.FunctionType.ValueBased}}function D(){return re("sqrt")}function Y(){return re("tan")}function se(){const k="tanh";return{body:`
  float ${k}_(float a) {
    a = clamp(a, -10., 10.);
    a = exp(2.*a);
    return (a - 1.) / (a + 1.);
  }
  vec4 ${k}_(vec4 v) {
    v = clamp(v, -10., 10.);
    v = exp(2.*v);
    return (v - 1.) / (v + 1.);
  }
  `,name:k,type:u.FunctionType.ValueBased}}function re(k){return{body:`
  float ${k}_(float a) {
    return ${k}(a);
  }
  vec4 ${k}_(vec4 v) {
    return ${k}(v);
  }
  `,name:k,type:u.FunctionType.ValueBased}}e.glslAbs=g,e.glslAcos=h,e.glslAsin=f,e.glslAtan=i,e.glslCeil=r,e.glslCos=d,e.glslElu=p,e.glslExp=_,e.glslFloor=y,e.glslClip=v,e.glslIdentity=T,e.glslLeakyRelu=w,e.glslLog=E,e.glslNeg=P,e.glslNot=R,e.glslSin=I,e.glslRelu=N,e.glslSigmoid=B,e.glslSqrt=D,e.glslTan=Y,e.glslTanh=se;const W=(k,H,de,ee)=>{const ce=k.session.pack?m.TextureType.packed:m.TextureType.unpacked,q={name:de.name,inputTypes:[ce],inputNames:["A"],cacheHint:ee};return Object.assign(Object.assign({},q),{get:()=>((le,be,xe,Ee)=>{const we=le.session.pack?m.TextureType.packed:m.TextureType.unpacked,U=(0,l.getGlsl)(le.session.backend.glContext.version);return Object.assign(Object.assign({},be),{output:{dims:xe.dims,type:xe.type,textureType:we},shaderSource:`
     ${Ee.body}
     void main() {
       vec4 v = ${U.texture2D}(A, TexCoords);
       v = ${Ee.name}_(v);
       ${U.output} = v;
     }
     `,hasMain:!0})})(k,q,H,de)})};e.abs=(k,H)=>[k.run(W(k,H[0],g()),H)],e.acos=(k,H)=>[k.run(W(k,H[0],h()),H)],e.asin=(k,H)=>[k.run(W(k,H[0],f()),H)],e.atan=(k,H)=>[k.run(W(k,H[0],i()),H)],e.clip=(k,H,de)=>[k.run(W(k,H[0],v(de.min,de.max),de.cacheKey),H)],e.parseClipAttributes=k=>(0,s.createAttributeWithCacheKey)({min:k.attributes.getFloat("min",o.MIN_CLIP),max:k.attributes.getFloat("max",o.MAX_CLIP)}),e.clipV11=(k,H)=>{const de=$(k,H);return(0,e.clip)(k,[H[0]],de)};const $=(k,H)=>{if(H.length>=3&&(!k.session.isInitializer(H[1].dataId)||!k.session.isInitializer(H[2].dataId)))throw new Error("dynamic clip attributes are not allowed");const de=H.length>=3?H[1].numberData[0]:o.MIN_CLIP,ee=H.length>=3?H[2].numberData[0]:o.MAX_CLIP;return(0,s.createAttributeWithCacheKey)({min:de,max:ee})};e.ceil=(k,H)=>[k.run(W(k,H[0],r()),H)],e.cos=(k,H)=>[k.run(W(k,H[0],d()),H)],e.elu=(k,H,de)=>[k.run(W(k,H[0],p(de.alpha),de.cacheKey),H)],e.parseEluAttributes=k=>(0,s.createAttributeWithCacheKey)({alpha:k.attributes.getFloat("alpha",1)}),e.exp=(k,H)=>[k.run(W(k,H[0],_()),H)],e.floor=(k,H)=>[k.run(W(k,H[0],y()),H)],e.identity=(k,H)=>[k.run(W(k,H[0],T()),H)],e.leakyRelu=(k,H,de)=>[k.run(W(k,H[0],w(de.alpha),de.cacheKey),H)],e.parseLeakyReluAttributes=k=>(0,s.createAttributeWithCacheKey)({alpha:k.attributes.getFloat("alpha",.01)}),e.log=(k,H)=>[k.run(W(k,H[0],E()),H)],e.neg=(k,H)=>[k.run(W(k,H[0],P()),H)],e.not=(k,H)=>[k.run(W(k,H[0],R()),H)],e.relu=(k,H)=>[k.run(W(k,H[0],N()),H)],e.sigmoid=(k,H)=>[k.run(W(k,H[0],B()),H)],e.sin=(k,H)=>[k.run(W(k,H[0],I()),H)],e.sqrt=(k,H)=>[k.run(W(k,H[0],D()),H)],e.tan=(k,H)=>[k.run(W(k,H[0],Y()),H)],e.tanh=(k,H)=>[k.run(W(k,H[0],se()),H)]},5611:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createUnpackProgramInfoLoader=e.createUnpackProgramInfo=void 0;const s=t(5060),o=t(2039),u=t(9390),l=t(2827),m={name:"unpack",inputNames:["A"],inputTypes:[o.TextureType.packed]};e.createUnpackProgramInfo=(g,h)=>{const f=h.dims.length,i=(0,l.getChannels)("rc",f),r=i.slice(-2),d=(0,u.getCoordsDataType)(f),p=(0,l.unpackFromChannel)(),_=h.dims.length===0?"":(function(T,w){if(T===1)return"rc";let E="";for(let P=0;P<T;P++)E+=w[P],P<T-1&&(E+=",");return E})(f,i),y=f<=1?"rc":`vec2(${r.join(",")})`,v=`
    ${p}
    void main() {
      ${d} rc = getOutputCoords();

       // Sample the texture with the coords to get the rgba channel value.
       vec4 packedInput = getA(${_});

       ${(0,s.getGlsl)(g.session.backend.glContext.version).output} = vec4(getChannel(packedInput, ${y}), 0, 0, 0);
     }
   `;return Object.assign(Object.assign({},m),{hasMain:!0,output:{dims:h.dims,type:h.type,textureType:o.TextureType.unpacked},shaderSource:v})},e.createUnpackProgramInfoLoader=(g,h)=>Object.assign(Object.assign({},m),{get:()=>(0,e.createUnpackProgramInfo)(g,h)})},8428:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseUnsqueezeAttributes=e.unsqueezeV13=e.unsqueeze=void 0;const s=t(2517);e.unsqueeze=(l,m,g)=>{o(m);const h=s.ShapeUtil.unsqueezeShape(m[0].dims,g);return[l.reshapeUnpacked(m[0],h)]},e.unsqueezeV13=(l,m)=>(u(m),(0,e.unsqueeze)(l,[m[0]],Array.from(m[1].integerData))),e.parseUnsqueezeAttributes=l=>l.attributes.getInts("axes");const o=l=>{if(!l||l.length!==1)throw new Error("Unsqueeze requires 1 input.");if(l[0].type==="string")throw new Error("invalid input tensor types.")},u=l=>{if(!l||l.length!==2)throw new Error("Unsqueeze requires 2 inputs.");if(l[1].type!=="int32")throw new Error("Invalid input type.")}},9793:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.scalesValidation=e.validateInputs=e.parseUpsampleAttributes=e.parseUpsampleAttributesV9=e.parseUpsampleAttributesV7=e.upsample=void 0;const s=t(246),o=t(5060),u=t(2039),l={name:"Upsample",inputNames:["X"],inputTypes:[u.TextureType.unpacked]};e.upsample=(g,h,f)=>((0,e.validateInputs)(h,f),[g.run(Object.assign(Object.assign({},l),{cacheHint:f.cacheKey,get:()=>m(g,h,f)}),h)]),e.parseUpsampleAttributesV7=g=>(0,e.parseUpsampleAttributes)(g,7),e.parseUpsampleAttributesV9=g=>(0,e.parseUpsampleAttributes)(g,9),e.parseUpsampleAttributes=(g,h)=>{const f=h>=10,i=g.attributes.getString("mode","nearest");if(i!=="nearest"&&i!=="linear"&&(h<11||i!=="cubic"))throw new Error(`unrecognized mode: ${i}`);let r=[];h<9&&(r=g.attributes.getFloats("scales"),(0,e.scalesValidation)(r,i,f));const d=g.attributes.getFloat("extrapolation_value",0),p=h>10?g.attributes.getString("coordinate_transformation_mode","half_pixel"):"asymmetric";if(["asymmetric","pytorch_half_pixel","tf_half_pixel_for_nn","align_corners","tf_crop_and_resize","half_pixel"].indexOf(p)===-1)throw new Error(`coordinate_transform_mode '${p}' is not supported`);const _=p==="tf_crop_and_resize",y=_,v=i==="nearest"&&h>=11?g.attributes.getString("nearest_mode","round_prefer_floor"):"";if(["round_prefer_floor","round_prefer_ceil","floor","ceil",""].indexOf(v)===-1)throw new Error(`nearest_mode '${v}' is not supported`);const T=g.attributes.getFloat("cubic_coeff_a",-.75),w=g.attributes.getInt("exclude_outside",0)!==0;if(w&&i!=="cubic")throw new Error("exclude_outside can be set to 1 only when mode is CUBIC.");const E=h<11||i==="nearest"&&p==="asymmetric"&&v==="floor";let P=0,R=0,I=0;return h>10?g.inputs.length>2?(P=1,R=2,I=3):(R=1,I=2):h===9&&(R=1),(0,s.createAttributeWithCacheKey)({opset:h,isResize:f,mode:i,scales:r,extrapolationValue:d,coordinateTransformMode:p,useExtrapolation:y,needRoiInput:_,nearestMode:v,cubicCoefficientA:T,excludeOutside:w,useNearest2xOptimization:E,roiInputIdx:P,scalesInputIdx:R,sizesInputIdx:I})};const m=(g,h,f)=>{const i=(0,o.getGlsl)(g.session.backend.glContext.version),[r,d]=g.calculateTextureWidthAndHeight(h[0].dims,u.TextureType.unpacked),p=h[0].dims.map(((I,N)=>Math.floor(I*f.scales[N]))),[_,y]=g.calculateTextureWidthAndHeight(p,u.TextureType.unpacked),v=p.length,T=new Array(v),w=new Array(v);let E=`
      int output_pitches[${v}];
      int input_pitches[${v}];
      `;for(let I=v-1;I>=0;I--)T[I]=I===v-1?1:T[I+1]*p[I+1],w[I]=I===v-1?1:w[I+1]*h[0].dims[I+1],E+=`
        output_pitches[${I}] = ${T[I]};
        input_pitches[${I}] = ${w[I]};
        `;const P=`
      float getInputFloat(int index) {
        vec2 coords = offsetToCoords(index, ${r}, ${d});
        float value = getColorAsFloat(${i.texture2D}(X, coords));
        return value;
      }
      `,R=f.mode==="nearest"?`
    ${P}
    float process(int indices[${v}]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${_}, ${y});

      ${E}

      int d, m;
      for (int dim = 0; dim < ${v}; ++dim) {
        d = output_index / output_pitches[dim];
        m = output_index - d * output_pitches[dim];
        output_index = m;

        if (scales[dim] != 1 && d > 0) {
          int d2 = d / scales[dim];
          m = d - d2 * scales[dim];
          d = d2;
        }
        input_index += input_pitches[dim] * d;
      }

      return getInputFloat(input_index);
    }`:v===4?`
    ${P}
    float process(int indices[4]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${_}, ${y});

      ${E}

      int m;
      int index_of_dim0, index_of_dim1, index_of_dim2, index_of_dim3;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m / output_pitches[1];
      m = m - index_of_dim1 * output_pitches[1];
      index_of_dim2 = m / output_pitches[2];
      m = m - index_of_dim2 * output_pitches[2];
      index_of_dim3 = m;

      int index_of_input_dim2, index_of_input_dim3, x_offset, y_offset;
      index_of_input_dim2 = index_of_dim2 / scales[2];
      y_offset = index_of_dim2 - index_of_input_dim2 * scales[2];
      index_of_input_dim3 = index_of_dim3 / scales[3];
      x_offset = index_of_dim3 - index_of_input_dim3 * scales[3];

      input_index = index_of_dim0 * input_pitches[0] +
            index_of_dim1 * input_pitches[1] +
            index_of_input_dim2 * input_pitches[2] +
            index_of_input_dim3;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim2 = false;
      if (index_of_input_dim2 == (${h[0].dims[2]} - 1)) {
        // It's the end in dimension 2
        x01 = x00;
        end_of_dim2 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[2]);
      }

      if (index_of_input_dim3 == (input_pitches[2] - 1)) {
        // It's the end in dimension 3
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim2 ? x10 : getInputFloat(input_index + input_pitches[2] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[2]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[2]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[3]);
    }`:`
    ${P}
    float process(int indices[2]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${_}, ${y});

      ${E}

      int m;
      int index_of_dim0, index_of_dim1;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m;

      int index_of_input_dim0, index_of_input_dim1, x_offset, y_offset;
      index_of_input_dim0 = index_of_dim0 / scales[0];
      y_offset = index_of_dim0 - index_of_input_dim0 * scales[0];
      index_of_input_dim1 = index_of_dim1 / scales[1];
      x_offset = index_of_dim1 - index_of_input_dim1 * scales[1];

      input_index = index_of_input_dim0 * input_pitches[0] + index_of_input_dim1;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim0 = false;
      if (index_of_input_dim0 == (${h[0].dims[0]} - 1)) {
        // It's the end in dimension 0
        x01 = x00;
        end_of_dim0 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[0]);
      }

      if (index_of_input_dim1 == (input_pitches[0] - 1)) {
        // It's the end in dimension 1
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim0 ? x10 : getInputFloat(input_index + input_pitches[0] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[0]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[0]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[1]);
    }`;return Object.assign(Object.assign({},l),{output:{dims:p,type:h[0].type,textureType:u.TextureType.unpacked},shaderSource:R,variables:[{name:"scales",type:"int",arrayLength:f.scales.length,data:f.scales.map((I=>Math.ceil(I)))}]})};e.validateInputs=(g,h)=>{if(!g||h.opset<9&&g.length!==1||h.opset>=9&&h.opset<11&&g.length!==2||h.opset>=11&&g.length<2)throw new Error("invalid inputs.");if(h.scales.length>0&&g[0].dims.length!==h.scales.length)throw new Error("Invalid input shape.");if(g[0].type==="string")throw new Error("Invalid input tensor types.")},e.scalesValidation=(g,h,f)=>{if(f){for(const i of g)if(i<=0)throw new Error("Scale value should be greater than 0.")}else for(const i of g)if(i<1)throw new Error("Scale value should be greater than or equal to 1.");if(!(h!=="linear"&&h!=="cubic"||g.length===2||g.length===4&&g[0]===1&&g[1]===1))throw new Error(`'Linear' mode and 'Cubic' mode only support 2-D inputs ('Bilinear', 'Bicubic')         or 4-D inputs with the corresponding outermost 2 scale values being 1         in the ${f?"Resize":"Upsample"} opeartor.`)}},1958:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ProgramManager=void 0;const s=t(1670),o=t(6231),u=t(8879),l=t(5060);e.ProgramManager=class{constructor(m,g,h){this.profiler=m,this.glContext=g,this.textureLayoutStrategy=h,this.repo=new Map,this.attributesBound=!1}getArtifact(m){return this.repo.get(m)}setArtifact(m,g){this.repo.set(m,g)}run(m,g,h){var f;this.profiler.event("op",`ProgramManager.run ${(f=m.programInfo.name)!==null&&f!==void 0?f:"unknown kernel"}`,(()=>{var i;const r=this.glContext.gl,d=m.program;r.useProgram(d);try{this.bindOutput(h),this.attributesBound||this.bindAttributes(m.attribLocations),this.bindUniforms(m.uniformLocations,(i=m.programInfo.variables)!==null&&i!==void 0?i:[],g)}catch(p){throw o.Logger.error("ProgramManager",m.programInfo.shaderSource),p}this.profiler.event("backend","GlContext.draw()",(()=>{this.glContext.draw()}))}),this.glContext)}dispose(){this.vertexShader&&this.glContext.deleteShader(this.vertexShader),this.repo.forEach((m=>this.glContext.deleteProgram(m.program)))}build(m,g,h){return this.profiler.event("backend","ProgramManager.build",(()=>{const f=new u.GlslPreprocessor(this.glContext,m,g,h),i=f.preprocess(),r=this.compile(i);return{programInfo:m,program:r,uniformLocations:this.getUniformLocations(r,f.context.programInfo.inputNames,f.context.programInfo.variables),attribLocations:this.getAttribLocations(r)}}))}compile(m){if(!this.vertexShader){o.Logger.verbose("ProrgramManager","Compiling and caching Vertex shader for the first time");const f=(0,l.getVertexShaderSource)(this.glContext.version);this.vertexShader=this.glContext.compileShader(f,this.glContext.gl.VERTEX_SHADER)}s.env.debug&&o.Logger.verbose("ProrgramManager",`FragShader:
${m}
`);const g=this.glContext.compileShader(m,this.glContext.gl.FRAGMENT_SHADER),h=this.glContext.createProgram(this.vertexShader,g);return this.glContext.deleteShader(g),h}bindOutput(m){const g=m.width,h=m.height;o.Logger.verbose("ProrgramManager",`Binding output texture to Framebuffer: w/h=${g}/${h}, shape=${m.shape}, type=${m.tensor.type}`),this.glContext.attachFramebuffer(m.texture,g,h)}bindAttributes(m){const g=m.position,h=m.textureCoord;this.glContext.setVertexAttributes(g,h),this.attributesBound=!0}bindUniforms(m,g,h){var f;const i=this.glContext.gl;let r=0;for(const{name:d,type:p,location:_,arrayLength:y}of m){const v=(f=g.find((T=>T.name===d)))===null||f===void 0?void 0:f.data;if(p!=="sampler2D"&&!v)throw new Error(`variable '${d}' does not have data defined in program info`);switch(p){case"sampler2D":this.bindTexture(h[r],_,r),r++;break;case"float":y?i.uniform1fv(_,v):i.uniform1f(_,v);break;case"int":y?i.uniform1iv(_,v):i.uniform1i(_,v);break;default:throw new Error(`Uniform not implemented: ${p}`)}}}bindTexture(m,g,h){this.glContext.bindTextureToUniform(m.texture,h,g)}getAttribLocations(m){return{position:this.getAttribLocation(m,"position"),textureCoord:this.getAttribLocation(m,"textureCoord")}}getUniformLocations(m,g,h){const f=[];if(g)for(const i of g)f.push({name:i,type:"sampler2D",location:this.getUniformLocation(m,i)});if(h)for(const i of h)f.push(Object.assign(Object.assign({},i),{location:this.getUniformLocation(m,i.name)}));return f}getUniformLocation(m,g){const h=this.glContext.gl.getUniformLocation(m,g);if(h===null)throw new Error(`Uniform ${g} not found.`);return h}getAttribLocation(m,g){return this.glContext.gl.getAttribLocation(m,g)}}},6416:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLSessionHandler=void 0;const s=t(6231),o=t(1047),u=t(8316),l=t(1640),m=t(1958),g=t(7859),h=t(5702);e.WebGLSessionHandler=class{constructor(f,i){this.backend=f,this.context=i,this.layoutStrategy=new g.PreferLogicalStrategy(f.glContext.maxTextureSize),this.programManager=new m.ProgramManager(this.context.profiler,f.glContext,this.layoutStrategy),this.textureManager=new h.TextureManager(f.glContext,this.layoutStrategy,this.context.profiler,{reuseTextures:f.textureCacheMode==="full"}),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map,this.pack=f.pack,this.pack2unpackMap=new Map,this.unpack2packMap=new Map}createInferenceHandler(){return new u.WebGLInferenceHandler(this)}onGraphInitialized(f){const i=f.getValues().filter((r=>r.from===-1&&r.tensor)).map((r=>r.tensor.dataId));this.initializers=new Set(i)}isInitializer(f){return!!this.initializers&&this.initializers.has(f)}addInitializer(f){this.initializers.add(f)}getTextureData(f,i){return i?this.packedTextureDataCache.get(f):this.unpackedTextureDataCache.get(f)}setTextureData(f,i,r=!1){s.Logger.verbose("WebGLSessionHandler","Storing Texture data in cache"),r?this.packedTextureDataCache.set(f,i):this.unpackedTextureDataCache.set(f,i)}dispose(){this.programManager.dispose(),this.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach((f=>this.textureManager.releaseTexture(f,!0))),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach((f=>this.textureManager.releaseTexture(f,!0))),this.unpackedTextureDataCache=new Map}resolve(f,i,r){const d=(0,o.resolveOperator)(f,i,l.WEBGL_OP_RESOLVE_RULES);return{impl:d.opImpl,context:d.opInit?d.opInit(f,r):f}}}},7769:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Uint8DataEncoder=e.RGBAFloatDataEncoder=e.RedFloat32DataEncoder=void 0;const s=t(6231);e.RedFloat32DataEncoder=class{constructor(o,u=1){if(u===1)this.internalFormat=o.R32F,this.format=o.RED,this.textureType=o.FLOAT,this.channelSize=u;else{if(u!==4)throw new Error(`Invalid number of channels: ${u}`);this.internalFormat=o.RGBA32F,this.format=o.RGBA,this.textureType=o.FLOAT,this.channelSize=u}}encode(o,u){let l,m;return o.constructor!==Float32Array&&(s.Logger.warning("Encoder","data was not of type Float32; creating new Float32Array"),m=new Float32Array(o)),u*this.channelSize>o.length?(s.Logger.warning("Encoder","Source data too small. Allocating larger array"),m=o,l=this.allocate(u*this.channelSize),m.forEach(((g,h)=>l[h]=g))):(m=o,l=m),l}allocate(o){return new Float32Array(4*o)}decode(o,u){return this.channelSize===1?o.filter(((l,m)=>m%4==0)).subarray(0,u):o.subarray(0,u)}},e.RGBAFloatDataEncoder=class{constructor(o,u=1,l){if(u!==1&&u!==4)throw new Error(`Invalid number of channels: ${u}`);this.internalFormat=o.RGBA,this.format=o.RGBA,this.channelSize=u,this.textureType=l||o.FLOAT}encode(o,u){let l=o;return this.channelSize===1&&(s.Logger.verbose("Encoder","Exploding into a larger array"),l=this.allocate(u),o.forEach(((m,g)=>l[4*g]=m))),l}allocate(o){return new Float32Array(4*o)}decode(o,u){return this.channelSize===1?o.filter(((l,m)=>m%4==0)).subarray(0,u):o.subarray(0,u)}},e.Uint8DataEncoder=class{constructor(o,u=1){if(this.channelSize=4,u===1)this.internalFormat=o.ALPHA,this.format=o.ALPHA,this.textureType=o.UNSIGNED_BYTE,this.channelSize=u;else{if(u!==4)throw new Error(`Invalid number of channels: ${u}`);this.internalFormat=o.RGBA,this.format=o.RGBA,this.textureType=o.UNSIGNED_BYTE,this.channelSize=u}}encode(o,u){return new Uint8Array(o.buffer,o.byteOffset,o.byteLength)}allocate(o){return new Uint8Array(o*this.channelSize)}decode(o,u){if(o instanceof Uint8Array)return o.subarray(0,u);throw new Error(`Invalid array type: ${o.constructor}`)}}},7859:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getBatchDim=e.sizeToSquarishShape=e.getRowsCols=e.sizeFromShape=e.isInt=e.parseAxisParam=e.squeezeShape=e.PreferLogicalStrategy=e.AlwaysKeepOriginalSizeStrategy=void 0;const s=t(6231),o=t(2517);function u(f,i){const r=[],d=[],p=i!=null&&Array.isArray(i)&&i.length===0,_=i==null||p?null:l(i,f).sort();let y=0;for(let v=0;v<f.length;++v){if(_!=null){if(_[y]===v&&f[v]!==1)throw new Error(`Can't squeeze axis ${v} since its dim '${f[v]}' is not 1`);(_[y]==null||_[y]>v)&&f[v]===1&&(r.push(f[v]),d.push(v)),_[y]<=v&&y++}f[v]!==1&&(r.push(f[v]),d.push(v))}return{newShape:r,keptDims:d}}function l(f,i){const r=i.length;return f=f==null?i.map(((d,p)=>p)):[].concat(f),(0,o.assert)(f.every((d=>d>=-r&&d<r)),(()=>`All values in axis param must be in range [-${r}, ${r}) but got axis ${f}`)),(0,o.assert)(f.every(m),(()=>`All values in axis param must be integers but got axis ${f}`)),f.map((d=>d<0?r+d:d))}function m(f){return f%1==0}function g(f){if(f.length===0)return 1;let i=f[0];for(let r=1;r<f.length;r++)i*=f[r];return i}function h(f){const i=Math.ceil(Math.sqrt(f));return[i,Math.ceil(f/i)]}e.AlwaysKeepOriginalSizeStrategy=class{constructor(f){this.maxTextureSize=f}computeTextureWH(f,i){if(f.length===0)return[1,1];const r=this.maxTextureSize;if(i&&i.breakAxis!==void 0){const _=i.breakAxis>=f.length?1:f.slice(i.breakAxis).reduce(((v,T)=>v*T)),y=i.breakAxis<=0?1:f.slice(0,i.breakAxis).reduce(((v,T)=>v*T));if(!(_>r||y>r))return[_,y];s.Logger.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${f}, breakAxis:${i.breakAxis}`)}const d=f.reduce(((_,y)=>_*y));let p=Math.floor(Math.sqrt(d));for(;p<r&&p<d&&d%p!=0;p++);if(p>=r||d%p!=0)throw new Error(`The given dimensions are outside this GPU's boundaries: ${f}`);return[p,d/p]}},e.PreferLogicalStrategy=class{constructor(f){this.maxTextureSize=f}computeTextureWH(f,i){const r=this.computeTexture(f,i);return i&&i.isPacked&&(r[0]/=2,r[1]/=2),i&&i.reverseWH?[r[1],r[0]]:r}computeTexture(f,i){const r=i&&i.isPacked;if(f.length===0)return r?[2,2]:[1,1];let d=this.maxTextureSize;if(i&&i.breakAxis!==void 0){const y=i.breakAxis>=f.length?1:f.slice(i.breakAxis).reduce(((T,w)=>T*w)),v=i.breakAxis<=0?1:f.slice(0,i.breakAxis).reduce(((T,w)=>T*w));if(!(y>d||v>d))return[y,v];s.Logger.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${f}, breakAxis:${i.breakAxis}`)}let p=f.slice(0);r&&(d*=2,p=p.map(((y,v)=>v>=p.length-2?p[v]%2==0?p[v]:p[v]+1:p[v])),p.length===1&&(p=[2,p[0]])),p.length!==2&&(p=u(p).newShape);const _=g(p);return p.length<=1&&_<=d?[1,_]:p.length===2&&p[0]<=d&&p[1]<=d?p:p.length===3&&p[0]*p[1]<=d&&p[2]<=d?[p[0]*p[1],p[2]]:p.length===3&&p[0]<=d&&p[1]*p[2]<=d?[p[0],p[1]*p[2]]:p.length===4&&p[0]*p[1]*p[2]<=d&&p[3]<=d?[p[0]*p[1]*p[2],p[3]]:p.length===4&&p[0]<=d&&p[1]*p[2]*p[3]<=d?[p[0],p[1]*p[2]*p[3]]:r?h(_/4).map((y=>2*y)):h(_)}},e.squeezeShape=u,e.parseAxisParam=l,e.isInt=m,e.sizeFromShape=g,e.getRowsCols=function(f){if(f.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[f.length>1?f[f.length-2]:1,f[f.length-1]]},e.sizeToSquarishShape=h,e.getBatchDim=function(f,i=2){return g(f.slice(0,f.length-i))}},4057:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createTextureLayoutFromShape=e.calculateTextureWidthAndHeight=e.createTextureLayoutFromTextureType=void 0;const s=t(2517),o=t(2039);e.createTextureLayoutFromTextureType=(u,l,m)=>{const g=m===o.TextureType.unpacked||m===o.TextureType.unpackedReversed?1:4,h=m===o.TextureType.packed,f=m===o.TextureType.unpackedReversed||m===o.TextureType.packed,i=m===o.TextureType.packedLastDimension?l.length-1:void 0,r=m===o.TextureType.packedLastDimension?l.map(((d,p)=>p===l.length-1?4*d:d)):void 0;return(0,e.createTextureLayoutFromShape)(u,l,g,r,{isPacked:h,reverseWH:f,breakAxis:i})},e.calculateTextureWidthAndHeight=(u,l,m)=>{const g=(0,e.createTextureLayoutFromTextureType)(u,l,m);return[g.width,g.height]},e.createTextureLayoutFromShape=(u,l,m=1,g,h)=>{const f=!(!h||!h.isPacked),[i,r]=u.computeTextureWH(f&&g||l,h),d=l.length;let p=l.slice(0);if(d===0&&(p=[1]),m===1)g=l;else if(f){if(m!==4)throw new Error("a packed texture must be 4-channel");g=l,d>0&&(p[d-1]=Math.ceil(p[d-1]/2)),d>1&&(p[d-2]=Math.ceil(p[d-2]/2))}else if(!g)throw new Error("Unpacked shape is needed when using channels > 1");return{width:i,height:r,channels:m,isPacked:f,shape:p,strides:s.ShapeUtil.computeStrides(p),unpackedShape:g,reversedWH:h&&h.reverseWH}}},5702:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextureManager=void 0;const s=t(6231);e.TextureManager=class{constructor(o,u,l,m){this.glContext=o,this.layoutStrategy=u,this.profiler=l,this.config=m,this.pendingRead=new Map,m.reuseTextures&&(this.inUseTextures=new Map,this.idleTextures=new Map,this.textureLookup=new Map)}createTextureFromLayout(o,u,l,m){const g=this.toEncoderType(o),h=this.glContext.getEncoder(g,u.channels||1,m);if(u.isPacked&&m===1)throw new Error("not implemented");const f=u.width,i=u.height;let r,d;if(this.config.reuseTextures){r=`${f}x${i}_${h.format}_${h.internalFormat}_${h.textureType}`,d=this.inUseTextures.get(r),d||(d=[],this.inUseTextures.set(r,d));const _=this.idleTextures.get(r);if(_&&_.length>0){const y=_.pop();return d.push(y),m===1&&this.glContext.updateTexture(y,f,i,h,this.toTextureData(o,l)),y}}s.Logger.verbose("TextureManager",`Creating new texture of size ${u.width}x${u.height}`);const p=this.glContext.allocateTexture(f,i,h,this.toTextureData(o,l));return this.config.reuseTextures&&(d.push(p),this.textureLookup.set(p,r)),p}readTexture(o,u,l){return l||(l=1),this.profiler.event("backend","TextureManager.readTexture",(()=>{const m=o.shape.reduce(((h,f)=>h*f))*l,g=this.glContext.readTexture(o.texture,o.width,o.height,m,this.toEncoderType(u),l);return this.toTensorData(u,g)}))}async readTextureAsync(o,u,l){const m=o.tensor.dataId;if(l||(l=1),this.pendingRead.has(m)){const g=this.pendingRead.get(m);return new Promise((h=>g?.push(h)))}return this.profiler.event("backend","TextureManager.readTextureAsync",(async()=>{this.pendingRead.set(m,[]);const g=o.shape.reduce(((r,d)=>r*d))*l;await this.glContext.createAndWaitForFence();const h=this.glContext.readTexture(o.texture,o.width,o.height,g,this.toEncoderType(u),l),f=this.toTensorData(u,h),i=this.pendingRead.get(m);return this.pendingRead.delete(m),i?.forEach((r=>r(f))),f}))}readUint8TextureAsFloat(o){return this.profiler.event("backend","TextureManager.readUint8TextureAsFloat",(()=>{const u=o.shape.reduce(((m,g)=>m*g)),l=this.glContext.readTexture(o.texture,o.width,o.height,4*u,"byte",4);return new Float32Array(l.buffer,l.byteOffset,u)}))}releaseTexture(o,u){let l;if(this.config.reuseTextures&&(l=this.textureLookup.get(o.texture),l)){u&&this.textureLookup.delete(l);const m=this.inUseTextures.get(l);if(m){const g=m.indexOf(o.texture);if(g!==-1){m.splice(g,1);let h=this.idleTextures.get(l);h||(h=[],this.idleTextures.set(l,h)),h.push(o.texture)}}}l&&!u||(s.Logger.verbose("TextureManager",`Deleting texture of size ${o.width}x${o.height}`),this.glContext.deleteTexture(o.texture))}toTensorData(o,u){switch(o){case"int16":return u instanceof Int16Array?u:Int16Array.from(u);case"int32":return u instanceof Int32Array?u:Int32Array.from(u);case"int8":return u instanceof Int8Array?u:Int8Array.from(u);case"uint16":return u instanceof Uint16Array?u:Uint16Array.from(u);case"uint32":return u instanceof Uint32Array?u:Uint32Array.from(u);case"uint8":case"bool":return u instanceof Uint8Array?u:Uint8Array.from(u);case"float32":return u instanceof Float32Array?u:Float32Array.from(u);case"float64":return u instanceof Float64Array?u:Float64Array.from(u);default:throw new Error(`TensorData type ${o} is not supported`)}}toTextureData(o,u){if(u)return u instanceof Float32Array?u:new Float32Array(u)}toEncoderType(o){return"float"}clearActiveTextures(){this.glContext.clearActiveTextures()}}},2039:(n,e)=>{var t;Object.defineProperty(e,"__esModule",{value:!0}),e.TextureType=void 0,(t=e.TextureType||(e.TextureType={}))[t.unpacked=0]="unpacked",t[t.unpackedReversed=1]="unpackedReversed",t[t.packed=2]="packed",t[t.downloadUint8AsFloat=3]="downloadUint8AsFloat",t[t.packedLastDimension=4]="packedLastDimension"},9390:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getGlChannels=e.getCoordsDataType=e.getSqueezedParams=e.squeezeInputShape=e.generateShaderFuncNameFromInputSamplerNameAtOutCoords=e.generateShaderFuncNameFromInputSamplerName=e.repeatedTry=e.getPackedShape=void 0;const s=t(2517);e.getPackedShape=function(o){const u=o.length;return o.slice(0,u-1).concat(o[u-1]/4)},e.repeatedTry=async function(o,u=(m=>0),l){return new Promise(((m,g)=>{let h=0;const f=()=>{if(o())return void m();h++;const i=u(h);l!=null&&h>=l?g():setTimeout(f,i)};f()}))},e.generateShaderFuncNameFromInputSamplerName=function(o){return(0,s.assert)(o!==void 0&&o.length!==0,(()=>"empty string found for sampler name")),"get"+o.charAt(0).toUpperCase()+o.slice(1)},e.generateShaderFuncNameFromInputSamplerNameAtOutCoords=function(o){return(0,s.assert)(o!==void 0&&o.length!==0,(()=>"empty string found for sampler name")),"get"+o.charAt(0).toUpperCase()+o.slice(1)+"AtOutCoords"},e.squeezeInputShape=function(o,u){let l=JSON.parse(JSON.stringify(o));return l=u,l},e.getSqueezedParams=function(o,u){return u.map((l=>o[l])).join(", ")},e.getCoordsDataType=function(o){if(o<=1)return"int";if(o===2)return"ivec2";if(o===3)return"ivec3";if(o===4)return"ivec4";if(o===5)return"ivec5";if(o===6)return"ivec6";throw Error(`GPU for rank ${o} is not yet supported`)},e.getGlChannels=function(o=6){return["x","y","z","w","u","v"].slice(0,o)}},7305:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createNewWebGLContext=e.createWebGLContext=void 0;const s=t(6231),o=t(1713),u={};function l(m){const g=(function(){if(typeof document>"u"){if(typeof OffscreenCanvas>"u")throw new TypeError("failed to create canvas: OffscreenCanvas is not supported");return new OffscreenCanvas(1,1)}const i=document.createElement("canvas");return i.width=1,i.height=1,i})();let h;const f={alpha:!1,depth:!1,antialias:!1,stencil:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!1,failIfMajorPerformanceCaveat:!1};if((!m||m==="webgl2")&&(h=g.getContext("webgl2",f),h))try{return new o.WebGLContext(h,2)}catch(i){s.Logger.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl2'. Error: ${i}`)}if((!m||m==="webgl")&&(h=g.getContext("webgl",f)||g.getContext("experimental-webgl",f),h))try{return new o.WebGLContext(h,1)}catch(i){s.Logger.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl' or 'experimental-webgl'. Error: ${i}`)}throw new Error("WebGL is not supported")}e.createWebGLContext=function m(g){let h;g&&g!=="webgl2"||!("webgl2"in u)?g&&g!=="webgl"||!("webgl"in u)||(h=u.webgl):h=u.webgl2,h=h||l(g),g=g||h.version===1?"webgl":"webgl2";const f=h.gl;return u[g]=h,f.isContextLost()?(delete u[g],m(g)):(f.disable(f.DEPTH_TEST),f.disable(f.STENCIL_TEST),f.disable(f.BLEND),f.disable(f.DITHER),f.disable(f.POLYGON_OFFSET_FILL),f.disable(f.SAMPLE_COVERAGE),f.enable(f.SCISSOR_TEST),f.enable(f.CULL_FACE),f.cullFace(f.BACK),h)},e.createNewWebGLContext=l},1713:function(n,e,t){var s=this&&this.__createBinding||(Object.create?function(f,i,r,d){d===void 0&&(d=r);var p=Object.getOwnPropertyDescriptor(i,r);p&&!("get"in p?!i.__esModule:p.writable||p.configurable)||(p={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(f,d,p)}:function(f,i,r,d){d===void 0&&(d=r),f[d]=i[r]}),o=this&&this.__setModuleDefault||(Object.create?function(f,i){Object.defineProperty(f,"default",{enumerable:!0,value:i})}:function(f,i){f.default=i}),u=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var i={};if(f!=null)for(var r in f)r!=="default"&&Object.prototype.hasOwnProperty.call(f,r)&&s(i,f,r);return o(i,f),i};Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLContext=e.linearSearchLastTrue=void 0;const l=t(1670),m=u(t(7769)),g=t(9390);function h(f){let i=0;for(;i<f.length&&f[i]();++i);return i-1}e.linearSearchLastTrue=h,e.WebGLContext=class{constructor(f,i){this.frameBufferBound=!1,this.itemsToPoll=[],this.gl=f,this.version=i,this.getExtensions(),this.vertexbuffer=this.createVertexbuffer(),this.framebuffer=this.createFramebuffer(),this.queryVitalParameters()}allocateTexture(f,i,r,d){const p=this.gl,_=p.createTexture();p.bindTexture(p.TEXTURE_2D,_),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);const y=d?r.encode(d,f*i):null;return p.texImage2D(p.TEXTURE_2D,0,r.internalFormat,f,i,0,r.format,r.textureType,y),this.checkError(),_}updateTexture(f,i,r,d,p){const _=this.gl;_.bindTexture(_.TEXTURE_2D,f);const y=d.encode(p,i*r);_.texSubImage2D(_.TEXTURE_2D,0,0,0,i,r,d.format,d.textureType,y),this.checkError()}attachFramebuffer(f,i,r){const d=this.gl;d.bindTexture(d.TEXTURE_2D,f),d.bindFramebuffer(d.FRAMEBUFFER,this.framebuffer),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,f,0),this.checkError(),d.viewport(0,0,i,r),d.scissor(0,0,i,r)}readTexture(f,i,r,d,p,_){const y=this.gl;_||(_=1),this.frameBufferBound||this.attachFramebuffer(f,i,r);const v=this.getEncoder(p,_),T=v.allocate(i*r);return y.bindTexture(y.TEXTURE_2D,f),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,f,0),y.readPixels(0,0,i,r,y.RGBA,v.textureType,T),this.checkError(),v.decode(T,d)}isFramebufferReady(){return!0}getActiveTexture(){const f=this.gl;return"TEXTURE"+(f.getParameter(this.gl.ACTIVE_TEXTURE)-f.TEXTURE0)}getTextureBinding(){return this.gl.getParameter(this.gl.TEXTURE_BINDING_2D)}getFramebufferBinding(){return this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING)}setVertexAttributes(f,i){const r=this.gl;r.vertexAttribPointer(f,3,r.FLOAT,!1,20,0),r.enableVertexAttribArray(f),i!==-1&&(r.vertexAttribPointer(i,2,r.FLOAT,!1,20,12),r.enableVertexAttribArray(i)),this.checkError()}createProgram(f,i){const r=this.gl,d=r.createProgram();return r.attachShader(d,f),r.attachShader(d,i),r.linkProgram(d),d}compileShader(f,i){const r=this.gl,d=r.createShader(i);if(!d)throw new Error(`createShader() returned null with type ${i}`);if(r.shaderSource(d,f),r.compileShader(d),r.getShaderParameter(d,r.COMPILE_STATUS)===!1)throw new Error(`Failed to compile shader: ${r.getShaderInfoLog(d)}
Shader source:
${f}`);return d}deleteShader(f){this.gl.deleteShader(f)}bindTextureToUniform(f,i,r){const d=this.gl;d.activeTexture(d.TEXTURE0+i),this.checkError(),d.bindTexture(d.TEXTURE_2D,f),this.checkError(),d.uniform1i(r,i),this.checkError()}draw(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.checkError()}checkError(){if(l.env.debug){const f=this.gl,i=f.getError();let r="";switch(i){case f.NO_ERROR:return;case f.INVALID_ENUM:r="INVALID_ENUM";break;case f.INVALID_VALUE:r="INVALID_VALUE";break;case f.INVALID_OPERATION:r="INVALID_OPERATION";break;case f.INVALID_FRAMEBUFFER_OPERATION:r="INVALID_FRAMEBUFFER_OPERATION";break;case f.OUT_OF_MEMORY:r="OUT_OF_MEMORY";break;case f.CONTEXT_LOST_WEBGL:r="CONTEXT_LOST_WEBGL";break;default:r=`Unknown WebGL Error: ${i.toString(16)}`}throw new Error(r)}}deleteTexture(f){this.gl.deleteTexture(f)}deleteProgram(f){this.gl.deleteProgram(f)}getEncoder(f,i,r=0){if(this.version===2)return new m.RedFloat32DataEncoder(this.gl,i);switch(f){case"float":return r===1||this.isRenderFloat32Supported?new m.RGBAFloatDataEncoder(this.gl,i):new m.RGBAFloatDataEncoder(this.gl,i,this.textureHalfFloatExtension.HALF_FLOAT_OES);case"int":throw new Error("not implemented");case"byte":return new m.Uint8DataEncoder(this.gl,i);default:throw new Error(`Invalid dataType: ${f}`)}}clearActiveTextures(){const f=this.gl;for(let i=0;i<this.maxTextureImageUnits;++i)f.activeTexture(f.TEXTURE0+i),f.bindTexture(f.TEXTURE_2D,null)}dispose(){if(this.disposed)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,null),f.deleteFramebuffer(this.framebuffer),f.bindBuffer(f.ARRAY_BUFFER,null),f.deleteBuffer(this.vertexbuffer),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,null),f.finish(),this.disposed=!0}createDefaultGeometry(){return new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0])}createVertexbuffer(){const f=this.gl,i=f.createBuffer();if(!i)throw new Error("createBuffer() returned null");const r=this.createDefaultGeometry();return f.bindBuffer(f.ARRAY_BUFFER,i),f.bufferData(f.ARRAY_BUFFER,r,f.STATIC_DRAW),this.checkError(),i}createFramebuffer(){const f=this.gl.createFramebuffer();if(!f)throw new Error("createFramebuffer returned null");return f}queryVitalParameters(){const f=this.gl;if(this.isFloatTextureAttachableToFrameBuffer=this.checkFloatTextureAttachableToFrameBuffer(),this.isRenderFloat32Supported=this.checkRenderFloat32(),this.isFloat32DownloadSupported=this.checkFloat32Download(),this.version===1&&!this.textureHalfFloatExtension&&!this.isRenderFloat32Supported)throw new Error("both float32 and float16 TextureType are not supported");this.isBlendSupported=!this.isRenderFloat32Supported||this.checkFloat32Blend(),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE),this.maxTextureImageUnits=f.getParameter(f.MAX_TEXTURE_IMAGE_UNITS),this.version}getExtensions(){this.version===2?(this.colorBufferFloatExtension=this.gl.getExtension("EXT_color_buffer_float"),this.disjointTimerQueryWebgl2Extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")):(this.textureFloatExtension=this.gl.getExtension("OES_texture_float"),this.textureHalfFloatExtension=this.gl.getExtension("OES_texture_half_float"))}checkFloatTextureAttachableToFrameBuffer(){const f=this.gl,i=f.createTexture();f.bindTexture(f.TEXTURE_2D,i);const r=this.version===2?f.RGBA32F:f.RGBA;f.texImage2D(f.TEXTURE_2D,0,r,1,1,0,f.RGBA,f.FLOAT,null);const d=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,d),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,i,0);const p=f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE;return f.bindTexture(f.TEXTURE_2D,null),f.bindFramebuffer(f.FRAMEBUFFER,null),f.deleteTexture(i),f.deleteFramebuffer(d),p}checkRenderFloat32(){if(this.version===2){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension)return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Download(){if(this.version===2){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension||!this.gl.getExtension("WEBGL_color_buffer_float"))return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Blend(){const f=this.gl;let i,r,d,p,_;try{i=f.createTexture(),r=f.createFramebuffer(),f.bindTexture(f.TEXTURE_2D,i);const y=this.version===2?f.RGBA32F:f.RGBA;return f.texImage2D(f.TEXTURE_2D,0,y,1,1,0,f.RGBA,f.FLOAT,null),f.bindFramebuffer(f.FRAMEBUFFER,r),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,i,0),f.enable(f.BLEND),d=f.createShader(f.VERTEX_SHADER),!!d&&(f.shaderSource(d,"void main(){}"),f.compileShader(d),p=f.createShader(f.FRAGMENT_SHADER),!!p&&(f.shaderSource(p,"precision highp float;void main(){gl_FragColor=vec4(0.5);}"),f.compileShader(p),_=f.createProgram(),!!_&&(f.attachShader(_,d),f.attachShader(_,p),f.linkProgram(_),f.useProgram(_),f.drawArrays(f.POINTS,0,1),f.getError()===f.NO_ERROR)))}finally{f.disable(f.BLEND),_&&f.deleteProgram(_),d&&f.deleteShader(d),p&&f.deleteShader(p),r&&(f.bindFramebuffer(f.FRAMEBUFFER,null),f.deleteFramebuffer(r)),i&&(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(i))}}beginTimer(){if(this.version===2&&this.disjointTimerQueryWebgl2Extension){const f=this.gl,i=this.disjointTimerQueryWebgl2Extension,r=f.createQuery();return f.beginQuery(i.TIME_ELAPSED_EXT,r),r}throw new Error("WebGL1 profiling currently not supported.")}endTimer(){if(this.version!==2||!this.disjointTimerQueryWebgl2Extension)throw new Error("WebGL1 profiling currently not supported");{const f=this.gl,i=this.disjointTimerQueryWebgl2Extension;f.endQuery(i.TIME_ELAPSED_EXT)}}isTimerResultAvailable(f){let i=!1,r=!1;if(this.version!==2||!this.disjointTimerQueryWebgl2Extension)throw new Error("WebGL1 profiling currently not supported");{const d=this.gl,p=this.disjointTimerQueryWebgl2Extension;i=d.getQueryParameter(f,d.QUERY_RESULT_AVAILABLE),r=d.getParameter(p.GPU_DISJOINT_EXT)}return i&&!r}getTimerResult(f){let i=0;if(this.version!==2)throw new Error("WebGL1 profiling currently not supported");{const r=this.gl;i=r.getQueryParameter(f,r.QUERY_RESULT),r.deleteQuery(f)}return i/1e6}async waitForQueryAndGetTime(f){return await(0,g.repeatedTry)((()=>this.isTimerResultAvailable(f))),this.getTimerResult(f)}async createAndWaitForFence(){const f=this.createFence(this.gl);return this.pollFence(f)}createFence(f){let i;const r=f,d=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);return f.flush(),i=d===null?()=>!0:()=>{const p=r.clientWaitSync(d,0,0);return p===r.ALREADY_SIGNALED||p===r.CONDITION_SATISFIED},{query:d,isFencePassed:i}}async pollFence(f){return new Promise((i=>{this.addItemToPoll((()=>f.isFencePassed()),(()=>i()))}))}pollItems(){const f=h(this.itemsToPoll.map((i=>i.isDoneFn)));for(let i=0;i<=f;++i){const{resolveFn:r}=this.itemsToPoll[i];r()}this.itemsToPoll=this.itemsToPoll.slice(f+1)}async addItemToPoll(f,i){this.itemsToPoll.push({isDoneFn:f,resolveFn:i}),this.itemsToPoll.length>1||await(0,g.repeatedTry)((()=>(this.pollItems(),this.itemsToPoll.length===0)))}}},1036:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExecutionPlan=void 0;const s=t(6231);class o{constructor(l,m){this.op=l,this.node=m}}e.ExecutionPlan=class{constructor(u,l,m){this.graph=u,this.profiler=m,this.initialize(l)}initialize(u){this.profiler.event("session","ExecutionPlan.initialize",(()=>{const l=this.graph.getNodes();if(l.length!==u.length)throw new Error("The size of nodes and OPs do not match.");this._ops=u.map(((m,g)=>new o(m,l[g]))),this.reset(),this._starter=[],this._ops.forEach(((m,g)=>{let h=!0;for(const f of m.node.inputs)if(!this._values[f]&&this.graph.getInputIndices().indexOf(f)===-1){h=!1;break}h&&this._starter.push(g)}))}))}reset(){this._values=this.graph.getValues().map((u=>u.tensor))}async execute(u,l){return this.profiler.event("session","ExecutionPlan.execute",(async()=>{this.reset();const m=u.createInferenceHandler(),g=this.graph.getInputIndices();if(l.length!==g.length)throw new Error(`number of input tensors don't match the number of inputs to the model: actual: ${l.length} expected: ${g.length}`);l.forEach(((p,_)=>{const y=g[_];this._values[y]=p}));const h=this._starter.slice(0),f=this.graph.getValues(),i=this.graph.getNodes();let r=0;for(;r<h.length;){const p=h[r++],_=this._ops[p],y=_.node.inputs.map((E=>this._values[E]));if(y.indexOf(void 0)!==-1)throw new Error(`unresolved input detected: op: ${_.node}`);const v=y;s.Logger.verbose("ExecPlan",`Runing op:${_.node.name} (${v.map(((E,P)=>`'${_.node.inputs[P]}': ${E.type}[${E.dims.join(",")}]`)).join(", ")})`);const T=await this.profiler.event("node",_.node.name,(async()=>_.op.impl(m,v,_.op.context)));if(T.length!==_.node.outputs.length)throw new Error("the size of output does not match model definition.");T.forEach(((E,P)=>{const R=_.node.outputs[P];if(this._values[R])throw new Error(`output [${R}] already has value: op:${_.node.name}`);this._values[R]=E}));const w=new Set;T.forEach(((E,P)=>{const R=_.node.outputs[P];for(const I of f[R].to){const N=i[I];let B=!0;for(const D of N.inputs)if(!this._values[D]){B=!1;break}B&&w.add(I)}})),h.push(...w)}const d=[];for(let p=0;p<this.graph.getOutputIndices().length;p++){const _=this.graph.getOutputIndices()[p],y=this._values[_];if(y===void 0)throw new Error(`required output [${_}] does not have value`);_===0?await y.getData():y.data,d.push(y)}return s.Logger.verbose("ExecPlan","disposing of inferenceHandler"),m.dispose(),d}))}}},7070:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Graph=void 0;const s=t(1446),o=t(7778),u=t(9395),l=t(9162),m=t(2517);var g=u.onnxruntime.experimental.fbs;e.Graph={from:(r,d)=>new i(r,d)};class h{constructor(d){this._from=void 0,this._to=[],this.tensor=void 0,this.type=void 0,d&&(this.type=m.ProtoUtil.tensorValueTypeFromProto(d.type.tensorType))}get from(){return this._from}get to(){return this._to}}class f{constructor(d,p){d instanceof s.onnx.NodeProto?(this.name=d.name,this.opType=d.opType,this.attributes=new o.Attribute(d.attribute)):d instanceof g.Node&&(this.name=p??d.name(),this.opType=d.opType(),this.attributes=new o.Attribute(m.ProtoUtil.tensorAttributesFromORTFormat(d))),this.inputs=[],this.outputs=[],this.executeNode=!0}}class i{constructor(d,p){if(!d)throw new TypeError("graph is empty");this.buildGraph(d),this.transformGraph(p),this.checkIsAcyclic()}getInputIndices(){return this._allInputIndices}getInputNames(){return this._allInputNames}getOutputIndices(){return this._allOutputIndices}getOutputNames(){return this._allOutputNames}getValues(){return this._allData}getNodes(){return this._nodes}buildGraph(d){if(d instanceof s.onnx.GraphProto)this.buildGraphFromOnnxFormat(d);else{if(!(d instanceof g.Graph))throw new TypeError("Graph type is not supported.");this.buildGraphFromOrtFormat(d)}}buildGraphFromOnnxFormat(d){const p=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];const _=new Map;if(!d.input)throw new Error("missing information in graph: input");const y=[];for(const v of d.input){if(p.has(v.name))throw new Error(`duplicated input name: ${v.name}`);const T=this._allData.push(new h(v))-1;p.set(v.name,T),y.push(v.name)}if(!d.initializer)throw new Error("missing information in graph: initializer");for(const v of d.initializer){let T=p.get(v.name);if(T===void 0){const w=new h;w.type={shape:{dims:m.ProtoUtil.tensorDimsFromProto(v.dims)},tensorType:m.ProtoUtil.tensorDataTypeFromProto(v.dataType)},T=this._allData.push(w)-1,p.set(v.name,T)}this._allData[T]._from=-1,this._allData[T].tensor=l.Tensor.fromProto(v)}for(let v=0;v<this._allData.length;v++)this._allData[v].tensor||(this._allInputIndices.push(v),this._allInputNames.push(y[v]));if(!d.output)throw new Error("missing information in graph: output");for(const v of d.output){if(p.has(v.name))throw new Error(`duplicated output name: ${v.name}`);const T=this._allData.push(new h(v))-1;p.set(v.name,T),this._allOutputIndices.push(T),this._allOutputNames.push(v.name)}if(!d.node)throw new Error("missing information in graph: node");for(const v of d.node){if(!v.name)for(let w=0;;w++){const E=`unnamed_${v.opType}_${w}`;if(!_.has(E)){v.name=E;break}}if(_.has(v.name))throw new Error(`duplicated node name: ${v.name}`);const T=this._nodes.push(new f(v))-1;_.set(v.name,T)}for(let v=0;v<this._nodes.length;v++){const T=this._nodes[v],w=d.node[v];if(!w.output)throw new Error(`missing output for node: ${w.name}`);for(const E of w.output){let P=p.get(E);if(P===void 0&&(P=this._allData.push(new h)-1,p.set(E,P)),T.outputs.push(P),this._allData[P]._from!==void 0)throw new Error(`multiple nodes output to one data value: ${P}`);if(this._allData[P]._from=v,w.opType==="Constant"){if(!w.attribute||w.attribute.length!==1||!w.attribute[0].t)throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(!w.output||w.output.length!==1)throw new Error("missing output or incorrect number of outputs for this Constant operator");T.outputs.pop(),T.executeNode=!1,this._allData[P]._from=-1,this._allData[P].tensor=l.Tensor.fromProto(w.attribute[0].t)}}}for(let v=0;v<this._nodes.length;v++){const T=this._nodes[v],w=d.node[v];if(!w.input)throw new Error(`missing input for node: ${w.name}`);for(const E of w.input){const P=p.get(E);if(P===void 0){if(E===""&&w.input.length===3&&w.opType==="Resize")continue;throw new Error(`unrecognized input '${E}' for node: ${w.name}`)}T.inputs.push(P),this._allData[P]._to.push(v)}}return!0}buildGraphFromOrtFormat(d){var p,_,y;const v=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];const T=new Map,w=[];for(let E=0;E<d.inputsLength();E++){const P=d.inputs(E);if(v.has(P))throw new Error(`duplicated input name: ${P}`);for(let R=0;R<d.nodeArgsLength();R++)if(((p=d.nodeArgs(R))===null||p===void 0?void 0:p.name())===P){const I=new h;if(((y=(_=d.nodeArgs(R))===null||_===void 0?void 0:_.type())===null||y===void 0?void 0:y.valueType())!==g.TypeInfoValue.tensor_type)throw new Error("Unexpected value type for the nodeArg.");const N=d.nodeArgs(R).type().value(new g.TensorTypeAndShape),B=m.ProtoUtil.tensorDataTypeFromProto(N.elemType()),D=N.shape(),Y=[];for(let re=0;re<D.dimLength();re++)Y.push(m.LongUtil.longToNumber(D.dim(re).value().dimValue()));I.type={shape:{dims:Y},tensorType:B};const se=this._allData.push(I)-1;v.set(P,se),w.push(P)}}for(let E=0;E<d.initializersLength();E++){const P=d.initializers(E);let R=v.get(P.name());if(R===void 0){const I=new h,N=m.ProtoUtil.tensorDimsFromORTFormat(P),B=m.ProtoUtil.tensorDataTypeFromProto(P.dataType());I.type={shape:{dims:N},tensorType:B},R=this._allData.push(I)-1,v.set(P.name(),R)}this._allData[R]._from=-1,this._allData[R].tensor=l.Tensor.fromOrtTensor(P)}for(let E=0;E<this._allData.length;E++)this._allData[E].tensor||(this._allInputIndices.push(E),this._allInputNames.push(w[E]));for(let E=0;E<d.outputsLength();E++){const P=d.outputs(E);if(v.has(P))throw new Error(`duplicated output name: ${P}`);const R=this._allData.push(new h)-1;v.set(P,R),this._allOutputIndices.push(R),this._allOutputNames.push(P)}if(!d.nodes)throw new Error("missing information in graph: node");for(let E=0;E<d.nodesLength();E++){const P=d.nodes(E);let R=P.name();if(!R)for(let N=0;R=`unnamed_${P.opType()}_${N}`,T.has(R);N++);if(T.has(R))throw new Error(`duplicated node name: ${R}`);const I=this._nodes.push(new f(P,R))-1;T.set(R,I)}for(let E=0;E<this._nodes.length;E++){const P=this._nodes[E],R=d.nodes(E);if(R==null)throw new Error(`No node exists at index ${E}`);if(R?.outputsLength()===0)throw new Error(`missing output for node: ${R.name}`);for(let I=0;I<R?.outputsLength();I++){const N=R?.outputs(I);let B=v.get(N);if(B===void 0&&(B=this._allData.push(new h)-1,v.set(N,B)),P.outputs.push(B),this._allData[B]._from!==void 0)throw new Error(`multiple nodes output to one data value: ${B}`);if(this._allData[B]._from=E,R.opType()==="Constant"){if(R.attributesLength()!==1||!R.attributes(0).t())throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(R.outputsLength()!==1)throw new Error("missing output or incorrect number of outputs for this Constant operator");P.outputs.pop(),P.executeNode=!1,this._allData[B]._from=-1,this._allData[B].tensor=l.Tensor.fromOrtTensor(R.attributes(0).t())}}}for(let E=0;E<this._nodes.length;E++){const P=this._nodes[E],R=d.nodes(E);if(R.inputsLength()===0)throw new Error(`missing input for node: ${R.name}`);for(let I=0;I<R.inputsLength();I++){const N=R.inputs(I),B=v.get(N);if(B===void 0)throw new Error(`unrecognized input '${N}' for node: ${R.name()}`);P.inputs.push(B),this._allData[B]._to.push(E)}}}checkIsAcyclic(){const d=new Set;this._allInputIndices.forEach((y=>{this._allData[y]._to.forEach((v=>{d.add(v)}))}));const p=Array.from(d),_=new Array(this._nodes.length).fill("white");for(;p.length>0;){const y=p.pop();_[y]==="gray"?_[y]="black":(p.push(y),_[y]="gray",this._nodes[y].outputs.forEach((v=>{const T=this._allData[v];if(T.tensor!==void 0)throw new Error("node outputs should not be initialized");if(T._from!==y)throw new Error("from property of the Value object doesn't match index of Node being processed");T._to.forEach((w=>{if(_[w]==="gray")throw new Error("model graph is cyclic");_[w]==="white"&&p.push(w)}))})))}}transformGraph(d){this.removeAllIdentityNodes(),this.removeAllDropoutNodes(),this.fuseConvActivationNodes(),d&&d.transformGraph(this),this.finalizeGraph()}finalizeGraph(){let d=0;for(let p=0;p<this._nodes.length;p++)this._nodes[p].executeNode?d>0&&(this._nodes[p].inputs.forEach((_=>{const y=this._allData[_]._to.indexOf(p+d);y!==-1&&(this._allData[_]._to[y]=p)})),this._nodes[p].outputs.forEach((_=>{this._allData[_]._from&&this._allData[_]._from===p+d&&(this._allData[_]._from=p)}))):(d++,this._nodes[p].outputs.forEach((_=>{this._allData[_]._from=-2})),this._nodes.splice(p,1),p--);d=0;for(let p=0;p<this._allData.length;p++)if(this._allData[p].from!==-2||this._allOutputIndices.indexOf(p+d)!==-1){if(d>0){let _=-1;this._allData[p].from!==void 0&&this._allData[p].from!==-1?(_=this._nodes[this._allData[p].from].outputs.indexOf(p+d),_!==-1&&(this._nodes[this._allData[p].from].outputs[_]=p)):(_=this._allInputIndices.indexOf(p+d),_!==-1&&(this._allInputIndices[_]=p)),this._allData[p].to.forEach((y=>{_=this._nodes[y].inputs.indexOf(p+d),_!==-1&&(this._nodes[y].inputs[_]=p)})),this._allData[p].to.length===0&&(_=this._allOutputIndices.indexOf(p+d),_!==-1&&(this._allOutputIndices[_]=p))}}else d++,this._allData.splice(p,1),p--}deleteNode(d){const p=this._nodes[d];if(p.outputs.length>1){for(let E=1;E<p.outputs.length;E++)if(this._allData[p.outputs[E]].to.length>0)throw new Error("Node deletion with more than one output connected to other nodes is not supported. ")}p.executeNode=!1;const _=p.inputs[0],y=p.outputs[0],v=this._allData[y].to,T=this._allData[_].to.indexOf(d);if(T===-1)throw new Error("The Value object doesn't have the current Node in it's 'to' property ");this._allData[_].to.splice(T,1),this._allData[y]._to=[];const w=this._allOutputIndices.indexOf(y);if(w!==-1&&(this._allOutputIndices[w]=_),v&&v.length>0)for(const E of v){const P=this._nodes[E].inputs.indexOf(y);if(P===-1)throw new Error("The Node object doesn't have the output Value in it's 'inputs' property ");this._nodes[E].inputs[P]=_,this._allData[_].to.push(E)}}removeAllDropoutNodes(){let d=0;for(const p of this._nodes){if(p.opType==="Dropout"){if(p.inputs.length!==1)throw new Error("Dropout nodes should only contain one input. ");if(p.outputs.length!==1&&p.outputs.length!==2)throw new Error("Dropout nodes should contain either 1 or 2 output(s)");if(p.outputs.length===2&&this._allData[p.outputs[1]]._to.length!==0)throw new Error("Dropout nodes's second output should not be referenced by other nodes");this.deleteNode(d)}d++}}removeAllIdentityNodes(){let d=0;for(const p of this._nodes)p.opType==="Identity"&&this.deleteNode(d),d++}isActivation(d){switch(d.opType){case"Relu":case"Sigmoid":case"Clip":return!0;default:return!1}}fuseConvActivationNodes(){for(const d of this._nodes)if(d.opType==="Conv"){const p=this._allData[d.outputs[0]]._to;if(p.length===1&&this.isActivation(this._nodes[p[0]])){const _=this._nodes[p[0]];if(_.opType==="Clip")if(_.inputs.length===1)try{d.attributes.set("activation_params","floats",[_.attributes.getFloat("min"),_.attributes.getFloat("max")])}catch{d.attributes.set("activation_params","floats",[m.MIN_CLIP,m.MAX_CLIP])}else{if(!(_.inputs.length>=3&&this._allData[_.inputs[1]].tensor!==void 0&&this._allData[_.inputs[2]].tensor!==void 0))continue;d.attributes.set("activation_params","floats",[this._allData[_.inputs[1]].tensor.floatData[0],this._allData[_.inputs[2]].tensor.floatData[0]])}d.attributes.set("activation","string",_.opType),this.deleteNode(p[0])}}}}},6231:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.now=e.Profiler=e.Logger=void 0;const t={verbose:1e3,info:2e3,warning:4e3,error:5e3,fatal:6e3},s={none:new class{log(f,i,r){}},console:new class{log(f,i,r){console.log(`${this.color(f)} ${r?"\x1B[35m"+r+"\x1B[0m ":""}${i}`)}color(f){switch(f){case"verbose":return"\x1B[34;40mv\x1B[0m";case"info":return"\x1B[32mi\x1B[0m";case"warning":return"\x1B[30;43mw\x1B[0m";case"error":return"\x1B[31;40me\x1B[0m";case"fatal":return"\x1B[101mf\x1B[0m";default:throw new Error(`unsupported severity: ${f}`)}}}},o={provider:"console",minimalSeverity:"warning",logDateTime:!0,logSourceLocation:!1};let u={"":o};function l(f,i,r,d){if(i===void 0)return p=f,{verbose:l.verbose.bind(null,p),info:l.info.bind(null,p),warning:l.warning.bind(null,p),error:l.error.bind(null,p),fatal:l.fatal.bind(null,p)};if(r===void 0)m(f,i);else if(typeof r=="number"&&d===void 0)m(f,i);else if(typeof r=="string"&&d===void 0)m(f,r,0,i);else{if(typeof r!="string"||typeof d!="number")throw new TypeError("input is valid");m(f,r,0,i)}var p}function m(f,i,r,d){const p=u[d||""]||u[""];t[f]<t[p.minimalSeverity]||(p.logDateTime&&(i=`${new Date().toISOString()}|${i}`),p.logSourceLocation,s[p.provider].log(f,i,d))}(function(f){function i(d){u={},r("",d||{})}function r(d,p){if(d==="*")i(p);else{const _=u[d]||o;u[d]={provider:p.provider||_.provider,minimalSeverity:p.minimalSeverity||_.minimalSeverity,logDateTime:p.logDateTime===void 0?_.logDateTime:p.logDateTime,logSourceLocation:p.logSourceLocation===void 0?_.logSourceLocation:p.logSourceLocation}}}f.verbose=function(d,p){f("verbose",d,p)},f.info=function(d,p){f("info",d,p)},f.warning=function(d,p){f("warning",d,p)},f.error=function(d,p){f("error",d,p)},f.fatal=function(d,p){f("fatal",d,p)},f.reset=i,f.set=r,f.setWithEnv=function(d){const p={};d.logLevel&&(p.minimalSeverity=d.logLevel),r("",p)}})(l||(l={})),e.Logger=l;class g{constructor(i,r,d,p,_,y){this.category=i,this.name=r,this.startTime=d,this.endCallback=p,this.timer=_,this.ctx=y}end(){return this.endCallback(this)}async checkTimer(){if(this.ctx===void 0||this.timer===void 0)throw new Error("No webgl timer found");return this.ctx.endTimer(),this.ctx.waitForQueryAndGetTime(this.timer)}}class h{constructor(i,r,d,p){this.category=i,this.name=r,this.startTime=d,this.endTime=p}}e.Profiler=class{static create(f){return f===void 0?new this:new this(f.maxNumberEvents,f.flushBatchSize,f.flushIntervalInMilliseconds)}constructor(f,i,r){this._started=!1,this._flushPointer=0,this._started=!1,this._maxNumberEvents=f===void 0?1e4:f,this._flushBatchSize=i===void 0?10:i,this._flushIntervalInMilliseconds=r===void 0?5e3:r}start(){this._started=!0,this._timingEvents=[],this._flushTime=(0,e.now)(),this._flushPointer=0}stop(){for(this._started=!1;this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer])}event(f,i,r,d){const p=this._started?this.begin(f,i,d):void 0;let _=!1;const y=r();if(y&&typeof y.then=="function")return _=!0,new Promise(((v,T)=>{y.then((async w=>{p&&await p.end(),v(w)}),(async w=>{p&&await p.end(),T(w)}))}));if(!_&&p){const v=p.end();if(v&&typeof v.then=="function")return new Promise(((T,w)=>{v.then((()=>{T(y)}),(E=>{w(E)}))}))}return y}begin(f,i,r){if(!this._started)throw new Error("profiler is not started yet");if(r===void 0){const d=(0,e.now)();return this.flush(d),new g(f,i,d,(p=>this.endSync(p)))}{const d=r.beginTimer();return new g(f,i,0,(async p=>this.end(p)),d,r)}}async end(f){const i=await f.checkTimer();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new h(f.category,f.name,f.startTime,i)),this.flush(i))}endSync(f){const i=(0,e.now)();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new h(f.category,f.name,f.startTime,i)),this.flush(i))}logOneEvent(f){e.Logger.verbose(`Profiler.${f.category}`,`${(f.endTime-f.startTime).toFixed(2)}ms on event '${f.name}' at ${f.endTime.toFixed(2)}`)}flush(f){if(this._timingEvents.length-this._flushPointer>=this._flushBatchSize||f-this._flushTime>=this._flushIntervalInMilliseconds){for(const i=this._flushPointer;this._flushPointer<i+this._flushBatchSize&&this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer]);this._flushTime=(0,e.now)()}}get started(){return this._started}},e.now=typeof performance<"u"&&performance.now?()=>performance.now():Date.now},2644:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Model=void 0;const s=t(5686),o=t(1446),u=t(7070),l=t(9395),m=t(2517);var g=l.onnxruntime.experimental.fbs;e.Model=class{constructor(){}load(h,f,i){if(!i)try{return void this.loadFromOnnxFormat(h,f)}catch(r){if(i!==void 0)throw r}this.loadFromOrtFormat(h,f)}loadFromOnnxFormat(h,f){const i=o.onnx.ModelProto.decode(h);if(m.LongUtil.longToNumber(i.irVersion)<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=i.opsetImport.map((r=>({domain:r.domain,version:m.LongUtil.longToNumber(r.version)}))),this._graph=u.Graph.from(i.graph,f)}loadFromOrtFormat(h,f){const i=new s.flatbuffers.ByteBuffer(h),r=g.InferenceSession.getRootAsInferenceSession(i).model();if(m.LongUtil.longToNumber(r.irVersion())<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=[];for(let d=0;d<r.opsetImportLength();d++){const p=r.opsetImport(d);this._opsets.push({domain:p?.domain(),version:m.LongUtil.longToNumber(p.version())})}this._graph=u.Graph.from(r.graph(),f)}get graph(){return this._graph}get opsets(){return this._opsets}}},782:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FLOAT_TYPES=e.INT_TYPES=e.NUMBER_TYPES=void 0,e.NUMBER_TYPES=["float32","float64","int32","int16","int8","uint16","uint32","uint8"],e.INT_TYPES=["int32","int16","int8","uint16","uint32","uint8"],e.FLOAT_TYPES=["float32","float64"]},1047:(n,e)=>{function t(s,o){if(o.endsWith("+")){const u=Number.parseInt(o.substring(0,o.length-1),10);return!isNaN(u)&&u<=s}if(o.split("-").length===2){const u=o.split("-"),l=Number.parseInt(u[0],10),m=Number.parseInt(u[1],10);return!isNaN(l)&&!isNaN(m)&&l<=s&&s<=m}return Number.parseInt(o,10)===s}Object.defineProperty(e,"__esModule",{value:!0}),e.resolveOperator=void 0,e.resolveOperator=function(s,o,u){for(const l of u){const m=l[0],g=l[1],h=l[2],f=l[3],i=l[4];if(s.opType===m){for(const r of o)if((r.domain===g||r.domain==="ai.onnx"&&g==="")&&t(r.version,h))return{opImpl:f,opInit:i}}}throw new TypeError(`cannot resolve operator '${s.opType}' with opsets: ${o.map((l=>`${l.domain||"ai.onnx"} v${l.version}`)).join(", ")}`)}},9395:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.onnxruntime=void 0;const s=t(5686);var o,u;o=e.onnxruntime||(e.onnxruntime={}),(function(l){(function(m){m[m.UNDEFINED=0]="UNDEFINED",m[m.FLOAT=1]="FLOAT",m[m.INT=2]="INT",m[m.STRING=3]="STRING",m[m.TENSOR=4]="TENSOR",m[m.GRAPH=5]="GRAPH",m[m.FLOATS=6]="FLOATS",m[m.INTS=7]="INTS",m[m.STRINGS=8]="STRINGS",m[m.TENSORS=9]="TENSORS",m[m.GRAPHS=10]="GRAPHS",m[m.SPARSE_TENSOR=11]="SPARSE_TENSOR",m[m.SPARSE_TENSORS=12]="SPARSE_TENSORS"})(l.AttributeType||(l.AttributeType={}))})((u=o.experimental||(o.experimental={})).fbs||(u.fbs={})),(function(l){(function(m){(function(g){(function(h){h[h.UNKNOWN=0]="UNKNOWN",h[h.VALUE=1]="VALUE",h[h.PARAM=2]="PARAM"})(g.DimensionValueType||(g.DimensionValueType={}))})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){(function(h){h[h.UNDEFINED=0]="UNDEFINED",h[h.FLOAT=1]="FLOAT",h[h.UINT8=2]="UINT8",h[h.INT8=3]="INT8",h[h.UINT16=4]="UINT16",h[h.INT16=5]="INT16",h[h.INT32=6]="INT32",h[h.INT64=7]="INT64",h[h.STRING=8]="STRING",h[h.BOOL=9]="BOOL",h[h.FLOAT16=10]="FLOAT16",h[h.DOUBLE=11]="DOUBLE",h[h.UINT32=12]="UINT32",h[h.UINT64=13]="UINT64",h[h.COMPLEX64=14]="COMPLEX64",h[h.COMPLEX128=15]="COMPLEX128",h[h.BFLOAT16=16]="BFLOAT16"})(g.TensorDataType||(g.TensorDataType={}))})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){(function(h){h[h.Primitive=0]="Primitive",h[h.Fused=1]="Fused"})(g.NodeType||(g.NodeType={}))})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){(function(h){h[h.NONE=0]="NONE",h[h.tensor_type=1]="tensor_type",h[h.sequence_type=2]="sequence_type",h[h.map_type=3]="map_type"})(g.TypeInfoValue||(g.TypeInfoValue={}))})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsShape(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsShape(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}dim(i,r){let d=this.bb.__offset(this.bb_pos,4);return d?(r||new l.experimental.fbs.Dimension).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+d)+4*i),this.bb):null}dimLength(){let i=this.bb.__offset(this.bb_pos,4);return i?this.bb.__vector_len(this.bb_pos+i):0}static startShape(i){i.startObject(1)}static addDim(i,r){i.addFieldOffset(0,r,0)}static createDimVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startDimVector(i,r){i.startVector(4,r,4)}static endShape(i){return i.endObject()}static createShape(i,r){return h.startShape(i),h.addDim(i,r),h.endShape(i)}}g.Shape=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsDimension(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsDimension(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}value(i){let r=this.bb.__offset(this.bb_pos,4);return r?(i||new l.experimental.fbs.DimensionValue).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}denotation(i){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.__string(this.bb_pos+r,i):null}static startDimension(i){i.startObject(2)}static addValue(i,r){i.addFieldOffset(0,r,0)}static addDenotation(i,r){i.addFieldOffset(1,r,0)}static endDimension(i){return i.endObject()}static createDimension(i,r,d){return h.startDimension(i),h.addValue(i,r),h.addDenotation(i,d),h.endDimension(i)}}g.Dimension=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsDimensionValue(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsDimensionValue(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}dimType(){let i=this.bb.__offset(this.bb_pos,4);return i?this.bb.readInt8(this.bb_pos+i):l.experimental.fbs.DimensionValueType.UNKNOWN}dimValue(){let i=this.bb.__offset(this.bb_pos,6);return i?this.bb.readInt64(this.bb_pos+i):this.bb.createLong(0,0)}dimParam(i){let r=this.bb.__offset(this.bb_pos,8);return r?this.bb.__string(this.bb_pos+r,i):null}static startDimensionValue(i){i.startObject(3)}static addDimType(i,r){i.addFieldInt8(0,r,l.experimental.fbs.DimensionValueType.UNKNOWN)}static addDimValue(i,r){i.addFieldInt64(1,r,i.createLong(0,0))}static addDimParam(i,r){i.addFieldOffset(2,r,0)}static endDimensionValue(i){return i.endObject()}static createDimensionValue(i,r,d,p){return h.startDimensionValue(i),h.addDimType(i,r),h.addDimValue(i,d),h.addDimParam(i,p),h.endDimensionValue(i)}}g.DimensionValue=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsTensorTypeAndShape(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsTensorTypeAndShape(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}elemType(){let i=this.bb.__offset(this.bb_pos,4);return i?this.bb.readInt32(this.bb_pos+i):l.experimental.fbs.TensorDataType.UNDEFINED}shape(i){let r=this.bb.__offset(this.bb_pos,6);return r?(i||new l.experimental.fbs.Shape).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startTensorTypeAndShape(i){i.startObject(2)}static addElemType(i,r){i.addFieldInt32(0,r,l.experimental.fbs.TensorDataType.UNDEFINED)}static addShape(i,r){i.addFieldOffset(1,r,0)}static endTensorTypeAndShape(i){return i.endObject()}static createTensorTypeAndShape(i,r,d){return h.startTensorTypeAndShape(i),h.addElemType(i,r),h.addShape(i,d),h.endTensorTypeAndShape(i)}}g.TensorTypeAndShape=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsMapType(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsMapType(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}keyType(){let i=this.bb.__offset(this.bb_pos,4);return i?this.bb.readInt32(this.bb_pos+i):l.experimental.fbs.TensorDataType.UNDEFINED}valueType(i){let r=this.bb.__offset(this.bb_pos,6);return r?(i||new l.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startMapType(i){i.startObject(2)}static addKeyType(i,r){i.addFieldInt32(0,r,l.experimental.fbs.TensorDataType.UNDEFINED)}static addValueType(i,r){i.addFieldOffset(1,r,0)}static endMapType(i){return i.endObject()}static createMapType(i,r,d){return h.startMapType(i),h.addKeyType(i,r),h.addValueType(i,d),h.endMapType(i)}}g.MapType=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsSequenceType(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsSequenceType(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}elemType(i){let r=this.bb.__offset(this.bb_pos,4);return r?(i||new l.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startSequenceType(i){i.startObject(1)}static addElemType(i,r){i.addFieldOffset(0,r,0)}static endSequenceType(i){return i.endObject()}static createSequenceType(i,r){return h.startSequenceType(i),h.addElemType(i,r),h.endSequenceType(i)}}g.SequenceType=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(m.fbs||(m.fbs={})).EdgeEnd=class{constructor(){this.bb=null,this.bb_pos=0}__init(g,h){return this.bb_pos=g,this.bb=h,this}nodeIndex(){return this.bb.readUint32(this.bb_pos)}srcArgIndex(){return this.bb.readInt32(this.bb_pos+4)}dstArgIndex(){return this.bb.readInt32(this.bb_pos+8)}static createEdgeEnd(g,h,f,i){return g.prep(4,12),g.writeInt32(i),g.writeInt32(f),g.writeInt32(h),g.offset()}}})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsNodeEdge(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsNodeEdge(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}nodeIndex(){let i=this.bb.__offset(this.bb_pos,4);return i?this.bb.readUint32(this.bb_pos+i):0}inputEdges(i,r){let d=this.bb.__offset(this.bb_pos,6);return d?(r||new l.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+d)+12*i,this.bb):null}inputEdgesLength(){let i=this.bb.__offset(this.bb_pos,6);return i?this.bb.__vector_len(this.bb_pos+i):0}outputEdges(i,r){let d=this.bb.__offset(this.bb_pos,8);return d?(r||new l.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+d)+12*i,this.bb):null}outputEdgesLength(){let i=this.bb.__offset(this.bb_pos,8);return i?this.bb.__vector_len(this.bb_pos+i):0}static startNodeEdge(i){i.startObject(3)}static addNodeIndex(i,r){i.addFieldInt32(0,r,0)}static addInputEdges(i,r){i.addFieldOffset(1,r,0)}static startInputEdgesVector(i,r){i.startVector(12,r,4)}static addOutputEdges(i,r){i.addFieldOffset(2,r,0)}static startOutputEdgesVector(i,r){i.startVector(12,r,4)}static endNodeEdge(i){return i.endObject()}static createNodeEdge(i,r,d,p){return h.startNodeEdge(i),h.addNodeIndex(i,r),h.addInputEdges(i,d),h.addOutputEdges(i,p),h.endNodeEdge(i)}}g.NodeEdge=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsNode(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsNode(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}name(i){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,i):null}docString(i){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.__string(this.bb_pos+r,i):null}domain(i){let r=this.bb.__offset(this.bb_pos,8);return r?this.bb.__string(this.bb_pos+r,i):null}sinceVersion(){let i=this.bb.__offset(this.bb_pos,10);return i?this.bb.readInt32(this.bb_pos+i):0}index(){let i=this.bb.__offset(this.bb_pos,12);return i?this.bb.readUint32(this.bb_pos+i):0}opType(i){let r=this.bb.__offset(this.bb_pos,14);return r?this.bb.__string(this.bb_pos+r,i):null}type(){let i=this.bb.__offset(this.bb_pos,16);return i?this.bb.readInt32(this.bb_pos+i):l.experimental.fbs.NodeType.Primitive}executionProviderType(i){let r=this.bb.__offset(this.bb_pos,18);return r?this.bb.__string(this.bb_pos+r,i):null}inputs(i,r){let d=this.bb.__offset(this.bb_pos,20);return d?this.bb.__string(this.bb.__vector(this.bb_pos+d)+4*i,r):null}inputsLength(){let i=this.bb.__offset(this.bb_pos,20);return i?this.bb.__vector_len(this.bb_pos+i):0}outputs(i,r){let d=this.bb.__offset(this.bb_pos,22);return d?this.bb.__string(this.bb.__vector(this.bb_pos+d)+4*i,r):null}outputsLength(){let i=this.bb.__offset(this.bb_pos,22);return i?this.bb.__vector_len(this.bb_pos+i):0}attributes(i,r){let d=this.bb.__offset(this.bb_pos,24);return d?(r||new l.experimental.fbs.Attribute).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+d)+4*i),this.bb):null}attributesLength(){let i=this.bb.__offset(this.bb_pos,24);return i?this.bb.__vector_len(this.bb_pos+i):0}inputArgCounts(i){let r=this.bb.__offset(this.bb_pos,26);return r?this.bb.readInt32(this.bb.__vector(this.bb_pos+r)+4*i):0}inputArgCountsLength(){let i=this.bb.__offset(this.bb_pos,26);return i?this.bb.__vector_len(this.bb_pos+i):0}inputArgCountsArray(){let i=this.bb.__offset(this.bb_pos,26);return i?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+i),this.bb.__vector_len(this.bb_pos+i)):null}implicitInputs(i,r){let d=this.bb.__offset(this.bb_pos,28);return d?this.bb.__string(this.bb.__vector(this.bb_pos+d)+4*i,r):null}implicitInputsLength(){let i=this.bb.__offset(this.bb_pos,28);return i?this.bb.__vector_len(this.bb_pos+i):0}static startNode(i){i.startObject(13)}static addName(i,r){i.addFieldOffset(0,r,0)}static addDocString(i,r){i.addFieldOffset(1,r,0)}static addDomain(i,r){i.addFieldOffset(2,r,0)}static addSinceVersion(i,r){i.addFieldInt32(3,r,0)}static addIndex(i,r){i.addFieldInt32(4,r,0)}static addOpType(i,r){i.addFieldOffset(5,r,0)}static addType(i,r){i.addFieldInt32(6,r,l.experimental.fbs.NodeType.Primitive)}static addExecutionProviderType(i,r){i.addFieldOffset(7,r,0)}static addInputs(i,r){i.addFieldOffset(8,r,0)}static createInputsVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startInputsVector(i,r){i.startVector(4,r,4)}static addOutputs(i,r){i.addFieldOffset(9,r,0)}static createOutputsVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startOutputsVector(i,r){i.startVector(4,r,4)}static addAttributes(i,r){i.addFieldOffset(10,r,0)}static createAttributesVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startAttributesVector(i,r){i.startVector(4,r,4)}static addInputArgCounts(i,r){i.addFieldOffset(11,r,0)}static createInputArgCountsVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addInt32(r[d]);return i.endVector()}static startInputArgCountsVector(i,r){i.startVector(4,r,4)}static addImplicitInputs(i,r){i.addFieldOffset(12,r,0)}static createImplicitInputsVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startImplicitInputsVector(i,r){i.startVector(4,r,4)}static endNode(i){return i.endObject()}static createNode(i,r,d,p,_,y,v,T,w,E,P,R,I,N){return h.startNode(i),h.addName(i,r),h.addDocString(i,d),h.addDomain(i,p),h.addSinceVersion(i,_),h.addIndex(i,y),h.addOpType(i,v),h.addType(i,T),h.addExecutionProviderType(i,w),h.addInputs(i,E),h.addOutputs(i,P),h.addAttributes(i,R),h.addInputArgCounts(i,I),h.addImplicitInputs(i,N),h.endNode(i)}}g.Node=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsValueInfo(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsValueInfo(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}name(i){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,i):null}docString(i){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.__string(this.bb_pos+r,i):null}type(i){let r=this.bb.__offset(this.bb_pos,8);return r?(i||new l.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startValueInfo(i){i.startObject(3)}static addName(i,r){i.addFieldOffset(0,r,0)}static addDocString(i,r){i.addFieldOffset(1,r,0)}static addType(i,r){i.addFieldOffset(2,r,0)}static endValueInfo(i){return i.endObject()}static createValueInfo(i,r,d,p){return h.startValueInfo(i),h.addName(i,r),h.addDocString(i,d),h.addType(i,p),h.endValueInfo(i)}}g.ValueInfo=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsTypeInfo(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsTypeInfo(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}denotation(i){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,i):null}valueType(){let i=this.bb.__offset(this.bb_pos,6);return i?this.bb.readUint8(this.bb_pos+i):l.experimental.fbs.TypeInfoValue.NONE}value(i){let r=this.bb.__offset(this.bb_pos,8);return r?this.bb.__union(i,this.bb_pos+r):null}static startTypeInfo(i){i.startObject(3)}static addDenotation(i,r){i.addFieldOffset(0,r,0)}static addValueType(i,r){i.addFieldInt8(1,r,l.experimental.fbs.TypeInfoValue.NONE)}static addValue(i,r){i.addFieldOffset(2,r,0)}static endTypeInfo(i){return i.endObject()}static createTypeInfo(i,r,d,p){return h.startTypeInfo(i),h.addDenotation(i,r),h.addValueType(i,d),h.addValue(i,p),h.endTypeInfo(i)}}g.TypeInfo=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsOperatorSetId(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsOperatorSetId(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}domain(i){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,i):null}version(){let i=this.bb.__offset(this.bb_pos,6);return i?this.bb.readInt64(this.bb_pos+i):this.bb.createLong(0,0)}static startOperatorSetId(i){i.startObject(2)}static addDomain(i,r){i.addFieldOffset(0,r,0)}static addVersion(i,r){i.addFieldInt64(1,r,i.createLong(0,0))}static endOperatorSetId(i){return i.endObject()}static createOperatorSetId(i,r,d){return h.startOperatorSetId(i),h.addDomain(i,r),h.addVersion(i,d),h.endOperatorSetId(i)}}g.OperatorSetId=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsTensor(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsTensor(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}name(i){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,i):null}docString(i){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.__string(this.bb_pos+r,i):null}dims(i){let r=this.bb.__offset(this.bb_pos,8);return r?this.bb.readInt64(this.bb.__vector(this.bb_pos+r)+8*i):this.bb.createLong(0,0)}dimsLength(){let i=this.bb.__offset(this.bb_pos,8);return i?this.bb.__vector_len(this.bb_pos+i):0}dataType(){let i=this.bb.__offset(this.bb_pos,10);return i?this.bb.readInt32(this.bb_pos+i):l.experimental.fbs.TensorDataType.UNDEFINED}rawData(i){let r=this.bb.__offset(this.bb_pos,12);return r?this.bb.readUint8(this.bb.__vector(this.bb_pos+r)+i):0}rawDataLength(){let i=this.bb.__offset(this.bb_pos,12);return i?this.bb.__vector_len(this.bb_pos+i):0}rawDataArray(){let i=this.bb.__offset(this.bb_pos,12);return i?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+i),this.bb.__vector_len(this.bb_pos+i)):null}stringData(i,r){let d=this.bb.__offset(this.bb_pos,14);return d?this.bb.__string(this.bb.__vector(this.bb_pos+d)+4*i,r):null}stringDataLength(){let i=this.bb.__offset(this.bb_pos,14);return i?this.bb.__vector_len(this.bb_pos+i):0}static startTensor(i){i.startObject(6)}static addName(i,r){i.addFieldOffset(0,r,0)}static addDocString(i,r){i.addFieldOffset(1,r,0)}static addDims(i,r){i.addFieldOffset(2,r,0)}static createDimsVector(i,r){i.startVector(8,r.length,8);for(let d=r.length-1;d>=0;d--)i.addInt64(r[d]);return i.endVector()}static startDimsVector(i,r){i.startVector(8,r,8)}static addDataType(i,r){i.addFieldInt32(3,r,l.experimental.fbs.TensorDataType.UNDEFINED)}static addRawData(i,r){i.addFieldOffset(4,r,0)}static createRawDataVector(i,r){i.startVector(1,r.length,1);for(let d=r.length-1;d>=0;d--)i.addInt8(r[d]);return i.endVector()}static startRawDataVector(i,r){i.startVector(1,r,1)}static addStringData(i,r){i.addFieldOffset(5,r,0)}static createStringDataVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startStringDataVector(i,r){i.startVector(4,r,4)}static endTensor(i){return i.endObject()}static createTensor(i,r,d,p,_,y,v){return h.startTensor(i),h.addName(i,r),h.addDocString(i,d),h.addDims(i,p),h.addDataType(i,_),h.addRawData(i,y),h.addStringData(i,v),h.endTensor(i)}}g.Tensor=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsSparseTensor(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsSparseTensor(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}values(i){let r=this.bb.__offset(this.bb_pos,4);return r?(i||new l.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}indices(i){let r=this.bb.__offset(this.bb_pos,6);return r?(i||new l.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}dims(i){let r=this.bb.__offset(this.bb_pos,8);return r?this.bb.readInt64(this.bb.__vector(this.bb_pos+r)+8*i):this.bb.createLong(0,0)}dimsLength(){let i=this.bb.__offset(this.bb_pos,8);return i?this.bb.__vector_len(this.bb_pos+i):0}static startSparseTensor(i){i.startObject(3)}static addValues(i,r){i.addFieldOffset(0,r,0)}static addIndices(i,r){i.addFieldOffset(1,r,0)}static addDims(i,r){i.addFieldOffset(2,r,0)}static createDimsVector(i,r){i.startVector(8,r.length,8);for(let d=r.length-1;d>=0;d--)i.addInt64(r[d]);return i.endVector()}static startDimsVector(i,r){i.startVector(8,r,8)}static endSparseTensor(i){return i.endObject()}static createSparseTensor(i,r,d,p){return h.startSparseTensor(i),h.addValues(i,r),h.addIndices(i,d),h.addDims(i,p),h.endSparseTensor(i)}}g.SparseTensor=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsAttribute(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsAttribute(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}name(i){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,i):null}docString(i){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.__string(this.bb_pos+r,i):null}type(){let i=this.bb.__offset(this.bb_pos,8);return i?this.bb.readInt32(this.bb_pos+i):l.experimental.fbs.AttributeType.UNDEFINED}f(){let i=this.bb.__offset(this.bb_pos,10);return i?this.bb.readFloat32(this.bb_pos+i):0}i(){let i=this.bb.__offset(this.bb_pos,12);return i?this.bb.readInt64(this.bb_pos+i):this.bb.createLong(0,0)}s(i){let r=this.bb.__offset(this.bb_pos,14);return r?this.bb.__string(this.bb_pos+r,i):null}t(i){let r=this.bb.__offset(this.bb_pos,16);return r?(i||new l.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}g(i){let r=this.bb.__offset(this.bb_pos,18);return r?(i||new l.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}floats(i){let r=this.bb.__offset(this.bb_pos,20);return r?this.bb.readFloat32(this.bb.__vector(this.bb_pos+r)+4*i):0}floatsLength(){let i=this.bb.__offset(this.bb_pos,20);return i?this.bb.__vector_len(this.bb_pos+i):0}floatsArray(){let i=this.bb.__offset(this.bb_pos,20);return i?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+i),this.bb.__vector_len(this.bb_pos+i)):null}ints(i){let r=this.bb.__offset(this.bb_pos,22);return r?this.bb.readInt64(this.bb.__vector(this.bb_pos+r)+8*i):this.bb.createLong(0,0)}intsLength(){let i=this.bb.__offset(this.bb_pos,22);return i?this.bb.__vector_len(this.bb_pos+i):0}strings(i,r){let d=this.bb.__offset(this.bb_pos,24);return d?this.bb.__string(this.bb.__vector(this.bb_pos+d)+4*i,r):null}stringsLength(){let i=this.bb.__offset(this.bb_pos,24);return i?this.bb.__vector_len(this.bb_pos+i):0}tensors(i,r){let d=this.bb.__offset(this.bb_pos,26);return d?(r||new l.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+d)+4*i),this.bb):null}tensorsLength(){let i=this.bb.__offset(this.bb_pos,26);return i?this.bb.__vector_len(this.bb_pos+i):0}graphs(i,r){let d=this.bb.__offset(this.bb_pos,28);return d?(r||new l.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+d)+4*i),this.bb):null}graphsLength(){let i=this.bb.__offset(this.bb_pos,28);return i?this.bb.__vector_len(this.bb_pos+i):0}static startAttribute(i){i.startObject(13)}static addName(i,r){i.addFieldOffset(0,r,0)}static addDocString(i,r){i.addFieldOffset(1,r,0)}static addType(i,r){i.addFieldInt32(2,r,l.experimental.fbs.AttributeType.UNDEFINED)}static addF(i,r){i.addFieldFloat32(3,r,0)}static addI(i,r){i.addFieldInt64(4,r,i.createLong(0,0))}static addS(i,r){i.addFieldOffset(5,r,0)}static addT(i,r){i.addFieldOffset(6,r,0)}static addG(i,r){i.addFieldOffset(7,r,0)}static addFloats(i,r){i.addFieldOffset(8,r,0)}static createFloatsVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addFloat32(r[d]);return i.endVector()}static startFloatsVector(i,r){i.startVector(4,r,4)}static addInts(i,r){i.addFieldOffset(9,r,0)}static createIntsVector(i,r){i.startVector(8,r.length,8);for(let d=r.length-1;d>=0;d--)i.addInt64(r[d]);return i.endVector()}static startIntsVector(i,r){i.startVector(8,r,8)}static addStrings(i,r){i.addFieldOffset(10,r,0)}static createStringsVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startStringsVector(i,r){i.startVector(4,r,4)}static addTensors(i,r){i.addFieldOffset(11,r,0)}static createTensorsVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startTensorsVector(i,r){i.startVector(4,r,4)}static addGraphs(i,r){i.addFieldOffset(12,r,0)}static createGraphsVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startGraphsVector(i,r){i.startVector(4,r,4)}static endAttribute(i){return i.endObject()}static createAttribute(i,r,d,p,_,y,v,T,w,E,P,R,I,N){return h.startAttribute(i),h.addName(i,r),h.addDocString(i,d),h.addType(i,p),h.addF(i,_),h.addI(i,y),h.addS(i,v),h.addT(i,T),h.addG(i,w),h.addFloats(i,E),h.addInts(i,P),h.addStrings(i,R),h.addTensors(i,I),h.addGraphs(i,N),h.endAttribute(i)}}g.Attribute=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsGraph(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsGraph(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}initializers(i,r){let d=this.bb.__offset(this.bb_pos,4);return d?(r||new l.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+d)+4*i),this.bb):null}initializersLength(){let i=this.bb.__offset(this.bb_pos,4);return i?this.bb.__vector_len(this.bb_pos+i):0}nodeArgs(i,r){let d=this.bb.__offset(this.bb_pos,6);return d?(r||new l.experimental.fbs.ValueInfo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+d)+4*i),this.bb):null}nodeArgsLength(){let i=this.bb.__offset(this.bb_pos,6);return i?this.bb.__vector_len(this.bb_pos+i):0}nodes(i,r){let d=this.bb.__offset(this.bb_pos,8);return d?(r||new l.experimental.fbs.Node).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+d)+4*i),this.bb):null}nodesLength(){let i=this.bb.__offset(this.bb_pos,8);return i?this.bb.__vector_len(this.bb_pos+i):0}maxNodeIndex(){let i=this.bb.__offset(this.bb_pos,10);return i?this.bb.readUint32(this.bb_pos+i):0}nodeEdges(i,r){let d=this.bb.__offset(this.bb_pos,12);return d?(r||new l.experimental.fbs.NodeEdge).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+d)+4*i),this.bb):null}nodeEdgesLength(){let i=this.bb.__offset(this.bb_pos,12);return i?this.bb.__vector_len(this.bb_pos+i):0}inputs(i,r){let d=this.bb.__offset(this.bb_pos,14);return d?this.bb.__string(this.bb.__vector(this.bb_pos+d)+4*i,r):null}inputsLength(){let i=this.bb.__offset(this.bb_pos,14);return i?this.bb.__vector_len(this.bb_pos+i):0}outputs(i,r){let d=this.bb.__offset(this.bb_pos,16);return d?this.bb.__string(this.bb.__vector(this.bb_pos+d)+4*i,r):null}outputsLength(){let i=this.bb.__offset(this.bb_pos,16);return i?this.bb.__vector_len(this.bb_pos+i):0}sparseInitializers(i,r){let d=this.bb.__offset(this.bb_pos,18);return d?(r||new l.experimental.fbs.SparseTensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+d)+4*i),this.bb):null}sparseInitializersLength(){let i=this.bb.__offset(this.bb_pos,18);return i?this.bb.__vector_len(this.bb_pos+i):0}static startGraph(i){i.startObject(8)}static addInitializers(i,r){i.addFieldOffset(0,r,0)}static createInitializersVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startInitializersVector(i,r){i.startVector(4,r,4)}static addNodeArgs(i,r){i.addFieldOffset(1,r,0)}static createNodeArgsVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startNodeArgsVector(i,r){i.startVector(4,r,4)}static addNodes(i,r){i.addFieldOffset(2,r,0)}static createNodesVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startNodesVector(i,r){i.startVector(4,r,4)}static addMaxNodeIndex(i,r){i.addFieldInt32(3,r,0)}static addNodeEdges(i,r){i.addFieldOffset(4,r,0)}static createNodeEdgesVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startNodeEdgesVector(i,r){i.startVector(4,r,4)}static addInputs(i,r){i.addFieldOffset(5,r,0)}static createInputsVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startInputsVector(i,r){i.startVector(4,r,4)}static addOutputs(i,r){i.addFieldOffset(6,r,0)}static createOutputsVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startOutputsVector(i,r){i.startVector(4,r,4)}static addSparseInitializers(i,r){i.addFieldOffset(7,r,0)}static createSparseInitializersVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startSparseInitializersVector(i,r){i.startVector(4,r,4)}static endGraph(i){return i.endObject()}static createGraph(i,r,d,p,_,y,v,T,w){return h.startGraph(i),h.addInitializers(i,r),h.addNodeArgs(i,d),h.addNodes(i,p),h.addMaxNodeIndex(i,_),h.addNodeEdges(i,y),h.addInputs(i,v),h.addOutputs(i,T),h.addSparseInitializers(i,w),h.endGraph(i)}}g.Graph=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsModel(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsModel(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}irVersion(){let i=this.bb.__offset(this.bb_pos,4);return i?this.bb.readInt64(this.bb_pos+i):this.bb.createLong(0,0)}opsetImport(i,r){let d=this.bb.__offset(this.bb_pos,6);return d?(r||new l.experimental.fbs.OperatorSetId).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+d)+4*i),this.bb):null}opsetImportLength(){let i=this.bb.__offset(this.bb_pos,6);return i?this.bb.__vector_len(this.bb_pos+i):0}producerName(i){let r=this.bb.__offset(this.bb_pos,8);return r?this.bb.__string(this.bb_pos+r,i):null}producerVersion(i){let r=this.bb.__offset(this.bb_pos,10);return r?this.bb.__string(this.bb_pos+r,i):null}domain(i){let r=this.bb.__offset(this.bb_pos,12);return r?this.bb.__string(this.bb_pos+r,i):null}modelVersion(){let i=this.bb.__offset(this.bb_pos,14);return i?this.bb.readInt64(this.bb_pos+i):this.bb.createLong(0,0)}docString(i){let r=this.bb.__offset(this.bb_pos,16);return r?this.bb.__string(this.bb_pos+r,i):null}graph(i){let r=this.bb.__offset(this.bb_pos,18);return r?(i||new l.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}graphDocString(i){let r=this.bb.__offset(this.bb_pos,20);return r?this.bb.__string(this.bb_pos+r,i):null}static startModel(i){i.startObject(9)}static addIrVersion(i,r){i.addFieldInt64(0,r,i.createLong(0,0))}static addOpsetImport(i,r){i.addFieldOffset(1,r,0)}static createOpsetImportVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startOpsetImportVector(i,r){i.startVector(4,r,4)}static addProducerName(i,r){i.addFieldOffset(2,r,0)}static addProducerVersion(i,r){i.addFieldOffset(3,r,0)}static addDomain(i,r){i.addFieldOffset(4,r,0)}static addModelVersion(i,r){i.addFieldInt64(5,r,i.createLong(0,0))}static addDocString(i,r){i.addFieldOffset(6,r,0)}static addGraph(i,r){i.addFieldOffset(7,r,0)}static addGraphDocString(i,r){i.addFieldOffset(8,r,0)}static endModel(i){return i.endObject()}static createModel(i,r,d,p,_,y,v,T,w,E){return h.startModel(i),h.addIrVersion(i,r),h.addOpsetImport(i,d),h.addProducerName(i,p),h.addProducerVersion(i,_),h.addDomain(i,y),h.addModelVersion(i,v),h.addDocString(i,T),h.addGraph(i,w),h.addGraphDocString(i,E),h.endModel(i)}}g.Model=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsKernelCreateInfos(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsKernelCreateInfos(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}nodeIndices(i){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.readUint32(this.bb.__vector(this.bb_pos+r)+4*i):0}nodeIndicesLength(){let i=this.bb.__offset(this.bb_pos,4);return i?this.bb.__vector_len(this.bb_pos+i):0}nodeIndicesArray(){let i=this.bb.__offset(this.bb_pos,4);return i?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+i),this.bb.__vector_len(this.bb_pos+i)):null}kernelDefHashes(i){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.readUint64(this.bb.__vector(this.bb_pos+r)+8*i):this.bb.createLong(0,0)}kernelDefHashesLength(){let i=this.bb.__offset(this.bb_pos,6);return i?this.bb.__vector_len(this.bb_pos+i):0}static startKernelCreateInfos(i){i.startObject(2)}static addNodeIndices(i,r){i.addFieldOffset(0,r,0)}static createNodeIndicesVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addInt32(r[d]);return i.endVector()}static startNodeIndicesVector(i,r){i.startVector(4,r,4)}static addKernelDefHashes(i,r){i.addFieldOffset(1,r,0)}static createKernelDefHashesVector(i,r){i.startVector(8,r.length,8);for(let d=r.length-1;d>=0;d--)i.addInt64(r[d]);return i.endVector()}static startKernelDefHashesVector(i,r){i.startVector(8,r,8)}static endKernelCreateInfos(i){return i.endObject()}static createKernelCreateInfos(i,r,d){return h.startKernelCreateInfos(i),h.addNodeIndices(i,r),h.addKernelDefHashes(i,d),h.endKernelCreateInfos(i)}}g.KernelCreateInfos=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsSubGraphSessionState(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsSubGraphSessionState(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}graphId(i){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,i):null}sessionState(i){let r=this.bb.__offset(this.bb_pos,6);return r?(i||new l.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startSubGraphSessionState(i){i.startObject(2)}static addGraphId(i,r){i.addFieldOffset(0,r,0)}static addSessionState(i,r){i.addFieldOffset(1,r,0)}static endSubGraphSessionState(i){let r=i.endObject();return i.requiredField(r,4),r}static createSubGraphSessionState(i,r,d){return h.startSubGraphSessionState(i),h.addGraphId(i,r),h.addSessionState(i,d),h.endSubGraphSessionState(i)}}g.SubGraphSessionState=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsSessionState(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsSessionState(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}kernels(i){let r=this.bb.__offset(this.bb_pos,4);return r?(i||new l.experimental.fbs.KernelCreateInfos).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}subGraphSessionStates(i,r){let d=this.bb.__offset(this.bb_pos,6);return d?(r||new l.experimental.fbs.SubGraphSessionState).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+d)+4*i),this.bb):null}subGraphSessionStatesLength(){let i=this.bb.__offset(this.bb_pos,6);return i?this.bb.__vector_len(this.bb_pos+i):0}static startSessionState(i){i.startObject(2)}static addKernels(i,r){i.addFieldOffset(0,r,0)}static addSubGraphSessionStates(i,r){i.addFieldOffset(1,r,0)}static createSubGraphSessionStatesVector(i,r){i.startVector(4,r.length,4);for(let d=r.length-1;d>=0;d--)i.addOffset(r[d]);return i.endVector()}static startSubGraphSessionStatesVector(i,r){i.startVector(4,r,4)}static endSessionState(i){return i.endObject()}static createSessionState(i,r,d){return h.startSessionState(i),h.addKernels(i,r),h.addSubGraphSessionStates(i,d),h.endSessionState(i)}}g.SessionState=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={})),(function(l){(function(m){(function(g){class h{constructor(){this.bb=null,this.bb_pos=0}__init(i,r){return this.bb_pos=i,this.bb=r,this}static getRootAsInferenceSession(i,r){return(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static getSizePrefixedRootAsInferenceSession(i,r){return i.setPosition(i.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(r||new h).__init(i.readInt32(i.position())+i.position(),i)}static bufferHasIdentifier(i){return i.__has_identifier("ORTM")}ortVersion(i){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,i):null}model(i){let r=this.bb.__offset(this.bb_pos,6);return r?(i||new l.experimental.fbs.Model).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}sessionState(i){let r=this.bb.__offset(this.bb_pos,8);return r?(i||new l.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startInferenceSession(i){i.startObject(3)}static addOrtVersion(i,r){i.addFieldOffset(0,r,0)}static addModel(i,r){i.addFieldOffset(1,r,0)}static addSessionState(i,r){i.addFieldOffset(2,r,0)}static endInferenceSession(i){return i.endObject()}static finishInferenceSessionBuffer(i,r){i.finish(r,"ORTM")}static finishSizePrefixedInferenceSessionBuffer(i,r){i.finish(r,"ORTM",!0)}static createInferenceSession(i,r,d,p){return h.startInferenceSession(i),h.addOrtVersion(i,r),h.addModel(i,d),h.addSessionState(i,p),h.endInferenceSession(i)}}g.InferenceSession=h})(m.fbs||(m.fbs={}))})(l.experimental||(l.experimental={}))})(e.onnxruntime||(e.onnxruntime={}))},7448:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OnnxjsSessionHandler=void 0;const s=t(1670),o=t(9162);e.OnnxjsSessionHandler=class{constructor(u){this.session=u,this.inputNames=this.session.inputNames,this.outputNames=this.session.outputNames}async dispose(){}async run(u,l,m){const g=new Map;for(const i in u)if(Object.hasOwnProperty.call(u,i)){const r=u[i];g.set(i,new o.Tensor(r.dims,r.type,void 0,void 0,r.data))}const h=await this.session.run(g),f={};return h.forEach(((i,r)=>{f[r]=new s.Tensor(i.type,i.data,i.dims)})),f}startProfiling(){this.session.startProfiling()}endProfiling(){this.session.endProfiling()}}},6919:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Session=void 0;const s=t(7067),o=t(1296),u=t(7091),l=t(1036),m=t(6231),g=t(2644);e.Session=class{constructor(h={}){this._initialized=!1,this.backendHint=h.backendHint,this.profiler=m.Profiler.create(h.profiler),this.context={profiler:this.profiler,graphInputTypes:[],graphInputDims:[]}}get inputNames(){return this._model.graph.getInputNames()}get outputNames(){return this._model.graph.getOutputNames()}startProfiling(){this.profiler.start()}endProfiling(){this.profiler.stop()}async loadModel(h,f,i){await this.profiler.event("session","Session.loadModel",(async()=>{const r=await(0,u.resolveBackend)(this.backendHint);if(this.sessionHandler=r.createSessionHandler(this.context),this._model=new g.Model,typeof h=="string"){const d=h.endsWith(".ort");if(typeof fetch>"u"){const p=await(0,o.promisify)(s.readFile)(h);this.initialize(p,d)}else{const p=await fetch(h),_=await p.arrayBuffer();this.initialize(new Uint8Array(_),d)}}else if(ArrayBuffer.isView(h))this.initialize(h);else{const d=new Uint8Array(h,f||0,i||h.byteLength);this.initialize(d)}}))}initialize(h,f){if(this._initialized)throw new Error("already initialized");this.profiler.event("session","Session.initialize",(()=>{const i=this.sessionHandler.transformGraph?this.sessionHandler:void 0;this._model.load(h,i,f),this.sessionHandler.onGraphInitialized&&this.sessionHandler.onGraphInitialized(this._model.graph),this.initializeOps(this._model.graph),this._executionPlan=new l.ExecutionPlan(this._model.graph,this._ops,this.profiler)})),this._initialized=!0}async run(h){if(!this._initialized)throw new Error("session not initialized yet");return this.profiler.event("session","Session.run",(async()=>{const f=this.normalizeAndValidateInputs(h),i=await this._executionPlan.execute(this.sessionHandler,f);return this.createOutput(i)}))}normalizeAndValidateInputs(h){const f=this._model.graph.getInputNames();if(Array.isArray(h)){if(h.length!==f.length)throw new Error(`incorrect input array length: expected ${f.length} but got ${h.length}`)}else{if(h.size!==f.length)throw new Error(`incorrect input map size: expected ${f.length} but got ${h.size}`);const i=new Array(h.size);let r=0;for(let d=0;d<f.length;++d){const p=h.get(f[d]);if(!p)throw new Error(`missing input tensor for: '${name}'`);i[r++]=p}h=i}if(this.context.graphInputTypes&&this.context.graphInputTypes.length!==0&&this.context.graphInputDims&&this.context.graphInputDims.length!==0)this.validateInputTensorDims(this.context.graphInputDims,h,!1);else{const i=this._model.graph.getInputIndices(),r=this._model.graph.getValues(),d=new Array(i.length);for(let p=0;p<i.length;++p){const _=r[i[p]];d[p]=_.type.shape.dims,this.context.graphInputTypes.push(_.type.tensorType),this.context.graphInputDims.push(h[p].dims)}this.validateInputTensorDims(d,h,!0)}return this.validateInputTensorTypes(this.context.graphInputTypes,h),h}validateInputTensorTypes(h,f){for(let i=0;i<f.length;i++){const r=h[i],d=f[i].type;if(r!==d)throw new Error(`input tensor[${i}] check failed: expected type '${r}' but got ${d}`)}}validateInputTensorDims(h,f,i){for(let r=0;r<f.length;r++){const d=h[r],p=f[r].dims;if(!this.compareTensorDims(d,p,i))throw new Error(`input tensor[${r}] check failed: expected shape '[${d.join(",")}]' but got [${p.join(",")}]`)}}compareTensorDims(h,f,i){if(h.length!==f.length)return!1;for(let r=0;r<h.length;++r)if(h[r]!==f[r]&&(!i||h[r]!==0))return!1;return!0}createOutput(h){const f=this._model.graph.getOutputNames();if(h.length!==f.length)throw new Error("expected number of outputs do not match number of generated outputs");const i=new Map;for(let r=0;r<f.length;++r)i.set(f[r],h[r]);return i}initializeOps(h){const f=h.getNodes();this._ops=new Array(f.length);for(let i=0;i<f.length;i++)this._ops[i]=this.sessionHandler.resolve(f[i],this._model.opsets,h)}}},9162:function(n,e,t){var s=this&&this.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(e,"__esModule",{value:!0}),e.Tensor=void 0;const o=t(3442),u=s(t(3720)),l=t(1446),m=t(9395),g=t(2517);var h=m.onnxruntime.experimental.fbs;class f{get data(){if(this.cache===void 0){const y=this.dataProvider(this.dataId);if(y.length!==this.size)throw new Error("Length of data provided by the Data Provider is inconsistent with the dims of this Tensor.");this.cache=y}return this.cache}get stringData(){if(this.type!=="string")throw new TypeError("data type is not string");return this.data}get integerData(){switch(this.type){case"uint8":case"int8":case"uint16":case"int16":case"int32":case"uint32":case"bool":return this.data;default:throw new TypeError("data type is not integer (uint8, int8, uint16, int16, int32, uint32, bool)")}}get floatData(){switch(this.type){case"float32":case"float64":return this.data;default:throw new TypeError("data type is not float (float32, float64)")}}get numberData(){if(this.type!=="string")return this.data;throw new TypeError("type cannot be non-number (string)")}get(y){return this.data[g.ShapeUtil.indicesToOffset(y,this.strides)]}set(y,v){this.data[g.ShapeUtil.indicesToOffset(y,this.strides)]=v}async getData(){return this.cache===void 0&&(this.cache=await this.asyncDataProvider(this.dataId)),this.cache}get strides(){return this._strides||(this._strides=g.ShapeUtil.computeStrides(this.dims)),this._strides}constructor(y,v,T,w,E,P=o.Guid.create()){this.dims=y,this.type=v,this.dataProvider=T,this.asyncDataProvider=w,this.cache=E,this.dataId=P,this.size=g.ShapeUtil.validateDimsAndCalcSize(y);const R=this.size,I=T===void 0&&w===void 0&&E===void 0;if(E!==void 0&&E.length!==R)throw new RangeError("Input dims doesn't match data length.");if(v==="string"){if(!(E===void 0||Array.isArray(E)&&E.every((N=>typeof N=="string"))))throw new TypeError("cache should be a string array");I&&(this.cache=new Array(R))}else{if(E!==void 0){const N=r(v);if(!(E instanceof N))throw new TypeError(`cache should be type ${N.name}`)}if(I){const N=new ArrayBuffer(R*(function(B){switch(B){case"bool":case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;case"float64":return 8;default:throw new Error(`cannot calculate sizeof() on type ${B}`)}})(v));this.cache=(function(B,D){return new(r(D))(B)})(N,v)}}}static fromProto(y){if(!y)throw new Error("cannot construct Value from an empty tensor");const v=g.ProtoUtil.tensorDataTypeFromProto(y.dataType),T=g.ProtoUtil.tensorDimsFromProto(y.dims),w=new f(T,v);if(v==="string")y.stringData.forEach(((E,P)=>{w.data[P]=(0,g.decodeUtf8String)(E)}));else if(y.rawData&&typeof y.rawData.byteLength=="number"&&y.rawData.byteLength>0){const E=w.data,P=new DataView(y.rawData.buffer,y.rawData.byteOffset,y.rawData.byteLength),R=i(y.dataType),I=y.rawData.byteLength/R;if(y.rawData.byteLength%R!=0)throw new Error("invalid buffer length");if(E.length!==I)throw new Error("buffer length mismatch");for(let N=0;N<I;N++){const B=p(P,y.dataType,N*R);E[N]=B}}else{let E;switch(y.dataType){case l.onnx.TensorProto.DataType.FLOAT:E=y.floatData;break;case l.onnx.TensorProto.DataType.INT32:case l.onnx.TensorProto.DataType.INT16:case l.onnx.TensorProto.DataType.UINT16:case l.onnx.TensorProto.DataType.INT8:case l.onnx.TensorProto.DataType.UINT8:case l.onnx.TensorProto.DataType.BOOL:E=y.int32Data;break;case l.onnx.TensorProto.DataType.INT64:E=y.int64Data;break;case l.onnx.TensorProto.DataType.DOUBLE:E=y.doubleData;break;case l.onnx.TensorProto.DataType.UINT32:case l.onnx.TensorProto.DataType.UINT64:E=y.uint64Data;break;default:throw new Error("unspecific error")}if(E==null)throw new Error("failed to populate data from a tensorproto value");const P=w.data;if(P.length!==E.length)throw new Error("array length mismatch");for(let R=0;R<E.length;R++){const I=E[R];u.default.isLong(I)?P[R]=d(I,y.dataType):P[R]=I}}return w}static fromData(y,v,T){return new f(v,T,void 0,void 0,y)}static fromOrtTensor(y){if(!y)throw new Error("cannot construct Value from an empty tensor");const v=g.ProtoUtil.tensorDimsFromORTFormat(y),T=g.ProtoUtil.tensorDataTypeFromProto(y.dataType()),w=new f(v,T);if(T==="string")for(let E=0;E<y.stringDataLength();E++)w.data[E]=y.stringData(E);else if(y.rawDataArray()&&typeof y.rawDataLength()=="number"&&y.rawDataLength()>0){const E=w.data,P=new DataView(y.rawDataArray().buffer,y.rawDataArray().byteOffset,y.rawDataLength()),R=i(y.dataType()),I=y.rawDataLength()/R;if(y.rawDataLength()%R!=0)throw new Error("invalid buffer length");if(E.length!==I)throw new Error("buffer length mismatch");for(let N=0;N<I;N++){const B=p(P,y.dataType(),N*R);E[N]=B}}return w}}function i(_){switch(_){case l.onnx.TensorProto.DataType.UINT8:case l.onnx.TensorProto.DataType.INT8:case l.onnx.TensorProto.DataType.BOOL:return 1;case l.onnx.TensorProto.DataType.UINT16:case l.onnx.TensorProto.DataType.INT16:return 2;case l.onnx.TensorProto.DataType.FLOAT:case l.onnx.TensorProto.DataType.INT32:case l.onnx.TensorProto.DataType.UINT32:return 4;case l.onnx.TensorProto.DataType.INT64:case l.onnx.TensorProto.DataType.DOUBLE:case l.onnx.TensorProto.DataType.UINT64:return 8;default:throw new Error(`cannot calculate sizeof() on type ${l.onnx.TensorProto.DataType[_]}`)}}function r(_){switch(_){case"bool":case"uint8":return Uint8Array;case"int8":return Int8Array;case"int16":return Int16Array;case"uint16":return Uint16Array;case"int32":return Int32Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;default:throw new Error("unspecified error")}}function d(_,y){if(y===l.onnx.TensorProto.DataType.INT64||y===h.TensorDataType.INT64){if(_.greaterThanOrEqual(2147483648)||_.lessThan(-2147483648))throw new TypeError("int64 is not supported")}else{if(y!==l.onnx.TensorProto.DataType.UINT32&&y!==h.TensorDataType.UINT32&&y!==l.onnx.TensorProto.DataType.UINT64&&y!==h.TensorDataType.UINT64)throw new TypeError(`not a LONG type: ${l.onnx.TensorProto.DataType[y]}`);if(_.greaterThanOrEqual(4294967296)||_.lessThan(0))throw new TypeError("uint64 is not supported")}return _.toNumber()}function p(_,y,v){switch(y){case l.onnx.TensorProto.DataType.BOOL:case l.onnx.TensorProto.DataType.UINT8:return _.getUint8(v);case l.onnx.TensorProto.DataType.INT8:return _.getInt8(v);case l.onnx.TensorProto.DataType.UINT16:return _.getUint16(v,!0);case l.onnx.TensorProto.DataType.INT16:return _.getInt16(v,!0);case l.onnx.TensorProto.DataType.FLOAT:return _.getFloat32(v,!0);case l.onnx.TensorProto.DataType.INT32:return _.getInt32(v,!0);case l.onnx.TensorProto.DataType.UINT32:return _.getUint32(v,!0);case l.onnx.TensorProto.DataType.INT64:return d(u.default.fromBits(_.getUint32(v,!0),_.getUint32(v+4,!0),!1),y);case l.onnx.TensorProto.DataType.DOUBLE:return _.getFloat64(v,!0);case l.onnx.TensorProto.DataType.UINT64:return d(u.default.fromBits(_.getUint32(v,!0),_.getUint32(v+4,!0),!0),y);default:throw new Error(`cannot read from DataView for type ${l.onnx.TensorProto.DataType[y]}`)}}e.Tensor=f},2517:function(n,e,t){var s=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(e,"__esModule",{value:!0}),e.decodeUtf8String=e.MAX_CLIP=e.MIN_CLIP=e.PoolConvUtil=e.ReduceUtil=e.SplitUtil=e.MathUtil=e.ShapeUtil=e.LongUtil=e.ProtoUtil=e.GemmUtil=e.arrayCopyHelper=e.BroadcastUtil=e.MatMulUtil=e.ArrayUtil=e.assert=e.checkInputsShape=void 0;const o=t(5686),u=s(t(3720)),l=t(1446),m=t(9162);e.checkInputsShape=function(y,...v){if(!y||y.length!==v.length)return!1;for(let T=0;T<y.length;T++)if(!y[T].dims||y[T].dims.length!==v[T])return!1;return!0},e.assert=function(y,v){if(!y)throw new Error(typeof v=="string"?v:v())},e.ArrayUtil=class{static arraysEqual(y,v){if(y.length!==v.length)return!1;for(let T=0;T<y.length;T++)if(y[T]!==v[T])return!1;return!0}};class g{static preprocessInputShapes(v,T){return[v.length===1?[1,v[0]]:v,T.length===1?[T[0],1]:T]}static postprocessOutputShape(v,T,w){T===1&&v.splice(v.length-2,1),w===1&&v.pop()}static calcMatMulShape(v,T){return v[1]!==T[0]?void 0:[v[0],T[1]]}}e.MatMulUtil=g;class h{static calcShape(v,T,w=!1){const E=v.length,P=T.length;if(E===0)return T;if(P===0)return v;const R=Math.max(v.length,T.length),I=new Array(R);if(w){if(E<2||P<2)return;const N=g.calcMatMulShape([v[E-2],v[E-1]],[T[P-2],T[P-1]]);if(N===void 0)return;[I[R-2],I[R-1]]=N}for(let N=w?3:1;N<=R;N++){const B=E-N<0?1:v[E-N],D=P-N<0?1:T[P-N];if(B!==D&&B>1&&D>1)return;I[R-N]=Math.max(B,D)}return I}static index(v,T){const w=new Array(T.length);return h.fillIndex(v,T,w),w}static fillIndex(v,T,w){const E=v.length-T.length;for(let P=0;P<T.length;P++)w[P]=v[E+P]%T[P]}static calc(v,T,w,E,P){const R=h.calcShape(v.dims,T.dims);if(R){if(E&&!r.areEqual(R,v.dims))return;const I=r.size(R),N=E?v:new m.Tensor(R,P||v.type);if(R.length===0)N.set([],w(v.get([]),T.get([])));else{const B=new Array(R.length),D=new Array(v.dims.length),Y=new Array(T.dims.length);let se,re=0,W=0,$=!1,k=!1;v.dims.length===0&&(re=v.get([]),$=!0),T.dims.length===0&&(W=T.get([]),k=!0);for(let H=0;H<I;H++){se=H;for(let de=R.length-1;de>=0;de--)B[de]=se%R[de],se=Math.floor(se/R[de]);$||(h.fillIndex(B,v.dims,D),re=v.get(D)),k||(h.fillIndex(B,T.dims,Y),W=T.get(Y)),N.set(B,w(re,W))}}return N}}static isValidBroadcast(v,T){const w=v.length,E=T.length;if(w>E)return!1;for(let P=1;P<=w;P++)if(v[w-P]!==1&&v[w-P]!==T[E-P])return!1;return!0}static getBroadcastDims(v,T){const w=v.length,E=[];for(let P=0;P<w;P++){const R=w-1-P,I=v[R]||1;(T[T.length-1-P]||1)>1&&I===1&&E.unshift(R)}return E}}e.BroadcastUtil=h,e.arrayCopyHelper=function(y,v,T,w,E){if(w<0||w>=v.length)throw new Error("sourceIndex out of bounds");if(T<0||T>=y.length)throw new Error("targetIndex out of bounds");if(w+E>v.length)throw new Error("source indices to be copied are outside bounds");if(T+E>y.length)throw new Error("target array is too small to hold result");for(let P=0;P<E;P++)y[T+P]=v[w+P]},e.GemmUtil=class{static getShapeOfGemmResult(y,v,T,w,E){if(y.length!==2||T.length!==2)throw new Error("shape need to be of size 2");let P,R,I;v?(P=y[1],R=y[0]):(P=y[0],R=y[1]);let N=-1;if(w?(I=T[0],N=1):(I=T[1],N=0),T[N]!==R)throw new Error("dimension mismatch");if(P<=0||I<=0||R<=0)throw new Error("invalid shape specified");if(E&&!h.isValidBroadcast(E,[P,I]))throw new Error("gemm: invalid bias shape for broadcast");return[P,I,R]}};class f{static tensorDataTypeFromProto(v){switch(v){case l.onnx.TensorProto.DataType.INT8:return"int8";case l.onnx.TensorProto.DataType.UINT8:return"uint8";case l.onnx.TensorProto.DataType.BOOL:return"bool";case l.onnx.TensorProto.DataType.INT16:return"int16";case l.onnx.TensorProto.DataType.UINT16:return"uint16";case l.onnx.TensorProto.DataType.INT32:return"int32";case l.onnx.TensorProto.DataType.UINT32:return"uint32";case l.onnx.TensorProto.DataType.FLOAT:return"float32";case l.onnx.TensorProto.DataType.DOUBLE:return"float64";case l.onnx.TensorProto.DataType.STRING:return"string";case l.onnx.TensorProto.DataType.INT64:return"int32";case l.onnx.TensorProto.DataType.UINT64:return"uint32";default:throw new Error(`unsupported data type: ${l.onnx.TensorProto.DataType[v]}`)}}static tensorDataTypeStringToEnum(v){switch(v){case"int8":return l.onnx.TensorProto.DataType.INT8;case"uint8":return l.onnx.TensorProto.DataType.UINT8;case"bool":return l.onnx.TensorProto.DataType.BOOL;case"int16":return l.onnx.TensorProto.DataType.INT16;case"uint16":return l.onnx.TensorProto.DataType.UINT16;case"int32":return l.onnx.TensorProto.DataType.INT32;case"uint32":return l.onnx.TensorProto.DataType.UINT32;case"float32":return l.onnx.TensorProto.DataType.FLOAT;case"float64":return l.onnx.TensorProto.DataType.DOUBLE;case"string":return l.onnx.TensorProto.DataType.STRING;case"int64":return l.onnx.TensorProto.DataType.INT64;case"uint64":return l.onnx.TensorProto.DataType.UINT64;default:throw new Error(`unsupported data type: ${v}`)}}static tensorDimsFromProto(v){return v.map((T=>u.default.isLong(T)?T.toNumber():T))}static tensorValueTypeFromProto(v){return{tensorType:f.tensorDataTypeFromProto(v.elemType),shape:{dims:f.tensorDimsFromProto(v.shape.dim.map((T=>T.dimValue)))}}}static tensorDimsFromORTFormat(v){const T=[];for(let w=0;w<v.dimsLength();w++)T.push(i.longToNumber(v.dims(w)));return T}static tensorAttributesFromORTFormat(v){const T=[];for(let w=0;w<v.attributesLength();w++)T.push(v.attributes(w));return T}}e.ProtoUtil=f;class i{static longToNumber(v,T){return u.default.isLong(v)?v.toNumber():v instanceof o.flatbuffers.Long?u.default.fromValue({low:v.low,high:v.high,unsigned:T!=null&&T}).toNumber():v}static isLong(v){return u.default.isLong(v)||v instanceof o.flatbuffers.Long}}e.LongUtil=i;class r{static size(v){return r.getSizeFromDimensionRange(v,0,v.length)}static sizeFromDimension(v,T){if(T<0||T>v.length)throw new Error(`invalid dimension of ${T} for sizeFromDimension as Tensor has ${v.length} dimensions.`);return r.getSizeFromDimensionRange(v,T,v.length)}static sizeToDimension(v,T){if(T<0||T>v.length)throw new Error(`invalid dimension of ${T} for sizeToDimension as Tensor has ${v.length} dimensions.`);return r.getSizeFromDimensionRange(v,0,T)}static getSizeFromDimensionRange(v,T,w){let E=1;for(let P=T;P<w;P++){if(v[P]<=0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains 0 or negative values in them.");E*=v[P]}return E}static computeStrides(v){const T=v.length;if(T===0)return[];if(T===1)return[1];const w=new Array(T);w[T-1]=1,w[T-2]=v[T-1];for(let E=T-3;E>=0;--E)w[E]=w[E+1]*v[E+1];return w}static transpose(v){return v.slice().reverse()}static indicesToOffset(v,T,w){w===void 0&&(w=v.length);let E=0;for(let P=0;P<w;++P)E+=T[P]*v[P];return E}static offsetToIndices(v,T){const w=T.length;if(w===0)return[];if(w===1)return[v*T[0]];const E=new Array(T.length);for(let P=0;P<E.length-1;++P)E[P]=Math.floor(v/T[P]),v-=E[P]*T[P];return E[E.length-1]=v,E}static normalizeAxis(v,T){if(v<-T&&v>=T)throw new Error("unsupported axis for this operation.");return v<0?v+T:v}static normalizeAxes(v,T){return v.map((w=>this.normalizeAxis(w,T)))}static incrementIndex(v,T,w){if(T.length===0||v.length===0)throw new Error("Index incrementing unsupported for scalar Tensor");if(w===void 0)w=T.length;else if(w<=0||w>T.length)throw new Error("Incorrect axis to increment on");for(let E=w-1;E>=0&&(v[E]++,!(v[E]<T[E]));--E)v[E]=0}static calculateReshapedDims(v,T){if(T.length===0){if(v.length===0||r.size(v)===1)return[];throw new Error("cannot reshape to a scalar Tensor")}const w=T.length,E=new Array(w);let P=-1,R=1;for(let N=0;N<w;N++){if(T[N]<-1)throw new Error("a dimension in shape hints cannot be less than -1");if(T[N]===-1){if(P!==-1)throw new Error("at most one dimension in shape hints can be -1");P=N}else{if(T[N]===0){if(N>=v.length)throw new Error("the dimension with value zero exceeds the dimension size of the input tensor");E[N]=v[N]}else E[N]=T[N];R*=E[N]}}const I=r.size(v);if(P!==-1){if(I%R!=0)throw new Error(`the input tensor cannot be reshaped to the requested shape. Input shape: [${v}] Output shape: [${T}]`);E[P]=I/R}else if(R!==I)throw new Error("reshapedDims and originalDims don't have matching sizes");return E}static sortBasedOnPerm(v,T){return T?T.map((w=>v[w])):v.slice().reverse()}static padShape(v,T){const w=v.length;return v.map(((E,P)=>E+T[P]+T[P+w]))}static areEqual(v,T){return v.length===T.length&&v.every(((w,E)=>w===T[E]))}static validateDimsAndCalcSize(v){if(v.length>6)throw new TypeError("Only rank 0 to 6 is supported for tensor shape.");let T=1;for(const w of v){if(!Number.isInteger(w))throw new TypeError(`Invalid shape: ${w} is not an integer`);if(w<0||w>2147483647)throw new TypeError(`Invalid shape: length ${w} is not allowed`);T*=w}return T}static flattenShape(v,T){T<0&&(T+=v.length);const w=v.reduce(((P,R)=>P*R),1),E=v.slice(T).reduce(((P,R)=>P*R),1);return[w/E,E]}static squeezeShape(v,T){const w=new Array;T=r.normalizeAxes(T,v.length);for(let E=0;E<v.length;E++){const P=T.indexOf(E)>=0;if(P&&v[E]!==1)throw new Error("squeeze an axis of size different than 1");(T.length===0&&v[E]>1||T.length>0&&!P)&&w.push(v[E])}return w}static unsqueezeShape(v,T){const w=new Array(v.length+T.length);w.fill(0);for(let P=0;P<T.length;P++){const R=r.normalizeAxis(T[P],w.length);if(R>=w.length)throw new Error("'axes' has an out of range axis");if(w[R]!==0)throw new Error("'axes' has a duplicate axis");w[R]=1}let E=0;for(let P=0;P<w.length;P++)w[P]===0&&(w[P]=v[E++]);if(E!==v.length)throw new Error("the unsqueezed dimension could not be established");return w}}e.ShapeUtil=r,e.MathUtil=class{static sqr(y,v,T,w,E){if(w<0||w>=v.length)throw new Error("sourceIndex out of bounds");if(T<0||T>=y.length)throw new Error("targetIndex out of bounds");if(w+E>v.length)throw new Error("source indices to be copied are outside bounds");if(T+E>y.length)throw new Error("target array is too small to hold result");for(let P=0;P<E;P++)y[T+P]+=Math.pow(v[w+P],2)}static axpy(y,v,T,w,E,P){if(w<0||w>=v.length)throw new Error("sourceIndex out of bounds");if(T<0||T>=y.length)throw new Error("targetIndex out of bounds");if(w+E>v.length)throw new Error("source indices to be copied are outside bounds");if(T+E>y.length)throw new Error("target array is too small to hold result");for(let R=0;R<E;R++)y[T+R]+=P*v[w+R]}static powx(y,v,T,w,E,P){if(w<0||w>=v.length)throw new Error("sourceIndex out of bounds");if(T<0||T>=y.length)throw new Error("targetIndex out of bounds");if(w+E>v.length)throw new Error("source indices to be copied are outside bounds");if(T+E>y.length)throw new Error("target array is too small to hold result");for(let R=0;R<E;R++)y[T+R]=Math.pow(v[w+R],P)}static mul(y,v,T,w,E){if(w<0||w>=v.length)throw new Error("sourceIndex out of bounds");if(T<0||T>=y.length)throw new Error("targetIndex out of bounds");if(w+E>v.length)throw new Error("source indices to be copied are outside bounds");if(T+E>y.length)throw new Error("target array is too small to hold result");for(let P=0;P<E;P++)y[T+P]=v[w+P]*y[T+P]}};class d{static splitShape(v,T,w,E){if(w.length===0){if(!E)throw new Error("need to know number of outputs when the 'split' attribute is not specified");d.determineSplit(v[T],E,w)}const P=[],R=[0];for(let I=0;I<w.length;++I){I!==0&&R.push(R[I-1]+w[I-1]);const N=v.slice();N[T]=w[I],P.push(N)}return[P,R]}static determineSplit(v,T,w){if(v%T!=0)throw new Error("cannot split tensor to equal sized parts");for(let E=0;E<T;++E)w.push(v/T)}}e.SplitUtil=d;class p{static calcReduce(v,T,w,E,P){const R=v.dims.slice(0);T.length===0&&R.forEach(((re,W)=>T.push(W)));const I=p.calcReduceShape(R,T,!0),N=r.size(I),B=new m.Tensor(I,v.type),D=r.computeStrides(I),Y=r.computeStrides(R),se=new Array(R.length);for(let re=0;re<N;re++){const W=r.offsetToIndices(re,D);h.fillIndex(W,R,se),B.set(W,p.calcReduceByAxis(v.numberData,T,R,0,r.indicesToOffset(se,Y),E,P))}return w?B:new m.Tensor(p.calcReduceShape(R,T,w),B.type,void 0,void 0,B.data,B.dataId)}static calcReduceByAxis(v,T,w,E,P,R,I){let N=0;if(E>=T.length)return R(v[P]);const B=T[E],D=B>=w.length?1:r.size(w.slice(B+1));for(let Y=0;Y<w[B];Y++)N=Y===0?p.calcReduceByAxis(v,T,w,E+1,P,R,I):I(N,p.calcReduceByAxis(v,T,w,E+1,P,R,I)),P+=D;return N}static calcReduceShape(v,T,w){const E=v.slice();for(let P=0;P<T.length;P++)E[T[P]]=w?1:0;return E.filter((P=>P!==0))}}e.ReduceUtil=p;class _{static adjustPoolAttributes(v,T,w,E,P,R){if(!v&&w.length!==T.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(v)for(let I=0;I<T.length-2;I++)I>=w.length?w.push(T[I+2]):w[I]=T[I+2];for(let I=0;I<w.length;I++)if(I<E.length){if(E[I]<0)throw new Error("strides should be greater than or equal to 1")}else E.push(1);for(let I=0;I<w.length;I++)if(I<P.length){if(P[I]<0)throw new Error("dilations should be greater than or equal to 1")}else P.push(1);for(let I=0;I<2*w.length;I++)if(I<R.length){if(R[I]<0)throw new Error("pad should be greater than or equal to 1")}else R.push(0);for(let I=0;I<w.length;I++){if(w[I]<=0)throw new Error("kernel shapes need to be greater than 0");if(R[I]>=w[I]||R[I+w.length]>=w[I])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(v,T,w,E,P,R){if(R){if(P.length!==2*(v.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(T.length!==v.length-2)throw new Error("length of strides should be the length of data dimensions");if(E.length!==v.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let I=0;I<v.length-2;I++)_.adjustPadAndReturnShape(v[I+2],T[I],w[I],E[I],P,I,I+v.length-2,R)}}static computePoolOutputShape(v,T,w,E,P,R,I){if(T.length<=0)throw new Error("input shape must be of size greater than 0");const N=[T[0],T[1]];return _.computeShapeHelper(v,T,N,w,E,P,R,I),N}static computeConvOutputShape(v,T,w,E,P,R,I){if(v.length<=0||T.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");const N=[v[0],T[0]];return _.computeShapeHelper(!1,v,N,w,E,P,R,I),N}static computeShapeHelper(v,T,w,E,P,R,I,N){if(v)for(let B=0;B<T.length-2;B++)w.push(1);else for(let B=0;B<T.length-2;B++)w.push(_.adjustPadAndReturnShape(T[B+2],E[B],P[B],R[B],I,B,B+T.length-2,N))}static adjustPadAndReturnShape(v,T,w,E,P,R,I,N){const B=w*(E-1)+1;if(!N||N==="NOTSET")return Math.floor((v+P[R]+P[I]-B)/T+1);switch(N){case"VALID":return P[R]=0,P[I]=0,Math.floor((v-B)/T+1);case"SAME_LOWER":case"SAME_UPPER":if(w!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{const D=((v+T-1)/T-1)*T+E-v;return P[R]=Math.floor(N==="SAME_LOWER"?(D+1)/2:D/2),P[I]=D-P[R],Math.floor((v+D-E)/T+1)}default:throw new Error("Unsupported AutoPad type")}}}e.PoolConvUtil=_,e.MIN_CLIP=-34028234663852886e22,e.MAX_CLIP=34028234663852886e22,e.decodeUtf8String=function(y){return new TextDecoder().decode(y)}},7967:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.iterateExtraOptions=void 0,e.iterateExtraOptions=(t,s,o,u)=>{if(typeof t=="object"&&t!==null){if(o.has(t))throw new Error("Circular reference in options");o.add(t)}Object.entries(t).forEach((([l,m])=>{const g=s?s+l:l;if(typeof m=="object")(0,e.iterateExtraOptions)(m,g+".",o,u);else if(typeof m=="string"||typeof m=="number")u(g,m.toString());else{if(typeof m!="boolean")throw new Error("Can't handle extra config type: "+typeof m);u(g,m?"1":"0")}}))}},2157:function(n,e,t){var s,o=this&&this.__createBinding||(Object.create?function(D,Y,se,re){re===void 0&&(re=se);var W=Object.getOwnPropertyDescriptor(Y,se);W&&!("get"in W?!Y.__esModule:W.writable||W.configurable)||(W={enumerable:!0,get:function(){return Y[se]}}),Object.defineProperty(D,re,W)}:function(D,Y,se,re){re===void 0&&(re=se),D[re]=Y[se]}),u=this&&this.__setModuleDefault||(Object.create?function(D,Y){Object.defineProperty(D,"default",{enumerable:!0,value:Y})}:function(D,Y){D.default=Y}),l=this&&this.__importStar||function(D){if(D&&D.__esModule)return D;var Y={};if(D!=null)for(var se in D)se!=="default"&&Object.prototype.hasOwnProperty.call(D,se)&&o(Y,D,se);return u(Y,D),Y};Object.defineProperty(e,"__esModule",{value:!0}),e.endProfiling=e.run=e.releaseSession=e.createSession=e.createSessionFinalize=e.createSessionAllocate=e.initOrt=e.initWasm=void 0;const m=t(1670),g=l(t(349)),h=t(6361),f=()=>!!m.env.wasm.proxy&&typeof document<"u";let i,r,d,p=!1,_=!1,y=!1;const v=[],T=[],w=[],E=[],P=[],R=[],I=()=>{if(p||!_||y||!i)throw new Error("worker not ready")},N=D=>{switch(D.data.type){case"init-wasm":p=!1,D.data.err?(y=!0,r[1](D.data.err)):(_=!0,r[0]());break;case"init-ort":D.data.err?d[1](D.data.err):d[0]();break;case"create_allocate":D.data.err?v.shift()[1](D.data.err):v.shift()[0](D.data.out);break;case"create_finalize":D.data.err?T.shift()[1](D.data.err):T.shift()[0](D.data.out);break;case"create":D.data.err?w.shift()[1](D.data.err):w.shift()[0](D.data.out);break;case"release":D.data.err?E.shift()[1](D.data.err):E.shift()[0]();break;case"run":D.data.err?P.shift()[1](D.data.err):P.shift()[0](D.data.out);break;case"end-profiling":D.data.err?R.shift()[1](D.data.err):R.shift()[0]()}},B=typeof document<"u"?(s=document?.currentScript)===null||s===void 0?void 0:s.src:void 0;e.initWasm=async()=>{if(f()){if(_)return;if(p)throw new Error("multiple calls to 'initWasm()' detected.");if(y)throw new Error("previous call to 'initWasm()' failed.");return p=!0,m.env.wasm.wasmPaths===void 0&&B&&B.indexOf("blob:")!==0&&(m.env.wasm.wasmPaths=B.substr(0,+B.lastIndexOf("/")+1)),new Promise(((D,Y)=>{i?.terminate(),i=t(9710).Z(),i.onmessage=N,r=[D,Y];const se={type:"init-wasm",in:m.env.wasm};i.postMessage(se)}))}return(0,h.initializeWebAssembly)(m.env.wasm)},e.initOrt=async(D,Y)=>{if(f())return I(),new Promise(((se,re)=>{d=[se,re];const W={type:"init-ort",in:{numThreads:D,loggingLevel:Y}};i.postMessage(W)}));g.initOrt(D,Y)},e.createSessionAllocate=async D=>f()?(I(),new Promise(((Y,se)=>{v.push([Y,se]);const re={type:"create_allocate",in:{model:D}};i.postMessage(re,[D.buffer])}))):g.createSessionAllocate(D),e.createSessionFinalize=async(D,Y)=>f()?(I(),new Promise(((se,re)=>{T.push([se,re]);const W={type:"create_finalize",in:{modeldata:D,options:Y}};i.postMessage(W)}))):g.createSessionFinalize(D,Y),e.createSession=async(D,Y)=>f()?(I(),new Promise(((se,re)=>{w.push([se,re]);const W={type:"create",in:{model:D,options:Y}};i.postMessage(W,[D.buffer])}))):g.createSession(D,Y),e.releaseSession=async D=>{if(f())return I(),new Promise(((Y,se)=>{E.push([Y,se]);const re={type:"release",in:D};i.postMessage(re)}));g.releaseSession(D)},e.run=async(D,Y,se,re,W)=>f()?(I(),new Promise((($,k)=>{P.push([$,k]);const H={type:"run",in:{sessionId:D,inputIndices:Y,inputs:se,outputIndices:re,options:W}};i.postMessage(H,g.extractTransferableBuffers(se))}))):g.run(D,Y,se,re,W),e.endProfiling=async D=>{if(f())return I(),new Promise(((Y,se)=>{R.push([Y,se]);const re={type:"end-profiling",in:D};i.postMessage(re)}));g.endProfiling(D)}},586:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.setRunOptions=void 0;const s=t(7967),o=t(4983),u=t(6361);e.setRunOptions=l=>{const m=(0,u.getInstance)();let g=0;const h=[],f=l||{};try{if(l?.logSeverityLevel===void 0)f.logSeverityLevel=2;else if(typeof l.logSeverityLevel!="number"||!Number.isInteger(l.logSeverityLevel)||l.logSeverityLevel<0||l.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${l.logSeverityLevel}`);if(l?.logVerbosityLevel===void 0)f.logVerbosityLevel=0;else if(typeof l.logVerbosityLevel!="number"||!Number.isInteger(l.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${l.logVerbosityLevel}`);l?.terminate===void 0&&(f.terminate=!1);let i=0;if(l?.tag!==void 0&&(i=(0,o.allocWasmString)(l.tag,h)),g=m._OrtCreateRunOptions(f.logSeverityLevel,f.logVerbosityLevel,!!f.terminate,i),g===0)throw new Error("Can't create run options");return l?.extra!==void 0&&(0,s.iterateExtraOptions)(l.extra,"",new WeakSet,((r,d)=>{const p=(0,o.allocWasmString)(r,h),_=(0,o.allocWasmString)(d,h);if(m._OrtAddRunConfigEntry(g,p,_)!==0)throw new Error(`Can't set a run config entry: ${r} - ${d}`)})),[g,h]}catch(i){throw g!==0&&m._OrtReleaseRunOptions(g),h.forEach(m._free),i}}},2306:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OnnxruntimeWebAssemblySessionHandler=void 0;const s=t(2806),o=t(1670),u=t(2850),l=t(2157);let m;e.OnnxruntimeWebAssemblySessionHandler=class{async createSessionAllocate(g){const h=await fetch(g),f=await h.arrayBuffer();return(0,l.createSessionAllocate)(new Uint8Array(f))}async loadModel(g,h){if(m||(await(0,l.initOrt)(o.env.wasm.numThreads,(f=>{switch(f){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${f}`)}})(o.env.logLevel)),m=!0),typeof g=="string")if(typeof fetch>"u"){const f=await(0,u.promisify)(s.readFile)(g);[this.sessionId,this.inputNames,this.outputNames]=await(0,l.createSession)(f,h)}else{const f=await this.createSessionAllocate(g);[this.sessionId,this.inputNames,this.outputNames]=await(0,l.createSessionFinalize)(f,h)}else[this.sessionId,this.inputNames,this.outputNames]=await(0,l.createSession)(g,h)}async dispose(){return(0,l.releaseSession)(this.sessionId)}async run(g,h,f){const i=[],r=[];Object.entries(g).forEach((y=>{const v=y[0],T=y[1],w=this.inputNames.indexOf(v);if(w===-1)throw new Error(`invalid input '${v}'`);i.push(T),r.push(w)}));const d=[];Object.entries(h).forEach((y=>{const v=y[0],T=this.outputNames.indexOf(v);if(T===-1)throw new Error(`invalid output '${v}'`);d.push(T)}));const p=await(0,l.run)(this.sessionId,r,i.map((y=>[y.type,y.dims,y.data])),d,f),_={};for(let y=0;y<p.length;y++)_[this.outputNames[d[y]]]=new o.Tensor(p[y][0],p[y][2],p[y][1]);return _}startProfiling(){}endProfiling(){(0,l.endProfiling)(this.sessionId)}}},4919:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.setSessionOptions=void 0;const s=t(7967),o=t(4983),u=t(6361);e.setSessionOptions=l=>{const m=(0,u.getInstance)();let g=0;const h=[],f=l||{};(i=>{i.extra||(i.extra={}),i.extra.session||(i.extra.session={});const r=i.extra.session;r.use_ort_model_bytes_directly||(r.use_ort_model_bytes_directly="1")})(f);try{l?.graphOptimizationLevel===void 0&&(f.graphOptimizationLevel="all");const i=(p=>{switch(p){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${p}`)}})(f.graphOptimizationLevel);l?.enableCpuMemArena===void 0&&(f.enableCpuMemArena=!0),l?.enableMemPattern===void 0&&(f.enableMemPattern=!0),l?.executionMode===void 0&&(f.executionMode="sequential");const r=(p=>{switch(p){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${p}`)}})(f.executionMode);let d=0;if(l?.logId!==void 0&&(d=(0,o.allocWasmString)(l.logId,h)),l?.logSeverityLevel===void 0)f.logSeverityLevel=2;else if(typeof l.logSeverityLevel!="number"||!Number.isInteger(l.logSeverityLevel)||l.logSeverityLevel<0||l.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${l.logSeverityLevel}`);if(l?.logVerbosityLevel===void 0)f.logVerbosityLevel=0;else if(typeof l.logVerbosityLevel!="number"||!Number.isInteger(l.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${l.logVerbosityLevel}`);if(l?.enableProfiling===void 0&&(f.enableProfiling=!1),g=m._OrtCreateSessionOptions(i,!!f.enableCpuMemArena,!!f.enableMemPattern,r,!!f.enableProfiling,0,d,f.logSeverityLevel,f.logVerbosityLevel),g===0)throw new Error("Can't create session options");return l?.executionProviders&&((p,_,y)=>{for(const v of _){let T=typeof v=="string"?v:v.name;switch(T){case"xnnpack":T="XNNPACK";break;case"wasm":case"cpu":continue;default:throw new Error(`not supported EP: ${T}`)}const w=(0,o.allocWasmString)(T,y);if((0,u.getInstance)()._OrtAppendExecutionProvider(p,w)!==0)throw new Error(`Can't append execution provider: ${T}`)}})(g,l.executionProviders,h),l?.extra!==void 0&&(0,s.iterateExtraOptions)(l.extra,"",new WeakSet,((p,_)=>{const y=(0,o.allocWasmString)(p,h),v=(0,o.allocWasmString)(_,h);if(m._OrtAddSessionConfigEntry(g,y,v)!==0)throw new Error(`Can't set a session config entry: ${p} - ${_}`)})),[g,h]}catch(i){throw g!==0&&m._OrtReleaseSessionOptions(g),h.forEach(m._free),i}}},4983:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.allocWasmString=void 0;const s=t(6361);e.allocWasmString=(o,u)=>{const l=(0,s.getInstance)(),m=l.lengthBytesUTF8(o)+1,g=l._malloc(m);return l.stringToUTF8(o,g,m),u.push(g),g}},349:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.extractTransferableBuffers=e.endProfiling=e.run=e.releaseSession=e.createSession=e.createSessionFinalize=e.createSessionAllocate=e.initOrt=void 0;const s=t(586),o=t(4919),u=t(4983),l=t(6361);e.initOrt=(i,r)=>{const d=(0,l.getInstance)()._OrtInit(i,r);if(d!==0)throw new Error(`Can't initialize onnxruntime. error code = ${d}`)};const m=new Map;e.createSessionAllocate=i=>{const r=(0,l.getInstance)(),d=r._malloc(i.byteLength);return r.HEAPU8.set(i,d),[d,i.byteLength]},e.createSessionFinalize=(i,r)=>{const d=(0,l.getInstance)();let p=0,_=0,y=[];try{if([_,y]=(0,o.setSessionOptions)(r),p=d._OrtCreateSession(i[0],i[1],_),p===0)throw new Error("Can't create a session")}finally{d._free(i[0]),d._OrtReleaseSessionOptions(_),y.forEach(d._free)}const v=d._OrtGetInputCount(p),T=d._OrtGetOutputCount(p),w=[],E=[],P=[],R=[];for(let I=0;I<v;I++){const N=d._OrtGetInputName(p,I);if(N===0)throw new Error("Can't get an input name");E.push(N),w.push(d.UTF8ToString(N))}for(let I=0;I<T;I++){const N=d._OrtGetOutputName(p,I);if(N===0)throw new Error("Can't get an output name");R.push(N),P.push(d.UTF8ToString(N))}return m.set(p,[p,E,R]),[p,w,P]},e.createSession=(i,r)=>{const d=(0,e.createSessionAllocate)(i);return(0,e.createSessionFinalize)(d,r)},e.releaseSession=i=>{const r=(0,l.getInstance)(),d=m.get(i);if(!d)throw new Error("invalid session id");const p=d[0],_=d[1],y=d[2];_.forEach(r._OrtFree),y.forEach(r._OrtFree),r._OrtReleaseSession(p),m.delete(i)};const g=i=>{switch(i){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${i}`)}},h=i=>{switch(i){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${i}`)}},f=i=>{switch(i){case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${i}`)}};e.run=(i,r,d,p,_)=>{const y=(0,l.getInstance)(),v=m.get(i);if(!v)throw new Error("invalid session id");const T=v[0],w=v[1],E=v[2],P=r.length,R=p.length;let I=0,N=[];const B=[],D=[];try{[I,N]=(0,s.setRunOptions)(_);for(let k=0;k<P;k++){const H=d[k][0],de=d[k][1],ee=d[k][2];let ce,q;if(Array.isArray(ee)){q=4*ee.length,ce=y._malloc(q),D.push(ce);let xe=ce/4;for(let Ee=0;Ee<ee.length;Ee++){if(typeof ee[Ee]!="string")throw new TypeError(`tensor data at index ${Ee} is not a string`);y.HEAPU32[xe++]=(0,u.allocWasmString)(ee[Ee],D)}}else q=ee.byteLength,ce=y._malloc(q),D.push(ce),y.HEAPU8.set(new Uint8Array(ee.buffer,ee.byteOffset,q),ce);const le=y.stackSave(),be=y.stackAlloc(4*de.length);try{let xe=be/4;de.forEach((we=>y.HEAP32[xe++]=we));const Ee=y._OrtCreateTensor(g(H),ce,q,be,de.length);if(Ee===0)throw new Error("Can't create a tensor");B.push(Ee)}finally{y.stackRestore(le)}}const Y=y.stackSave(),se=y.stackAlloc(4*P),re=y.stackAlloc(4*P),W=y.stackAlloc(4*R),$=y.stackAlloc(4*R);try{let k=se/4,H=re/4,de=W/4,ee=$/4;for(let le=0;le<P;le++)y.HEAPU32[k++]=B[le],y.HEAPU32[H++]=w[r[le]];for(let le=0;le<R;le++)y.HEAPU32[de++]=0,y.HEAPU32[ee++]=E[p[le]];let ce=y._OrtRun(T,re,se,P,$,R,W,I);const q=[];if(ce===0)for(let le=0;le<R;le++){const be=y.HEAPU32[W/4+le],xe=y.stackSave(),Ee=y.stackAlloc(16);let we,U=0;try{if(ce=y._OrtGetTensorData(be,Ee,Ee+4,Ee+8,Ee+12),ce!==0)throw new Error(`Can't access output tensor data. error code = ${ce}`);let L=Ee/4;const M=y.HEAPU32[L++];U=y.HEAPU32[L++];const C=y.HEAPU32[L++],V=y.HEAPU32[L++],O=[];for(let j=0;j<V;j++)O.push(y.HEAPU32[C/4+j]);y._OrtFree(C);const z=O.length===0?1:O.reduce(((j,J)=>j*J));if(we=h(M),we==="string"){const j=[];let J=U/4;for(let X=0;X<z;X++){const ne=y.HEAPU32[J++],ie=X===z-1?void 0:y.HEAPU32[J]-ne;j.push(y.UTF8ToString(ne,ie))}q.push([we,O,j])}else{const j=new(f(we))(z);new Uint8Array(j.buffer,j.byteOffset,j.byteLength).set(y.HEAPU8.subarray(U,U+j.byteLength)),q.push([we,O,j])}}finally{y.stackRestore(xe),we==="string"&&U&&y._free(U),y._OrtReleaseTensor(be)}}if(ce===0)return q;throw new Error(`failed to call OrtRun(). error code = ${ce}.`)}finally{y.stackRestore(Y)}}finally{B.forEach(y._OrtReleaseTensor),D.forEach(y._free),y._OrtReleaseRunOptions(I),N.forEach(y._free)}},e.endProfiling=i=>{const r=(0,l.getInstance)(),d=m.get(i);if(!d)throw new Error("invalid session id");const p=d[0],_=r._OrtEndProfiling(p);if(_===0)throw new Error("Can't get an profile file name");r._OrtFree(_)},e.extractTransferableBuffers=i=>{const r=[];for(const d of i){const p=d[2];!Array.isArray(p)&&p.buffer&&r.push(p.buffer)}return r}},6361:function(n,e,t){var s=this&&this.__createBinding||(Object.create?function(_,y,v,T){T===void 0&&(T=v);var w=Object.getOwnPropertyDescriptor(y,v);w&&!("get"in w?!y.__esModule:w.writable||w.configurable)||(w={enumerable:!0,get:function(){return y[v]}}),Object.defineProperty(_,T,w)}:function(_,y,v,T){T===void 0&&(T=v),_[T]=y[v]}),o=this&&this.__setModuleDefault||(Object.create?function(_,y){Object.defineProperty(_,"default",{enumerable:!0,value:y})}:function(_,y){_.default=y}),u=this&&this.__importStar||function(_){if(_&&_.__esModule)return _;var y={};if(_!=null)for(var v in _)v!=="default"&&Object.prototype.hasOwnProperty.call(_,v)&&s(y,_,v);return o(y,_),y},l=this&&this.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(e,"__esModule",{value:!0}),e.dispose=e.getInstance=e.initializeWebAssembly=void 0;const m=u(t(6449)),g=l(t(932)),h=t(3474);let f,i=!1,r=!1,d=!1;const p=(_,y)=>y?_?"ort-wasm-simd-threaded.wasm":"ort-wasm-threaded.wasm":_?"ort-wasm-simd.wasm":"ort-wasm.wasm";e.initializeWebAssembly=async _=>{if(i)return Promise.resolve();if(r)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(d)throw new Error("previous call to 'initializeWebAssembly()' failed.");r=!0;const y=_.initTimeout,v=_.numThreads,T=_.simd,w=v>1&&(()=>{try{return typeof SharedArrayBuffer<"u"&&(typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch{return!1}})(),E=T&&(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}})(),P=typeof _.wasmPaths=="string"?_.wasmPaths:void 0,R=p(!1,w),I=p(E,w),N=typeof _.wasmPaths=="object"?_.wasmPaths[I]:void 0;let B=!1;const D=[];if(y>0&&D.push(new Promise((Y=>{setTimeout((()=>{B=!0,Y()}),y)}))),D.push(new Promise(((Y,se)=>{const re=w?h:g.default,W={locateFile:($,k)=>w&&$.endsWith(".worker.js")&&typeof Blob<"u"?URL.createObjectURL(new Blob([t(4154)],{type:"text/javascript"})):$===R?N??(P??k)+I:k+$};if(w)if(typeof Blob>"u")W.mainScriptUrlOrBlob=m.join("/","ort-wasm-threaded.js");else{const $=`var ortWasmThreaded=(function(){var _scriptDir;return ${re.toString()}})();`;W.mainScriptUrlOrBlob=new Blob([$],{type:"text/javascript"})}re(W).then(($=>{r=!1,i=!0,f=$,Y()}),($=>{r=!1,d=!0,se($)}))}))),await Promise.race(D),B)throw new Error(`WebAssembly backend initializing failed due to timeout: ${y}ms`)},e.getInstance=()=>{if(i&&f)return f;throw new Error("WebAssembly is not initialized yet.")},e.dispose=()=>{var _;!i||r||d||(r=!0,(_=f.PThread)===null||_===void 0||_.terminateAllThreads(),f=void 0,r=!1,i=!1,d=!0)}},9710:(n,e,t)=>{t.d(e,{Z:()=>u});var s=t(477),o=t.n(s);function u(){return o()('/*!\n* ONNX Runtime Web v1.14.0\n* Copyright (c) Microsoft Corporation. All rights reserved.\n* Licensed under the MIT License.\n*/\n(()=>{var t={474:(t,e,n)=>{var _scriptDir,r=(_scriptDir=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(t){function e(){return j.buffer!=D&&N(j.buffer),P}function r(){return j.buffer!=D&&N(j.buffer),U}function a(){return j.buffer!=D&&N(j.buffer),F}function i(){return j.buffer!=D&&N(j.buffer),I}function o(){return j.buffer!=D&&N(j.buffer),W}var u,c,s;t=t||{},u||(u=void 0!==t?t:{}),u.ready=new Promise((function(t,e){c=t,s=e}));var l,f,p,h,d,y,b=Object.assign({},u),m="./this.program",g=(t,e)=>{throw e},v="object"==typeof window,w="function"==typeof importScripts,_="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,O=u.ENVIRONMENT_IS_PTHREAD||!1,A="";function S(t){return u.locateFile?u.locateFile(t,A):A+t}if(_){let e;A=w?n(908).dirname(A)+"/":"//",y=()=>{d||(h=n(384),d=n(908))},l=function(t,e){return y(),t=d.normalize(t),h.readFileSync(t,e?void 0:"utf8")},p=t=>((t=l(t,!0)).buffer||(t=new Uint8Array(t)),t),f=(t,e,n)=>{y(),t=d.normalize(t),h.readFile(t,(function(t,r){t?n(t):e(r.buffer)}))},1<process.argv.length&&(m=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(t){if(!(t instanceof ct))throw t})),process.on("unhandledRejection",(function(t){throw t})),g=(t,e)=>{if(Q())throw process.exitCode=t,e;e instanceof ct||x("exiting due to exception: "+e),process.exit(t)},u.inspect=function(){return"[Emscripten Module object]"};try{e=n(925)}catch(t){throw console.error(\'The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?\'),t}n.g.Worker=e.Worker}else(v||w)&&(w?A=self.location.href:"undefined"!=typeof document&&document.currentScript&&(A=document.currentScript.src),_scriptDir&&(A=_scriptDir),A=0!==A.indexOf("blob:")?A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1):"",_||(l=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},w&&(p=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),f=(t,e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n()},r.onerror=n,r.send(null)}));_&&"undefined"==typeof performance&&(n.g.performance=n(953).performance);var T=console.log.bind(console),E=console.warn.bind(console);_&&(y(),T=t=>h.writeSync(1,t+"\\n"),E=t=>h.writeSync(2,t+"\\n"));var M,C=u.print||T,x=u.printErr||E;Object.assign(u,b),b=null,u.thisProgram&&(m=u.thisProgram),u.quit&&(g=u.quit),u.wasmBinary&&(M=u.wasmBinary);var R=u.noExitRuntime||!1;"object"!=typeof WebAssembly&&at("no native wasm support detected");var j,k,D,P,U,F,I,W,H=!1,L="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function z(t,e,n){var r=(e>>>=0)+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&L)return L.decode(t.buffer instanceof SharedArrayBuffer?t.slice(e,n):t.subarray(e,n));for(r="";e<n;){var a=t[e++];if(128&a){var i=63&t[e++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&t[e++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&t[e++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function Y(t,e){return(t>>>=0)?z(r(),t,e):""}function B(t,e,n,r){if(!(0<r))return 0;var a=n>>>=0;r=n+r-1;for(var i=0;i<t.length;++i){var o=t.charCodeAt(i);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++i)),127>=o){if(n>=r)break;e[n++>>>0]=o}else{if(2047>=o){if(n+1>=r)break;e[n++>>>0]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++>>>0]=224|o>>12}else{if(n+3>=r)break;e[n++>>>0]=240|o>>18,e[n++>>>0]=128|o>>12&63}e[n++>>>0]=128|o>>6&63}e[n++>>>0]=128|63&o}}return e[n>>>0]=0,n-a}function G(t){for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e}function N(t){D=t,u.HEAP8=P=new Int8Array(t),u.HEAP16=new Int16Array(t),u.HEAP32=F=new Int32Array(t),u.HEAPU8=U=new Uint8Array(t),u.HEAPU16=new Uint16Array(t),u.HEAPU32=I=new Uint32Array(t),u.HEAPF32=new Float32Array(t),u.HEAPF64=W=new Float64Array(t)}O&&(D=u.buffer);var V=u.INITIAL_MEMORY||16777216;if(O)j=u.wasmMemory,D=u.buffer;else if(u.wasmMemory)j=u.wasmMemory;else if(!((j=new WebAssembly.Memory({initial:V/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw x("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),_&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");j&&(D=j.buffer),V=D.byteLength,N(D);var $,q=[],X=[],J=[],Z=[];function Q(){return R||!1}function K(){var t=u.preRun.shift();q.unshift(t)}var tt,et=0,nt=null,rt=null;function at(t){throw O?postMessage({cmd:"onAbort",arg:t}):u.onAbort&&u.onAbort(t),x(t="Aborted("+t+")"),H=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),s(t),t}function it(){return tt.startsWith("data:application/octet-stream;base64,")}function ot(){var t=tt;try{if(t==tt&&M)return new Uint8Array(M);if(p)return p(t);throw"both async and sync fetching of the wasm failed"}catch(t){at(t)}}tt="ort-wasm-threaded.wasm",it()||(tt=S(tt));var ut={};function ct(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function st(t){(t=ht.Vb[t])||at(),ht.mc(t)}function lt(t){var e=ht.Cc();if(!e)return 6;ht.ac.push(e),ht.Vb[t.Ub]=e,e.Ub=t.Ub;var n={cmd:"run",start_routine:t.Ic,arg:t.zc,pthread_ptr:t.Ub};return e.$b=()=>{n.time=performance.now(),e.postMessage(n,t.Nc)},e.loaded&&(e.$b(),delete e.$b),0}function ft(t){if(O)return $t(1,1,t);Q()||(ht.oc(),u.onExit&&u.onExit(t),H=!0),g(t,new ct(t))}function pt(t,e){if(!e&&O)throw bt(t),"unwind";Q()||O||(me(),dt(J),be(0),re[1].length&&ae(1,10),re[2].length&&ae(2,10),ht.oc()),ft(t)}var ht={Yb:[],ac:[],qc:[],Vb:{},fc:function(){O&&ht.Ec()},Pc:function(){},Ec:function(){ht.receiveObjectTransfer=ht.Gc,ht.threadInitTLS=ht.pc,ht.setExitStatus=ht.nc,R=!1},nc:function(){},oc:function(){for(var t of Object.values(ht.Vb))ht.mc(t);for(t of ht.Yb)t.terminate();ht.Yb=[]},mc:function(t){var e=t.Ub;delete ht.Vb[e],ht.Yb.push(t),ht.ac.splice(ht.ac.indexOf(t),1),t.Ub=0,Oe(e)},Gc:function(){},pc:function(){ht.qc.forEach((t=>t()))},Fc:function(t,e){t.onmessage=n=>{var r=(n=n.data).cmd;if(t.Ub&&(ht.Bc=t.Ub),n.targetThread&&n.targetThread!=he()){var a=ht.Vb[n.Qc];a?a.postMessage(n,n.transferList):x(\'Internal error! Worker sent a message "\'+r+\'" to target pthread \'+n.targetThread+", but that thread no longer exists!")}else"processProxyingQueue"===r?zt(n.queue):"spawnThread"===r?lt(n):"cleanupThread"===r?st(n.thread):"killThread"===r?(n=n.thread,r=ht.Vb[n],delete ht.Vb[n],r.terminate(),Oe(n),ht.ac.splice(ht.ac.indexOf(r),1),r.Ub=0):"cancelThread"===r?ht.Vb[n.thread].postMessage({cmd:"cancel"}):"loaded"===r?(t.loaded=!0,e&&e(t),t.$b&&(t.$b(),delete t.$b)):"print"===r?C("Thread "+n.threadId+": "+n.text):"printErr"===r?x("Thread "+n.threadId+": "+n.text):"alert"===r?alert("Thread "+n.threadId+": "+n.text):"setimmediate"===n.target?t.postMessage(n):"onAbort"===r?u.onAbort&&u.onAbort(n.arg):r&&x("worker sent an unknown command "+r);ht.Bc=void 0},t.onerror=t=>{throw x("worker sent an error! "+t.filename+":"+t.lineno+": "+t.message),t},_&&(t.on("message",(function(e){t.onmessage({data:e})})),t.on("error",(function(e){t.onerror(e)})),t.on("detachedExit",(function(){}))),t.postMessage({cmd:"load",urlOrBlob:u.mainScriptUrlOrBlob||_scriptDir,wasmMemory:j,wasmModule:k})},yc:function(){var t=S("ort-wasm-threaded.worker.js");ht.Yb.push(new Worker(t))},Cc:function(){return 0==ht.Yb.length&&(ht.yc(),ht.Fc(ht.Yb[0])),ht.Yb.pop()}};function dt(t){for(;0<t.length;)t.shift()(u)}function yt(t){var e=Ee();return t=t(),Me(e),t}function bt(t){if(O)return $t(2,0,t);try{pt(t)}catch(t){t instanceof ct||"unwind"==t||g(1,t)}}u.PThread=ht,u.establishStackSpace=function(){var t=he(),e=a()[t+44>>2>>>0];t=a()[t+48>>2>>>0],Te(e,e-t),Me(e)};var mt=[];function gt(t){var e=mt[t];return e||(t>=mt.length&&(mt.length=t+1),mt[t]=e=$.get(t)),e}u.invokeEntryPoint=function(t,e){t=gt(t)(e),Q()?ht.nc(t):Ae(t)};var vt,wt,_t=[],Ot=0,At=0;function St(t){this.Zb=t,this.Sb=t-24,this.xc=function(t){i()[this.Sb+4>>2>>>0]=t},this.bc=function(){return i()[this.Sb+4>>2>>>0]},this.wc=function(t){i()[this.Sb+8>>2>>>0]=t},this.Dc=function(){return i()[this.Sb+8>>2>>>0]},this.rc=function(){a()[this.Sb>>2>>>0]=0},this.hc=function(t){t=t?1:0,e()[this.Sb+12>>0>>>0]=t},this.uc=function(){return 0!=e()[this.Sb+12>>0>>>0]},this.ic=function(t){t=t?1:0,e()[this.Sb+13>>0>>>0]=t},this.kc=function(){return 0!=e()[this.Sb+13>>0>>>0]},this.fc=function(t,e){this.cc(0),this.xc(t),this.wc(e),this.rc(),this.hc(!1),this.ic(!1)},this.sc=function(){Atomics.add(a(),this.Sb>>2,1)},this.Hc=function(){return 1===Atomics.sub(a(),this.Sb>>2,1)},this.cc=function(t){i()[this.Sb+16>>2>>>0]=t},this.tc=function(){return i()[this.Sb+16>>2>>>0]},this.vc=function(){if(Re(this.bc()))return i()[this.Zb>>2>>>0];var t=this.tc();return 0!==t?t:this.Zb}}function Tt(t){return ye(new St(t).Sb)}function Et(t,e,n,r){return O?$t(3,1,t,e,n,r):Mt(t,e,n,r)}function Mt(t,e,n,r){if("undefined"==typeof SharedArrayBuffer)return x("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];return O&&0===a.length?Et(t,e,n,r):(t={Ic:n,Ub:t,zc:r,Nc:a},O?(t.Oc="spawnThread",postMessage(t,a),0):lt(t))}function Ct(t,e,n){return O?$t(4,1,t,e,n):0}function xt(t,e){if(O)return $t(5,1,t,e)}function Rt(t,e){if(O)return $t(6,1,t,e)}function jt(t,e,n){if(O)return $t(7,1,t,e,n)}function kt(t,e,n){return O?$t(8,1,t,e,n):0}function Dt(t,e){if(O)return $t(9,1,t,e)}function Pt(t,e,n){if(O)return $t(10,1,t,e,n)}function Ut(t,e,n,r){if(O)return $t(11,1,t,e,n,r)}function Ft(t,e,n,r){if(O)return $t(12,1,t,e,n,r)}function It(t,e,n,r){if(O)return $t(13,1,t,e,n,r)}function Wt(t){if(O)return $t(14,1,t)}function Ht(t,e){if(O)return $t(15,1,t,e)}function Lt(t,e,n){if(O)return $t(16,1,t,e,n)}function zt(t){Atomics.store(a(),t>>2,1),he()&&_e(t),Atomics.compareExchange(a(),t>>2,1,0)}function Yt(t){return i()[t>>>2]+4294967296*a()[t+4>>>2]}function Bt(t,e,n,r,a,i){return O?$t(17,1,t,e,n,r,a,i):-52}function Gt(t,e,n,r,a,i){if(O)return $t(18,1,t,e,n,r,a,i)}function Nt(t){var n=G(t)+1,r=de(n);return r&&B(t,e(),r,n),r}function Vt(t,e,n){function r(t){return(t=t.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?t[1]:"GMT"}if(O)return $t(19,1,t,e,n);var o=(new Date).getFullYear(),u=new Date(o,0,1),c=new Date(o,6,1);o=u.getTimezoneOffset();var s=c.getTimezoneOffset(),l=Math.max(o,s);a()[t>>2>>>0]=60*l,a()[e>>2>>>0]=Number(o!=s),t=r(u),e=r(c),t=Nt(t),e=Nt(e),s<o?(i()[n>>2>>>0]=t,i()[n+4>>2>>>0]=e):(i()[n>>2>>>0]=e,i()[n+4>>2>>>0]=t)}function $t(t,e){var n=arguments.length-2,r=arguments;return yt((()=>{for(var a=Ce(8*n),i=a>>3,u=0;u<n;u++){var c=r[2+u];o()[i+u>>>0]=c}return we(t,n,a,e)}))}u.executeNotifiedProxyingQueue=zt,wt=_?()=>{var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:O?()=>performance.now()-u.__performance_now_clock_drift:()=>performance.now();var qt,Xt=[],Jt={};function Zt(){if(!qt){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:m||"./this.program"};for(t in Jt)void 0===Jt[t]?delete e[t]:e[t]=Jt[t];var n=[];for(t in e)n.push(t+"="+e[t]);qt=n}return qt}function Qt(t,n){if(O)return $t(20,1,t,n);var r=0;return Zt().forEach((function(a,o){var u=n+r;for(o=i()[t+4*o>>2>>>0]=u,u=0;u<a.length;++u)e()[o++>>0>>>0]=a.charCodeAt(u);e()[o>>0>>>0]=0,r+=a.length+1})),0}function Kt(t,e){if(O)return $t(21,1,t,e);var n=Zt();i()[t>>2>>>0]=n.length;var r=0;return n.forEach((function(t){r+=t.length+1})),i()[e>>2>>>0]=r,0}function te(t){return O?$t(22,1,t):52}function ee(t,e,n,r){return O?$t(23,1,t,e,n,r):52}function ne(t,e,n,r,a){return O?$t(24,1,t,e,n,r,a):70}var re=[null,[],[]];function ae(t,e){var n=re[t];0===e||10===e?((1===t?C:x)(z(n,0)),n.length=0):n.push(e)}function ie(t,e,n,a){if(O)return $t(25,1,t,e,n,a);for(var o=0,u=0;u<n;u++){var c=i()[e>>2>>>0],s=i()[e+4>>2>>>0];e+=8;for(var l=0;l<s;l++)ae(t,r()[c+l>>>0]);o+=s}return i()[a>>2>>>0]=o,0}var oe=0;function ue(t){return 0==t%4&&(0!=t%100||0==t%400)}var ce=[31,29,31,30,31,30,31,31,30,31,30,31],se=[31,28,31,30,31,30,31,31,30,31,30,31];function le(t,n,r,i){function o(t,e,n){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=n[0]+t;return t}function u(t,e){return o(t,e,"0")}function c(t,e){function n(t){return 0>t?-1:0<t?1:0}var r;return 0===(r=n(t.getFullYear()-e.getFullYear()))&&0===(r=n(t.getMonth()-e.getMonth()))&&(r=n(t.getDate()-e.getDate())),r}function s(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function l(t){var e=t.Wb;for(t=new Date(new Date(t.Xb+1900,0,1).getTime());0<e;){var n=t.getMonth(),r=(ue(t.getFullYear())?ce:se)[n];if(!(e>r-t.getDate())){t.setDate(t.getDate()+e);break}e-=r-t.getDate()+1,t.setDate(1),11>n?t.setMonth(n+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return n=new Date(t.getFullYear()+1,0,4),e=s(new Date(t.getFullYear(),0,4)),n=s(n),0>=c(e,t)?0>=c(n,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var f=a()[i+40>>2>>>0];for(var p in i={Lc:a()[i>>2>>>0],Kc:a()[i+4>>2>>>0],dc:a()[i+8>>2>>>0],jc:a()[i+12>>2>>>0],ec:a()[i+16>>2>>>0],Xb:a()[i+20>>2>>>0],Tb:a()[i+24>>2>>>0],Wb:a()[i+28>>2>>>0],Rc:a()[i+32>>2>>>0],Jc:a()[i+36>>2>>>0],Mc:f?Y(f):""},r=Y(r),f={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})r=r.replace(new RegExp(p,"g"),f[p]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),d="January February March April May June July August September October November December".split(" ");for(p in f={"%a":function(t){return h[t.Tb].substring(0,3)},"%A":function(t){return h[t.Tb]},"%b":function(t){return d[t.ec].substring(0,3)},"%B":function(t){return d[t.ec]},"%C":function(t){return u((t.Xb+1900)/100|0,2)},"%d":function(t){return u(t.jc,2)},"%e":function(t){return o(t.jc,2," ")},"%g":function(t){return l(t).toString().substring(2)},"%G":function(t){return l(t)},"%H":function(t){return u(t.dc,2)},"%I":function(t){return 0==(t=t.dc)?t=12:12<t&&(t-=12),u(t,2)},"%j":function(t){for(var e=0,n=0;n<=t.ec-1;e+=(ue(t.Xb+1900)?ce:se)[n++]);return u(t.jc+e,3)},"%m":function(t){return u(t.ec+1,2)},"%M":function(t){return u(t.Kc,2)},"%n":function(){return"\\n"},"%p":function(t){return 0<=t.dc&&12>t.dc?"AM":"PM"},"%S":function(t){return u(t.Lc,2)},"%t":function(){return"\\t"},"%u":function(t){return t.Tb||7},"%U":function(t){return u(Math.floor((t.Wb+7-t.Tb)/7),2)},"%V":function(t){var e=Math.floor((t.Wb+7-(t.Tb+6)%7)/7);if(2>=(t.Tb+371-t.Wb-2)%7&&e++,e)53==e&&(4==(n=(t.Tb+371-t.Wb)%7)||3==n&&ue(t.Xb)||(e=1));else{e=52;var n=(t.Tb+7-t.Wb-1)%7;(4==n||5==n&&ue(t.Xb%400-1))&&e++}return u(e,2)},"%w":function(t){return t.Tb},"%W":function(t){return u(Math.floor((t.Wb+7-(t.Tb+6)%7)/7),2)},"%y":function(t){return(t.Xb+1900).toString().substring(2)},"%Y":function(t){return t.Xb+1900},"%z":function(t){var e=0<=(t=t.Jc);return t=Math.abs(t)/60,(e?"+":"-")+String("0000"+(t/60*100+t%60)).slice(-4)},"%Z":function(t){return t.Mc},"%%":function(){return"%"}},r=r.replace(/%%/g,"\\0\\0"),f)r.includes(p)&&(r=r.replace(new RegExp(p,"g"),f[p](i)));return p=function(t){var e=Array(G(t)+1);return B(t,e,0,e.length),e}(r=r.replace(/\\0\\0/g,"%")),p.length>n?0:(function(t,n){e().set(t,n>>>0)}(p,t),p.length-1)}ht.fc();var fe=[null,ft,bt,Et,Ct,xt,Rt,jt,kt,Dt,Pt,Ut,Ft,It,Wt,Ht,Lt,Bt,Gt,Vt,Qt,Kt,te,ee,ne,ie],pe={b:function(t){return de(t+24)+24},n:function(t){return(t=new St(t)).uc()||(t.hc(!0),Ot--),t.ic(!1),_t.push(t),t.sc(),t.vc()},ma:function(t){throw x("Unexpected exception thrown, this is not properly supported - aborting"),H=!0,t},x:function(){Se(0);var t=_t.pop();if(t.Hc()&&!t.kc()){var e=t.Dc();e&&gt(e)(t.Zb),Tt(t.Zb)}At=0},e:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},l:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},h:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},t:Tt,M:function(){var t=_t.pop();t||at("no exception to throw");var e=t.Zb;throw t.kc()||(_t.push(t),t.ic(!0),t.hc(!1),Ot++),At=e,e},c:function(t,e,n){throw new St(t).fc(e,n),At=t,Ot++,t},pa:function(){return Ot},Fa:function(t){ge(t,!w,1,!v),ht.pc()},T:function(t){O?postMessage({cmd:"cleanupThread",thread:t}):st(t)},xa:Mt,j:function(t){throw At||(At=t),t},H:Ct,Ma:xt,ua:Rt,wa:jt,oa:kt,Ka:Dt,Ca:Pt,Ja:Ut,V:Ft,va:It,sa:Wt,La:Ht,ta:Lt,Ta:function(){},X:function(){at("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ua:function(){at("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},W:function(){return Date.now()},ya:function(){return 2097152},Oa:function(){return!0},za:function(t,e,n,r){if(t==e)setTimeout((()=>zt(r)));else if(O)postMessage({targetThread:t,cmd:"processProxyingQueue",queue:r});else{if(!(t=ht.Vb[t]))return;t.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},Ea:function(){return-1},Pa:function(t,e){t=new Date(1e3*Yt(t)),a()[e>>2>>>0]=t.getUTCSeconds(),a()[e+4>>2>>>0]=t.getUTCMinutes(),a()[e+8>>2>>>0]=t.getUTCHours(),a()[e+12>>2>>>0]=t.getUTCDate(),a()[e+16>>2>>>0]=t.getUTCMonth(),a()[e+20>>2>>>0]=t.getUTCFullYear()-1900,a()[e+24>>2>>>0]=t.getUTCDay(),t=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,a()[e+28>>2>>>0]=t},Qa:function(t,e){t=new Date(1e3*Yt(t)),a()[e>>2>>>0]=t.getSeconds(),a()[e+4>>2>>>0]=t.getMinutes(),a()[e+8>>2>>>0]=t.getHours(),a()[e+12>>2>>>0]=t.getDate(),a()[e+16>>2>>>0]=t.getMonth(),a()[e+20>>2>>>0]=t.getFullYear()-1900,a()[e+24>>2>>>0]=t.getDay();var n=new Date(t.getFullYear(),0,1),r=(t.getTime()-n.getTime())/864e5|0;a()[e+28>>2>>>0]=r,a()[e+36>>2>>>0]=-60*t.getTimezoneOffset(),r=new Date(t.getFullYear(),6,1).getTimezoneOffset(),t=0|(r!=(n=n.getTimezoneOffset())&&t.getTimezoneOffset()==Math.min(n,r)),a()[e+32>>2>>>0]=t},Ra:function(t){var e=new Date(a()[t+20>>2>>>0]+1900,a()[t+16>>2>>>0],a()[t+12>>2>>>0],a()[t+8>>2>>>0],a()[t+4>>2>>>0],a()[t>>2>>>0],0),n=a()[t+32>>2>>>0],r=e.getTimezoneOffset(),i=new Date(e.getFullYear(),0,1),o=new Date(e.getFullYear(),6,1).getTimezoneOffset(),u=i.getTimezoneOffset(),c=Math.min(u,o);return 0>n?a()[t+32>>2>>>0]=Number(o!=u&&c==r):0<n!=(c==r)&&(o=Math.max(u,o),e.setTime(e.getTime()+6e4*((0<n?c:o)-r))),a()[t+24>>2>>>0]=e.getDay(),n=(e.getTime()-i.getTime())/864e5|0,a()[t+28>>2>>>0]=n,a()[t>>2>>>0]=e.getSeconds(),a()[t+4>>2>>>0]=e.getMinutes(),a()[t+8>>2>>>0]=e.getHours(),a()[t+12>>2>>>0]=e.getDate(),a()[t+16>>2>>>0]=e.getMonth(),e.getTime()/1e3|0},Aa:Bt,Ba:Gt,Sa:function t(e,n,r){t.Ac||(t.Ac=!0,Vt(e,n,r))},y:function(){at("")},U:function(){if(!_&&!w){var t="Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread";vt||(vt={}),vt[t]||(vt[t]=1,_&&(t="warning: "+t),x(t))}},ra:function(){return 4294901760},B:wt,Ia:function(t,e,n){r().copyWithin(t>>>0,e>>>0,e+n>>>0)},F:function(){return _?n(993).cpus().length:navigator.hardwareConcurrency},Da:function(t,e,n){Xt.length=e,n>>=3;for(var r=0;r<e;r++)Xt[r]=o()[n+r>>>0];return(0>t?ut[-t-1]:fe[t]).apply(null,Xt)},qa:function(t){var e=r().length;if((t>>>=0)<=e||4294901760<t)return!1;for(var n=1;4>=n;n*=2){var a=e*(1+.2/n);a=Math.min(a,t+100663296);var i=Math;a=Math.max(t,a),i=i.min.call(i,4294901760,a+(65536-a%65536)%65536);t:{try{j.grow(i-D.byteLength+65535>>>16),N(j.buffer);var o=1;break t}catch(t){}o=void 0}if(o)return!0}return!1},Na:function(){throw"unwind"},Ga:Qt,Ha:Kt,J:pt,I:te,S:ee,ga:ne,R:ie,d:function(){return oe},na:function t(r,a){t.lc||(t.lc=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return()=>(crypto.getRandomValues(t),t[0])}if(_)try{var e=n(Object(function(){var t=new Error("Cannot find module \'crypto\'");throw t.code="MODULE_NOT_FOUND",t}()));return()=>e.randomBytes(1)[0]}catch(t){}return()=>at("randomDevice")}());for(var i=0;i<a;i++)e()[r+i>>0>>>0]=t.lc();return 0},ia:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},ja:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},K:function(t){var e=Ee();try{return gt(t)()}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},f:function(t,e){var n=Ee();try{return gt(t)(e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},P:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},Q:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},k:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},p:function(t,e,n,r){var a=Ee();try{return gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},q:function(t,e,n,r,a){var i=Ee();try{return gt(t)(e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},N:function(t,e,n,r,a,i){var o=Ee();try{return gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},s:function(t,e,n,r,a,i){var o=Ee();try{return gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},w:function(t,e,n,r,a,i,o){var u=Ee();try{return gt(t)(e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},L:function(t,e,n,r,a,i,o,u){var c=Ee();try{return gt(t)(e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},E:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=Ee();try{return gt(t)(e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(Me(p),t!==t+0)throw t;Se(1,0)}},aa:function(t,e,n,r,a,i,o,u){var c=Ee();try{return He(t,e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},_:function(t,e,n,r,a,i,o){var u=Ee();try{return ke(t,e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},Z:function(t,e,n,r,a){var i=Ee();try{return Le(t,e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},ca:function(t,e,n,r){var a=Ee();try{return Ie(t,e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},$:function(t){var e=Ee();try{return je(t)}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},ba:function(t,e){var n=Ee();try{return We(t,e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},Y:function(t,e,n){var r=Ee();try{return De(t,e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},g:function(t){var e=Ee();try{gt(t)()}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},r:function(t,e){var n=Ee();try{gt(t)(e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},i:function(t,e,n){var r=Ee();try{gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},ha:function(t,e,n,r){var a=Ee();try{gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},m:function(t,e,n,r){var a=Ee();try{gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},v:function(t,e,n,r,a){var i=Ee();try{gt(t)(e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},u:function(t,e,n,r,a,i){var o=Ee();try{gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},O:function(t,e,n,r,a,i,o){var u=Ee();try{gt(t)(e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},A:function(t,e,n,r,a,i,o,u){var c=Ee();try{gt(t)(e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},ka:function(t,e,n,r,a,i,o,u,c){var s=Ee();try{gt(t)(e,n,r,a,i,o,u,c)}catch(t){if(Me(s),t!==t+0)throw t;Se(1,0)}},C:function(t,e,n,r,a,i,o,u,c,s,l){var f=Ee();try{gt(t)(e,n,r,a,i,o,u,c,s,l)}catch(t){if(Me(f),t!==t+0)throw t;Se(1,0)}},D:function(t,e,n,r,a,i,o,u,c,s,l,f,p,h,d,y){var b=Ee();try{gt(t)(e,n,r,a,i,o,u,c,s,l,f,p,h,d,y)}catch(t){if(Me(b),t!==t+0)throw t;Se(1,0)}},fa:function(t,e,n,r,a,i,o,u){var c=Ee();try{Pe(t,e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},da:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=Ee();try{Fe(t,e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(Me(p),t!==t+0)throw t;Se(1,0)}},ea:function(t,e,n,r,a,i){var o=Ee();try{Ue(t,e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},o:function(t){return t},a:j||u.wasmMemory,G:function(t){oe=t},la:le,z:function(t,e,n,r){return le(t,e,n,r)}};!function(){function t(t,e){u.asm=t.exports,ht.qc.push(u.asm.sb),$=u.asm.ub,X.unshift(u.asm.Va),k=e,O||(et--,u.monitorRunDependencies&&u.monitorRunDependencies(et),0==et&&(null!==nt&&(clearInterval(nt),nt=null),rt&&(t=rt,rt=null,t())))}function e(e){t(e.instance,e.module)}function n(t){return function(){if(!M&&(v||w)){if("function"==typeof fetch&&!tt.startsWith("file://"))return fetch(tt,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at \'"+tt+"\'";return t.arrayBuffer()})).catch((function(){return ot()}));if(f)return new Promise((function(t,e){f(tt,(function(e){t(new Uint8Array(e))}),e)}))}return Promise.resolve().then((function(){return ot()}))}().then((function(t){return WebAssembly.instantiate(t,r)})).then((function(t){return t})).then(t,(function(t){x("failed to asynchronously prepare wasm: "+t),at(t)}))}var r={a:pe};if(O||(et++,u.monitorRunDependencies&&u.monitorRunDependencies(et)),u.instantiateWasm)try{return u.instantiateWasm(r,t)}catch(t){return x("Module.instantiateWasm callback failed with error: "+t),!1}(M||"function"!=typeof WebAssembly.instantiateStreaming||it()||tt.startsWith("file://")||_||"function"!=typeof fetch?n(e):fetch(tt,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,r).then(e,(function(t){return x("wasm streaming compile failed: "+t),x("falling back to ArrayBuffer instantiation"),n(e)}))}))).catch(s)}(),u.___wasm_call_ctors=function(){return(u.___wasm_call_ctors=u.asm.Va).apply(null,arguments)},u._OrtInit=function(){return(u._OrtInit=u.asm.Wa).apply(null,arguments)},u._OrtCreateSessionOptions=function(){return(u._OrtCreateSessionOptions=u.asm.Xa).apply(null,arguments)},u._OrtAppendExecutionProvider=function(){return(u._OrtAppendExecutionProvider=u.asm.Ya).apply(null,arguments)},u._OrtAddSessionConfigEntry=function(){return(u._OrtAddSessionConfigEntry=u.asm.Za).apply(null,arguments)},u._OrtReleaseSessionOptions=function(){return(u._OrtReleaseSessionOptions=u.asm._a).apply(null,arguments)},u._OrtCreateSession=function(){return(u._OrtCreateSession=u.asm.$a).apply(null,arguments)},u._OrtReleaseSession=function(){return(u._OrtReleaseSession=u.asm.ab).apply(null,arguments)},u._OrtGetInputCount=function(){return(u._OrtGetInputCount=u.asm.bb).apply(null,arguments)},u._OrtGetOutputCount=function(){return(u._OrtGetOutputCount=u.asm.cb).apply(null,arguments)},u._OrtGetInputName=function(){return(u._OrtGetInputName=u.asm.db).apply(null,arguments)},u._OrtGetOutputName=function(){return(u._OrtGetOutputName=u.asm.eb).apply(null,arguments)},u._OrtFree=function(){return(u._OrtFree=u.asm.fb).apply(null,arguments)},u._OrtCreateTensor=function(){return(u._OrtCreateTensor=u.asm.gb).apply(null,arguments)},u._OrtGetTensorData=function(){return(u._OrtGetTensorData=u.asm.hb).apply(null,arguments)},u._OrtReleaseTensor=function(){return(u._OrtReleaseTensor=u.asm.ib).apply(null,arguments)},u._OrtCreateRunOptions=function(){return(u._OrtCreateRunOptions=u.asm.jb).apply(null,arguments)},u._OrtAddRunConfigEntry=function(){return(u._OrtAddRunConfigEntry=u.asm.kb).apply(null,arguments)},u._OrtReleaseRunOptions=function(){return(u._OrtReleaseRunOptions=u.asm.lb).apply(null,arguments)},u._OrtRun=function(){return(u._OrtRun=u.asm.mb).apply(null,arguments)},u._OrtEndProfiling=function(){return(u._OrtEndProfiling=u.asm.nb).apply(null,arguments)};var he=u._pthread_self=function(){return(he=u._pthread_self=u.asm.ob).apply(null,arguments)},de=u._malloc=function(){return(de=u._malloc=u.asm.pb).apply(null,arguments)},ye=u._free=function(){return(ye=u._free=u.asm.qb).apply(null,arguments)},be=u._fflush=function(){return(be=u._fflush=u.asm.rb).apply(null,arguments)};u.__emscripten_tls_init=function(){return(u.__emscripten_tls_init=u.asm.sb).apply(null,arguments)};var me=u.___funcs_on_exit=function(){return(me=u.___funcs_on_exit=u.asm.tb).apply(null,arguments)},ge=u.__emscripten_thread_init=function(){return(ge=u.__emscripten_thread_init=u.asm.vb).apply(null,arguments)};u.__emscripten_thread_crashed=function(){return(u.__emscripten_thread_crashed=u.asm.wb).apply(null,arguments)};var ve,we=u._emscripten_run_in_main_runtime_thread_js=function(){return(we=u._emscripten_run_in_main_runtime_thread_js=u.asm.xb).apply(null,arguments)},_e=u.__emscripten_proxy_execute_task_queue=function(){return(_e=u.__emscripten_proxy_execute_task_queue=u.asm.yb).apply(null,arguments)},Oe=u.__emscripten_thread_free_data=function(){return(Oe=u.__emscripten_thread_free_data=u.asm.zb).apply(null,arguments)},Ae=u.__emscripten_thread_exit=function(){return(Ae=u.__emscripten_thread_exit=u.asm.Ab).apply(null,arguments)},Se=u._setThrew=function(){return(Se=u._setThrew=u.asm.Bb).apply(null,arguments)},Te=u._emscripten_stack_set_limits=function(){return(Te=u._emscripten_stack_set_limits=u.asm.Cb).apply(null,arguments)},Ee=u.stackSave=function(){return(Ee=u.stackSave=u.asm.Db).apply(null,arguments)},Me=u.stackRestore=function(){return(Me=u.stackRestore=u.asm.Eb).apply(null,arguments)},Ce=u.stackAlloc=function(){return(Ce=u.stackAlloc=u.asm.Fb).apply(null,arguments)},xe=u.___cxa_can_catch=function(){return(xe=u.___cxa_can_catch=u.asm.Gb).apply(null,arguments)},Re=u.___cxa_is_pointer_type=function(){return(Re=u.___cxa_is_pointer_type=u.asm.Hb).apply(null,arguments)},je=u.dynCall_j=function(){return(je=u.dynCall_j=u.asm.Ib).apply(null,arguments)},ke=u.dynCall_iiiiij=function(){return(ke=u.dynCall_iiiiij=u.asm.Jb).apply(null,arguments)},De=u.dynCall_jii=function(){return(De=u.dynCall_jii=u.asm.Kb).apply(null,arguments)},Pe=u.dynCall_viiiiij=function(){return(Pe=u.dynCall_viiiiij=u.asm.Lb).apply(null,arguments)},Ue=u.dynCall_vjji=function(){return(Ue=u.dynCall_vjji=u.asm.Mb).apply(null,arguments)},Fe=u.dynCall_viiijjjii=function(){return(Fe=u.dynCall_viiijjjii=u.asm.Nb).apply(null,arguments)},Ie=u.dynCall_iij=function(){return(Ie=u.dynCall_iij=u.asm.Ob).apply(null,arguments)},We=u.dynCall_ji=function(){return(We=u.dynCall_ji=u.asm.Pb).apply(null,arguments)},He=u.dynCall_iiiiiij=function(){return(He=u.dynCall_iiiiiij=u.asm.Qb).apply(null,arguments)},Le=u.dynCall_iiij=function(){return(Le=u.dynCall_iiij=u.asm.Rb).apply(null,arguments)};function ze(){function t(){if(!ve&&(ve=!0,u.calledRun=!0,!H)&&(O||dt(X),c(u),u.onRuntimeInitialized&&u.onRuntimeInitialized(),!O)){if(u.postRun)for("function"==typeof u.postRun&&(u.postRun=[u.postRun]);u.postRun.length;){var t=u.postRun.shift();Z.unshift(t)}dt(Z)}}if(!(0<et))if(O)c(u),O||dt(X),postMessage({cmd:"loaded"});else{if(u.preRun)for("function"==typeof u.preRun&&(u.preRun=[u.preRun]);u.preRun.length;)K();dt(q),0<et||(u.setStatus?(u.setStatus("Running..."),setTimeout((function(){setTimeout((function(){u.setStatus("")}),1),t()}),1)):t())}}if(u.UTF8ToString=Y,u.stringToUTF8=function(t,e,n){return B(t,r(),e,n)},u.lengthBytesUTF8=G,u.keepRuntimeAlive=Q,u.wasmMemory=j,u.stackSave=Ee,u.stackRestore=Me,u.stackAlloc=Ce,u.ExitStatus=ct,u.PThread=ht,rt=function t(){ve||ze(),ve||(rt=t)},u.preInit)for("function"==typeof u.preInit&&(u.preInit=[u.preInit]);0<u.preInit.length;)u.preInit.pop()();return ze(),t.ready});t.exports=r},932:(t,e,n)=>{var _scriptDir,r=(_scriptDir=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(t){var e,r,a;t=t||{},e||(e=void 0!==t?t:{}),e.ready=new Promise((function(t,e){r=t,a=e}));var i,o,u,c,s,l,f=Object.assign({},e),p="./this.program",h=(t,e)=>{throw e},d="object"==typeof window,y="function"==typeof importScripts,b="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,m="";b?(m=y?n(908).dirname(m)+"/":"//",l=()=>{s||(c=n(384),s=n(908))},i=function(t,e){return l(),t=s.normalize(t),c.readFileSync(t,e?void 0:"utf8")},u=t=>((t=i(t,!0)).buffer||(t=new Uint8Array(t)),t),o=(t,e,n)=>{l(),t=s.normalize(t),c.readFile(t,(function(t,r){t?n(t):e(r.buffer)}))},1<process.argv.length&&(p=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(t){if(!(t instanceof J))throw t})),process.on("unhandledRejection",(function(t){throw t})),h=(t,e)=>{if(_||0<L)throw process.exitCode=t,e;e instanceof J||w("exiting due to exception: "+e),process.exit(t)},e.inspect=function(){return"[Emscripten Module object]"}):(d||y)&&(y?m=self.location.href:"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),_scriptDir&&(m=_scriptDir),m=0!==m.indexOf("blob:")?m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):"",i=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},y&&(u=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),o=(t,e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n()},r.onerror=n,r.send(null)});var g,v=e.print||console.log.bind(console),w=e.printErr||console.warn.bind(console);Object.assign(e,f),f=null,e.thisProgram&&(p=e.thisProgram),e.quit&&(h=e.quit),e.wasmBinary&&(g=e.wasmBinary);var _=e.noExitRuntime||!1;"object"!=typeof WebAssembly&&V("no native wasm support detected");var O,A,S,T,E,M,C=!1,x="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function R(t,e,n){var r=(e>>>=0)+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&x)return x.decode(t.subarray(e,n));for(r="";e<n;){var a=t[e++];if(128&a){var i=63&t[e++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&t[e++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&t[e++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function j(t,e){return(t>>>=0)?R(T,t,e):""}function k(t,e,n,r){if(!(0<r))return 0;var a=n>>>=0;r=n+r-1;for(var i=0;i<t.length;++i){var o=t.charCodeAt(i);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++i)),127>=o){if(n>=r)break;e[n++>>>0]=o}else{if(2047>=o){if(n+1>=r)break;e[n++>>>0]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++>>>0]=224|o>>12}else{if(n+3>=r)break;e[n++>>>0]=240|o>>18,e[n++>>>0]=128|o>>12&63}e[n++>>>0]=128|o>>6&63}e[n++>>>0]=128|63&o}}return e[n>>>0]=0,n-a}function D(t){for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e}function P(){var t=O.buffer;A=t,e.HEAP8=S=new Int8Array(t),e.HEAP16=new Int16Array(t),e.HEAP32=E=new Int32Array(t),e.HEAPU8=T=new Uint8Array(t),e.HEAPU16=new Uint16Array(t),e.HEAPU32=M=new Uint32Array(t),e.HEAPF32=new Float32Array(t),e.HEAPF64=new Float64Array(t)}var U,F=[],I=[],W=[],H=[],L=0;function z(){var t=e.preRun.shift();F.unshift(t)}var Y,B=0,G=null,N=null;function V(t){throw e.onAbort&&e.onAbort(t),w(t="Aborted("+t+")"),C=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),a(t),t}function $(){return Y.startsWith("data:application/octet-stream;base64,")}if(Y="ort-wasm.wasm",!$()){var q=Y;Y=e.locateFile?e.locateFile(q,m):m+q}function X(){var t=Y;try{if(t==Y&&g)return new Uint8Array(g);if(u)return u(t);throw"both async and sync fetching of the wasm failed"}catch(t){V(t)}}function J(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function Z(t){for(;0<t.length;)t.shift()(e)}var Q=[],K=0,tt=0;function et(t){this.Db=t,this.zb=t-24,this.Ub=function(t){M[this.zb+4>>2>>>0]=t},this.Eb=function(){return M[this.zb+4>>2>>>0]},this.Sb=function(t){M[this.zb+8>>2>>>0]=t},this.Wb=function(){return M[this.zb+8>>2>>>0]},this.Tb=function(){E[this.zb>>2>>>0]=0},this.Ib=function(t){S[this.zb+12>>0>>>0]=t?1:0},this.Pb=function(){return 0!=S[this.zb+12>>0>>>0]},this.Jb=function(t){S[this.zb+13>>0>>>0]=t?1:0},this.Lb=function(){return 0!=S[this.zb+13>>0>>>0]},this.Rb=function(t,e){this.Fb(0),this.Ub(t),this.Sb(e),this.Tb(),this.Ib(!1),this.Jb(!1)},this.Nb=function(){E[this.zb>>2>>>0]+=1},this.Xb=function(){var t=E[this.zb>>2>>>0];return E[this.zb>>2>>>0]=t-1,1===t},this.Fb=function(t){M[this.zb+16>>2>>>0]=t},this.Ob=function(){return M[this.zb+16>>2>>>0]},this.Qb=function(){if(Mt(this.Eb()))return M[this.Db>>2>>>0];var t=this.Ob();return 0!==t?t:this.Db}}function nt(t){return vt(new et(t).zb)}var rt=[];function at(t){var e=rt[t];return e||(t>=rt.length&&(rt.length=t+1),rt[t]=e=U.get(t)),e}function it(t){var e=D(t)+1,n=gt(e);return n&&k(t,S,n,e),n}var ot={};function ut(){if(!ct){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:p||"./this.program"};for(t in ot)void 0===ot[t]?delete e[t]:e[t]=ot[t];var n=[];for(t in e)n.push(t+"="+e[t]);ct=n}return ct}var ct,st=[null,[],[]];function lt(t,e){var n=st[t];0===e||10===e?((1===t?v:w)(R(n,0)),n.length=0):n.push(e)}var ft=0;function pt(t){return 0==t%4&&(0!=t%100||0==t%400)}var ht=[31,29,31,30,31,30,31,31,30,31,30,31],dt=[31,28,31,30,31,30,31,31,30,31,30,31];function yt(t,e,n,r){function a(t,e,n){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=n[0]+t;return t}function i(t,e){return a(t,e,"0")}function o(t,e){function n(t){return 0>t?-1:0<t?1:0}var r;return 0===(r=n(t.getFullYear()-e.getFullYear()))&&0===(r=n(t.getMonth()-e.getMonth()))&&(r=n(t.getDate()-e.getDate())),r}function u(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function c(t){var e=t.Bb;for(t=new Date(new Date(t.Cb+1900,0,1).getTime());0<e;){var n=t.getMonth(),r=(pt(t.getFullYear())?ht:dt)[n];if(!(e>r-t.getDate())){t.setDate(t.getDate()+e);break}e-=r-t.getDate()+1,t.setDate(1),11>n?t.setMonth(n+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return n=new Date(t.getFullYear()+1,0,4),e=u(new Date(t.getFullYear(),0,4)),n=u(n),0>=o(e,t)?0>=o(n,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var s=E[r+40>>2>>>0];for(var l in r={$b:E[r>>2>>>0],Zb:E[r+4>>2>>>0],Gb:E[r+8>>2>>>0],Kb:E[r+12>>2>>>0],Hb:E[r+16>>2>>>0],Cb:E[r+20>>2>>>0],Ab:E[r+24>>2>>>0],Bb:E[r+28>>2>>>0],bc:E[r+32>>2>>>0],Yb:E[r+36>>2>>>0],ac:s?j(s):""},n=j(n),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(l,"g"),s[l]);var f="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),p="January February March April May June July August September October November December".split(" ");for(l in s={"%a":function(t){return f[t.Ab].substring(0,3)},"%A":function(t){return f[t.Ab]},"%b":function(t){return p[t.Hb].substring(0,3)},"%B":function(t){return p[t.Hb]},"%C":function(t){return i((t.Cb+1900)/100|0,2)},"%d":function(t){return i(t.Kb,2)},"%e":function(t){return a(t.Kb,2," ")},"%g":function(t){return c(t).toString().substring(2)},"%G":function(t){return c(t)},"%H":function(t){return i(t.Gb,2)},"%I":function(t){return 0==(t=t.Gb)?t=12:12<t&&(t-=12),i(t,2)},"%j":function(t){for(var e=0,n=0;n<=t.Hb-1;e+=(pt(t.Cb+1900)?ht:dt)[n++]);return i(t.Kb+e,3)},"%m":function(t){return i(t.Hb+1,2)},"%M":function(t){return i(t.Zb,2)},"%n":function(){return"\\n"},"%p":function(t){return 0<=t.Gb&&12>t.Gb?"AM":"PM"},"%S":function(t){return i(t.$b,2)},"%t":function(){return"\\t"},"%u":function(t){return t.Ab||7},"%U":function(t){return i(Math.floor((t.Bb+7-t.Ab)/7),2)},"%V":function(t){var e=Math.floor((t.Bb+7-(t.Ab+6)%7)/7);if(2>=(t.Ab+371-t.Bb-2)%7&&e++,e)53==e&&(4==(n=(t.Ab+371-t.Bb)%7)||3==n&&pt(t.Cb)||(e=1));else{e=52;var n=(t.Ab+7-t.Bb-1)%7;(4==n||5==n&&pt(t.Cb%400-1))&&e++}return i(e,2)},"%w":function(t){return t.Ab},"%W":function(t){return i(Math.floor((t.Bb+7-(t.Ab+6)%7)/7),2)},"%y":function(t){return(t.Cb+1900).toString().substring(2)},"%Y":function(t){return t.Cb+1900},"%z":function(t){var e=0<=(t=t.Yb);return t=Math.abs(t)/60,(e?"+":"-")+String("0000"+(t/60*100+t%60)).slice(-4)},"%Z":function(t){return t.ac},"%%":function(){return"%"}},n=n.replace(/%%/g,"\\0\\0"),s)n.includes(l)&&(n=n.replace(new RegExp(l,"g"),s[l](r)));return l=function(t){var e=Array(D(t)+1);return k(t,e,0,e.length),e}(n=n.replace(/\\0\\0/g,"%")),l.length>e?0:(S.set(l,t>>>0),l.length-1)}var bt={a:function(t){return gt(t+24)+24},m:function(t){return(t=new et(t)).Pb()||(t.Ib(!0),K--),t.Jb(!1),Q.push(t),t.Nb(),t.Qb()},ia:function(t){throw w("Unexpected exception thrown, this is not properly supported - aborting"),C=!0,t},w:function(){Ot(0);var t=Q.pop();if(t.Xb()&&!t.Lb()){var e=t.Wb();e&&at(e)(t.Db),nt(t.Db)}tt=0},d:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},k:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},g:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},s:nt,L:function(){var t=Q.pop();t||V("no exception to throw");var e=t.Db;throw t.Lb()||(Q.push(t),t.Jb(!0),t.Ib(!1),K++),tt=e,e},b:function(t,e,n){throw new et(t).Rb(e,n),tt=t,K++,t},la:function(){return K},i:function(t){throw tt||(tt=t),t},H:function(){return 0},Ba:function(){},pa:function(){},ra:function(){},ka:function(){return 0},za:function(){},ua:function(){},ya:function(){},R:function(){},qa:function(){},na:function(){},Aa:function(){},oa:function(){},Ha:function(){},Ja:function(){V("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ia:function(){V("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},S:function(){return Date.now()},Ca:function(){return!0},Da:function(t,e){t=new Date(1e3*(M[t>>>2]+4294967296*E[t+4>>>2])),E[e>>2>>>0]=t.getUTCSeconds(),E[e+4>>2>>>0]=t.getUTCMinutes(),E[e+8>>2>>>0]=t.getUTCHours(),E[e+12>>2>>>0]=t.getUTCDate(),E[e+16>>2>>>0]=t.getUTCMonth(),E[e+20>>2>>>0]=t.getUTCFullYear()-1900,E[e+24>>2>>>0]=t.getUTCDay(),E[e+28>>2>>>0]=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},Ea:function(t,e){t=new Date(1e3*(M[t>>>2]+4294967296*E[t+4>>>2])),E[e>>2>>>0]=t.getSeconds(),E[e+4>>2>>>0]=t.getMinutes(),E[e+8>>2>>>0]=t.getHours(),E[e+12>>2>>>0]=t.getDate(),E[e+16>>2>>>0]=t.getMonth(),E[e+20>>2>>>0]=t.getFullYear()-1900,E[e+24>>2>>>0]=t.getDay();var n=new Date(t.getFullYear(),0,1);E[e+28>>2>>>0]=(t.getTime()-n.getTime())/864e5|0,E[e+36>>2>>>0]=-60*t.getTimezoneOffset();var r=new Date(t.getFullYear(),6,1).getTimezoneOffset();n=n.getTimezoneOffset(),E[e+32>>2>>>0]=0|(r!=n&&t.getTimezoneOffset()==Math.min(n,r))},Fa:function(t){var e=new Date(E[t+20>>2>>>0]+1900,E[t+16>>2>>>0],E[t+12>>2>>>0],E[t+8>>2>>>0],E[t+4>>2>>>0],E[t>>2>>>0],0),n=E[t+32>>2>>>0],r=e.getTimezoneOffset(),a=new Date(e.getFullYear(),0,1),i=new Date(e.getFullYear(),6,1).getTimezoneOffset(),o=a.getTimezoneOffset(),u=Math.min(o,i);return 0>n?E[t+32>>2>>>0]=Number(i!=o&&u==r):0<n!=(u==r)&&(i=Math.max(o,i),e.setTime(e.getTime()+6e4*((0<n?u:i)-r))),E[t+24>>2>>>0]=e.getDay(),E[t+28>>2>>>0]=(e.getTime()-a.getTime())/864e5|0,E[t>>2>>>0]=e.getSeconds(),E[t+4>>2>>>0]=e.getMinutes(),E[t+8>>2>>>0]=e.getHours(),E[t+12>>2>>>0]=e.getDate(),E[t+16>>2>>>0]=e.getMonth(),e.getTime()/1e3|0},sa:function(){return-52},ta:function(){},Ga:function t(e,n,r){t.Vb||(t.Vb=!0,function(t,e,n){function r(t){return(t=t.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?t[1]:"GMT"}var a=(new Date).getFullYear(),i=new Date(a,0,1),o=new Date(a,6,1);a=i.getTimezoneOffset();var u=o.getTimezoneOffset();E[t>>2>>>0]=60*Math.max(a,u),E[e>>2>>>0]=Number(a!=u),t=r(i),e=r(o),t=it(t),e=it(e),u<a?(M[n>>2>>>0]=t,M[n+4>>2>>>0]=e):(M[n>>2>>>0]=e,M[n+4>>2>>>0]=t)}(e,n,r))},B:function(){V("")},ma:function(){return 4294901760},I:b?()=>{var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:()=>performance.now(),xa:function(t,e,n){T.copyWithin(t>>>0,e>>>0,e+n>>>0)},G:function(t){var e=T.length;if(4294901760<(t>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=e*(1+.2/n);r=Math.min(r,t+100663296);var a=Math;r=Math.max(t,r),a=a.min.call(a,4294901760,r+(65536-r%65536)%65536);t:{try{O.grow(a-A.byteLength+65535>>>16),P();var i=1;break t}catch(t){}i=void 0}if(i)return!0}return!1},va:function(t,e){var n=0;return ut().forEach((function(r,a){var i=e+n;for(a=M[t+4*a>>2>>>0]=i,i=0;i<r.length;++i)S[a++>>0>>>0]=r.charCodeAt(i);S[a>>0>>>0]=0,n+=r.length+1})),0},wa:function(t,e){var n=ut();M[t>>2>>>0]=n.length;var r=0;return n.forEach((function(t){r+=t.length+1})),M[e>>2>>>0]=r,0},ba:function(t){_||0<L||(_t(),Z(W),wt(0),st[1].length&&lt(1,10),st[2].length&&lt(2,10)),_||0<L||(e.onExit&&e.onExit(t),C=!0),h(t,new J(t))},E:function(){return 52},Q:function(){return 52},ca:function(){return 70},P:function(t,e,n,r){for(var a=0,i=0;i<n;i++){var o=M[e>>2>>>0],u=M[e+4>>2>>>0];e+=8;for(var c=0;c<u;c++)lt(t,T[o+c>>>0]);a+=u}return M[r>>2>>>0]=a,0},c:function(){return ft},ja:function t(e,r){t.Mb||(t.Mb=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return()=>(crypto.getRandomValues(t),t[0])}if(b)try{var e=n(Object(function(){var t=new Error("Cannot find module \'crypto\'");throw t.code="MODULE_NOT_FOUND",t}()));return()=>e.randomBytes(1)[0]}catch(t){}return()=>V("randomDevice")}());for(var a=0;a<r;a++)S[e+a>>0>>>0]=t.Mb();return 0},ea:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},fa:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},J:function(t){var e=At();try{return at(t)()}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},e:function(t,e){var n=At();try{return at(t)(e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},N:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},O:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},j:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},o:function(t,e,n,r){var a=At();try{return at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},p:function(t,e,n,r,a){var i=At();try{return at(t)(e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},M:function(t,e,n,r,a,i){var o=At();try{return at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},r:function(t,e,n,r,a,i){var o=At();try{return at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},v:function(t,e,n,r,a,i,o){var u=At();try{return at(t)(e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},K:function(t,e,n,r,a,i,o,u){var c=At();try{return at(t)(e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},D:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=At();try{return at(t)(e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(St(p),t!==t+0)throw t;Ot(1,0)}},X:function(t,e,n,r,a,i,o,u){var c=At();try{return Ft(t,e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},V:function(t,e,n,r,a,i,o){var u=At();try{return xt(t,e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},U:function(t,e,n,r,a){var i=At();try{return It(t,e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},Z:function(t,e,n,r){var a=At();try{return Pt(t,e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},W:function(t){var e=At();try{return Ct(t)}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},Y:function(t,e){var n=At();try{return Ut(t,e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},T:function(t,e,n){var r=At();try{return Rt(t,e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},f:function(t){var e=At();try{at(t)()}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},q:function(t,e){var n=At();try{at(t)(e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},h:function(t,e,n){var r=At();try{at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},da:function(t,e,n,r){var a=At();try{at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},l:function(t,e,n,r){var a=At();try{at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},t:function(t,e,n,r,a){var i=At();try{at(t)(e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},u:function(t,e,n,r,a,i){var o=At();try{at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},x:function(t,e,n,r,a,i,o){var u=At();try{at(t)(e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},z:function(t,e,n,r,a,i,o,u){var c=At();try{at(t)(e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},ga:function(t,e,n,r,a,i,o,u,c){var s=At();try{at(t)(e,n,r,a,i,o,u,c)}catch(t){if(St(s),t!==t+0)throw t;Ot(1,0)}},A:function(t,e,n,r,a,i,o,u,c,s,l){var f=At();try{at(t)(e,n,r,a,i,o,u,c,s,l)}catch(t){if(St(f),t!==t+0)throw t;Ot(1,0)}},C:function(t,e,n,r,a,i,o,u,c,s,l,f,p,h,d,y){var b=At();try{at(t)(e,n,r,a,i,o,u,c,s,l,f,p,h,d,y)}catch(t){if(St(b),t!==t+0)throw t;Ot(1,0)}},aa:function(t,e,n,r,a,i,o,u){var c=At();try{jt(t,e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},_:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=At();try{Dt(t,e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(St(p),t!==t+0)throw t;Ot(1,0)}},$:function(t,e,n,r,a,i){var o=At();try{kt(t,e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},n:function(t){return t},F:function(t){ft=t},ha:yt,y:function(t,e,n,r){return yt(t,e,n,r)}};!function(){function t(t){e.asm=t.exports,O=e.asm.Ka,P(),U=e.asm.ib,I.unshift(e.asm.La),B--,e.monitorRunDependencies&&e.monitorRunDependencies(B),0==B&&(null!==G&&(clearInterval(G),G=null),N&&(t=N,N=null,t()))}function n(e){t(e.instance)}function r(t){return function(){if(!g&&(d||y)){if("function"==typeof fetch&&!Y.startsWith("file://"))return fetch(Y,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at \'"+Y+"\'";return t.arrayBuffer()})).catch((function(){return X()}));if(o)return new Promise((function(t,e){o(Y,(function(e){t(new Uint8Array(e))}),e)}))}return Promise.resolve().then((function(){return X()}))}().then((function(t){return WebAssembly.instantiate(t,i)})).then((function(t){return t})).then(t,(function(t){w("failed to asynchronously prepare wasm: "+t),V(t)}))}var i={a:bt};if(B++,e.monitorRunDependencies&&e.monitorRunDependencies(B),e.instantiateWasm)try{return e.instantiateWasm(i,t)}catch(t){return w("Module.instantiateWasm callback failed with error: "+t),!1}(g||"function"!=typeof WebAssembly.instantiateStreaming||$()||Y.startsWith("file://")||b||"function"!=typeof fetch?r(n):fetch(Y,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,i).then(n,(function(t){return w("wasm streaming compile failed: "+t),w("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(a)}(),e.___wasm_call_ctors=function(){return(e.___wasm_call_ctors=e.asm.La).apply(null,arguments)},e._OrtInit=function(){return(e._OrtInit=e.asm.Ma).apply(null,arguments)},e._OrtCreateSessionOptions=function(){return(e._OrtCreateSessionOptions=e.asm.Na).apply(null,arguments)},e._OrtAppendExecutionProvider=function(){return(e._OrtAppendExecutionProvider=e.asm.Oa).apply(null,arguments)},e._OrtAddSessionConfigEntry=function(){return(e._OrtAddSessionConfigEntry=e.asm.Pa).apply(null,arguments)},e._OrtReleaseSessionOptions=function(){return(e._OrtReleaseSessionOptions=e.asm.Qa).apply(null,arguments)},e._OrtCreateSession=function(){return(e._OrtCreateSession=e.asm.Ra).apply(null,arguments)},e._OrtReleaseSession=function(){return(e._OrtReleaseSession=e.asm.Sa).apply(null,arguments)},e._OrtGetInputCount=function(){return(e._OrtGetInputCount=e.asm.Ta).apply(null,arguments)},e._OrtGetOutputCount=function(){return(e._OrtGetOutputCount=e.asm.Ua).apply(null,arguments)},e._OrtGetInputName=function(){return(e._OrtGetInputName=e.asm.Va).apply(null,arguments)},e._OrtGetOutputName=function(){return(e._OrtGetOutputName=e.asm.Wa).apply(null,arguments)},e._OrtFree=function(){return(e._OrtFree=e.asm.Xa).apply(null,arguments)},e._OrtCreateTensor=function(){return(e._OrtCreateTensor=e.asm.Ya).apply(null,arguments)},e._OrtGetTensorData=function(){return(e._OrtGetTensorData=e.asm.Za).apply(null,arguments)},e._OrtReleaseTensor=function(){return(e._OrtReleaseTensor=e.asm._a).apply(null,arguments)},e._OrtCreateRunOptions=function(){return(e._OrtCreateRunOptions=e.asm.$a).apply(null,arguments)},e._OrtAddRunConfigEntry=function(){return(e._OrtAddRunConfigEntry=e.asm.ab).apply(null,arguments)},e._OrtReleaseRunOptions=function(){return(e._OrtReleaseRunOptions=e.asm.bb).apply(null,arguments)},e._OrtRun=function(){return(e._OrtRun=e.asm.cb).apply(null,arguments)},e._OrtEndProfiling=function(){return(e._OrtEndProfiling=e.asm.db).apply(null,arguments)};var mt,gt=e._malloc=function(){return(gt=e._malloc=e.asm.eb).apply(null,arguments)},vt=e._free=function(){return(vt=e._free=e.asm.fb).apply(null,arguments)},wt=e._fflush=function(){return(wt=e._fflush=e.asm.gb).apply(null,arguments)},_t=e.___funcs_on_exit=function(){return(_t=e.___funcs_on_exit=e.asm.hb).apply(null,arguments)},Ot=e._setThrew=function(){return(Ot=e._setThrew=e.asm.jb).apply(null,arguments)},At=e.stackSave=function(){return(At=e.stackSave=e.asm.kb).apply(null,arguments)},St=e.stackRestore=function(){return(St=e.stackRestore=e.asm.lb).apply(null,arguments)},Tt=e.stackAlloc=function(){return(Tt=e.stackAlloc=e.asm.mb).apply(null,arguments)},Et=e.___cxa_can_catch=function(){return(Et=e.___cxa_can_catch=e.asm.nb).apply(null,arguments)},Mt=e.___cxa_is_pointer_type=function(){return(Mt=e.___cxa_is_pointer_type=e.asm.ob).apply(null,arguments)},Ct=e.dynCall_j=function(){return(Ct=e.dynCall_j=e.asm.pb).apply(null,arguments)},xt=e.dynCall_iiiiij=function(){return(xt=e.dynCall_iiiiij=e.asm.qb).apply(null,arguments)},Rt=e.dynCall_jii=function(){return(Rt=e.dynCall_jii=e.asm.rb).apply(null,arguments)},jt=e.dynCall_viiiiij=function(){return(jt=e.dynCall_viiiiij=e.asm.sb).apply(null,arguments)},kt=e.dynCall_vjji=function(){return(kt=e.dynCall_vjji=e.asm.tb).apply(null,arguments)},Dt=e.dynCall_viiijjjii=function(){return(Dt=e.dynCall_viiijjjii=e.asm.ub).apply(null,arguments)},Pt=e.dynCall_iij=function(){return(Pt=e.dynCall_iij=e.asm.vb).apply(null,arguments)},Ut=e.dynCall_ji=function(){return(Ut=e.dynCall_ji=e.asm.wb).apply(null,arguments)},Ft=e.dynCall_iiiiiij=function(){return(Ft=e.dynCall_iiiiiij=e.asm.xb).apply(null,arguments)},It=e.dynCall_iiij=function(){return(It=e.dynCall_iiij=e.asm.yb).apply(null,arguments)};function Wt(){function t(){if(!mt&&(mt=!0,e.calledRun=!0,!C)){if(Z(I),r(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;){var t=e.postRun.shift();H.unshift(t)}Z(H)}}if(!(0<B)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)z();Z(F),0<B||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),t()}),1)):t())}}if(e.UTF8ToString=j,e.stringToUTF8=function(t,e,n){return k(t,T,e,n)},e.lengthBytesUTF8=D,e.stackSave=At,e.stackRestore=St,e.stackAlloc=Tt,N=function t(){mt||Wt(),mt||(N=t)},e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();return Wt(),t.ready});t.exports=r},967:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.iterateExtraOptions=void 0,e.iterateExtraOptions=(t,n,r,a)=>{if("object"==typeof t&&null!==t){if(r.has(t))throw new Error("Circular reference in options");r.add(t)}Object.entries(t).forEach((([t,i])=>{const o=n?n+t:t;if("object"==typeof i)(0,e.iterateExtraOptions)(i,o+".",r,a);else if("string"==typeof i||"number"==typeof i)a(o,i.toString());else{if("boolean"!=typeof i)throw new Error("Can\'t handle extra config type: "+typeof i);a(o,i?"1":"0")}}))}},586:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setRunOptions=void 0;const r=n(967),a=n(983),i=n(361);e.setRunOptions=t=>{const e=(0,i.getInstance)();let n=0;const o=[],u=t||{};try{if(void 0===(null==t?void 0:t.logSeverityLevel))u.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===(null==t?void 0:t.logVerbosityLevel))u.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);void 0===(null==t?void 0:t.terminate)&&(u.terminate=!1);let i=0;if(void 0!==(null==t?void 0:t.tag)&&(i=(0,a.allocWasmString)(t.tag,o)),n=e._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,i),0===n)throw new Error("Can\'t create run options");return void 0!==(null==t?void 0:t.extra)&&(0,r.iterateExtraOptions)(t.extra,"",new WeakSet,((t,r)=>{const i=(0,a.allocWasmString)(t,o),u=(0,a.allocWasmString)(r,o);if(0!==e._OrtAddRunConfigEntry(n,i,u))throw new Error(`Can\'t set a run config entry: ${t} - ${r}`)})),[n,o]}catch(t){throw 0!==n&&e._OrtReleaseRunOptions(n),o.forEach(e._free),t}}},919:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setSessionOptions=void 0;const r=n(967),a=n(983),i=n(361);e.setSessionOptions=t=>{const e=(0,i.getInstance)();let n=0;const o=[],u=t||{};(t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});const e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1")})(u);try{void 0===(null==t?void 0:t.graphOptimizationLevel)&&(u.graphOptimizationLevel="all");const c=(t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}})(u.graphOptimizationLevel);void 0===(null==t?void 0:t.enableCpuMemArena)&&(u.enableCpuMemArena=!0),void 0===(null==t?void 0:t.enableMemPattern)&&(u.enableMemPattern=!0),void 0===(null==t?void 0:t.executionMode)&&(u.executionMode="sequential");const s=(t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}})(u.executionMode);let l=0;if(void 0!==(null==t?void 0:t.logId)&&(l=(0,a.allocWasmString)(t.logId,o)),void 0===(null==t?void 0:t.logSeverityLevel))u.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===(null==t?void 0:t.logVerbosityLevel))u.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);if(void 0===(null==t?void 0:t.enableProfiling)&&(u.enableProfiling=!1),n=e._OrtCreateSessionOptions(c,!!u.enableCpuMemArena,!!u.enableMemPattern,s,!!u.enableProfiling,0,l,u.logSeverityLevel,u.logVerbosityLevel),0===n)throw new Error("Can\'t create session options");return(null==t?void 0:t.executionProviders)&&((t,e,n)=>{for(const r of e){let e="string"==typeof r?r:r.name;switch(e){case"xnnpack":e="XNNPACK";break;case"wasm":case"cpu":continue;default:throw new Error(`not supported EP: ${e}`)}const o=(0,a.allocWasmString)(e,n);if(0!==(0,i.getInstance)()._OrtAppendExecutionProvider(t,o))throw new Error(`Can\'t append execution provider: ${e}`)}})(n,t.executionProviders,o),void 0!==(null==t?void 0:t.extra)&&(0,r.iterateExtraOptions)(t.extra,"",new WeakSet,((t,r)=>{const i=(0,a.allocWasmString)(t,o),u=(0,a.allocWasmString)(r,o);if(0!==e._OrtAddSessionConfigEntry(n,i,u))throw new Error(`Can\'t set a session config entry: ${t} - ${r}`)})),[n,o]}catch(t){throw 0!==n&&e._OrtReleaseSessionOptions(n),o.forEach(e._free),t}}},983:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.allocWasmString=void 0;const r=n(361);e.allocWasmString=(t,e)=>{const n=(0,r.getInstance)(),a=n.lengthBytesUTF8(t)+1,i=n._malloc(a);return n.stringToUTF8(t,i,a),e.push(i),i}},349:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.extractTransferableBuffers=e.endProfiling=e.run=e.releaseSession=e.createSession=e.createSessionFinalize=e.createSessionAllocate=e.initOrt=void 0;const r=n(586),a=n(919),i=n(983),o=n(361);e.initOrt=(t,e)=>{const n=(0,o.getInstance)()._OrtInit(t,e);if(0!==n)throw new Error(`Can\'t initialize onnxruntime. error code = ${n}`)};const u=new Map;e.createSessionAllocate=t=>{const e=(0,o.getInstance)(),n=e._malloc(t.byteLength);return e.HEAPU8.set(t,n),[n,t.byteLength]},e.createSessionFinalize=(t,e)=>{const n=(0,o.getInstance)();let r=0,i=0,c=[];try{if([i,c]=(0,a.setSessionOptions)(e),r=n._OrtCreateSession(t[0],t[1],i),0===r)throw new Error("Can\'t create a session")}finally{n._free(t[0]),n._OrtReleaseSessionOptions(i),c.forEach(n._free)}const s=n._OrtGetInputCount(r),l=n._OrtGetOutputCount(r),f=[],p=[],h=[],d=[];for(let t=0;t<s;t++){const e=n._OrtGetInputName(r,t);if(0===e)throw new Error("Can\'t get an input name");p.push(e),f.push(n.UTF8ToString(e))}for(let t=0;t<l;t++){const e=n._OrtGetOutputName(r,t);if(0===e)throw new Error("Can\'t get an output name");d.push(e),h.push(n.UTF8ToString(e))}return u.set(r,[r,p,d]),[r,f,h]},e.createSession=(t,n)=>{const r=(0,e.createSessionAllocate)(t);return(0,e.createSessionFinalize)(r,n)},e.releaseSession=t=>{const e=(0,o.getInstance)(),n=u.get(t);if(!n)throw new Error("invalid session id");const r=n[0],a=n[1],i=n[2];a.forEach(e._OrtFree),i.forEach(e._OrtFree),e._OrtReleaseSession(r),u.delete(t)};const c=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${t}`)}},s=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${t}`)}},l=t=>{switch(t){case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}};e.run=(t,e,n,a,f)=>{const p=(0,o.getInstance)(),h=u.get(t);if(!h)throw new Error("invalid session id");const d=h[0],y=h[1],b=h[2],m=e.length,g=a.length;let v=0,w=[];const _=[],O=[];try{[v,w]=(0,r.setRunOptions)(f);for(let t=0;t<m;t++){const e=n[t][0],r=n[t][1],a=n[t][2];let o,u;if(Array.isArray(a)){u=4*a.length,o=p._malloc(u),O.push(o);let t=o/4;for(let e=0;e<a.length;e++){if("string"!=typeof a[e])throw new TypeError(`tensor data at index ${e} is not a string`);p.HEAPU32[t++]=(0,i.allocWasmString)(a[e],O)}}else u=a.byteLength,o=p._malloc(u),O.push(o),p.HEAPU8.set(new Uint8Array(a.buffer,a.byteOffset,u),o);const s=p.stackSave(),l=p.stackAlloc(4*r.length);try{let t=l/4;r.forEach((e=>p.HEAP32[t++]=e));const n=p._OrtCreateTensor(c(e),o,u,l,r.length);if(0===n)throw new Error("Can\'t create a tensor");_.push(n)}finally{p.stackRestore(s)}}const t=p.stackSave(),o=p.stackAlloc(4*m),u=p.stackAlloc(4*m),h=p.stackAlloc(4*g),A=p.stackAlloc(4*g);try{let n=o/4,r=u/4,i=h/4,c=A/4;for(let t=0;t<m;t++)p.HEAPU32[n++]=_[t],p.HEAPU32[r++]=y[e[t]];for(let t=0;t<g;t++)p.HEAPU32[i++]=0,p.HEAPU32[c++]=b[a[t]];let f=p._OrtRun(d,u,o,m,A,g,h,v);const w=[];if(0===f)for(let t=0;t<g;t++){const e=p.HEAPU32[h/4+t],n=p.stackSave(),r=p.stackAlloc(16);let a,i=0;try{if(f=p._OrtGetTensorData(e,r,r+4,r+8,r+12),0!==f)throw new Error(`Can\'t access output tensor data. error code = ${f}`);let t=r/4;const o=p.HEAPU32[t++];i=p.HEAPU32[t++];const u=p.HEAPU32[t++],c=p.HEAPU32[t++],h=[];for(let t=0;t<c;t++)h.push(p.HEAPU32[u/4+t]);p._OrtFree(u);const d=0===h.length?1:h.reduce(((t,e)=>t*e));if(a=s(o),"string"===a){const t=[];let e=i/4;for(let n=0;n<d;n++){const r=p.HEAPU32[e++],a=n===d-1?void 0:p.HEAPU32[e]-r;t.push(p.UTF8ToString(r,a))}w.push([a,h,t])}else{const t=new(l(a))(d);new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(p.HEAPU8.subarray(i,i+t.byteLength)),w.push([a,h,t])}}finally{p.stackRestore(n),"string"===a&&i&&p._free(i),p._OrtReleaseTensor(e)}}if(0===f)return w;throw new Error(`failed to call OrtRun(). error code = ${f}.`)}finally{p.stackRestore(t)}}finally{_.forEach(p._OrtReleaseTensor),O.forEach(p._free),p._OrtReleaseRunOptions(v),w.forEach(p._free)}},e.endProfiling=t=>{const e=(0,o.getInstance)(),n=u.get(t);if(!n)throw new Error("invalid session id");const r=n[0],a=e._OrtEndProfiling(r);if(0===a)throw new Error("Can\'t get an profile file name");e._OrtFree(a)},e.extractTransferableBuffers=t=>{const e=[];for(const n of t){const t=n[2];!Array.isArray(t)&&t.buffer&&e.push(t.buffer)}return e}},361:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(e,n);a&&!("get"in a?!e.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,a)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),a=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&r(e,t,n);return a(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.dispose=e.getInstance=e.initializeWebAssembly=void 0;const u=i(n(449)),c=o(n(932)),s=n(474);let l,f=!1,p=!1,h=!1;const d=(t,e)=>e?t?"ort-wasm-simd-threaded.wasm":"ort-wasm-threaded.wasm":t?"ort-wasm-simd.wasm":"ort-wasm.wasm";e.initializeWebAssembly=async t=>{if(f)return Promise.resolve();if(p)throw new Error("multiple calls to \'initializeWebAssembly()\' detected.");if(h)throw new Error("previous call to \'initializeWebAssembly()\' failed.");p=!0;const e=t.initTimeout,r=t.numThreads,a=t.simd,i=r>1&&(()=>{try{return"undefined"!=typeof SharedArrayBuffer&&("undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch(t){return!1}})(),o=a&&(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch(t){return!1}})(),y="string"==typeof t.wasmPaths?t.wasmPaths:void 0,b=d(!1,i),m=d(o,i),g="object"==typeof t.wasmPaths?t.wasmPaths[m]:void 0;let v=!1;const w=[];if(e>0&&w.push(new Promise((t=>{setTimeout((()=>{v=!0,t()}),e)}))),w.push(new Promise(((t,e)=>{const r=i?s:c.default,a={locateFile:(t,e)=>i&&t.endsWith(".worker.js")&&"undefined"!=typeof Blob?URL.createObjectURL(new Blob([n(154)],{type:"text/javascript"})):t===b?null!=g?g:(null!=y?y:e)+m:e+t};if(i)if("undefined"==typeof Blob)a.mainScriptUrlOrBlob=u.join("/","ort-wasm-threaded.js");else{const t=`var ortWasmThreaded=(function(){var _scriptDir;return ${r.toString()}})();`;a.mainScriptUrlOrBlob=new Blob([t],{type:"text/javascript"})}r(a).then((e=>{p=!1,f=!0,l=e,t()}),(t=>{p=!1,h=!0,e(t)}))}))),await Promise.race(w),v)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},e.getInstance=()=>{if(f&&l)return l;throw new Error("WebAssembly is not initialized yet.")},e.dispose=()=>{var t;!f||p||h||(p=!0,null===(t=l.PThread)||void 0===t||t.terminateAllThreads(),l=void 0,p=!1,f=!1,h=!0)}},154:t=>{"use strict";t.exports=\'"use strict";var e={},t="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;if(t){var r=require("worker_threads"),a=r.parentPort;a.on("message",(e=>onmessage({data:e})));var o=require("fs");Object.assign(global,{self:global,require:require,Module:e,location:{href:__filename},Worker:r.Worker,importScripts:function(e){(0,eval)(o.readFileSync(e,"utf8"))},postMessage:function(e){a.postMessage(e)},performance:global.performance||{now:function(){return Date.now()}}})}var s=!1,n=[],i=function(){var e=Array.prototype.slice.call(arguments).join(" ");t?o.writeSync(2,e+"\\\\n"):console.error(e)};self.alert=function(){var t=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:t,threadId:e._pthread_self()})},e.instantiateWasm=(t,r)=>{var a=new WebAssembly.Instance(e.wasmModule,t);return r(a),e.wasmModule=null,a.exports},self.onunhandledrejection=e=>{throw e.reason??e},self.onmessage=t=>{try{if("load"===t.data.cmd){if(e.wasmModule=t.data.wasmModule,e.wasmMemory=t.data.wasmMemory,e.buffer=e.wasmMemory.buffer,e.ENVIRONMENT_IS_PTHREAD=!0,"string"==typeof t.data.urlOrBlob)importScripts(t.data.urlOrBlob);else{var r=URL.createObjectURL(t.data.urlOrBlob);importScripts(r),URL.revokeObjectURL(r)}ortWasmThreaded(e).then((function(t){e=t}))}else if("run"===t.data.cmd){e.__performance_now_clock_drift=performance.now()-t.data.time,e.__emscripten_thread_init(t.data.pthread_ptr,0,0,1),e.establishStackSpace(),e.PThread.receiveObjectTransfer(t.data),e.PThread.threadInitTLS(),s||(n.forEach((t=>{e.executeNotifiedProxyingQueue(t)})),n=[],s=!0);try{e.invokeEntryPoint(t.data.start_routine,t.data.arg)}catch(t){if("unwind"!=t){if(!(t instanceof e.ExitStatus))throw t;e.keepRuntimeAlive()||e.__emscripten_thread_exit(t.status)}}}else"cancel"===t.data.cmd?e._pthread_self()&&e.__emscripten_thread_exit(-1):"setimmediate"===t.data.target||("processProxyingQueue"===t.data.cmd?s?e.executeNotifiedProxyingQueue(t.data.queue):n.push(t.data.queue):(i("worker.js received unknown command "+t.data.cmd),i(t.data)))}catch(t){throw i("worker.js onmessage() captured an uncaught exception: "+t),t&&t.stack&&i(t.stack),e.__emscripten_thread_crashed&&e.__emscripten_thread_crashed(),t}};\\n\'},384:()=>{},993:()=>{},908:()=>{},953:()=>{},925:()=>{},449:()=>{}},e={};function n(r){var a=e[r];if(void 0!==a)return a.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";const t=n(349),e=n(361);self.onmessage=n=>{switch(n.data.type){case"init-wasm":(0,e.initializeWebAssembly)(n.data.in).then((()=>postMessage({type:"init-wasm"})),(t=>postMessage({type:"init-wasm",err:t})));break;case"init-ort":try{const{numThreads:e,loggingLevel:r}=n.data.in;(0,t.initOrt)(e,r),postMessage({type:"init-ort"})}catch(t){postMessage({type:"init-ort",err:t})}break;case"create_allocate":try{const{model:e}=n.data.in,r=(0,t.createSessionAllocate)(e);postMessage({type:"create_allocate",out:r})}catch(t){postMessage({type:"create_allocate",err:t})}break;case"create_finalize":try{const{modeldata:e,options:r}=n.data.in,a=(0,t.createSessionFinalize)(e,r);postMessage({type:"create_finalize",out:a})}catch(t){postMessage({type:"create_finalize",err:t})}break;case"create":try{const{model:e,options:r}=n.data.in,a=(0,t.createSession)(e,r);postMessage({type:"create",out:a})}catch(t){postMessage({type:"create",err:t})}break;case"release":try{const e=n.data.in;(0,t.releaseSession)(e),postMessage({type:"release"})}catch(t){postMessage({type:"release",err:t})}break;case"run":try{const{sessionId:e,inputIndices:r,inputs:a,outputIndices:i,options:o}=n.data.in,u=(0,t.run)(e,r,a,i,o);postMessage({type:"run",out:u},(0,t.extractTransferableBuffers)(u))}catch(t){postMessage({type:"run",err:t})}break;case"end-profiling":try{const e=n.data.in;(0,t.endProfiling)(e),postMessage({type:"end-profiling"})}catch(t){postMessage({type:"end-profiling",err:t})}}}})()})();\n',"Worker",void 0,void 0)}},477:n=>{n.exports=function(e,t,s,o){var u=self||window;try{try{var l;try{l=new u.Blob([e])}catch{(l=new(u.BlobBuilder||u.WebKitBlobBuilder||u.MozBlobBuilder||u.MSBlobBuilder)).append(e),l=l.getBlob()}var m=u.URL||u.webkitURL,g=m.createObjectURL(l),h=new u[t](g,s);return m.revokeObjectURL(g),h}catch{return new u[t]("data:application/javascript,".concat(encodeURIComponent(e)),s)}}catch{if(!o)throw Error("Inline worker is not supported");return new u[t](o,s)}}},4154:n=>{n.exports=`"use strict";var e={},t="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;if(t){var r=require("worker_threads"),a=r.parentPort;a.on("message",(e=>onmessage({data:e})));var o=require("fs");Object.assign(global,{self:global,require:require,Module:e,location:{href:__filename},Worker:r.Worker,importScripts:function(e){(0,eval)(o.readFileSync(e,"utf8"))},postMessage:function(e){a.postMessage(e)},performance:global.performance||{now:function(){return Date.now()}}})}var s=!1,n=[],i=function(){var e=Array.prototype.slice.call(arguments).join(" ");t?o.writeSync(2,e+"\\n"):console.error(e)};self.alert=function(){var t=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:t,threadId:e._pthread_self()})},e.instantiateWasm=(t,r)=>{var a=new WebAssembly.Instance(e.wasmModule,t);return r(a),e.wasmModule=null,a.exports},self.onunhandledrejection=e=>{throw e.reason??e},self.onmessage=t=>{try{if("load"===t.data.cmd){if(e.wasmModule=t.data.wasmModule,e.wasmMemory=t.data.wasmMemory,e.buffer=e.wasmMemory.buffer,e.ENVIRONMENT_IS_PTHREAD=!0,"string"==typeof t.data.urlOrBlob)importScripts(t.data.urlOrBlob);else{var r=URL.createObjectURL(t.data.urlOrBlob);importScripts(r),URL.revokeObjectURL(r)}ortWasmThreaded(e).then((function(t){e=t}))}else if("run"===t.data.cmd){e.__performance_now_clock_drift=performance.now()-t.data.time,e.__emscripten_thread_init(t.data.pthread_ptr,0,0,1),e.establishStackSpace(),e.PThread.receiveObjectTransfer(t.data),e.PThread.threadInitTLS(),s||(n.forEach((t=>{e.executeNotifiedProxyingQueue(t)})),n=[],s=!0);try{e.invokeEntryPoint(t.data.start_routine,t.data.arg)}catch(t){if("unwind"!=t){if(!(t instanceof e.ExitStatus))throw t;e.keepRuntimeAlive()||e.__emscripten_thread_exit(t.status)}}}else"cancel"===t.data.cmd?e._pthread_self()&&e.__emscripten_thread_exit(-1):"setimmediate"===t.data.target||("processProxyingQueue"===t.data.cmd?s?e.executeNotifiedProxyingQueue(t.data.queue):n.push(t.data.queue):(i("worker.js received unknown command "+t.data.cmd),i(t.data)))}catch(t){throw i("worker.js onmessage() captured an uncaught exception: "+t),t&&t.stack&&i(t.stack),e.__emscripten_thread_crashed&&e.__emscripten_thread_crashed(),t}};
`},1670:n=>{n.exports=__WEBPACK_EXTERNAL_MODULE__1670__},7067:()=>{},1296:()=>{},1384:()=>{},3993:()=>{},908:()=>{},6953:()=>{},9925:()=>{},2806:()=>{},6449:()=>{},2850:()=>{},5381:()=>{},5686:(n,e,t)=>{t.r(e),t.d(e,{flatbuffers:()=>s});var s={};s.Offset,s.Table,s.SIZEOF_SHORT=2,s.SIZEOF_INT=4,s.FILE_IDENTIFIER_LENGTH=4,s.SIZE_PREFIX_LENGTH=4,s.Encoding={UTF8_BYTES:1,UTF16_STRING:2},s.int32=new Int32Array(2),s.float32=new Float32Array(s.int32.buffer),s.float64=new Float64Array(s.int32.buffer),s.isLittleEndian=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1,s.Long=function(o,u){this.low=0|o,this.high=0|u},s.Long.create=function(o,u){return o==0&&u==0?s.Long.ZERO:new s.Long(o,u)},s.Long.prototype.toFloat64=function(){return(this.low>>>0)+4294967296*this.high},s.Long.prototype.equals=function(o){return this.low==o.low&&this.high==o.high},s.Long.ZERO=new s.Long(0,0),s.Builder=function(o){if(o)u=o;else var u=1024;this.bb=s.ByteBuffer.allocate(u),this.space=u,this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},s.Builder.prototype.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},s.Builder.prototype.forceDefaults=function(o){this.force_defaults=o},s.Builder.prototype.dataBuffer=function(){return this.bb},s.Builder.prototype.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},s.Builder.prototype.prep=function(o,u){o>this.minalign&&(this.minalign=o);for(var l=1+~(this.bb.capacity()-this.space+u)&o-1;this.space<l+o+u;){var m=this.bb.capacity();this.bb=s.Builder.growByteBuffer(this.bb),this.space+=this.bb.capacity()-m}this.pad(l)},s.Builder.prototype.pad=function(o){for(var u=0;u<o;u++)this.bb.writeInt8(--this.space,0)},s.Builder.prototype.writeInt8=function(o){this.bb.writeInt8(this.space-=1,o)},s.Builder.prototype.writeInt16=function(o){this.bb.writeInt16(this.space-=2,o)},s.Builder.prototype.writeInt32=function(o){this.bb.writeInt32(this.space-=4,o)},s.Builder.prototype.writeInt64=function(o){this.bb.writeInt64(this.space-=8,o)},s.Builder.prototype.writeFloat32=function(o){this.bb.writeFloat32(this.space-=4,o)},s.Builder.prototype.writeFloat64=function(o){this.bb.writeFloat64(this.space-=8,o)},s.Builder.prototype.addInt8=function(o){this.prep(1,0),this.writeInt8(o)},s.Builder.prototype.addInt16=function(o){this.prep(2,0),this.writeInt16(o)},s.Builder.prototype.addInt32=function(o){this.prep(4,0),this.writeInt32(o)},s.Builder.prototype.addInt64=function(o){this.prep(8,0),this.writeInt64(o)},s.Builder.prototype.addFloat32=function(o){this.prep(4,0),this.writeFloat32(o)},s.Builder.prototype.addFloat64=function(o){this.prep(8,0),this.writeFloat64(o)},s.Builder.prototype.addFieldInt8=function(o,u,l){(this.force_defaults||u!=l)&&(this.addInt8(u),this.slot(o))},s.Builder.prototype.addFieldInt16=function(o,u,l){(this.force_defaults||u!=l)&&(this.addInt16(u),this.slot(o))},s.Builder.prototype.addFieldInt32=function(o,u,l){(this.force_defaults||u!=l)&&(this.addInt32(u),this.slot(o))},s.Builder.prototype.addFieldInt64=function(o,u,l){!this.force_defaults&&u.equals(l)||(this.addInt64(u),this.slot(o))},s.Builder.prototype.addFieldFloat32=function(o,u,l){(this.force_defaults||u!=l)&&(this.addFloat32(u),this.slot(o))},s.Builder.prototype.addFieldFloat64=function(o,u,l){(this.force_defaults||u!=l)&&(this.addFloat64(u),this.slot(o))},s.Builder.prototype.addFieldOffset=function(o,u,l){(this.force_defaults||u!=l)&&(this.addOffset(u),this.slot(o))},s.Builder.prototype.addFieldStruct=function(o,u,l){u!=l&&(this.nested(u),this.slot(o))},s.Builder.prototype.nested=function(o){if(o!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")},s.Builder.prototype.notNested=function(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")},s.Builder.prototype.slot=function(o){this.vtable[o]=this.offset()},s.Builder.prototype.offset=function(){return this.bb.capacity()-this.space},s.Builder.growByteBuffer=function(o){var u=o.capacity();if(3221225472&u)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var l=u<<1,m=s.ByteBuffer.allocate(l);return m.setPosition(l-u),m.bytes().set(o.bytes(),l-u),m},s.Builder.prototype.addOffset=function(o){this.prep(s.SIZEOF_INT,0),this.writeInt32(this.offset()-o+s.SIZEOF_INT)},s.Builder.prototype.startObject=function(o){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=o;for(var u=0;u<o;u++)this.vtable[u]=0;this.isNested=!0,this.object_start=this.offset()},s.Builder.prototype.endObject=function(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var o=this.offset(),u=this.vtable_in_use-1;u>=0&&this.vtable[u]==0;u--);for(var l=u+1;u>=0;u--)this.addInt16(this.vtable[u]!=0?o-this.vtable[u]:0);this.addInt16(o-this.object_start);var m=(l+2)*s.SIZEOF_SHORT;this.addInt16(m);var g=0,h=this.space;e:for(u=0;u<this.vtables.length;u++){var f=this.bb.capacity()-this.vtables[u];if(m==this.bb.readInt16(f)){for(var i=s.SIZEOF_SHORT;i<m;i+=s.SIZEOF_SHORT)if(this.bb.readInt16(h+i)!=this.bb.readInt16(f+i))continue e;g=this.vtables[u];break}}return g?(this.space=this.bb.capacity()-o,this.bb.writeInt32(this.space,g-o)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-o,this.offset()-o)),this.isNested=!1,o},s.Builder.prototype.finish=function(o,u,l){var m=l?s.SIZE_PREFIX_LENGTH:0;if(u){var g=u;if(this.prep(this.minalign,s.SIZEOF_INT+s.FILE_IDENTIFIER_LENGTH+m),g.length!=s.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+s.FILE_IDENTIFIER_LENGTH);for(var h=s.FILE_IDENTIFIER_LENGTH-1;h>=0;h--)this.writeInt8(g.charCodeAt(h))}this.prep(this.minalign,s.SIZEOF_INT+m),this.addOffset(o),m&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},s.Builder.prototype.finishSizePrefixed=function(o,u){this.finish(o,u,!0)},s.Builder.prototype.requiredField=function(o,u){var l=this.bb.capacity()-o,m=l-this.bb.readInt32(l);if(this.bb.readInt16(m+u)==0)throw new Error("FlatBuffers: field "+u+" must be set")},s.Builder.prototype.startVector=function(o,u,l){this.notNested(),this.vector_num_elems=u,this.prep(s.SIZEOF_INT,o*u),this.prep(l,o*u)},s.Builder.prototype.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},s.Builder.prototype.createString=function(o){if(o instanceof Uint8Array)var u=o;else{u=[];for(var l=0;l<o.length;){var m,g=o.charCodeAt(l++);(m=g<55296||g>=56320?g:(g<<10)+o.charCodeAt(l++)+-56613888)<128?u.push(m):(m<2048?u.push(m>>6&31|192):(m<65536?u.push(m>>12&15|224):u.push(m>>18&7|240,m>>12&63|128),u.push(m>>6&63|128)),u.push(63&m|128))}}this.addInt8(0),this.startVector(1,u.length,1),this.bb.setPosition(this.space-=u.length),l=0;for(var h=this.space,f=this.bb.bytes();l<u.length;l++)f[h++]=u[l];return this.endVector()},s.Builder.prototype.createLong=function(o,u){return s.Long.create(o,u)},s.ByteBuffer=function(o){this.bytes_=o,this.position_=0},s.ByteBuffer.allocate=function(o){return new s.ByteBuffer(new Uint8Array(o))},s.ByteBuffer.prototype.clear=function(){this.position_=0},s.ByteBuffer.prototype.bytes=function(){return this.bytes_},s.ByteBuffer.prototype.position=function(){return this.position_},s.ByteBuffer.prototype.setPosition=function(o){this.position_=o},s.ByteBuffer.prototype.capacity=function(){return this.bytes_.length},s.ByteBuffer.prototype.readInt8=function(o){return this.readUint8(o)<<24>>24},s.ByteBuffer.prototype.readUint8=function(o){return this.bytes_[o]},s.ByteBuffer.prototype.readInt16=function(o){return this.readUint16(o)<<16>>16},s.ByteBuffer.prototype.readUint16=function(o){return this.bytes_[o]|this.bytes_[o+1]<<8},s.ByteBuffer.prototype.readInt32=function(o){return this.bytes_[o]|this.bytes_[o+1]<<8|this.bytes_[o+2]<<16|this.bytes_[o+3]<<24},s.ByteBuffer.prototype.readUint32=function(o){return this.readInt32(o)>>>0},s.ByteBuffer.prototype.readInt64=function(o){return new s.Long(this.readInt32(o),this.readInt32(o+4))},s.ByteBuffer.prototype.readUint64=function(o){return new s.Long(this.readUint32(o),this.readUint32(o+4))},s.ByteBuffer.prototype.readFloat32=function(o){return s.int32[0]=this.readInt32(o),s.float32[0]},s.ByteBuffer.prototype.readFloat64=function(o){return s.int32[s.isLittleEndian?0:1]=this.readInt32(o),s.int32[s.isLittleEndian?1:0]=this.readInt32(o+4),s.float64[0]},s.ByteBuffer.prototype.writeInt8=function(o,u){this.bytes_[o]=u},s.ByteBuffer.prototype.writeUint8=function(o,u){this.bytes_[o]=u},s.ByteBuffer.prototype.writeInt16=function(o,u){this.bytes_[o]=u,this.bytes_[o+1]=u>>8},s.ByteBuffer.prototype.writeUint16=function(o,u){this.bytes_[o]=u,this.bytes_[o+1]=u>>8},s.ByteBuffer.prototype.writeInt32=function(o,u){this.bytes_[o]=u,this.bytes_[o+1]=u>>8,this.bytes_[o+2]=u>>16,this.bytes_[o+3]=u>>24},s.ByteBuffer.prototype.writeUint32=function(o,u){this.bytes_[o]=u,this.bytes_[o+1]=u>>8,this.bytes_[o+2]=u>>16,this.bytes_[o+3]=u>>24},s.ByteBuffer.prototype.writeInt64=function(o,u){this.writeInt32(o,u.low),this.writeInt32(o+4,u.high)},s.ByteBuffer.prototype.writeUint64=function(o,u){this.writeUint32(o,u.low),this.writeUint32(o+4,u.high)},s.ByteBuffer.prototype.writeFloat32=function(o,u){s.float32[0]=u,this.writeInt32(o,s.int32[0])},s.ByteBuffer.prototype.writeFloat64=function(o,u){s.float64[0]=u,this.writeInt32(o,s.int32[s.isLittleEndian?0:1]),this.writeInt32(o+4,s.int32[s.isLittleEndian?1:0])},s.ByteBuffer.prototype.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+s.SIZEOF_INT+s.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var o="",u=0;u<s.FILE_IDENTIFIER_LENGTH;u++)o+=String.fromCharCode(this.readInt8(this.position_+s.SIZEOF_INT+u));return o},s.ByteBuffer.prototype.__offset=function(o,u){var l=o-this.readInt32(o);return u<this.readInt16(l)?this.readInt16(l+u):0},s.ByteBuffer.prototype.__union=function(o,u){return o.bb_pos=u+this.readInt32(u),o.bb=this,o},s.ByteBuffer.prototype.__string=function(o,u){o+=this.readInt32(o);var l=this.readInt32(o),m="",g=0;if(o+=s.SIZEOF_INT,u===s.Encoding.UTF8_BYTES)return this.bytes_.subarray(o,o+l);for(;g<l;){var h,f=this.readUint8(o+g++);if(f<192)h=f;else{var i=this.readUint8(o+g++);if(f<224)h=(31&f)<<6|63&i;else{var r=this.readUint8(o+g++);h=f<240?(15&f)<<12|(63&i)<<6|63&r:(7&f)<<18|(63&i)<<12|(63&r)<<6|63&this.readUint8(o+g++)}}h<65536?m+=String.fromCharCode(h):(h-=65536,m+=String.fromCharCode(55296+(h>>10),56320+(1023&h)))}return m},s.ByteBuffer.prototype.__indirect=function(o){return o+this.readInt32(o)},s.ByteBuffer.prototype.__vector=function(o){return o+this.readInt32(o)+s.SIZEOF_INT},s.ByteBuffer.prototype.__vector_len=function(o){return this.readInt32(o+this.readInt32(o))},s.ByteBuffer.prototype.__has_identifier=function(o){if(o.length!=s.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+s.FILE_IDENTIFIER_LENGTH);for(var u=0;u<s.FILE_IDENTIFIER_LENGTH;u++)if(o.charCodeAt(u)!=this.readInt8(this.position_+s.SIZEOF_INT+u))return!1;return!0},s.ByteBuffer.prototype.createLong=function(o,u){return s.Long.create(o,u)}}},__webpack_module_cache__={};function __webpack_require__(n){var e=__webpack_module_cache__[n];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[n]={exports:{}};return __webpack_modules__[n].call(t.exports,t,t.exports,__webpack_require__),t.exports}__webpack_require__.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(n,e)=>{for(var t in e)__webpack_require__.o(e,t)&&!__webpack_require__.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},__webpack_require__.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),__webpack_require__.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),__webpack_require__.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(6018);return __webpack_exports__})()))})(ortWeb_min$1)),ortWeb_min$1.exports}var ortWeb_minExports=requireOrtWeb_min();const ortWeb_min=getDefaultExportFromCjs(ortWeb_minExports),ONNX_WEB=_mergeNamespaces({__proto__:null,default:ortWeb_min},[ortWeb_minExports]);let ONNX;const executionProviders=["wasm"];typeof process<"u"&&process?.release?.name==="node"?(ONNX=sharp??ONNX_NODE,executionProviders.unshift("cpu")):(ONNX=ortWeb_min??ONNX_WEB,typeof navigator<"u"&&/iP(hone|od|ad).+16_4.+AppleWebKit/.test(navigator.userAgent)&&(ONNX.env.wasm.simd=!1));const{env:onnx_env}=ONNX,VERSION="2.17.2",WEB_CACHE_AVAILABLE=typeof self<"u"&&"caches"in self,FS_AVAILABLE=!isEmpty(sharp),PATH_AVAILABLE=!isEmpty(sharp),RUNNING_LOCALLY=FS_AVAILABLE&&PATH_AVAILABLE,__dirname$1=RUNNING_LOCALLY?sharp.dirname(sharp.dirname(sharp.fileURLToPath(import.meta.url))):"./",DEFAULT_CACHE_DIR=RUNNING_LOCALLY?sharp.join(__dirname$1,"/.cache/"):null,DEFAULT_LOCAL_MODEL_PATH="/models/",localModelPath=RUNNING_LOCALLY?sharp.join(__dirname$1,DEFAULT_LOCAL_MODEL_PATH):DEFAULT_LOCAL_MODEL_PATH;onnx_env?.wasm&&(onnx_env.wasm.wasmPaths=RUNNING_LOCALLY?sharp.join(__dirname$1,"/dist/"):`https://cdn.jsdelivr.net/npm/@xenova/transformers@${VERSION}/dist/`);const env$1={version:VERSION,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!0,localModelPath,useFS:FS_AVAILABLE,useBrowserCache:WEB_CACHE_AVAILABLE,useFSCache:FS_AVAILABLE,cacheDir:DEFAULT_CACHE_DIR};function isEmpty(n){return Object.keys(n).length===0}var define_process_env_default={};class FileResponse{_CONTENT_TYPE_MAP={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};constructor(e){if(this.filePath=e,this.headers=new Headers,this.exists=sharp.existsSync(e),this.exists){this.status=200,this.statusText="OK";let t=sharp.statSync(e);this.headers.set("content-length",t.size.toString()),this.updateContentType();let s=this;this.body=new ReadableStream({start(o){s.arrayBuffer().then(u=>{o.enqueue(new Uint8Array(u)),o.close()})}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){const e=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",this._CONTENT_TYPE_MAP[e]??"application/octet-stream")}clone(){let e=new FileResponse(this.filePath);return e.exists=this.exists,e.status=this.status,e.statusText=this.statusText,e.headers=new Headers(this.headers),e}async arrayBuffer(){return(await sharp.promises.readFile(this.filePath)).buffer}async blob(){const e=await sharp.promises.readFile(this.filePath);return new Blob([e],{type:this.headers.get("content-type")})}async text(){return await sharp.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function isValidUrl(n,e=null,t=null){let s;try{s=new URL(n)}catch{return!1}return!(e&&!e.includes(s.protocol)||t&&!t.includes(s.hostname))}async function getFile(n){if(env$1.useFS&&!isValidUrl(n,["http:","https:","blob:"]))return new FileResponse(n);if(typeof process<"u"&&process?.release?.name==="node"){const e=!!define_process_env_default?.TESTING_REMOTELY,t=env$1.version,s=new Headers;if(s.set("User-Agent",`transformers.js/${t}; is_ci/${e};`),isValidUrl(n,["http:","https:"],["huggingface.co","hf.co"])){const u=define_process_env_default?.HF_TOKEN??define_process_env_default?.HF_ACCESS_TOKEN;u&&s.set("Authorization",`Bearer ${u}`)}return fetch(n,{headers:s})}else return fetch(n)}const ERROR_MAPPING={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function handleError(n,e,t){if(!t)return null;const s=ERROR_MAPPING[n]??`Error (${n}) occurred while trying to load file`;throw Error(`${s}: "${e}".`)}class FileCache{constructor(e){this.path=e}async match(e){let t=sharp.join(this.path,e),s=new FileResponse(t);if(s.exists)return s}async put(e,t){const s=Buffer.from(await t.arrayBuffer());let o=sharp.join(this.path,e);try{await sharp.promises.mkdir(sharp.dirname(o),{recursive:!0}),await sharp.promises.writeFile(o,s)}catch(u){console.warn("An error occurred while writing the file to cache:",u)}}}async function tryCache(n,...e){for(let t of e)try{let s=await n.match(t);if(s)return s}catch{continue}}async function getModelFile(n,e,t=!0,s={}){if(!env$1.allowLocalModels&&s.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");dispatchCallback(s.progress_callback,{status:"initiate",name:n,file:e});let o;if(!o&&env$1.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{o=await caches.open("transformers-cache")}catch(v){console.warn("An error occurred while opening the browser cache:",v)}}!o&&env$1.useFSCache&&(o=new FileCache(s.cache_dir??env$1.cacheDir));const u=s.revision??"main";let l=pathJoin(n,e),m=pathJoin(env$1.localModelPath,l),g=pathJoin(env$1.remoteHost,env$1.remotePathTemplate.replaceAll("{model}",n).replaceAll("{revision}",encodeURIComponent(u)),e),h=u==="main"?l:pathJoin(n,u,e),f,i=o instanceof FileCache?h:g,r=!1,d;o&&(d=await tryCache(o,m,i));const p=d!==void 0;if(d===void 0){if(env$1.allowLocalModels)if(isValidUrl(l,["http:","https:"])){if(s.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${l}.`)}else try{d=await getFile(m),f=m}catch(T){console.warn(`Unable to load from local path "${m}": "${T}"`)}if(d===void 0||d.status===404){if(s.local_files_only){if(t)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${m}".`);return null}if(d=await getFile(g),d.status!==200)return handleError(d.status,g,t);f=i}r=o&&typeof Response<"u"&&d instanceof Response&&d.status===200}dispatchCallback(s.progress_callback,{status:"download",name:n,file:e});const _={status:"progress",name:n,file:e};let y;return s.progress_callback?p&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(y=new Uint8Array(await d.arrayBuffer()),dispatchCallback(s.progress_callback,{..._,progress:100,loaded:y.length,total:y.length})):y=await readResponse(d,v=>{dispatchCallback(s.progress_callback,{..._,...v})}):y=new Uint8Array(await d.arrayBuffer()),r&&f&&await o.match(f)===void 0&&await o.put(f,new Response(y,{headers:d.headers})).catch(v=>{console.warn(`Unable to add response to browser cache: ${v}.`)}),dispatchCallback(s.progress_callback,{status:"done",name:n,file:e}),y}async function getModelJSON(n,e,t=!0,s={}){let o=await getModelFile(n,e,t,s);if(o===null)return{};let l=new TextDecoder("utf-8").decode(o);return JSON.parse(l)}async function readResponse(n,e){const t=n.headers.get("Content-Length");t===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let s=parseInt(t??"0"),o=new Uint8Array(s),u=0;const l=n.body.getReader();async function m(){const{done:g,value:h}=await l.read();if(g)return;let f=u+h.length;if(f>s){s=f;let r=new Uint8Array(s);r.set(o),o=r}o.set(h,u),u=f;const i=u/s*100;return e({progress:i,loaded:u,total:s}),m()}return await m(),o}function pathJoin(...n){return n=n.map((e,t)=>(t&&(e=e.replace(new RegExp("^/"),"")),t!==n.length-1&&(e=e.replace(new RegExp("/$"),"")),e)),n.join("/")}function interpolate_data(n,[e,t,s],[o,u],l="bilinear",m=!1){const g=u/s,h=o/t,f=new n.constructor(o*u*e),i=t*s,r=o*u;for(let d=0;d<o;++d)for(let p=0;p<u;++p){const _=d*u+p,y=(p+.5)/g-.5,v=(d+.5)/h-.5;let T=Math.floor(y),w=Math.floor(v);const E=Math.min(T+1,s-1),P=Math.min(w+1,t-1);T=Math.max(T,0),w=Math.max(w,0);const R=y-T,I=v-w,N=(1-R)*(1-I),B=R*(1-I),D=(1-R)*I,Y=R*I,se=w*s,re=P*s,W=se+T,$=se+E,k=re+T,H=re+E;for(let de=0;de<e;++de){const ee=de*i;f[de*r+_]=N*n[ee+W]+B*n[ee+$]+D*n[ee+k]+Y*n[ee+H]}}return f}function permute_data(n,e,t){const s=new Array(t.length),o=new Array(t.length);for(let m=t.length-1,g=1;m>=0;--m)o[m]=g,s[m]=e[t[m]],g*=s[m];const u=t.map((m,g)=>o[t.indexOf(g)]),l=new n.constructor(n.length);for(let m=0;m<n.length;++m){let g=0;for(let h=e.length-1,f=m;h>=0;--h)g+=f%e[h]*u[h],f=Math.floor(f/e[h]);l[g]=n[m]}return[l,s]}function softmax(n){const e=max(n)[0],t=n.map(u=>Math.exp(u-e)),s=t.reduce((u,l)=>u+l,0);return t.map(u=>u/s)}function log_softmax(n){return softmax(n).map(s=>Math.log(s))}function getTopItems(n,e=0){return n=Array.from(n).map((t,s)=>[s,t]).sort((t,s)=>s[1]-t[1]),e!==null&&e>0&&(n=n.slice(0,e)),n}function min(n){if(n.length===0)throw Error("Array must not be empty");let e=n[0],t=0;for(let s=1;s<n.length;++s)n[s]<e&&(e=n[s],t=s);return[e,t]}function max(n){if(n.length===0)throw Error("Array must not be empty");let e=n[0],t=0;for(let s=1;s<n.length;++s)n[s]>e&&(e=n[s],t=s);return[Number(e),t]}function isPowerOfTwo(n){return n>0&&(n&n-1)===0}class P2FFT{constructor(e){if(this.size=e|0,this.size<=1||!isPowerOfTwo(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=e<<1,this.table=new Float64Array(this.size*2);for(let s=0;s<this.table.length;s+=2){const o=Math.PI*s/this.size;this.table[s]=Math.cos(o),this.table[s+1]=-Math.sin(o)}let t=0;for(let s=1;this.size>s;s<<=1)++t;this._width=t%2===0?t-1:t,this._bitrev=new Int32Array(1<<this._width);for(let s=0;s<this._bitrev.length;++s){this._bitrev[s]=0;for(let o=0;o<this._width;o+=2){const u=this._width-o-2;this._bitrev[s]|=(s>>>o&3)<<u}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(e,t){const s=t||new Array(e.length>>>1);for(let o=0;o<e.length;o+=2)s[o>>>1]=e[o];return s}toComplexArray(e,t){const s=t||this.createComplexArray();for(let o=0;o<s.length;o+=2)s[o]=e[o>>>1],s[o+1]=0;return s}transform(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._transform4(e,t,1)}realTransform(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._realTransform4(e,t,1)}inverseTransform(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._transform4(e,t,-1);for(let s=0;s<e.length;++s)e[s]/=this.size}_transform4(e,t,s){const o=this._csize;let l=1<<this._width,m=o/l<<1,g,h;const f=this._bitrev;if(m===4)for(g=0,h=0;g<o;g+=m,++h){const r=f[h];this._singleTransform2(t,e,g,r,l)}else for(g=0,h=0;g<o;g+=m,++h){const r=f[h];this._singleTransform4(t,e,g,r,l,s)}const i=this.table;for(l>>=2;l>=2;l>>=2){m=o/l<<1;const r=m>>>2;for(g=0;g<o;g+=m){const d=g+r-1;for(let p=g,_=0;p<d;p+=2,_+=l){const y=p,v=y+r,T=v+r,w=T+r,E=e[y],P=e[y+1],R=e[v],I=e[v+1],N=e[T],B=e[T+1],D=e[w],Y=e[w+1],se=i[_],re=s*i[_+1],W=R*se-I*re,$=R*re+I*se,k=i[2*_],H=s*i[2*_+1],de=N*k-B*H,ee=N*H+B*k,ce=i[3*_],q=s*i[3*_+1],le=D*ce-Y*q,be=D*q+Y*ce,xe=E+de,Ee=P+ee,we=E-de,U=P-ee,L=W+le,M=$+be,C=s*(W-le),V=s*($-be);e[y]=xe+L,e[y+1]=Ee+M,e[v]=we+V,e[v+1]=U-C,e[T]=xe-L,e[T+1]=Ee-M,e[w]=we-V,e[w+1]=U+C}}}}_singleTransform2(e,t,s,o,u){const l=e[o],m=e[o+1],g=e[o+u],h=e[o+u+1];t[s]=l+g,t[s+1]=m+h,t[s+2]=l-g,t[s+3]=m-h}_singleTransform4(e,t,s,o,u,l){const m=u*2,g=u*3,h=e[o],f=e[o+1],i=e[o+u],r=e[o+u+1],d=e[o+m],p=e[o+m+1],_=e[o+g],y=e[o+g+1],v=h+d,T=f+p,w=h-d,E=f-p,P=i+_,R=r+y,I=l*(i-_),N=l*(r-y);t[s]=v+P,t[s+1]=T+R,t[s+2]=w+N,t[s+3]=E-I,t[s+4]=v-P,t[s+5]=T-R,t[s+6]=w-N,t[s+7]=E+I}_realTransform4(e,t,s){const o=this._csize;let l=1<<this._width,m=o/l<<1,g,h;const f=this._bitrev;if(m===4)for(g=0,h=0;g<o;g+=m,++h){const d=f[h];this._singleRealTransform2(t,e,g,d>>>1,l>>>1)}else for(g=0,h=0;g<o;g+=m,++h){const d=f[h];this._singleRealTransform4(t,e,g,d>>>1,l>>>1,s)}const i=this.table;for(l>>=2;l>=2;l>>=2){m=o/l<<1;const d=m>>>1,p=d>>>1,_=p>>>1;for(g=0;g<o;g+=m)for(let y=0,v=0;y<=_;y+=2,v+=l){const T=g+y,w=T+p,E=w+p,P=E+p,R=e[T],I=e[T+1],N=e[w],B=e[w+1],D=e[E],Y=e[E+1],se=e[P],re=e[P+1],W=R,$=I,k=i[v],H=s*i[v+1],de=N*k-B*H,ee=N*H+B*k,ce=i[2*v],q=s*i[2*v+1],le=D*ce-Y*q,be=D*q+Y*ce,xe=i[3*v],Ee=s*i[3*v+1],we=se*xe-re*Ee,U=se*Ee+re*xe,L=W+le,M=$+be,C=W-le,V=$-be,O=de+we,z=ee+U,j=s*(de-we),J=s*(ee-U);if(e[T]=L+O,e[T+1]=M+z,e[w]=C+J,e[w+1]=V-j,y===0){e[E]=L-O,e[E+1]=M-z;continue}if(y===_)continue;const X=g+p-y,ne=g+d-y;e[X]=C-s*J,e[X+1]=-V-s*j,e[ne]=L-s*O,e[ne+1]=-M+s*z}}const r=o>>>1;for(let d=2;d<r;d+=2)e[o-d]=e[d],e[o-d+1]=-e[d+1]}_singleRealTransform2(e,t,s,o,u){const l=e[o],m=e[o+u];t[s]=l+m,t[s+1]=0,t[s+2]=l-m,t[s+3]=0}_singleRealTransform4(e,t,s,o,u,l){const m=u*2,g=u*3,h=e[o],f=e[o+u],i=e[o+m],r=e[o+g],d=h+i,p=h-i,_=f+r,y=l*(f-r);t[s]=d+_,t[s+1]=0,t[s+2]=p,t[s+3]=-y,t[s+4]=d-_,t[s+5]=0,t[s+6]=p,t[s+7]=y}}class NP2FFT{constructor(e){const t=2*(e-1),s=2*(2*e-1),o=2**Math.ceil(Math.log2(s));this.bufferSize=o,this._a=t;const u=new Float64Array(s),l=new Float64Array(o);this._chirpBuffer=new Float64Array(o),this._buffer1=new Float64Array(o),this._buffer2=new Float64Array(o),this._outBuffer1=new Float64Array(o),this._outBuffer2=new Float64Array(o);const m=-2*Math.PI/e,g=Math.cos(m),h=Math.sin(m);for(let f=0;f<s>>1;++f){const i=(f+1-e)**2/2,r=Math.sqrt(g**2+h**2)**i,d=i*Math.atan2(h,g),p=2*f;u[p]=r*Math.cos(d),u[p+1]=r*Math.sin(d),l[p]=u[p],l[p+1]=-u[p+1]}this._slicedChirpBuffer=u.subarray(t,s),this._f=new P2FFT(o>>1),this._f.transform(this._chirpBuffer,l)}_transform(e,t,s){const o=this._buffer1,u=this._buffer2,l=this._outBuffer1,m=this._outBuffer2,g=this._chirpBuffer,h=this._slicedChirpBuffer,f=this._a;if(s)for(let i=0;i<h.length;i+=2){const r=i+1,d=i>>1,p=t[d];o[i]=p*h[i],o[r]=p*h[r]}else for(let i=0;i<h.length;i+=2){const r=i+1;o[i]=t[i]*h[i]-t[r]*h[r],o[r]=t[i]*h[r]+t[r]*h[i]}this._f.transform(l,o);for(let i=0;i<g.length;i+=2){const r=i+1;u[i]=l[i]*g[i]-l[r]*g[r],u[r]=l[i]*g[r]+l[r]*g[i]}this._f.inverseTransform(m,u);for(let i=0;i<m.length;i+=2){const r=m[i+f],d=m[i+f+1],p=h[i],_=h[i+1];e[i]=r*p-d*_,e[i+1]=r*_+d*p}}transform(e,t){this._transform(e,t,!1)}realTransform(e,t){this._transform(e,t,!0)}}class FFT{constructor(e){this.fft_length=e,this.isPowerOfTwo=isPowerOfTwo(e),this.isPowerOfTwo?(this.fft=new P2FFT(e),this.outputBufferSize=2*e):(this.fft=new NP2FFT(e),this.outputBufferSize=this.fft.bufferSize)}realTransform(e,t){this.fft.realTransform(e,t)}transform(e,t){this.fft.transform(e,t)}}function medianFilter(n,e){if(e%2===0||e<=0)throw new Error("Window size must be a positive odd number");const t=new n.constructor(n.length),s=new n.constructor(e),o=Math.floor(e/2);for(let u=0;u<n.length;++u){let l=0;for(let m=-o;m<=o;++m){let g=u+m;g<0?g=Math.abs(g):g>=n.length&&(g=2*(n.length-1)-g),s[l++]=n[g]}s.sort(),t[u]=s[o]}return t}function round(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}function bankers_round(n){const e=Math.round(n);return Math.abs(n)%1===.5?e%2===0?e:e-1:e}const DataTypeMap=Object.freeze({float32:Float32Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array}),ONNXTensor$1=ONNX.Tensor;class Tensor{dims;type;data;size;constructor(...e){return e[0]instanceof ONNXTensor$1?Object.assign(this,e[0]):Object.assign(this,new ONNXTensor$1(e[0],e[1],e[2])),new Proxy(this,{get:(t,s)=>{if(typeof s=="string"){let o=Number(s);if(Number.isInteger(o))return t._getitem(o)}return t[s]},set:(t,s,o)=>t[s]=o})}*[Symbol.iterator](){const[e,...t]=this.dims;if(t.length>0){const s=t.reduce((o,u)=>o*u);for(let o=0;o<e;++o)yield this._subarray(o,s,t)}else yield*this.data}_getitem(e){const[t,...s]=this.dims;if(e=safeIndex(e,t),s.length>0){const o=s.reduce((u,l)=>u*l);return this._subarray(e,o,s)}else return new Tensor(this.type,[this.data[e]],s)}indexOf(e){for(let t=0;t<this.data.length;++t)if(this.data[t]==e)return t;return-1}_subarray(e,t,s){const o=e*t,u=(e+1)*t,l="subarray"in this.data?this.data.subarray(o,u):this.data.slice(o,u);return new Tensor(this.type,l,s)}item(){if(this.data.length!==1)throw new Error(`a Tensor with ${this.data.length} elements cannot be converted to Scalar`);return this.data[0]}tolist(){return reshape(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){for(let e=0;e<this.data.length;++e)this.data[e]=1/(1+Math.exp(-this.data[e]));return this}mul(e){return this.clone().mul_(e)}mul_(e){for(let t=0;t<this.data.length;++t)this.data[t]*=e;return this}add(e){return this.clone().add_(e)}add_(e){for(let t=0;t<this.data.length;++t)this.data[t]+=e;return this}clone(){return new Tensor(this.type,this.data.slice(),this.dims.slice())}slice(...e){let t=[],s=[];for(let g=0;g<this.dims.length;++g){let h=e[g];if(h==null)s.push([0,this.dims[g]]),t.push(this.dims[g]);else if(typeof h=="number")h=safeIndex(h,this.dims[g],g),s.push([h,h+1]);else if(Array.isArray(h)&&h.length===2){if(h[0]>h[1])throw new Error(`Invalid slice: ${h}`);let f=[Math.max(h[0],0),Math.min(h[1],this.dims[g])];s.push(f),t.push(f[1]-f[0])}else throw new Error(`Invalid slice: ${h}`)}let o=s.map(([g,h])=>h-g),u=o.reduce((g,h)=>g*h),l=new this.data.constructor(u);const m=this.stride();for(let g=0;g<u;++g){let h=0;for(let f=o.length-1,i=g;f>=0;--f){const r=o[f];h+=(i%r+s[f][0])*m[f],i=Math.floor(i/r)}l[g]=this.data[h]}return new Tensor(this.type,l,t)}permute(...e){return permute(this,e)}transpose(...e){return this.permute(...e)}sum(e=null,t=!1){return this.norm(1,e,t)}norm(e="fro",t=null,s=!1){if(e==="fro")e=2;else if(typeof e=="string")throw Error(`Unsupported norm: ${e}`);if(t===null){let l=this.data.reduce((m,g)=>m+g**e,0)**(1/e);return new Tensor(this.type,[l],[])}t=safeIndex(t,this.dims.length);const o=this.dims.slice();o[t]=1;const u=new this.data.constructor(this.data.length/this.dims[t]);for(let l=0;l<this.data.length;++l){let m=0;for(let g=this.dims.length-1,h=l,f=1;g>=0;--g){const i=this.dims[g];if(g!==t){const r=h%i;m+=r*f,f*=o[g]}h=Math.floor(h/i)}u[m]+=this.data[l]**e}if(e!==1)for(let l=0;l<u.length;++l)u[l]=u[l]**(1/e);return s||o.splice(t,1),new Tensor(this.type,u,o)}normalize_(e=2,t=1){t=safeIndex(t,this.dims.length);const s=this.norm(e,t,!0);for(let o=0;o<this.data.length;++o){let u=0;for(let l=this.dims.length-1,m=o,g=1;l>=0;--l){const h=this.dims[l];if(l!==t){const f=m%h;u+=f*g,g*=this.dims[l]}m=Math.floor(m/h)}this.data[o]/=s.data[u]}return this}normalize(e=2,t=1){return this.clone().normalize_(e,t)}stride(){return dimsToStride(this.dims)}squeeze(e=null){return new Tensor(this.type,this.data,calc_squeeze_dims(this.dims,e))}squeeze_(e=null){return this.dims=calc_squeeze_dims(this.dims,e),this}unsqueeze(e=null){return new Tensor(this.type,this.data,calc_unsqueeze_dims(this.dims,e))}unsqueeze_(e=null){return this.dims=calc_unsqueeze_dims(this.dims,e),this}flatten_(e=0,t=-1){t=(t+this.dims.length)%this.dims.length;let s=this.dims.slice(0,e),o=this.dims.slice(e,t+1),u=this.dims.slice(t+1);return this.dims=[...s,o.reduce((l,m)=>l*m,1),...u],this}flatten(e=0,t=-1){return this.clone().flatten_(e,t)}view(...e){let t=-1;for(let s=0;s<e.length;++s)if(e[s]===-1){if(t!==-1)throw new Error("Only one dimension can be inferred");t=s}if(t!==-1){const s=e.reduce((o,u,l)=>l!==t?o*u:o,1);e[t]=this.data.length/s}return new Tensor(this.type,this.data,e)}neg_(){for(let e=0;e<this.data.length;++e)this.data[e]=-this.data[e];return this}neg(){return this.clone().neg_()}clamp_(e,t){for(let s=0;s<this.data.length;++s)this.data[s]=Math.min(Math.max(this.data[s],e),t);return this}clamp(e,t){return this.clone().clamp_(e,t)}round_(){for(let e=0;e<this.data.length;++e)this.data[e]=Math.round(this.data[e]);return this}round(){return this.clone().round_()}to(e){if(this.type===e)return this;if(!DataTypeMap.hasOwnProperty(e))throw new Error(`Unsupported type: ${e}`);return new Tensor(e,DataTypeMap[e].from(this.data),this.dims)}}function reshape(n,e){const t=n.length,s=e.reduce((u,l)=>u*l);if(t!==s)throw Error(`cannot reshape array of size ${t} into shape (${e})`);let o=n;for(let u=e.length-1;u>=0;u--)o=o.reduce((l,m)=>{let g=l[l.length-1];return g.length<e[u]?g.push(m):l.push([m]),l},[[]]);return o[0]}function permute(n,e){const[t,s]=permute_data(n.data,n.dims,e);return new Tensor(n.type,t,s)}function interpolate(n,[e,t],s="bilinear",o=!1){const u=n.dims.at(-3)??1,l=n.dims.at(-2),m=n.dims.at(-1);let g=interpolate_data(n.data,[u,l,m],[e,t],s,o);return new Tensor(n.type,g,[u,e,t])}function mean_pooling(n,e){let t=[n.dims[0],n.dims[2]],s=new n.data.constructor(t[0]*t[1]),[o,u,l]=n.dims,m=0;for(let g=0;g<o;++g){let h=g*l*u;for(let f=0;f<l;++f){let i=0,r=0,d=g*u,p=h+f;for(let y=0;y<u;++y){let v=Number(e.data[d+y]);r+=v,i+=n.data[p+y*l]*v}let _=i/r;s[m++]=_}}return new Tensor(n.type,s,t)}function calc_squeeze_dims(n,e){return n=n.slice(),e===null?n=n.filter(t=>t!==1):typeof e=="number"?n[e]===1&&n.splice(e,1):Array.isArray(e)&&(n=n.filter((t,s)=>t!==1||!e.includes(s))),n}function calc_unsqueeze_dims(n,e){return e=safeIndex(e,n.length+1),n=n.slice(),n.splice(e,0,1),n}function safeIndex(n,e,t=null){if(n<-e||n>=e)throw new Error(`IndexError: index ${n} is out of bounds for dimension${t===null?"":" "+t} with size ${e}`);return n<0&&(n=(n%e+e)%e),n}function cat(n,e=0){e=safeIndex(e,n[0].dims.length);const t=n[0].dims.slice();t[e]=n.reduce((l,m)=>l+m.dims[e],0);const s=t.reduce((l,m)=>l*m,1),o=new n[0].data.constructor(s),u=n[0].type;if(e===0){let l=0;for(let m of n)o.set(m.data,l),l+=m.data.length}else{let l=0;for(let m=0;m<n.length;++m){let g=n[m];for(let h=0;h<g.data.length;++h){let f=0;for(let i=g.dims.length-1,r=h,d=1;i>=0;--i){const p=g.dims[i];let _=r%p;i===e&&(_+=l),f+=_*d,d*=t[i],r=Math.floor(r/p)}o[f]=g.data[h]}l+=g.dims[e]}}return new Tensor(u,o,t)}function stack(n,e=0){return cat(n.map(t=>t.unsqueeze(e)),e)}function std_mean(n,e=null,t=1,s=!1){if(e===null){const h=n.data.reduce((d,p)=>d+p,0)/n.data.length,f=Math.sqrt(n.data.reduce((d,p)=>d+(p-h)**2,0)/(n.data.length-t)),i=new Tensor(n.type,[h],[]);return[new Tensor(n.type,[f],[]),i]}e=safeIndex(e,n.dims.length);const o=mean(n,e,s),u=n.dims.slice();u[e]=1;const l=new n.data.constructor(n.data.length/n.dims[e]);for(let g=0;g<n.data.length;++g){let h=0;for(let f=n.dims.length-1,i=g,r=1;f>=0;--f){const d=n.dims[f];if(f!==e){const p=i%d;h+=p*r,r*=u[f]}i=Math.floor(i/d)}l[h]+=(n.data[g]-o.data[h])**2}for(let g=0;g<l.length;++g)l[g]=Math.sqrt(l[g]/(n.dims[e]-t));return s||u.splice(e,1),[new Tensor(n.type,l,u),o]}function mean(n,e=null,t=!1){if(e===null){let u=n.data.reduce((l,m)=>l+m,0);return new Tensor(n.type,[u/n.data.length],[])}e=safeIndex(e,n.dims.length);const s=n.dims.slice();s[e]=1;const o=new n.data.constructor(n.data.length/n.dims[e]);for(let u=0;u<n.data.length;++u){let l=0;for(let m=n.dims.length-1,g=u,h=1;m>=0;--m){const f=n.dims[m];if(m!==e){const i=g%f;l+=i*h,h*=s[m]}g=Math.floor(g/f)}o[l]+=n.data[u]}if(n.dims[e]!==1)for(let u=0;u<o.length;++u)o[u]=o[u]/n.dims[e];return t||s.splice(e,1),new Tensor(n.type,o,s)}function dynamicTimeWarping(n){const[e,t]=n.dims,s=[e+1,t+1],o=new Tensor("float32",new Float32Array(s[0]*s[1]).fill(1/0),s),u=new Tensor("float32",new Float32Array(s[0]*s[1]).fill(-1),s);o[0].data[0]=0;for(let f=1;f<t+1;++f)for(let i=1;i<e+1;++i){const r=o[i-1][f-1].item(),d=o[i-1][f].item(),p=o[i][f-1].item();let _,y;r<d&&r<p?(_=r,y=0):d<r&&d<p?(_=d,y=1):(_=p,y=2),o[i].data[f]=n[i-1][f-1].item()+_,u[i].data[f]=y}let l=e,m=t;u.data.fill(2,0,s[1]);for(let f=0;f<s[0];++f)u[f].data[0]=1;let g=[],h=[];for(;l>0||m>0;)switch(g.push(l-1),h.push(m-1),u[l][m].item()){case 0:--l,--m;break;case 1:--l;break;case 2:--m;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${l}, ${m}]. Please file a bug report.`)}return g.reverse(),h.reverse(),[g,h]}function dimsToStride(n){const e=new Array(n.length);for(let t=n.length-1,s=1;t>=0;--t)e[t]=s,s*=n[t];return e}function ones(n){const e=n.reduce((t,s)=>t*s,1);return new Tensor("int64",new BigInt64Array(e).fill(1n),n)}function ones_like(n){return ones(n.dims)}function quantize_embeddings(n,e){if(n.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(n.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(e))throw new Error("The precision must be either 'binary' or 'ubinary'");const t=e==="binary",s=t?"int8":"uint8",o=t?Int8Array:Uint8Array,u=n.data,l=new o(u.length/8);for(let m=0;m<u.length;++m){const g=u[m]>0?1:0,h=Math.floor(m/8),f=m%8;l[h]|=g<<7-f,t&&f===0&&(l[h]-=128)}return new Tensor(s,l,[n.dims[0],n.dims[1]/8])}class PriorityQueue{constructor(e=(t,s)=>t>s){this._heap=[],this._comparator=e}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...e){return this.extend(e)}extend(e){for(const t of e)this._heap.push(t),this._siftUp();return this.size}pop(){const e=this.peek(),t=this.size-1;return t>0&&this._swap(0,t),this._heap.pop(),this._siftDown(),e}replace(e){const t=this.peek();return this._heap[0]=e,this._siftDown(),t}_parent(e){return(e+1>>>1)-1}_left(e){return(e<<1)+1}_right(e){return e+1<<1}_greater(e,t){return this._comparator(this._heap[e],this._heap[t])}_swap(e,t){const s=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=s}_siftUp(){let e=this.size-1;for(;e>0&&this._greater(e,this._parent(e));)this._swap(e,this._parent(e)),e=this._parent(e)}_siftDown(){let e=0;for(;this._left(e)<this.size&&this._greater(this._left(e),e)||this._right(e)<this.size&&this._greater(this._right(e),e);){const t=this._right(e)<this.size&&this._greater(this._right(e),this._left(e))?this._right(e):this._left(e);this._swap(e,t),e=t}}}class CharTrie{constructor(){this.root=CharTrieNode.default()}extend(e){for(let t of e)this.push(t)}push(e){let t=this.root;for(let s of e){let o=t.children.get(s);o===void 0&&(o=CharTrieNode.default(),t.children.set(s,o)),t=o}t.isLeaf=!0}*commonPrefixSearch(e){let t=this.root,s="";for(let o=0;o<e.length&&t!==void 0;++o){const u=e[o];s+=u,t=t.children.get(u),t!==void 0&&t.isLeaf&&(yield s)}}}class CharTrieNode{constructor(e,t){this.isLeaf=e,this.children=t}static default(){return new CharTrieNode(!1,new Map)}}class TokenLattice{constructor(e,t,s){this.sentence=e,this.len=e.length,this.bosTokenId=t,this.eosTokenId=s,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);const o=new TokenLatticeNode(this.bosTokenId,0,0,0,0),u=new TokenLatticeNode(this.eosTokenId,1,this.len,0,0);this.nodes.push(o.clone()),this.nodes.push(u.clone()),this.beginNodes[this.len].push(u),this.endNodes[0].push(o)}insert(e,t,s,o){const u=this.nodes.length,l=new TokenLatticeNode(o,u,e,t,s);this.beginNodes[e].push(l),this.endNodes[e+t].push(l),this.nodes.push(l)}viterbi(){const e=this.len;let t=0;for(;t<=e;){if(this.beginNodes[t].length==0)return[];for(let m of this.beginNodes[t]){m.prev=null;let g=0,h=null;for(let f of this.endNodes[t]){const i=f.backtraceScore+m.score;(h===null||i>g)&&(h=f.clone(),g=i)}if(h!==null)m.prev=h,m.backtraceScore=g;else return[]}++t}const s=[],u=this.beginNodes[e][0].prev;if(u===null)return[];let l=u.clone();for(;l.prev!==null;)s.push(l.clone()),l=l.clone().prev.clone();return s.reverse(),s}piece(e){return this.sentence.slice(e.pos,e.pos+e.length)}tokens(){return this.viterbi().map(t=>this.piece(t))}tokenIds(){return this.viterbi().map(t=>t.tokenId)}}class TokenLatticeNode{constructor(e,t,s,o,u){this.tokenId=e,this.nodeId=t,this.pos=s,this.length=o,this.score=u,this.prev=null,this.backtraceScore=0}clone(){const e=new TokenLatticeNode(this.tokenId,this.nodeId,this.pos,this.length,this.score);return e.prev=this.prev,e.backtraceScore=this.backtraceScore,e}}var TOKEN_TYPES=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator"}),KEYWORDS=Object.freeze({set:TOKEN_TYPES.Set,for:TOKEN_TYPES.For,in:TOKEN_TYPES.In,is:TOKEN_TYPES.Is,if:TOKEN_TYPES.If,else:TOKEN_TYPES.Else,endif:TOKEN_TYPES.EndIf,elif:TOKEN_TYPES.ElseIf,endfor:TOKEN_TYPES.EndFor,and:TOKEN_TYPES.And,or:TOKEN_TYPES.Or,not:TOKEN_TYPES.Not,"not in":TOKEN_TYPES.NotIn,true:TOKEN_TYPES.BooleanLiteral,false:TOKEN_TYPES.BooleanLiteral}),Token=class{constructor(n,e){this.value=n,this.type=e}};function isWord(n){return/\w/.test(n)}function isInteger(n){return/[0-9]/.test(n)}var ORDERED_MAPPING_TABLE=[["{%",TOKEN_TYPES.OpenStatement],["%}",TOKEN_TYPES.CloseStatement],["{{",TOKEN_TYPES.OpenExpression],["}}",TOKEN_TYPES.CloseExpression],["(",TOKEN_TYPES.OpenParen],[")",TOKEN_TYPES.CloseParen],["{",TOKEN_TYPES.OpenCurlyBracket],["}",TOKEN_TYPES.CloseCurlyBracket],["[",TOKEN_TYPES.OpenSquareBracket],["]",TOKEN_TYPES.CloseSquareBracket],[",",TOKEN_TYPES.Comma],[".",TOKEN_TYPES.Dot],[":",TOKEN_TYPES.Colon],["|",TOKEN_TYPES.Pipe],["<=",TOKEN_TYPES.ComparisonBinaryOperator],[">=",TOKEN_TYPES.ComparisonBinaryOperator],["==",TOKEN_TYPES.ComparisonBinaryOperator],["!=",TOKEN_TYPES.ComparisonBinaryOperator],["<",TOKEN_TYPES.ComparisonBinaryOperator],[">",TOKEN_TYPES.ComparisonBinaryOperator],["+",TOKEN_TYPES.AdditiveBinaryOperator],["-",TOKEN_TYPES.AdditiveBinaryOperator],["*",TOKEN_TYPES.MultiplicativeBinaryOperator],["/",TOKEN_TYPES.MultiplicativeBinaryOperator],["%",TOKEN_TYPES.MultiplicativeBinaryOperator],["=",TOKEN_TYPES.Equals]],ESCAPE_CHARACTERS=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function preprocess(n,e={}){return n.endsWith(`
`)&&(n=n.slice(0,-1)),n=n.replace(/{#.*?#}/gs,"{##}"),e.lstrip_blocks&&(n=n.replace(/^[ \t]*({[#%])/gm,"$1")),e.trim_blocks&&(n=n.replace(/([#%]})\n/g,"$1")),n.replace(/{##}/g,"").replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{")}function tokenize(n,e={}){const t=[],s=preprocess(n,e);let o=0;const u=l=>{let m="";for(;l(s[o]);){if(s[o]==="\\"){if(++o,o>=s.length)throw new SyntaxError("Unexpected end of input");const g=s[o++],h=ESCAPE_CHARACTERS.get(g);if(h===void 0)throw new SyntaxError(`Unexpected escaped character: ${g}`);m+=h;continue}if(m+=s[o++],o>=s.length)throw new SyntaxError("Unexpected end of input")}return m};e:for(;o<s.length;){const l=t.at(-1)?.type;if(l===void 0||l===TOKEN_TYPES.CloseStatement||l===TOKEN_TYPES.CloseExpression){let g="";for(;o<s.length&&!(s[o]==="{"&&(s[o+1]==="%"||s[o+1]==="{"));)g+=s[o++];if(g.length>0){t.push(new Token(g,TOKEN_TYPES.Text));continue}}u(g=>/\s/.test(g));const m=s[o];if(m==="-"||m==="+"){const g=t.at(-1)?.type;if(g===TOKEN_TYPES.Text||g===void 0)throw new SyntaxError(`Unexpected character: ${m}`);switch(g){case TOKEN_TYPES.Identifier:case TOKEN_TYPES.NumericLiteral:case TOKEN_TYPES.BooleanLiteral:case TOKEN_TYPES.StringLiteral:case TOKEN_TYPES.CloseParen:case TOKEN_TYPES.CloseSquareBracket:break;default:{++o;const h=u(isInteger);t.push(new Token(`${m}${h}`,h.length>0?TOKEN_TYPES.NumericLiteral:TOKEN_TYPES.UnaryOperator));continue}}}for(const[g,h]of ORDERED_MAPPING_TABLE)if(s.slice(o,o+g.length)===g){t.push(new Token(g,h)),o+=g.length;continue e}if(m==="'"||m==='"'){++o;const g=u(h=>h!==m);t.push(new Token(g,TOKEN_TYPES.StringLiteral)),++o;continue}if(isInteger(m)){const g=u(isInteger);t.push(new Token(g,TOKEN_TYPES.NumericLiteral));continue}if(isWord(m)){const g=u(isWord),h=Object.hasOwn(KEYWORDS,g)?KEYWORDS[g]:TOKEN_TYPES.Identifier;h===TOKEN_TYPES.In&&t.at(-1)?.type===TOKEN_TYPES.Not?(t.pop(),t.push(new Token("not in",TOKEN_TYPES.NotIn))):t.push(new Token(g,h));continue}throw new SyntaxError(`Unexpected character: ${m}`)}return t}var Statement=class{type="Statement"},Program=class extends Statement{constructor(n){super(),this.body=n}type="Program"},If=class extends Statement{constructor(n,e,t){super(),this.test=n,this.body=e,this.alternate=t}type="If"},For=class extends Statement{constructor(n,e,t){super(),this.loopvar=n,this.iterable=e,this.body=t}type="For"},SetStatement=class extends Statement{constructor(n,e){super(),this.assignee=n,this.value=e}type="Set"},Expression=class extends Statement{type="Expression"},MemberExpression=class extends Expression{constructor(n,e,t){super(),this.object=n,this.property=e,this.computed=t}type="MemberExpression"},CallExpression=class extends Expression{constructor(n,e){super(),this.callee=n,this.args=e}type="CallExpression"},Identifier=class extends Expression{constructor(n){super(),this.value=n}type="Identifier"},Literal=class extends Expression{constructor(n){super(),this.value=n}type="Literal"},NumericLiteral=class extends Literal{type="NumericLiteral"},StringLiteral=class extends Literal{type="StringLiteral"},BooleanLiteral=class extends Literal{type="BooleanLiteral"},ArrayLiteral=class extends Literal{type="ArrayLiteral"},TupleLiteral=class extends Literal{type="TupleLiteral"},ObjectLiteral=class extends Literal{type="ObjectLiteral"},BinaryExpression=class extends Expression{constructor(n,e,t){super(),this.operator=n,this.left=e,this.right=t}type="BinaryExpression"},FilterExpression=class extends Expression{constructor(n,e){super(),this.operand=n,this.filter=e}type="FilterExpression"},TestExpression=class extends Expression{constructor(n,e,t){super(),this.operand=n,this.negate=e,this.test=t}type="TestExpression"},UnaryExpression=class extends Expression{constructor(n,e){super(),this.operator=n,this.argument=e}type="UnaryExpression"},SliceExpression=class extends Expression{constructor(n=void 0,e=void 0,t=void 0){super(),this.start=n,this.stop=e,this.step=t}type="SliceExpression"},KeywordArgumentExpression=class extends Expression{constructor(n,e){super(),this.key=n,this.value=e}type="KeywordArgumentExpression"};function parse(n){const e=new Program([]);let t=0;function s($,k){const H=n[t++];if(!H||H.type!==$)throw new Error(`Parser Error: ${k}. ${H.type} !== ${$}.`);return H}function o(){switch(n[t].type){case TOKEN_TYPES.Text:return m();case TOKEN_TYPES.OpenStatement:return g();case TOKEN_TYPES.OpenExpression:return h();default:throw new SyntaxError(`Unexpected token type: ${n[t].type}`)}}function u(...$){return t+$.length<=n.length&&$.some((k,H)=>k!==n[t+H].type)}function l(...$){return t+$.length<=n.length&&$.every((k,H)=>k===n[t+H].type)}function m(){return new StringLiteral(s(TOKEN_TYPES.Text,"Expected text token").value)}function g(){s(TOKEN_TYPES.OpenStatement,"Expected opening statement token");let $;switch(n[t].type){case TOKEN_TYPES.Set:++t,$=f(),s(TOKEN_TYPES.CloseStatement,"Expected closing statement token");break;case TOKEN_TYPES.If:++t,$=i(),s(TOKEN_TYPES.OpenStatement,"Expected {% token"),s(TOKEN_TYPES.EndIf,"Expected endif token"),s(TOKEN_TYPES.CloseStatement,"Expected %} token");break;case TOKEN_TYPES.For:++t,$=d(),s(TOKEN_TYPES.OpenStatement,"Expected {% token"),s(TOKEN_TYPES.EndFor,"Expected endfor token"),s(TOKEN_TYPES.CloseStatement,"Expected %} token");break;default:throw new SyntaxError(`Unknown statement type: ${n[t].type}`)}return $}function h(){s(TOKEN_TYPES.OpenExpression,"Expected opening expression token");const $=p();return s(TOKEN_TYPES.CloseExpression,"Expected closing expression token"),$}function f(){const $=p();if(l(TOKEN_TYPES.Equals)){++t;const k=f();return new SetStatement($,k)}return $}function i(){const $=p();s(TOKEN_TYPES.CloseStatement,"Expected closing statement token");const k=[],H=[];for(;!(n[t]?.type===TOKEN_TYPES.OpenStatement&&(n[t+1]?.type===TOKEN_TYPES.ElseIf||n[t+1]?.type===TOKEN_TYPES.Else||n[t+1]?.type===TOKEN_TYPES.EndIf));)k.push(o());if(n[t]?.type===TOKEN_TYPES.OpenStatement&&n[t+1]?.type!==TOKEN_TYPES.EndIf)if(++t,l(TOKEN_TYPES.ElseIf))s(TOKEN_TYPES.ElseIf,"Expected elseif token"),H.push(i());else for(s(TOKEN_TYPES.Else,"Expected else token"),s(TOKEN_TYPES.CloseStatement,"Expected closing statement token");!(n[t]?.type===TOKEN_TYPES.OpenStatement&&n[t+1]?.type===TOKEN_TYPES.EndIf);)H.push(o());return new If($,k,H)}function r($=!1){const k=$?W:p,H=[k()],de=l(TOKEN_TYPES.Comma);for(;de&&(++t,H.push(k()),!!l(TOKEN_TYPES.Comma)););return de?new TupleLiteral(H):H[0]}function d(){const $=r(!0);if(!($ instanceof Identifier||$ instanceof TupleLiteral))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${$.type} instead`);s(TOKEN_TYPES.In,"Expected `in` keyword following loop variable");const k=p();s(TOKEN_TYPES.CloseStatement,"Expected closing statement token");const H=[];for(;u(TOKEN_TYPES.OpenStatement,TOKEN_TYPES.EndFor);)H.push(o());return new For($,k,H)}function p(){return _()}function _(){const $=y();if(l(TOKEN_TYPES.If)){++t;const k=y();s(TOKEN_TYPES.Else,"Expected else token");const H=y();return new If(k,[$],[H])}return $}function y(){let $=v();for(;l(TOKEN_TYPES.Or);){const k=n[t];++t;const H=v();$=new BinaryExpression(k,$,H)}return $}function v(){let $=T();for(;l(TOKEN_TYPES.And);){const k=n[t];++t;const H=T();$=new BinaryExpression(k,$,H)}return $}function T(){let $;for(;l(TOKEN_TYPES.Not);){const k=n[t];++t;const H=T();$=new UnaryExpression(k,H)}return $??w()}function w(){let $=E();for(;l(TOKEN_TYPES.ComparisonBinaryOperator)||l(TOKEN_TYPES.In)||l(TOKEN_TYPES.NotIn);){const k=n[t];++t;const H=E();$=new BinaryExpression(k,$,H)}return $}function E(){let $=Y();for(;l(TOKEN_TYPES.AdditiveBinaryOperator);){const k=n[t];++t;const H=Y();$=new BinaryExpression(k,$,H)}return $}function P(){const $=D();return l(TOKEN_TYPES.OpenParen)?R($):$}function R($){let k=new CallExpression($,I());return l(TOKEN_TYPES.OpenParen)&&(k=R(k)),k}function I(){s(TOKEN_TYPES.OpenParen,"Expected opening parenthesis for arguments list");const $=N();return s(TOKEN_TYPES.CloseParen,"Expected closing parenthesis for arguments list"),$}function N(){const $=[];for(;!l(TOKEN_TYPES.CloseParen);){let k=p();if(l(TOKEN_TYPES.Equals)){if(++t,!(k instanceof Identifier))throw new SyntaxError("Expected identifier for keyword argument");const H=p();k=new KeywordArgumentExpression(k,H)}$.push(k),l(TOKEN_TYPES.Comma)&&++t}return $}function B(){const $=[];let k=!1;for(;!l(TOKEN_TYPES.CloseSquareBracket);)l(TOKEN_TYPES.Colon)?($.push(void 0),++t,k=!0):($.push(p()),l(TOKEN_TYPES.Colon)&&(++t,k=!0));if($.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(k){if($.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new SliceExpression(...$)}return $[0]}function D(){let $=W();for(;l(TOKEN_TYPES.Dot)||l(TOKEN_TYPES.OpenSquareBracket);){const k=n[t];++t;let H;const de=k.type!==TOKEN_TYPES.Dot;if(de)H=B(),s(TOKEN_TYPES.CloseSquareBracket,"Expected closing square bracket");else if(H=W(),H.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");$=new MemberExpression($,H,de)}return $}function Y(){let $=se();for(;l(TOKEN_TYPES.MultiplicativeBinaryOperator);){const k=n[t];++t;const H=se();$=new BinaryExpression(k,$,H)}return $}function se(){let $=re();for(;l(TOKEN_TYPES.Is);){++t;const k=l(TOKEN_TYPES.Not);k&&++t;let H=W();if(H instanceof BooleanLiteral&&(H=new Identifier(H.value.toString())),!(H instanceof Identifier))throw new SyntaxError("Expected identifier for the test");$=new TestExpression($,k,H)}return $}function re(){let $=P();for(;l(TOKEN_TYPES.Pipe);){++t;let k=W();if(!(k instanceof Identifier))throw new SyntaxError("Expected identifier for the filter");l(TOKEN_TYPES.OpenParen)&&(k=R(k)),$=new FilterExpression($,k)}return $}function W(){const $=n[t];switch($.type){case TOKEN_TYPES.NumericLiteral:return++t,new NumericLiteral(Number($.value));case TOKEN_TYPES.StringLiteral:return++t,new StringLiteral($.value);case TOKEN_TYPES.BooleanLiteral:return++t,new BooleanLiteral($.value==="true");case TOKEN_TYPES.Identifier:return++t,new Identifier($.value);case TOKEN_TYPES.OpenParen:{++t;const k=r();if(n[t].type!==TOKEN_TYPES.CloseParen)throw new SyntaxError(`Expected closing parenthesis, got ${n[t].type} instead`);return++t,k}case TOKEN_TYPES.OpenSquareBracket:{++t;const k=[];for(;!l(TOKEN_TYPES.CloseSquareBracket);)k.push(p()),l(TOKEN_TYPES.Comma)&&++t;return++t,new ArrayLiteral(k)}case TOKEN_TYPES.OpenCurlyBracket:{++t;const k=new Map;for(;!l(TOKEN_TYPES.CloseCurlyBracket);){const H=p();s(TOKEN_TYPES.Colon,"Expected colon between key and value in object literal");const de=p();k.set(H,de),l(TOKEN_TYPES.Comma)&&++t}return++t,new ObjectLiteral(k)}default:throw new SyntaxError(`Unexpected token: ${$.type}`)}}for(;t<n.length;)e.body.push(o());return e}function range(n,e,t=1){e===void 0&&(e=n,n=0);const s=[];for(let o=n;o<e;o+=t)s.push(o);return s}function slice(n,e,t,s=1){const o=Math.sign(s);o>=0?(e=(e??=0)<0?Math.max(n.length+e,0):Math.min(e,n.length),t=(t??=n.length)<0?Math.max(n.length+t,0):Math.min(t,n.length)):(e=(e??=n.length-1)<0?Math.max(n.length+e,-1):Math.min(e,n.length-1),t=(t??=-1)<-1?Math.max(n.length+t,-1):Math.min(t,n.length-1));const u=[];for(let l=e;o*l<o*t;l+=s)u.push(n[l]);return u}function titleCase(n){return n.replace(/\b\w/g,e=>e.toUpperCase())}var RuntimeValue=class{type="RuntimeValue";value;builtins=new Map;constructor(n=void 0){this.value=n}__bool__(){return new BooleanValue(!!this.value)}},NumericValue=class extends RuntimeValue{type="NumericValue"},StringValue=class extends RuntimeValue{type="StringValue";builtins=new Map([["upper",new FunctionValue(()=>new StringValue(this.value.toUpperCase()))],["lower",new FunctionValue(()=>new StringValue(this.value.toLowerCase()))],["strip",new FunctionValue(()=>new StringValue(this.value.trim()))],["title",new FunctionValue(()=>new StringValue(titleCase(this.value)))],["length",new NumericValue(this.value.length)]])},BooleanValue=class extends RuntimeValue{type="BooleanValue"},ObjectValue=class extends RuntimeValue{type="ObjectValue";__bool__(){return new BooleanValue(this.value.size>0)}builtins=new Map([["get",new FunctionValue(([n,e])=>{if(!(n instanceof StringValue))throw new Error(`Object key must be a string: got ${n.type}`);return this.value.get(n.value)??e??new NullValue})],["items",new FunctionValue(()=>new ArrayValue(Array.from(this.value.entries()).map(([n,e])=>new ArrayValue([new StringValue(n),e]))))]])},ArrayValue=class extends RuntimeValue{type="ArrayValue";builtins=new Map([["length",new NumericValue(this.value.length)]]);__bool__(){return new BooleanValue(this.value.length>0)}},TupleValue=class extends ArrayValue{type="TupleValue"},FunctionValue=class extends RuntimeValue{type="FunctionValue"},NullValue=class extends RuntimeValue{type="NullValue"},UndefinedValue=class extends RuntimeValue{type="UndefinedValue"},Environment=class{constructor(n){this.parent=n}variables=new Map([["namespace",new FunctionValue(n=>{if(n.length===0)return new ObjectValue(new Map);if(n.length!==1||!(n[0]instanceof ObjectValue))throw new Error("`namespace` expects either zero arguments or a single object argument");return n[0]})]]);tests=new Map([["boolean",n=>n.type==="BooleanValue"],["callable",n=>n instanceof FunctionValue],["odd",n=>{if(n.type!=="NumericValue")throw new Error(`Cannot apply test "odd" to type: ${n.type}`);return n.value%2!==0}],["even",n=>{if(n.type!=="NumericValue")throw new Error(`Cannot apply test "even" to type: ${n.type}`);return n.value%2===0}],["false",n=>n.type==="BooleanValue"&&!n.value],["true",n=>n.type==="BooleanValue"&&n.value],["number",n=>n.type==="NumericValue"],["integer",n=>n.type==="NumericValue"&&Number.isInteger(n.value)],["iterable",n=>n instanceof ArrayValue||n instanceof StringValue],["lower",n=>{const e=n.value;return n.type==="StringValue"&&e===e.toLowerCase()}],["upper",n=>{const e=n.value;return n.type==="StringValue"&&e===e.toUpperCase()}],["none",n=>n.type==="NullValue"],["defined",n=>n.type!=="UndefinedValue"],["undefined",n=>n.type==="UndefinedValue"],["equalto",(n,e)=>n.value===e.value]]);set(n,e){return this.declareVariable(n,convertToRuntimeValues(e))}declareVariable(n,e){if(this.variables.has(n))throw new SyntaxError(`Variable already declared: ${n}`);return this.variables.set(n,e),e}setVariable(n,e){return this.variables.set(n,e),e}resolve(n){if(this.variables.has(n))return this;if(this.parent)return this.parent.resolve(n);throw new Error(`Unknown variable: ${n}`)}lookupVariable(n){try{return this.resolve(n).variables.get(n)??new UndefinedValue}catch{return new UndefinedValue}}},Interpreter=class{global;constructor(n){this.global=n??new Environment}run(n){return this.evaluate(n,this.global)}evaluateBinaryExpression(n,e){const t=this.evaluate(n.left,e);switch(n.operator.value){case"and":return t.__bool__().value?this.evaluate(n.right,e):t;case"or":return t.__bool__().value?t:this.evaluate(n.right,e)}const s=this.evaluate(n.right,e);switch(n.operator.value){case"==":return new BooleanValue(t.value==s.value);case"!=":return new BooleanValue(t.value!=s.value)}if(t instanceof UndefinedValue||s instanceof UndefinedValue)throw new Error("Cannot perform operation on undefined values");if(t instanceof NullValue||s instanceof NullValue)throw new Error("Cannot perform operation on null values");if(t instanceof NumericValue&&s instanceof NumericValue)switch(n.operator.value){case"+":return new NumericValue(t.value+s.value);case"-":return new NumericValue(t.value-s.value);case"*":return new NumericValue(t.value*s.value);case"/":return new NumericValue(t.value/s.value);case"%":return new NumericValue(t.value%s.value);case"<":return new BooleanValue(t.value<s.value);case">":return new BooleanValue(t.value>s.value);case">=":return new BooleanValue(t.value>=s.value);case"<=":return new BooleanValue(t.value<=s.value)}else if(t instanceof ArrayValue&&s instanceof ArrayValue)switch(n.operator.value){case"+":return new ArrayValue(t.value.concat(s.value))}else if(s instanceof ArrayValue){const o=s.value.find(u=>u.value===t.value)!==void 0;switch(n.operator.value){case"in":return new BooleanValue(o);case"not in":return new BooleanValue(!o)}}if(t instanceof StringValue||s instanceof StringValue)switch(n.operator.value){case"+":return new StringValue(t.value.toString()+s.value.toString())}if(t instanceof StringValue&&s instanceof StringValue)switch(n.operator.value){case"in":return new BooleanValue(s.value.includes(t.value));case"not in":return new BooleanValue(!s.value.includes(t.value))}if(t instanceof StringValue&&s instanceof ObjectValue)switch(n.operator.value){case"in":return new BooleanValue(s.value.has(t.value));case"not in":return new BooleanValue(!s.value.has(t.value))}throw new SyntaxError(`Unknown operator "${n.operator.value}" between ${t.type} and ${s.type}`)}evaluateFilterExpression(n,e){const t=this.evaluate(n.operand,e);if(n.filter.type==="Identifier"){const s=n.filter;if(t instanceof ArrayValue)switch(s.value){case"list":return t;case"first":return t.value[0];case"last":return t.value[t.value.length-1];case"length":return new NumericValue(t.value.length);case"reverse":return new ArrayValue(t.value.reverse());case"sort":return new ArrayValue(t.value.sort((o,u)=>{if(o.type!==u.type)throw new Error(`Cannot compare different types: ${o.type} and ${u.type}`);switch(o.type){case"NumericValue":return o.value-u.value;case"StringValue":return o.value.localeCompare(u.value);default:throw new Error(`Cannot compare type: ${o.type}`)}}));default:throw new Error(`Unknown ArrayValue filter: ${s.value}`)}else if(t instanceof StringValue)switch(s.value){case"length":return new NumericValue(t.value.length);case"upper":return new StringValue(t.value.toUpperCase());case"lower":return new StringValue(t.value.toLowerCase());case"title":return new StringValue(titleCase(t.value));case"capitalize":return new StringValue(t.value.charAt(0).toUpperCase()+t.value.slice(1));case"trim":return new StringValue(t.value.trim());default:throw new Error(`Unknown StringValue filter: ${s.value}`)}else if(t instanceof NumericValue)switch(s.value){case"abs":return new NumericValue(Math.abs(t.value));default:throw new Error(`Unknown NumericValue filter: ${s.value}`)}else if(t instanceof ObjectValue)switch(s.value){case"items":return new ArrayValue(Array.from(t.value.entries()).map(([o,u])=>new ArrayValue([new StringValue(o),u])));case"length":return new NumericValue(t.value.size);default:throw new Error(`Unknown ObjectValue filter: ${s.value}`)}throw new Error(`Cannot apply filter "${s.value}" to type: ${t.type}`)}else if(n.filter.type==="CallExpression"){const s=n.filter;if(s.callee.type!=="Identifier")throw new Error(`Unknown filter: ${s.callee.type}`);const o=s.callee.value;if(t instanceof ArrayValue){switch(o){case"selectattr":{if(t.value.some(f=>!(f instanceof ObjectValue)))throw new Error("`selectattr` can only be applied to array of objects");if(s.args.some(f=>f.type!=="StringLiteral"))throw new Error("arguments of `selectattr` must be strings");const[u,l,m]=s.args.map(f=>this.evaluate(f,e));let g;if(l){const f=e.tests.get(l.value);if(!f)throw new Error(`Unknown test: ${l.value}`);g=f}else g=(...f)=>f[0].__bool__().value;const h=t.value.filter(f=>{const i=f.value.get(u.value);return i?g(i,m):!1});return new ArrayValue(h)}}throw new Error(`Unknown ArrayValue filter: ${o}`)}else throw new Error(`Cannot apply filter "${o}" to type: ${t.type}`)}throw new Error(`Unknown filter: ${n.filter.type}`)}evaluateTestExpression(n,e){const t=this.evaluate(n.operand,e),s=e.tests.get(n.test.value);if(!s)throw new Error(`Unknown test: ${n.test.value}`);const o=s(t);return new BooleanValue(n.negate?!o:o)}evaluateUnaryExpression(n,e){const t=this.evaluate(n.argument,e);switch(n.operator.value){case"not":return new BooleanValue(!t.value);default:throw new SyntaxError(`Unknown operator: ${n.operator.value}`)}}evalProgram(n,e){return this.evaluateBlock(n.body,e)}evaluateBlock(n,e){let t="";for(const s of n){const o=this.evaluate(s,e);o.type!=="NullValue"&&o.type!=="UndefinedValue"&&(t+=o.value)}return new StringValue(t)}evaluateIdentifier(n,e){return e.lookupVariable(n.value)}evaluateCallExpression(n,e){const t=[],s=new Map;for(const u of n.args)if(u.type==="KeywordArgumentExpression"){const l=u;s.set(l.key.value,this.evaluate(l.value,e))}else t.push(this.evaluate(u,e));s.size>0&&t.push(new ObjectValue(s));const o=this.evaluate(n.callee,e);if(o.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${o.type}`);return o.value(t,e)}evaluateSliceExpression(n,e,t){if(!(n instanceof ArrayValue||n instanceof StringValue))throw new Error("Slice object must be an array or string");const s=this.evaluate(e.start,t),o=this.evaluate(e.stop,t),u=this.evaluate(e.step,t);if(!(s instanceof NumericValue||s instanceof UndefinedValue))throw new Error("Slice start must be numeric or undefined");if(!(o instanceof NumericValue||o instanceof UndefinedValue))throw new Error("Slice stop must be numeric or undefined");if(!(u instanceof NumericValue||u instanceof UndefinedValue))throw new Error("Slice step must be numeric or undefined");return n instanceof ArrayValue?new ArrayValue(slice(n.value,s.value,o.value,u.value)):new StringValue(slice(Array.from(n.value),s.value,o.value,u.value).join(""))}evaluateMemberExpression(n,e){const t=this.evaluate(n.object,e);let s;if(n.computed){if(n.property.type==="SliceExpression")return this.evaluateSliceExpression(t,n.property,e);s=this.evaluate(n.property,e)}else s=new StringValue(n.property.value);let o;if(t instanceof ObjectValue){if(!(s instanceof StringValue))throw new Error(`Cannot access property with non-string: got ${s.type}`);o=t.value.get(s.value)??t.builtins.get(s.value)}else if(t instanceof ArrayValue||t instanceof StringValue)if(s instanceof NumericValue)o=t.value.at(s.value),t instanceof StringValue&&(o=new StringValue(t.value.at(s.value)));else if(s instanceof StringValue)o=t.builtins.get(s.value);else throw new Error(`Cannot access property with non-string/non-number: got ${s.type}`);else{if(!(s instanceof StringValue))throw new Error(`Cannot access property with non-string: got ${s.type}`);o=t.builtins.get(s.value)}return o instanceof RuntimeValue?o:new UndefinedValue}evaluateSet(n,e){const t=this.evaluate(n.value,e);if(n.assignee.type==="Identifier"){const s=n.assignee.value;e.setVariable(s,t)}else if(n.assignee.type==="MemberExpression"){const s=n.assignee,o=this.evaluate(s.object,e);if(!(o instanceof ObjectValue))throw new Error("Cannot assign to member of non-object");if(s.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");o.value.set(s.property.value,t)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(n.assignee)}`);return new NullValue}evaluateIf(n,e){const t=this.evaluate(n.test,e);return this.evaluateBlock(t.__bool__().value?n.body:n.alternate,e)}evaluateFor(n,e){const t=new Environment(e),s=this.evaluate(n.iterable,t);if(!(s instanceof ArrayValue))throw new Error(`Expected iterable type in for loop: got ${s.type}`);let o="";for(let u=0;u<s.value.length;++u){const l=new Map([["index",new NumericValue(u+1)],["index0",new NumericValue(u)],["revindex",new NumericValue(s.value.length-u)],["revindex0",new NumericValue(s.value.length-u-1)],["first",new BooleanValue(u===0)],["last",new BooleanValue(u===s.value.length-1)],["length",new NumericValue(s.value.length)],["previtem",u>0?s.value[u-1]:new UndefinedValue],["nextitem",u<s.value.length-1?s.value[u+1]:new UndefinedValue]]);t.setVariable("loop",new ObjectValue(l));const m=s.value[u];if(n.loopvar.type==="Identifier")t.setVariable(n.loopvar.value,m);else if(n.loopvar.type==="TupleLiteral"){const h=n.loopvar;if(m.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${m.type}`);const f=m;if(h.value.length!==f.value.length)throw new Error(`Too ${h.value.length>f.value.length?"few":"many"} items to unpack`);for(let i=0;i<h.value.length;++i){if(h.value[i].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${h.value[i].type}`);t.setVariable(h.value[i].value,f.value[i])}}const g=this.evaluateBlock(n.body,t);o+=g.value}return new StringValue(o)}evaluate(n,e){if(n===void 0)return new UndefinedValue;switch(n.type){case"Program":return this.evalProgram(n,e);case"Set":return this.evaluateSet(n,e);case"If":return this.evaluateIf(n,e);case"For":return this.evaluateFor(n,e);case"NumericLiteral":return new NumericValue(Number(n.value));case"StringLiteral":return new StringValue(n.value);case"BooleanLiteral":return new BooleanValue(n.value);case"ArrayLiteral":return new ArrayValue(n.value.map(t=>this.evaluate(t,e)));case"TupleLiteral":return new TupleValue(n.value.map(t=>this.evaluate(t,e)));case"ObjectLiteral":{const t=new Map;for(const[s,o]of n.value){const u=this.evaluate(s,e);if(!(u instanceof StringValue))throw new Error(`Object keys must be strings: got ${u.type}`);t.set(u.value,this.evaluate(o,e))}return new ObjectValue(t)}case"Identifier":return this.evaluateIdentifier(n,e);case"CallExpression":return this.evaluateCallExpression(n,e);case"MemberExpression":return this.evaluateMemberExpression(n,e);case"UnaryExpression":return this.evaluateUnaryExpression(n,e);case"BinaryExpression":return this.evaluateBinaryExpression(n,e);case"FilterExpression":return this.evaluateFilterExpression(n,e);case"TestExpression":return this.evaluateTestExpression(n,e);default:throw new SyntaxError(`Unknown node type: ${n.type}`)}}};function convertToRuntimeValues(n){switch(typeof n){case"number":return new NumericValue(n);case"string":return new StringValue(n);case"boolean":return new BooleanValue(n);case"object":return n===null?new NullValue:Array.isArray(n)?new ArrayValue(n.map(convertToRuntimeValues)):new ObjectValue(new Map(Object.entries(n).map(([e,t])=>[e,convertToRuntimeValues(t)])));case"function":return new FunctionValue((e,t)=>{const s=n(...e.map(o=>o.value))??null;return convertToRuntimeValues(s)});default:throw new Error(`Cannot convert to runtime value: ${n}`)}}var Template=class{parsed;constructor(n){const e=tokenize(n,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=parse(e)}render(n){const e=new Environment;e.set("false",!1),e.set("true",!0),e.set("raise_exception",o=>{throw new Error(o)}),e.set("range",range);for(const[o,u]of Object.entries(n))e.set(o,u);return new Interpreter(e).run(this.parsed).value}};async function loadTokenizer(n,e){const t=await Promise.all([getModelJSON(n,"tokenizer.json",!0,e),getModelJSON(n,"tokenizer_config.json",!0,e)]);return e.legacy!==null&&(t[1].legacy=e.legacy),t}function regexSplit(n,e){const t=[];let s=0;for(const o of n.matchAll(e)){const u=o[0];s<o.index&&t.push(n.slice(s,o.index)),u.length>0&&t.push(u),s=o.index+u.length}return s<n.length&&t.push(n.slice(s)),t}function createPattern(n,e=!0){if(n.Regex!==void 0){let t=n.Regex.replace(/\\([#&~])/g,"$1");for(const[s,o]of PROBLEMATIC_REGEX_MAP)t=t.replaceAll(s,o);return new RegExp(t,"gu")}else if(n.String!==void 0){const t=escapeRegExp(n.String);return new RegExp(e?t:`(${t})`,"gu")}else return console.warn("Unknown pattern type:",n),null}function objectToMap(n){return new Map(Object.entries(n))}function prepareTensorForDecode(n){const e=n.dims;switch(e.length){case 1:return n.tolist();case 2:if(e[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return n.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${e.length}.`)}}function clean_up_tokenization(n){return n.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function remove_accents(n){return n.replace(/[\u0300-\u036f]/g,"")}function lowercase_and_remove_accent(n){return remove_accents(n.toLowerCase())}function fuse(n,e,t){const s=[];let o=0;for(;o<n.length;){if(s.push(n[o]),(t.get(n[o])??e)!==e){++o;continue}for(;o<n.length&&(t.get(n[o])??e)===e;)++o}return s}function whitespace_split(n){return n.match(/\S+/g)||[]}const PUNCTUATION_REGEX="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",PROBLEMATIC_REGEX_MAP=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"]]);class AddedToken{constructor(e){this.content=e.content,this.id=e.id,this.single_word=e.single_word??!1,this.lstrip=e.lstrip??!1,this.rstrip=e.rstrip??!1,this.special=e.special??!1,this.normalized=e.normalized??null}}class TokenizerModel extends Callable{constructor(e){super(),this.config=e,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(e,...t){switch(e.type){case"WordPiece":return new WordPieceTokenizer(e);case"Unigram":return new Unigram(e,...t);case"BPE":return new BPE(e);default:if(e.vocab)return new LegacyTokenizerModel(e,...t);throw new Error(`Unknown TokenizerModel type: ${e.type}`)}}_call(e){let t=this.encode(e);return this.fuse_unk&&(t=fuse(t,this.unk_token_id,this.tokens_to_ids)),t}encode(e){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(e){return e.map(t=>this.tokens_to_ids.get(t)??this.unk_token_id)}convert_ids_to_tokens(e){return e.map(t=>this.vocab[t]??this.unk_token)}}class WordPieceTokenizer extends TokenizerModel{constructor(e){super(e),this.tokens_to_ids=objectToMap(e.vocab),this.unk_token_id=this.tokens_to_ids.get(e.unk_token),this.unk_token=e.unk_token,this.max_input_chars_per_word=e.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(const[t,s]of this.tokens_to_ids)this.vocab[s]=t}encode(e){const t=[];for(const s of e){const o=[...s];if(o.length>this.max_input_chars_per_word){t.push(this.unk_token);continue}let u=!1,l=0;const m=[];for(;l<o.length;){let g=o.length,h=null;for(;l<g;){let f=o.slice(l,g).join("");if(l>0&&(f=this.config.continuing_subword_prefix+f),this.tokens_to_ids.has(f)){h=f;break}--g}if(h===null){u=!0;break}m.push(h),l=g}u?t.push(this.unk_token):t.push(...m)}return t}}class Unigram extends TokenizerModel{constructor(e,t){super(e);const s=e.vocab.length;this.vocab=new Array(s),this.scores=new Array(s);for(let o=0;o<s;++o){const u=e.vocab[o];this.vocab[o]=u[0],this.scores[o]=u[1]}this.unk_token_id=e.unk_id,this.unk_token=this.vocab[e.unk_id],this.tokens_to_ids=new Map(this.vocab.map((o,u)=>[o,u])),this.bosToken=" ",this.bosTokenId=this.tokens_to_ids.get(this.bosToken),this.eosToken=t.eos_token,this.eosTokenId=this.tokens_to_ids.get(this.eosToken),this.unkToken=this.vocab[this.unk_token_id],this.minScore=min(this.scores)[0],this.unkScore=this.minScore-10,this.scores[this.unk_token_id]=this.unkScore,this.trie=new CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(e){const t=e.sentence,s=t.length;let o=0;for(;o<s;){let l=!1;for(let m of this.trie.commonPrefixSearch(t.slice(o))){const g=this.tokens_to_ids.get(m),h=this.scores[g],f=m.length;e.insert(o,f,h,g),!l&&f===1&&(l=!0)}l||e.insert(o,1,this.unkScore,this.unk_token_id),o+=1}}tokenize(e){const t=new TokenLattice(e,this.bosTokenId,this.eosTokenId);return this.populateNodes(t),t.tokens()}encode(e){const t=[];for(const s of e){const o=this.tokenize(s);t.push(...o)}return t}}const BYTES_TO_UNICODE=(()=>{const n=[...Array.from({length:94},(o,u)=>u+33),...Array.from({length:12},(o,u)=>u+161),...Array.from({length:82},(o,u)=>u+174)],e=n.slice();let t=0;for(let o=0;o<256;++o)n.includes(o)||(n.push(o),e.push(256+t),t+=1);const s=e.map(o=>String.fromCharCode(o));return Object.fromEntries(n.map((o,u)=>[o,s[u]]))})(),UNICODE_TO_BYTES=reverseDictionary(BYTES_TO_UNICODE);class BPE extends TokenizerModel{constructor(e){super(e),this.BPE_SPLIT_TOKEN=" ",this.tokens_to_ids=objectToMap(e.vocab),this.unk_token_id=this.tokens_to_ids.get(e.unk_token),this.unk_token=e.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[t,s]of this.tokens_to_ids)this.vocab[s]=t;this.bpe_ranks=new Map(e.merges.map((t,s)=>[t,s])),this.merges=e.merges.map(t=>t.split(this.BPE_SPLIT_TOKEN)),this.end_of_word_suffix=e.end_of_word_suffix,this.continuing_subword_suffix=e.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.cache=new Map}bpe(e){if(e.length===0)return[];const t=this.cache.get(e);if(t!==void 0)return t;const s=Array.from(e);this.end_of_word_suffix&&(s[s.length-1]+=this.end_of_word_suffix);let o=[];if(s.length>1){const u=new PriorityQueue((g,h)=>g.score<h.score);let l={token:s[0],bias:0,prev:null,next:null},m=l;for(let g=1;g<s.length;++g){const h={bias:g/s.length,token:s[g],prev:m,next:null};m.next=h,this._add_node(u,m),m=h}for(;!u.isEmpty();){const g=u.pop();if(g.deleted||!g.next||g.next.deleted)continue;if(g.deleted=!0,g.next.deleted=!0,g.prev){const f={...g.prev};g.prev.deleted=!0,g.prev=f,f.prev?f.prev.next=f:l=f}const h={token:g.token+g.next.token,bias:g.bias,prev:g.prev,next:g.next.next};h.prev?(h.prev.next=h,this._add_node(u,h.prev)):l=h,h.next&&(h.next.prev=h,this._add_node(u,h))}for(let g=l;g!==null;g=g.next)o.push(g.token)}else o=s;if(this.continuing_subword_suffix)for(let u=0;u<o.length-1;++u)o[u]+=this.continuing_subword_suffix;return this.cache.set(e,o),o}_add_node(e,t){const s=this.bpe_ranks.get(t.token+this.BPE_SPLIT_TOKEN+t.next.token);s!==void 0&&(t.score=s+t.bias,e.push(t))}encode(e){const t=[];for(const s of e){if(this.ignore_merges&&this.tokens_to_ids.has(s)){t.push(s);continue}const o=this.bpe(s);for(const u of o)this.tokens_to_ids.has(u)?t.push(u):this.byte_fallback?t.push(...Array.from(this.text_encoder.encode(u)).map(l=>`<0x${l.toString(16).toUpperCase().padStart(2,"0")}>`)):t.push(this.unk_token)}return t}}class LegacyTokenizerModel extends TokenizerModel{constructor(e,t){super(e),this.tokens_to_ids=objectToMap(t.target_lang?e.vocab[t.target_lang]:e.vocab),this.bos_token=t.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=t.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=t.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=t.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(const[s,o]of this.tokens_to_ids)this.vocab[o]=s}encode(e){return e}}class Normalizer extends Callable{constructor(e){super(),this.config=e}static fromConfig(e){if(e===null)return null;switch(e.type){case"BertNormalizer":return new BertNormalizer(e);case"Precompiled":return new Precompiled(e);case"Sequence":return new NormalizerSequence(e);case"Replace":return new Replace(e);case"NFC":return new NFC(e);case"NFKC":return new NFKC(e);case"NFKD":return new NFKD(e);case"Strip":return new StripNormalizer(e);case"StripAccents":return new StripAccents(e);case"Lowercase":return new Lowercase(e);case"Prepend":return new Prepend(e);default:throw new Error(`Unknown Normalizer type: ${e.type}`)}}normalize(e){throw Error("normalize should be implemented in subclass.")}_call(e){return this.normalize(e)}}class Replace extends Normalizer{normalize(e){const t=createPattern(this.config.pattern);return t===null?e:e.replaceAll(t,this.config.content)}}class NFC extends Normalizer{normalize(e){return e=e.normalize("NFC"),e}}class NFKC extends Normalizer{normalize(e){return e=e.normalize("NFKC"),e}}class NFKD extends Normalizer{normalize(e){return e=e.normalize("NFKD"),e}}class StripNormalizer extends Normalizer{normalize(e){return this.config.strip_left&&this.config.strip_right?e=e.trim():(this.config.strip_left&&(e=e.trimStart()),this.config.strip_right&&(e=e.trimEnd())),e}}class StripAccents extends Normalizer{normalize(e){return e=remove_accents(e),e}}class Lowercase extends Normalizer{normalize(e){return e=e.toLowerCase(),e}}class Prepend extends Normalizer{normalize(e){return e=this.config.prepend+e,e}}class NormalizerSequence extends Normalizer{constructor(e){super(e),this.normalizers=e.normalizers.map(t=>Normalizer.fromConfig(t))}normalize(e){return this.normalizers.reduce((t,s)=>s.normalize(t),e)}}class BertNormalizer extends Normalizer{_tokenize_chinese_chars(e){const t=[];for(let s=0;s<e.length;++s){const o=e[s],u=o.charCodeAt(0);this._is_chinese_char(u)?(t.push(" "),t.push(o),t.push(" ")):t.push(o)}return t.join("")}_is_chinese_char(e){return e>=19968&&e<=40959||e>=13312&&e<=19903||e>=131072&&e<=173791||e>=173824&&e<=177983||e>=177984&&e<=178207||e>=178208&&e<=183983||e>=63744&&e<=64255||e>=194560&&e<=195103}stripAccents(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}_is_control(e){switch(e){case"	":case`
`:case"\r":return!1;default:return/^\p{Cc}|\p{Cf}|\p{Co}|\p{Cs}$/u.test(e)}}_clean_text(e){const t=[];for(const s of e){const o=s.charCodeAt(0);o===0||o===65533||this._is_control(s)||(/^\s$/.test(s)?t.push(" "):t.push(s))}return t.join("")}normalize(e){return this.config.clean_text&&(e=this._clean_text(e)),this.config.handle_chinese_chars&&(e=this._tokenize_chinese_chars(e)),this.config.lowercase?(e=e.toLowerCase(),this.config.strip_accents!==!1&&(e=this.stripAccents(e))):this.config.strip_accents&&(e=this.stripAccents(e)),e}}class PreTokenizer extends Callable{static fromConfig(e){if(e===null)return null;switch(e.type){case"BertPreTokenizer":return new BertPreTokenizer(e);case"Sequence":return new PreTokenizerSequence(e);case"Whitespace":return new WhitespacePreTokenizer(e);case"WhitespaceSplit":return new WhitespaceSplit(e);case"Metaspace":return new MetaspacePreTokenizer(e);case"ByteLevel":return new ByteLevelPreTokenizer(e);case"Split":return new SplitPreTokenizer(e);case"Punctuation":return new PunctuationPreTokenizer(e);case"Digits":return new DigitsPreTokenizer(e);case"Replace":return new ReplacePreTokenizer(e);default:throw new Error(`Unknown PreTokenizer type: ${e.type}`)}}pre_tokenize_text(e,t){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(e,t){return(Array.isArray(e)?e.map(s=>this.pre_tokenize_text(s,t)):this.pre_tokenize_text(e,t)).flat()}_call(e,t){return this.pre_tokenize(e,t)}}class BertPreTokenizer extends PreTokenizer{constructor(e){super(),this.pattern=new RegExp(`[^\\s${PUNCTUATION_REGEX}]+|[${PUNCTUATION_REGEX}]`,"gu")}pre_tokenize_text(e,t){return e.trim().match(this.pattern)||[]}}class ByteLevelPreTokenizer extends PreTokenizer{constructor(e){super(),this.config=e,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu,this.byte_encoder=BYTES_TO_UNICODE,this.text_encoder=new TextEncoder}pre_tokenize_text(e,t){return this.add_prefix_space&&!e.startsWith(" ")&&(e=" "+e),(this.use_regex?e.match(this.pattern)||[]:[e]).map(o=>Array.from(this.text_encoder.encode(o),u=>this.byte_encoder[u]).join(""))}}class SplitPreTokenizer extends PreTokenizer{constructor(e){super(),this.config=e,this.pattern=createPattern(this.config.pattern,this.config.invert)}pre_tokenize_text(e,t){return this.pattern===null?[]:this.config.invert?e.match(this.pattern)||[]:regexSplit(e,this.pattern)}}class PunctuationPreTokenizer extends PreTokenizer{constructor(e){super(),this.config=e,this.pattern=new RegExp(`[^${PUNCTUATION_REGEX}]+|[${PUNCTUATION_REGEX}]+`,"gu")}pre_tokenize_text(e,t){return e.match(this.pattern)||[]}}class DigitsPreTokenizer extends PreTokenizer{constructor(e){super(),this.config=e;const t=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(t,"gu")}pre_tokenize_text(e,t){return e.match(this.pattern)||[]}}class PostProcessor extends Callable{constructor(e){super(),this.config=e}static fromConfig(e){if(e===null)return null;switch(e.type){case"TemplateProcessing":return new TemplateProcessing(e);case"ByteLevel":return new ByteLevelPostProcessor(e);case"RobertaProcessing":return new RobertaProcessing(e);case"BertProcessing":return new BertProcessing(e);case"Sequence":return new PostProcessorSequence(e);default:throw new Error(`Unknown PostProcessor type: ${e.type}`)}}post_process(e,...t){throw Error("post_process should be implemented in subclass.")}_call(e,...t){return this.post_process(e,...t)}}class BertProcessing extends PostProcessor{constructor(e){super(e),this.cls=e.cls[0],this.sep=e.sep[0]}post_process(e,t=null,{add_special_tokens:s=!0}={}){s&&(e=mergeArrays([this.cls],e,[this.sep]));let o=new Array(e.length).fill(0);if(t!==null){const u=s&&this instanceof RobertaProcessing?[this.sep]:[],l=s?[this.sep]:[];e=mergeArrays(e,u,t,l),o=mergeArrays(o,new Array(t.length+u.length+l.length).fill(1))}return{tokens:e,token_type_ids:o}}}class RobertaProcessing extends BertProcessing{}class TemplateProcessing extends PostProcessor{constructor(e){super(e),this.single=e.single,this.pair=e.pair}post_process(e,t=null,{add_special_tokens:s=!0}={}){const o=t===null?this.single:this.pair;let u=[],l=[];for(const m of o)"SpecialToken"in m?s&&(u.push(m.SpecialToken.id),l.push(m.SpecialToken.type_id)):"Sequence"in m&&(m.Sequence.id==="A"?(u=mergeArrays(u,e),l=mergeArrays(l,new Array(e.length).fill(m.Sequence.type_id))):m.Sequence.id==="B"&&(u=mergeArrays(u,t),l=mergeArrays(l,new Array(t.length).fill(m.Sequence.type_id))));return{tokens:u,token_type_ids:l}}}class ByteLevelPostProcessor extends PostProcessor{post_process(e,t=null){return t&&(e=mergeArrays(e,t)),{tokens:e}}}class PostProcessorSequence extends PostProcessor{constructor(e){super(e),this.processors=e.processors.map(t=>PostProcessor.fromConfig(t))}post_process(e,t=null,s={}){let o;for(const u of this.processors)if(u instanceof ByteLevelPostProcessor)e=u.post_process(e).tokens,t&&(t=u.post_process(t).tokens);else{const l=u.post_process(e,t,s);e=l.tokens,o=l.token_type_ids}return{tokens:e,token_type_ids:o}}}class Decoder extends Callable{constructor(e){super(),this.config=e,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=e.trim_offsets}static fromConfig(e){if(e===null)return null;switch(e.type){case"WordPiece":return new WordPieceDecoder(e);case"Metaspace":return new MetaspaceDecoder(e);case"ByteLevel":return new ByteLevelDecoder(e);case"Replace":return new ReplaceDecoder(e);case"ByteFallback":return new ByteFallback(e);case"Fuse":return new FuseDecoder(e);case"Strip":return new StripDecoder(e);case"Sequence":return new DecoderSequence(e);case"CTC":return new CTCDecoder(e);case"BPEDecoder":return new BPEDecoder(e);default:throw new Error(`Unknown Decoder type: ${e.type}`)}}_call(e){return this.decode(e)}decode(e){return this.decode_chain(e).join("")}decode_chain(e){throw Error("`decode_chain` should be implemented in subclass.")}}class ReplaceDecoder extends Decoder{decode_chain(e){const t=createPattern(this.config.pattern);return t===null?e:e.map(s=>s.replaceAll(t,this.config.content))}}class ByteFallback extends Decoder{constructor(e){super(e),this.text_decoder=new TextDecoder}decode_chain(e){const t=[];let s=[];for(const o of e){let u=null;if(o.length===6&&o.startsWith("<0x")&&o.endsWith(">")){const l=parseInt(o.slice(3,5),16);isNaN(l)||(u=l)}if(u!==null)s.push(u);else{if(s.length>0){const l=this.text_decoder.decode(Uint8Array.from(s));t.push(l),s=[]}t.push(o)}}if(s.length>0){const o=this.text_decoder.decode(Uint8Array.from(s));t.push(o),s=[]}return t}}class FuseDecoder extends Decoder{decode_chain(e){return[e.join("")]}}class StripDecoder extends Decoder{constructor(e){super(e),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(e){return e.map(t=>{let s=0;for(let u=0;u<this.start&&t[u]===this.content;++u){s=u+1;continue}let o=t.length;for(let u=0;u<this.stop;++u){const l=t.length-u-1;if(t[l]===this.content){o=l;continue}else break}return t.slice(s,o)})}}class WordPieceDecoder extends Decoder{constructor(e){super(e),this.cleanup=e.cleanup}decode_chain(e){return e.map((t,s)=>(s!==0&&(t.startsWith(this.config.prefix)?t=t.replace(this.config.prefix,""):t=" "+t),this.cleanup&&(t=clean_up_tokenization(t)),t))}}class ByteLevelDecoder extends Decoder{constructor(e){super(e),this.byte_decoder=UNICODE_TO_BYTES,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(e){const t=e.join(""),s=new Uint8Array([...t].map(u=>this.byte_decoder[u]));return this.text_decoder.decode(s)}decode_chain(e){const t=[];let s=[];for(const o of e)this.added_tokens.find(u=>u.content===o)!==void 0?(s.length>0&&(t.push(this.convert_tokens_to_string(s)),s=[]),t.push(o)):s.push(o);return s.length>0&&t.push(this.convert_tokens_to_string(s)),t}}class CTCDecoder extends Decoder{constructor(e){super(e),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(e){if(e.length===0)return"";const t=[e[0]];for(let u=1;u<e.length;++u)e[u]!==t.at(-1)&&t.push(e[u]);let o=t.filter(u=>u!==this.pad_token).join("");return this.cleanup&&(o=clean_up_tokenization(o).replaceAll(this.word_delimiter_token," ").trim()),o}decode_chain(e){return[this.convert_tokens_to_string(e)]}}class DecoderSequence extends Decoder{constructor(e){super(e),this.decoders=e.decoders.map(t=>Decoder.fromConfig(t))}decode_chain(e){return this.decoders.reduce((t,s)=>s.decode_chain(t),e)}}class BPEDecoder extends Decoder{constructor(e){super(e),this.suffix=this.config.suffix}decode_chain(e){return e.map((t,s)=>t.replaceAll(this.suffix,s===e.length-1?"":" "))}}class VitsDecoder extends Decoder{decode_chain(e){let t="";for(let s=1;s<e.length;s+=2)t+=e[s];return[t]}}class MetaspacePreTokenizer extends PreTokenizer{constructor(e){super(),this.addPrefixSpace=e.add_prefix_space,this.replacement=e.replacement,this.strRep=e.str_rep||this.replacement,this.prepend_scheme=e.prepend_scheme??"always"}pre_tokenize_text(e,{section_index:t=void 0}={}){let s=e.replaceAll(" ",this.strRep);return this.addPrefixSpace&&!s.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&t===0)&&(s=this.strRep+s),[s]}}class MetaspaceDecoder extends Decoder{constructor(e){super(e),this.addPrefixSpace=e.add_prefix_space,this.replacement=e.replacement}decode_chain(e){const t=[];for(let s=0;s<e.length;++s){let o=e[s].replaceAll(this.replacement," ");this.addPrefixSpace&&s==0&&o.startsWith(" ")&&(o=o.substring(1)),t.push(o)}return t}}class Precompiled extends Normalizer{constructor(e){super(e),this.charsmap=e.precompiled_charsmap}normalize(e){return e=e.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),e=e.replace(/[\u0009\u000A\u000C\u000D\u1680\u200B\u200C\u200E\u200F\u2028\u2029\u2581\uFEFF\uFFFD]/gm," "),e.includes("")?e=e.split("").map(s=>s.normalize("NFKC")).join(""):e=e.normalize("NFKC"),e}}class PreTokenizerSequence extends PreTokenizer{constructor(e){super(),this.tokenizers=e.pretokenizers.map(t=>PreTokenizer.fromConfig(t))}pre_tokenize_text(e,t){return this.tokenizers.reduce((s,o)=>o.pre_tokenize(s,t),[e])}}class WhitespacePreTokenizer extends PreTokenizer{constructor(e){super()}pre_tokenize_text(e,t){return e.match(/\w+|[^\w\s]+/g)||[]}}class WhitespaceSplit extends PreTokenizer{constructor(e){super()}pre_tokenize_text(e,t){return whitespace_split(e)}}class ReplacePreTokenizer extends PreTokenizer{constructor(e){super(),this.config=e,this.pattern=createPattern(this.config.pattern),this.content=this.config.content}pre_tokenize_text(e,t){return this.pattern===null?[e]:[e.replaceAll(this.pattern,this.config.content)]}}const SPECIAL_TOKEN_ATTRIBUTES=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function padHelper(n,e,t,s){for(const o of Object.keys(n)){const u=e-n[o].length,l=t(o),m=new Array(u).fill(l);n[o]=s==="right"?mergeArrays(n[o],m):mergeArrays(m,n[o])}}function truncateHelper(n,e){for(const t of Object.keys(n))n[t].length=e}class PreTrainedTokenizer extends Callable{return_token_type_ids=!1;_default_chat_template=`{% for message in messages %}{{'<|im_start|>' + message['role'] + '
' + message['content'] + '<|im_end|>' + '
'}}{% endfor %}{% if add_generation_prompt %}{{ '<|im_start|>assistant
' }}{% endif %}`;constructor(e,t){super(),this._tokenizer_config=t,this.normalizer=Normalizer.fromConfig(e.normalizer),this.pre_tokenizer=PreTokenizer.fromConfig(e.pre_tokenizer),this.model=TokenizerModel.fromConfig(e.model,t),this.post_processor=PostProcessor.fromConfig(e.post_processor),this.decoder=Decoder.fromConfig(e.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(const s of e.added_tokens){const o=new AddedToken(s);this.added_tokens.push(o),this.model.tokens_to_ids.set(o.content,o.id),this.model.vocab[o.id]=o.content,o.special&&(this.special_tokens.push(o.content),this.all_special_ids.push(o.id))}if(this.additional_special_tokens=t.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_regex=this.added_tokens.length>0?new RegExp(this.added_tokens.map(s=>`${s.lstrip?"\\s*":""}(${escapeRegExp(s.content)})${s.rstrip?"\\s*":""}`).join("|")):null,this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.model_max_length=t.model_max_length,this.remove_space=t.remove_space,this.clean_up_tokenization_spaces=t.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=t.do_lowercase_and_remove_accent??!1,this.padding_side="right",this.legacy=!1,this.chat_template=t.chat_template??null,Array.isArray(this.chat_template)){const s=Object.create(null);for(const{name:o,template:u}of this.chat_template){if(typeof o!="string"||typeof u!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');s[o]=u}this.chat_template=s}this._compiled_template_cache=new Map}getToken(...e){for(const t of e){const s=this._tokenizer_config[t];if(s)if(typeof s=="object"){if(s.__type==="AddedToken")return s.content;throw Error(`Unknown token: ${s}`)}else return s}return null}static async from_pretrained(e,{progress_callback:t=null,config:s=null,cache_dir:o=null,local_files_only:u=!1,revision:l="main",legacy:m=null}={}){const g=await loadTokenizer(e,{progress_callback:t,cache_dir:o,local_files_only:u,revision:l,legacy:m});return new this(...g)}_call(e,{text_pair:t=null,add_special_tokens:s=!0,padding:o=!1,truncation:u=null,max_length:l=null,return_tensor:m=!0,return_token_type_ids:g=null}={}){const h=Array.isArray(e);let f;if(h){if(e.length===0)throw Error("text array must be non-empty");if(t!==null){if(Array.isArray(t)){if(e.length!==t.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");f=e.map((r,d)=>this._encode_plus(r,t[d],{add_special_tokens:s,return_token_type_ids:g}))}else f=e.map(r=>this._encode_plus(r,null,{add_special_tokens:s,return_token_type_ids:g}))}else{if(e==null)throw Error("text may not be null or undefined");if(Array.isArray(t))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");f=[this._encode_plus(e,t,{add_special_tokens:s,return_token_type_ids:g})]}if(l===null?o==="max_length"?l=this.model_max_length:l=max(f.map(r=>r.input_ids.length))[0]:u||console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation=true` to explicitly truncate examples to max length."),l=Math.min(l,this.model_max_length),o||u)for(let r=0;r<f.length;++r)f[r].input_ids.length!==l&&(f[r].input_ids.length>l?u&&truncateHelper(f[r],l):o&&padHelper(f[r],l,d=>d==="input_ids"?this.pad_token_id:0,this.padding_side));const i={};if(m){if(!(o&&u)&&f.some(d=>{for(const p of Object.keys(d))if(d[p].length!==f[0][p]?.length)return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");const r=[f.length,f[0].input_ids.length];for(const d of Object.keys(f[0]))i[d]=new Tensor("int64",BigInt64Array.from(f.flatMap(p=>p[d]).map(BigInt)),r)}else{for(const r of Object.keys(f[0]))i[r]=f.map(d=>d[r]);if(!h)for(const r of Object.keys(i))i[r]=i[r][0]}return i}_encode_text(e){return e===null?null:(this.added_tokens_regex?e.split(this.added_tokens_regex).filter(o=>o):[e]).map((o,u)=>{if(this.added_tokens.find(m=>m.content===o)!==void 0)return o;{if(this.remove_space===!0&&(o=o.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(o=lowercase_and_remove_accent(o)),this.normalizer!==null&&(o=this.normalizer(o)),o.length===0)return[];const m=this.pre_tokenizer!==null?this.pre_tokenizer(o,{section_index:u}):[o];return this.model(m)}}).flat()}_encode_plus(e,t=null,{add_special_tokens:s=!0,return_token_type_ids:o=null}={}){const u=this._encode_text(e),l=this._encode_text(t),m=this.post_processor?this.post_processor(u,l,{add_special_tokens:s}):{tokens:mergeArrays(u??[],l??[])},g=this.model.convert_tokens_to_ids(m.tokens),h={input_ids:g,attention_mask:new Array(g.length).fill(1)};return(o??this.return_token_type_ids)&&m.token_type_ids&&(h.token_type_ids=m.token_type_ids),h}encode(e,t=null,{add_special_tokens:s=!0,return_token_type_ids:o=null}={}){const{input_ids:u}=this._encode_plus(e,t,{add_special_tokens:s,return_token_type_ids:o});return u}batch_decode(e,t={}){return e instanceof Tensor&&(e=e.tolist()),e.map(s=>this.decode(s,t))}decode(e,t={}){if(e instanceof Tensor&&(e=prepareTensorForDecode(e)),!Array.isArray(e)||e.length===0||!isIntegralNumber(e[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(e,t)}decode_single(e,{skip_special_tokens:t=!1,clean_up_tokenization_spaces:s=null}){let o=this.model.convert_ids_to_tokens(e);t&&(o=o.filter(l=>!this.special_tokens.includes(l)));let u=this.decoder?this.decoder(o):o.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(u=u.replaceAll(this.decoder.end_of_word_suffix," "),t&&(u=u.trim())),(s??this.clean_up_tokenization_spaces)&&(u=clean_up_tokenization(u)),u}get default_chat_template(){return this._warned_about_chat_template||(console.warn("No chat template is defined for this tokenizer - using a default chat template that implements the ChatML format. If the default is not appropriate for your model, please set `tokenizer.chat_template` to an appropriate template. See https://huggingface.co/docs/transformers/main/chat_templating for more information."),this._warned_about_chat_template=!0),this._default_chat_template}apply_chat_template(e,{chat_template:t=null,add_generation_prompt:s=!1,tokenize:o=!0,padding:u=!1,truncation:l=!1,max_length:m=null,return_tensor:g=!0,tokenizer_kwargs:h={},...f}={}){if(this.chat_template&&typeof this.chat_template=="object"||this.chat_template===null&&this.default_chat_template&&typeof this.default_chat_template=="object"){const p=this.chat_template??this.default_chat_template;if(t!==null&&Object.hasOwn(p,t))t=p[t];else if(t===null&&"default"in p)t=p.default;else if(t===null)throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(p).sort()}.`)}else t??=this.chat_template??this.default_chat_template;if(typeof t!="string")throw Error(`chat_template must be a string, but got ${typeof t}`);let i=this._compiled_template_cache.get(t);i===void 0&&(i=new Template(t),this._compiled_template_cache.set(t,i));const r=Object.create(null);for(const p of SPECIAL_TOKEN_ATTRIBUTES){const _=this.getToken(p);_&&(r[p]=_)}const d=i.render({messages:e,add_generation_prompt:s,...r,...f});return o?this._call(d,{add_special_tokens:!1,padding:u,truncation:l,max_length:m,return_tensor:g,...h}).input_ids:d}}class BertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class AlbertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class MobileBertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class SqueezeBertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class DebertaTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class DebertaV2Tokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class HerbertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class ConvBertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class RoFormerTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class DistilBertTokenizer extends PreTrainedTokenizer{}class CamembertTokenizer extends PreTrainedTokenizer{}class XLMTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0;constructor(e,t){super(e,t),console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class ElectraTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class T5Tokenizer extends PreTrainedTokenizer{}class GPT2Tokenizer extends PreTrainedTokenizer{_default_chat_template='{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}'}class BartTokenizer extends PreTrainedTokenizer{}class MBartTokenizer extends PreTrainedTokenizer{constructor(e,t){super(e,t),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(s=>this.languageRegex.test(s)),this.lang_to_token=s=>s}_build_translation_inputs(e,t,s){return _build_translation_inputs(this,e,t,s)}}class MBart50Tokenizer extends MBartTokenizer{}class RobertaTokenizer extends PreTrainedTokenizer{}class BloomTokenizer extends GPT2Tokenizer{constructor(e,t){const s=".,!?",o=e.pre_tokenizer?.pretokenizers[0]?.pattern;o&&o.Regex===` ?[^(\\s|[${s}])]+`&&(o.Regex=` ?[^\\s${s}]+`),super(e,t)}}const SPIECE_UNDERLINE="";class LlamaTokenizer extends PreTrainedTokenizer{_default_chat_template=`{% if messages[0]['role'] == 'system' %}{% set loop_messages = messages[1:] %}{% set system_message = messages[0]['content'] %}{% elif USE_DEFAULT_PROMPT == true and not '<<SYS>>' in messages[0]['content'] %}{% set loop_messages = messages %}{% set system_message = 'DEFAULT_SYSTEM_MESSAGE' %}{% else %}{% set loop_messages = messages %}{% set system_message = false %}{% endif %}{% for message in loop_messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if loop.index0 == 0 and system_message != false %}{% set content = '<<SYS>>
' + system_message + '
<</SYS>>

' + message['content'] %}{% else %}{% set content = message['content'] %}{% endif %}{% if message['role'] == 'user' %}{{ bos_token + '[INST] ' + content.strip() + ' [/INST]' }}{% elif message['role'] == 'system' %}{{ '<<SYS>>
' + content.strip() + '
<</SYS>>

' }}{% elif message['role'] == 'assistant' %}{{ ' '  + content.strip() + ' ' + eos_token }}{% endif %}{% endfor %}`;DEFAULT_SYSTEM_PROMPT=`You are a helpful, respectful and honest assistant. Always answer as helpfully as possible, while being safe. Your answers should not include any harmful, unethical, racist, sexist, toxic, dangerous, or illegal content. Please ensure that your responses are socially unbiased and positive in nature.

If a question does not make any sense, or is not factually coherent, explain why instead of answering something not correct. If you don't know the answer to a question, please don't share false information.`;constructor(e,t){super(e,t),this.use_default_system_prompt=t.use_default_system_prompt??!1,this.legacy=t.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new MetaspacePreTokenizer({replacement:SPIECE_UNDERLINE,add_prefix_space:!0,prepend_scheme:"first"}))}_encode_text(e){if(e===null)return null;if(this.legacy||e.length===0)return super._encode_text(e);let t=super._encode_text(SPIECE_UNDERLINE+e.replaceAll(SPIECE_UNDERLINE," "));return t.length>1&&t[0]===SPIECE_UNDERLINE&&this.special_tokens.includes(t[1])&&(t=t.slice(1)),t}get default_chat_template(){return super.default_chat_template.replaceAll("USE_DEFAULT_PROMPT",this.use_default_system_prompt?"true":"false").replaceAll("DEFAULT_SYSTEM_MESSAGE",this.DEFAULT_SYSTEM_PROMPT.replaceAll(`
`,"\\n").replaceAll("'","\\'"))}}class CodeLlamaTokenizer extends LlamaTokenizer{}class XLMRobertaTokenizer extends PreTrainedTokenizer{}class MPNetTokenizer extends PreTrainedTokenizer{}class FalconTokenizer extends PreTrainedTokenizer{}class GPTNeoXTokenizer extends PreTrainedTokenizer{}class EsmTokenizer extends PreTrainedTokenizer{}class Qwen2Tokenizer extends PreTrainedTokenizer{}class GemmaTokenizer extends PreTrainedTokenizer{_default_chat_template=`{% if messages[0]['role'] == 'system' %}{{ raise_exception('System role not supported') }}{% endif %}{% for message in messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if (message['role'] == 'assistant') %}{% set role = 'model' %}{% else %}{% set role = message['role'] %}{% endif %}{{ '<start_of_turn>' + role + '
' + message['content'] | trim + '<end_of_turn>
' }}{% endfor %}{% if add_generation_prompt %}{{'<start_of_turn>model
'}}{% endif %}`}class Grok1Tokenizer extends PreTrainedTokenizer{}function _build_translation_inputs(n,e,t,s){if(!("language_codes"in n)||!Array.isArray(n.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in n)||!(n.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in n)||typeof n.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");const o=s.src_lang,u=s.tgt_lang;if(!n.language_codes.includes(u))throw new Error(`Target language code "${u}" is not valid. Must be one of: {${n.language_codes.join(", ")}}`);if(o!==void 0){if(!n.language_codes.includes(o))throw new Error(`Source language code "${o}" is not valid. Must be one of: {${n.language_codes.join(", ")}}`);for(const l of n.post_processor.config.single)if("SpecialToken"in l&&n.languageRegex.test(l.SpecialToken.id)){l.SpecialToken.id=n.lang_to_token(o);break}}return s.forced_bos_token_id=n.model.convert_tokens_to_ids([n.lang_to_token(u)])[0],n._call(e,t)}class NllbTokenizer extends PreTrainedTokenizer{constructor(e,t){super(e,t),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(s=>this.languageRegex.test(s)),this.lang_to_token=s=>s}_build_translation_inputs(e,t,s){return _build_translation_inputs(this,e,t,s)}}class M2M100Tokenizer extends PreTrainedTokenizer{constructor(e,t){super(e,t),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(s=>this.languageRegex.test(s)).map(s=>s.slice(2,-2)),this.lang_to_token=s=>`__${s}__`}_build_translation_inputs(e,t,s){return _build_translation_inputs(this,e,t,s)}}const WHISPER_LANGUAGES=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],WHISPER_LANGUAGE_MAPPING=new Map(WHISPER_LANGUAGES),WHISPER_TO_LANGUAGE_CODE_MAPPING=new Map([...WHISPER_LANGUAGES.map(([n,e])=>[e,n]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);class WhisperTokenizer extends PreTrainedTokenizer{_default_chat_template='{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}';_decode_asr(e,{return_timestamps:t=!1,return_language:s=!1,time_precision:o=null,force_full_sequences:u=!0}={}){if(o===null)throw Error("Must specify time_precision");let l=null;const m=t==="word";function g(){return{language:l,timestamp:[null,null],text:""}}const h=[];let f=g(),i=0;const r=this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1;let d=[],p=[],_=!1,y=null;const v=new Set(this.all_special_ids);for(const E of e){const P=E.tokens,R=m?E.token_timestamps:null;let I=null,N=r;if("stride"in E){const[Y,se,re]=E.stride;if(i-=se,y=Y-re,se&&(N=se/o+r),re)for(let W=P.length-1;W>=0;--W){const $=P[W];if($>=r){if(I!==null&&($-r)*o<y)break;I=$}}}let B=[],D=[];for(let Y=0;Y<P.length;++Y){const se=P[Y];if(v.has(se)){const re=this.decode([se]),W=WHISPER_LANGUAGE_MAPPING.get(re.slice(2,-2));if(W!==void 0){if(l!==null&&W!==l&&!t){d.push(B);const $=this.findLongestCommonSequence(d)[0],k=this.decode($);f.text=k,h.push(f),d=[],B=[],f=g()}l=f.language=W}}else if(se>=r){const re=(se-r)*o+i,W=round(re,2);if(I!==null&&se>=I)_=!0;else if(_||d.length>0&&se<N)_=!1;else if(f.timestamp[0]===null)f.timestamp[0]=W;else if(W!==f.timestamp[0]){f.timestamp[1]=W,d.push(B),m&&p.push(D);const[$,k]=this.findLongestCommonSequence(d,p),H=this.decode($);f.text=H,m&&(f.words=this.collateWordTimestamps($,k,l)),h.push(f),d=[],B=[],p=[],D=[],f=g()}}else if(B.push(se),m){let re=round(R[Y]+i,2),W;Y+1<R.length?W=round(R[Y+1]+i,2):W=null,D.push([re,W])}}if("stride"in E){const[Y,se,re]=E.stride;i+=Y-re}B.length>0?(d.push(B),m&&p.push(D)):d.every(Y=>Y.length===0)&&(f=g(),d=[],B=[],p=[],D=[])}if(d.length>0){if(u&&t)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");const[E,P]=this.findLongestCommonSequence(d,p),R=this.decode(E);f.text=R,m&&(f.words=this.collateWordTimestamps(E,P,l)),h.push(f)}let T=Object.create(null);const w=h.map(E=>E.text).join("");if(t||s){for(let E=0;E<h.length;++E){const P=h[E];t||delete P.timestamp,s||delete P.language}if(m){const E=[];for(const P of h)for(const R of P.words)E.push(R);T={chunks:E}}else T={chunks:h}}return[w,T]}findLongestCommonSequence(e,t=null){let s=e[0],o=s.length,u=[];const l=Array.isArray(t)&&t.length>0;let m=l?[]:null,g=l?t[0]:null;for(let h=1;h<e.length;++h){const f=e[h];let i=0,r=[o,o,0,0];const d=f.length;for(let E=1;E<o+d;++E){const P=E/1e4,R=Math.max(0,o-E),I=Math.min(o,o+d-E),N=s.slice(R,I),B=Math.max(0,E-o),D=Math.min(d,E),Y=f.slice(B,D);if(N.length!==Y.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");const se=N.filter((W,$)=>W===Y[$]).length,re=se/E+P;se>1&&re>i&&(i=re,r=[R,I,B,D])}const[p,_,y,v]=r,T=Math.floor((_+p)/2),w=Math.floor((v+y)/2);u.push(...s.slice(0,T)),s=f.slice(w),o=s.length,l&&(m.push(...g.slice(0,T)),g=t[h].slice(w))}return u.push(...s),l?(m.push(...g),[u,m]):[u,[]]}collateWordTimestamps(e,t,s){const[o,u,l]=this.combineTokensIntoWords(e,s),m=[];for(let g=0;g<o.length;++g){const h=l[g];m.push({text:o[g],timestamp:[t[h.at(0)][0],t[h.at(-1)][1]]})}return m}combineTokensIntoWords(e,t,s=`"'([{-`,o=`"'.,!?:)]}`){t=t??"english";let u,l,m;return["chinese","japanese","thai","lao","myanmar"].includes(t)?[u,l,m]=this.splitTokensOnUnicode(e):[u,l,m]=this.splitTokensOnSpaces(e),this.mergePunctuations(u,l,m,s,o)}decode(e,t){let s;return t&&t.decode_with_timestamps?(e instanceof Tensor&&(e=prepareTensorForDecode(e)),s=this.decodeWithTimestamps(e,t)):s=super.decode(e,t),s}decodeWithTimestamps(e,t){const s=t?.time_precision??.02,o=Array.from(this.all_special_ids).at(-1)+1;let u=[[]];for(const l of e)if(l>=o){const m=round((l-o)*s,2);u.push(`<|${m}|>`),u.push([])}else u[u.length-1].push(l);return u=u.map(l=>typeof l=="string"?l:super.decode(l,t)),u.join("")}splitTokensOnUnicode(e){const t=this.decode(e,{decode_with_timestamps:!0}),s="",o=[],u=[],l=[];let m=[],g=[],h=0;for(let f=0;f<e.length;++f){const i=e[f];m.push(i),g.push(f);const r=this.decode(m,{decode_with_timestamps:!0});(!r.includes(s)||t[h+r.indexOf(s)]===s)&&(o.push(r),u.push(m),l.push(g),m=[],g=[],h+=r.length)}return[o,u,l]}splitTokensOnSpaces(e){const[t,s,o]=this.splitTokensOnUnicode(e),u=[],l=[],m=[],g=new RegExp(`^[${PUNCTUATION_REGEX}]$`,"gu");for(let h=0;h<t.length;++h){const f=t[h],i=s[h],r=o[h],d=i[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),p=f.startsWith(" "),_=f.trim(),y=g.test(_);if(d||p||y||u.length===0)u.push(f),l.push(i),m.push(r);else{const v=u.length-1;u[v]+=f,l[v].push(...i),m[v].push(...r)}}return[u,l,m]}mergePunctuations(e,t,s,o,u){const l=structuredClone(e),m=structuredClone(t),g=structuredClone(s);let h=l.length-2,f=l.length-1;for(;h>=0;)l[h].startsWith(" ")&&o.includes(l[h].trim())?(l[f]=l[h]+l[f],m[f]=mergeArrays(m[h],m[f]),g[f]=mergeArrays(g[h],g[f]),l[h]="",m[h]=[],g[h]=[]):f=h,--h;for(h=0,f=1;f<l.length;)!l[h].endsWith(" ")&&u.includes(l[f])?(l[h]+=l[f],m[h]=mergeArrays(m[h],m[f]),g[h]=mergeArrays(g[h],g[f]),l[f]="",m[f]=[],g[f]=[]):h=f,++f;return[l.filter(i=>i),m.filter(i=>i.length>0),g.filter(i=>i.length>0)]}get_decoder_prompt_ids({language:e=null,task:t=null,no_timestamps:s=!0}={}){const o=[];if(e){e=e.toLowerCase();let u=WHISPER_TO_LANGUAGE_CODE_MAPPING.get(e);if(u===void 0)if(WHISPER_LANGUAGE_MAPPING.has(e))u=e;else{const g=e.length===2?WHISPER_LANGUAGE_MAPPING.keys():WHISPER_LANGUAGE_MAPPING.values();throw new Error(`Language "${e}" is not supported. Must be one of: ${JSON.stringify(g)}`)}const l=this.model.tokens_to_ids.get(`<|${u}|>`);if(l===void 0)throw new Error(`Unable to find language "${u}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);o.push(l)}else o.push(null);if(t){if(t=t.toLowerCase(),t!=="transcribe"&&t!=="translate")throw new Error(`Task "${t}" is not supported. Must be one of: ["transcribe", "translate"]`);const u=this.model.tokens_to_ids.get(`<|${t}|>`);if(u===void 0)throw new Error(`Unable to find task "${t}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);o.push(u)}else o.push(null);if(s){const u=this.model.tokens_to_ids.get("<|notimestamps|>");if(u===void 0)throw new Error('Unable to find "<|notimestamps|>" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.');o.push(u)}return o.map((u,l)=>[l+1,u]).filter(u=>u[1]!==null)}}class CodeGenTokenizer extends PreTrainedTokenizer{}class CLIPTokenizer extends PreTrainedTokenizer{}class SiglipTokenizer extends PreTrainedTokenizer{}class MarianTokenizer extends PreTrainedTokenizer{constructor(e,t){super(e,t),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(s=>this.languageRegex.test(s)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(e){if(e===null)return null;const[t,...s]=e.trim().split(this.languageRegex);if(s.length===0)return super._encode_text(t);if(s.length===2){const[o,u]=s;return this.supported_language_codes.includes(o)||console.warn(`Unsupported language code "${o}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),mergeArrays([o],super._encode_text(u))}}}class Wav2Vec2CTCTokenizer extends PreTrainedTokenizer{}class BlenderbotTokenizer extends PreTrainedTokenizer{_default_chat_template="{% for message in messages %}{% if message['role'] == 'user' %}{{ ' ' }}{% endif %}{{ message['content'] }}{% if not loop.last %}{{ '  ' }}{% endif %}{% endfor %}{{ eos_token }}"}class BlenderbotSmallTokenizer extends BlenderbotTokenizer{}class SpeechT5Tokenizer extends PreTrainedTokenizer{}class NougatTokenizer extends PreTrainedTokenizer{}class VitsTokenizer extends PreTrainedTokenizer{constructor(e,t){super(e,t),this.decoder=new VitsDecoder({})}}class CohereTokenizer extends PreTrainedTokenizer{}class AutoTokenizer{static TOKENIZER_CLASS_MAPPING={T5Tokenizer,DistilBertTokenizer,CamembertTokenizer,DebertaTokenizer,DebertaV2Tokenizer,BertTokenizer,HerbertTokenizer,ConvBertTokenizer,RoFormerTokenizer,XLMTokenizer,ElectraTokenizer,MobileBertTokenizer,SqueezeBertTokenizer,AlbertTokenizer,GPT2Tokenizer,BartTokenizer,MBartTokenizer,MBart50Tokenizer,RobertaTokenizer,WhisperTokenizer,CodeGenTokenizer,CLIPTokenizer,SiglipTokenizer,MarianTokenizer,BloomTokenizer,NllbTokenizer,M2M100Tokenizer,LlamaTokenizer,CodeLlamaTokenizer,XLMRobertaTokenizer,MPNetTokenizer,FalconTokenizer,GPTNeoXTokenizer,EsmTokenizer,Wav2Vec2CTCTokenizer,BlenderbotTokenizer,BlenderbotSmallTokenizer,SpeechT5Tokenizer,NougatTokenizer,VitsTokenizer,Qwen2Tokenizer,GemmaTokenizer,Grok1Tokenizer,CohereTokenizer,PreTrainedTokenizer};static async from_pretrained(e,{quantized:t=!0,progress_callback:s=null,config:o=null,cache_dir:u=null,local_files_only:l=!1,revision:m="main",legacy:g=null}={}){const[h,f]=await loadTokenizer(e,{progress_callback:s,cache_dir:u,local_files_only:l,revision:m,legacy:g}),i=f.tokenizer_class?.replace(/Fast$/,"")??"PreTrainedTokenizer";let r=this.TOKENIZER_CLASS_MAPPING[i];return r||(console.warn(`Unknown tokenizer class "${i}", attempting to construct from base class.`),r=PreTrainedTokenizer),new r(h,f)}}async function loadConfig(n,e){return await getModelJSON(n,"config.json",!0,e)}class PretrainedConfig{constructor(e){this.model_type=null,this.is_encoder_decoder=!1,Object.assign(this,e)}static async from_pretrained(e,{progress_callback:t=null,config:s=null,cache_dir:o=null,local_files_only:u=!1,revision:l="main"}={}){let m=s??await loadConfig(e,{progress_callback:t,cache_dir:o,local_files_only:u,revision:l});return new this(m)}}class AutoConfig{static async from_pretrained(...e){return PretrainedConfig.from_pretrained(...e)}}class LogitsProcessorList extends Callable{constructor(){super(),this.processors=[]}push(e){this.processors.push(e)}extend(e){this.processors.push(...e)}_call(e,t){for(let s of t)this.processors.forEach(o=>o(e,s))}[Symbol.iterator](){return this.processors.values()}}class LogitsProcessor extends Callable{_call(e,t){throw Error("`_call` should be implemented in a subclass")}}class ForceTokensLogitsProcessor extends LogitsProcessor{constructor(e){super(),this.force_token_map=Object.fromEntries(e??[])}_call(e,t){let s=this.force_token_map[e.length];return exists(s)&&(t.data.fill(-1/0),t.data[s]=0),t}}class ForcedBOSTokenLogitsProcessor extends LogitsProcessor{constructor(e){super(),this.bos_token_id=e}_call(e,t){return e.length===1&&(t.data.fill(-1/0),t.data[this.bos_token_id]=0),t}}class ForcedEOSTokenLogitsProcessor extends LogitsProcessor{constructor(e,t){super(),this.max_length=e,this.forced_eos_token_id=t}_call(e,t){}}class SuppressTokensAtBeginLogitsProcessor extends LogitsProcessor{constructor(e,t){super(),this.begin_suppress_tokens=e,this.begin_index=t}_call(e,t){if(e.length===this.begin_index)for(let s of this.begin_suppress_tokens)t.data[s]=-1/0;return t}}class WhisperTimeStampLogitsProcessor extends LogitsProcessor{constructor(e){super(),this.eos_token_id=e.eos_token_id,this.no_timestamps_token_id=e.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=(e.forced_decoder_ids||[]).length+2,e.forced_decoder_ids.slice(-1)[0][1]===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=e.max_initial_timestamp_index}_call(e,t){const s=t.data;if(s[this.no_timestamps_token_id]=-1/0,e.length===this.begin_index-1)return s.fill(-1/0),s[this.timestamp_begin]=0,t;const o=e.slice(this.begin_index),u=o.length>=1&&o[o.length-1]>=this.timestamp_begin,l=o.length<2||o[o.length-2]>=this.timestamp_begin;if(u&&(l?s.subarray(this.timestamp_begin).fill(-1/0):s.subarray(0,this.eos_token_id).fill(-1/0)),e.length===this.begin_index&&this.max_initial_timestamp_index!==null){const f=this.timestamp_begin+this.max_initial_timestamp_index;s.subarray(f+1).fill(-1/0)}const m=log_softmax(s),g=Math.log(m.subarray(this.timestamp_begin).map(Math.exp).reduce((f,i)=>f+i)),h=max(m.subarray(0,this.timestamp_begin))[0];return g>h&&s.subarray(0,this.timestamp_begin).fill(-1/0),t}}class NoRepeatNGramLogitsProcessor extends LogitsProcessor{constructor(e){super(),this.no_repeat_ngram_size=e}getNgrams(e){const t=e.length,s=[];for(let u=0;u<t+1-this.no_repeat_ngram_size;++u){const l=[];for(let m=0;m<this.no_repeat_ngram_size;++m)l.push(e[u+m]);s.push(l)}const o=new Map;for(const u of s){const l=u.slice(0,u.length-1),m=JSON.stringify(l),g=o.get(m)??[];g.push(u[u.length-1]),o.set(m,g)}return o}getGeneratedNgrams(e,t){const s=t.slice(t.length+1-this.no_repeat_ngram_size,t.length);return e.get(JSON.stringify(s))??[]}calcBannedNgramTokens(e){const t=[];if(e.length+1<this.no_repeat_ngram_size)return t;{const s=this.getNgrams(e);return this.getGeneratedNgrams(s,e)}}_call(e,t){const s=this.calcBannedNgramTokens(e);for(const o of s)t.data[o]=-1/0;return t}}class RepetitionPenaltyLogitsProcessor extends LogitsProcessor{constructor(e){super(),this.penalty=e}_call(e,t){for(const s of e)t.data[s]<0?t.data[s]*=this.penalty:t.data[s]/=this.penalty;return t}}class MinLengthLogitsProcessor extends LogitsProcessor{constructor(e,t){super(),this.min_length=e,this.eos_token_id=Array.isArray(t)?t:[t]}_call(e,t){if(e.length<this.min_length)for(const s of this.eos_token_id)t.data[s]=-1/0;return t}}class MinNewTokensLengthLogitsProcessor extends LogitsProcessor{constructor(e,t,s){super(),this.prompt_length_to_skip=e,this.min_new_tokens=t,this.eos_token_id=Array.isArray(s)?s:[s]}_call(e,t){if(e.length-this.prompt_length_to_skip<this.min_new_tokens)for(const o of this.eos_token_id)t.data[o]=-1/0;return t}}class NoBadWordsLogitsProcessor extends LogitsProcessor{constructor(e,t){super(),this.bad_words_ids=e,this.eos_token_id=Array.isArray(t)?t:[t]}_call(e,t){for(const s of this.bad_words_ids){let o=!0;for(let u=1;u<=s.length-1&&s.length<e.length;++u)if(s.at(-u-1)!==e.at(-u)){o=!1;break}o&&(t.data[s.at(-1)]=-1/0)}return t}}const GenerationConfig=class{constructor(n={}){this.max_length=n.max_length??20,this.max_new_tokens=n.max_new_tokens??null,this.min_length=n.min_length??0,this.min_new_tokens=n.min_new_tokens??null,this.early_stopping=n.early_stopping??!1,this.max_time=n.max_time??null,this.do_sample=n.do_sample??!1,this.num_beams=n.num_beams??1,this.num_beam_groups=n.num_beam_groups??1,this.penalty_alpha=n.penalty_alpha??null,this.use_cache=n.use_cache??!0,this.temperature=n.temperature??1,this.top_k=n.top_k??50,this.top_p=n.top_p??1,this.typical_p=n.typical_p??1,this.epsilon_cutoff=n.epsilon_cutoff??0,this.eta_cutoff=n.eta_cutoff??0,this.diversity_penalty=n.diversity_penalty??0,this.repetition_penalty=n.repetition_penalty??1,this.encoder_repetition_penalty=n.encoder_repetition_penalty??1,this.length_penalty=n.length_penalty??1,this.no_repeat_ngram_size=n.no_repeat_ngram_size??0,this.bad_words_ids=n.bad_words_ids??null,this.force_words_ids=n.force_words_ids??null,this.renormalize_logits=n.renormalize_logits??!1,this.constraints=n.constraints??null,this.forced_bos_token_id=n.forced_bos_token_id??null,this.forced_eos_token_id=n.forced_eos_token_id??null,this.remove_invalid_values=n.remove_invalid_values??!1,this.exponential_decay_length_penalty=n.exponential_decay_length_penalty??null,this.suppress_tokens=n.suppress_tokens??null,this.begin_suppress_tokens=n.begin_suppress_tokens??null,this.forced_decoder_ids=n.forced_decoder_ids??null,this.num_return_sequences=n.num_return_sequences??1,this.output_attentions=n.output_attentions??!1,this.output_hidden_states=n.output_hidden_states??!1,this.output_scores=n.output_scores??!1,this.return_dict_in_generate=n.return_dict_in_generate??!1,this.pad_token_id=n.pad_token_id??null,this.bos_token_id=n.bos_token_id??null,this.eos_token_id=n.eos_token_id??null,this.encoder_no_repeat_ngram_size=n.encoder_no_repeat_ngram_size??0,this.decoder_start_token_id=n.decoder_start_token_id??null,this.generation_kwargs=n.generation_kwargs??{}}};class Sampler extends Callable{constructor(e){super(),this.generation_config=e}_call(e,t=-1){return this.sample(e,t)}sample(e,t){throw Error("sample should be implemented in subclasses.")}getLogits(e,t){let s=e.dims.at(-1),o=e.data;if(t===-1)o=o.slice(-s);else{let u=t*s;o=o.slice(u,u+s)}return this.generation_config.temperature>0&&(o=o.map(u=>u/this.generation_config.temperature)),o}randomSelect(e){let t=e.reduce((o,u)=>o+u,0),s=Math.random()*t;for(let o=0;o<e.length;++o)if(s-=e[o],s<=0)return o;return 0}static getSampler(e){if(e.do_sample)return new MultinomialSampler(e);if(e.num_beams>1)return new BeamSearchSampler(e);if(e.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${e.num_return_sequences}.`);return new GreedySampler(e)}}class GreedySampler extends Sampler{sample(e,t=-1){let s=this.getLogits(e,t);return[[max(s)[1],0]]}}class MultinomialSampler extends Sampler{sample(e,t=-1){let s=e.dims.at(-1);this.generation_config.top_k>0&&(s=Math.min(this.generation_config.top_k,s));const o=this.getLogits(e,t),u=getTopItems(o,s),l=softmax(u.map(m=>m[1]));return Array.from({length:this.generation_config.num_beams},()=>{const m=this.randomSelect(l);return[u[m][0],Math.log(l[m])]})}}class BeamSearchSampler extends Sampler{sample(e,t=-1){let s=e.dims.at(-1);this.generation_config.top_k>0&&(s=Math.min(this.generation_config.top_k,s));const o=this.getLogits(e,t),u=getTopItems(o,s),l=softmax(u.map(m=>m[1]));return Array.from({length:this.generation_config.num_beams},(m,g)=>[u[g][0],Math.log(l[g])])}}const{InferenceSession,Tensor:ONNXTensor,env}=ONNX,MODEL_TYPES={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5},MODEL_TYPE_MAPPING=new Map,MODEL_NAME_TO_CLASS_MAPPING=new Map,MODEL_CLASS_TO_NAME_MAPPING=new Map;async function constructSession(n,e,t){let s=`onnx/${e}${t.quantized?"_quantized":""}.onnx`,o=await getModelFile(n,s,!0,t);try{return await InferenceSession.create(o,{executionProviders})}catch(u){if(executionProviders.length===1&&executionProviders[0]==="wasm")throw u;return console.warn(u),console.warn("Something went wrong during model construction (most likely a missing operation). Using `wasm` as a fallback. "),await InferenceSession.create(o,{executionProviders:["wasm"]})}}function validateInputs(n,e){const t=Object.create(null),s=[];for(const l of n.inputNames){const m=e[l];if(!(m instanceof Tensor)){s.push(l);continue}t[l]=env.wasm.proxy?m.clone():m}if(s.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${s.join(", ")}.`);const o=Object.keys(e).length,u=n.inputNames.length;if(o>u){let l=Object.keys(e).filter(m=>!n.inputNames.includes(m));console.warn(`WARNING: Too many inputs were provided (${o} > ${u}). The following inputs will be ignored: "${l.join(", ")}".`)}return t}async function sessionRun(n,e){const t=validateInputs(n,e);try{let s=await n.run(t);return s=replaceTensors(s),s}catch(s){throw console.error(`An error occurred during model execution: "${s}".`),console.error("Inputs given to model:",t),s}}function replaceTensors(n){for(let e in n)n[e]instanceof ONNXTensor?n[e]=new Tensor(n[e]):typeof n[e]=="object"&&replaceTensors(n[e]);return n}function toI64Tensor(n){if(n instanceof Tensor)return n;if(n.length===0)throw Error("items must be non-empty");if(Array.isArray(n[0])){if(n.some(e=>e.length!==n[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new Tensor("int64",BigInt64Array.from(n.flat().map(e=>BigInt(e))),[n.length,n[0].length])}else return new Tensor("int64",BigInt64Array.from(n.map(e=>BigInt(e))),[1,n.length])}function prepareAttentionMask(n,e){let t=n.config.pad_token_id??null,s=n.config.eos_token_id??null;isIntegralNumber(s)&&(s=[s]);let o=e.indexOf(t)!==-1,u=s===null||!s.includes(t);if(o&&u){let l=BigInt64Array.from(e.data.map(m=>m!=t));return new Tensor("int64",l,e.dims)}else return ones_like(e)}function preparePositionIds(n,e,t){if(!n.inputNames.includes("position_ids"))return;const s=new BigInt64Array(e.attention_mask.data.length);for(let o=0;o<e.attention_mask.dims[0];++o){let u=o*e.attention_mask.dims[1],l=BigInt(0);for(let m=0;m<e.attention_mask.dims[1];++m){const g=u+m;e.attention_mask.data[g]===0n?s[g]=BigInt(1):(s[g]=l,l+=e.attention_mask.data[g])}}e.position_ids=new Tensor("int64",s,e.attention_mask.dims),t&&(e.position_ids=e.position_ids.slice(null,-1).unsqueeze_(-1))}function boolTensor(n){return new Tensor("bool",[n],[1])}async function seq2seqForward(n,e){let{encoder_outputs:t,past_key_values:s}=e;t||(t=(await encoderForward(n,e)).last_hidden_state);let o={input_ids:e.decoder_input_ids,encoder_hidden_states:t};const u=!!s;n.decoder_merged_session.inputNames.includes("use_cache_branch")&&(o.use_cache_branch=boolTensor(u)),n.decoder_merged_session.inputNames.includes("encoder_attention_mask")&&(o.encoder_attention_mask=e.attention_mask),preparePositionIds(n.decoder_merged_session,o,u),n.addPastKeyValues(o,s);const l=await sessionRun(n.decoder_merged_session,o);let m=l.logits;s=n.getPastKeyValues(l,s);const g=n.getAttentions(l);return new Seq2SeqLMOutput({logits:m,past_key_values:s,encoder_outputs:t,...g})}function seq2seqStartBeams(n,e,t,s){let o=[],u=0;const l=n.requires_attention_mask??!0;let m=t.decoder_input_ids??t.decoder_start_token_id??t.bos_token_id??t.eos_token_id;m instanceof Tensor?m=m.tolist().flat():Array.isArray(m)||(m=[m]);for(let g of e){g.dims=[1,...g.dims];let h={inputs:g,encoder_outputs:null,prev_model_outputs:null,output_token_ids:m,done:!1,score:0,id:u++};l&&(h.attention_mask=prepareAttentionMask(n,g)),o.push(h)}return o}async function seq2seqRunBeam(n,e){const t=n.main_input_name;let s=e.output_token_ids;e.prev_model_outputs&&(s=s.slice(-1));let o={[t]:e.inputs,decoder_input_ids:toI64Tensor(s),encoder_outputs:e.encoder_outputs,past_key_values:e.prev_model_outputs?.past_key_values};e.attention_mask&&(o.attention_mask=e.attention_mask);let u=await n.forward(o);return e.prev_model_outputs=u,e.encoder_outputs=u.encoder_outputs,u}function seq2seqUpdatebeam(n,e){n.output_token_ids=[...n.output_token_ids,e]}async function encoderForward(n,e){const t=Object.create(null);for(const s of n.session.inputNames)t[s]=e[s];return n.session.inputNames.includes("token_type_ids")&&!t.token_type_ids&&(t.token_type_ids=new Tensor("int64",new BigInt64Array(t.input_ids.data.length),t.input_ids.dims)),await sessionRun(n.session,t)}async function decoderForward(n,e){let{input_ids:t,past_key_values:s,attention_mask:o}=e,u={input_ids:t,attention_mask:o??prepareAttentionMask(n,t)};const l=!!s;n.session.inputNames.includes("use_cache_branch")&&(u.use_cache_branch=boolTensor(l)),preparePositionIds(n.session,u,l),n.addPastKeyValues(u,s);let m=await sessionRun(n.session,u),g=m.logits;return s=n.getPastKeyValues(m,s),{logits:g,past_key_values:s}}function decoderStartBeams(n,e,t,s,o){let u=[],l=0;for(let m of e){let g=m.tolist().map(Number);m.dims=[1,...m.dims];let h;o?(h=o[l],h.dims=[1,...h.dims]):h=prepareAttentionMask(n,m);let f={input:m,model_input_ids:m,attention_mask:h,prev_model_outputs:null,output_token_ids:g,num_output_tokens:s,done:!1,score:0,id:l++};u.push(f)}return u}async function decoderRunBeam(n,e){let t=new BigInt64Array(e.output_token_ids.length).fill(1n),s={input_ids:e.model_input_ids,attention_mask:new Tensor("int64",t,[1,t.length]),past_key_values:e.prev_model_outputs?.past_key_values},o=await n.forward(s);return e.prev_model_outputs=o,o}function decoderUpdatebeam(n,e){n.output_token_ids=[...n.output_token_ids,e],n.model_input_ids=new Tensor("int64",[BigInt(e)],[1,1])}class PreTrainedModel extends Callable{main_input_name="input_ids";constructor(e,t){super(),this.config=e,this.session=t;const s=MODEL_CLASS_TO_NAME_MAPPING.get(this.constructor),o=MODEL_TYPE_MAPPING.get(s);this.can_generate=!1,this._runBeam=null,this._getStartBeams=null,this._updateBeam=null,this._forward=null,o===MODEL_TYPES.DecoderOnly?(this.can_generate=!0,this._runBeam=decoderRunBeam,this._getStartBeams=decoderStartBeams,this._updateBeam=decoderUpdatebeam,this._forward=decoderForward):o===MODEL_TYPES.Seq2Seq||o===MODEL_TYPES.Vision2Seq?(this.can_generate=!0,this._runBeam=seq2seqRunBeam,this._getStartBeams=seq2seqStartBeams,this._updateBeam=seq2seqUpdatebeam,this._forward=seq2seqForward):o===MODEL_TYPES.EncoderDecoder?this._forward=encoderForward:this._forward=encoderForward}async dispose(){const e=[];for(let t of Object.keys(this)){const s=this[t];s instanceof InferenceSession&&e.push(s.handler.dispose())}return await Promise.all(e)}static async from_pretrained(e,{quantized:t=!0,progress_callback:s=null,config:o=null,cache_dir:u=null,local_files_only:l=!1,revision:m="main",model_file_name:g=null}={}){let h={quantized:t,progress_callback:s,config:o,cache_dir:u,local_files_only:l,revision:m,model_file_name:g};const f=MODEL_CLASS_TO_NAME_MAPPING.get(this),i=MODEL_TYPE_MAPPING.get(f);let r;return i===MODEL_TYPES.DecoderOnly?r=await Promise.all([AutoConfig.from_pretrained(e,h),constructSession(e,h.model_file_name??"decoder_model_merged",h),getModelJSON(e,"generation_config.json",!1,h)]):i===MODEL_TYPES.Seq2Seq||i===MODEL_TYPES.Vision2Seq?r=await Promise.all([AutoConfig.from_pretrained(e,h),constructSession(e,"encoder_model",h),constructSession(e,"decoder_model_merged",h),getModelJSON(e,"generation_config.json",!1,h)]):i===MODEL_TYPES.MaskGeneration?r=await Promise.all([AutoConfig.from_pretrained(e,h),constructSession(e,"vision_encoder",h),constructSession(e,"prompt_encoder_mask_decoder",h)]):i===MODEL_TYPES.EncoderDecoder?r=await Promise.all([AutoConfig.from_pretrained(e,h),constructSession(e,"encoder_model",h),constructSession(e,"decoder_model_merged",h)]):(i!==MODEL_TYPES.EncoderOnly&&console.warn(`Model type for '${f??o?.model_type}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`),r=await Promise.all([AutoConfig.from_pretrained(e,h),constructSession(e,h.model_file_name??"model",h)])),new this(...r)}async _call(e){return await this.forward(e)}async forward(e){return await this._forward(this,e)}_get_logits_processor(e,t,s=null){const o=new LogitsProcessorList;if(e.repetition_penalty!==null&&e.repetition_penalty!==1&&o.push(new RepetitionPenaltyLogitsProcessor(e.repetition_penalty)),e.no_repeat_ngram_size!==null&&e.no_repeat_ngram_size>0&&o.push(new NoRepeatNGramLogitsProcessor(e.no_repeat_ngram_size)),e.bad_words_ids!==null&&o.push(new NoBadWordsLogitsProcessor(e.bad_words_ids,e.eos_token_id)),e.min_length!==null&&e.eos_token_id!==null&&e.min_length>0&&o.push(new MinLengthLogitsProcessor(e.min_length,e.eos_token_id)),e.min_new_tokens!==null&&e.eos_token_id!==null&&e.min_new_tokens>0&&o.push(new MinNewTokensLengthLogitsProcessor(t,e.min_new_tokens,e.eos_token_id)),e.forced_bos_token_id!==null&&o.push(new ForcedBOSTokenLogitsProcessor(e.forced_bos_token_id)),e.forced_eos_token_id!==null&&o.push(new ForcedEOSTokenLogitsProcessor(e.max_length,e.forced_eos_token_id)),e.begin_suppress_tokens!==null){let u=t>1||e.forced_bos_token_id===null?t:t+1;e.forced_decoder_ids!==null&&(u+=e.forced_decoder_ids[e.forced_decoder_ids.length-1][0]),o.push(new SuppressTokensAtBeginLogitsProcessor(e.begin_suppress_tokens,u))}return e.forced_decoder_ids!==null&&o.push(new ForceTokensLogitsProcessor(e.forced_decoder_ids)),s!==null&&o.extend(s),o}_get_generation_config(e){let t=new GenerationConfig(this.config);return"generation_config"in this&&Object.assign(t,this.generation_config),e!==null&&Object.assign(t,e),t}async generate(e,t=null,s=null,{inputs_attention_mask:o=null}={}){if(!this.can_generate){let y=`The current model class (${MODEL_CLASS_TO_NAME_MAPPING.get(this.constructor)}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;const v=this.config.model_type,T=MODEL_WITH_LM_HEAD_MAPPING_NAMES.get(v)??MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES.get(v)??MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES.get(v)??MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES.get(v);throw T&&(y+=` Please use the following class instead: '${T[0]}'`),Error(y)}if(!(e instanceof Tensor)&&!isTypedArray(e)&&!Array.isArray(e))throw Error(`\`inputs\` must be a Tensor, TypedArray, or Array, but is "${e.constructor.name}".`);let u;if(this.config.is_encoder_decoder)u=0;else if(u=e instanceof Tensor?e.dims.at(-1):e.length,u===0)throw Error("Must supply a non-empty array of input token ids.");t=this._get_generation_config(t),s=s??new LogitsProcessorList,s=this._get_logits_processor(t,u,s);let l=t.eos_token_id;l!==null&&!Array.isArray(l)&&(l=[l]);let m=1;const g=m+(t.max_new_tokens??1/0),h=Number.isInteger(t.max_length)&&(t.max_new_tokens??null)===null;let f=Sampler.getSampler(t),i=this.getStartBeams(e,t,m,o);for(;i.some(_=>!_.done)&&m<g;){let _=[];for(let y of i){if(y.done){_.push(y);continue}if(h&&y.output_token_ids.length>=t.max_length){y.done=!0,_.push(y);continue}let v=await this.runBeam(y);t.output_attentions&&this.addAttentionsToBeam(y,v),t.output_scores;let T=v.logits.slice(null,-1,null);s(y.output_token_ids,T);let w=f(T);for(let[E,P]of w){let R={...y};this.updateBeam(R,E),R.score+=P,l&&l.includes(E)&&(R.done=!0),_.push(R)}}++m,_=this.groupBeams(_).map(y=>y.sort((v,T)=>T.score-v.score).slice(0,t.num_beams)),i=_.flat(),t.callback_function&&t.callback_function(i)}const r=this.groupBeams(i),d=_=>r.map(y=>t.num_return_sequences>1?y.slice(0,t.num_return_sequences).map(v=>v[_]):[y[0][_]]).flat(),p=d("output_token_ids");if(t.return_dict_in_generate){const _=d("decoder_attentions"),y=d("cross_attentions");return{sequences:p,decoder_attentions:_,cross_attentions:y}}else return p}addAttentionsToBeam(e,t){if(this.config.is_encoder_decoder){if(!t.cross_attentions||t.cross_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce cross-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.cross_attentions||(e.cross_attentions=[]),e.cross_attentions.push(t.cross_attentions)}if(!t.decoder_attentions||t.decoder_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce decoder-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.decoder_attentions||(e.decoder_attentions=[]),e.decoder_attentions.push(t.decoder_attentions)}groupBeams(e){const t=Object.create(null);for(const s of e)t[s.id]===void 0?t[s.id]=[s]:t[s.id].push(s);return Object.values(t)}getPastKeyValues(e,t){const s=Object.create(null);for(const o in e)if(o.startsWith("present")){let u=o.replace("present","past_key_values");t&&o.includes("encoder")?s[u]=t[u]:s[u]=e[o]}return s}getAttentions(e){const t=Object.create(null);for(const s of["cross_attentions","decoder_attentions"]){const o=[];for(const u in e)if(u.startsWith(s)){const l=u.split(".").pop();o[l]=e[u]}t[s]=o}return t}addPastKeyValues(e,t){if(t)Object.assign(e,t);else if(this.config.is_encoder_decoder&&(this.add_encoder_pkv??!0)){let o=[1,this.num_encoder_heads,0,this.encoder_dim_kv],u=[1,this.num_decoder_heads,0,this.decoder_dim_kv];for(let l=0;l<this.num_decoder_layers;++l)e[`past_key_values.${l}.encoder.key`]=new Tensor("float32",[],o),e[`past_key_values.${l}.encoder.value`]=new Tensor("float32",[],o),e[`past_key_values.${l}.decoder.key`]=new Tensor("float32",[],u),e[`past_key_values.${l}.decoder.value`]=new Tensor("float32",[],u)}else if(this.config.model_type==="falcon"){let o=[1*this.num_heads,0,this.dim_kv];for(let u=0;u<this.num_layers;++u)e[`past_key_values.${u}.key`]=new Tensor("float32",[],o),e[`past_key_values.${u}.value`]=new Tensor("float32",[],o)}else if(this.config.multi_query){let o=[1*this.num_heads,0,2*this.dim_kv];for(let u=0;u<this.num_layers;++u)e[`past_key_values.${u}.key_value`]=new Tensor("float32",[],o)}else if(this.config.model_type==="bloom"){let o=[1*this.num_heads,this.dim_kv,0],u=[1*this.num_heads,0,this.dim_kv];for(let l=0;l<this.num_layers;++l)e[`past_key_values.${l}.key`]=new Tensor("float32",[],o),e[`past_key_values.${l}.value`]=new Tensor("float32",[],u)}else{let o=[1,this.num_heads,0,this.dim_kv];for(let u=0;u<this.num_layers;++u)e[`past_key_values.${u}.key`]=new Tensor("float32",[],o),e[`past_key_values.${u}.value`]=new Tensor("float32",[],o)}}getStartBeams(e,t,s,o){return this._getStartBeams(this,e,t,s,o)}async runBeam(e){return await this._runBeam(this,e)}updateBeam(e,t){return this._updateBeam(e,t)}}class ModelOutput{}class BertPreTrainedModel extends PreTrainedModel{}class BertModel extends BertPreTrainedModel{}class BertForMaskedLM extends BertPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class BertForSequenceClassification extends BertPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class BertForTokenClassification extends BertPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class BertForQuestionAnswering extends BertPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class NomicBertPreTrainedModel extends PreTrainedModel{}class NomicBertModel extends NomicBertPreTrainedModel{}class RoFormerPreTrainedModel extends PreTrainedModel{}class RoFormerModel extends RoFormerPreTrainedModel{}class RoFormerForMaskedLM extends RoFormerPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class RoFormerForSequenceClassification extends RoFormerPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class RoFormerForTokenClassification extends RoFormerPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class RoFormerForQuestionAnswering extends RoFormerPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class ConvBertPreTrainedModel extends PreTrainedModel{}class ConvBertModel extends ConvBertPreTrainedModel{}class ConvBertForMaskedLM extends ConvBertPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class ConvBertForSequenceClassification extends ConvBertPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class ConvBertForTokenClassification extends ConvBertPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class ConvBertForQuestionAnswering extends ConvBertPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class ElectraPreTrainedModel extends PreTrainedModel{}class ElectraModel extends ElectraPreTrainedModel{}class ElectraForMaskedLM extends ElectraPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class ElectraForSequenceClassification extends ElectraPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class ElectraForTokenClassification extends ElectraPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class ElectraForQuestionAnswering extends ElectraPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class CamembertPreTrainedModel extends PreTrainedModel{}class CamembertModel extends CamembertPreTrainedModel{}class CamembertForMaskedLM extends CamembertPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class CamembertForSequenceClassification extends CamembertPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class CamembertForTokenClassification extends CamembertPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class CamembertForQuestionAnswering extends CamembertPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class DebertaPreTrainedModel extends PreTrainedModel{}class DebertaModel extends DebertaPreTrainedModel{}class DebertaForMaskedLM extends DebertaPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class DebertaForSequenceClassification extends DebertaPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class DebertaForTokenClassification extends DebertaPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class DebertaForQuestionAnswering extends DebertaPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class DebertaV2PreTrainedModel extends PreTrainedModel{}class DebertaV2Model extends DebertaV2PreTrainedModel{}class DebertaV2ForMaskedLM extends DebertaV2PreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class DebertaV2ForSequenceClassification extends DebertaV2PreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class DebertaV2ForTokenClassification extends DebertaV2PreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class DebertaV2ForQuestionAnswering extends DebertaV2PreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class DistilBertPreTrainedModel extends PreTrainedModel{}class DistilBertModel extends DistilBertPreTrainedModel{}class DistilBertForSequenceClassification extends DistilBertPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class DistilBertForTokenClassification extends DistilBertPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class DistilBertForQuestionAnswering extends DistilBertPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class DistilBertForMaskedLM extends DistilBertPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class EsmPreTrainedModel extends PreTrainedModel{}class EsmModel extends EsmPreTrainedModel{}class EsmForMaskedLM extends EsmPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class EsmForSequenceClassification extends EsmPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class EsmForTokenClassification extends EsmPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class MobileBertPreTrainedModel extends PreTrainedModel{}class MobileBertModel extends MobileBertPreTrainedModel{}class MobileBertForMaskedLM extends MobileBertPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class MobileBertForSequenceClassification extends MobileBertPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class MobileBertForQuestionAnswering extends MobileBertPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class MPNetPreTrainedModel extends PreTrainedModel{}class MPNetModel extends MPNetPreTrainedModel{}class MPNetForMaskedLM extends MPNetPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class MPNetForSequenceClassification extends MPNetPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class MPNetForTokenClassification extends MPNetPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class MPNetForQuestionAnswering extends MPNetPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class SqueezeBertPreTrainedModel extends PreTrainedModel{}class SqueezeBertModel extends SqueezeBertPreTrainedModel{}class SqueezeBertForMaskedLM extends SqueezeBertPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class SqueezeBertForSequenceClassification extends SqueezeBertPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class SqueezeBertForQuestionAnswering extends SqueezeBertPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class AlbertPreTrainedModel extends PreTrainedModel{}class AlbertModel extends AlbertPreTrainedModel{}class AlbertForSequenceClassification extends AlbertPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class AlbertForQuestionAnswering extends AlbertPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class AlbertForMaskedLM extends AlbertPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class T5PreTrainedModel extends PreTrainedModel{}class T5Model extends T5PreTrainedModel{}class T5ForConditionalGeneration extends T5PreTrainedModel{constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class LongT5PreTrainedModel extends PreTrainedModel{}class LongT5Model extends LongT5PreTrainedModel{}class LongT5ForConditionalGeneration extends LongT5PreTrainedModel{constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class MT5PreTrainedModel extends PreTrainedModel{}class MT5Model extends MT5PreTrainedModel{}class MT5ForConditionalGeneration extends MT5PreTrainedModel{constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class BartPretrainedModel extends PreTrainedModel{}class BartModel extends BartPretrainedModel{}class BartForConditionalGeneration extends BartPretrainedModel{constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class BartForSequenceClassification extends BartPretrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class MBartPreTrainedModel extends PreTrainedModel{}class MBartModel extends MBartPreTrainedModel{}class MBartForConditionalGeneration extends MBartPreTrainedModel{constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class MBartForSequenceClassification extends MBartPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class MBartForCausalLM extends MBartPreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class BlenderbotPreTrainedModel extends PreTrainedModel{}class BlenderbotModel extends BlenderbotPreTrainedModel{}class BlenderbotForConditionalGeneration extends BlenderbotPreTrainedModel{constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class BlenderbotSmallPreTrainedModel extends PreTrainedModel{}class BlenderbotSmallModel extends BlenderbotSmallPreTrainedModel{}class BlenderbotSmallForConditionalGeneration extends BlenderbotSmallPreTrainedModel{constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class RobertaPreTrainedModel extends PreTrainedModel{}class RobertaModel extends RobertaPreTrainedModel{}class RobertaForMaskedLM extends RobertaPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class RobertaForSequenceClassification extends RobertaPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class RobertaForTokenClassification extends RobertaPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class RobertaForQuestionAnswering extends RobertaPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class XLMPreTrainedModel extends PreTrainedModel{}class XLMModel extends XLMPreTrainedModel{}class XLMWithLMHeadModel extends XLMPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class XLMForSequenceClassification extends XLMPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class XLMForTokenClassification extends XLMPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class XLMForQuestionAnswering extends XLMPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class XLMRobertaPreTrainedModel extends PreTrainedModel{}class XLMRobertaModel extends XLMRobertaPreTrainedModel{}class XLMRobertaForMaskedLM extends XLMRobertaPreTrainedModel{async _call(e){return new MaskedLMOutput(await super._call(e))}}class XLMRobertaForSequenceClassification extends XLMRobertaPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class XLMRobertaForTokenClassification extends XLMRobertaPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class XLMRobertaForQuestionAnswering extends XLMRobertaPreTrainedModel{async _call(e){return new QuestionAnsweringModelOutput(await super._call(e))}}class ASTPreTrainedModel extends PreTrainedModel{}class ASTModel extends ASTPreTrainedModel{}class ASTForAudioClassification extends ASTPreTrainedModel{}class WhisperPreTrainedModel extends PreTrainedModel{}class WhisperModel extends WhisperPreTrainedModel{}class WhisperForConditionalGeneration extends WhisperPreTrainedModel{requires_attention_mask=!1;main_input_name="input_features";constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}async generate(e,t=null,s=null){if(t=this._get_generation_config(t),t.return_timestamps??=!1,t.return_timestamps&&(s=[new WhisperTimeStampLogitsProcessor(t)]),t.return_token_timestamps&&(t.output_attentions=!0,t.return_dict_in_generate=!0,t.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),!t.alignment_heads))throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");const o=await super.generate(e,t,s);return t.return_token_timestamps&&t.alignment_heads&&(o.token_timestamps=this._extract_token_timestamps(o,t.alignment_heads,t.num_frames)),o}_extract_token_timestamps(e,t,s=null,o=.02){if(!e.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");let u=this.config.median_filter_width;u===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),u=7);const l=e.cross_attentions.map(h=>{let f=Array.from({length:this.config.decoder_layers},(y,v)=>cat(h.map(T=>T[v]),2)),i=stack(t.map(([y,v])=>s?f[y].slice(null,v,null,[0,s]):f[y].slice(null,v)));i=i.transpose(1,0,2,3);let[r,d]=std_mean(i,-2,0,!0),p=i.clone();for(let y=0;y<p.dims[0];++y){let v=p[y];for(let T=0;T<v.dims[0];++T){let w=v[T];const E=r[y][T][0],P=d[y][T][0];for(let R=0;R<w.dims[0];++R){let I=w[R];for(let N=0;N<I.data.length;++N)I.data[N]=(I.data[N]-P.data[N])/E.data[N];I.data.set(medianFilter(I.data,u))}}}return mean(p,1)}),m=[e.sequences.length,e.sequences[0].length],g=new Tensor("float32",new Float32Array(m[0]*m[1]),m);for(let h=0;h<m[0];++h){const f=l[h].neg().squeeze_(0);let[i,r]=dynamicTimeWarping(f),d=Array.from({length:i.length-1},(y,v)=>i[v+1]-i[v]),p=mergeArrays([1],d).map(y=>!!y),_=[];for(let y=0;y<p.length;++y)p[y]&&_.push(r[y]*o);g[h].data.set(_,1)}return g}}class VisionEncoderDecoderModel extends PreTrainedModel{main_input_name="pixel_values";constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o;const u=this.config.encoder,l=this.config.decoder,m=u.model_type;(MODEL_MAPPING_NAMES_ENCODER_ONLY.get(m)??MODEL_MAPPING_NAMES_ENCODER_DECODER.get(m))||console.warn(`Model type for encoder '${m}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`);const h=MODEL_WITH_LM_HEAD_MAPPING_NAMES.get(l.model_type);if(!h)throw new Error(`Unable to construct \`VisionEncoderDecoder\` due to unsupported decoder: "${this.config.decoder.model_type}"`);const f=h[1],i=new f(l,s,o);this.add_encoder_pkv="num_decoder_layers"in i,this.add_encoder_pkv?(this.num_decoder_layers=i.num_decoder_layers,this.num_decoder_heads=i.num_decoder_heads,this.decoder_dim_kv=i.decoder_dim_kv,this.num_encoder_layers=i.num_encoder_layers,this.num_encoder_heads=i.num_encoder_heads,this.encoder_dim_kv=i.encoder_dim_kv):(this.num_layers=i.num_layers,this.num_heads=i.num_heads,this.dim_kv=i.dim_kv)}}class CLIPPreTrainedModel extends PreTrainedModel{}class CLIPModel extends CLIPPreTrainedModel{}class CLIPTextModelWithProjection extends CLIPPreTrainedModel{static async from_pretrained(e,t={}){return t.model_file_name??="text_model",super.from_pretrained(e,t)}}class CLIPVisionModelWithProjection extends CLIPPreTrainedModel{static async from_pretrained(e,t={}){return t.model_file_name??="vision_model",super.from_pretrained(e,t)}}class SiglipPreTrainedModel extends PreTrainedModel{}class SiglipModel extends SiglipPreTrainedModel{}class SiglipTextModel extends SiglipPreTrainedModel{static async from_pretrained(e,t={}){return t.model_file_name??="text_model",super.from_pretrained(e,t)}}class SiglipVisionModel extends CLIPPreTrainedModel{static async from_pretrained(e,t={}){return t.model_file_name??="vision_model",super.from_pretrained(e,t)}}class ChineseCLIPPreTrainedModel extends PreTrainedModel{}class ChineseCLIPModel extends ChineseCLIPPreTrainedModel{}class CLIPSegPreTrainedModel extends PreTrainedModel{}class CLIPSegModel extends CLIPSegPreTrainedModel{}class CLIPSegForImageSegmentation extends CLIPSegPreTrainedModel{}class GPT2PreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class GPT2Model extends GPT2PreTrainedModel{}class GPT2LMHeadModel extends GPT2PreTrainedModel{}class GPTNeoPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_heads,this.num_layers=this.config.num_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class GPTNeoModel extends GPTNeoPreTrainedModel{}class GPTNeoForCausalLM extends GPTNeoPreTrainedModel{}class GPTNeoXPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class GPTNeoXModel extends GPTNeoXPreTrainedModel{}class GPTNeoXForCausalLM extends GPTNeoXPreTrainedModel{}class GPTJPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class GPTJModel extends GPTJPreTrainedModel{}class GPTJForCausalLM extends GPTJPreTrainedModel{}class GPTBigCodePreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class GPTBigCodeModel extends GPTBigCodePreTrainedModel{}class GPTBigCodeForCausalLM extends GPTBigCodePreTrainedModel{}class CodeGenPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class CodeGenModel extends CodeGenPreTrainedModel{}class CodeGenForCausalLM extends CodeGenPreTrainedModel{}class LlamaPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads??this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class LlamaModel extends LlamaPreTrainedModel{}class LlamaForCausalLM extends LlamaPreTrainedModel{}class Qwen2PreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads??this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class Qwen2Model extends Qwen2PreTrainedModel{}class Qwen2ForCausalLM extends Qwen2PreTrainedModel{}class PhiPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class PhiModel extends PhiPreTrainedModel{}class PhiForCausalLM extends PhiPreTrainedModel{}class BloomPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.hidden_size/this.num_heads}}class BloomModel extends BloomPreTrainedModel{}class BloomForCausalLM extends BloomPreTrainedModel{}class MptPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_heads,this.num_layers=this.config.n_layers,this.dim_kv=this.config.d_model/this.num_heads}}class MptModel extends MptPreTrainedModel{}class MptForCausalLM extends MptPreTrainedModel{}class OPTPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class OPTModel extends OPTPreTrainedModel{}class OPTForCausalLM extends OPTPreTrainedModel{}class ViTPreTrainedModel extends PreTrainedModel{}class ViTModel extends ViTPreTrainedModel{}class ViTForImageClassification extends ViTPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class FastViTPreTrainedModel extends PreTrainedModel{}class FastViTModel extends FastViTPreTrainedModel{}class FastViTForImageClassification extends FastViTPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class VitMattePreTrainedModel extends PreTrainedModel{}class VitMatteForImageMatting extends VitMattePreTrainedModel{async _call(e){return new ImageMattingOutput(await super._call(e))}}class MobileViTPreTrainedModel extends PreTrainedModel{}class MobileViTModel extends MobileViTPreTrainedModel{}class MobileViTForImageClassification extends MobileViTPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class MobileViTV2PreTrainedModel extends PreTrainedModel{}class MobileViTV2Model extends MobileViTV2PreTrainedModel{}class MobileViTV2ForImageClassification extends MobileViTV2PreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class OwlViTPreTrainedModel extends PreTrainedModel{}class OwlViTModel extends OwlViTPreTrainedModel{}class OwlViTForObjectDetection extends OwlViTPreTrainedModel{}class Owlv2PreTrainedModel extends PreTrainedModel{}class Owlv2Model extends Owlv2PreTrainedModel{}class Owlv2ForObjectDetection extends Owlv2PreTrainedModel{}class BeitPreTrainedModel extends PreTrainedModel{}class BeitModel extends BeitPreTrainedModel{}class BeitForImageClassification extends BeitPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class DetrPreTrainedModel extends PreTrainedModel{}class DetrModel extends DetrPreTrainedModel{}class DetrForObjectDetection extends DetrPreTrainedModel{async _call(e){return new DetrObjectDetectionOutput(await super._call(e))}}class DetrForSegmentation extends DetrPreTrainedModel{async _call(e){return new DetrSegmentationOutput(await super._call(e))}}class DetrObjectDetectionOutput extends ModelOutput{constructor({logits:e,pred_boxes:t}){super(),this.logits=e,this.pred_boxes=t}}class DetrSegmentationOutput extends ModelOutput{constructor({logits:e,pred_boxes:t,pred_masks:s}){super(),this.logits=e,this.pred_boxes=t,this.pred_masks=s}}class TableTransformerPreTrainedModel extends PreTrainedModel{}class TableTransformerModel extends TableTransformerPreTrainedModel{}class TableTransformerForObjectDetection extends TableTransformerPreTrainedModel{async _call(e){return new TableTransformerObjectDetectionOutput(await super._call(e))}}class TableTransformerObjectDetectionOutput extends DetrObjectDetectionOutput{}class DeiTPreTrainedModel extends PreTrainedModel{}class DeiTModel extends DeiTPreTrainedModel{}class DeiTForImageClassification extends DeiTPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class ResNetPreTrainedModel extends PreTrainedModel{}class ResNetModel extends ResNetPreTrainedModel{}class ResNetForImageClassification extends ResNetPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class SwinPreTrainedModel extends PreTrainedModel{}class SwinModel extends SwinPreTrainedModel{}class SwinForImageClassification extends SwinPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class Swin2SRPreTrainedModel extends PreTrainedModel{}class Swin2SRModel extends Swin2SRPreTrainedModel{}class Swin2SRForImageSuperResolution extends Swin2SRPreTrainedModel{}class DPTPreTrainedModel extends PreTrainedModel{}class DPTModel extends DPTPreTrainedModel{}class DPTForDepthEstimation extends DPTPreTrainedModel{}class DepthAnythingPreTrainedModel extends PreTrainedModel{}class DepthAnythingForDepthEstimation extends DepthAnythingPreTrainedModel{}class GLPNPreTrainedModel extends PreTrainedModel{}class GLPNModel extends GLPNPreTrainedModel{}class GLPNForDepthEstimation extends GLPNPreTrainedModel{}class DonutSwinPreTrainedModel extends PreTrainedModel{}class DonutSwinModel extends DonutSwinPreTrainedModel{}class ConvNextPreTrainedModel extends PreTrainedModel{}class ConvNextModel extends ConvNextPreTrainedModel{}class ConvNextForImageClassification extends ConvNextPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class ConvNextV2PreTrainedModel extends PreTrainedModel{}class ConvNextV2Model extends ConvNextV2PreTrainedModel{}class ConvNextV2ForImageClassification extends ConvNextV2PreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class Dinov2PreTrainedModel extends PreTrainedModel{}class Dinov2Model extends Dinov2PreTrainedModel{}class Dinov2ForImageClassification extends Dinov2PreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class YolosPreTrainedModel extends PreTrainedModel{}class YolosModel extends YolosPreTrainedModel{}class YolosForObjectDetection extends YolosPreTrainedModel{async _call(e){return new YolosObjectDetectionOutput(await super._call(e))}}class YolosObjectDetectionOutput extends ModelOutput{constructor({logits:e,pred_boxes:t}){super(),this.logits=e,this.pred_boxes=t}}class SamPreTrainedModel extends PreTrainedModel{}class SamModel extends SamPreTrainedModel{constructor(e,t,s){super(e,t),this.prompt_encoder_mask_decoder=s}async get_image_embeddings({pixel_values:e}){return await encoderForward(this,{pixel_values:e})}async forward(e){if((!e.image_embeddings||!e.image_positional_embeddings)&&(e={...e,...await this.get_image_embeddings(e)}),!e.input_labels){const t=e.input_points.dims.slice(0,-1),s=t.reduce((o,u)=>o*u,1);e.input_labels=new Tensor("int64",new BigInt64Array(s).fill(1n),t)}return await sessionRun(this.prompt_encoder_mask_decoder,{input_points:e.input_points,input_labels:e.input_labels,image_embeddings:e.image_embeddings,image_positional_embeddings:e.image_positional_embeddings})}async _call(e){return new SamImageSegmentationOutput(await super._call(e))}}class SamImageSegmentationOutput extends ModelOutput{constructor({iou_scores:e,pred_masks:t}){super(),this.iou_scores=e,this.pred_masks=t}}class MarianPreTrainedModel extends PreTrainedModel{}class MarianModel extends MarianPreTrainedModel{}class MarianMTModel extends MarianPreTrainedModel{constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class M2M100PreTrainedModel extends PreTrainedModel{}class M2M100Model extends M2M100PreTrainedModel{}class M2M100ForConditionalGeneration extends M2M100PreTrainedModel{constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class Wav2Vec2PreTrainedModel extends PreTrainedModel{}class Wav2Vec2Model extends Wav2Vec2PreTrainedModel{}class Wav2Vec2ForCTC extends Wav2Vec2PreTrainedModel{async _call(e){return new CausalLMOutput(await super._call(e))}}class Wav2Vec2ForSequenceClassification extends Wav2Vec2PreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class Wav2Vec2ForAudioFrameClassification extends Wav2Vec2PreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class UniSpeechPreTrainedModel extends PreTrainedModel{}class UniSpeechModel extends UniSpeechPreTrainedModel{}class UniSpeechForCTC extends UniSpeechPreTrainedModel{async _call(e){return new CausalLMOutput(await super._call(e))}}class UniSpeechForSequenceClassification extends UniSpeechPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class UniSpeechSatPreTrainedModel extends PreTrainedModel{}class UniSpeechSatModel extends UniSpeechSatPreTrainedModel{}class UniSpeechSatForCTC extends UniSpeechSatPreTrainedModel{async _call(e){return new CausalLMOutput(await super._call(e))}}class UniSpeechSatForSequenceClassification extends UniSpeechSatPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class UniSpeechSatForAudioFrameClassification extends UniSpeechSatPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class Wav2Vec2BertPreTrainedModel extends PreTrainedModel{}class Wav2Vec2BertModel extends Wav2Vec2BertPreTrainedModel{}class Wav2Vec2BertForCTC extends Wav2Vec2BertPreTrainedModel{async _call(e){return new CausalLMOutput(await super._call(e))}}class Wav2Vec2BertForSequenceClassification extends Wav2Vec2BertPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class HubertModel extends Wav2Vec2PreTrainedModel{}class HubertForCTC extends Wav2Vec2PreTrainedModel{async _call(e){return new CausalLMOutput(await super._call(e))}}class HubertForSequenceClassification extends Wav2Vec2PreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class WavLMPreTrainedModel extends PreTrainedModel{}class WavLMModel extends WavLMPreTrainedModel{}class WavLMForCTC extends WavLMPreTrainedModel{async _call(e){return new CausalLMOutput(await super._call(e))}}class WavLMForSequenceClassification extends WavLMPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class WavLMForXVector extends WavLMPreTrainedModel{async _call(e){return new XVectorOutput(await super._call(e))}}class WavLMForAudioFrameClassification extends WavLMPreTrainedModel{async _call(e){return new TokenClassifierOutput(await super._call(e))}}class SpeechT5PreTrainedModel extends PreTrainedModel{}class SpeechT5ForSpeechToText extends SpeechT5PreTrainedModel{}class SpeechT5ForTextToSpeech extends SpeechT5PreTrainedModel{constructor(e,t,s,o){super(e,t),this.decoder_merged_session=s,this.generation_config=o,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.hidden_size/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.hidden_size/this.num_encoder_heads}async generate_speech(e,t,{threshold:s=.5,minlenratio:o=0,maxlenratio:u=20,vocoder:l=null}={}){const m={input_ids:e},{encoder_outputs:g,encoder_attention_mask:h}=await encoderForward(this,m),f=g.dims[1]/this.config.reduction_factor,i=Math.floor(f*u),r=Math.floor(f*o),d=this.config.num_mel_bins;let p=[],_=null,y=null,v=0;for(;;){++v;const E=boolTensor(!!y);let P;y?P=y.output_sequence_out:P=new Tensor("float32",new Float32Array(d),[1,1,d]);let R={use_cache_branch:E,output_sequence:P,encoder_attention_mask:h,speaker_embeddings:t,encoder_hidden_states:g};this.addPastKeyValues(R,_),y=await sessionRun(this.decoder_merged_session,R),_=this.getPastKeyValues(y,_);const{prob:I,spectrum:N}=y;if(p.push(N),v>=r&&(Array.from(I.data).filter(B=>B>=s).length>0||v>=i))break}const T=cat(p),{waveform:w}=await sessionRun(l.session,{spectrogram:T});return{spectrogram:T,waveform:w}}}class SpeechT5HifiGan extends PreTrainedModel{main_input_name="spectrogram"}class TrOCRPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_encoder_layers=this.num_decoder_layers=this.config.decoder_layers,this.num_encoder_heads=this.num_decoder_heads=this.config.decoder_attention_heads,this.encoder_dim_kv=this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads}}class TrOCRForCausalLM extends TrOCRPreTrainedModel{}class MistralPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class MistralModel extends MistralPreTrainedModel{}class MistralForCausalLM extends MistralPreTrainedModel{}class Starcoder2PreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class Starcoder2Model extends Starcoder2PreTrainedModel{}class Starcoder2ForCausalLM extends Starcoder2PreTrainedModel{}class FalconPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class FalconModel extends FalconPreTrainedModel{}class FalconForCausalLM extends FalconPreTrainedModel{}class ClapPreTrainedModel extends PreTrainedModel{}class ClapModel extends ClapPreTrainedModel{}class ClapTextModelWithProjection extends ClapPreTrainedModel{static async from_pretrained(e,t={}){return t.model_file_name??="text_model",super.from_pretrained(e,t)}}class ClapAudioModelWithProjection extends ClapPreTrainedModel{static async from_pretrained(e,t={}){return t.model_file_name??="audio_model",super.from_pretrained(e,t)}}class VitsPreTrainedModel extends PreTrainedModel{}class VitsModel extends VitsPreTrainedModel{async _call(e){return new VitsModelOutput(await super._call(e))}}class SegformerPreTrainedModel extends PreTrainedModel{}class SegformerForImageClassification extends SegformerPreTrainedModel{}class SegformerForSemanticSegmentation extends SegformerPreTrainedModel{}class StableLmPreTrainedModel extends PreTrainedModel{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class StableLmForCausalLM extends StableLmPreTrainedModel{}class EfficientNetPreTrainedModel extends PreTrainedModel{}class EfficientNetModel extends EfficientNetPreTrainedModel{}class EfficientNetForImageClassification extends EfficientNetPreTrainedModel{async _call(e){return new SequenceClassifierOutput(await super._call(e))}}class PretrainedMixin{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=!1;static async from_pretrained(e,{quantized:t=!0,progress_callback:s=null,config:o=null,cache_dir:u=null,local_files_only:l=!1,revision:m="main",model_file_name:g=null}={}){let h={quantized:t,progress_callback:s,config:o,cache_dir:u,local_files_only:l,revision:m,model_file_name:g};if(o=await AutoConfig.from_pretrained(e,h),h.config||(h.config=o),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);for(let f of this.MODEL_CLASS_MAPPINGS){const i=f.get(o.model_type);if(i)return await i[1].from_pretrained(e,h)}if(this.BASE_IF_FAIL)return console.warn(`Unknown model class "${o.model_type}", attempting to construct from base class.`),await PreTrainedModel.from_pretrained(e,h);throw Error(`Unsupported model type: ${o.model_type}`)}}const MODEL_MAPPING_NAMES_ENCODER_ONLY=new Map([["bert",["BertModel",BertModel]],["nomic_bert",["NomicBertModel",NomicBertModel]],["roformer",["RoFormerModel",RoFormerModel]],["electra",["ElectraModel",ElectraModel]],["esm",["EsmModel",EsmModel]],["convbert",["ConvBertModel",ConvBertModel]],["camembert",["CamembertModel",CamembertModel]],["deberta",["DebertaModel",DebertaModel]],["deberta-v2",["DebertaV2Model",DebertaV2Model]],["mpnet",["MPNetModel",MPNetModel]],["albert",["AlbertModel",AlbertModel]],["distilbert",["DistilBertModel",DistilBertModel]],["roberta",["RobertaModel",RobertaModel]],["xlm",["XLMModel",XLMModel]],["xlm-roberta",["XLMRobertaModel",XLMRobertaModel]],["clap",["ClapModel",ClapModel]],["clip",["CLIPModel",CLIPModel]],["clipseg",["CLIPSegModel",CLIPSegModel]],["chinese_clip",["ChineseCLIPModel",ChineseCLIPModel]],["siglip",["SiglipModel",SiglipModel]],["mobilebert",["MobileBertModel",MobileBertModel]],["squeezebert",["SqueezeBertModel",SqueezeBertModel]],["wav2vec2",["Wav2Vec2Model",Wav2Vec2Model]],["wav2vec2-bert",["Wav2Vec2BertModel",Wav2Vec2BertModel]],["unispeech",["UniSpeechModel",UniSpeechModel]],["unispeech-sat",["UniSpeechSatModel",UniSpeechSatModel]],["hubert",["HubertModel",HubertModel]],["wavlm",["WavLMModel",WavLMModel]],["audio-spectrogram-transformer",["ASTModel",ASTModel]],["vits",["VitsModel",VitsModel]],["detr",["DetrModel",DetrModel]],["table-transformer",["TableTransformerModel",TableTransformerModel]],["vit",["ViTModel",ViTModel]],["fastvit",["FastViTModel",FastViTModel]],["mobilevit",["MobileViTModel",MobileViTModel]],["mobilevitv2",["MobileViTV2Model",MobileViTV2Model]],["owlvit",["OwlViTModel",OwlViTModel]],["owlv2",["Owlv2Model",Owlv2Model]],["beit",["BeitModel",BeitModel]],["deit",["DeiTModel",DeiTModel]],["convnext",["ConvNextModel",ConvNextModel]],["convnextv2",["ConvNextV2Model",ConvNextV2Model]],["dinov2",["Dinov2Model",Dinov2Model]],["resnet",["ResNetModel",ResNetModel]],["swin",["SwinModel",SwinModel]],["swin2sr",["Swin2SRModel",Swin2SRModel]],["donut-swin",["DonutSwinModel",DonutSwinModel]],["yolos",["YolosModel",YolosModel]],["dpt",["DPTModel",DPTModel]],["glpn",["GLPNModel",GLPNModel]],["hifigan",["SpeechT5HifiGan",SpeechT5HifiGan]],["efficientnet",["EfficientNetModel",EfficientNetModel]]]),MODEL_MAPPING_NAMES_ENCODER_DECODER=new Map([["t5",["T5Model",T5Model]],["longt5",["LongT5Model",LongT5Model]],["mt5",["MT5Model",MT5Model]],["bart",["BartModel",BartModel]],["mbart",["MBartModel",MBartModel]],["marian",["MarianModel",MarianModel]],["whisper",["WhisperModel",WhisperModel]],["m2m_100",["M2M100Model",M2M100Model]],["blenderbot",["BlenderbotModel",BlenderbotModel]],["blenderbot-small",["BlenderbotSmallModel",BlenderbotSmallModel]]]),MODEL_MAPPING_NAMES_DECODER_ONLY=new Map([["bloom",["BloomModel",BloomModel]],["gpt2",["GPT2Model",GPT2Model]],["gptj",["GPTJModel",GPTJModel]],["gpt_bigcode",["GPTBigCodeModel",GPTBigCodeModel]],["gpt_neo",["GPTNeoModel",GPTNeoModel]],["gpt_neox",["GPTNeoXModel",GPTNeoXModel]],["codegen",["CodeGenModel",CodeGenModel]],["llama",["LlamaModel",LlamaModel]],["qwen2",["Qwen2Model",Qwen2Model]],["phi",["PhiModel",PhiModel]],["mpt",["MptModel",MptModel]],["opt",["OPTModel",OPTModel]],["mistral",["MistralModel",MistralModel]],["starcoder2",["Starcoder2Model",Starcoder2Model]],["falcon",["FalconModel",FalconModel]]]),MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES=new Map([["speecht5",["SpeechT5ForSpeechToText",SpeechT5ForSpeechToText]],["whisper",["WhisperForConditionalGeneration",WhisperForConditionalGeneration]]]),MODEL_FOR_TEXT_TO_SPECTROGRAM_MAPPING_NAMES=new Map([["speecht5",["SpeechT5ForTextToSpeech",SpeechT5ForTextToSpeech]]]),MODEL_FOR_TEXT_TO_WAVEFORM_MAPPING_NAMES=new Map([["vits",["VitsModel",VitsModel]]]),MODEL_FOR_SEQUENCE_CLASSIFICATION_MAPPING_NAMES=new Map([["bert",["BertForSequenceClassification",BertForSequenceClassification]],["roformer",["RoFormerForSequenceClassification",RoFormerForSequenceClassification]],["electra",["ElectraForSequenceClassification",ElectraForSequenceClassification]],["esm",["EsmForSequenceClassification",EsmForSequenceClassification]],["convbert",["ConvBertForSequenceClassification",ConvBertForSequenceClassification]],["camembert",["CamembertForSequenceClassification",CamembertForSequenceClassification]],["deberta",["DebertaForSequenceClassification",DebertaForSequenceClassification]],["deberta-v2",["DebertaV2ForSequenceClassification",DebertaV2ForSequenceClassification]],["mpnet",["MPNetForSequenceClassification",MPNetForSequenceClassification]],["albert",["AlbertForSequenceClassification",AlbertForSequenceClassification]],["distilbert",["DistilBertForSequenceClassification",DistilBertForSequenceClassification]],["roberta",["RobertaForSequenceClassification",RobertaForSequenceClassification]],["xlm",["XLMForSequenceClassification",XLMForSequenceClassification]],["xlm-roberta",["XLMRobertaForSequenceClassification",XLMRobertaForSequenceClassification]],["bart",["BartForSequenceClassification",BartForSequenceClassification]],["mbart",["MBartForSequenceClassification",MBartForSequenceClassification]],["mobilebert",["MobileBertForSequenceClassification",MobileBertForSequenceClassification]],["squeezebert",["SqueezeBertForSequenceClassification",SqueezeBertForSequenceClassification]]]),MODEL_FOR_TOKEN_CLASSIFICATION_MAPPING_NAMES=new Map([["bert",["BertForTokenClassification",BertForTokenClassification]],["roformer",["RoFormerForTokenClassification",RoFormerForTokenClassification]],["electra",["ElectraForTokenClassification",ElectraForTokenClassification]],["esm",["EsmForTokenClassification",EsmForTokenClassification]],["convbert",["ConvBertForTokenClassification",ConvBertForTokenClassification]],["camembert",["CamembertForTokenClassification",CamembertForTokenClassification]],["deberta",["DebertaForTokenClassification",DebertaForTokenClassification]],["deberta-v2",["DebertaV2ForTokenClassification",DebertaV2ForTokenClassification]],["mpnet",["MPNetForTokenClassification",MPNetForTokenClassification]],["distilbert",["DistilBertForTokenClassification",DistilBertForTokenClassification]],["roberta",["RobertaForTokenClassification",RobertaForTokenClassification]],["xlm",["XLMForTokenClassification",XLMForTokenClassification]],["xlm-roberta",["XLMRobertaForTokenClassification",XLMRobertaForTokenClassification]]]),MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES=new Map([["t5",["T5ForConditionalGeneration",T5ForConditionalGeneration]],["longt5",["LongT5ForConditionalGeneration",LongT5ForConditionalGeneration]],["mt5",["MT5ForConditionalGeneration",MT5ForConditionalGeneration]],["bart",["BartForConditionalGeneration",BartForConditionalGeneration]],["mbart",["MBartForConditionalGeneration",MBartForConditionalGeneration]],["marian",["MarianMTModel",MarianMTModel]],["m2m_100",["M2M100ForConditionalGeneration",M2M100ForConditionalGeneration]],["blenderbot",["BlenderbotForConditionalGeneration",BlenderbotForConditionalGeneration]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",BlenderbotSmallForConditionalGeneration]]]),MODEL_WITH_LM_HEAD_MAPPING_NAMES=new Map([["bloom",["BloomForCausalLM",BloomForCausalLM]],["gpt2",["GPT2LMHeadModel",GPT2LMHeadModel]],["gptj",["GPTJForCausalLM",GPTJForCausalLM]],["gpt_bigcode",["GPTBigCodeForCausalLM",GPTBigCodeForCausalLM]],["gpt_neo",["GPTNeoForCausalLM",GPTNeoForCausalLM]],["gpt_neox",["GPTNeoXForCausalLM",GPTNeoXForCausalLM]],["codegen",["CodeGenForCausalLM",CodeGenForCausalLM]],["llama",["LlamaForCausalLM",LlamaForCausalLM]],["qwen2",["Qwen2ForCausalLM",Qwen2ForCausalLM]],["phi",["PhiForCausalLM",PhiForCausalLM]],["mpt",["MptForCausalLM",MptForCausalLM]],["opt",["OPTForCausalLM",OPTForCausalLM]],["mbart",["MBartForCausalLM",MBartForCausalLM]],["mistral",["MistralForCausalLM",MistralForCausalLM]],["starcoder2",["Starcoder2ForCausalLM",Starcoder2ForCausalLM]],["falcon",["FalconForCausalLM",FalconForCausalLM]],["trocr",["TrOCRForCausalLM",TrOCRForCausalLM]],["stablelm",["StableLmForCausalLM",StableLmForCausalLM]]]),MODEL_FOR_MASKED_LM_MAPPING_NAMES=new Map([["bert",["BertForMaskedLM",BertForMaskedLM]],["roformer",["RoFormerForMaskedLM",RoFormerForMaskedLM]],["electra",["ElectraForMaskedLM",ElectraForMaskedLM]],["esm",["EsmForMaskedLM",EsmForMaskedLM]],["convbert",["ConvBertForMaskedLM",ConvBertForMaskedLM]],["camembert",["CamembertForMaskedLM",CamembertForMaskedLM]],["deberta",["DebertaForMaskedLM",DebertaForMaskedLM]],["deberta-v2",["DebertaV2ForMaskedLM",DebertaV2ForMaskedLM]],["mpnet",["MPNetForMaskedLM",MPNetForMaskedLM]],["albert",["AlbertForMaskedLM",AlbertForMaskedLM]],["distilbert",["DistilBertForMaskedLM",DistilBertForMaskedLM]],["roberta",["RobertaForMaskedLM",RobertaForMaskedLM]],["xlm",["XLMWithLMHeadModel",XLMWithLMHeadModel]],["xlm-roberta",["XLMRobertaForMaskedLM",XLMRobertaForMaskedLM]],["mobilebert",["MobileBertForMaskedLM",MobileBertForMaskedLM]],["squeezebert",["SqueezeBertForMaskedLM",SqueezeBertForMaskedLM]]]),MODEL_FOR_QUESTION_ANSWERING_MAPPING_NAMES=new Map([["bert",["BertForQuestionAnswering",BertForQuestionAnswering]],["roformer",["RoFormerForQuestionAnswering",RoFormerForQuestionAnswering]],["electra",["ElectraForQuestionAnswering",ElectraForQuestionAnswering]],["convbert",["ConvBertForQuestionAnswering",ConvBertForQuestionAnswering]],["camembert",["CamembertForQuestionAnswering",CamembertForQuestionAnswering]],["deberta",["DebertaForQuestionAnswering",DebertaForQuestionAnswering]],["deberta-v2",["DebertaV2ForQuestionAnswering",DebertaV2ForQuestionAnswering]],["mpnet",["MPNetForQuestionAnswering",MPNetForQuestionAnswering]],["albert",["AlbertForQuestionAnswering",AlbertForQuestionAnswering]],["distilbert",["DistilBertForQuestionAnswering",DistilBertForQuestionAnswering]],["roberta",["RobertaForQuestionAnswering",RobertaForQuestionAnswering]],["xlm",["XLMForQuestionAnswering",XLMForQuestionAnswering]],["xlm-roberta",["XLMRobertaForQuestionAnswering",XLMRobertaForQuestionAnswering]],["mobilebert",["MobileBertForQuestionAnswering",MobileBertForQuestionAnswering]],["squeezebert",["SqueezeBertForQuestionAnswering",SqueezeBertForQuestionAnswering]]]),MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",VisionEncoderDecoderModel]]]),MODEL_FOR_DOCUMENT_QUESTION_ANSWERING_MAPPING_NAMES=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",VisionEncoderDecoderModel]]]),MODEL_FOR_IMAGE_CLASSIFICATION_MAPPING_NAMES=new Map([["vit",["ViTForImageClassification",ViTForImageClassification]],["fastvit",["FastViTForImageClassification",FastViTForImageClassification]],["mobilevit",["MobileViTForImageClassification",MobileViTForImageClassification]],["mobilevitv2",["MobileViTV2ForImageClassification",MobileViTV2ForImageClassification]],["beit",["BeitForImageClassification",BeitForImageClassification]],["deit",["DeiTForImageClassification",DeiTForImageClassification]],["convnext",["ConvNextForImageClassification",ConvNextForImageClassification]],["convnextv2",["ConvNextV2ForImageClassification",ConvNextV2ForImageClassification]],["dinov2",["Dinov2ForImageClassification",Dinov2ForImageClassification]],["resnet",["ResNetForImageClassification",ResNetForImageClassification]],["swin",["SwinForImageClassification",SwinForImageClassification]],["segformer",["SegformerForImageClassification",SegformerForImageClassification]],["efficientnet",["EfficientNetForImageClassification",EfficientNetForImageClassification]]]),MODEL_FOR_OBJECT_DETECTION_MAPPING_NAMES=new Map([["detr",["DetrForObjectDetection",DetrForObjectDetection]],["table-transformer",["TableTransformerForObjectDetection",TableTransformerForObjectDetection]],["yolos",["YolosForObjectDetection",YolosForObjectDetection]]]),MODEL_FOR_ZERO_SHOT_OBJECT_DETECTION_MAPPING_NAMES=new Map([["owlvit",["OwlViTForObjectDetection",OwlViTForObjectDetection]],["owlv2",["Owlv2ForObjectDetection",Owlv2ForObjectDetection]]]),MODEL_FOR_IMAGE_SEGMENTATION_MAPPING_NAMES=new Map([["detr",["DetrForSegmentation",DetrForSegmentation]],["clipseg",["CLIPSegForImageSegmentation",CLIPSegForImageSegmentation]]]),MODEL_FOR_SEMANTIC_SEGMENTATION_MAPPING_NAMES=new Map([["segformer",["SegformerForSemanticSegmentation",SegformerForSemanticSegmentation]]]),MODEL_FOR_MASK_GENERATION_MAPPING_NAMES=new Map([["sam",["SamModel",SamModel]]]),MODEL_FOR_CTC_MAPPING_NAMES=new Map([["wav2vec2",["Wav2Vec2ForCTC",Wav2Vec2ForCTC]],["wav2vec2-bert",["Wav2Vec2BertForCTC",Wav2Vec2BertForCTC]],["unispeech",["UniSpeechForCTC",UniSpeechForCTC]],["unispeech-sat",["UniSpeechSatForCTC",UniSpeechSatForCTC]],["wavlm",["WavLMForCTC",WavLMForCTC]],["hubert",["HubertForCTC",HubertForCTC]]]),MODEL_FOR_AUDIO_CLASSIFICATION_MAPPING_NAMES=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",Wav2Vec2ForSequenceClassification]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",Wav2Vec2BertForSequenceClassification]],["unispeech",["UniSpeechForSequenceClassification",UniSpeechForSequenceClassification]],["unispeech-sat",["UniSpeechSatForSequenceClassification",UniSpeechSatForSequenceClassification]],["wavlm",["WavLMForSequenceClassification",WavLMForSequenceClassification]],["hubert",["HubertForSequenceClassification",HubertForSequenceClassification]],["audio-spectrogram-transformer",["ASTForAudioClassification",ASTForAudioClassification]]]),MODEL_FOR_AUDIO_XVECTOR_MAPPING_NAMES=new Map([["wavlm",["WavLMForXVector",WavLMForXVector]]]),MODEL_FOR_AUDIO_FRAME_CLASSIFICATION_MAPPING_NAMES=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",UniSpeechSatForAudioFrameClassification]],["wavlm",["WavLMForAudioFrameClassification",WavLMForAudioFrameClassification]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",Wav2Vec2ForAudioFrameClassification]]]),MODEL_FOR_IMAGE_MATTING_MAPPING_NAMES=new Map([["vitmatte",["VitMatteForImageMatting",VitMatteForImageMatting]]]),MODEL_FOR_IMAGE_TO_IMAGE_MAPPING_NAMES=new Map([["swin2sr",["Swin2SRForImageSuperResolution",Swin2SRForImageSuperResolution]]]),MODEL_FOR_DEPTH_ESTIMATION_MAPPING_NAMES=new Map([["dpt",["DPTForDepthEstimation",DPTForDepthEstimation]],["depth_anything",["DepthAnythingForDepthEstimation",DepthAnythingForDepthEstimation]],["glpn",["GLPNForDepthEstimation",GLPNForDepthEstimation]]]),MODEL_FOR_IMAGE_FEATURE_EXTRACTION_MAPPING_NAMES=new Map([["clip",["CLIPVisionModelWithProjection",CLIPVisionModelWithProjection]],["siglip",["SiglipVisionModel",SiglipVisionModel]]]),MODEL_CLASS_TYPE_MAPPING=[[MODEL_MAPPING_NAMES_ENCODER_ONLY,MODEL_TYPES.EncoderOnly],[MODEL_MAPPING_NAMES_ENCODER_DECODER,MODEL_TYPES.EncoderDecoder],[MODEL_MAPPING_NAMES_DECODER_ONLY,MODEL_TYPES.DecoderOnly],[MODEL_FOR_SEQUENCE_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_TOKEN_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES,MODEL_TYPES.Seq2Seq],[MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES,MODEL_TYPES.Seq2Seq],[MODEL_WITH_LM_HEAD_MAPPING_NAMES,MODEL_TYPES.DecoderOnly],[MODEL_FOR_MASKED_LM_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_QUESTION_ANSWERING_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES,MODEL_TYPES.Vision2Seq],[MODEL_FOR_IMAGE_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_SEGMENTATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_SEMANTIC_SEGMENTATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_MATTING_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_TO_IMAGE_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_DEPTH_ESTIMATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_OBJECT_DETECTION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_ZERO_SHOT_OBJECT_DETECTION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_MASK_GENERATION_MAPPING_NAMES,MODEL_TYPES.MaskGeneration],[MODEL_FOR_CTC_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_AUDIO_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_TEXT_TO_SPECTROGRAM_MAPPING_NAMES,MODEL_TYPES.Seq2Seq],[MODEL_FOR_TEXT_TO_WAVEFORM_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_AUDIO_XVECTOR_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_AUDIO_FRAME_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_FEATURE_EXTRACTION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly]];for(const[n,e]of MODEL_CLASS_TYPE_MAPPING)for(const[t,s]of n.values())MODEL_TYPE_MAPPING.set(t,e),MODEL_CLASS_TO_NAME_MAPPING.set(s,t),MODEL_NAME_TO_CLASS_MAPPING.set(t,s);const CUSTOM_MAPPING=[["CLIPTextModelWithProjection",CLIPTextModelWithProjection,MODEL_TYPES.EncoderOnly],["SiglipTextModel",SiglipTextModel,MODEL_TYPES.EncoderOnly],["ClapTextModelWithProjection",ClapTextModelWithProjection,MODEL_TYPES.EncoderOnly],["ClapAudioModelWithProjection",ClapAudioModelWithProjection,MODEL_TYPES.EncoderOnly]];for(const[n,e,t]of CUSTOM_MAPPING)MODEL_TYPE_MAPPING.set(n,t),MODEL_CLASS_TO_NAME_MAPPING.set(e,n),MODEL_NAME_TO_CLASS_MAPPING.set(n,e);class AutoModel extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=MODEL_CLASS_TYPE_MAPPING.map(e=>e[0]);static BASE_IF_FAIL=!0}class AutoModelForSequenceClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SEQUENCE_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForTokenClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_TOKEN_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForSeq2SeqLM extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES]}class AutoModelForSpeechSeq2Seq extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES]}class AutoModelForTextToSpectrogram extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_TEXT_TO_SPECTROGRAM_MAPPING_NAMES]}class AutoModelForTextToWaveform extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_TEXT_TO_WAVEFORM_MAPPING_NAMES]}class AutoModelForCausalLM extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_WITH_LM_HEAD_MAPPING_NAMES]}class AutoModelForMaskedLM extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_MASKED_LM_MAPPING_NAMES]}class AutoModelForQuestionAnswering extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_QUESTION_ANSWERING_MAPPING_NAMES]}class AutoModelForVision2Seq extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES]}class AutoModelForImageClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForImageSegmentation extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_SEGMENTATION_MAPPING_NAMES]}class AutoModelForSemanticSegmentation extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SEMANTIC_SEGMENTATION_MAPPING_NAMES]}class AutoModelForObjectDetection extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_OBJECT_DETECTION_MAPPING_NAMES]}class AutoModelForZeroShotObjectDetection extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_ZERO_SHOT_OBJECT_DETECTION_MAPPING_NAMES]}class AutoModelForCTC extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_CTC_MAPPING_NAMES]}class AutoModelForAudioClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_AUDIO_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForDocumentQuestionAnswering extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_DOCUMENT_QUESTION_ANSWERING_MAPPING_NAMES]}class AutoModelForImageToImage extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_TO_IMAGE_MAPPING_NAMES]}class AutoModelForDepthEstimation extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_DEPTH_ESTIMATION_MAPPING_NAMES]}class AutoModelForImageFeatureExtraction extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_FEATURE_EXTRACTION_MAPPING_NAMES]}class Seq2SeqLMOutput extends ModelOutput{constructor({logits:e,past_key_values:t,encoder_outputs:s,decoder_attentions:o=null,cross_attentions:u=null}){super(),this.logits=e,this.past_key_values=t,this.encoder_outputs=s,this.decoder_attentions=o,this.cross_attentions=u}}class SequenceClassifierOutput extends ModelOutput{constructor({logits:e}){super(),this.logits=e}}class XVectorOutput extends ModelOutput{constructor({logits:e,embeddings:t}){super(),this.logits=e,this.embeddings=t}}class TokenClassifierOutput extends ModelOutput{constructor({logits:e}){super(),this.logits=e}}class MaskedLMOutput extends ModelOutput{constructor({logits:e}){super(),this.logits=e}}class QuestionAnsweringModelOutput extends ModelOutput{constructor({start_logits:e,end_logits:t}){super(),this.start_logits=e,this.end_logits=t}}class CausalLMOutput extends ModelOutput{constructor({logits:e}){super(),this.logits=e}}class ImageMattingOutput extends ModelOutput{constructor({alphas:e}){super(),this.alphas=e}}class VitsModelOutput extends ModelOutput{constructor({waveform:e,spectrogram:t}){super(),this.waveform=e,this.spectrogram=t}}const BROWSER_ENV=typeof self<"u",WEBWORKER_ENV=BROWSER_ENV&&self.constructor.name==="DedicatedWorkerGlobalScope";let createCanvasFunction,ImageDataClass,loadImageFunction;if(BROWSER_ENV)createCanvasFunction=(n,e)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(n,e)},loadImageFunction=self.createImageBitmap,ImageDataClass=self.ImageData;else if(sharp)loadImageFunction=async n=>{const t=(await n.metadata()).channels;let{data:s,info:o}=await n.rotate().raw().toBuffer({resolveWithObject:!0});const u=new RawImage(new Uint8ClampedArray(s),o.width,o.height,o.channels);return t!==void 0&&t!==o.channels&&u.convert(t),u};else throw new Error("Unable to load image processing library.");const RESAMPLING_MAPPING={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},CONTENT_TYPE_MAP=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class RawImage{constructor(e,t,s,o){this.data=e,this.width=t,this.height=s,this.channels=o}get size(){return[this.width,this.height]}static async read(e){if(e instanceof RawImage)return e;if(typeof e=="string"||e instanceof URL)return await this.fromURL(e);throw new Error(`Unsupported input type: ${typeof e}`)}static async fromURL(e){let t=await getFile(e);if(t.status!==200)throw new Error(`Unable to read image from "${e}" (${t.status} ${t.statusText})`);let s=await t.blob();return this.fromBlob(s)}static async fromBlob(e){if(BROWSER_ENV){let t=await loadImageFunction(e);const s=createCanvasFunction(t.width,t.height).getContext("2d");return s.drawImage(t,0,0),new this(s.getImageData(0,0,t.width,t.height).data,t.width,t.height,4)}else{let t=sharp(await e.arrayBuffer());return await loadImageFunction(t)}}static fromTensor(e,t="CHW"){if(e.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${e.dims.length} dimensions.`);if(t==="CHW")e=e.transpose(1,2,0);else if(t!=="HWC")throw new Error(`Unsupported channel format: ${t}`);if(!(e.data instanceof Uint8ClampedArray||e.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${e.type}`);switch(e.dims[2]){case 1:case 2:case 3:case 4:return new RawImage(e.data,e.dims[1],e.dims[0],e.dims[2]);default:throw new Error(`Unsupported number of channels: ${e.dims[2]}`)}}grayscale(){if(this.channels===1)return this;let e=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let t=0,s=0;t<this.data.length;t+=this.channels){const o=this.data[t],u=this.data[t+1],l=this.data[t+2];e[s++]=Math.round(.2989*o+.587*u+.114*l)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,1)}rgb(){if(this.channels===3)return this;let e=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let t=0,s=0;t<this.data.length;++t)e[s++]=this.data[t],e[s++]=this.data[t],e[s++]=this.data[t];break;case 4:for(let t=0,s=0;t<this.data.length;t+=4)e[s++]=this.data[t],e[s++]=this.data[t+1],e[s++]=this.data[t+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,3)}rgba(){if(this.channels===4)return this;let e=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let t=0,s=0;t<this.data.length;++t)e[s++]=this.data[t],e[s++]=this.data[t],e[s++]=this.data[t],e[s++]=255;break;case 3:for(let t=0,s=0;t<this.data.length;t+=3)e[s++]=this.data[t],e[s++]=this.data[t+1],e[s++]=this.data[t+2],e[s++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,4)}async resize(e,t,{resample:s=2}={}){let o=RESAMPLING_MAPPING[s]??s;if(BROWSER_ENV){let u=this.channels,l=this.toCanvas();const m=createCanvasFunction(e,t).getContext("2d");return m.drawImage(l,0,0,e,t),new RawImage(m.getImageData(0,0,e,t).data,e,t,4).convert(u)}else{let u=this.toSharp();switch(o){case"box":case"hamming":(o==="box"||o==="hamming")&&(console.warn(`Resampling method ${o} is not yet supported. Using bilinear instead.`),o="bilinear");case"nearest":case"bilinear":case"bicubic":u=u.affine([e/this.width,0,0,t/this.height],{interpolator:o});break;case"lanczos":u=u.resize({width:e,height:t,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${o} is not supported.`)}return await loadImageFunction(u)}}async pad([e,t,s,o]){if(e=Math.max(e,0),t=Math.max(t,0),s=Math.max(s,0),o=Math.max(o,0),e===0&&t===0&&s===0&&o===0)return this;if(BROWSER_ENV){let u=this.channels,l=this.toCanvas(),m=this.width+e+t,g=this.height+s+o;const h=createCanvasFunction(m,g).getContext("2d");return h.drawImage(l,0,0,this.width,this.height,e,s,m,g),new RawImage(h.getImageData(0,0,m,g).data,m,g,4).convert(u)}else{let u=this.toSharp().extend({left:e,right:t,top:s,bottom:o});return await loadImageFunction(u)}}async crop([e,t,s,o]){if(e=Math.max(e,0),t=Math.max(t,0),s=Math.min(s,this.width-1),o=Math.min(o,this.height-1),e===0&&t===0&&s===this.width-1&&o===this.height-1)return this;const u=s-e+1,l=o-t+1;if(BROWSER_ENV){const m=this.channels,g=this.toCanvas(),h=createCanvasFunction(u,l).getContext("2d");return h.drawImage(g,e,t,u,l,0,0,u,l),new RawImage(h.getImageData(0,0,u,l).data,u,l,4).convert(m)}else{const m=this.toSharp().extract({left:e,top:t,width:u,height:l});return await loadImageFunction(m)}}async center_crop(e,t){if(this.width===e&&this.height===t)return this;let s=(this.width-e)/2,o=(this.height-t)/2;if(BROWSER_ENV){let u=this.channels,l=this.toCanvas();const m=createCanvasFunction(e,t).getContext("2d");let g=0,h=0,f=0,i=0;return s>=0?g=s:f=-s,o>=0?h=o:i=-o,m.drawImage(l,g,h,e,t,f,i,e,t),new RawImage(m.getImageData(0,0,e,t).data,e,t,4).convert(u)}else{let u=this.toSharp();if(s>=0&&o>=0)u=u.extract({left:Math.floor(s),top:Math.floor(o),width:e,height:t});else if(s<=0&&o<=0){let l=Math.floor(-o),m=Math.floor(-s);u=u.extend({top:l,left:m,right:e-this.width-m,bottom:t-this.height-l})}else{let l=[0,0],m=0;o<0?(l[0]=Math.floor(-o),l[1]=t-this.height-l[0]):m=Math.floor(o);let g=[0,0],h=0;s<0?(g[0]=Math.floor(-s),g[1]=e-this.width-g[0]):h=Math.floor(s),u=u.extend({top:l[0],bottom:l[1],left:g[0],right:g[1]}).extract({left:h,top:m,width:e,height:t})}return await loadImageFunction(u)}}async toBlob(e="image/png",t=1){if(!BROWSER_ENV)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:e,quality:t})}toTensor(e="CHW"){let t=new Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(e!=="HWC")if(e==="CHW")t=t.permute(2,0,1);else throw new Error(`Unsupported channel format: ${e}`);return t}toCanvas(){if(!BROWSER_ENV)throw new Error("toCanvas() is only supported in browser environments.");let e=this.clone().rgba(),t=createCanvasFunction(e.width,e.height),s=new ImageDataClass(e.data,e.width,e.height);return t.getContext("2d").putImageData(s,0,0),t}_update(e,t,s,o=null){return this.data=e,this.width=t,this.height=s,o!==null&&(this.channels=o),this}clone(){return new RawImage(this.data.slice(),this.width,this.height,this.channels)}convert(e){if(this.channels===e)return this;switch(e){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(e){if(BROWSER_ENV){if(WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");const t=e.split(".").pop().toLowerCase(),s=CONTENT_TYPE_MAP.get(t)??"image/png",o=await this.toBlob(s),u=URL.createObjectURL(o),l=document.createElement("a");l.href=u,l.download=e,l.click(),l.remove()}else{if(env$1.useFS)return await this.toSharp().toFile(e);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(BROWSER_ENV)throw new Error("toSharp() is only supported in server-side environments.");return sharp(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}async function read_audio(n,e){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");const t=await(await getFile(n)).arrayBuffer(),s=new AudioContext({sampleRate:e});typeof e>"u"&&console.warn(`No sampling rate provided, using default of ${s.sampleRate}Hz.`);const o=await s.decodeAudioData(t);let u;if(o.numberOfChannels===2){const l=Math.sqrt(2),m=o.getChannelData(0),g=o.getChannelData(1);u=new Float32Array(m.length);for(let h=0;h<o.length;++h)u[h]=l*(m[h]+g[h])/2}else u=o.getChannelData(0);return u}function hanning(n){if(n<1)return new Float64Array;if(n===1)return new Float64Array([1]);const e=n-1,t=Math.PI/e,s=new Float64Array(n);for(let o=0;o<n;++o){const u=2*o-e;s[o]=.5+.5*Math.cos(t*u)}return s}const HERTZ_TO_MEL_MAPPING={htk:n=>2595*Math.log10(1+n/700),kaldi:n=>1127*Math.log(1+n/700),slaney:(n,e=1e3,t=15,s=27/Math.log(6.4))=>n>=e?t+Math.log(n/e)*s:3*n/200};function hertz_to_mel(n,e="htk"){const t=HERTZ_TO_MEL_MAPPING[e];if(!t)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof n=="number"?t(n):n.map(s=>t(s))}const MEL_TO_HERTZ_MAPPING={htk:n=>700*(10**(n/2595)-1),kaldi:n=>700*(Math.exp(n/1127)-1),slaney:(n,e=1e3,t=15,s=Math.log(6.4)/27)=>n>=t?e*Math.exp(s*(n-t)):200*n/3};function mel_to_hertz(n,e="htk"){const t=MEL_TO_HERTZ_MAPPING[e];if(!t)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof n=="number"?t(n):n.map(s=>t(s))}function _create_triangular_filter_bank(n,e){const t=Float64Array.from({length:e.length-1},(l,m)=>e[m+1]-e[m]),s=Array.from({length:n.length},()=>new Array(e.length));for(let l=0;l<n.length;++l){const m=s[l];for(let g=0;g<e.length;++g)m[g]=e[g]-n[l]}const o=e.length-2,u=Array.from({length:o},()=>new Array(n.length));for(let l=0;l<n.length;++l){const m=s[l];for(let g=0;g<o;++g){const h=-m[g]/t[g],f=m[g+2]/t[g+1];u[g][l]=Math.max(0,Math.min(h,f))}}return u}function linspace(n,e,t){const s=(e-n)/(t-1);return Float64Array.from({length:t},(o,u)=>n+s*u)}function mel_filter_bank(n,e,t,s,o,u=null,l="htk",m=!1){if(u!==null&&u!=="slaney")throw new Error('norm must be one of null or "slaney"');const g=hertz_to_mel(t,l),h=hertz_to_mel(s,l),f=linspace(g,h,e+2);let i=mel_to_hertz(f,l),r;if(m){const p=o/(n*2);r=hertz_to_mel(Float64Array.from({length:n},(_,y)=>y*p),l),i=f}else r=linspace(0,Math.floor(o/2),n);const d=_create_triangular_filter_bank(r,i);if(u!==null&&u==="slaney")for(let p=0;p<e;++p){const _=d[p],y=2/(i[p+2]-i[p]);for(let v=0;v<n;++v)_[v]*=y}return d}function padReflect(n,e,t){const s=new n.constructor(n.length+e+t),o=n.length-1;for(let u=0;u<n.length;++u)s[e+u]=n[u];for(let u=1;u<=e;++u)s[e-u]=n[calculateReflectOffset(u,o)];for(let u=1;u<=t;++u)s[o+e+u]=n[calculateReflectOffset(o-u,o)];return s}function _db_conversion_helper(n,e,t,s,o){if(t<=0)throw new Error("reference must be greater than zero");if(s<=0)throw new Error("min_value must be greater than zero");t=Math.max(s,t);const u=Math.log10(t);for(let l=0;l<n.length;++l)n[l]=e*Math.log10(Math.max(s,n[l])-u);if(o!==null){if(o<=0)throw new Error("db_range must be greater than zero");const l=max(n)[0]-o;for(let m=0;m<n.length;++m)n[m]=Math.max(n[m],l)}return n}function amplitude_to_db(n,e=1,t=1e-5,s=null){return _db_conversion_helper(n,20,e,t,s)}function power_to_db(n,e=1,t=1e-10,s=null){return _db_conversion_helper(n,10,e,t,s)}function spectrogram(n,e,t,s,{fft_length:o=null,power:u=1,center:l=!0,pad_mode:m="reflect",onesided:g=!0,preemphasis:h=null,mel_filters:f=null,mel_floor:i=1e-10,log_mel:r=null,reference:d=1,min_value:p=1e-10,db_range:_=null,remove_dc_offset:y=null,max_num_frames:v=null,do_pad:T=!0,transpose:w=!1}={}){const E=e.length;if(o===null&&(o=t),t>o)throw Error(`frame_length (${t}) may not be larger than fft_length (${o})`);if(E!==t)throw new Error(`Length of the window (${E}) must equal frame_length (${t})`);if(s<=0)throw new Error("hop_length must be greater than zero");if(u===null&&f!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(l){if(m!=="reflect")throw new Error(`pad_mode="${m}" not implemented yet.`);const k=Math.floor((o-1)/2)+1;n=padReflect(n,k,k)}const P=Math.floor(1+Math.floor((n.length-t)/s)),R=g?Math.floor(o/2)+1:o;let I=P,N=P;v!==null&&(v>P?T&&(N=v):N=I=v);const B=new FFT(o),D=new Float64Array(o),Y=new Float64Array(B.outputBufferSize),se=new Array(I);for(let k=0;k<I;++k){const H=k*s;for(let ee=0;ee<t;++ee)D[ee]=n[H+ee];if(y){let ee=0;for(let q=0;q<t;++q)ee+=D[q];const ce=ee/t;for(let q=0;q<t;++q)D[q]-=ce}if(h!==null){for(let ee=t-1;ee>=1;--ee)D[ee]-=h*D[ee-1];D[0]*=1-h}for(let ee=0;ee<e.length;++ee)D[ee]*=e[ee];B.realTransform(Y,D);const de=new Array(R);for(let ee=0;ee<de.length;++ee){const ce=ee<<1;de[ee]=Y[ce]**2+Y[ce+1]**2}se[k]=de}if(u!==null&&u!==2){const k=2/u;for(let H=0;H<se.length;++H){const de=se[H];for(let ee=0;ee<de.length;++ee)de[ee]**=k}}const re=f.length,W=new Float32Array(re*N),$=w?[N,re]:[re,N];for(let k=0;k<re;++k){const H=f[k];for(let de=0;de<I;++de){const ee=se[de];let ce=0;for(let q=0;q<R;++q)ce+=H[q]*ee[q];W[w?de*re+k:k*I+de]=Math.max(i,ce)}}if(u!==null&&r!==null){const k=Math.min(W.length,I*re);switch(r){case"log":for(let H=0;H<k;++H)W[H]=Math.log(W[H]);break;case"log10":for(let H=0;H<k;++H)W[H]=Math.log10(W[H]);break;case"dB":if(u===1)amplitude_to_db(W,d,p,_);else if(u===2)power_to_db(W,d,p,_);else throw new Error(`Cannot use log_mel option '${r}' with power ${u}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${r}'`)}}return{data:W,dims:$}}function window_function(n,e,{periodic:t=!0,frame_length:s=null,center:o=!0}={}){const u=t?n+1:n;let l;switch(e){case"boxcar":l=new Float64Array(u).fill(1);break;case"hann":case"hann_window":l=hanning(u);break;case"povey":l=hanning(u).map(m=>Math.pow(m,.85));break;default:throw new Error(`Unknown window type ${e}.`)}if(t&&(l=l.subarray(0,n)),s===null)return l;if(n>s)throw new Error(`Length of the window (${n}) may not be larger than frame_length (${s})`);return l}function center_to_corners_format([n,e,t,s]){return[n-t/2,e-s/2,n+t/2,e+s/2]}function post_process_object_detection(n,e=.5,t=null,s=!1){const o=n.logits,u=n.pred_boxes,[l,m,g]=o.dims;if(t!==null&&t.length!==l)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let h=[];for(let f=0;f<l;++f){let i=t!==null?t[f]:null,r={boxes:[],classes:[],scores:[]},d=o[f],p=u[f];for(let _=0;_<m;++_){let y=d[_],v=[],T;if(s){T=y.sigmoid().data;for(let w=0;w<T.length;++w)T[w]>e&&v.push(w)}else{let w=max(y.data)[1];if(w===g-1)continue;v.push(w),T=softmax(y.data)}for(const w of v){let E=p[_].data;E=center_to_corners_format(E),i!==null&&(E=E.map((P,R)=>P*i[(R+1)%2])),r.boxes.push(E),r.classes.push(w),r.scores.push(T[w])}}h.push(r)}return h}function validate_audio_inputs(n,e){if(!(n instanceof Float32Array||n instanceof Float64Array))throw new Error(`${e} expects input to be a Float32Array or a Float64Array, but got ${n?.constructor?.name??typeof n} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}function constraint_to_multiple_of(n,e,t=0,s=null){const o=n/e;let u=bankers_round(o)*e;return s!==null&&u>s&&(u=Math.floor(o)*e),u<t&&(u=Math.ceil(o)*e),u}function enforce_size_divisibility([n,e],t){return[Math.max(Math.floor(n/t),1)*t,Math.max(Math.floor(e/t),1)*t]}class FeatureExtractor extends Callable{constructor(e){super(),this.config=e}}class ImageFeatureExtractor extends FeatureExtractor{constructor(e){super(e),this.image_mean=this.config.image_mean??this.config.mean,this.image_std=this.config.image_std??this.config.std,this.resample=this.config.resample??2,this.do_rescale=this.config.do_rescale??!0,this.rescale_factor=this.config.rescale_factor??1/255,this.do_normalize=this.config.do_normalize,this.do_resize=this.config.do_resize,this.do_thumbnail=this.config.do_thumbnail,this.size=this.config.size,this.size_divisibility=this.config.size_divisibility??this.config.size_divisor,this.do_center_crop=this.config.do_center_crop,this.crop_size=this.config.crop_size,this.do_convert_rgb=this.config.do_convert_rgb??!0,this.do_crop_margin=this.config.do_crop_margin,this.pad_size=this.config.pad_size,this.do_pad=this.config.do_pad,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=this.config.do_flip_channel_order??!1}async thumbnail(e,t,s=2){const o=e.height,u=e.width,l=t.height,m=t.width;let g=Math.min(o,l),h=Math.min(u,m);return g===o&&h===u?e:(o>u?h=Math.floor(u*g/o):u>o&&(g=Math.floor(o*h/u)),await e.resize(h,g,{resample:s}))}async crop_margin(e,t=200){const s=e.clone().grayscale(),o=min(s.data)[0],l=max(s.data)[0]-o;if(l===0)return e;const m=t/255;let g=s.width,h=s.height,f=0,i=0;for(let r=0;r<s.height;++r){const d=r*s.width;for(let p=0;p<s.width;++p)(s.data[d+p]-o)/l<m&&(g=Math.min(g,p),h=Math.min(h,r),f=Math.max(f,p),i=Math.max(i,r))}return e=await e.crop([g,h,f,i]),e}pad_image(e,t,s,{mode:o="constant",center:u=!1,constant_values:l=0}={}){const[m,g,h]=t;let f,i;if(typeof s=="number"?(f=s,i=s):(f=s.width,i=s.height),f!==g||i!==m){const r=new Float32Array(f*i*h);if(Array.isArray(l))for(let _=0;_<r.length;++_)r[_]=l[_%h];else l!==0&&r.fill(l);const[d,p]=u?[Math.floor((f-g)/2),Math.floor((i-m)/2)]:[0,0];for(let _=0;_<m;++_){const y=(_+p)*f,v=_*g;for(let T=0;T<g;++T){const w=(y+T+d)*h,E=(v+T)*h;for(let P=0;P<h;++P)r[w+P]=e[E+P]}}if(o==="symmetric"){if(u)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const _=m-1,y=g-1;for(let v=0;v<i;++v){const T=v*f,w=calculateReflectOffset(v,_)*g;for(let E=0;E<f;++E){if(v<m&&E<g)continue;const P=(T+E)*h,R=(w+calculateReflectOffset(E,y))*h;for(let I=0;I<h;++I)r[P+I]=e[R+I]}}}e=r,t=[i,f,h]}return[e,t]}rescale(e){for(let t=0;t<e.length;++t)e[t]=this.rescale_factor*e[t]}get_resize_output_image_size(e,t){const[s,o]=e.size;let u,l;if(this.do_thumbnail){const{height:m,width:g}=t;u=Math.min(m,g)}else Number.isInteger(t)?(u=t,l=this.config.max_size??u):t!==void 0&&(u=t.shortest_edge,l=t.longest_edge);if(u!==void 0||l!==void 0){const m=u===void 0?1:Math.max(u/s,u/o),g=s*m,h=o*m,f=l===void 0?1:Math.min(l/g,l/h);let i=Math.floor(Number((g*f).toFixed(2))),r=Math.floor(Number((h*f).toFixed(2)));return this.size_divisibility!==void 0&&([i,r]=enforce_size_divisibility([i,r],this.size_divisibility)),[i,r]}else if(t!==void 0&&t.width!==void 0&&t.height!==void 0){let m=t.width,g=t.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let h=g/o,f=m/s;Math.abs(1-f)<Math.abs(1-h)?h=f:f=h,g=constraint_to_multiple_of(h*o,this.config.ensure_multiple_of),m=constraint_to_multiple_of(f*s,this.config.ensure_multiple_of)}return[m,g]}else{if(this.size_divisibility!==void 0)return enforce_size_divisibility([s,o],this.size_divisibility);throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(t)}`)}}async resize(e){const[t,s]=this.get_resize_output_image_size(e,this.size);return await e.resize(t,s,{resample:this.resample})}async preprocess(e,{do_normalize:t=null,do_pad:s=null,do_convert_rgb:o=null,do_convert_grayscale:u=null,do_flip_channel_order:l=null}={}){this.do_crop_margin&&(e=await this.crop_margin(e));const[m,g]=e.size;if(o??this.do_convert_rgb?e=e.rgb():u&&(e=e.grayscale()),this.do_resize&&(e=await this.resize(e)),this.do_thumbnail&&(e=await this.thumbnail(e,this.size,this.resample)),this.do_center_crop){let d,p;Number.isInteger(this.crop_size)?(d=this.crop_size,p=this.crop_size):(d=this.crop_size.width,p=this.crop_size.height),e=await e.center_crop(d,p)}const h=[e.height,e.width];let f=Float32Array.from(e.data),i=[e.height,e.width,e.channels];if(this.do_rescale&&this.rescale(f),t??this.do_normalize){let d=this.image_mean;Array.isArray(this.image_mean)||(d=new Array(e.channels).fill(d));let p=this.image_std;if(Array.isArray(this.image_std)||(p=new Array(e.channels).fill(d)),d.length!==e.channels||p.length!==e.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${d.length}) and \`image_std\` (${p.length}) must match the number of channels in the image (${e.channels}).`);for(let _=0;_<f.length;_+=e.channels)for(let y=0;y<e.channels;++y)f[_+y]=(f[_+y]-d[y])/p[y]}if(s??this.do_pad){if(this.pad_size)[f,i]=this.pad_image(f,[e.height,e.width,e.channels],this.pad_size);else if(this.size_divisibility){const[d,p]=enforce_size_divisibility([i[1],i[0]],this.size_divisibility);[f,i]=this.pad_image(f,i,{width:d,height:p})}}if(l??this.do_flip_channel_order){if(i[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let d=0;d<f.length;d+=3){const p=f[d];f[d]=f[d+2],f[d+2]=p}}const r=new Tensor("float32",f,i).permute(2,0,1);return{original_size:[g,m],reshaped_input_size:h,pixel_values:r}}async _call(e,...t){Array.isArray(e)||(e=[e]);const s=await Promise.all(e.map(u=>this.preprocess(u)));return{pixel_values:stack(s.map(u=>u.pixel_values),0),original_sizes:s.map(u=>u.original_size),reshaped_input_sizes:s.map(u=>u.reshaped_input_size)}}}class SegformerFeatureExtractor extends ImageFeatureExtractor{post_process_semantic_segmentation(e,t=null){const s=e.logits,o=s.dims[0];if(t!==null&&t.length!==o)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const u=[];for(let l=0;l<o;++l){const m=t!==null?t[l]:null;let g=s[l];m!==null&&(g=interpolate(g,m,"bilinear",!1));const[h,f]=m??g.dims.slice(-2),i=new Tensor("int32",new Int32Array(h*f),[h,f]),r=g[0].data;for(let y=1;y<g.dims[0];++y){const v=g[y].data;for(let T=0;T<v.length;++T)v[T]>r[T]&&(r[T]=v[T],i.data[T]=y)}const d=new Array(g.dims[0]),p=i.data;for(let y=0;y<p.length;++y){const v=p[y];d[v]=v}const _=d.filter(y=>y!==void 0);u.push({segmentation:i,labels:_})}return u}}class DPTFeatureExtractor extends ImageFeatureExtractor{}class DPTImageProcessor extends DPTFeatureExtractor{}class BitImageProcessor extends ImageFeatureExtractor{}class GLPNFeatureExtractor extends ImageFeatureExtractor{}class CLIPFeatureExtractor extends ImageFeatureExtractor{}class ChineseCLIPFeatureExtractor extends ImageFeatureExtractor{}class SiglipImageProcessor extends ImageFeatureExtractor{}class ConvNextFeatureExtractor extends ImageFeatureExtractor{constructor(e){super(e),this.crop_pct=this.config.crop_pct??224/256}async resize(e){const t=this.size?.shortest_edge;if(t===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(t<384){const s=Math.floor(t/this.crop_pct),[o,u]=this.get_resize_output_image_size(e,{shortest_edge:s});e=await e.resize(o,u,{resample:this.resample}),e=await e.center_crop(t,t)}else e=await e.resize(t,t,{resample:this.resample});return e}}class ConvNextImageProcessor extends ConvNextFeatureExtractor{}class ViTFeatureExtractor extends ImageFeatureExtractor{}class ViTImageProcessor extends ImageFeatureExtractor{}class EfficientNetImageProcessor extends ImageFeatureExtractor{constructor(e){super(e),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(t=>t*t))}}class MobileViTFeatureExtractor extends ImageFeatureExtractor{}class MobileViTImageProcessor extends MobileViTFeatureExtractor{}class OwlViTFeatureExtractor extends ImageFeatureExtractor{post_process_object_detection(...e){return post_process_object_detection(...e)}}class Owlv2ImageProcessor extends OwlViTFeatureExtractor{}class DeiTFeatureExtractor extends ImageFeatureExtractor{}class BeitFeatureExtractor extends ImageFeatureExtractor{}class DonutFeatureExtractor extends ImageFeatureExtractor{pad_image(e,t,s,o={}){const[u,l,m]=t;let g=this.image_mean;Array.isArray(this.image_mean)||(g=new Array(m).fill(g));let h=this.image_std;Array.isArray(h)||(h=new Array(m).fill(g));const f=g.map((i,r)=>-i/h[r]);return super.pad_image(e,t,s,{center:!0,constant_values:f,...o})}}class NougatImageProcessor extends DonutFeatureExtractor{}class DetrFeatureExtractor extends ImageFeatureExtractor{async _call(e){const t=await super._call(e),s=[t.pixel_values.dims[0],64,64],o=new Tensor("int64",new BigInt64Array(s.reduce((u,l)=>u*l)).fill(1n),s);return{...t,pixel_mask:o}}post_process_object_detection(...e){return post_process_object_detection(...e)}remove_low_and_no_objects(e,t,s,o){let u=[],l=[],m=[];for(let g=0;g<e.dims[0];++g){let h=e[g],f=t[g],i=max(h.data)[1];if(i===o)continue;let d=softmax(h.data)[i];d>s&&(u.push(f),l.push(d),m.push(i))}return[u,l,m]}check_segment_validity(e,t,s,o=.5,u=.8){let l=[],m=0,g=0;for(let f=0;f<e.length;++f)e[f]===s&&(l.push(f),++m),t[s].data[f]>=o&&++g;let h=m>0&&g>0;return h&&(h=m/g>u),[h,l]}compute_segments(e,t,s,o,u,l=null,m=null){let[g,h]=m??e[0].dims,f=new Tensor("int32",new Int32Array(g*h),[g,h]),i=[];if(m!==null)for(let _=0;_<e.length;++_)e[_]=interpolate(e[_],m,"bilinear",!1);let r=new Int32Array(e[0].data.length),d=new Float32Array(e[0].data.length);for(let _=0;_<e.length;++_){let y=t[_];for(let v=0;v<e[_].data.length;++v)e[_].data[v]*=y,e[_].data[v]>d[v]&&(r[v]=_,d[v]=e[_].data[v])}let p=0;for(let _=0;_<s.length;++_){let y=s[_],[v,T]=this.check_segment_validity(r,e,_,o,u);if(v){++p;for(let w of T)f.data[w]=p;i.push({id:p,label_id:y,score:t[_]})}}return[f,i]}post_process_panoptic_segmentation(e,t=.5,s=.5,o=.8,u=null,l=null){u===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),u=new Set);const m=e.logits,h=e.pred_masks.sigmoid();let[f,i,r]=m.dims;if(r-=1,l!==null&&l.length!==f)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let d=[];for(let p=0;p<f;++p){let _=l!==null?l[p]:null,y=m[p],v=h[p],[T,w,E]=this.remove_low_and_no_objects(y,v,t,r);if(E.length===0){let[I,N]=_??v.dims.slice(-2),B=new Tensor("int32",new Int32Array(I*N).fill(-1),[I,N]);d.push({segmentation:B,segments_info:[]});continue}let[P,R]=this.compute_segments(T,w,E,s,o,u,_);d.push({segmentation:P,segments_info:R})}return d}post_process_instance_segmentation(){throw Error("Not implemented yet")}}class YolosFeatureExtractor extends ImageFeatureExtractor{post_process_object_detection(...e){return post_process_object_detection(...e)}}class SamImageProcessor extends ImageFeatureExtractor{reshape_input_points(e,t,s){e=structuredClone(e);let o=calculateDimensions(e);if(o.length===3)o=[1,...o],e=[e];else if(o.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let u=0;u<e.length;++u){let l=t[u],m=s[u],g=[m[0]/l[0],m[1]/l[1]];for(let h=0;h<e[u].length;++h)for(let f=0;f<e[u][h].length;++f)for(let i=0;i<e[u][h][f].length;++i)e[u][h][f][i]*=g[i]}return new Tensor("float32",Float32Array.from(e.flat(1/0)),o)}add_input_labels(e,t){let s=calculateDimensions(e);if(s.length===2)s=[1,...s],e=[e];else if(s.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(s.some((o,u)=>o!==t.dims[u]))throw Error(`The first ${s.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new Tensor("int64",e.flat(1/0).map(BigInt),s)}async _call(e,t=null,s=null){const o=await super._call(e);if(t&&(o.input_points=this.reshape_input_points(t,o.original_sizes,o.reshaped_input_sizes)),s){if(!o.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");o.input_labels=this.add_input_labels(s,o.input_points)}return o}post_process_masks(e,t,s,{mask_threshold:o=0,binarize:u=!0,pad_size:l=null}={}){const m=[];l=l??this.pad_size;const g=[l.height,l.width];for(let h=0;h<t.length;++h){const f=t[h],i=s[h],r=e[h],d=[];for(let p=0;p<r.dims[0];++p){const _=r[p];let y=interpolate(_,g,"bilinear",!1);if(y=y.slice(null,[0,i[0]],[0,i[1]]),y=interpolate(y,f,"bilinear",!1),u){const v=new Uint8Array(y.data.length);for(let T=0;T<y.data.length;++T)y.data[T]>o&&(v[T]=1);y=new Tensor("bool",v,y.dims)}d.push(y)}m.push(stack(d))}return m}}class Swin2SRImageProcessor extends ImageFeatureExtractor{pad_image(e,t,s,o={}){const[u,l,m]=t;return super.pad_image(e,t,{width:l+(s-l%s)%s,height:u+(s-u%s)%s},{mode:"symmetric",center:!1,constant_values:-1,...o})}}class VitMatteImageProcessor extends ImageFeatureExtractor{async _call(e,t){Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]);const s=await Promise.all(e.map(l=>this.preprocess(l))),o=await Promise.all(t.map(l=>this.preprocess(l,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:stack(s.map((l,m)=>cat([l.pixel_values,o[m].pixel_values],0)),0),original_sizes:s.map(l=>l.original_size),reshaped_input_sizes:s.map(l=>l.reshaped_input_size)}}}class WhisperFeatureExtractor extends FeatureExtractor{constructor(e){super(e),this.config.mel_filters??=mel_filter_bank(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney"),this.window=window_function(this.config.n_fft,"hann")}_extract_fbank_features(e){const{data:t,dims:s}=spectrogram(e,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:this.config.nb_max_frames}),o=max(t)[0];for(let u=0;u<t.length;++u)t[u]=(Math.max(t[u],o-8)+4)/4;return{data:t,dims:s}}async _call(e){validate_audio_inputs(e,"WhisperFeatureExtractor");let t;e.length>this.config.n_samples?(console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),t=e.slice(0,this.config.n_samples)):(t=new Float32Array(this.config.n_samples),t.set(e));const{data:s,dims:o}=this._extract_fbank_features(t);return{input_features:new Tensor("float32",s,[1,...o])}}}class Wav2Vec2FeatureExtractor extends FeatureExtractor{_zero_mean_unit_var_norm(e){const s=e.reduce((u,l)=>u+l,0)/e.length,o=e.reduce((u,l)=>u+(l-s)**2,0)/e.length;return e.map(u=>(u-s)/Math.sqrt(o+1e-7))}async _call(e){validate_audio_inputs(e,"Wav2Vec2FeatureExtractor"),e instanceof Float64Array&&(e=new Float32Array(e));let t=e;this.config.do_normalize&&(t=this._zero_mean_unit_var_norm(t));const s=[1,t.length];return{input_values:new Tensor("float32",t,s),attention_mask:new Tensor("int64",new BigInt64Array(t.length).fill(1n),s)}}}class SeamlessM4TFeatureExtractor extends FeatureExtractor{constructor(e){super(e);const t=this.config.sampling_rate,s=mel_filter_bank(256,this.config.num_mel_bins,20,Math.floor(t/2),t,null,"kaldi",!0);for(let o=0;o<s.length;++o)s[o].push(0);this.mel_filters=s,this.window=window_function(400,"povey",{periodic:!1})}_extract_fbank_features(e,t){return e=e.map(s=>s*32768),spectrogram(e,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:t,transpose:!0})}async _call(e,{padding:t=!0,pad_to_multiple_of:s=2,do_normalize_per_mel_bins:o=!0,return_attention_mask:u=!0}={}){validate_audio_inputs(e,"SeamlessM4TFeatureExtractor");let l=this._extract_fbank_features(e,this.config.max_length);if(o){const[p,_]=l.dims;for(let y=0;y<_;++y){let v=0;for(let P=0;P<p;++P)v+=l.data[P*_+y];const T=v/p;let w=0;for(let P=0;P<p;++P)w+=(l.data[P*_+y]-T)**2;w/=p-1;const E=Math.sqrt(w+1e-7);for(let P=0;P<p;++P){const R=P*_+y;l.data[R]=(l.data[R]-T)/E}}}let m;if(t){const[p,_]=l.dims,y=p%s;if(y>0){const v=new Float32Array(_*(p+y));v.set(l.data),v.fill(this.config.padding_value,l.data.length);const T=p+y;l={data:v,dims:[T,_]},u&&(m=new Tensor("int64",new BigInt64Array(T),[1,T]),m.data.fill(1n,0,p))}}const[g,h]=l.dims,f=this.config.stride;if(g%f!==0)throw new Error(`The number of frames (${g}) must be a multiple of the stride (${f}).`);const r=new Tensor("float32",l.data,l.dims).view(1,Math.floor(g/f),h*f),d={input_features:r};if(u){const p=r.dims[1],_=new Tensor("int64",new BigInt64Array(p),[1,p]);if(m)for(let y=1,v=0;y<g;y+=f,++v)_.data[v]=m.data[y];else _.data.fill(1n);d.attention_mask=_}return d}}class ASTFeatureExtractor extends FeatureExtractor{constructor(e){super(e);const t=this.config.sampling_rate,s=mel_filter_bank(256,this.config.num_mel_bins,20,Math.floor(t/2),t,null,"kaldi",!0);for(let o=0;o<s.length;++o)s[o].push(0);this.mel_filters=s,this.window=window_function(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}_extract_fbank_features(e,t){return spectrogram(e,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:t,transpose:!0})}async _call(e){validate_audio_inputs(e,"ASTFeatureExtractor");const t=this._extract_fbank_features(e,this.config.max_length);if(this.config.do_normalize){const s=this.std*2;for(let o=0;o<t.data.length;++o)t.data[o]=(t.data[o]-this.mean)/s}return{input_values:new Tensor("float32",t.data,[1,...t.dims])}}}class ClapFeatureExtractor extends FeatureExtractor{constructor(e){super(e),this.mel_filters=mel_filter_bank(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=mel_filter_bank(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=window_function(this.config.fft_window_size,"hann")}_get_input_mel(e,t,s,o){let u,l=!1;const m=e.length-t;if(m>0)if(s==="rand_trunc"){l=!0;const g=Math.floor(Math.random()*(m+1));e=e.subarray(g,g+t),u=this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples),u.dims=[1,...u.dims]}else throw new Error(`Truncation strategy "${s}" not implemented`);else{if(m<0){let g=new Float64Array(t);if(g.set(e),o==="repeat")for(let h=e.length;h<t;h+=e.length)g.set(e.subarray(0,Math.min(e.length,t-h)),h);else if(o==="repeatpad")for(let h=e.length;h<-m;h+=e.length)g.set(e,h);e=g}if(s==="fusion")throw new Error(`Truncation strategy "${s}" not implemented`);u=this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples),u.dims=[1,...u.dims]}return{...u,longer:l}}_extract_fbank_features(e,t,s=null){return spectrogram(e,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:t,log_mel:"dB",max_num_frames:s,do_pad:!1,transpose:!0})}async _call(e,{max_length:t=null}={}){validate_audio_inputs(e,"ClapFeatureExtractor");const s=this._get_input_mel(e,t??this.config.nb_max_samples,this.config.truncation,this.config.padding);return{input_features:new Tensor("float32",s.data,[1,...s.dims])}}}class SpeechT5FeatureExtractor extends FeatureExtractor{}class Processor extends Callable{constructor(e){super(),this.feature_extractor=e}async _call(e,...t){return await this.feature_extractor(e,...t)}}class SamProcessor extends Processor{async _call(...e){return await this.feature_extractor(...e)}post_process_masks(...e){return this.feature_extractor.post_process_masks(...e)}reshape_input_points(...e){return this.feature_extractor.reshape_input_points(...e)}}class WhisperProcessor extends Processor{async _call(e){return await this.feature_extractor(e)}}class Wav2Vec2ProcessorWithLM extends Processor{async _call(e){return await this.feature_extractor(e)}}class SpeechT5Processor extends Processor{async _call(e){return await this.feature_extractor(e)}}class OwlViTProcessor extends Processor{}class AutoProcessor{static FEATURE_EXTRACTOR_CLASS_MAPPING={ImageFeatureExtractor,WhisperFeatureExtractor,ViTFeatureExtractor,MobileViTFeatureExtractor,MobileViTImageProcessor,OwlViTFeatureExtractor,Owlv2ImageProcessor,CLIPFeatureExtractor,ChineseCLIPFeatureExtractor,SiglipImageProcessor,ConvNextFeatureExtractor,ConvNextImageProcessor,SegformerFeatureExtractor,BitImageProcessor,DPTImageProcessor,DPTFeatureExtractor,GLPNFeatureExtractor,BeitFeatureExtractor,DeiTFeatureExtractor,DetrFeatureExtractor,YolosFeatureExtractor,DonutFeatureExtractor,NougatImageProcessor,EfficientNetImageProcessor,ViTImageProcessor,VitMatteImageProcessor,SamImageProcessor,Swin2SRImageProcessor,Wav2Vec2FeatureExtractor,SeamlessM4TFeatureExtractor,SpeechT5FeatureExtractor,ASTFeatureExtractor,ClapFeatureExtractor};static PROCESSOR_CLASS_MAPPING={WhisperProcessor,Wav2Vec2ProcessorWithLM,SamProcessor,SpeechT5Processor,OwlViTProcessor};static async from_pretrained(e,{progress_callback:t=null,config:s=null,cache_dir:o=null,local_files_only:u=!1,revision:l="main"}={}){let m=s??await getModelJSON(e,"preprocessor_config.json",!0,{progress_callback:t,cache_dir:o,local_files_only:u,revision:l}),g=m.feature_extractor_type??m.image_processor_type,h=this.FEATURE_EXTRACTOR_CLASS_MAPPING[g];if(!h)if(m.size!==void 0)console.warn(`Feature extractor type "${g}" not found, assuming ImageFeatureExtractor due to size parameter in config.`),h=ImageFeatureExtractor;else throw new Error(`Unknown Feature Extractor type: ${g}`);let f=this.PROCESSOR_CLASS_MAPPING[m.processor_class]??Processor,i=new h(m);return new f(i)}}async function prepareImages(n){return Array.isArray(n)||(n=[n]),await Promise.all(n.map(e=>RawImage.read(e)))}async function prepareAudios(n,e){return Array.isArray(n)||(n=[n]),await Promise.all(n.map(t=>typeof t=="string"||t instanceof URL?read_audio(t,e):t instanceof Float64Array?new Float32Array(t):t))}function get_bounding_box(n,e){e&&(n=n.map(l=>l|0));const[t,s,o,u]=n;return{xmin:t,ymin:s,xmax:o,ymax:u}}class Pipeline extends Callable{constructor({task:e,model:t,tokenizer:s=null,processor:o=null}){super(),this.task=e,this.model=t,this.tokenizer=s,this.processor=o}async dispose(){await this.model.dispose()}}class TextClassificationPipeline extends Pipeline{constructor(e){super(e)}async _call(e,{topk:t=1}={}){const s=this.tokenizer(e,{padding:!0,truncation:!0}),o=await this.model(s),u=this.model.config.problem_type==="multi_label_classification"?g=>g.sigmoid().data:g=>softmax(g.data),l=this.model.config.id2label,m=[];for(const g of o.logits){const h=u(g),i=getTopItems(h,t).map(r=>({label:l[r[0]],score:r[1]}));t===1?m.push(...i):m.push(i)}return Array.isArray(e)||t===1?m:m[0]}}class TokenClassificationPipeline extends Pipeline{constructor(e){super(e)}async _call(e,{ignore_labels:t=["O"]}={}){const s=Array.isArray(e),o=this.tokenizer(s?e:[e],{padding:!0,truncation:!0}),l=(await this.model(o)).logits,m=this.model.config.id2label,g=[];for(let h=0;h<l.dims[0];++h){const f=o.input_ids[h],i=l[h],r=[];for(let d=0;d<i.dims[0];++d){const p=i[d],_=max(p.data)[1],y=m?m[_]:`LABEL_${_}`;if(t.includes(y))continue;const v=this.tokenizer.decode([f[d].item()],{skip_special_tokens:!0});if(v==="")continue;const T=softmax(p.data);r.push({entity:y,score:T[_],index:d,word:v,start:null,end:null})}g.push(r)}return s?g:g[0]}}class QuestionAnsweringPipeline extends Pipeline{constructor(e){super(e)}async _call(e,t,{topk:s=1}={}){const o=this.tokenizer(e,{text_pair:t,padding:!0,truncation:!0}),u=await this.model(o),l=[];for(let m=0;m<u.start_logits.dims[0];++m){const g=o.input_ids[m],h=g.indexOf(this.tokenizer.sep_token_id),f=Array.from(softmax(u.start_logits[m].data)).map((d,p)=>[d,p]).filter(d=>d[1]>h),i=Array.from(softmax(u.end_logits[m].data)).map((d,p)=>[d,p]).filter(d=>d[1]>h),r=product(f,i).filter(d=>d[0][1]<=d[1][1]).map(d=>[d[0][1],d[1][1],d[0][0]*d[1][0]]).sort((d,p)=>p[2]-d[2]);for(let d=0;d<Math.min(r.length,s);++d){const[p,_,y]=r[d],v=[...g].slice(p,_+1),T=this.tokenizer.decode(v,{skip_special_tokens:!0});l.push({answer:T,score:y})}}return s===1?l[0]:l}}class FillMaskPipeline extends Pipeline{constructor(e){super(e)}async _call(e,{topk:t=5}={}){const s=this.tokenizer(e,{padding:!0,truncation:!0}),o=await this.model(s),u=[];for(let l=0;l<s.input_ids.dims[0];++l){const m=s.input_ids[l],g=m.indexOf(this.tokenizer.mask_token_id);if(g===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);const f=o.logits[l][g],i=getTopItems(softmax(f.data),t);u.push(i.map(r=>{const d=[...m];return d[g]=r[0],{score:r[1],token:r[0],token_str:this.tokenizer.model.vocab[r[0]],sequence:this.tokenizer.decode(d,{skip_special_tokens:!0})}}))}return Array.isArray(e)?u:u[0]}}class Text2TextGenerationPipeline extends Pipeline{_key="generated_text";constructor(e){super(e)}async _call(e,t={}){Array.isArray(e)||(e=[e]),this.model.config.prefix&&(e=e.map(g=>this.model.config.prefix+g));const s=this.model.config.task_specific_params;s&&s[this.task]&&s[this.task].prefix&&(e=e.map(g=>s[this.task].prefix+g));const o=this.tokenizer,u={padding:!0,truncation:!0};let l;this instanceof TranslationPipeline&&"_build_translation_inputs"in o?l=o._build_translation_inputs(e,u,t).input_ids:l=o(e,u).input_ids;const m=await this.model.generate(l,t);return o.batch_decode(m,{skip_special_tokens:!0}).map(g=>({[this._key]:g}))}}class SummarizationPipeline extends Text2TextGenerationPipeline{_key="summary_text";constructor(e){super(e)}}class TranslationPipeline extends Text2TextGenerationPipeline{_key="translation_text";constructor(e){super(e)}}function isChat(n){return Array.isArray(n)&&n.every(e=>"role"in e&&"content"in e)}class TextGenerationPipeline extends Pipeline{constructor(e){super(e)}async _call(e,t={}){let s=!1,o=!1,u;if(typeof e=="string")u=e=[e];else if(Array.isArray(e)&&e.every(p=>typeof p=="string"))s=!0,u=e;else{if(isChat(e))e=[e];else if(Array.isArray(e)&&e.every(isChat))s=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");o=!0,u=e.map(p=>this.tokenizer.apply_chat_template(p,{tokenize:!1,add_generation_prompt:!0}))}const l=t.add_special_tokens??!1,m=o?!1:t.return_full_text??!0;this.tokenizer.padding_side="left";const{input_ids:g,attention_mask:h}=this.tokenizer(u,{add_special_tokens:l,padding:!0,truncation:!0}),f=await this.model.generate(g,t,null,{inputs_attention_mask:h});let i=this.tokenizer.batch_decode(f,{skip_special_tokens:!0}),r;!m&&g.dims.at(-1)>0&&(r=this.tokenizer.batch_decode(g,{skip_special_tokens:!0}).map(p=>p.length));const d=Array.from({length:e.length},p=>[]);for(let p=0;p<i.length;++p){const _=Math.floor(p/f.length*e.length);r&&(i[p]=i[p].slice(r[_])),d[_].push({generated_text:o?[...e[_],{role:"assistant",content:i[p]}]:i[p]})}return!s&&d.length===1?d[0]:d}}class ZeroShotClassificationPipeline extends Pipeline{constructor(e){super(e),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([t,s])=>[t.toLowerCase(),s])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(e,t,{hypothesis_template:s="This example is {}.",multi_label:o=!1}={}){const u=Array.isArray(e);u||(e=[e]),Array.isArray(t)||(t=[t]);const l=t.map(h=>s.replace("{}",h)),m=o||t.length===1,g=[];for(const h of e){const f=[];for(const d of l){const p=this.tokenizer(h,{text_pair:d,padding:!0,truncation:!0}),_=await this.model(p);m?f.push([_.logits.data[this.contradiction_id],_.logits.data[this.entailment_id]]):f.push(_.logits.data[this.entailment_id])}const r=(m?f.map(d=>softmax(d)[1]):softmax(f)).map((d,p)=>[d,p]).sort((d,p)=>p[0]-d[0]);g.push({sequence:h,labels:r.map(d=>t[d[1]]),scores:r.map(d=>d[0])})}return u?g:g[0]}}class FeatureExtractionPipeline extends Pipeline{constructor(e){super(e)}async _call(e,{pooling:t="none",normalize:s=!1,quantize:o=!1,precision:u="binary"}={}){const l=this.tokenizer(e,{padding:!0,truncation:!0}),m=await this.model(l);let g=m.last_hidden_state??m.logits??m.token_embeddings;if(t!=="none")if(t==="mean")g=mean_pooling(g,l.attention_mask);else if(t==="cls")g=g.slice(null,0);else throw Error(`Pooling method '${t}' not supported.`);return s&&(g=g.normalize(2,-1)),o&&(g=quantize_embeddings(g,u)),g}}class ImageFeatureExtractionPipeline extends Pipeline{constructor(e){super(e)}async _call(e,{pool:t=null}={}){const s=await prepareImages(e),{pixel_values:o}=await this.processor(s),u=await this.model({pixel_values:o});let l;if(t){if(!("pooler_output"in u))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");l=u.pooler_output}else l=u.last_hidden_state??u.logits??u.image_embeds;return l}}class AudioClassificationPipeline extends Pipeline{constructor(e){super(e)}async _call(e,{topk:t=null}={}){const s=!Array.isArray(e),o=this.processor.feature_extractor.config.sampling_rate,u=await prepareAudios(e,o),l=this.model.config.id2label,m=[];for(const g of u){const h=await this.processor(g),i=(await this.model(h)).logits[0],d=getTopItems(softmax(i.data),t).map(p=>({label:l[p[0]],score:p[1]}));t===1?m.push(...d):m.push(d)}return!s||t===1?m:m[0]}}class ZeroShotAudioClassificationPipeline extends Pipeline{constructor(e){super(e)}async _call(e,t,{hypothesis_template:s="This is a sound of {}."}={}){const o=!Array.isArray(e);o&&(e=[e]);const u=t.map(f=>s.replace("{}",f)),l=this.tokenizer(u,{padding:!0,truncation:!0}),m=this.processor.feature_extractor.config.sampling_rate,g=await prepareAudios(e,m),h=[];for(const f of g){const i=await this.processor(f),r=await this.model({...l,...i}),d=softmax(r.logits_per_audio.data);h.push([...d].map((p,_)=>({score:p,label:t[_]})))}return o?h[0]:h}}class AutomaticSpeechRecognitionPipeline extends Pipeline{constructor(e){super(e)}async _call(e,t={}){switch(this.model.config.model_type){case"whisper":return this._call_whisper(e,t);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(e,t);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(e,t={}){t.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),t.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');const s=!Array.isArray(e);s&&(e=[e]);const o=this.processor.feature_extractor.config.sampling_rate,u=await prepareAudios(e,o),l=[];for(const m of u){const g=await this.processor(m),f=(await this.model(g)).logits[0],i=[];for(const d of f)i.push(max(d.data)[1]);const r=this.tokenizer.decode(i);l.push({text:r})}return s?l[0]:l}async _call_whisper(e,t={}){const s=t.return_timestamps??!1,o=t.chunk_length_s??0,u=t.chunk_callback??null,l=t.force_full_sequences??!1;let m=t.stride_length_s??null;s==="word"&&(t.return_token_timestamps=!0);const g=pop(t,"language",null),h=pop(t,"task",null);if(g||h||s){if(t.forced_decoder_ids)throw new Error("Cannot specify `language`/`task`/`return_timestamps` and `forced_decoder_ids` at the same time.");const y=this.tokenizer.get_decoder_prompt_ids({language:g,task:h,no_timestamps:!s});y.length>0&&(t.forced_decoder_ids=y)}const f=!Array.isArray(e);f&&(e=[e]);const i=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,r=this.processor.feature_extractor.config.hop_length,d=this.processor.feature_extractor.config.sampling_rate,p=await prepareAudios(e,d),_=[];for(const y of p){let v=[];if(o>0){if(m===null)m=o/6;else if(o<=m)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");const E=d*o,P=d*m,R=E-2*P;let I=0;for(;I<y.length;){const N=y.subarray(I,I+E),B=await this.processor(N),D=I===0,Y=I+R>=y.length;v.push({stride:[N.length,D?0:P,Y?0:P],input_features:B.input_features,is_last:Y}),I+=R}}else v=[{stride:[y.length,0,0],input_features:(await this.processor(y)).input_features,is_last:!0}];for(const E of v){t.num_frames=Math.floor(E.stride[0]/r);const P=await this.model.generate(E.input_features,t);s==="word"?(E.tokens=P.sequences[0],E.token_timestamps=P.token_timestamps.tolist()[0].map(R=>round(R,2))):E.tokens=P[0],E.stride=E.stride.map(R=>R/d),u!==null&&u(E)}const[T,w]=this.tokenizer._decode_asr(v,{time_precision:i,return_timestamps:s,force_full_sequences:l});_.push({text:T,...w})}return f?_[0]:_}}class ImageToTextPipeline extends Pipeline{constructor(e){super(e)}async _call(e,t={}){const s=Array.isArray(e),o=await prepareImages(e),{pixel_values:u}=await this.processor(o),l=[];for(const m of u){m.dims=[1,...m.dims];const g=await this.model.generate(m,t),h=this.tokenizer.batch_decode(g,{skip_special_tokens:!0}).map(f=>({generated_text:f.trim()}));l.push(h)}return s?l:l[0]}}class ImageClassificationPipeline extends Pipeline{constructor(e){super(e)}async _call(e,{topk:t=1}={}){const s=Array.isArray(e),o=await prepareImages(e),{pixel_values:u}=await this.processor(o),l=await this.model({pixel_values:u}),m=this.model.config.id2label,g=[];for(const h of l.logits){const i=getTopItems(softmax(h.data),t).map(r=>({label:m[r[0]],score:r[1]}));t===1?g.push(...i):g.push(i)}return s||t===1?g:g[0]}}class ImageSegmentationPipeline extends Pipeline{constructor(e){super(e),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(e,{threshold:t=.5,mask_threshold:s=.5,overlap_mask_area_threshold:o=.8,label_ids_to_fuse:u=null,target_sizes:l=null,subtask:m=null}={}){if(Array.isArray(e)&&e.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");const h=await prepareImages(e),f=h.map(v=>[v.height,v.width]),{pixel_values:i,pixel_mask:r}=await this.processor(h),d=await this.model({pixel_values:i,pixel_mask:r});let p=null;if(m!==null)p=this.subtasks_mapping[m];else for(let[v,T]of Object.entries(this.subtasks_mapping))if(T in this.processor.feature_extractor){p=this.processor.feature_extractor[T].bind(this.processor.feature_extractor),m=v;break}const _=this.model.config.id2label,y=[];if(m==="panoptic"||m==="instance"){const v=p(d,t,s,o,u,l??f)[0],T=v.segmentation;for(const w of v.segments_info){const E=new Uint8ClampedArray(T.data.length);for(let R=0;R<T.data.length;++R)T.data[R]===w.id&&(E[R]=255);const P=new RawImage(E,T.dims[1],T.dims[0],1);y.push({score:w.score,label:_[w.label_id],mask:P})}}else if(m==="semantic"){const{segmentation:v,labels:T}=p(d,l??f)[0];for(const w of T){const E=new Uint8ClampedArray(v.data.length);for(let R=0;R<v.data.length;++R)v.data[R]===w&&(E[R]=255);const P=new RawImage(E,v.dims[1],v.dims[0],1);y.push({score:null,label:_[w],mask:P})}}else throw Error(`Subtask ${m} not supported.`);return y}}class ZeroShotImageClassificationPipeline extends Pipeline{constructor(e){super(e)}async _call(e,t,{hypothesis_template:s="This is a photo of {}"}={}){const o=Array.isArray(e),u=await prepareImages(e),l=t.map(r=>s.replace("{}",r)),m=this.tokenizer(l,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:g}=await this.processor(u),h=await this.model({...m,pixel_values:g}),f=this.model.config.model_type==="siglip"?r=>r.sigmoid().data:r=>softmax(r.data),i=[];for(const r of h.logits_per_image){const p=[...f(r)].map((_,y)=>({score:_,label:t[y]}));p.sort((_,y)=>y.score-_.score),i.push(p)}return o?i:i[0]}}class ObjectDetectionPipeline extends Pipeline{constructor(e){super(e)}async _call(e,{threshold:t=.9,percentage:s=!1}={}){const o=Array.isArray(e);if(o&&e.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");const u=await prepareImages(e),l=s?null:u.map(d=>[d.height,d.width]),{pixel_values:m,pixel_mask:g}=await this.processor(u),h=await this.model({pixel_values:m,pixel_mask:g}),f=this.processor.feature_extractor.post_process_object_detection(h,t,l),i=this.model.config.id2label,r=f.map(d=>d.boxes.map((p,_)=>({score:d.scores[_],label:i[d.classes[_]],box:get_bounding_box(p,!s)})));return o?r:r[0]}}class ZeroShotObjectDetectionPipeline extends Pipeline{constructor(e){super(e)}async _call(e,t,{threshold:s=.1,topk:o=null,percentage:u=!1}={}){const l=Array.isArray(e),m=await prepareImages(e),g=this.tokenizer(t,{padding:!0,truncation:!0}),h=await this.processor(m),f=[];for(let i=0;i<m.length;++i){const r=m[i],d=u?null:[[r.height,r.width]],p=h.pixel_values[i].unsqueeze_(0),_=await this.model({...g,pixel_values:p}),y=this.processor.feature_extractor.post_process_object_detection(_,s,d,!0)[0];let v=y.boxes.map((T,w)=>({score:y.scores[w],label:t[y.classes[w]],box:get_bounding_box(T,!u)})).sort((T,w)=>w.score-T.score);o!==null&&(v=v.slice(0,o)),f.push(v)}return l?f:f[0]}}class DocumentQuestionAnsweringPipeline extends Pipeline{constructor(e){super(e)}async _call(e,t,s={}){const o=(await prepareImages(e))[0],{pixel_values:u}=await this.processor(o),l=`<s_docvqa><s_question>${t}</s_question><s_answer>`,m=this.tokenizer(l,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,g=await this.model.generate(u,{...s,decoder_input_ids:m,max_length:this.model.config.decoder.max_position_embeddings}),f=this.tokenizer.batch_decode(g)[0].match(/<s_answer>(.*?)<\/s_answer>/);let i=null;return f&&f.length>=2&&(i=f[1].trim()),[{answer:i}]}}class TextToAudioPipeline extends Pipeline{DEFAULT_VOCODER_ID="Xenova/speecht5_hifigan";constructor(e){super(e),this.vocoder=e.vocoder??null}async _call(e,{speaker_embeddings:t=null}={}){return this.processor?this._call_text_to_spectrogram(e,{speaker_embeddings:t}):this._call_text_to_waveform(e)}async _call_text_to_waveform(e){const t=this.tokenizer(e,{padding:!0,truncation:!0}),{waveform:s}=await this.model(t),o=this.model.config.sampling_rate;return{audio:s.data,sampling_rate:o}}async _call_text_to_spectrogram(e,{speaker_embeddings:t}){if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{quantized:!1})),(typeof t=="string"||t instanceof URL)&&(t=new Float32Array(await(await fetch(t)).arrayBuffer())),t instanceof Float32Array)t=new Tensor("float32",t,[1,t.length]);else if(!(t instanceof Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");const{input_ids:s}=this.tokenizer(e,{padding:!0,truncation:!0}),{waveform:o}=await this.model.generate_speech(s,t,{vocoder:this.vocoder}),u=this.processor.feature_extractor.config.sampling_rate;return{audio:o.data,sampling_rate:u}}}class ImageToImagePipeline extends Pipeline{constructor(e){super(e)}async _call(e){const t=await prepareImages(e),s=await this.processor(t),o=await this.model(s),u=[];for(const l of o.reconstruction){const m=l.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");u.push(RawImage.fromTensor(m))}return u.length>1?u:u[0]}}class DepthEstimationPipeline extends Pipeline{constructor(e){super(e)}async _call(e){const t=await prepareImages(e),s=await this.processor(t),{predicted_depth:o}=await this.model(s),u=[];for(let l=0;l<t.length;++l){const m=interpolate(o[l],t[l].size.reverse(),"bilinear",!1),g=m.mul_(255/max(m.data)[0]).to("uint8");u.push({predicted_depth:o[l],depth:RawImage.fromTensor(g)})}return u.length>1?u:u[0]}}const SUPPORTED_TASKS=Object.freeze({"text-classification":{tokenizer:AutoTokenizer,pipeline:TextClassificationPipeline,model:AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:AutoTokenizer,pipeline:TokenClassificationPipeline,model:AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:AutoTokenizer,pipeline:QuestionAnsweringPipeline,model:AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:AutoTokenizer,pipeline:FillMaskPipeline,model:AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:AutoTokenizer,pipeline:SummarizationPipeline,model:AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:AutoTokenizer,pipeline:TranslationPipeline,model:AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:AutoTokenizer,pipeline:Text2TextGenerationPipeline,model:AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:AutoTokenizer,pipeline:TextGenerationPipeline,model:AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:AutoTokenizer,pipeline:ZeroShotClassificationPipeline,model:AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:AudioClassificationPipeline,model:AutoModelForAudioClassification,processor:AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:AutoTokenizer,pipeline:ZeroShotAudioClassificationPipeline,model:AutoModel,processor:AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:AutoTokenizer,pipeline:AutomaticSpeechRecognitionPipeline,model:[AutoModelForSpeechSeq2Seq,AutoModelForCTC],processor:AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:AutoTokenizer,pipeline:TextToAudioPipeline,model:[AutoModelForTextToWaveform,AutoModelForTextToSpectrogram],processor:[AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:AutoTokenizer,pipeline:ImageToTextPipeline,model:AutoModelForVision2Seq,processor:AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:ImageClassificationPipeline,model:AutoModelForImageClassification,processor:AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:ImageSegmentationPipeline,model:[AutoModelForImageSegmentation,AutoModelForSemanticSegmentation],processor:AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"zero-shot-image-classification":{tokenizer:AutoTokenizer,pipeline:ZeroShotImageClassificationPipeline,model:AutoModel,processor:AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:ObjectDetectionPipeline,model:AutoModelForObjectDetection,processor:AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:AutoTokenizer,pipeline:ZeroShotObjectDetectionPipeline,model:AutoModelForZeroShotObjectDetection,processor:AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:AutoTokenizer,pipeline:DocumentQuestionAnsweringPipeline,model:AutoModelForDocumentQuestionAnswering,processor:AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:ImageToImagePipeline,model:AutoModelForImageToImage,processor:AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:DepthEstimationPipeline,model:AutoModelForDepthEstimation,processor:AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:AutoTokenizer,pipeline:FeatureExtractionPipeline,model:AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:AutoProcessor,pipeline:ImageFeatureExtractionPipeline,model:[AutoModelForImageFeatureExtraction,AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),TASK_ALIASES=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function pipeline(n,e=null,{quantized:t=!0,progress_callback:s=null,config:o=null,cache_dir:u=null,local_files_only:l=!1,revision:m="main",model_file_name:g=null}={}){n=TASK_ALIASES[n]??n;const h=SUPPORTED_TASKS[n.split("_",1)[0]];if(!h)throw Error(`Unsupported pipeline: ${n}. Must be one of [${Object.keys(SUPPORTED_TASKS)}]`);e||(e=h.default.model,console.log(`No model specified. Using default model: "${e}".`));const f={quantized:t,progress_callback:s,config:o,cache_dir:u,local_files_only:l,revision:m,model_file_name:g},i=new Map([["tokenizer",h.tokenizer],["model",h.model],["processor",h.processor]]),r=await loadItems(i,e,f);r.task=n,dispatchCallback(s,{status:"ready",task:n,model:e});const d=h.pipeline;return new d(r)}async function loadItems(n,e,t){const s=Object.create(null),o=[];for(let[u,l]of n.entries()){if(!l)continue;let m;Array.isArray(l)?m=new Promise(async(g,h)=>{let f;for(let i of l){if(i===null){g(null);return}try{g(await i.from_pretrained(e,t));return}catch(r){f=r}}h(f)}):m=l.from_pretrained(e,t),s[u]=m,o.push(m)}await Promise.all(o);for(let[u,l]of Object.entries(s))s[u]=await l;return s}__webpack_exports__GlobalWorkerOptions.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.0.379/build/pdf.worker.min.mjs";env$1.allowLocalModels=!1;env$1.useBrowserCache=!0;let extractionPipeline=null;const MODEL_NAME="Xenova/LaMini-Flan-T5-248M",preprocessImage=n=>new Promise((e,t)=>{const s=new Image;s.src=`data:image/png;base64,${n}`,s.onload=()=>{const o=document.createElement("canvas");o.width=s.width,o.height=s.height;const u=o.getContext("2d");if(!u){e(n);return}u.drawImage(s,0,0);const l=u.getImageData(0,0,o.width,o.height),m=l.data;for(let g=0;g<m.length;g+=4){const h=m[g],f=m[g+1],i=m[g+2],d=.2126*h+.7152*f+.0722*i>160?255:m[g];m[g]=d,m[g+1]=d,m[g+2]=d}u.putImageData(l,0,0),e(o.toDataURL("image/png").split(",")[1])},s.onerror=o=>t(o)}),convertPdfToImage=async n=>{try{const e=atob(n),t=e.length,s=new Uint8Array(t);for(let i=0;i<t;i++)s[i]=e.charCodeAt(i);const l=await(await __webpack_exports__getDocument({data:s}).promise).getPage(1),g=l.getViewport({scale:2}),h=document.createElement("canvas"),f=h.getContext("2d");if(h.height=g.height,h.width=g.width,!f)throw new Error("Canvas context missing");return await l.render({canvasContext:f,viewport:g}).promise,h.toDataURL("image/png").split(",")[1]}catch(e){throw console.error("PDF Conversion Failed",e),new Error("Failed to render PDF for OCR.")}},performOCR=async(n,e="image/png")=>{console.log(`Starting Local OCR on ${e}...`);try{const t=await Tesseract.createWorker("eng",1,{logger:o=>console.log(`OCR Progress: ${o.status} (${(o.progress*100).toFixed(0)}%)`)});await t.setParameters({tessedit_pageseg_mode:"6",preserve_interword_spaces:"1"});const{data:s}=await t.recognize(`data:${e};base64,${n}`);return await t.terminate(),s}catch(t){throw console.error("Tesseract Error:",t),t}},reconstructSpatialText=n=>{let e="",t=0,s=0;n.words.forEach(u=>{t+=u.bbox.x1-u.bbox.x0,s+=u.text.length});const o=s>0?t/s:10;return n.lines.forEach(u=>{let l="",m=u.bbox.x0;u.words.forEach(g=>{const h=g.bbox.x0-m,f=Math.max(1,Math.floor(h/o));h>o*2?l+=" ".repeat(f):l.length>0&&(l+=" "),l+=g.text,m=g.bbox.x1}),e+=l+`
`}),e},splitPartNo=n=>{const e=n.indexOf(" ");if(e===-1)return{partNo:"",desc:n};const t=n.substring(0,e);return(/\d/.test(t)||t.includes("-")||/^[A-Z0-9]+$/.test(t))&&t.length>2&&!["THE","ITEM","DESC","BILL","SHIP"].includes(t.toUpperCase())?{partNo:t,desc:n.substring(e).trim()}:{partNo:"",desc:n}},parseDetailedLineItems=n=>{const e=[],t=n.split(`
`);let s=1;const o=/^(.*?)\s+([$\d,]+\.\d{2})\s+([\d\.]+%?)\s+([$\d,]+\.\d{2})\s+(\d+)\s+([$\d,]+\.\d{2})$/,u=/^(.*?)\s+([$\d,]+\.\d{2})?\s+(\d+)\s+([a-zA-Z]{1,4})?\s*([$\d,]+\.\d{2})$/;for(const l of t){const m=l.trim();if(m.length<10||/page\s+\d/i.test(m)||/subtotal|tax|vat|total amount|amount due/i.test(m))continue;let g=m.match(o);if(g){const[h,f,i,r,d,p,_]=g,{partNo:y,desc:v}=splitPartNo(f.trim());e.push({LineItem:String(s++),VendorItemNumber:y||"",ItemDescription:v,QuantityOrdered:parseInt(p),UnitOfMeasure:"EACH",CostEach:parseFloat(i.replace(/,/g,"")),CostExtended:parseFloat(_.replace(/,/g,"")),Discount:r});continue}if(g=m.match(u),g){const[h,f,i,r,d,p]=g;if(f.trim().length>3){const{partNo:_,desc:y}=splitPartNo(f.trim());e.push({LineItem:String(s++),VendorItemNumber:_||"",ItemDescription:y,QuantityOrdered:parseInt(r),UnitOfMeasure:d||"EACH",CostEach:i?parseFloat(i.replace(/,/g,"")):0,CostExtended:p?parseFloat(p.replace(/,/g,"")):0})}}}return e},transformersLlmExtractHeaders=async(n,e)=>{extractionPipeline||(console.log(`Loading ${MODEL_NAME}...`),extractionPipeline=await pipeline("text2text-generation",MODEL_NAME));const t=n.substring(0,1e3),o=`Extract these details from the invoice: ${e.schema.map(h=>h.name).join(", ")}.
    
    Text:
    ${t}
    
    Return strict JSON format like {"po_number": "...", "date": "..."}.`;console.log("Running In-Browser LLM for Headers...");const l=(await extractionPipeline(o,{max_new_tokens:150,temperature:.1,do_sample:!1}))[0]?.generated_text||"{}",m=l.indexOf("{"),g=l.lastIndexOf("}");if(m!==-1&&g!==-1)try{return JSON.parse(l.substring(m,g+1))}catch(h){console.warn("LLM JSON Parse Error",h)}return null},ALIAS_MAP={po_number:["PO Number","Purchase Order","Order No","PO #","P.O.","Order Number","Reference No"],customer_name:["Customer","Bill To","Sold To","Client","Billed To"],total_amount:["Total","Grand Total","Total Amount","Amount Due","Balance","Total Incl"],order_date:["Date","Order Date","Invoice Date","Dated","Issue Date"],delivery_address:["Ship To","Delivery Address","Shipping Address","Destination","Consignee"]},regexExtractHeaders=(n,e)=>{const t={};return e.forEach(s=>{const o=ALIAS_MAP[s.name]||[s.name,s.name.replace(/_/g," ")];for(const u of o){const l=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),m=new RegExp(`${l}[:\\s\\-\\.]*([^\\n]+)`,"i"),g=n.match(m);if(g&&g[1]){let h=g[1].trim();if(s.type==="number"){const f=h.match(/[\d,]+\.?\d*/);if(f){const i=parseFloat(f[0].replace(/,/g,""));if(!isNaN(i)){t[s.name]=i;break}}}else if(h=h.replace(/^[:\.\-]\s*/,""),h.length>0){t[s.name]=h;break}}}}),t},extractLocally=async(n,e,t)=>{let s="",o="";try{let m=n.file.base64,g=n.file.type;g==="application/pdf"&&(console.log("Converting PDF to Image..."),m=await convertPdfToImage(n.file.base64),g="image/png");const h=await preprocessImage(m),f=await performOCR(h,g);s=reconstructSpatialText(f),o=f.text}catch(m){return console.error("OCR Pipeline Failed",m),{mappedData:{},lineItems:[],unmappedData:[{key:"error",value:"OCR Failed: "+m.message}],termsAndConditions:"OCR Failed",confidence:{},usageMetadata:{inputTokens:0,outputTokens:0,totalTokens:0,modelName:"Error",estimatedCost:0}}}let u={};if(t)try{const m=await transformersLlmExtractHeaders(s,e);m&&Object.keys(m).length>0?u=m:u=regexExtractHeaders(o,e.schema)}catch{u=regexExtractHeaders(o,e.schema)}else u=regexExtractHeaders(o,e.schema);const l=parseDetailedLineItems(s);return{mappedData:u,lineItems:l,unmappedData:[],termsAndConditions:"",confidence:{},usageMetadata:{inputTokens:0,outputTokens:0,totalTokens:0,modelName:t?"LaMini-Flan-T5 (Local)":"Tesseract (Local)",estimatedCost:0}}};let aiInstance=null;const getAiInstance=async()=>{if(aiInstance)return aiInstance;try{const n=await fetch("/get-gemini-key");if(!n.ok)throw new Error("Failed to fetch API Key from server");const e=await n.json();if(!e.key)throw new Error("API Key is missing in VCAP_SERVICES");return aiInstance=new GoogleGenAI({apiKey:e.key}),aiInstance}catch(n){throw console.error("Gemini Authorization Error",n),new Error("Could not initialize AI Engine. Ensure 'intelligent-document-secrets' service is bound.")}},fileToBase64=n=>new Promise((e,t)=>{const s=new FileReader;s.readAsDataURL(n),s.onload=()=>e(s.result.split(",")[1]),s.onerror=o=>t(o)}),PRICE_INPUT_PER_1M=.075,PRICE_OUTPUT_PER_1M=.3,cleanJsonString=n=>{let e=n.replace(/```json/g,"").replace(/```/g,"").trim();const t=e.indexOf("{"),s=e.lastIndexOf("}");return t!==-1&&s!==-1&&(e=e.substring(t,s+1)),e},evaluateRules=(n,e,t,s)=>!s||s.length===0?[]:s.filter(o=>{if(!o.active)return!1;if(o.condition.operator==="always")return!0;let u=[];if(o.condition.field==="FILENAME"?u=[n.file.name.toLowerCase()]:e&&e[o.condition.field]!==void 0?u=[String(e[o.condition.field]).toLowerCase()]:t&&t.length>0&&(u=t.map(m=>m[o.condition.field]).filter(m=>m!=null).map(m=>String(m).toLowerCase())),u.length===0)return!1;const l=o.condition.value.toLowerCase();return u.some(m=>{switch(o.condition.operator){case"equals":return m===l;case"contains":return m.includes(l);case"starts_with":return m.startsWith(l);default:return!1}})}),buildSchema=n=>{const e={},t={};return n.schema.forEach(s=>{e[s.name]={type:s.type==="number"?Type.NUMBER:Type.STRING,description:s.description},t[s.name]={type:Type.NUMBER,description:`Confidence score (0.0-1.0) for ${s.name}`}}),{type:Type.OBJECT,properties:{mappedData:{type:Type.OBJECT,description:"The Header fields of the Purchase Order / Invoice",properties:e,required:n.schema.map(s=>s.name)},lineItems:{type:Type.ARRAY,description:"List of all line items in the Purchase Order grid",items:{type:Type.OBJECT,properties:{LineItem:{type:Type.STRING,description:"Line number (e.g., 1, 10, 20)"},VendorItemNumber:{type:Type.STRING,description:"Vendor Part Number / Material Number"},ItemDescription:{type:Type.STRING,description:"Description of the item"},QuantityOrdered:{type:Type.NUMBER,description:"Quantity"},UnitOfMeasure:{type:Type.STRING,description:"UOM (e.g. EACH, PC)"},CostEach:{type:Type.NUMBER,description:"Unit Price"},CostExtended:{type:Type.NUMBER,description:"Total Line Amount"},DateRequired:{type:Type.STRING,description:"Delivery Date"},CustomerReference:{type:Type.STRING,description:"Customer Ref / Equp Matr"},SOReference:{type:Type.STRING,description:"Sales Order Reference / SO Line"}}}},unmappedData:{type:Type.ARRAY,description:"Any other important key-value pairs not found in mappedData or lineItems",items:{type:Type.OBJECT,properties:{key:{type:Type.STRING},value:{type:Type.STRING}}}},termsAndConditions:{type:Type.STRING},confidence:{type:Type.OBJECT,properties:t}}}},extractWithGeminiCloud=async(n,e)=>{const t="gemini-2.5-flash",s=buildSchema(e),o=await getAiInstance(),u=`
    You are an intelligent document processing agent specializing in complex Purchase Orders and Sales Orders.
    
    GOAL: Extract data to create a Sales Order in SAP S/4HANA.
    
    1. HEADERS: Extract the specific fields requested in 'mappedData'.
    2. LINE ITEMS: Extract the table of items into 'lineItems'. Pay close attention to:
       - Vendor Item Number (e.g. 6510866, CRECP4N)
       - Descriptions
       - Quantities and Unit Costs
       - Extended Costs (ensure Quantity * Cost = Extended)
    3. EXTRAS: Put any other useful info in 'unmappedData'.
    
    GLOBAL RULES: "${e.naturalLanguageRules}"

    ADDITIONAL CONTEXT (Important):
    ${n.emailContext?`The user provided the following Email/Text Context along with the document. Use this to override standard extraction or clarify details (e.g. Ship To addresses, special instructions): 
"${n.emailContext}"`:"No additional email context provided."}
  `;let l=0,m=0;console.log("Step 1: Performing Base Extraction...");const g=await o.models.generateContent({model:t,contents:[{inlineData:{mimeType:n.file.type,data:n.file.base64}},{text:"Analyze the image/PDF provided and return the JSON response."}],config:{systemInstruction:u,responseMimeType:"application/json",responseSchema:s}}),h=g.text;if(!h)throw new Error("No response text from AI.");let f=JSON.parse(cleanJsonString(h));l+=g.usageMetadata?.promptTokenCount||0,m+=g.usageMetadata?.candidatesTokenCount||0;const i=evaluateRules(n,f.mappedData,f.lineItems||[],e.conditionalRules||[]),r=[];if(i.length>0){console.log(`Step 2: Rules Triggered: ${i.length}. Performing Refinement...`);const y=i.map(E=>`- Condition Met: ${E.name}. Instruction: ${E.instruction}`).join(`
`);r.push(...i.map(E=>E.id));const v=`
            You have already extracted data. However, specific rules apply to this document.
            
            APPLY THESE SPECIFIC RULES AND UPDATE THE JSON:
            ${y}
            
            CRITICAL INSTRUCTIONS:
            1. Return the COMPLETE JSON structure with the updates applied.
            2. DO NOT remove any Line Items. The extracted data has ${f.lineItems?.length||0} line items. Your output MUST contain exactly this number of line items.
            3. Only modify the specific fields mentioned in the rules (e.g., Description, PO Number). Keep all other values identical.
        `,T=await o.models.generateContent({model:t,contents:[{inlineData:{mimeType:n.file.type,data:n.file.base64}},{text:`Current Extraction Data: ${JSON.stringify(f)}. 

 ${v}`}],config:{responseMimeType:"application/json",responseSchema:s}}),w=T.text;w&&(f=JSON.parse(cleanJsonString(w)),l+=T.usageMetadata?.promptTokenCount||0,m+=T.usageMetadata?.candidatesTokenCount||0)}const d=l+m,p=l/1e6*PRICE_INPUT_PER_1M+m/1e6*PRICE_OUTPUT_PER_1M,_={inputTokens:l,outputTokens:m,totalTokens:d,modelName:"Gemini 2.5 Flash (Multi-step)",estimatedCost:p};return{mappedData:f.mappedData||{},lineItems:f.lineItems||[],unmappedData:f.unmappedData||[],termsAndConditions:f.termsAndConditions||"",confidence:f.confidence||{},appliedRuleIds:r,usageMetadata:_}},extractAndMapData=async(n,e)=>{const s=loadSettings().extractionEngine||"gemini-cloud";console.log(`Processing document using engine: ${s}`);try{if(s==="gemini-cloud")return await extractWithGeminiCloud(n,e);if(s==="tesseract-local")return await extractLocally(n,e,!1);if(s==="chrome-device-llm")return await extractLocally(n,e,!0);throw new Error("Unknown extraction engine")}catch(o){return console.error(`Error processing document with ${s}:`,o),{mappedData:{},lineItems:[],unmappedData:[{key:"error",value:`Extraction failed using ${s}`}],termsAndConditions:"Error processing document.",confidence:{},appliedRuleIds:[],usageMetadata:{inputTokens:0,outputTokens:0,totalTokens:0,modelName:s,estimatedCost:0}}}},refineDataWithFeedback=async(n,e,t,s)=>{const o=await getAiInstance(),u=`
      You are an expert AI Document Trainer. 
      Update the extraction based on the user's feedback.
      
      IMPORTANT: 
      1. Only return the fields that need to be updated.
      2. If 'updatedLineItems' are not affected by the feedback, return an empty array [] to save processing time.
      3. Suggest a generalized rule that could automate this in the future.

      User Feedback: "${t}"
    `,l={};s.schema.forEach(g=>{l[g.name]={type:g.type==="number"?Type.NUMBER:Type.STRING,description:g.description,nullable:!0}});const m={type:Type.OBJECT,properties:{updatedMappedData:{type:Type.OBJECT,properties:l,nullable:!0},updatedLineItems:{type:Type.ARRAY,nullable:!0,items:{type:Type.OBJECT,properties:{LineItem:{type:Type.STRING},VendorItemNumber:{type:Type.STRING},ItemDescription:{type:Type.STRING},QuantityOrdered:{type:Type.NUMBER},UnitOfMeasure:{type:Type.STRING},CostEach:{type:Type.NUMBER},CostExtended:{type:Type.NUMBER},DateRequired:{type:Type.STRING},CustomerReference:{type:Type.STRING},SOReference:{type:Type.STRING}}}},updatedUnmappedData:{type:Type.ARRAY,nullable:!0,items:{type:Type.OBJECT,properties:{key:{type:Type.STRING},value:{type:Type.STRING}}}},suggestedRule:{type:Type.STRING}}};try{const h=(await o.models.generateContent({model:"gemini-2.5-flash",contents:[{inlineData:{mimeType:n.file.type,data:n.file.base64}},{text:`Current Data: ${JSON.stringify(e)}. 

User Feedback: ${t}.`}],config:{systemInstruction:u,responseMimeType:"application/json",responseSchema:m}})).text;if(!h)throw new Error("No response from AI");const f=JSON.parse(cleanJsonString(h)),i=f.updatedMappedData?{...e.mappedData,...f.updatedMappedData}:e.mappedData,r=f.updatedLineItems&&f.updatedLineItems.length>0?f.updatedLineItems:e.lineItems,d=f.updatedUnmappedData||e.unmappedData||[];return{updatedMappedData:i,updatedLineItems:r,updatedUnmappedData:d,suggestedRule:f.suggestedRule||"Review extraction logic."}}catch(g){throw console.error("Refinement failed",g),g}},isTechnicalError=(n,e)=>!!(n===404&&e&&e.includes("text/html")||n===500||n===502||n===503||n===504);async function fetchWithRetry(n,e,t,s){const o=new URL(n,window.location.origin).href;console.groupCollapsed(` API Request: ${n}`),console.log(`Full Browser URL: ${o}`),console.log(`Auth Header Present: ${!!s}`);let u=await fetch(n,{method:"GET",headers:{Authorization:s||"",Accept:"application/json"},credentials:"omit"});if(console.log(`Attempt 1 Status: ${u.status}`),u.status===404){let l="",m="";e.endsWith("_SRV")?(l=e.substring(0,e.length-4),m="Removing '_SRV'"):(l=`${e}_SRV`,m="Adding '_SRV'");const g=`${l}${t}`,h=new URL(g,window.location.origin).href;console.warn(`404 detected. ${m} and retrying...`),console.log(`Retry URL: ${h}`);const f=await fetch(g,{method:"GET",headers:{Authorization:s||"",Accept:"application/json"},credentials:"omit"});if(console.log(`Attempt 2 Status: ${f.status}`),f.status!==404||f.ok)return console.groupEnd(),{response:f,finalUrl:h}}return console.groupEnd(),{response:u,finalUrl:o}}const checkERPDuplication=async n=>{if(!n)return{exists:!1};const e=loadSettings();if(e.sapBaseUrl&&e.sapUsername&&e.sapPassword)try{const t=getBasicAuthHeader(e);let s=e.orderServicePath;const o=e.sapBaseUrl?e.sapBaseUrl.replace(/\/$/,""):"";if(e.bypassProxy){if(!s.startsWith("http")){const h=s.startsWith("/")?s:`/${s}`;h.includes("/sap/opu/odata")?s=`${o}${h}`:s=`${o}/sap/opu/odata/sap${h.startsWith("/sap")?h.substring(4):h}`}}else{if(s.startsWith("http"))try{s=new URL(s).pathname}catch{}s.startsWith("/")||(s=`/${s}`),s.startsWith("/sap")||(s=`/sap/opu/odata/sap${s}`)}s.endsWith("/")&&(s=s.slice(0,-1));const u=`/A_SalesOrder?$format=json&$filter=PurchaseOrderByCustomer eq '${n}'&$top=1`,l=`${s}${u}`,{response:m,finalUrl:g}=await fetchWithRetry(l,s,u,t||"");if(m.ok){const h=await m.json(),f=h.d?h.d.results||h.d:h.value||[];if(f.length>0){const i=f[0];return{exists:!0,details:`Sales Order ${i.SalesOrder} already exists for PO ${n}. Created: ${i.CreationDate}`,debugUrl:g}}return{exists:!1,debugUrl:g}}else return{exists:!1,debugUrl:g,details:`Error: ${m.status} ${m.statusText}`}}catch(t){console.warn("ERP Proxy check failed.",t);const o=(t.message==="Failed to fetch"||t.name==="TypeError")&&e.bypassProxy?" (Check CORS or HTTPS/HTTP mismatch)":"";return{exists:!1,details:`Network Error: ${t.message}${o}`}}return await new Promise(t=>setTimeout(t,800)),n.endsWith("99")||n.endsWith("00")||n==="4500012345"?{exists:!0,details:`PO ${n} was posted on ${new Date().toLocaleDateString()} by User SYSTEM (Mock).`}:{exists:!1}},searchCustomers=async n=>{const e=loadSettings();if(e.sapBaseUrl&&e.sapUsername&&e.sapPassword&&n.name)try{const o=getBasicAuthHeader(e);let u=e.customerServicePath;const l=e.sapBaseUrl?e.sapBaseUrl.replace(/\/$/,""):"";if(e.bypassProxy){if(!u.startsWith("http")){const p=u.startsWith("/")?u:`/${u}`;p.includes("/sap/opu/odata")?u=`${l}${p}`:u=`${l}/sap/opu/odata/sap${p.startsWith("/sap")?p.substring(4):p}`}}else{if(u.startsWith("http"))try{u=new URL(u).pathname}catch{}u.startsWith("/")||(u=`/${u}`),u.startsWith("/sap")||(u=`/sap/opu/odata/sap${u}`)}u.endsWith("/")&&(u=u.slice(0,-1));const h=`/A_BusinessPartner?$format=json&${`$filter=BusinessPartnerFullName eq '${encodeURIComponent(n.name)}'`}&$expand=to_BusinessPartnerAddress`,f=`${u}${h}`,{response:i,finalUrl:r}=await fetchWithRetry(f,u,h,o||""),d=i.headers.get("content-type");if(i.ok){const p=await i.json();return{results:(p.d?Array.isArray(p.d)?p.d:p.d.results||[]:p.value||[]).map(v=>{const T=v.to_BusinessPartnerAddress?.results||(v.to_BusinessPartnerAddress?[v.to_BusinessPartnerAddress]:[]),w=T.length>0?T[0]:{};return{BusinessPartner:v.BusinessPartner,CustomerName:v.BusinessPartnerFullName||v.BusinessPartnerName||"",CityName:w.CityName||"",Country:w.Country||"",PostalCode:w.PostalCode||"",StreetName:w.StreetName||""}}),debugUrl:r}}else return isTechnicalError(i.status,d)?{results:[],debugUrl:r,error:`Proxy Error ${i.status}: Target unreachable or path incorrect.`}:{results:[],debugUrl:r,error:`SAP API Error ${i.status}`}}catch(o){console.error("[Proxy Network Error]:",o);const l=(o.message==="Failed to fetch"||o.name==="TypeError")&&e.bypassProxy?" (Check CORS headers on SAP server)":"";return{results:[],error:`Network Exception: ${o.message}${l}`}}console.log(" Proxy failed or not configured. Using Mock Data."),await new Promise(o=>setTimeout(o,600));const t=[{BusinessPartner:"1000001",CustomerName:"Acme Corp",CityName:"New York",Country:"US",PostalCode:"10001",StreetName:"5th Avenue"},{BusinessPartner:"1000002",CustomerName:"Globex Corp",CityName:"Berlin",Country:"DE",PostalCode:"10115",StreetName:"Torstrasse"},{BusinessPartner:"1000003",CustomerName:"Soylent Corp",CityName:"Chicago",Country:"US",PostalCode:"60601",StreetName:"Michigan Ave"},{BusinessPartner:"1000004",CustomerName:"Umbrella Corp",CityName:"Raccoon City",Country:"US",PostalCode:"99999",StreetName:"Main St"},{BusinessPartner:"1000005",CustomerName:"Stark Industries",CityName:"Malibu",Country:"US",PostalCode:"90265",StreetName:"Cliffside Dr"},{BusinessPartner:"1000006",CustomerName:"Wayne Enterprises",CityName:"Gotham",Country:"US",PostalCode:"12345",StreetName:"Wayne Tower"}];return!n.name&&!n.city?{results:t.slice(0,5)}:{results:t.filter(o=>{const u=!n.name||o.CustomerName.toLowerCase().includes(n.name.toLowerCase()),l=!n.city||o.CityName.toLowerCase().includes(n.city.toLowerCase()),m=!n.country||o.Country.toLowerCase()===n.country.toLowerCase();return u&&l&&m}),error:"Using Mock Data (Check Settings)"}},Spinner=()=>jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),ReviewView=({document:n,userRole:e=UserRole.EndUser,currentRules:t,onSave:s,onPost:o,onBack:u,onPromoteRule:l,onUpdateTags:m})=>{const[g,h]=reactExports.useState({}),[f,i]=reactExports.useState([]),[r,d]=reactExports.useState([]),[p,_]=reactExports.useState("mapped"),[y,v]=reactExports.useState(null),[T,w]=reactExports.useState("fit"),[E,P]=reactExports.useState(""),[R,I]=reactExports.useState(!1),[N,B]=reactExports.useState(""),[D,Y]=reactExports.useState(!1),[se,re]=reactExports.useState(null),[W,$]=reactExports.useState(n?.sapCustomerMatch||null),[k,H]=reactExports.useState(n?.sapCustomerMatch?"exact":"none"),[de,ee]=reactExports.useState(!1),[ce,q]=reactExports.useState(!1),[le,be]=reactExports.useState(""),[xe,Ee]=reactExports.useState([]),[we,U]=reactExports.useState(null),L=n?.status===DocumentStatus.Posting,M=(t?.conditionalRules||[]).filter(ae=>n?.appliedRuleIds?.includes(ae.id));reactExports.useEffect(()=>{if(n)if(h(n.mappedData),i(n.unmappedData||[]),d(n.lineItems||[]),re(null),n.sapCustomerMatch&&($(n.sapCustomerMatch),H("exact")),n.lastModifiedAt&&U(new Date(n.lastModifiedAt).toLocaleTimeString()),n.file.type==="application/pdf")try{const ae=atob(n.file.base64),De=new Array(ae.length);for(let Ye=0;Ye<ae.length;Ye++)De[Ye]=ae.charCodeAt(Ye);const ze=new Uint8Array(De),Ge=new Blob([ze],{type:"application/pdf"}),He=URL.createObjectURL(Ge);return v(He),()=>{URL.revokeObjectURL(He)}}catch(ae){console.error("Error creating PDF blob:",ae),v(null)}else v(null)},[n]),reactExports.useEffect(()=>{g&&Object.keys(g).length>0&&!W&&!n?.sapCustomerMatch&&C()},[g]);const C=async()=>{const ae=Object.keys(g).find(He=>He.toLowerCase().includes("customer")||He.toLowerCase().includes("name")),De=Object.keys(g).find(He=>He.toLowerCase().includes("city")||He.toLowerCase().includes("address")),ze=Object.keys(g).find(He=>He.toLowerCase().includes("country")),Ge={name:ae?String(g[ae]):"",city:De?String(g[De]):"",country:ze?String(g[ze]):""};if(Ge.name){ee(!0);try{const{results:He}=await searchCustomers(Ge),Ye=He.find(Xe=>Xe.CustomerName.toLowerCase()===Ge.name.toLowerCase()&&(Ge.city?Xe.CityName.toLowerCase().includes(Ge.city.toLowerCase()):!0));Ye?($(Ye),H("exact"),h(Xe=>({...Xe,customer_id:Ye.BusinessPartner}))):H("none")}catch(He){console.error("Auto lookup failed",He)}finally{ee(!1)}}},V=async()=>{ee(!0);try{const{results:ae}=await searchCustomers({name:le});Ee(ae)}catch(ae){console.error("Manual search failed",ae)}finally{ee(!1)}},O=ae=>{$(ae),h(De=>({...De,customer_id:ae.BusinessPartner})),q(!1),H("exact")},z=ae=>{const{name:De,value:ze,type:Ge}=ae.target;h(He=>({...He,[De]:Ge==="number"?parseFloat(ze):ze}))},j=(ae,De,ze)=>{const Ge=[...r];Ge[ae]={...Ge[ae],[De]:ze},d(Ge)},J=(ae,De,ze)=>{const Ge=[...f];Ge[ae]={...Ge[ae],[De]:ze},i(Ge)},X=()=>{i([...f,{key:"",value:""}])},ne=ae=>{i(f.filter((De,ze)=>ze!==ae))},ie=()=>{n&&(s(n.id,g,f),U(new Date().toLocaleTimeString()))},fe=()=>{n&&(s(n.id,g,f),o(n.id))},ye=async()=>{if(!(!n||!N.trim()||!t)){Y(!0),re(null);try{const ae=await refineDataWithFeedback(n,{mappedData:g,lineItems:r,unmappedData:f},N,t);h(ae.updatedMappedData),d(ae.updatedLineItems||[]),i(ae.updatedUnmappedData),re(ae.suggestedRule),B("")}catch(ae){console.error(ae),alert(`Failed to refine data.

Error: ${ae.message||"Unknown error"}`)}finally{Y(!1)}}},pe=()=>{se&&l&&(l(se),re(null))},te=()=>{const ae=E.trim();if(ae&&n&&m){const De=n.tags||[];De.includes(ae)||m(n.id,[...De,ae]),P(""),I(!1)}},ue=ae=>{if(n&&m){const De=n.tags||[];m(n.id,De.filter(ze=>ze!==ae))}},Ie=()=>{if(!n)return null;const{type:ae,base64:De}=n.file,ze=`data:${ae};base64,${De}`;return ae.startsWith("image/")?jsxRuntimeExports.jsxs("div",{className:"w-full h-full flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center bg-slate-100 dark:bg-slate-700 px-4 py-2 border-b border-slate-200 dark:border-slate-600 flex-shrink-0",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Image View"}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-1 bg-white dark:bg-slate-800 rounded p-0.5 border border-slate-300 dark:border-slate-600",children:[jsxRuntimeExports.jsx("button",{onClick:()=>w("fit"),className:`px-3 py-1 text-[10px] font-bold uppercase rounded transition-colors ${T==="fit"?"bg-blue-100 text-blue-700":"text-slate-500 hover:bg-slate-100"}`,children:"Fit Width"}),jsxRuntimeExports.jsx("button",{onClick:()=>w("original"),className:`px-3 py-1 text-[10px] font-bold uppercase rounded transition-colors ${T==="original"?"bg-blue-100 text-blue-700":"text-slate-500 hover:bg-slate-100"}`,children:"Original Size"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-auto bg-slate-200 dark:bg-slate-900 flex justify-center items-start p-4 custom-scrollbar",children:jsxRuntimeExports.jsx("img",{src:ze,alt:"Document Preview",className:`shadow-md transition-all duration-200 ${T==="fit"?"w-full object-contain max-h-none":"max-w-none w-auto"}`,style:{display:"block"}})})]}):ae==="application/pdf"?jsxRuntimeExports.jsx("div",{className:"w-full h-full bg-slate-200 dark:bg-slate-900 rounded-md overflow-hidden relative flex flex-col",children:y?jsxRuntimeExports.jsx("iframe",{src:y,className:"w-full h-full border-none flex-1",title:"PDF Document Preview"}):jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:jsxRuntimeExports.jsx("p",{children:"Loading PDF preview..."})})}):jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full text-slate-500 bg-slate-100 dark:bg-slate-700 rounded-md",children:jsxRuntimeExports.jsxs("p",{children:["Preview not available for ",ae]})})};return n?jsxRuntimeExports.jsxs("div",{className:"flex flex-col md:flex-row h-[calc(100vh-64px)] bg-slate-100 dark:bg-slate-900/50 relative",children:[jsxRuntimeExports.jsx("div",{className:"w-full md:w-1/2 p-4 h-full",children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded shadow-sm border border-slate-200 dark:border-slate-700 h-full flex flex-col overflow-hidden",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-white p-4 pb-3 flex justify-between items-center border-b border-slate-100 dark:border-slate-700 flex-shrink-0",children:[jsxRuntimeExports.jsx("span",{className:"truncate pr-2",children:n.file.name}),jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded",children:n.file.type.split("/")[1]||"file"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-h-0 bg-slate-50 dark:bg-slate-800 relative overflow-hidden",children:Ie()})]})}),jsxRuntimeExports.jsx("div",{className:"w-full md:w-1/2 p-4 flex flex-col h-full",children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded shadow-sm border border-slate-200 dark:border-slate-700 flex-1 flex flex-col p-6 h-full",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Extracted Data"}),n.usageMetadata&&jsxRuntimeExports.jsxs("div",{className:"text-[10px] text-slate-400 font-mono mt-1 mb-2 flex flex-wrap gap-x-3 gap-y-1",children:[jsxRuntimeExports.jsx("span",{title:"Model Used",children:n.usageMetadata.modelName}),jsxRuntimeExports.jsxs("span",{className:"border-l border-slate-300 pl-3 text-green-600 dark:text-green-400 font-bold",title:"Estimated Cost",children:["Est. $",n.usageMetadata.estimatedCost.toFixed(5)]}),M.length>0&&jsxRuntimeExports.jsxs("span",{className:"bg-amber-100 text-amber-700 px-1 rounded border border-amber-200 font-bold",children:[M.length," Rule",M.length!==1&&"s"," Applied"]})]})]}),jsxRuntimeExports.jsx("div",{className:"flex space-x-1 bg-slate-100 dark:bg-slate-700 p-1 rounded overflow-x-auto",children:["mapped","lineItems","unmapped","assistant","trace",...n.emailContext?["context"]:[]].map(ae=>jsxRuntimeExports.jsx("button",{onClick:()=>_(ae),className:`px-3 py-1.5 text-xs font-bold uppercase tracking-wide rounded transition-all whitespace-nowrap ${p===ae?"bg-white dark:bg-slate-600 shadow-sm text-blue-700 dark:text-blue-400":"text-slate-500 dark:text-slate-400 hover:text-slate-700"}`,children:ae==="lineItems"?`Lines (${r.length})`:ae==="trace"?"Rule Trace":ae==="context"?"Email/Context":ae},ae))})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4 min-h-[24px]",children:[n.tags?.map(ae=>jsxRuntimeExports.jsxs("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-full border flex items-center gap-1 ${getTagColor(ae)}`,children:[ae,jsxRuntimeExports.jsx("button",{onClick:()=>ue(ae),className:"hover:text-red-700 font-bold px-0.5",children:""})]},ae)),R?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("input",{type:"text",value:E,onChange:ae=>P(ae.target.value),onKeyDown:ae=>ae.key==="Enter"&&te(),autoFocus:!0,className:"w-24 text-xs p-0.5 border border-slate-300 rounded focus:outline-none"}),jsxRuntimeExports.jsx("button",{onClick:te,className:"text-xs text-blue-600 font-bold",children:""}),jsxRuntimeExports.jsx("button",{onClick:()=>I(!1),className:"text-xs text-slate-400",children:""})]}):jsxRuntimeExports.jsx("button",{onClick:()=>I(!0),className:"text-[10px] font-bold text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 px-2 py-0.5 rounded border border-blue-100 transition-colors",children:"+ Tag"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 space-y-6 custom-scrollbar relative",children:[p==="mapped"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-900 rounded p-3 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("h4",{className:"text-xs font-bold text-blue-800 dark:text-blue-300 uppercase tracking-wide",children:"SAP Customer Match"}),k==="exact"&&jsxRuntimeExports.jsxs("span",{className:"bg-green-100 text-green-700 border border-green-200 text-[10px] px-2 py-0.5 rounded-full font-bold flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})," Verified"]})]}),W?jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-slate-800 p-2 rounded border border-blue-200 dark:border-blue-800 shadow-sm",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white",children:W.CustomerName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-500",children:[W.BusinessPartner," | ",W.CityName,", ",W.Country]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{q(!0),be(W.CustomerName)},className:"text-xs text-blue-600 hover:underline font-medium",children:"Change"})]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-3",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"No customer automatically linked."}),jsxRuntimeExports.jsx("button",{onClick:()=>{q(!0);const ae=Object.keys(g).find(De=>De.toLowerCase().includes("customer")||De.toLowerCase().includes("name"));ae&&g[ae]&&be(String(g[ae]))},className:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-1.5 px-4 rounded transition-colors",children:"Search & Link Customer"})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-5",children:[Object.entries(g).map(([ae,De])=>{const ze=M.find(Ge=>Ge.targetField===ae);return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("label",{htmlFor:ae,className:"flex items-center gap-2 text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wide mb-1",children:[ae.replace(/_/g," "),ze&&jsxRuntimeExports.jsx("span",{className:"bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded text-[9px] border border-amber-200 cursor-help",title:`Modified by rule: ${ze.name}`,children:" Rule Applied"})]}),jsxRuntimeExports.jsxs("div",{className:"relative rounded-md shadow-sm",children:[jsxRuntimeExports.jsx("input",{type:typeof De=="number"?"number":"text",name:ae,id:ae,value:De,onChange:z,className:`block w-full px-3 py-2 border rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm font-medium ${ze?"border-amber-300 ring-1 ring-amber-100":"border-slate-300 dark:border-slate-600"}`}),n.confidence&&n.confidence[ae]!==void 0&&jsxRuntimeExports.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:jsxRuntimeExports.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded border ${n.confidence[ae]>.9?"bg-green-50 text-green-700 border-green-200":"bg-yellow-50 text-yellow-700 border-yellow-200"}`,children:`${(n.confidence[ae]*100).toFixed(0)}%`})})]})]},ae)}),Object.keys(g).length===0&&jsxRuntimeExports.jsx("p",{className:"text-slate-500 text-sm italic",children:"No mapped fields found."})]})]}),p==="lineItems"&&jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mb-4 bg-blue-50 p-2 rounded text-blue-800 border border-blue-100",children:"Line Items extracted from the document table."}),jsxRuntimeExports.jsxs("div",{className:"overflow-x-auto border border-slate-200 dark:border-slate-700 rounded-lg",children:[jsxRuntimeExports.jsxs("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[jsxRuntimeExports.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-left text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Line"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-left text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Item #"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-left text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Description"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-left text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Qty"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-left text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Cost"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-left text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Total"})]})}),jsxRuntimeExports.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:r.map((ae,De)=>jsxRuntimeExports.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[jsxRuntimeExports.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:jsxRuntimeExports.jsx("input",{className:"w-8 text-xs bg-transparent focus:outline-none",value:ae.LineItem||De+1,onChange:ze=>j(De,"LineItem",ze.target.value)})}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:jsxRuntimeExports.jsx("input",{className:"w-20 text-xs font-mono bg-transparent focus:outline-none text-blue-600 dark:text-blue-400",value:ae.VendorItemNumber||"",onChange:ze=>j(De,"VendorItemNumber",ze.target.value)})}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2",children:jsxRuntimeExports.jsx("input",{className:"w-full text-xs bg-transparent focus:outline-none",value:ae.ItemDescription||"",onChange:ze=>j(De,"ItemDescription",ze.target.value)})}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:jsxRuntimeExports.jsx("input",{type:"number",className:"w-12 text-xs bg-transparent focus:outline-none text-right",value:ae.QuantityOrdered||0,onChange:ze=>j(De,"QuantityOrdered",parseFloat(ze.target.value))})}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:jsxRuntimeExports.jsx("input",{type:"number",className:"w-16 text-xs bg-transparent focus:outline-none text-right",value:ae.CostEach||0,onChange:ze=>j(De,"CostEach",parseFloat(ze.target.value))})}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs text-right font-bold text-slate-700 dark:text-slate-300",children:(ae.CostExtended||0).toFixed(2)})]},De))})]}),r.length===0&&jsxRuntimeExports.jsx("div",{className:"p-4 text-center text-xs text-slate-500 italic",children:"No line items extracted."})]})]}),p==="trace"&&jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mb-4 bg-purple-50 p-2 rounded text-purple-800 border border-purple-100",children:"Processing Log: Shows rules and logic applied to this document."}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3 relative pb-6 border-l-2 border-slate-200 ml-2 pl-6",children:[jsxRuntimeExports.jsx("div",{className:"absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-blue-500 border-2 border-white"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-bold text-slate-800 dark:text-white",children:"Base Extraction"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500",children:"Document analyzed using global schema."}),t?.naturalLanguageRules&&jsxRuntimeExports.jsxs("div",{className:"mt-2 bg-blue-50 dark:bg-blue-900/20 p-2 rounded border border-blue-100 dark:border-blue-800",children:[jsxRuntimeExports.jsx("p",{className:"text-[10px] font-bold text-blue-800 dark:text-blue-300 mb-1",children:"Global Instructions Applied:"}),jsxRuntimeExports.jsxs("p",{className:"text-[10px] text-slate-600 dark:text-slate-400 italic line-clamp-3",children:['"',t.naturalLanguageRules,'"']})]})]})]}),M.length>0?M.map((ae,De)=>jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3 relative pb-6 border-l-2 border-amber-200 ml-2 pl-6",children:[jsxRuntimeExports.jsx("div",{className:"absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-amber-500 border-2 border-white"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h4",{className:"text-sm font-bold text-slate-800 dark:text-white",children:["Rule Applied: ",ae.name]}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-slate-600 bg-amber-50 p-2 rounded mt-1 border border-amber-100",children:[jsxRuntimeExports.jsx("span",{className:"font-bold",children:"Match:"})," ",ae.condition.field," ",ae.condition.operator,' "',ae.condition.value,'"',jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx("span",{className:"font-bold",children:"Logic:"})," ",ae.instruction]})]})]},De)):jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3 relative pb-6 border-l-2 border-slate-200 ml-2 pl-6 opacity-50",children:[jsxRuntimeExports.jsx("div",{className:"absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-slate-300 border-2 border-white"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-bold text-slate-600",children:"No Conditional Rules Matched"}),jsxRuntimeExports.jsx("p",{className:"text-[10px] text-slate-400 mt-1",children:"If you expected a rule to fire, check that the field value matches exactly."})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3 relative ml-2 pl-6",children:[jsxRuntimeExports.jsx("div",{className:"absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-green-500 border-2 border-white"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-bold text-slate-800 dark:text-white",children:"Final Output"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500",children:"Ready for review."})]})]})]})]}),p==="assistant"&&jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-100 dark:border-amber-900 rounded p-4",children:[jsxRuntimeExports.jsxs("h4",{className:"font-bold text-amber-800 dark:text-amber-400 text-sm flex items-center",children:[jsxRuntimeExports.jsx("span",{className:"mr-2",children:""})," AI Assistant"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-500 mt-1",children:"Describe what needs to be fixed. The AI will re-read the document and update values."})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col",children:[jsxRuntimeExports.jsx("textarea",{value:N,onChange:ae=>B(ae.target.value),placeholder:"e.g., 'The Total Amount is wrong, pick the bold number at the bottom.' or 'Combine First and Last Name into Customer Name'.",className:"w-full p-3 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-sm focus:ring-2 focus:ring-amber-500 focus:outline-none resize-none h-32"}),jsxRuntimeExports.jsx("button",{onClick:ye,disabled:D||!N.trim(),className:"mt-2 w-full bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded shadow-sm transition-colors flex items-center justify-center text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:D?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Spinner,{}),jsxRuntimeExports.jsx("span",{className:"ml-2",children:"Analysing..."})]}):"Apply Fix"})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4 mt-2",children:[jsxRuntimeExports.jsx("h5",{className:"text-xs font-bold text-slate-500 uppercase tracking-wide mb-2",children:"Global Extraction Rules"}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded border border-slate-200 dark:border-slate-700 mb-4 text-xs text-slate-700 dark:text-slate-300 italic",children:['"',t?.naturalLanguageRules||"No global rules defined.",'"']}),jsxRuntimeExports.jsxs("h5",{className:"text-xs font-bold text-slate-500 uppercase tracking-wide mb-2 flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{children:"Active Conditional Rules"}),jsxRuntimeExports.jsx("span",{className:"bg-slate-100 text-slate-600 px-1.5 rounded text-[10px]",children:t?.conditionalRules?.filter(ae=>ae.active).length||0})]}),jsxRuntimeExports.jsxs("div",{className:"max-h-32 overflow-y-auto custom-scrollbar space-y-2",children:[t?.conditionalRules?.filter(ae=>ae.active).map(ae=>jsxRuntimeExports.jsxs("div",{className:"text-xs bg-slate-50 dark:bg-slate-800 p-2 rounded border border-slate-200 dark:border-slate-700",children:[jsxRuntimeExports.jsx("div",{className:"font-bold text-slate-700 dark:text-slate-300",children:ae.name}),jsxRuntimeExports.jsx("div",{className:"text-slate-500 truncate",title:ae.instruction,children:ae.instruction})]},ae.id)),(!t?.conditionalRules||t.conditionalRules.length===0)&&jsxRuntimeExports.jsx("p",{className:"text-[10px] text-slate-400 italic",children:"No rules configured."})]})]}),se&&jsxRuntimeExports.jsxs("div",{className:"mt-4 border-t border-slate-200 dark:border-slate-700 pt-4",children:[jsxRuntimeExports.jsx("h5",{className:"text-xs font-bold text-slate-500 uppercase tracking-wide mb-2",children:"Learning Suggestion"}),jsxRuntimeExports.jsx("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-3 rounded border border-slate-200 dark:border-slate-600 mb-3",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 italic",children:['"',se,'"']})}),e===UserRole.Analyst?jsxRuntimeExports.jsxs("button",{onClick:pe,className:"w-full text-xs bg-slate-800 hover:bg-slate-900 text-white font-bold py-2 px-3 rounded transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx("span",{children:"Add to Global Training Rules"}),jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M5 12h14"}),jsxRuntimeExports.jsx("path",{d:"M12 5v14"})]})]}):jsxRuntimeExports.jsx("p",{className:"text-[10px] text-slate-400 text-center",children:"Only Analysts can promote rules."})]})]}),p==="context"&&jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-500 mb-4 bg-indigo-50 p-2 rounded text-indigo-800 border border-indigo-100 flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("rect",{width:"20",height:"16",x:"2",y:"4",rx:"2"}),jsxRuntimeExports.jsx("path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"})]}),jsxRuntimeExports.jsx("span",{children:"Supplementary Context (Email/Text) provided during upload."})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded p-4 shadow-inner",children:jsxRuntimeExports.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:jsxRuntimeExports.jsx("pre",{className:"whitespace-pre-wrap font-sans text-sm text-slate-700 dark:text-slate-300 leading-relaxed",children:n.emailContext})})})]}),p==="unmapped"&&jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mb-4 bg-blue-50 p-2 rounded text-blue-800 border border-blue-100",children:"Additional data fields found outside the main headers and grid."}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto space-y-2",children:f.map((ae,De)=>jsxRuntimeExports.jsxs("div",{className:"flex space-x-2 items-start",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Key",value:ae.key,onChange:ze=>J(De,"key",ze.target.value),className:"w-1/3 px-2 py-2 text-xs font-bold text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-700/50 border border-slate-300 dark:border-slate-600 rounded focus:ring-1 focus:ring-blue-500 focus:outline-none uppercase"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Value",value:ae.value,onChange:ze=>J(De,"value",ze.target.value),className:"flex-1 px-2 py-2 text-sm text-slate-800 dark:text-slate-200 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded focus:ring-1 focus:ring-blue-500 focus:outline-none"}),jsxRuntimeExports.jsx("button",{onClick:()=>ne(De),className:"p-2 text-slate-400 hover:text-red-500 transition-colors",title:"Remove Field",children:ICONS.trash})]},De))}),jsxRuntimeExports.jsxs("button",{onClick:X,className:"mt-4 flex items-center justify-center w-full py-2 border border-dashed border-slate-300 dark:border-slate-600 rounded text-slate-500 hover:text-blue-600 hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-slate-800 transition-all text-sm font-medium",children:[ICONS.plus,jsxRuntimeExports.jsx("span",{className:"ml-2",children:"Add Custom Field"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"mt-8 pt-6 border-t border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsxs("button",{onClick:u,className:"text-sm font-bold text-slate-500 dark:text-slate-400 hover:text-blue-700 flex items-center",children:[" ",jsxRuntimeExports.jsx("span",{className:"ml-1",children:"Dashboard"})]}),we&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-slate-400 italic",children:["Saved at ",we]})]}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-3",children:[jsxRuntimeExports.jsx("button",{onClick:ie,className:"bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 font-semibold py-2 px-6 rounded shadow-sm transition-colors text-sm",children:"Save Draft"}),jsxRuntimeExports.jsx("button",{onClick:fe,disabled:L,className:"bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-6 rounded shadow hover:shadow-md transition-all disabled:bg-blue-400 flex items-center justify-center min-w-[160px] text-sm",children:L?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Spinner,{}),jsxRuntimeExports.jsx("span",{className:"ml-2",children:"Posting..."})]}):"Approve & Post"})]})]})]})}),ce&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full border border-slate-200 dark:border-slate-700 overflow-hidden h-[500px] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"Select Customer"}),jsxRuntimeExports.jsx("button",{onClick:()=>q(!1),className:"text-slate-400 hover:text-slate-600",children:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M18 6 6 18"}),jsxRuntimeExports.jsx("path",{d:"m6 6 12 12"})]})})]}),jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-800",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("input",{type:"text",value:le,onChange:ae=>be(ae.target.value),onKeyDown:ae=>ae.key==="Enter"&&V(),placeholder:"Search by Name, City, or ID...",className:"flex-1 p-2 border border-slate-300 dark:border-slate-600 rounded text-sm dark:bg-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:outline-none",autoFocus:!0}),jsxRuntimeExports.jsx("button",{onClick:V,disabled:de,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm font-bold",children:de?"Searching...":"Search"})]})}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-2 bg-slate-50 dark:bg-slate-900/50",children:xe.length>0?jsxRuntimeExports.jsx("div",{className:"space-y-2",children:xe.map(ae=>jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded border border-slate-200 dark:border-slate-700 flex justify-between items-center hover:border-blue-300 transition-colors group",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-bold text-slate-800 dark:text-white text-sm",children:ae.CustomerName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-500",children:[ae.StreetName?`${ae.StreetName}, `:"",ae.CityName,", ",ae.Country]}),jsxRuntimeExports.jsxs("p",{className:"text-[10px] text-slate-400 font-mono mt-1",children:["ID: ",ae.BusinessPartner]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>O(ae),className:"opacity-0 group-hover:opacity-100 bg-blue-100 hover:bg-blue-200 text-blue-700 text-xs font-bold px-3 py-1.5 rounded transition-all",children:"Select"})]},ae.BusinessPartner))}):jsxRuntimeExports.jsx("div",{className:"h-full flex items-center justify-center text-slate-400 text-sm italic",children:de?"Searching...":"No results found. Try a different search term."})})]})})]}):jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full p-10",children:jsxRuntimeExports.jsx("p",{className:"text-slate-500",children:"Select a document from the dashboard to review."})})},TrainingView=({rules:n,onSave:e})=>{const[t,s]=reactExports.useState(n.schema),[o,u]=reactExports.useState(n.naturalLanguageRules),[l,m]=reactExports.useState(n.conditionalRules||[]),[g,h]=reactExports.useState({condition:{field:"FILENAME",operator:"contains",value:""},instruction:"",name:""}),f=()=>{s([...t,{id:Date.now().toString(),name:"",type:"string",description:""}])},i=v=>{s(t.filter(T=>T.id!==v))},r=(v,T)=>{const{name:w,value:E}=T.target;s(t.map(P=>P.id===v?{...P,[w]:E}:P))},d=()=>{if(!g.name||!g.instruction||!g.condition?.value){alert("Please fill in all rule fields.");return}const v={id:Date.now().toString(),name:g.name,active:!0,condition:g.condition,instruction:g.instruction,targetField:g.targetField};m([...l,v]),h({condition:{field:"FILENAME",operator:"contains",value:""},instruction:"",name:"",targetField:""})},p=v=>{m(l.filter(T=>T.id!==v))},_=v=>{m(l.map(T=>T.id===v?{...T,active:!T.active}:T))},y=()=>{e({schema:t,naturalLanguageRules:o,conditionalRules:l}),alert("Training rules saved successfully!")};return jsxRuntimeExports.jsxs("div",{className:"p-8 max-w-7xl mx-auto bg-slate-50 dark:bg-slate-900 min-h-full",children:[jsxRuntimeExports.jsxs("div",{className:"mb-8 flex justify-between items-end",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-3xl font-bold text-slate-800 dark:text-white",children:"AI Training Center"}),jsxRuntimeExports.jsx("p",{className:"text-slate-500 mt-1",children:"Configure parsing logic, data schema, and conditional extraction rules."})]}),jsxRuntimeExports.jsx("button",{onClick:y,className:"bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-6 rounded shadow-lg transition-all",children:"Save Configuration"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-8 bg-white dark:bg-slate-800 p-6 rounded shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[jsxRuntimeExports.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-4",children:"Parsing Logic Flow"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-1/2 left-0 w-full h-0.5 bg-slate-200 dark:bg-slate-700 -z-0"}),jsxRuntimeExports.jsxs("div",{className:"z-10 bg-slate-100 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded px-4 py-3 text-center w-40",children:[jsxRuntimeExports.jsx("div",{className:"text-blue-600 mb-1",children:ICONS.document}),jsxRuntimeExports.jsx("div",{className:"text-xs font-bold text-slate-700 dark:text-slate-300",children:"Document"})]}),jsxRuntimeExports.jsxs("div",{className:"z-10 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded px-4 py-3 text-center w-40",children:[jsxRuntimeExports.jsx("div",{className:"text-blue-600 mb-1 font-mono text-xs",children:"Schema"}),jsxRuntimeExports.jsx("div",{className:"text-xs font-bold text-blue-800 dark:text-blue-200",children:"Base Extraction"})]}),jsxRuntimeExports.jsxs("div",{className:"z-10 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded px-4 py-3 text-center w-40",children:[jsxRuntimeExports.jsx("div",{className:"text-amber-600 mb-1 font-mono text-xs",children:"If / Then"}),jsxRuntimeExports.jsx("div",{className:"text-xs font-bold text-amber-800 dark:text-amber-200",children:"Conditional Rules"})]}),jsxRuntimeExports.jsxs("div",{className:"z-10 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded px-4 py-3 text-center w-40",children:[jsxRuntimeExports.jsx("div",{className:"text-green-600 mb-1",children:""}),jsxRuntimeExports.jsx("div",{className:"text-xs font-bold text-green-800 dark:text-green-200",children:"Final Output"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[jsxRuntimeExports.jsxs("div",{className:"lg:col-span-7 space-y-8",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded shadow border border-slate-200 dark:border-slate-700",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:"1. Data Schema"}),jsxRuntimeExports.jsx("div",{className:"space-y-3 mb-4",children:t.map(v=>jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center p-2 bg-slate-50 dark:bg-slate-700/50 rounded border border-slate-200 dark:border-slate-600",children:[jsxRuntimeExports.jsx("div",{className:"col-span-4",children:jsxRuntimeExports.jsx("input",{type:"text",name:"name",value:v.name,onChange:T=>r(v.id,T),className:"w-full text-xs font-mono p-1 bg-transparent border-b border-transparent focus:border-blue-500 focus:outline-none dark:text-white",placeholder:"field_name"})}),jsxRuntimeExports.jsx("div",{className:"col-span-3",children:jsxRuntimeExports.jsxs("select",{name:"type",value:v.type,onChange:T=>r(v.id,T),className:"w-full text-xs p-1 bg-transparent border-b border-transparent focus:border-blue-500 focus:outline-none dark:text-slate-300",children:[jsxRuntimeExports.jsx("option",{value:"string",children:"String"}),jsxRuntimeExports.jsx("option",{value:"number",children:"Number"}),jsxRuntimeExports.jsx("option",{value:"date",children:"Date"})]})}),jsxRuntimeExports.jsx("div",{className:"col-span-4",children:jsxRuntimeExports.jsx("input",{type:"text",name:"description",value:v.description,onChange:T=>r(v.id,T),className:"w-full text-xs p-1 bg-transparent border-b border-transparent focus:border-blue-500 focus:outline-none dark:text-slate-300",placeholder:"Description..."})}),jsxRuntimeExports.jsx("div",{className:"col-span-1 flex justify-end",children:jsxRuntimeExports.jsx("button",{onClick:()=>i(v.id),className:"text-slate-400 hover:text-red-600",children:ICONS.trash})})]},v.id))}),jsxRuntimeExports.jsxs("button",{onClick:f,className:"text-xs font-bold text-blue-700 hover:text-blue-900 uppercase tracking-wide flex items-center gap-1",children:[ICONS.plus," Add Field"]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded shadow border border-slate-200 dark:border-slate-700",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-2",children:"2. Global Extraction Hints"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mb-3",children:'General instructions applied to ALL documents (e.g., "PO Number is typically at the top right").'}),jsxRuntimeExports.jsx("textarea",{value:o,onChange:v=>u(v.target.value),rows:4,className:"w-full p-3 text-sm border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none dark:bg-slate-600 dark:border-slate-500 leading-relaxed"})]})]}),jsxRuntimeExports.jsx("div",{className:"lg:col-span-5",children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded shadow border border-slate-200 dark:border-slate-700 h-full flex flex-col",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-2",children:"3. Conditional Logic"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mb-6",children:"Define rules that apply only when specific criteria are met. This triggers a multi-step refinement process."}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900 p-4 rounded border border-slate-200 dark:border-slate-700 mb-6",children:[jsxRuntimeExports.jsx("h4",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 uppercase mb-3",children:"New Rule"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Rule Name (e.g. Acme Logic)",value:g.name,onChange:v=>h({...g,name:v.target.value}),className:"w-full text-sm p-2 border border-slate-300 dark:border-slate-600 rounded"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 items-center bg-white dark:bg-slate-800 p-2 rounded border border-slate-200 dark:border-slate-700",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500",children:"IF"}),jsxRuntimeExports.jsxs("select",{className:"text-xs p-1 border rounded max-w-[120px]",value:g.condition?.field,onChange:v=>h({...g,condition:{...g.condition,field:v.target.value}}),children:[jsxRuntimeExports.jsx("option",{value:"FILENAME",children:"Filename"}),jsxRuntimeExports.jsx("option",{disabled:!0,children:"--- Header Fields ---"}),t.map(v=>jsxRuntimeExports.jsx("option",{value:v.name,children:v.name},v.id)),jsxRuntimeExports.jsx("option",{disabled:!0,children:"--- Line Items ---"}),jsxRuntimeExports.jsx("option",{value:"VendorItemNumber",children:"Item # (VendorItemNumber)"}),jsxRuntimeExports.jsx("option",{value:"ItemDescription",children:"Description (ItemDescription)"}),jsxRuntimeExports.jsx("option",{value:"QuantityOrdered",children:"Quantity (QuantityOrdered)"}),jsxRuntimeExports.jsx("option",{value:"CostEach",children:"Unit Cost (CostEach)"}),jsxRuntimeExports.jsx("option",{value:"CostExtended",children:"Total Cost (CostExtended)"})]}),jsxRuntimeExports.jsxs("select",{className:"text-xs p-1 border rounded",value:g.condition?.operator,onChange:v=>h({...g,condition:{...g.condition,operator:v.target.value}}),children:[jsxRuntimeExports.jsx("option",{value:"contains",children:"Contains"}),jsxRuntimeExports.jsx("option",{value:"equals",children:"Equals"}),jsxRuntimeExports.jsx("option",{value:"starts_with",children:"Starts With"})]})]}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Value (e.g. Acme, Invoice_A, or 12345)",value:g.condition?.value,onChange:v=>h({...g,condition:{...g.condition,value:v.target.value}}),className:"w-full text-sm p-2 border border-slate-300 dark:border-slate-600 rounded"}),jsxRuntimeExports.jsxs("div",{className:"pt-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-slate-500 block mb-1",children:"THEN (Instruction to AI)"}),jsxRuntimeExports.jsx("textarea",{placeholder:"e.g. Append ' - CONFIRMED' to description.",value:g.instruction,onChange:v=>h({...g,instruction:v.target.value}),rows:2,className:"w-full text-sm p-2 border border-slate-300 dark:border-slate-600 rounded"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("select",{className:"text-xs p-1 border rounded text-slate-500",value:g.targetField||"",onChange:v=>h({...g,targetField:v.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"",children:"(Optional) Link to Field"}),t.map(v=>jsxRuntimeExports.jsx("option",{value:v.name,children:v.name},v.id))]}),jsxRuntimeExports.jsx("button",{onClick:d,className:"text-xs bg-blue-600 text-white px-3 py-1.5 rounded font-bold hover:bg-blue-700",children:"Add Rule"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto space-y-2 custom-scrollbar max-h-[400px]",children:[l.length===0&&jsxRuntimeExports.jsx("p",{className:"text-center text-xs text-slate-400 italic py-4",children:"No conditional rules defined."}),l.map(v=>jsxRuntimeExports.jsxs("div",{className:`p-3 rounded border text-sm relative group ${v.active?"bg-amber-50 dark:bg-amber-900/10 border-amber-200 dark:border-amber-800":"bg-slate-100 border-slate-200 opacity-60"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-1",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-200",children:v.name}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:v.active,onChange:()=>_(v.id),className:"cursor-pointer",title:"Toggle Active"}),jsxRuntimeExports.jsx("button",{onClick:()=>p(v.id),className:"text-slate-400 hover:text-red-500",children:ICONS.trash})]})]}),jsxRuntimeExports.jsxs("div",{className:"text-xs font-mono text-slate-600 dark:text-slate-400 mb-1",children:["IF ",v.condition.field," ",v.condition.operator,' "',v.condition.value,'"']}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-slate-700 dark:text-slate-300 italic pl-2 border-l-2 border-amber-300",children:['"',v.instruction,'"']}),v.targetField&&jsxRuntimeExports.jsxs("div",{className:"mt-1 text-[10px] text-blue-600 uppercase font-bold",children:["Target: ",v.targetField]})]},v.id))]})]})})]})]})},SettingsView=()=>{const[n,e]=reactExports.useState({sapBaseUrl:"",customerServicePath:"",orderServicePath:"",sapUsername:"",sapPassword:"",extractionEngine:"gemini-cloud",bypassProxy:!1}),[t,s]=reactExports.useState(!1),[o,u]=reactExports.useState(null);reactExports.useEffect(()=>{const g=loadSettings();e(g)},[]);const l=g=>{const h=g.target,f=h.type==="checkbox"?h.checked:h.value,i=h.name;e(r=>({...r,[i]:f}))},m=g=>{g.preventDefault(),s(!0),u(null);try{saveSettings(n),setTimeout(()=>{u({type:"success",text:"System settings saved successfully."}),s(!1)},500)}catch{u({type:"error",text:"Failed to save settings to local storage."}),s(!1)}};return jsxRuntimeExports.jsxs("div",{className:"p-8 max-w-4xl mx-auto min-h-full",children:[jsxRuntimeExports.jsxs("div",{className:"mb-8",children:[jsxRuntimeExports.jsxs("h2",{className:"text-3xl font-bold text-slate-800 dark:text-white flex items-center gap-3",children:[ICONS.settings,jsxRuntimeExports.jsx("span",{children:"System Configuration"})]}),jsxRuntimeExports.jsx("p",{className:"text-slate-500 mt-2",children:"Configure connection details for your SAP S/4HANA Cloud instance and AI extraction preferences."})]}),jsxRuntimeExports.jsxs("form",{onSubmit:m,className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 bg-blue-50/30 dark:bg-blue-900/10",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:"AI Extraction Engine"}),jsxRuntimeExports.jsx("div",{className:"grid gap-6",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Processing Strategy"}),jsxRuntimeExports.jsxs("select",{name:"extractionEngine",value:n.extractionEngine,onChange:l,className:"w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[jsxRuntimeExports.jsx("option",{value:"gemini-cloud",children:"Google Gemini Cloud API (Recommended - Highest Accuracy)"}),jsxRuntimeExports.jsx("option",{value:"tesseract-local",children:"Local Tesseract OCR (Rule-based, Privacy focused)"}),jsxRuntimeExports.jsx("option",{value:"chrome-device-llm",children:"On-Device LLM (Tesseract + Chrome Built-in AI)"})]}),jsxRuntimeExports.jsxs("div",{className:"mt-2 text-xs text-slate-500 space-y-1",children:[jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Gemini Cloud:"})," Uses Google's most powerful models. Requires internet."]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Tesseract Local:"})," Performs OCR in your browser. Uses simple keyword matching. Fast, works offline, lower accuracy."]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"On-Device LLM:"})," Uses 'Gemini Nano' in Chrome (Experimental). Requires Chrome Canary with AI enabled. No data leaves device."]})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:"SAP S/4HANA Connectivity"}),jsxRuntimeExports.jsxs("div",{className:"grid gap-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"SAP Base URL"}),jsxRuntimeExports.jsx("input",{type:"url",name:"sapBaseUrl",value:n.sapBaseUrl,onChange:l,placeholder:"https://my-sap-instance.com",className:"w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"The root URL of your SAP instance."})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Customer Lookup Service Path"}),jsxRuntimeExports.jsx("input",{type:"text",name:"customerServicePath",value:n.customerServicePath,onChange:l,className:"w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"OData endpoint for Business Partners."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Order Service Path"}),jsxRuntimeExports.jsx("input",{type:"text",name:"orderServicePath",value:n.orderServicePath,onChange:l,className:"w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"OData endpoint for Sales Orders."})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded border border-amber-200 dark:border-amber-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",id:"bypassProxy",name:"bypassProxy",checked:n.bypassProxy,onChange:l,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded cursor-pointer"}),jsxRuntimeExports.jsx("label",{htmlFor:"bypassProxy",className:"ml-2 block text-sm font-bold text-slate-900 dark:text-slate-200 cursor-pointer",children:"Bypass Proxy (Direct Call to SAP)"})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-2 ml-6",children:["Enable this when deployed in an environment without a backend proxy, or to test direct connectivity.",jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-amber-700 dark:text-amber-500",children:"Note:"})," Your SAP server must support CORS (Cross-Origin Resource Sharing) for this to work from a browser."]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 bg-slate-50/50 dark:bg-slate-800/50",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:"Authentication"}),jsxRuntimeExports.jsx("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 rounded-r mb-6",children:jsxRuntimeExports.jsx("div",{className:"flex",children:jsxRuntimeExports.jsx("div",{className:"ml-3",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:"Credentials are saved locally in your browser with basic obfuscation. For production use, ensure this application is behind a secure proxy or uses OAuth."})})})}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"User ID"}),jsxRuntimeExports.jsx("input",{type:"text",name:"sapUsername",value:n.sapUsername,onChange:l,autoComplete:"off",className:"w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Password"}),jsxRuntimeExports.jsx("input",{type:"password",name:"sapPassword",value:n.sapPassword,onChange:l,autoComplete:"new-password",className:"w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800",children:[jsxRuntimeExports.jsx("div",{children:o&&jsxRuntimeExports.jsx("span",{className:`text-sm font-medium ${o.type==="success"?"text-green-600":"text-red-600"}`,children:o.text})}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:t,className:"bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-6 rounded shadow-sm hover:shadow transition-all disabled:opacity-50",children:t?"Saving...":"Save Configuration"})]})]})]})},TestBenchView=()=>{const[n,e]=reactExports.useState(""),[t,s]=reactExports.useState([]),[o,u]=reactExports.useState(!1),[l,m]=reactExports.useState(null),[g,h]=reactExports.useState(null),[f,i]=reactExports.useState(""),[r,d]=reactExports.useState(null),[p,_]=reactExports.useState(!1),[y,v]=reactExports.useState(null),T=async E=>{E.preventDefault(),u(!0),m(null),s([]),h(null);try{const{results:P,debugUrl:R,error:I}=await searchCustomers({name:n});s(P),h(R||null),I?m(I):P.length===0&&m("No results found in SAP.")}catch(P){m(P.message||"An unknown error occurred")}finally{u(!1)}},w=async E=>{E.preventDefault(),_(!0),d(null),v(null);try{const P=await checkERPDuplication(f);d(P),P.debugUrl&&v(P.debugUrl)}catch(P){console.error(P)}finally{_(!1)}};return jsxRuntimeExports.jsxs("div",{className:"p-8 max-w-6xl mx-auto min-h-full bg-slate-50 dark:bg-slate-900",children:[jsxRuntimeExports.jsxs("div",{className:"mb-8",children:[jsxRuntimeExports.jsxs("h2",{className:"text-3xl font-bold text-slate-800 dark:text-white flex items-center gap-3",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-blue-600",children:jsxRuntimeExports.jsx("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),jsxRuntimeExports.jsx("span",{children:"Developer Test Bench"})]}),jsxRuntimeExports.jsx("p",{className:"text-slate-500 mt-2",children:"Isolated testing environment for SAP OData services. Use this to verify your proxy and paths."})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white mb-4 border-b border-slate-100 dark:border-slate-700 pb-2",children:"Customer Search API"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-slate-500 mb-4",children:["Tests the ",jsxRuntimeExports.jsx("code",{className:"bg-slate-100 px-1 rounded",children:"API_BUSINESS_PARTNER"})," service mapping."]}),jsxRuntimeExports.jsxs("form",{onSubmit:T,className:"flex gap-2 mb-6",children:[jsxRuntimeExports.jsx("input",{type:"text",value:n,onChange:E=>e(E.target.value),placeholder:"Enter Customer Name (e.g., Barbara)",className:"flex-1 p-2 border border-slate-300 dark:border-slate-600 rounded"}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:!n||o,className:"bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-700 disabled:opacity-50",children:o?"Searching...":"Search"})]}),g&&jsxRuntimeExports.jsxs("div",{className:"mb-4 p-2 bg-slate-100 dark:bg-slate-900 rounded border border-slate-300 dark:border-slate-600 overflow-x-auto",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Requested URL (Proxy):"}),jsxRuntimeExports.jsx("code",{className:"text-xs text-blue-600 dark:text-blue-400 whitespace-nowrap",children:g})]}),l&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 text-red-700 border border-red-200 rounded mb-4 text-sm break-all",children:l}),jsxRuntimeExports.jsx("div",{className:"bg-slate-50 dark:bg-slate-900 rounded border border-slate-200 dark:border-slate-700 h-64 overflow-y-auto p-4 custom-scrollbar",children:t.length>0?jsxRuntimeExports.jsx("div",{className:"space-y-3",children:t.map((E,P)=>jsxRuntimeExports.jsxs("div",{className:"p-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded shadow-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-blue-700 dark:text-blue-400",children:E.CustomerName}),jsxRuntimeExports.jsx("span",{className:"text-xs font-mono text-slate-400",children:E.BusinessPartner})]}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-300 mt-1",children:[E.StreetName&&jsxRuntimeExports.jsxs("span",{children:[E.StreetName,", "]}),E.CityName,", ",E.Country," ",E.PostalCode]})]},P))}):jsxRuntimeExports.jsx("div",{className:"h-full flex items-center justify-center text-slate-400 italic text-sm",children:o?"Waiting for response...":"Results will appear here"})})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white mb-4 border-b border-slate-100 dark:border-slate-700 pb-2",children:"PO Duplication Check"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Tests the pre-check logic for existing Purchase Orders in SAP."}),jsxRuntimeExports.jsxs("form",{onSubmit:w,className:"flex gap-2 mb-6",children:[jsxRuntimeExports.jsx("input",{type:"text",value:f,onChange:E=>i(E.target.value),placeholder:"Enter PO Number (e.g. 4500012399)",className:"flex-1 p-2 border border-slate-300 dark:border-slate-600 rounded"}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:!f||p,className:"bg-purple-600 text-white px-4 py-2 rounded font-bold hover:bg-purple-700 disabled:opacity-50",children:p?"Checking...":"Check"})]}),y&&jsxRuntimeExports.jsxs("div",{className:"mb-4 p-2 bg-slate-100 dark:bg-slate-900 rounded border border-slate-300 dark:border-slate-600 overflow-x-auto",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Requested URL (Proxy):"}),jsxRuntimeExports.jsx("code",{className:"text-xs text-purple-600 dark:text-purple-400 whitespace-nowrap",children:y})]}),jsxRuntimeExports.jsx("div",{className:"bg-slate-50 dark:bg-slate-900 rounded border border-slate-200 dark:border-slate-700 p-4 min-h-[100px] flex items-center justify-center",children:r?jsxRuntimeExports.jsxs("div",{className:`text-center ${r.exists?"text-red-600":"text-green-600"}`,children:[jsxRuntimeExports.jsx("div",{className:"text-2xl mb-1",children:r.exists?" Found":" Available"}),jsxRuntimeExports.jsx("div",{className:"font-bold",children:r.exists?"Duplicate Detected":"No Duplicate Found"}),r.details&&jsxRuntimeExports.jsx("div",{className:"text-xs mt-2 text-slate-600",children:r.details})]}):jsxRuntimeExports.jsx("div",{className:"text-slate-400 italic text-sm",children:"Status will appear here"})})]})]})]})},LoginView=({onLoginSuccess:n})=>{const[e,t]=reactExports.useState("admin@answerthink.com"),[s,o]=reactExports.useState("password"),[u,l]=reactExports.useState(!1),[m,g]=reactExports.useState(""),h=async f=>{f.preventDefault(),l(!0),g("");try{const i=await login(e);n(i)}catch(i){g(i.message)}finally{l(!1)}};return jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-900 px-4",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-slate-800 rounded-lg shadow-xl overflow-hidden border border-slate-200 dark:border-slate-700",children:[jsxRuntimeExports.jsxs("div",{className:"bg-blue-900 p-8 text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-white/10 text-white mb-4",children:jsxRuntimeExports.jsx("div",{className:"scale-150",children:ICONS.brain})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-white",children:"Answerthink IDP"}),jsxRuntimeExports.jsx("p",{className:"text-blue-200 text-sm mt-2",children:"Intelligent Document Processing"})]}),jsxRuntimeExports.jsxs("div",{className:"p-8",children:[jsxRuntimeExports.jsxs("form",{onSubmit:h,className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Email Address"}),jsxRuntimeExports.jsx("input",{type:"email",value:e,onChange:f=>t(f.target.value),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none dark:bg-slate-700 dark:text-white",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Password"}),jsxRuntimeExports.jsx("input",{type:"password",value:s,onChange:f=>o(f.target.value),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none dark:bg-slate-700 dark:text-white"})]}),m&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 text-red-700 text-sm rounded border border-red-200",children:m}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:u,className:"w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-2.5 rounded-md transition-all shadow-sm hover:shadow-md disabled:opacity-70 disabled:cursor-not-allowed flex justify-center",children:u?jsxRuntimeExports.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):"Sign In"})]}),jsxRuntimeExports.jsxs("div",{className:"mt-6 pt-6 border-t border-slate-100 dark:border-slate-700",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-center text-slate-500 mb-2",children:"Demo Accounts (Password: any)"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[jsxRuntimeExports.jsx("button",{onClick:()=>t("user@answerthink.com"),className:"text-xs px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300 hover:bg-slate-200",children:"End User"}),jsxRuntimeExports.jsx("button",{onClick:()=>t("analyst@answerthink.com"),className:"text-xs px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300 hover:bg-slate-200",children:"Analyst"}),jsxRuntimeExports.jsx("button",{onClick:()=>t("admin@answerthink.com"),className:"text-xs px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300 hover:bg-slate-200",children:"Admin"})]})]})]})]})})},STORAGE_KEY="idp_documents",RULES_STORAGE_KEY="idp_training_rules",initialTrainingRules={schema:[{id:"1",name:"po_number",type:"string",description:"The Purchase Order Number"},{id:"2",name:"customer_name",type:"string",description:"Name of the customer placing the order"},{id:"3",name:"total_amount",type:"number",description:"Total value of the order"},{id:"4",name:"order_date",type:"date",description:"Date of the order"},{id:"5",name:"delivery_address",type:"string",description:"Shipping or delivery address"}],naturalLanguageRules:"Identify the PO Number (often labeled as PO#, Order No). Extract the customer name from the header. Look for the total amount at the bottom. Identify specific delivery instructions if present."},generateFileHash=async n=>{const e=n.length,t=n.substring(0,500),s=n.substring(e-500);return`${e}-${t}-${s}`},App=()=>{const[n,e]=reactExports.useState(null),[t,s]=reactExports.useState(!0),[o,u]=reactExports.useState(()=>{try{const D=localStorage.getItem(STORAGE_KEY);return D?JSON.parse(D):[]}catch(D){return console.error("Failed to load documents from storage",D),[]}}),[l,m]=reactExports.useState(()=>{try{const D=localStorage.getItem(RULES_STORAGE_KEY);return D?JSON.parse(D):initialTrainingRules}catch{return initialTrainingRules}}),[g,h]=reactExports.useState("dashboard"),[f,i]=reactExports.useState(null),[r,d]=reactExports.useState({show:!1,docId:null,message:"",source:"Local"});reactExports.useEffect(()=>{const D=getCurrentUser();e(D),s(!1)},[]),reactExports.useEffect(()=>{try{localStorage.setItem(STORAGE_KEY,JSON.stringify(o))}catch(D){console.error("Local storage quota exceeded or error saving",D)}},[o]),reactExports.useEffect(()=>{try{localStorage.setItem(RULES_STORAGE_KEY,JSON.stringify(l))}catch(D){console.error("Failed to save rules",D)}},[l]);const p=(D,Y,se)=>{u(re=>re.map(W=>W.id===D?{...W,status:Y,...se}:W))},_=reactExports.useCallback(async D=>{p(D.id,DocumentStatus.Parsing),await new Promise(Y=>setTimeout(Y,800)),p(D.id,DocumentStatus.Mapping);try{const{mappedData:Y,lineItems:se,unmappedData:re,termsAndConditions:W,confidence:$,usageMetadata:k,appliedRuleIds:H}=await extractAndMapData(D,l),de=D.tags?[...D.tags]:[],ee=Object.keys(Y).find(xe=>xe.toLowerCase().includes("po_number")||xe.toLowerCase().includes("order_no"))||"po_number",ce=Y[ee];let q;const le=Object.keys(Y).find(xe=>xe.toLowerCase().includes("customer")||xe.toLowerCase().includes("name"));if(le&&Y[le]){const xe=String(Y[le]);console.log(`Attempting auto-link for customer: ${xe}`);try{const{results:Ee}=await searchCustomers({name:xe});if(Ee.length>0){const we=Ee.find(U=>U.CustomerName.toLowerCase()===xe.toLowerCase());we?q=we:Ee.length===1&&(q=Ee[0]),q&&(Y.customer_id=q.BusinessPartner,console.log(`Auto-linked SAP Customer: ${q.CustomerName} (${q.BusinessPartner})`))}}catch(Ee){console.warn("Auto-link SAP customer failed",Ee)}}if(ce){o.some(Ee=>Ee.id!==D.id&&Ee.mappedData&&Ee.mappedData[ee]===ce)&&de.push(`Duplicate: Local File Exists (PO#${ce})`);try{(await checkERPDuplication(String(ce))).exists&&de.push(`Duplicate: SAP Order Exists (PO#${ce})`)}catch(Ee){console.warn("Skipping SAP duplicate check during processing",Ee)}}const be=Array.from(new Set(de));p(D.id,DocumentStatus.Review,{mappedData:Y,lineItems:se,unmappedData:re,termsAndConditions:W,confidence:$,tags:be,appliedRuleIds:H,usageMetadata:k,sapCustomerMatch:q})}catch(Y){console.error("Failed to process document",Y),p(D.id,DocumentStatus.Review,{tags:[...D.tags||[],"Error: Extraction Failed"]})}},[l,o]),y=async(D,Y)=>{if(!D||!n)return;const se=D instanceof FileList?Array.from(D):D,re=[];for(const W of se){const $=await fileToBase64(W),k=await generateFileHash($),H=o.find(de=>de.file.fileHash===k&&de.status!==DocumentStatus.Uploaded);if(H&&!Y){const de={id:`${Date.now()}-${Math.random()}`,file:{name:W.name,type:W.type,size:W.size,base64:$,fileHash:k},status:DocumentStatus.Review,mappedData:H.mappedData,unmappedData:H.unmappedData,lineItems:H.lineItems,termsAndConditions:H.termsAndConditions,confidence:H.confidence,tags:["Restored from Cache",...H.tags||[]],usageMetadata:{...H.usageMetadata,modelName:"Cached Result"},appliedRuleIds:H.appliedRuleIds,sapCustomerMatch:H.sapCustomerMatch,createdBy:n.name,createdAt:new Date().toISOString()};re.push(de),alert(`File '${W.name}' was recognized. Loaded existing extraction results to save costs.`)}else{const de={id:`${Date.now()}-${Math.random()}`,file:{name:W.name,type:W.type,size:W.size,base64:$,fileHash:k},status:DocumentStatus.Uploaded,mappedData:{},tags:[],createdBy:n.name,createdAt:new Date().toISOString(),emailContext:Y};re.push(de)}}u(W=>[...W,...re]),re.forEach(W=>{W.status===DocumentStatus.Uploaded&&_(W)})},v=D=>{window.confirm("Are you sure you want to delete this document?")&&(u(Y=>Y.filter(se=>se.id!==D)),f===D&&w("dashboard"))},T=(D,Y)=>{u(se=>se.map(re=>re.id===D?{...re,tags:Y}:re))},w=D=>{if(n&&!hasPermission(n,D)){alert("You do not have permission to access this area.");return}i(null),h(D)},E=D=>{i(D),h("review")},P=(D,Y,se)=>{u(re=>re.map(W=>W.id===D?{...W,mappedData:Y,unmappedData:se,lastModifiedAt:new Date().toISOString()}:W))},R=D=>{m(Y=>({...Y,naturalLanguageRules:Y.naturalLanguageRules?`${Y.naturalLanguageRules}
${D}`:D})),alert("Rule added to global training instructions. It will be applied to all future document uploads.")},I=D=>{p(D,DocumentStatus.Posting),setTimeout(()=>{p(D,DocumentStatus.Done),g==="review"&&w("dashboard"),d({show:!1,docId:null,message:"",source:"Local"})},2e3)},N=async D=>{const Y=o.find($=>$.id===D);if(!Y)return;const se=Object.keys(Y.mappedData).find($=>$.toLowerCase().includes("po_number")||$.toLowerCase().includes("order_no"))||"po_number",re=Y.mappedData[se];if(!re){I(D);return}const W=o.find($=>$.id!==D&&$.status===DocumentStatus.Done&&$.mappedData[se]===re);if(W){d({show:!0,docId:D,source:"Local",message:`Duplicate PO detected locally (File: ${W.file.name}).`});return}try{const $=await checkERPDuplication(String(re));if($.exists){d({show:!0,docId:D,source:"SAP",message:$.details||"Duplicate PO exists in SAP."});return}}catch{if(!window.confirm("Could not verify duplicates with SAP. Proceed anyway?"))return}I(D)},B=()=>{switch(g){case"settings":return jsxRuntimeExports.jsx(SettingsView,{});case"test-bench":return jsxRuntimeExports.jsx(TestBenchView,{});case"review":return jsxRuntimeExports.jsx(ReviewView,{document:o.find(D=>D.id===f),userRole:n?.role,currentRules:l,onSave:P,onPost:N,onBack:()=>w("dashboard"),onPromoteRule:R,onUpdateTags:T});case"training":return jsxRuntimeExports.jsx(TrainingView,{rules:l,onSave:m});case"dashboard":default:return jsxRuntimeExports.jsx(DashboardView,{documents:o,handleFileUpload:y,navigateToReview:E,onDelete:v,onUpdateTags:T})}};return t?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-900",children:jsxRuntimeExports.jsx("div",{className:"animate-spin h-8 w-8 text-blue-600 border-b-2 border-blue-600 rounded-full"})}):n?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 relative",children:[jsxRuntimeExports.jsx(Header,{user:n,navigateTo:w}),jsxRuntimeExports.jsx("main",{children:B()}),r.show&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-md w-full border border-red-200 dark:border-red-900 overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 p-4 border-b border-red-100 dark:border-red-800 flex items-center gap-3",children:jsxRuntimeExports.jsxs("h3",{className:"text-lg font-bold text-red-800 dark:text-red-200",children:["Duplicate Detected (",r.source,")"]})}),jsxRuntimeExports.jsxs("div",{className:"p-6",children:[jsxRuntimeExports.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-sm leading-relaxed mb-6",children:r.message}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 justify-end",children:[jsxRuntimeExports.jsx("button",{onClick:()=>d(D=>({...D,show:!1})),className:"px-4 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded text-slate-700 dark:text-slate-200 font-semibold text-sm",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:()=>r.docId&&I(r.docId),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-bold text-sm",children:"Post Anyway"})]})]})]})})]}):jsxRuntimeExports.jsx(LoginView,{onLoginSuccess:e})},rootElement=document.getElementById("root");if(!rootElement)throw new Error("Could not find root element to mount to");const root=ReactDOM.createRoot(rootElement);root.render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
